{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trie - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Algorithm/">Algorithm</a>
    <span class="separator">/</span>
    <span class="current">Trie</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Trie</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Algorithm/10_Heaps_and_Priority_Queues.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Heaps and Priority Queues</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Algorithm/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Algorithm/12_Graph_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Graph Basics</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-trie-concepts">1. Trie Concepts</a><ul>
<li><a href="#11-structure">1.1 Structure</a></li>
<li><a href="#12-time-complexity">1.2 Time Complexity</a></li>
<li><a href="#13-trie-vs-hashset">1.3 Trie vs HashSet</a></li>
</ul>
</li>
<li><a href="#2-basic-implementation">2. Basic Implementation</a><ul>
<li><a href="#21-array-based-fixed-alphabet">2.1 Array-based (Fixed Alphabet)</a></li>
<li><a href="#22-dictionary-based-flexible-alphabet">2.2 Dictionary-based (Flexible Alphabet)</a></li>
<li><a href="#23-c-implementation">2.3 C++ Implementation</a></li>
</ul>
</li>
<li><a href="#3-trie-operations">3. Trie Operations</a><ul>
<li><a href="#31-autocomplete-find-all-words">3.1 Autocomplete (Find All Words)</a></li>
<li><a href="#32-counting-words">3.2 Counting Words</a></li>
<li><a href="#33-longest-common-prefix">3.3 Longest Common Prefix</a></li>
<li><a href="#34-wildcard-search">3.4 Wildcard Search</a></li>
</ul>
</li>
<li><a href="#4-xor-trie">4. XOR Trie</a><ul>
<li><a href="#41-concept">4.1 Concept</a></li>
<li><a href="#42-maximum-xor-pair">4.2 Maximum XOR Pair</a></li>
<li><a href="#43-range-xor-maximum">4.3 Range XOR Maximum</a></li>
</ul>
</li>
<li><a href="#5-application-problems">5. Application Problems</a><ul>
<li><a href="#51-add-and-search-word">5.1 Add and Search Word</a></li>
<li><a href="#52-replace-words">5.2 Replace Words</a></li>
<li><a href="#53-concatenated-words">5.3 Concatenated Words</a></li>
<li><a href="#54-suffix-trie">5.4 Suffix Trie</a></li>
</ul>
</li>
<li><a href="#6-practice-problems">6. Practice Problems</a><ul>
<li><a href="#recommended-problems">Recommended Problems</a></li>
</ul>
</li>
<li><a href="#timespace-complexity">Time/Space Complexity</a></li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="trie">Trie<a class="header-link" href="#trie" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>A Trie is a tree data structure for efficiently storing and searching strings. Also called a Prefix Tree, it is used for autocomplete, dictionary search, and more.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-trie-concepts">Trie Concepts</a></li>
<li><a href="#2-basic-implementation">Basic Implementation</a></li>
<li><a href="#3-trie-operations">Trie Operations</a></li>
<li><a href="#4-xor-trie">XOR Trie</a></li>
<li><a href="#5-application-problems">Application Problems</a></li>
<li><a href="#6-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-trie-concepts">1. Trie Concepts<a class="header-link" href="#1-trie-concepts" title="Permanent link">&para;</a></h2>
<h3 id="11-structure">1.1 Structure<a class="header-link" href="#11-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">Words</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;app&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ball&quot;</span>

<span class="w">           </span><span class="p">(</span><span class="nv">root</span><span class="p">)</span>
<span class="w">          </span><span class="o">/</span><span class="w">      </span>\
<span class="w">        </span><span class="nv">a</span><span class="w">          </span><span class="nv">b</span>
<span class="w">        </span><span class="o">|</span><span class="w">          </span><span class="o">|</span>
<span class="w">        </span><span class="nv">p</span><span class="w">          </span><span class="nv">a</span>
<span class="w">        </span><span class="o">|</span><span class="w">         </span><span class="o">/</span><span class="w"> </span>\
<span class="w">        </span><span class="nv">p</span><span class="w">        </span><span class="nv">t</span><span class="w">   </span><span class="nv">l</span>
<span class="w">       </span><span class="o">/</span><span class="w"> </span>\<span class="w">       </span><span class="o">|</span><span class="w">   </span><span class="o">|</span>
<span class="w">      </span><span class="nv">l</span><span class="w">   </span><span class="nv">l</span><span class="w">      </span><span class="p">$</span><span class="w">   </span><span class="nv">l</span>
<span class="w">      </span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w">          </span><span class="o">|</span>
<span class="w">      </span><span class="nv">e</span><span class="w">   </span><span class="nv">i</span><span class="w">          </span><span class="p">$</span>
<span class="w">      </span><span class="o">|</span><span class="w">   </span><span class="o">|</span>
<span class="w">      </span><span class="p">$</span><span class="w">   </span><span class="nv">c</span>
<span class="w">          </span><span class="o">|</span>
<span class="w">          </span><span class="nv">a</span>
<span class="w">          </span><span class="o">|</span>
<span class="w">          </span><span class="nv">t</span>
<span class="w">          </span><span class="o">|</span>
<span class="w">          </span><span class="nv">i</span>
<span class="w">          </span><span class="o">|</span>
<span class="w">          </span><span class="nv">o</span>
<span class="w">          </span><span class="o">|</span>
<span class="w">          </span><span class="nv">n</span>
<span class="w">          </span><span class="o">|</span>
<span class="w">          </span><span class="p">$</span>

<span class="p">$</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">End</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="nf">marker</span><span class="w"> </span><span class="p">(</span><span class="nv">isEnd</span><span class="p">)</span>

<span class="nv">Features</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Root</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">empty</span><span class="w"> </span><span class="nv">node</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Each</span><span class="w"> </span><span class="nv">edge</span><span class="w"> </span><span class="nv">represents</span><span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">character</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Common</span><span class="w"> </span><span class="nv">prefixes</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">shared</span>
</code></pre></div>

<h3 id="12-time-complexity">1.2 Time Complexity<a class="header-link" href="#12-time-complexity" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>m = string length

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation   â”‚ Time        â”‚ Description    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Insert      â”‚ O(m)        â”‚ String length  â”‚
â”‚ Search      â”‚ O(m)        â”‚ String length  â”‚
â”‚ Prefix      â”‚ O(m)        â”‚ Prefix length  â”‚
â”‚ Delete      â”‚ O(m)        â”‚ String length  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Space: O(total characters) or O(n Ã— m Ã— alphabet size)
</code></pre></div>

<h3 id="13-trie-vs-hashset">1.3 Trie vs HashSet<a class="header-link" href="#13-trie-vs-hashset" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Criteria       â”‚ Trie        â”‚ HashSet     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Search         â”‚ O(m)        â”‚ O(m) avg    â”‚
â”‚ Prefix Search  â”‚ O(p) âœ“      â”‚ O(n Ã— m) âœ—  â”‚
â”‚ Sorted Iter    â”‚ Possible âœ“  â”‚ Not possibleâœ—â”‚
â”‚ Space          â”‚ Lower       â”‚ Higher      â”‚
â”‚ Autocomplete   â”‚ Optimal âœ“   â”‚ Inefficient âœ—â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

p = prefix length, n = number of words
</code></pre></div>

<hr />
<h2 id="2-basic-implementation">2. Basic Implementation<a class="header-link" href="#2-basic-implementation" title="Permanent link">&para;</a></h2>
<h3 id="21-array-based-fixed-alphabet">2.1 Array-based (Fixed Alphabet)<a class="header-link" href="#21-array-based-fixed-alphabet" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TrieNode</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">26</span>  <span class="c1"># a-z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_end</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Trie</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">TrieNode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_char_to_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert word - O(m)&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_char_to_index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">TrieNode</span><span class="p">()</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">node</span><span class="o">.</span><span class="n">is_end</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search word - O(m)&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_char_to_index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">starts_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if prefix exists - O(p)&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_char_to_index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="c1"># Usage example</span>
<span class="n">trie</span> <span class="o">=</span> <span class="n">Trie</span><span class="p">()</span>
<span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;apple&quot;</span><span class="p">)</span>
<span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">)</span>
<span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">))</span>       <span class="c1"># True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;appl&quot;</span><span class="p">))</span>      <span class="c1"># False</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">starts_with</span><span class="p">(</span><span class="s2">&quot;appl&quot;</span><span class="p">))</span> <span class="c1"># True</span>
</code></pre></div>

<h3 id="22-dictionary-based-flexible-alphabet">2.2 Dictionary-based (Flexible Alphabet)<a class="header-link" href="#22-dictionary-based-flexible-alphabet" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TrieNodeDict</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># char â†’ TrieNode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_end</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TrieDict</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">TrieNodeDict</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">TrieNodeDict</span><span class="p">()</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
        <span class="n">node</span><span class="o">.</span><span class="n">is_end</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">starts_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete word&quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_delete</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Word not found</span>
                <span class="n">node</span><span class="o">.</span><span class="n">is_end</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

            <span class="n">c</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">should_delete</span> <span class="o">=</span> <span class="n">_delete</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">word</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">should_delete</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">_delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="23-c-implementation">2.3 C++ Implementation<a class="header-link" href="#23-c-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TrieNode</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="n">TrieNode</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">children</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isEnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Trie</span><span class="w"> </span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">TrieNode</span><span class="o">*</span><span class="w"> </span><span class="n">root</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Trie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TrieNode</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">insert</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TrieNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TrieNode</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">isEnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">search</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TrieNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">isEnd</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">startsWith</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">prefix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TrieNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">prefix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<hr />
<h2 id="3-trie-operations">3. Trie Operations<a class="header-link" href="#3-trie-operations" title="Permanent link">&para;</a></h2>
<h3 id="31-autocomplete-find-all-words">3.1 Autocomplete (Find All Words)<a class="header-link" href="#31-autocomplete-find-all-words" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AutocompleteTrie</span><span class="p">(</span><span class="n">TrieDict</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">autocomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all words starting with prefix&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect_words</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_collect_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collect_words</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">current</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>


<span class="c1"># Usage example</span>
<span class="n">trie</span> <span class="o">=</span> <span class="n">AutocompleteTrie</span><span class="p">()</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;apply&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">]:</span>
    <span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">autocomplete</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">))</span>
<span class="c1"># [&#39;app&#39;, &#39;apple&#39;, &#39;application&#39;, &#39;apply&#39;]</span>
</code></pre></div>

<h3 id="32-counting-words">3.2 Counting Words<a class="header-link" href="#32-counting-words" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CountingTrie</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">node</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Number of words with this prefix</span>
        <span class="n">node</span><span class="p">[</span><span class="s1">&#39;$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># End of word</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">count_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count words starting with prefix&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">count_words</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count total words&quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;$&#39;</span> <span class="ow">in</span> <span class="n">node</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">]:</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">count</span>
        <span class="k">return</span> <span class="n">dfs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>


<span class="c1"># Usage example</span>
<span class="n">trie</span> <span class="o">=</span> <span class="n">CountingTrie</span><span class="p">()</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;application&quot;</span><span class="p">]:</span>
    <span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">count_prefix</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">))</span>  <span class="c1"># 3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">count_prefix</span><span class="p">(</span><span class="s2">&quot;appl&quot;</span><span class="p">))</span>  <span class="c1"># 2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">count_words</span><span class="p">())</span>  <span class="c1"># 3</span>
</code></pre></div>

<h3 id="33-longest-common-prefix">3.3 Longest Common Prefix<a class="header-link" href="#33-longest-common-prefix" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">longest_common_prefix</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Longest common prefix of all words&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="n">trie</span> <span class="o">=</span> <span class="n">TrieDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">trie</span><span class="o">.</span><span class="n">root</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Continue if only one child and not end of word</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">c</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">child</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>


<span class="c1"># Example</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flower&quot;</span><span class="p">,</span> <span class="s2">&quot;flow&quot;</span><span class="p">,</span> <span class="s2">&quot;flight&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">longest_common_prefix</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>  <span class="c1"># &quot;fl&quot;</span>
</code></pre></div>

<h3 id="34-wildcard-search">3.4 Wildcard Search<a class="header-link" href="#34-wildcard-search" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WildcardTrie</span><span class="p">(</span><span class="n">TrieDict</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">search_with_wildcard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&#39;.&#39; matches any character&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="c1"># Search all children</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">word</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>


<span class="c1"># Example</span>
<span class="n">trie</span> <span class="o">=</span> <span class="n">WildcardTrie</span><span class="p">()</span>
<span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;bad&quot;</span><span class="p">)</span>
<span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;dad&quot;</span><span class="p">)</span>
<span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;mad&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">search_with_wildcard</span><span class="p">(</span><span class="s2">&quot;pad&quot;</span><span class="p">))</span>  <span class="c1"># False</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">search_with_wildcard</span><span class="p">(</span><span class="s2">&quot;bad&quot;</span><span class="p">))</span>  <span class="c1"># True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">search_with_wildcard</span><span class="p">(</span><span class="s2">&quot;.ad&quot;</span><span class="p">))</span>  <span class="c1"># True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">search_with_wildcard</span><span class="p">(</span><span class="s2">&quot;b..&quot;</span><span class="p">))</span>  <span class="c1"># True</span>
</code></pre></div>

<hr />
<h2 id="4-xor-trie">4. XOR Trie<a class="header-link" href="#4-xor-trie" title="Permanent link">&para;</a></h2>
<h3 id="41-concept">4.1 Concept<a class="header-link" href="#41-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">XOR</span><span class="w"> </span><span class="nv">Trie</span>:<span class="w"> </span><span class="nv">Trie</span><span class="w"> </span><span class="nv">storing</span><span class="w"> </span><span class="nv">integers</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">binary</span><span class="w"> </span><span class="nv">numbers</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">finding</span><span class="w"> </span><span class="nv">maximum</span><span class="w"> </span><span class="nv">XOR</span><span class="w"> </span><span class="nv">pair</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Store</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">bit</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">most</span><span class="w"> </span><span class="nv">significant</span>

<span class="nv">Example</span>:<span class="w"> </span><span class="nv">Store</span><span class="w"> </span><span class="mi">3</span>,<span class="w"> </span><span class="mi">10</span>,<span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="ss">(</span><span class="mi">4</span><span class="w"> </span><span class="nv">bits</span><span class="ss">)</span>
<span class="mi">3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0011</span>
<span class="mi">10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1010</span>
<span class="mi">5</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0101</span>

<span class="w">        </span><span class="nv">root</span>
<span class="w">       </span><span class="o">/</span><span class="w">    </span>\
<span class="w">      </span><span class="mi">0</span><span class="w">      </span><span class="mi">1</span>
<span class="w">     </span><span class="o">/</span><span class="w"> </span>\<span class="w">      </span>\
<span class="w">    </span><span class="mi">0</span><span class="w">   </span><span class="mi">1</span><span class="w">      </span><span class="mi">0</span>
<span class="w">    </span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span>
<span class="w">    </span><span class="mi">1</span><span class="w">   </span><span class="mi">0</span><span class="w">      </span><span class="mi">1</span>
<span class="w">    </span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span>
<span class="w">    </span><span class="mi">1</span><span class="w">   </span><span class="mi">1</span><span class="w">      </span><span class="mi">0</span>
<span class="w">    </span>â†“<span class="w">   </span>â†“<span class="w">      </span>â†“
<span class="w">    </span><span class="mi">3</span><span class="w">   </span><span class="mi">5</span><span class="w">      </span><span class="mi">10</span>
</code></pre></div>

<h3 id="42-maximum-xor-pair">4.2 Maximum XOR Pair<a class="header-link" href="#42-maximum-xor-pair" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">XORTrie</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_bits</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_bits</span> <span class="o">=</span> <span class="n">max_bits</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert number&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_bits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_max_xor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find XOR result with number that maximizes XOR with num&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_bits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="c1"># Choosing opposite bit maximizes XOR</span>
            <span class="n">opposite</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">bit</span>

            <span class="k">if</span> <span class="n">opposite</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">opposite</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">find_maximum_xor</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find maximum XOR pair in array&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">trie</span> <span class="o">=</span> <span class="n">XORTrie</span><span class="p">()</span>
    <span class="n">max_xor</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">max_xor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_xor</span><span class="p">,</span> <span class="n">trie</span><span class="o">.</span><span class="n">find_max_xor</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">max_xor</span>


<span class="c1"># Example</span>
<span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">find_maximum_xor</span><span class="p">(</span><span class="n">nums</span><span class="p">))</span>  <span class="c1"># 28 (5 XOR 25 = 28)</span>
</code></pre></div>

<h3 id="43-range-xor-maximum">4.3 Range XOR Maximum<a class="header-link" href="#43-range-xor-maximum" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PersistentXORTrie</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maximum XOR with k in range [l, r]</span>
<span class="sd">    Offline queries + Persistent Trie</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_bits</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_bits</span> <span class="o">=</span> <span class="n">max_bits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># [left_child, right_child]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Number of numbers passing each node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Root per version</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prev_root</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add num from previous version&quot;&quot;&quot;</span>
        <span class="n">new_root</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">curr</span> <span class="o">=</span> <span class="n">new_root</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">prev_root</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_bits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>

            <span class="c1"># Create new node</span>
            <span class="n">child</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Copy opposite child from previous version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">curr</span><span class="p">][</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">prev</span><span class="p">][</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bit</span><span class="p">]</span> <span class="k">if</span> <span class="n">prev</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">curr</span><span class="p">][</span><span class="n">bit</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>

            <span class="c1"># Update count</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">[</span><span class="n">child</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">prev</span><span class="p">][</span><span class="n">bit</span><span class="p">]]</span> <span class="k">if</span> <span class="n">prev</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">curr</span> <span class="o">=</span> <span class="n">child</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">prev</span><span class="p">][</span><span class="n">bit</span><span class="p">]</span> <span class="k">if</span> <span class="n">prev</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_root</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_root</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_root</span><span class="p">,</span> <span class="n">r_root</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maximum XOR with num between versions (l, r]&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">l_node</span> <span class="o">=</span> <span class="n">l_root</span>
        <span class="n">r_node</span> <span class="o">=</span> <span class="n">r_root</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_bits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">opposite</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">bit</span>

            <span class="n">l_opp_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">l_node</span><span class="p">][</span><span class="n">opposite</span><span class="p">]]</span> <span class="k">if</span> <span class="n">l_node</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">r_opp_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">r_node</span><span class="p">][</span><span class="n">opposite</span><span class="p">]]</span> <span class="k">if</span> <span class="n">r_node</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">r_opp_count</span> <span class="o">-</span> <span class="n">l_opp_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">l_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">l_node</span><span class="p">][</span><span class="n">opposite</span><span class="p">]</span> <span class="k">if</span> <span class="n">l_node</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">r_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">r_node</span><span class="p">][</span><span class="n">opposite</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">l_node</span><span class="p">][</span><span class="n">bit</span><span class="p">]</span> <span class="k">if</span> <span class="n">l_node</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">r_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">r_node</span><span class="p">][</span><span class="n">bit</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>

<hr />
<h2 id="5-application-problems">5. Application Problems<a class="header-link" href="#5-application-problems" title="Permanent link">&para;</a></h2>
<h3 id="51-add-and-search-word">5.1 Add and Search Word<a class="header-link" href="#51-add-and-search-word" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># LeetCode 211. Design Add and Search Words Data Structure</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WordDictionary</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trie</span> <span class="o">=</span> <span class="n">WildcardTrie</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">addWord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trie</span><span class="o">.</span><span class="n">search_with_wildcard</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</code></pre></div>

<h3 id="52-replace-words">5.2 Replace Words<a class="header-link" href="#52-replace-words" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">replace_words</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace each word in sentence with dictionary prefix</span>
<span class="sd">    dictionary = [&quot;cat&quot;, &quot;bat&quot;, &quot;rat&quot;]</span>
<span class="sd">    sentence = &quot;the cattle was rattled by the battery&quot;</span>
<span class="sd">    â†’ &quot;the cat was rat by the bat&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trie</span> <span class="o">=</span> <span class="n">TrieDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
        <span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_root</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">trie</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">word</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">word</span><span class="p">[:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">word</span>

    <span class="n">words</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">find_root</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">)</span>


<span class="c1"># Example</span>
<span class="n">dictionary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;bat&quot;</span><span class="p">,</span> <span class="s2">&quot;rat&quot;</span><span class="p">]</span>
<span class="n">sentence</span> <span class="o">=</span> <span class="s2">&quot;the cattle was rattled by the battery&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">replace_words</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">sentence</span><span class="p">))</span>
<span class="c1"># &quot;the cat was rat by the bat&quot;</span>
</code></pre></div>

<h3 id="53-concatenated-words">5.3 Concatenated Words<a class="header-link" href="#53-concatenated-words" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_all_concatenated_words</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find words that can be formed by concatenating other words</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trie</span> <span class="o">=</span> <span class="n">TrieDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">trie</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">can_form</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">2</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">trie</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_end</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">can_form</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">and</span> <span class="n">can_form</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># Example</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;cats&quot;</span><span class="p">,</span> <span class="s2">&quot;catsdogcats&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;dogcatsdog&quot;</span><span class="p">,</span>
         <span class="s2">&quot;hippopotamuses&quot;</span><span class="p">,</span> <span class="s2">&quot;rat&quot;</span><span class="p">,</span> <span class="s2">&quot;ratcatdogcat&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">find_all_concatenated_words</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
<span class="c1"># [&quot;catsdogcats&quot;, &quot;dogcatsdog&quot;, &quot;ratcatdogcat&quot;]</span>
</code></pre></div>

<h3 id="54-suffix-trie">5.4 Suffix Trie<a class="header-link" href="#54-suffix-trie" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SuffixTrie</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trie storing all suffixes of a string&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">node</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">node</span><span class="p">[</span><span class="s1">&#39;$&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>  <span class="c1"># Store starting index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All starting positions where pattern exists&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

        <span class="c1"># Collect all $ under this node</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;$&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;$&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39;$&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>


<span class="c1"># Example</span>
<span class="n">st</span> <span class="o">=</span> <span class="n">SuffixTrie</span><span class="p">(</span><span class="s2">&quot;banana&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;ana&quot;</span><span class="p">))</span>  <span class="c1"># [1, 3]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>  <span class="c1"># [2]</span>
</code></pre></div>

<hr />
<h2 id="6-practice-problems">6. Practice Problems<a class="header-link" href="#6-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="recommended-problems">Recommended Problems<a class="header-link" href="#recommended-problems" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Difficulty</th>
<th>Problem</th>
<th>Platform</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>â­â­</td>
<td><a href="https://leetcode.com/problems/implement-trie-prefix-tree/">Implement Trie</a></td>
<td>LeetCode</td>
<td>Basic implementation</td>
</tr>
<tr>
<td>â­â­â­</td>
<td><a href="https://www.acmicpc.net/problem/5052">Phone List</a></td>
<td>BOJ</td>
<td>Prefix</td>
</tr>
<tr>
<td>â­â­â­</td>
<td><a href="https://leetcode.com/problems/design-search-autocomplete-system/">Design Search Autocomplete</a></td>
<td>LeetCode</td>
<td>Autocomplete</td>
</tr>
<tr>
<td>â­â­â­</td>
<td><a href="https://leetcode.com/problems/design-add-and-search-words-data-structure/">Add and Search Word</a></td>
<td>LeetCode</td>
<td>Wildcard</td>
</tr>
<tr>
<td>â­â­â­â­</td>
<td><a href="https://leetcode.com/problems/maximum-xor-of-two-numbers-in-an-array/">Maximum XOR of Two Numbers</a></td>
<td>LeetCode</td>
<td>XOR Trie</td>
</tr>
<tr>
<td>â­â­â­â­</td>
<td><a href="https://www.acmicpc.net/problem/14425">String Set</a></td>
<td>BOJ</td>
<td>Search</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="timespace-complexity">Time/Space Complexity<a class="header-link" href="#timespace-complexity" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation       â”‚ Time        â”‚ Space               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Insert          â”‚ O(m)        â”‚ O(m Ã— alphabet)     â”‚
â”‚ Search          â”‚ O(m)        â”‚ -                   â”‚
â”‚ Prefix Search   â”‚ O(p)        â”‚ -                   â”‚
â”‚ Autocomplete    â”‚ O(p + k)    â”‚ O(result length)    â”‚
â”‚ XOR Maximum     â”‚ O(log MAX)  â”‚ O(n Ã— log MAX)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

m = word length, p = prefix length, k = result count
</code></pre></div>

<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./12_Graph_Basics.md">12_Graph_Basics.md</a> - Graph Basics</li>
</ul>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://cp-algorithms.com/string/trie.html">Trie</a></li>
<li><a href="https://codeforces.com/blog/entry/65408">XOR Trie</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Algorithm/10_Heaps_and_Priority_Queues.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Heaps and Priority Queues</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Algorithm/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Algorithm/12_Graph_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Graph Basics</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}