{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28. Game Theory - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Algorithm/">Algorithm</a>
    <span class="separator">/</span>
    <span class="current">28. Game Theory</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>28. Game Theory</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Algorithm/26_Computational_Geometry.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">27. Computational Geometry</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Algorithm/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Algorithm/28_Advanced_DP_Optimization.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">29. Advanced DP Optimization</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-combinatorial-game-theory-basics">1. Combinatorial Game Theory Basics</a><ul>
<li><a href="#characteristics-of-combinatorial-games">Characteristics of Combinatorial Games</a></li>
<li><a href="#winning-state-w-vs-losing-state-l">Winning State (W) vs Losing State (L)</a></li>
<li><a href="#basic-example-stone-taking-game">Basic Example: Stone Taking Game</a></li>
</ul>
</li>
<li><a href="#2-nim-game">2. Nim Game</a><ul>
<li><a href="#rules">Rules</a></li>
<li><a href="#nim-theorem">Nim Theorem</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#variant-misere-nim">Variant: MisÃ¨re Nim</a></li>
</ul>
</li>
<li><a href="#3-sprague-grundy-theorem">3. Sprague-Grundy Theorem</a><ul>
<li><a href="#grundy-number-nimber">Grundy Number (Nimber)</a></li>
<li><a href="#rules_1">Rules</a></li>
<li><a href="#implementation_1">Implementation</a></li>
<li><a href="#combined-games">Combined Games</a></li>
</ul>
</li>
<li><a href="#4-minimax-algorithm">4. Minimax Algorithm</a><ul>
<li><a href="#concept">Concept</a></li>
<li><a href="#basic-implementation">Basic Implementation</a></li>
<li><a href="#alpha-beta-pruning">Alpha-Beta Pruning</a></li>
</ul>
</li>
<li><a href="#5-tic-tac-toe-example">5. Tic-Tac-Toe Example</a></li>
<li><a href="#6-practical-problem-patterns">6. Practical Problem Patterns</a><ul>
<li><a href="#pattern-1-simple-winloss-games">Pattern 1: Simple Win/Loss Games</a></li>
<li><a href="#pattern-2-multi-pile-games">Pattern 2: Multi-Pile Games</a></li>
<li><a href="#pattern-3-graph-games">Pattern 3: Graph Games</a></li>
<li><a href="#pattern-4-game-splitting">Pattern 4: Game Splitting</a></li>
</ul>
</li>
<li><a href="#7-advanced-techniques">7. Advanced Techniques</a><ul>
<li><a href="#nimber-multiplication">Nimber Multiplication</a></li>
<li><a href="#game-tree-storage">Game Tree Storage</a></li>
</ul>
</li>
<li><a href="#8-time-complexity-summary">8. Time Complexity Summary</a></li>
<li><a href="#9-common-mistakes">9. Common Mistakes</a><ul>
<li><a href="#mistake-1-mex-calculation-error">Mistake 1: mex Calculation Error</a></li>
<li><a href="#mistake-2-xor-operator-precedence">Mistake 2: XOR Operator Precedence</a></li>
<li><a href="#mistake-3-terminal-condition">Mistake 3: Terminal Condition</a></li>
</ul>
</li>
<li><a href="#10-practice-problems">10. Practice Problems</a></li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#learning-checklist">Learning Checklist</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="28-game-theory">28. Game Theory<a class="header-link" href="#28-game-theory" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understanding basic concepts of combinatorial game theory</li>
<li>Analyzing winning and losing states</li>
<li>Solving Nim game</li>
<li>Utilizing Sprague-Grundy theorem</li>
<li>Implementing minimax algorithm</li>
</ul>
<h2 id="1-combinatorial-game-theory-basics">1. Combinatorial Game Theory Basics<a class="header-link" href="#1-combinatorial-game-theory-basics" title="Permanent link">&para;</a></h2>
<h3 id="characteristics-of-combinatorial-games">Characteristics of Combinatorial Games<a class="header-link" href="#characteristics-of-combinatorial-games" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Combinatorial Game                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Two players take turns                      â”‚
â”‚  2. Perfect information (all information public)â”‚
â”‚  3. No element of chance (deterministic)        â”‚
â”‚  4. Finite number of states                     â”‚
â”‚  5. Player who cannot move loses                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="winning-state-w-vs-losing-state-l">Winning State (W) vs Losing State (L)<a class="header-link" href="#winning-state-w-vs-losing-state-l" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Losing state (L): All reachable states are W
Winning state (W): At least one reachable state is L

    Start
      |
      W â†â”€â”€ Can force opponent to L
     / \
    L   W
    |   |
    W   L â†â”€â”€ All moves lead to W only

Rule: Start from L = lose, start from W = win
</code></pre></div>

<h3 id="basic-example-stone-taking-game">Basic Example: Stone Taking Game<a class="header-link" href="#basic-example-stone-taking-game" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stone_game</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">moves</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Can take moves[i] stones from n stones</span>
<span class="sd">    Player who takes last stone wins</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># dp[i] = True if winning state</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">moves</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">move</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">move</span><span class="p">]:</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="c1"># Example: 10 stones, can take 1, 2, or 3 at a time</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stone_game</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>  <span class="c1"># True</span>
</code></pre></div>

<hr />
<h2 id="2-nim-game">2. Nim Game<a class="header-link" href="#2-nim-game" title="Permanent link">&para;</a></h2>
<h3 id="rules">Rules<a class="header-link" href="#rules" title="Permanent link">&para;</a></h3>
<ul>
<li>Multiple piles of stones</li>
<li>Each turn, take 1 or more stones from one pile</li>
<li>Player who takes the last stone wins</li>
</ul>
<div class="highlight"><pre><span></span><code>Piles: [3, 4, 5]

Player 1: Take 2 from pile 2 â†’ [3, 2, 5]
Player 2: Take 3 from pile 3 â†’ [3, 2, 2]
...
</code></pre></div>

<h3 id="nim-theorem">Nim Theorem<a class="header-link" href="#nim-theorem" title="Permanent link">&para;</a></h3>
<p><strong>XOR Sum = 0 means losing, â‰  0 means winning</strong></p>
<div class="highlight"><pre><span></span><code>Example: [3, 4, 5]
3 = 011
4 = 100
5 = 101
---------
XOR = 010 = 2 â‰  0 â†’ First player wins

Example: [1, 2, 3]
1 = 01
2 = 10
3 = 11
--------
XOR = 00 = 0 â†’ First player loses
</code></pre></div>

<h3 id="implementation">Implementation<a class="header-link" href="#implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">nim_game</span><span class="p">(</span><span class="n">piles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine winner of Nim game</span>
<span class="sd">    Returns: True if first player wins</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xor_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pile</span> <span class="ow">in</span> <span class="n">piles</span><span class="p">:</span>
        <span class="n">xor_sum</span> <span class="o">^=</span> <span class="n">pile</span>

    <span class="k">return</span> <span class="n">xor_sum</span> <span class="o">!=</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">nim_winning_move</span><span class="p">(</span><span class="n">piles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find optimal move to win</span>
<span class="sd">    Returns: (pile index, stones to take) or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xor_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pile</span> <span class="ow">in</span> <span class="n">piles</span><span class="p">:</span>
        <span class="n">xor_sum</span> <span class="o">^=</span> <span class="n">pile</span>

    <span class="k">if</span> <span class="n">xor_sum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Already in losing state</span>

    <span class="c1"># Find move that makes XOR sum 0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">piles</span><span class="p">):</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">pile</span> <span class="o">^</span> <span class="n">xor_sum</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">&lt;</span> <span class="n">pile</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">pile</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Usage example</span>
<span class="n">piles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">if</span> <span class="n">nim_game</span><span class="p">(</span><span class="n">piles</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First player wins!&quot;</span><span class="p">)</span>
    <span class="n">move</span> <span class="o">=</span> <span class="n">nim_winning_move</span><span class="p">(</span><span class="n">piles</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimal move: take </span><span class="si">{</span><span class="n">move</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> from pile </span><span class="si">{</span><span class="n">move</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second player wins!&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="variant-misere-nim">Variant: MisÃ¨re Nim<a class="header-link" href="#variant-misere-nim" title="Permanent link">&para;</a></h3>
<p>Version where player who takes last stone <strong>loses</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">misere_nim</span><span class="p">(</span><span class="n">piles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MisÃ¨re Nim: Taking last stone means losing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xor_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">all_ones</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">pile</span> <span class="ow">in</span> <span class="n">piles</span><span class="p">:</span>
        <span class="n">xor_sum</span> <span class="o">^=</span> <span class="n">pile</span>
        <span class="k">if</span> <span class="n">pile</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">all_ones</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">all_ones</span><span class="p">:</span>
        <span class="c1"># If all piles â‰¤ 1, lose if odd number of piles</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">piles</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Same as regular Nim</span>
        <span class="k">return</span> <span class="n">xor_sum</span> <span class="o">!=</span> <span class="mi">0</span>
</code></pre></div>

<hr />
<h2 id="3-sprague-grundy-theorem">3. Sprague-Grundy Theorem<a class="header-link" href="#3-sprague-grundy-theorem" title="Permanent link">&para;</a></h2>
<h3 id="grundy-number-nimber">Grundy Number (Nimber)<a class="header-link" href="#grundy-number-nimber" title="Permanent link">&para;</a></h3>
<p>Every combinatorial game state has a <strong>Grundy number</strong>, which is the size of an equivalent Nim pile.</p>
<div class="highlight"><pre><span></span><code>Grundy(state) = mex({Grundy(next_state) for all next_state})

mex = minimum excludant (smallest non-negative integer not in set)
mex({0, 1, 2}) = 3
mex({0, 2, 3}) = 1
mex({1, 2}) = 0
</code></pre></div>

<h3 id="rules_1">Rules<a class="header-link" href="#rules_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Grundy = 0: losing state (L)
Grundy &gt; 0: winning state (W)

Combining independent games:
Grundy(G1 + G2) = Grundy(G1) XOR Grundy(G2)
</code></pre></div>

<h3 id="implementation_1">Implementation<a class="header-link" href="#implementation_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_grundy</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">get_next_states</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Grundy number for a state</span>
<span class="sd">    state: current game state</span>
<span class="sd">    get_next_states: function returning possible next states</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">memo</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">memo</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>

    <span class="n">next_states</span> <span class="o">=</span> <span class="n">get_next_states</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">next_states</span><span class="p">:</span>
        <span class="c1"># No moves possible = Grundy 0</span>
        <span class="n">memo</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Set of Grundy numbers of next states</span>
    <span class="n">grundy_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">next_state</span> <span class="ow">in</span> <span class="n">next_states</span><span class="p">:</span>
        <span class="n">grundy_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">calculate_grundy</span><span class="p">(</span><span class="n">next_state</span><span class="p">,</span> <span class="n">get_next_states</span><span class="p">,</span> <span class="n">memo</span><span class="p">))</span>

    <span class="c1"># Calculate mex</span>
    <span class="n">mex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">mex</span> <span class="ow">in</span> <span class="n">grundy_set</span><span class="p">:</span>
        <span class="n">mex</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">memo</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">mex</span>
    <span class="k">return</span> <span class="n">mex</span>

<span class="c1"># Example: Take 1-3 stones game</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_next_states</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;States after taking 1, 2, or 3 stones from n&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">]</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">calculate_grundy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">get_next_states</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Grundy(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Output: 0, 1, 2, 3, 0, 1, 2, 3, 0, 1</span>
<span class="c1"># Pattern: n % 4</span>
</code></pre></div>

<h3 id="combined-games">Combined Games<a class="header-link" href="#combined-games" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">combined_game_winner</span><span class="p">(</span><span class="n">games</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combination of independent games</span>
<span class="sd">    games: list of Grundy numbers for each game</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xor_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">games</span><span class="p">:</span>
        <span class="n">xor_sum</span> <span class="o">^=</span> <span class="n">g</span>

    <span class="k">return</span> <span class="n">xor_sum</span> <span class="o">!=</span> <span class="mi">0</span>

<span class="c1"># Example: Three stone games (5, 7, 3 stones)</span>
<span class="n">grundy_5</span> <span class="o">=</span> <span class="n">calculate_grundy</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">get_next_states</span><span class="p">)</span>  <span class="c1"># 1</span>
<span class="n">grundy_7</span> <span class="o">=</span> <span class="n">calculate_grundy</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">get_next_states</span><span class="p">)</span>  <span class="c1"># 3</span>
<span class="n">grundy_3</span> <span class="o">=</span> <span class="n">calculate_grundy</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">get_next_states</span><span class="p">)</span>  <span class="c1"># 3</span>

<span class="c1"># Combined: 1 XOR 3 XOR 3 = 1 â‰  0 â†’ First player wins</span>
<span class="nb">print</span><span class="p">(</span><span class="n">combined_game_winner</span><span class="p">([</span><span class="n">grundy_5</span><span class="p">,</span> <span class="n">grundy_7</span><span class="p">,</span> <span class="n">grundy_3</span><span class="p">]))</span>
</code></pre></div>

<hr />
<h2 id="4-minimax-algorithm">4. Minimax Algorithm<a class="header-link" href="#4-minimax-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="concept">Concept<a class="header-link" href="#concept" title="Permanent link">&para;</a></h3>
<p>Calculate outcome when two players play optimally</p>
<div class="highlight"><pre><span></span><code>Max player: tries to maximize score
Min player: tries to minimize score

        Max
       / | \
      3  5  2
     /|  |  |\
Min 3 1  5  2 4

Max chooses 5 (maximum)
</code></pre></div>

<h3 id="basic-implementation">Basic Implementation<a class="header-link" href="#basic-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">minimax</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">is_maximizing</span><span class="p">,</span> <span class="n">get_moves</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">is_terminal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Minimax algorithm</span>
<span class="sd">    state: current game state</span>
<span class="sd">    depth: search depth</span>
<span class="sd">    is_maximizing: True if Max player&#39;s turn</span>
<span class="sd">    get_moves: function returning possible moves</span>
<span class="sd">    evaluate: function returning state score</span>
<span class="sd">    is_terminal: function checking if game is over</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">is_terminal</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">moves</span> <span class="o">=</span> <span class="n">get_moves</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_maximizing</span><span class="p">:</span>
        <span class="n">max_eval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">moves</span><span class="p">:</span>
            <span class="n">next_state</span> <span class="o">=</span> <span class="n">apply_move</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">move</span><span class="p">)</span>
            <span class="n">eval_score</span> <span class="o">=</span> <span class="n">minimax</span><span class="p">(</span><span class="n">next_state</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                 <span class="n">get_moves</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">is_terminal</span><span class="p">)</span>
            <span class="n">max_eval</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_eval</span><span class="p">,</span> <span class="n">eval_score</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_eval</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">min_eval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">moves</span><span class="p">:</span>
            <span class="n">next_state</span> <span class="o">=</span> <span class="n">apply_move</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">move</span><span class="p">)</span>
            <span class="n">eval_score</span> <span class="o">=</span> <span class="n">minimax</span><span class="p">(</span><span class="n">next_state</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="n">get_moves</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">is_terminal</span><span class="p">)</span>
            <span class="n">min_eval</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_eval</span><span class="p">,</span> <span class="n">eval_score</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">min_eval</span>
</code></pre></div>

<h3 id="alpha-beta-pruning">Alpha-Beta Pruning<a class="header-link" href="#alpha-beta-pruning" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">alphabeta</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">is_maximizing</span><span class="p">,</span>
              <span class="n">get_moves</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">is_terminal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Minimax optimized with alpha-beta pruning</span>
<span class="sd">    alpha: Max player&#39;s best (lower bound)</span>
<span class="sd">    beta: Min player&#39;s best (upper bound)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">is_terminal</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="n">moves</span> <span class="o">=</span> <span class="n">get_moves</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_maximizing</span><span class="p">:</span>
        <span class="n">max_eval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">moves</span><span class="p">:</span>
            <span class="n">next_state</span> <span class="o">=</span> <span class="n">apply_move</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">move</span><span class="p">)</span>
            <span class="n">eval_score</span> <span class="o">=</span> <span class="n">alphabeta</span><span class="p">(</span><span class="n">next_state</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">get_moves</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">is_terminal</span><span class="p">)</span>
            <span class="n">max_eval</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_eval</span><span class="p">,</span> <span class="n">eval_score</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">eval_score</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">beta</span> <span class="o">&lt;=</span> <span class="n">alpha</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># Prune</span>
        <span class="k">return</span> <span class="n">max_eval</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">min_eval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">moves</span><span class="p">:</span>
            <span class="n">next_state</span> <span class="o">=</span> <span class="n">apply_move</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">move</span><span class="p">)</span>
            <span class="n">eval_score</span> <span class="o">=</span> <span class="n">alphabeta</span><span class="p">(</span><span class="n">next_state</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                   <span class="n">get_moves</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">is_terminal</span><span class="p">)</span>
            <span class="n">min_eval</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_eval</span><span class="p">,</span> <span class="n">eval_score</span><span class="p">)</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">eval_score</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">beta</span> <span class="o">&lt;=</span> <span class="n">alpha</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># Prune</span>
        <span class="k">return</span> <span class="n">min_eval</span>

<span class="c1"># Call</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">alphabeta</span><span class="p">(</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">get_moves</span><span class="p">,</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">is_terminal</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="5-tic-tac-toe-example">5. Tic-Tac-Toe Example<a class="header-link" href="#5-tic-tac-toe-example" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TicTacToe</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39; &#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_moves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">moves</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">moves</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">moves</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_player</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span> <span class="k">else</span> <span class="s1">&#39;X&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">undo_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span> <span class="k">else</span> <span class="s1">&#39;X&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_winner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Check rows, columns, diagonals</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>  <span class="c1"># Row</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>  <span class="c1"># Column</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>      <span class="c1"># Diagonal</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>    <span class="c1"># Anti-diagonal</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_winner</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_moves</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">winner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_winner</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">minimax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_maximizing</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_maximizing</span><span class="p">:</span>
            <span class="n">best</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moves</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_move</span><span class="p">(</span><span class="o">*</span><span class="n">move</span><span class="p">)</span>
                <span class="n">best</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">best</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimax</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undo_move</span><span class="p">(</span><span class="o">*</span><span class="n">move</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">best</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">best</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moves</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">make_move</span><span class="p">(</span><span class="o">*</span><span class="n">move</span><span class="p">)</span>
                <span class="n">best</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">best</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimax</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undo_move</span><span class="p">(</span><span class="o">*</span><span class="n">move</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">best</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">best_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find optimal move for current player&quot;&quot;&quot;</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
        <span class="n">best_move</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">is_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span>

        <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moves</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_move</span><span class="p">(</span><span class="o">*</span><span class="n">move</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimax</span><span class="p">(</span><span class="ow">not</span> <span class="n">is_max</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undo_move</span><span class="p">(</span><span class="o">*</span><span class="n">move</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">is_max</span> <span class="ow">and</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">best_move</span> <span class="o">=</span> <span class="n">move</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_max</span> <span class="ow">and</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">best_move</span> <span class="o">=</span> <span class="n">move</span>

        <span class="k">return</span> <span class="n">best_move</span>

<span class="c1"># Usage example</span>
<span class="n">game</span> <span class="o">=</span> <span class="n">TicTacToe</span><span class="p">()</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">game</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">():</span>
    <span class="n">move</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">best_move</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">game</span><span class="o">.</span><span class="n">current_player</span><span class="si">}</span><span class="s2"> plays at </span><span class="si">{</span><span class="n">move</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">game</span><span class="o">.</span><span class="n">make_move</span><span class="p">(</span><span class="o">*</span><span class="n">move</span><span class="p">)</span>

<span class="n">winner</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">check_winner</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Winner: </span><span class="si">{</span><span class="n">winner</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">winner</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Draw&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6-practical-problem-patterns">6. Practical Problem Patterns<a class="header-link" href="#6-practical-problem-patterns" title="Permanent link">&para;</a></h2>
<h3 id="pattern-1-simple-winloss-games">Pattern 1: Simple Win/Loss Games<a class="header-link" href="#pattern-1-simple-winloss-games" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simple_game_winner</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    n stones, take 1-3 at a time</span>
<span class="sd">    Last to take wins</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">!=</span> <span class="mi">0</span>

<span class="c1"># Solve quickly with Grundy pattern</span>
</code></pre></div>

<h3 id="pattern-2-multi-pile-games">Pattern 2: Multi-Pile Games<a class="header-link" href="#pattern-2-multi-pile-games" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">multi_pile_game</span><span class="p">(</span><span class="n">piles</span><span class="p">,</span> <span class="n">max_take</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take 1~max_take from each pile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Grundy for each pile = pile % (max_take + 1)</span>
    <span class="n">xor_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pile</span> <span class="ow">in</span> <span class="n">piles</span><span class="p">:</span>
        <span class="n">xor_sum</span> <span class="o">^=</span> <span class="p">(</span><span class="n">pile</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_take</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">xor_sum</span> <span class="o">!=</span> <span class="mi">0</span>
</code></pre></div>

<h3 id="pattern-3-graph-games">Pattern 3: Graph Games<a class="header-link" href="#pattern-3-graph-games" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">graph_game</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Token movement game on graph</span>
<span class="sd">    Lose if cannot move</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">adj</span><span class="p">)</span>
    <span class="n">grundy</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calc_grundy</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">grundy</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">grundy</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">adj</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>  <span class="c1"># Cannot move</span>
            <span class="n">grundy</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">reachable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">next_node</span> <span class="ow">in</span> <span class="n">adj</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="n">reachable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">calc_grundy</span><span class="p">(</span><span class="n">next_node</span><span class="p">))</span>

        <span class="n">mex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">mex</span> <span class="ow">in</span> <span class="n">reachable</span><span class="p">:</span>
            <span class="n">mex</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">grundy</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">mex</span>
        <span class="k">return</span> <span class="n">mex</span>

    <span class="k">return</span> <span class="n">calc_grundy</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</code></pre></div>

<h3 id="pattern-4-game-splitting">Pattern 4: Game Splitting<a class="header-link" href="#pattern-4-game-splitting" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">split_game</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split n stones into two non-empty piles</span>
<span class="sd">    Lose if cannot split</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">grundy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">reachable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Split i into j and i-j</span>
            <span class="n">reachable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">grundy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">^</span> <span class="n">grundy</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">])</span>

        <span class="n">mex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">mex</span> <span class="ow">in</span> <span class="n">reachable</span><span class="p">:</span>
            <span class="n">mex</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">grundy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mex</span>

    <span class="k">return</span> <span class="n">grundy</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
</code></pre></div>

<hr />
<h2 id="7-advanced-techniques">7. Advanced Techniques<a class="header-link" href="#7-advanced-techniques" title="Permanent link">&para;</a></h2>
<h3 id="nimber-multiplication">Nimber Multiplication<a class="header-link" href="#nimber-multiplication" title="Permanent link">&para;</a></h3>
<p>Nimbers define multiplication in addition to addition (XOR).</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">nim_multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Nimber multiplication (for small numbers)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

    <span class="c1"># Power of 2 decomposition</span>
    <span class="n">highest_a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">highest_b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">highest_a</span> <span class="o">&gt;</span> <span class="n">highest_b</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
        <span class="n">highest_a</span><span class="p">,</span> <span class="n">highest_b</span> <span class="o">=</span> <span class="n">highest_b</span><span class="p">,</span> <span class="n">highest_a</span>

    <span class="k">if</span> <span class="n">highest_a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

    <span class="c1"># Recursive calculation (complex, usually use table)</span>
    <span class="c1"># Simplified version only handles simple cases</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>  <span class="c1"># Actually more complex</span>
</code></pre></div>

<h3 id="game-tree-storage">Game Tree Storage<a class="header-link" href="#game-tree-storage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GameTree</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">get_next</span><span class="p">,</span> <span class="n">hash_state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Game tree search with memoization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">hash_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">h</span><span class="p">]</span>

        <span class="n">next_states</span> <span class="o">=</span> <span class="n">get_next</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">next_states</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># No move = lose</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If any next state is losing, current is winning</span>
        <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">next_states</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">get_next</span><span class="p">,</span> <span class="n">hash_state</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>

<hr />
<h2 id="8-time-complexity-summary">8. Time Complexity Summary<a class="header-link" href="#8-time-complexity-summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Time Complexity</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nim game</td>
<td>O(n)</td>
<td>n = number of piles</td>
</tr>
<tr>
<td>Grundy calculation</td>
<td>O(states Ã— branches)</td>
<td>Memoization essential</td>
</tr>
<tr>
<td>Minimax</td>
<td>O(b^d)</td>
<td>b = branching, d = depth</td>
</tr>
<tr>
<td>Alpha-beta</td>
<td>O(b^(d/2)) ~ O(b^d)</td>
<td>Best with optimal ordering</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9-common-mistakes">9. Common Mistakes<a class="header-link" href="#9-common-mistakes" title="Permanent link">&para;</a></h2>
<h3 id="mistake-1-mex-calculation-error">Mistake 1: mex Calculation Error<a class="header-link" href="#mistake-1-mex-calculation-error" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Incorrect: finding minimum</span>
<span class="n">mex</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">grundy_set</span><span class="p">)</span>

<span class="c1"># Correct: smallest non-negative not in set</span>
<span class="n">mex</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">mex</span> <span class="ow">in</span> <span class="n">grundy_set</span><span class="p">:</span>
    <span class="n">mex</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>

<h3 id="mistake-2-xor-operator-precedence">Mistake 2: XOR Operator Precedence<a class="header-link" href="#mistake-2-xor-operator-precedence" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Incorrect</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">^</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># Not (a ^ b) == 0!</span>

<span class="c1"># Correct</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div>

<h3 id="mistake-3-terminal-condition">Mistake 3: Terminal Condition<a class="header-link" href="#mistake-3-terminal-condition" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># No possible moves means Grundy = 0</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">next_states</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># Losing state</span>
</code></pre></div>

<hr />
<h2 id="10-practice-problems">10. Practice Problems<a class="header-link" href="#10-practice-problems" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Difficulty</th>
<th>Problem Type</th>
<th>Key Concept</th>
</tr>
</thead>
<tbody>
<tr>
<td>â˜…â˜…â˜†</td>
<td>Stone taking</td>
<td>Basic W/L analysis</td>
</tr>
<tr>
<td>â˜…â˜…â˜†</td>
<td>Nim game</td>
<td>XOR application</td>
</tr>
<tr>
<td>â˜…â˜…â˜…</td>
<td>Grundy calculation</td>
<td>mex function</td>
</tr>
<tr>
<td>â˜…â˜…â˜…</td>
<td>Combined games</td>
<td>XOR combination</td>
</tr>
<tr>
<td>â˜…â˜…â˜…â˜…</td>
<td>Minimax</td>
<td>Alpha-beta</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./28_Advanced_DP_Optimization.md">28_Advanced_DP_Optimization.md</a> - Advanced DP optimization</li>
</ul>
<hr />
<h2 id="learning-checklist">Learning Checklist<a class="header-link" href="#learning-checklist" title="Permanent link">&para;</a></h2>
<ol>
<li>Why does XOR sum = 0 mean losing in Nim?</li>
<li>What is the mex function for Grundy numbers?</li>
<li>How to calculate Grundy for combined independent games?</li>
<li>How does alpha-beta pruning work?</li>
</ol>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Algorithm/26_Computational_Geometry.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">27. Computational Geometry</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Algorithm/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Algorithm/28_Advanced_DP_Optimization.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">29. Advanced DP Optimization</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}