{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Bit Operations - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/C_Programming/">C Programming</a>
    <span class="separator">/</span>
    <span class="current">Advanced Bit Operations</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Advanced Bit Operations</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/C_Programming/14_Embedded_Basics.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Embedded Programming Basics</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/C_Programming/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/C_Programming/16_Project_GPIO_Control.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Project 15: GPIO Control</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#1-why-are-bit-operations-important">1. Why Are Bit Operations Important?</a><ul>
<li><a href="#why-bit-operations-are-essential-in-embedded-systems">Why Bit Operations Are Essential in Embedded Systems</a></li>
<li><a href="#example-led-control-register">Example: LED Control Register</a></li>
</ul>
</li>
<li><a href="#2-bit-operators-review">2. Bit Operators Review</a><ul>
<li><a href="#basic-bit-operators">Basic Bit Operators</a></li>
<li><a href="#operator-truth-tables">Operator Truth Tables</a></li>
</ul>
</li>
<li><a href="#3-bit-masking-techniques">3. Bit Masking Techniques</a><ul>
<li><a href="#31-reading-specific-bit-get">3.1 Reading Specific Bit (GET)</a></li>
<li><a href="#32-setting-specific-bit-set">3.2 Setting Specific Bit (SET)</a></li>
<li><a href="#33-clearing-specific-bit-clear">3.3 Clearing Specific Bit (CLEAR)</a></li>
<li><a href="#34-toggling-specific-bit-toggle">3.4 Toggling Specific Bit (TOGGLE)</a></li>
<li><a href="#35-bit-mask-utility-header">3.5 Bit Mask Utility Header</a></li>
</ul>
</li>
<li><a href="#4-flag-management">4. Flag Management</a><ul>
<li><a href="#flag-definition">Flag Definition</a></li>
<li><a href="#flag-usage-example-in-arduino">Flag Usage Example in Arduino</a></li>
</ul>
</li>
<li><a href="#5-register-concepts">5. Register Concepts</a><ul>
<li><a href="#what-are-mcu-registers">What are MCU Registers?</a></li>
<li><a href="#arduino-functions-vs-direct-register-control">Arduino Functions vs Direct Register Control</a></li>
<li><a href="#speed-comparison">Speed Comparison</a></li>
<li><a href="#direct-register-access-example">Direct Register Access Example</a></li>
</ul>
</li>
<li><a href="#6-volatile-keyword">6. volatile Keyword</a><ul>
<li><a href="#why-volatile-is-needed">Why volatile is Needed</a></li>
<li><a href="#using-volatile">Using volatile</a></li>
<li><a href="#meaning-of-volatile">Meaning of volatile</a></li>
<li><a href="#using-volatile-in-arduino">Using volatile in Arduino</a></li>
<li><a href="#registers-and-volatile">Registers and volatile</a></li>
</ul>
</li>
<li><a href="#7-practice-bit-manipulation-utilities">7. Practice: Bit Manipulation Utilities</a><ul>
<li><a href="#bit-counter">Bit Counter</a></li>
<li><a href="#bit-reverse">Bit Reverse</a></li>
<li><a href="#bit-swap">Bit Swap</a></li>
<li><a href="#arduino-bit-manipulation-example">Arduino Bit Manipulation Example</a></li>
</ul>
</li>
<li><a href="#exercises">Exercises</a><ul>
<li><a href="#exercise-1-bit-field-extraction">Exercise 1: Bit Field Extraction</a></li>
<li><a href="#exercise-2-power-of-two-check">Exercise 2: Power of Two Check</a></li>
<li><a href="#exercise-3-parity-bit">Exercise 3: Parity Bit</a></li>
<li><a href="#exercise-4-arduino-led-bar">Exercise 4: Arduino LED Bar</a></li>
</ul>
</li>
<li><a href="#key-concepts-summary">Key Concepts Summary</a></li>
<li><a href="#next-steps">Next Steps</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="advanced-bit-operations">Advanced Bit Operations<a class="header-link" href="#advanced-bit-operations" title="Permanent link">&para;</a></h1>
<p>Master bit-level manipulation, which is essential for embedded programming.</p>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Perfect understanding of bit operators</li>
<li>Master bit masking techniques</li>
<li>Understand register control concepts</li>
<li>Understand volatile keyword</li>
</ul>
<h2 id="prerequisites">Prerequisites<a class="header-link" href="#prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>C language basic syntax</li>
<li>Binary and hexadecimal representation</li>
</ul>
<hr />
<h2 id="1-why-are-bit-operations-important">1. Why Are Bit Operations Important?<a class="header-link" href="#1-why-are-bit-operations-important" title="Permanent link">&para;</a></h2>
<h3 id="why-bit-operations-are-essential-in-embedded-systems">Why Bit Operations Are Essential in Embedded Systems<a class="header-link" href="#why-bit-operations-are-essential-in-embedded-systems" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Register</span><span class="w"> </span><span class="kr">Cont</span><span class="n">rol</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="n">MCU</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="kr">cont</span><span class="n">rolled</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">registers</span><span class="w"> </span><span class="p">(</span><span class="n">special</span><span class="w"> </span><span class="n">memory</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Each</span><span class="w"> </span><span class="n">bit</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">register</span><span class="w"> </span><span class="kr">cont</span><span class="n">rols</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">function</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Memory</span><span class="w"> </span><span class="n">Conservation</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Embedded</span><span class="w"> </span><span class="kr">sys</span><span class="n">tems</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">limited</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">KB</span><span class="w"> </span><span class="n">range</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mf">8</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="n">byte</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">Communication</span><span class="w"> </span><span class="n">Protocols</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Need</span><span class="w"> </span><span class="n">bit</span><span class="o">-</span><span class="n">level</span><span class="w"> </span><span class="nb">int</span><span class="n">erpretation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="kd">data</span><span class="w"> </span><span class="n">packets</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">Performance</span><span class="w"> </span><span class="n">Optimization</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Bit</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fastest</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="kr">on</span><span class="w"> </span><span class="n">CPU</span>
</code></pre></div>

<h3 id="example-led-control-register">Example: LED Control Register<a class="header-link" href="#example-led-control-register" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Arduino Uno Port B Register (pins 8~13)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PORTB = 0b00100000                        ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  Bit:   7    6    5    4    3    2    1    0‚îÇ
‚îÇ        [ ]  [ ]  [1]  [ ]  [ ]  [ ]  [ ]  [ ]‚îÇ
‚îÇ              ‚îÇ    ‚îÇ    ‚îÇ    ‚îÇ    ‚îÇ    ‚îÇ    ‚îÇ ‚îÇ
‚îÇ              ‚îÇ   Pin13Pin12Pin11Pin10Pin9 Pin8‚îÇ
‚îÇ              ‚îÇ    ‚Üì                         ‚îÇ
‚îÇ              ‚îÇ   LED ON (Pin 13)            ‚îÇ
‚îÇ              ‚îÇ                              ‚îÇ
‚îÇ  Bit 5 = 1 ‚Üí HIGH output on pin 13        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<hr />
<h2 id="2-bit-operators-review">2. Bit Operators Review<a class="header-link" href="#2-bit-operators-review" title="Permanent link">&para;</a></h2>
<h3 id="basic-bit-operators">Basic Bit Operators<a class="header-link" href="#basic-bit-operators" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// bitwise_operators.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">print_binary</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Space for readability</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b11001010</span><span class="p">;</span><span class="w">  </span><span class="c1">// 202</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b10110011</span><span class="p">;</span><span class="w">  </span><span class="c1">// 179</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;a        = &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">print_binary</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1100 1010</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;b        = &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">print_binary</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1011 0011</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// AND (&amp;): 1 only when both are 1</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;a &amp; b    = &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">print_binary</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">   </span><span class="c1">// 1000 0010</span>

<span class="w">    </span><span class="c1">// OR (|): 1 if either is 1</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;a | b    = &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">print_binary</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">   </span><span class="c1">// 1111 1011</span>

<span class="w">    </span><span class="c1">// XOR (^): 1 if different</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;a ^ b    = &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">print_binary</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">   </span><span class="c1">// 0111 1001</span>

<span class="w">    </span><span class="c1">// NOT (~): Bit inversion</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;~a       = &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">print_binary</span><span class="p">(</span><span class="o">~</span><span class="n">a</span><span class="p">);</span><span class="w">      </span><span class="c1">// 0011 0101</span>

<span class="w">    </span><span class="c1">// Left Shift (&lt;&lt;): Shift left, fill with 0</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;a &lt;&lt; 2   = &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">print_binary</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">  </span><span class="c1">// 0010 1000</span>

<span class="w">    </span><span class="c1">// Right Shift (&gt;&gt;): Shift right</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;a &gt;&gt; 2   = &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">print_binary</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">  </span><span class="c1">// 0011 0010</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="operator-truth-tables">Operator Truth Tables<a class="header-link" href="#operator-truth-tables" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>AND (&amp;)          OR (|)           XOR (^)
A  B  A&amp;B        A  B  A|B        A  B  A^B
0  0   0         0  0   0         0  0   0
0  1   0         0  1   1         0  1   1
1  0   0         1  0   1         1  0   1
1  1   1         1  1   1         1  1   0
</code></pre></div>

<hr />
<h2 id="3-bit-masking-techniques">3. Bit Masking Techniques<a class="header-link" href="#3-bit-masking-techniques" title="Permanent link">&para;</a></h2>
<h3 id="31-reading-specific-bit-get">3.1 Reading Specific Bit (GET)<a class="header-link" href="#31-reading-specific-bit-get" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Check value of specific bit</span>
<span class="c1">// Method: (value &gt;&gt; bit) &amp; 1</span>

<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b10110100</span><span class="p">;</span>

<span class="c1">// Read bit 2</span>
<span class="kt">int</span><span class="w"> </span><span class="n">bit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">reg</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Result: 1</span>

<span class="c1">// Read bit 3</span>
<span class="kt">int</span><span class="w"> </span><span class="n">bit3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">reg</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Result: 0</span>

<span class="c1">// Define as macro</span>
<span class="cp">#define GET_BIT(value, bit) (((value) &gt;&gt; (bit)) &amp; 1)</span>

<span class="c1">// Usage example</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GET_BIT</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Bit 5 is set</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="32-setting-specific-bit-set">3.2 Setting Specific Bit (SET)<a class="header-link" href="#32-setting-specific-bit-set" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Set specific bit to 1</span>
<span class="c1">// Method: value |= (1 &lt;&lt; bit)</span>

<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b10100000</span><span class="p">;</span>

<span class="c1">// Set bit 3 to 1</span>
<span class="n">reg</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">  </span><span class="c1">// Result: 0b10101000</span>

<span class="c1">// Set multiple bits simultaneously</span>
<span class="n">reg</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">  </span><span class="c1">// Set bits 1, 4</span>

<span class="c1">// Define as macro</span>
<span class="cp">#define SET_BIT(value, bit) ((value) |= (1 &lt;&lt; (bit)))</span>

<span class="c1">// Usage example</span>
<span class="n">SET_BIT</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span><span class="w">  </span><span class="c1">// Set bit 6</span>
</code></pre></div>

<p><strong>How it works:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kt">reg</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">1010</span><span class="w"> </span><span class="mh">0000</span>
<span class="mh">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mh">3</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">0000</span><span class="w"> </span><span class="mh">1000</span>
<span class="w">           </span><span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><span class="w"> </span><span class="n">OR</span>
<span class="n">result</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">1010</span><span class="w"> </span><span class="mh">1000</span>
</code></pre></div>

<h3 id="33-clearing-specific-bit-clear">3.3 Clearing Specific Bit (CLEAR)<a class="header-link" href="#33-clearing-specific-bit-clear" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Clear specific bit to 0</span>
<span class="c1">// Method: value &amp;= ~(1 &lt;&lt; bit)</span>

<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b11111111</span><span class="p">;</span>

<span class="c1">// Clear bit 5 to 0</span>
<span class="n">reg</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// Result: 0b11011111</span>

<span class="c1">// Define as macro</span>
<span class="cp">#define CLEAR_BIT(value, bit) ((value) &amp;= ~(1 &lt;&lt; (bit)))</span>

<span class="c1">// Usage example</span>
<span class="n">CLEAR_BIT</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">  </span><span class="c1">// Clear bit 2</span>
</code></pre></div>

<p><strong>How it works:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kt">reg</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">1111</span><span class="w"> </span><span class="mh">1111</span>
<span class="mh">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mh">5</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">0010</span><span class="w"> </span><span class="mh">0000</span>
<span class="o">~</span><span class="p">(</span><span class="mh">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mh">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1101</span><span class="w"> </span><span class="mh">1111</span>
<span class="w">           </span><span class="err">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><span class="w"> </span><span class="n">AND</span>
<span class="n">result</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">1101</span><span class="w"> </span><span class="mh">1111</span>
</code></pre></div>

<h3 id="34-toggling-specific-bit-toggle">3.4 Toggling Specific Bit (TOGGLE)<a class="header-link" href="#34-toggling-specific-bit-toggle" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Toggle specific bit (0‚Üí1, 1‚Üí0)</span>
<span class="c1">// Method: value ^= (1 &lt;&lt; bit)</span>

<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b10101010</span><span class="p">;</span>

<span class="c1">// Toggle bit 4</span>
<span class="n">reg</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">  </span><span class="c1">// Result: 0b10111010 (0‚Üí1)</span>
<span class="n">reg</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">  </span><span class="c1">// Result: 0b10101010 (1‚Üí0)</span>

<span class="c1">// Define as macro</span>
<span class="cp">#define TOGGLE_BIT(value, bit) ((value) ^= (1 &lt;&lt; (bit)))</span>

<span class="c1">// Usage example: LED toggle</span>
<span class="n">TOGGLE_BIT</span><span class="p">(</span><span class="n">PORTB</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// Toggle pin 13 LED</span>
</code></pre></div>

<h3 id="35-bit-mask-utility-header">3.5 Bit Mask Utility Header<a class="header-link" href="#35-bit-mask-utility-header" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// bit_utils.h</span>
<span class="cp">#ifndef BIT_UTILS_H</span>
<span class="cp">#define BIT_UTILS_H</span>

<span class="c1">// Bit manipulation macros</span>
<span class="cp">#define BIT(n)                  (1 &lt;&lt; (n))</span>
<span class="cp">#define SET_BIT(reg, bit)       ((reg) |= BIT(bit))</span>
<span class="cp">#define CLEAR_BIT(reg, bit)     ((reg) &amp;= ~BIT(bit))</span>
<span class="cp">#define TOGGLE_BIT(reg, bit)    ((reg) ^= BIT(bit))</span>
<span class="cp">#define GET_BIT(reg, bit)       (((reg) &gt;&gt; (bit)) &amp; 1)</span>
<span class="cp">#define CHECK_BIT(reg, bit)     ((reg) &amp; BIT(bit))</span>

<span class="c1">// Multiple bit operations</span>
<span class="cp">#define SET_BITS(reg, mask)     ((reg) |= (mask))</span>
<span class="cp">#define CLEAR_BITS(reg, mask)   ((reg) &amp;= ~(mask))</span>
<span class="cp">#define TOGGLE_BITS(reg, mask)  ((reg) ^= (mask))</span>

<span class="c1">// Bit field operations</span>
<span class="cp">#define GET_FIELD(reg, mask, shift)     (((reg) &amp; (mask)) &gt;&gt; (shift))</span>
<span class="cp">#define SET_FIELD(reg, mask, shift, val) \</span>
<span class="cp">    ((reg) = ((reg) &amp; ~(mask)) | (((val) &lt;&lt; (shift)) &amp; (mask)))</span>

<span class="cp">#endif</span>
</code></pre></div>

<hr />
<h2 id="4-flag-management">4. Flag Management<a class="header-link" href="#4-flag-management" title="Permanent link">&para;</a></h2>
<p>Manage multiple states in a single variable.</p>
<h3 id="flag-definition">Flag Definition<a class="header-link" href="#flag-definition" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// flags.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>

<span class="c1">// Assign meaning to each bit</span>
<span class="cp">#define FLAG_RUNNING    (1 &lt;&lt; 0)  </span><span class="c1">// Bit 0: Running</span>
<span class="cp">#define FLAG_ERROR      (1 &lt;&lt; 1)  </span><span class="c1">// Bit 1: Error occurred</span>
<span class="cp">#define FLAG_CONNECTED  (1 &lt;&lt; 2)  </span><span class="c1">// Bit 2: Connected</span>
<span class="cp">#define FLAG_READY      (1 &lt;&lt; 3)  </span><span class="c1">// Bit 3: Ready</span>
<span class="cp">#define FLAG_BUSY       (1 &lt;&lt; 4)  </span><span class="c1">// Bit 4: Busy</span>
<span class="cp">#define FLAG_TIMEOUT    (1 &lt;&lt; 5)  </span><span class="c1">// Bit 5: Timeout</span>

<span class="c1">// Global status flags</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">system_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// Set flag</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">set_flag</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">system_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">flag</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Clear flag</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">clear_flag</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">system_flags</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">flag</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Check flag</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">is_flag_set</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">system_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Toggle flag</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">toggle_flag</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">system_flags</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">flag</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// System start</span>
<span class="w">    </span><span class="n">set_flag</span><span class="p">(</span><span class="n">FLAG_RUNNING</span><span class="p">);</span>
<span class="w">    </span><span class="n">set_flag</span><span class="p">(</span><span class="n">FLAG_READY</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;FLAGS: 0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">system_flags</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Check status</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_flag_set</span><span class="p">(</span><span class="n">FLAG_RUNNING</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;System running</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_flag_set</span><span class="p">(</span><span class="n">FLAG_ERROR</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error occurred!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Normal operation</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Error occurs</span>
<span class="w">    </span><span class="n">set_flag</span><span class="p">(</span><span class="n">FLAG_ERROR</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;After setting error flag: 0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">system_flags</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Error resolved</span>
<span class="w">    </span><span class="n">clear_flag</span><span class="p">(</span><span class="n">FLAG_ERROR</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;After clearing error flag: 0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">system_flags</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="flag-usage-example-in-arduino">Flag Usage Example in Arduino<a class="header-link" href="#flag-usage-example-in-arduino" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// arduino_flags.ino</span>

<span class="c1">// Status flags</span>
<span class="cp">#define STATE_IDLE      0x00</span>
<span class="cp">#define STATE_RUNNING   0x01</span>
<span class="cp">#define STATE_PAUSED    0x02</span>
<span class="cp">#define STATE_ERROR     0x04</span>

<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">deviceState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STATE_IDLE</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Process serial commands</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;r&#39;</span><span class="p">:</span><span class="w">  </span><span class="c1">// Run</span>
<span class="w">                </span><span class="n">deviceState</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">STATE_RUNNING</span><span class="p">;</span>
<span class="w">                </span><span class="n">deviceState</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">STATE_PAUSED</span><span class="p">;</span>
<span class="w">                </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Running&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;p&#39;</span><span class="p">:</span><span class="w">  </span><span class="c1">// Pause</span>
<span class="w">                </span><span class="n">deviceState</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">STATE_PAUSED</span><span class="p">;</span>
<span class="w">                </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Paused&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;s&#39;</span><span class="p">:</span><span class="w">  </span><span class="c1">// Stop</span>
<span class="w">                </span><span class="n">deviceState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STATE_IDLE</span><span class="p">;</span>
<span class="w">                </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Stopped&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>

<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;e&#39;</span><span class="p">:</span><span class="w">  </span><span class="c1">// Error toggle</span>
<span class="w">                </span><span class="n">deviceState</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">STATE_ERROR</span><span class="p">;</span>
<span class="w">                </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Error toggled&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Print status</span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;State: 0x&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">deviceState</span><span class="p">,</span><span class="w"> </span><span class="n">HEX</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// LED control based on status</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">deviceState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">STATE_ERROR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Error: Fast blinking</span>
<span class="w">        </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span>
<span class="w">        </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span>
<span class="w">        </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">deviceState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">STATE_RUNNING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">deviceState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">STATE_PAUSED</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Running: Slow blinking</span>
<span class="w">            </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span>
<span class="w">            </span><span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="w">            </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span>
<span class="w">            </span><span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Idle: LED off</span>
<span class="w">        </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="5-register-concepts">5. Register Concepts<a class="header-link" href="#5-register-concepts" title="Permanent link">&para;</a></h2>
<h3 id="what-are-mcu-registers">What are MCU Registers?<a class="header-link" href="#what-are-mcu-registers" title="Permanent link">&para;</a></h3>
<p>Registers are special memory locations inside the MCU that control hardware.</p>
<div class="highlight"><pre><span></span><code><span class="n">Arduino</span><span class="w"> </span><span class="n">Uno</span><span class="w"> </span><span class="p">(</span><span class="n">ATmega328P</span><span class="p">)</span><span class="w"> </span><span class="n">GPIO</span><span class="o">-</span><span class="n">related</span><span class="w"> </span><span class="nl">registers:</span>

<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">DDRx</span><span class="w"> </span><span class="p">(</span><span class="n">Data</span><span class="w"> </span><span class="n">Direction</span><span class="w"> </span><span class="n">Register</span><span class="p">)</span><span class="w">                      </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">pin</span><span class="w"> </span><span class="k">input</span><span class="o">/</span><span class="k">output</span><span class="w"> </span><span class="n">direction</span><span class="w">                    </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">(</span><span class="n">INPUT</span><span class="p">)</span><span class="w">                                 </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="p">(</span><span class="n">OUTPUT</span><span class="p">)</span><span class="w">                               </span><span class="err">‚îÇ</span>
<span class="err">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">PORTx</span><span class="w"> </span><span class="p">(</span><span class="n">Port</span><span class="w"> </span><span class="n">Output</span><span class="w"> </span><span class="n">Register</span><span class="p">)</span><span class="w">                        </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Output</span><span class="w"> </span><span class="nl">mode:</span><span class="w"> </span><span class="n">HIGH</span><span class="o">/</span><span class="n">LOW</span><span class="w"> </span><span class="k">output</span><span class="w">                      </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Input</span><span class="w"> </span><span class="nl">mode:</span><span class="w"> </span><span class="n">Enable</span><span class="w"> </span><span class="n">pull</span><span class="o">-</span><span class="n">up</span><span class="w"> </span><span class="n">resistor</span><span class="w">               </span><span class="err">‚îÇ</span>
<span class="err">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">PINx</span><span class="w"> </span><span class="p">(</span><span class="n">Port</span><span class="w"> </span><span class="n">Input</span><span class="w"> </span><span class="n">Register</span><span class="p">)</span><span class="w">                          </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Read</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">pin</span><span class="w"> </span><span class="n">status</span><span class="w">                           </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">(</span><span class="n">pins</span><span class="w"> </span><span class="mh">8</span><span class="o">~</span><span class="mh">13</span><span class="p">),</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">(</span><span class="n">analog</span><span class="w"> </span><span class="n">pins</span><span class="p">),</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="p">(</span><span class="n">pins</span><span class="w"> </span><span class="mh">0</span><span class="o">~</span><span class="mh">7</span><span class="p">)</span>
</code></pre></div>

<h3 id="arduino-functions-vs-direct-register-control">Arduino Functions vs Direct Register Control<a class="header-link" href="#arduino-functions-vs-direct-register-control" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Using Arduino library (convenient but slow)</span>
<span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPUT</span><span class="p">);</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span>

<span class="c1">// Direct register control (fast)</span>
<span class="n">DDRB</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">   </span><span class="c1">// Set pin 13 as output</span>
<span class="n">PORTB</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// Pin 13 HIGH</span>
<span class="n">PORTB</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// Pin 13 LOW</span>
</code></pre></div>

<h3 id="speed-comparison">Speed Comparison<a class="header-link" href="#speed-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// speed_compare.ino</span>
<span class="c1">// digitalWrite vs direct register</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="w">    </span><span class="n">DDRB</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// Set pin 13 as output</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Measure digitalWrite speed</span>
<span class="w">    </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micros</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span>
<span class="w">        </span><span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micros</span><span class="p">();</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;digitalWrite: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; us&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Measure direct register speed</span>
<span class="w">    </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micros</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PORTB</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w">        </span><span class="n">PORTB</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micros</span><span class="p">();</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Direct register: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; us&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Example results:</span>
<span class="c1">// digitalWrite: 625000 us</span>
<span class="c1">// Direct register: 12500 us</span>
<span class="c1">// ‚Üí Direct control is about 50x faster!</span>
</code></pre></div>

<h3 id="direct-register-access-example">Direct Register Access Example<a class="header-link" href="#direct-register-access-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// register_access.ino</span>
<span class="c1">// LED control using registers</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// DDRB: Data Direction Register B</span>
<span class="w">    </span><span class="c1">// Bit 5 = 1 ‚Üí Pin 13 output mode</span>
<span class="w">    </span><span class="n">DDRB</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">DDB5</span><span class="p">);</span>

<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Register control demo&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Toggle bit 5 of PORTB register</span>
<span class="w">    </span><span class="n">PORTB</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">PORTB5</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Read current status with PINB register</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PINB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">PINB5</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;LED ON&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;LED OFF&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="6-volatile-keyword">6. volatile Keyword<a class="header-link" href="#6-volatile-keyword" title="Permanent link">&para;</a></h2>
<h3 id="why-volatile-is-needed">Why volatile is Needed<a class="header-link" href="#why-volatile-is-needed" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Problem: Compiler optimization</span>

<span class="kt">int</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// Interrupt handler (called by hardware)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">interrupt_handler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Wait</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Execute here when flag becomes 1</span>
<span class="p">}</span>
</code></pre></div>

<p>The compiler may determine that <code>flag</code> doesn't change inside the loop and optimize:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Compiler-optimized code (problem!)</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c1">// Converted to infinite loop</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="using-volatile">Using volatile<a class="header-link" href="#using-volatile" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Solution: Use volatile keyword</span>
<span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">interrupt_handler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Read flag value from memory every time</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Normal operation</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="meaning-of-volatile">Meaning of volatile<a class="header-link" href="#meaning-of-volatile" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">volatile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;unpredictable&quot;</span>

<span class="n">Tells</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">compiler</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="n">externally</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">time</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Don</span><span class="s1">&#39;t optimize, always read from memory</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Don</span><span class="s1">&#39;t cache in register</span>
</code></pre></div>

<h3 id="using-volatile-in-arduino">Using volatile in Arduino<a class="header-link" href="#using-volatile-in-arduino" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// volatile_example.ino</span>
<span class="c1">// Interrupts and volatile</span>

<span class="k">volatile</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">buttonPressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BUTTON_PIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">LED_PIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>

<span class="c1">// Interrupt Service Routine (ISR)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">buttonISR</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">buttonPressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">BUTTON_PIN</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT_PULLUP</span><span class="p">);</span>
<span class="w">    </span><span class="n">pinMode</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPUT</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Attach interrupt to pin 2 (FALLING = HIGH‚ÜíLOW)</span>
<span class="w">    </span><span class="n">attachInterrupt</span><span class="p">(</span><span class="n">digitalPinToInterrupt</span><span class="p">(</span><span class="n">BUTTON_PIN</span><span class="p">),</span><span class="w"> </span><span class="n">buttonISR</span><span class="p">,</span><span class="w"> </span><span class="n">FALLING</span><span class="p">);</span>

<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">buttonPressed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Button pressed!&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">));</span><span class="w">  </span><span class="c1">// Toggle LED</span>

<span class="w">        </span><span class="n">buttonPressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// Reset flag</span>
<span class="w">        </span><span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span><span class="w">  </span><span class="c1">// Debounce</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="registers-and-volatile">Registers and volatile<a class="header-link" href="#registers-and-volatile" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// MCU registers are always volatile</span>
<span class="c1">// Because hardware can change the value</span>

<span class="c1">// Actual Arduino header file definition (avr/io.h)</span>
<span class="cp">#define PORTB (*(volatile uint8_t *)0x25)</span>
<span class="cp">#define DDRB  (*(volatile uint8_t *)0x24)</span>
<span class="cp">#define PINB  (*(volatile uint8_t *)0x23)</span>

<span class="c1">// Explanation:</span>
<span class="c1">// 0x25 = Memory address of PORTB register</span>
<span class="c1">// (volatile uint8_t *) = Cast address to volatile pointer</span>
<span class="c1">// * = Access value at that address</span>
</code></pre></div>

<hr />
<h2 id="7-practice-bit-manipulation-utilities">7. Practice: Bit Manipulation Utilities<a class="header-link" href="#7-practice-bit-manipulation-utilities" title="Permanent link">&para;</a></h2>
<h3 id="bit-counter">Bit Counter<a class="header-link" href="#bit-counter" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// bit_counter.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="c1">// Count number of 1 bits (popcount)</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">count_ones</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Faster method: Brian Kernighan algorithm</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">count_ones_fast</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">n</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// Remove rightmost 1 bit</span>
<span class="w">        </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">test</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mh">0xABCD</span><span class="p">};</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;0x%04X (%5u): %d ones</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="n">test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">count_ones</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="bit-reverse">Bit Reverse<a class="header-link" href="#bit-reverse" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// bit_reverse.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="c1">// Reverse 8 bits</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="nf">reverse_bits</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b10110001</span><span class="p">;</span><span class="w">  </span><span class="c1">// 177</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Original: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (0x%02X)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>

<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">reversed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reverse_bits</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Reversed: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">reversed</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (0x%02X)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">reversed</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="bit-swap">Bit Swap<a class="header-link" href="#bit-swap" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// bit_swap.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="c1">// Swap two bit positions</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="nf">swap_bits</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Only swap if bits at i and j are different</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(((</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">((</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">n</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">j</span><span class="p">);</span><span class="w">  </span><span class="c1">// Toggle both</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Swap upper and lower 4 bits</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="nf">swap_nibbles</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">n</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0F</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="n">n</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xF0</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mb">0b11001010</span><span class="p">;</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Original: 0x%02X (0b%d%d%d%d%d%d%d%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">,</span>
<span class="w">           </span><span class="p">(</span><span class="n">val</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="o">&gt;&gt;</span><span class="mi">6</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,</span>
<span class="w">           </span><span class="p">(</span><span class="n">val</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Swap bits 1 and 6</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">swapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap_bits</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Bits 1,6 swapped: 0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">swapped</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Swap nibbles</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">nibble_swapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap_nibbles</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Nibbles swapped: 0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nibble_swapped</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="arduino-bit-manipulation-example">Arduino Bit Manipulation Example<a class="header-link" href="#arduino-bit-manipulation-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// bit_manipulation.ino</span>
<span class="c1">// Control multiple LEDs with bit manipulation</span>

<span class="c1">// LEDs connected: pins 8, 9, 10, 11 (PORTB bits 0~3)</span>
<span class="cp">#define LED_MASK 0x0F  </span><span class="c1">// Lower 4 bits</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Set pins 8~11 as output</span>
<span class="w">    </span><span class="n">DDRB</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">LED_MASK</span><span class="p">;</span>
<span class="w">    </span><span class="n">PORTB</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">LED_MASK</span><span class="p">;</span><span class="w">  </span><span class="c1">// Turn off all LEDs</span>

<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Bit manipulation demo&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Commands: 0-F (hex), r (rotate), i (invert)&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Digits 0-9: Display pattern</span>
<span class="w">            </span><span class="n">PORTB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PORTB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">LED_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;f&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// a-f: Display patterns 10-15</span>
<span class="w">            </span><span class="n">PORTB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PORTB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">LED_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;F&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// A-F: Display patterns 10-15</span>
<span class="w">            </span><span class="n">PORTB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PORTB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">LED_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;r&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;R&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Left circular shift</span>
<span class="w">            </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">leds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PORTB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">LED_MASK</span><span class="p">;</span>
<span class="w">            </span><span class="n">leds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">leds</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">leds</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">LED_MASK</span><span class="p">;</span>
<span class="w">            </span><span class="n">PORTB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PORTB</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">LED_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">leds</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;i&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;I&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Invert</span>
<span class="w">            </span><span class="n">PORTB</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">LED_MASK</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Print current status</span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;LED pattern: 0b&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="n">PORTB</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="exercises">Exercises<a class="header-link" href="#exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-bit-field-extraction">Exercise 1: Bit Field Extraction<a class="header-link" href="#exercise-1-bit-field-extraction" title="Permanent link">&para;</a></h3>
<p>Write a function to extract bits 2~5 (4 bits) from an 8-bit value.</p>
<div class="highlight"><pre><span></span><code><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="nf">extract_bits</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
<span class="c1">// extract_bits(0b11010110, 2, 4) ‚Üí 0b0101 (5)</span>
</code></pre></div>

<h3 id="exercise-2-power-of-two-check">Exercise 2: Power of Two Check<a class="header-link" href="#exercise-2-power-of-two-check" title="Permanent link">&para;</a></h3>
<p>Write a function using bit operations to check if a number is a power of 2.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">is_power_of_two</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="c1">// is_power_of_two(8) ‚Üí 1 (true)</span>
<span class="c1">// is_power_of_two(6) ‚Üí 0 (false)</span>
</code></pre></div>

<h3 id="exercise-3-parity-bit">Exercise 3: Parity Bit<a class="header-link" href="#exercise-3-parity-bit" title="Permanent link">&para;</a></h3>
<p>Write a function that returns 1 if the number of 1 bits is odd, 0 if even.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">parity</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="c1">// parity(0b10110001) ‚Üí 0 (4 ones = even)</span>
<span class="c1">// parity(0b10110011) ‚Üí 1 (5 ones = odd)</span>
</code></pre></div>

<h3 id="exercise-4-arduino-led-bar">Exercise 4: Arduino LED Bar<a class="header-link" href="#exercise-4-arduino-led-bar" title="Permanent link">&para;</a></h3>
<p>Use 4 LEDs to display values 0~15 in binary, and increment the value by 1 each time a button is pressed.</p>
<hr />
<h2 id="key-concepts-summary">Key Concepts Summary<a class="header-link" href="#key-concepts-summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Set bit</td>
<td><code>val \|= (1 &lt;&lt; n)</code></td>
<td>Set nth bit to 1</td>
</tr>
<tr>
<td>Clear bit</td>
<td><code>val &amp;= ~(1 &lt;&lt; n)</code></td>
<td>Set nth bit to 0</td>
</tr>
<tr>
<td>Toggle bit</td>
<td><code>val ^= (1 &lt;&lt; n)</code></td>
<td>Invert nth bit</td>
</tr>
<tr>
<td>Check bit</td>
<td><code>(val &gt;&gt; n) &amp; 1</code></td>
<td>Get nth bit value</td>
</tr>
<tr>
<td>Lower n bits</td>
<td><code>val &amp; ((1 &lt;&lt; n) - 1)</code></td>
<td>Only lower n bits</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Keyword</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>volatile</td>
<td>Prevent compiler optimization, always read from memory</td>
</tr>
<tr>
<td>register</td>
<td>Request storage in register (hint)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Once you've mastered bit operations, proceed to the next document:
- <a href="16_Project_GPIO_Control.md">16. GPIO Control</a> - Practice with LEDs and buttons</p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/C_Programming/14_Embedded_Basics.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Embedded Programming Basics</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/C_Programming/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/C_Programming/16_Project_GPIO_Control.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Project 15: GPIO Control</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}