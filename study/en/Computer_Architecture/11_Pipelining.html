{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipelining - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Computer_Architecture/">Computer Architecture</a>
    <span class="separator">/</span>
    <span class="current">Pipelining</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Pipelining</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Computer_Architecture/10_Assembly_Language_Basics.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Assembly Language Basics</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Computer_Architecture/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Computer_Architecture/12_Branch_Prediction.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Branch Prediction</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-pipelining-concept">1. Pipelining Concept</a><ul>
<li><a href="#basic-idea">Basic Idea</a></li>
<li><a href="#laundry-analogy">Laundry Analogy</a></li>
</ul>
</li>
<li><a href="#2-5-stage-pipeline">2. 5-Stage Pipeline</a><ul>
<li><a href="#mips-5-stage-pipeline">MIPS 5-Stage Pipeline</a></li>
<li><a href="#stage-descriptions">Stage Descriptions</a></li>
<li><a href="#pipeline-registers">Pipeline Registers</a></li>
<li><a href="#pipeline-usage-by-instruction-type">Pipeline Usage by Instruction Type</a></li>
</ul>
</li>
<li><a href="#3-pipeline-performance">3. Pipeline Performance</a><ul>
<li><a href="#ideal-speedup">Ideal Speedup</a></li>
<li><a href="#throughput-calculation">Throughput Calculation</a></li>
<li><a href="#example-executing-100-instructions">Example: Executing 100 Instructions</a></li>
</ul>
</li>
<li><a href="#4-pipeline-hazards">4. Pipeline Hazards</a><ul>
<li><a href="#hazard-types">Hazard Types</a></li>
<li><a href="#41-structural-hazards">4.1 Structural Hazards</a></li>
<li><a href="#42-data-hazards">4.2 Data Hazards</a></li>
<li><a href="#raw-hazard-example">RAW Hazard Example</a></li>
<li><a href="#43-control-hazards">4.3 Control Hazards</a></li>
</ul>
</li>
<li><a href="#5-hazard-resolution-techniques">5. Hazard Resolution Techniques</a><ul>
<li><a href="#51-stalling">5.1 Stalling</a></li>
<li><a href="#52-forwardingbypassing">5.2 Forwarding/Bypassing</a></li>
<li><a href="#forwarding-paths">Forwarding Paths</a></li>
<li><a href="#53-load-use-hazard">5.3 Load-Use Hazard</a></li>
<li><a href="#54-branch-prediction">5.4 Branch Prediction</a></li>
<li><a href="#55-delayed-branch">5.5 Delayed Branch</a></li>
</ul>
</li>
<li><a href="#6-practice-problems">6. Practice Problems</a><ul>
<li><a href="#basic-problems">Basic Problems</a></li>
<li><a href="#hazard-analysis">Hazard Analysis</a></li>
<li><a href="#performance-calculation">Performance Calculation</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="pipelining">Pipelining<a class="header-link" href="#pipelining" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Pipelining is a technique that increases CPU throughput by executing multiple instructions simultaneously. Like the washer-dryer analogy, the next task starts before the current one finishes, improving overall efficiency.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-pipelining-concept">Pipelining Concept</a></li>
<li><a href="#2-5-stage-pipeline">5-Stage Pipeline</a></li>
<li><a href="#3-pipeline-performance">Pipeline Performance</a></li>
<li><a href="#4-pipeline-hazards">Pipeline Hazards</a></li>
<li><a href="#5-hazard-resolution-techniques">Hazard Resolution Techniques</a></li>
<li><a href="#6-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-pipelining-concept">1. Pipelining Concept<a class="header-link" href="#1-pipelining-concept" title="Permanent link">&para;</a></h2>
<h3 id="basic-idea">Basic Idea<a class="header-link" href="#basic-idea" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Non</span><span class="o">-</span><span class="n">pipelined</span><span class="w"> </span><span class="p">(</span><span class="n">Sequential</span><span class="w"> </span><span class="n">Execution</span><span class="p">)</span><span class="err">:</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">I1</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â–¶â”‚</span><span class="w"> </span><span class="n">I2</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â–¶â”‚</span><span class="w"> </span><span class="n">I3</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”˜</span>
<span class="w">  </span><span class="mi">5</span><span class="n">ns</span><span class="w">         </span><span class="mi">5</span><span class="n">ns</span><span class="w">         </span><span class="mi">5</span><span class="n">ns</span><span class="w">      </span><span class="n">Total</span><span class="w"> </span><span class="mi">15</span><span class="n">ns</span>

<span class="n">Pipelined</span><span class="w"> </span><span class="p">(</span><span class="n">Parallel</span><span class="w"> </span><span class="n">Execution</span><span class="p">)</span><span class="err">:</span>
<span class="nc">Time</span><span class="err">:</span><span class="w">  </span><span class="mi">1</span><span class="n">ns</span><span class="w">   </span><span class="mi">2</span><span class="n">ns</span><span class="w">   </span><span class="mi">3</span><span class="n">ns</span><span class="w">   </span><span class="mi">4</span><span class="n">ns</span><span class="w">   </span><span class="mi">5</span><span class="n">ns</span><span class="w">   </span><span class="mi">6</span><span class="n">ns</span><span class="w">   </span><span class="mi">7</span><span class="n">ns</span>
<span class="nl">I1</span><span class="p">:</span><span class="w">   </span><span class="o">[</span><span class="n">IF</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">ID</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">EX</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">MEM</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">WB</span><span class="o">]</span>
<span class="nl">I2</span><span class="p">:</span><span class="w">        </span><span class="o">[</span><span class="n">IF</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">ID</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">EX</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">MEM</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">WB</span><span class="o">]</span>
<span class="nl">I3</span><span class="p">:</span><span class="w">             </span><span class="o">[</span><span class="n">IF</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">ID</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">EX</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">MEM</span><span class="o">]</span><span class="err">â”€</span><span class="o">[</span><span class="n">WB</span><span class="o">]</span>
<span class="w">                                     </span><span class="n">Total</span><span class="w"> </span><span class="mi">7</span><span class="n">ns</span>
</code></pre></div>

<h3 id="laundry-analogy">Laundry Analogy<a class="header-link" href="#laundry-analogy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Non-pipelined:
Wash1 â”€â”€â–¶ Dry1 â”€â”€â–¶ Wash2 â”€â”€â–¶ Dry2 â”€â”€â–¶ Wash3 â”€â”€â–¶ Dry3

Pipelined:
Time:   1    2    3    4    5    6
Wash1   â– 
Dry1        â– 
Wash2       â– 
Dry2             â– 
Wash3            â– 
Dry3                  â– 

3x faster!
</code></pre></div>

<hr />
<h2 id="2-5-stage-pipeline">2. 5-Stage Pipeline<a class="header-link" href="#2-5-stage-pipeline" title="Permanent link">&para;</a></h2>
<h3 id="mips-5-stage-pipeline">MIPS 5-Stage Pipeline<a class="header-link" href="#mips-5-stage-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="mi">5</span><span class="o">-</span><span class="nv">Stage</span><span class="w"> </span><span class="nv">Pipeline</span><span class="w">                         </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                    </span>â”‚
â”‚<span class="w">  </span><span class="k">IF</span><span class="w">   </span>â”‚<span class="w">  </span><span class="nv">ID</span><span class="w">   </span>â”‚<span class="w">  </span><span class="nv">EX</span><span class="w">   </span>â”‚<span class="w">  </span><span class="nv">MEM</span><span class="w">  </span>â”‚<span class="w">  </span><span class="nv">WB</span><span class="w">   </span>â”‚<span class="w">                    </span>â”‚
â”‚<span class="ss">(</span><span class="nv">Fetch</span><span class="ss">)</span>â”‚<span class="ss">(</span><span class="nv">Decode</span>â”‚<span class="ss">(</span><span class="k">Exec</span><span class="ss">)</span><span class="w"> </span>â”‚<span class="ss">(</span><span class="nv">Memory</span>â”‚<span class="ss">(</span><span class="nv">Write</span><span class="w"> </span>â”‚<span class="w">                    </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">       </span>â”‚<span class="w">       </span>â”‚<span class="nv">Access</span><span class="ss">)</span>â”‚<span class="w"> </span><span class="nv">Back</span><span class="ss">)</span><span class="w"> </span>â”‚<span class="w">                    </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                    </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="stage-descriptions">Stage Descriptions<a class="header-link" href="#stage-descriptions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Stage</th>
<th>Name</th>
<th>Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td>IF</td>
<td>Instruction Fetch</td>
<td>Fetch instruction from memory at PC</td>
</tr>
<tr>
<td>ID</td>
<td>Instruction Decode</td>
<td>Decode instruction, read registers</td>
</tr>
<tr>
<td>EX</td>
<td>Execute</td>
<td>Perform ALU operation, address calculation</td>
</tr>
<tr>
<td>MEM</td>
<td>Memory Access</td>
<td>Read/write memory (load/store)</td>
</tr>
<tr>
<td>WB</td>
<td>Write Back</td>
<td>Store result to register</td>
</tr>
</tbody>
</table>
<h3 id="pipeline-registers">Pipeline Registers<a class="header-link" href="#pipeline-registers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="k">IF</span><span class="w">  </span>â”‚â”€â”€â–¶â”‚<span class="w"> </span><span class="k">IF</span><span class="o">/</span><span class="nv">ID</span><span class="w">   </span>â”‚â”€â”€â–¶â”‚<span class="w"> </span><span class="nv">ID</span><span class="o">/</span><span class="nv">EX</span><span class="w">   </span>â”‚â”€â”€â–¶â”‚<span class="w"> </span><span class="nv">EX</span><span class="o">/</span><span class="nv">MEM</span><span class="w">   </span>â”‚â”€â”€â–¶â”‚<span class="w"> </span><span class="nv">MEM</span><span class="o">/</span><span class="nv">WB</span><span class="w">  </span>â”‚
â””â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚<span class="nv">Register</span><span class="w"> </span>â”‚<span class="w">   </span>â”‚<span class="nv">Register</span><span class="w"> </span>â”‚<span class="w">   </span>â”‚<span class="nv">Register</span><span class="w">  </span>â”‚<span class="w">   </span>â”‚<span class="nv">Register</span><span class="w"> </span>â”‚
<span class="w">          </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Pipeline</span><span class="w"> </span><span class="nv">Registers</span>:<span class="w"> </span><span class="nv">Temporarily</span><span class="w"> </span><span class="nv">store</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">between</span><span class="w"> </span><span class="nv">stages</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Data</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">passed</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="nv">stage</span><span class="w"> </span><span class="nv">every</span><span class="w"> </span><span class="nv">clock</span><span class="w"> </span><span class="nv">cycle</span>
</code></pre></div>

<h3 id="pipeline-usage-by-instruction-type">Pipeline Usage by Instruction Type<a class="header-link" href="#pipeline-usage-by-instruction-type" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Stage</span><span class="w"> </span><span class="nx">usage</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">instruction</span><span class="w"> </span><span class="k">type</span><span class="p">:</span>

<span class="nx">R</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="nx">add</span><span class="p">,</span><span class="w"> </span><span class="nx">sub</span><span class="p">):</span>
<span class="nx">IF</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">EX</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">WB</span>

<span class="nx">Load</span><span class="w"> </span><span class="p">(</span><span class="nx">lw</span><span class="p">):</span>
<span class="nx">IF</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">EX</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">MEM</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">WB</span>

<span class="nx">Store</span><span class="w"> </span><span class="p">(</span><span class="nx">sw</span><span class="p">):</span>
<span class="nx">IF</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">EX</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">MEM</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="o">---</span>

<span class="nx">Branch</span><span class="w"> </span><span class="p">(</span><span class="nx">beq</span><span class="p">):</span>
<span class="nx">IF</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="nx">EX</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="err">â”€â–¶</span><span class="w"> </span><span class="o">---</span>
</code></pre></div>

<hr />
<h2 id="3-pipeline-performance">3. Pipeline Performance<a class="header-link" href="#3-pipeline-performance" title="Permanent link">&para;</a></h2>
<h3 id="ideal-speedup">Ideal Speedup<a class="header-link" href="#ideal-speedup" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Speedup = Number of pipeline stages (ideal)

5-stage pipeline â†’ Maximum 5x speedup

In practice:
- Pipeline fill/drain time
- Stalls due to hazards
- Stage imbalance
</code></pre></div>

<h3 id="throughput-calculation">Throughput Calculation<a class="header-link" href="#throughput-calculation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Throughput = Number of instructions / Time

Non-pipelined:
- 1 instruction / 5 cycles

Pipelined (ideal):
- 1 instruction / 1 cycle (full pipeline state)

CPI (Cycles Per Instruction):
- Ideal: CPI = 1
- Actual: CPI = 1 + stall cycles
</code></pre></div>

<h3 id="example-executing-100-instructions">Example: Executing 100 Instructions<a class="header-link" href="#example-executing-100-instructions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Non-pipelined:
Time = 100 Ã— 5 = 500 cycles

5-stage pipeline:
Time = 5 + (100 - 1) = 104 cycles
      â†‘first instr.  â†‘remaining instructions

Speedup = 500 / 104 â‰ˆ 4.8x
</code></pre></div>

<hr />
<h2 id="4-pipeline-hazards">4. Pipeline Hazards<a class="header-link" href="#4-pipeline-hazards" title="Permanent link">&para;</a></h2>
<h3 id="hazard-types">Hazard Types<a class="header-link" href="#hazard-types" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Pipeline Hazards                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Structural    â”‚      Data       â”‚      Control        â”‚
â”‚    Hazard       â”‚     Hazard      â”‚      Hazard         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hardware        â”‚ Problems due    â”‚ Problems due        â”‚
â”‚ resource        â”‚ to data         â”‚ to branch           â”‚
â”‚ conflicts       â”‚ dependencies    â”‚ instructions        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="41-structural-hazards">4.1 Structural Hazards<a class="header-link" href="#41-structural-hazards" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Problem</span><span class="o">:</span><span class="w"> </span><span class="n">Trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">hardware</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">simultaneously</span>

<span class="n">Example</span><span class="o">:</span><span class="w"> </span><span class="n">Single</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span>
<span class="n">Cycle</span><span class="w"> </span><span class="mi">4</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Instruction</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">MEM</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="o">(</span><span class="n">data</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">access</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Instruction</span><span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="n">IF</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="o">(</span><span class="n">instruction</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">access</span><span class="o">)</span>

<span class="w">    </span><span class="n">I1</span><span class="o">:</span><span class="w"> </span><span class="n">IF</span><span class="err">â”€</span><span class="n">ID</span><span class="err">â”€</span><span class="n">EX</span><span class="err">â”€</span><span class="n">MEM</span><span class="err">â”€</span><span class="n">WB</span>
<span class="w">    </span><span class="n">I4</span><span class="o">:</span><span class="w">          </span><span class="n">IF</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="n">Conflict</span><span class="o">!</span>

<span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Harvard</span><span class="w"> </span><span class="n">architecture</span><span class="w"> </span><span class="o">(</span><span class="n">separate</span><span class="w"> </span><span class="n">instruction</span><span class="o">/</span><span class="n">data</span><span class="w"> </span><span class="n">memory</span><span class="o">)</span>
</code></pre></div>

<h3 id="42-data-hazards">4.2 Data Hazards<a class="header-link" href="#42-data-hazards" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Three</span><span class="w"> </span><span class="nx">types</span><span class="p">:</span>

<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">RAW</span><span class="w"> </span><span class="p">(</span><span class="nx">Read</span><span class="w"> </span><span class="nx">After</span><span class="w"> </span><span class="nx">Write</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Most</span><span class="w"> </span><span class="nx">common</span>
<span class="w">   </span><span class="nx">add</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t1</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Write</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span>
<span class="w">   </span><span class="nx">sub</span><span class="w"> </span><span class="err">$</span><span class="nx">t2</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t3</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Read</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="nx">Not</span><span class="w"> </span><span class="nx">written</span><span class="w"> </span><span class="nx">yet</span><span class="p">!</span>

<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">WAR</span><span class="w"> </span><span class="p">(</span><span class="nx">Write</span><span class="w"> </span><span class="nx">After</span><span class="w"> </span><span class="nx">Read</span><span class="p">)</span>
<span class="w">   </span><span class="nx">sub</span><span class="w"> </span><span class="err">$</span><span class="nx">t2</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t3</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Read</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span>
<span class="w">   </span><span class="nx">add</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t1</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Write</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span>

<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">WAW</span><span class="w"> </span><span class="p">(</span><span class="nx">Write</span><span class="w"> </span><span class="nx">After</span><span class="w"> </span><span class="nx">Write</span><span class="p">)</span>
<span class="w">   </span><span class="nx">add</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t1</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Write</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span>
<span class="w">   </span><span class="nx">sub</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t2</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nx">t3</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">Write</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="err">$</span><span class="nx">s0</span>
</code></pre></div>

<h3 id="raw-hazard-example">RAW Hazard Example<a class="header-link" href="#raw-hazard-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">add</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t1</span>
<span class="n">sub</span><span class="w"> </span><span class="err">$</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t3</span>

<span class="nc">Time</span><span class="err">:</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">2</span><span class="w">    </span><span class="mi">3</span><span class="w">    </span><span class="mi">4</span><span class="w">    </span><span class="mi">5</span><span class="w">    </span><span class="mi">6</span><span class="w">    </span><span class="mi">7</span>
<span class="k">add</span><span class="err">:</span><span class="w">    </span><span class="k">IF</span><span class="w">   </span><span class="n">ID</span><span class="w">   </span><span class="n">EX</span><span class="w">  </span><span class="n">MEM</span><span class="w">  </span><span class="o">[</span><span class="n">WB</span><span class="o">]</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="w"> </span><span class="n">written</span>
<span class="nl">sub</span><span class="p">:</span><span class="w">         </span><span class="k">IF</span><span class="w">   </span><span class="n">ID</span><span class="w">  </span><span class="o">[</span><span class="n">EX</span><span class="o">]</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="w"> </span><span class="n">needed</span><span class="err">!</span>
<span class="w">                       </span><span class="err">â†‘</span>
<span class="w">                   </span><span class="n">Problem</span><span class="w"> </span><span class="n">occurs</span><span class="err">!</span>

<span class="err">$</span><span class="n">s0</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">cycle</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="n">but</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">cycle</span><span class="w"> </span><span class="mi">4</span>
</code></pre></div>

<h3 id="43-control-hazards">4.3 Control Hazards<a class="header-link" href="#43-control-hazards" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">beq</span><span class="w"> </span><span class="err">$</span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Branch</span><span class="w"> </span><span class="n">decision</span>
<span class="k">add</span><span class="w"> </span><span class="err">$</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t3</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t4</span><span class="w">       </span><span class="err">#</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">execute</span><span class="vm">?</span>
<span class="n">sub</span><span class="w"> </span><span class="err">$</span><span class="n">t5</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t6</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t7</span><span class="w">       </span><span class="err">#</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">execute</span><span class="vm">?</span>

<span class="nc">Time</span><span class="err">:</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">2</span><span class="w">    </span><span class="mi">3</span><span class="w">    </span><span class="mi">4</span><span class="w">    </span><span class="mi">5</span>
<span class="nl">beq</span><span class="p">:</span><span class="w">    </span><span class="k">IF</span><span class="w">   </span><span class="n">ID</span><span class="w">  </span><span class="o">[</span><span class="n">EX</span><span class="o">]</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="n">Branch</span><span class="w"> </span><span class="n">decided</span>
<span class="k">add</span><span class="err">:</span><span class="w">         </span><span class="k">IF</span><span class="w">   </span><span class="n">ID</span><span class="w">   </span><span class="err">â†</span><span class="w"> </span><span class="n">Wrong</span><span class="w"> </span><span class="n">instruction</span><span class="vm">?</span>
<span class="nl">sub</span><span class="p">:</span><span class="w">              </span><span class="k">IF</span><span class="w">   </span><span class="err">â†</span><span class="w"> </span><span class="n">Wrong</span><span class="w"> </span><span class="n">instruction</span><span class="vm">?</span>

<span class="k">Next</span><span class="w"> </span><span class="n">instructions</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">entered</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="n">decision</span>
</code></pre></div>

<hr />
<h2 id="5-hazard-resolution-techniques">5. Hazard Resolution Techniques<a class="header-link" href="#5-hazard-resolution-techniques" title="Permanent link">&para;</a></h2>
<h3 id="51-stalling">5.1 Stalling<a class="header-link" href="#51-stalling" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">Pause</span><span class="w"> </span><span class="nv">pipeline</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">inserting</span><span class="w"> </span><span class="nv">bubbles</span><span class="w"> </span><span class="ss">(</span><span class="nv">NOPs</span><span class="ss">)</span>

<span class="nv">add</span><span class="w"> </span>$<span class="nv">s0</span>,<span class="w"> </span>$<span class="nv">t0</span>,<span class="w"> </span>$<span class="nv">t1</span>
<span class="nv">sub</span><span class="w"> </span>$<span class="nv">t2</span>,<span class="w"> </span>$<span class="nv">s0</span>,<span class="w"> </span>$<span class="nv">t3</span>

<span class="nv">Time</span>:<span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">2</span><span class="w">    </span><span class="mi">3</span><span class="w">    </span><span class="mi">4</span><span class="w">    </span><span class="mi">5</span><span class="w">    </span><span class="mi">6</span><span class="w">    </span><span class="mi">7</span><span class="w">    </span><span class="mi">8</span><span class="w">    </span><span class="mi">9</span>
<span class="nv">add</span>:<span class="w">    </span><span class="k">IF</span><span class="w">   </span><span class="nv">ID</span><span class="w">   </span><span class="nv">EX</span><span class="w">  </span><span class="nv">MEM</span><span class="w">  </span><span class="nv">WB</span>
<span class="w">        </span><span class="o">---</span><span class="w"> </span><span class="nv">stall</span><span class="w"> </span><span class="o">---</span>
<span class="w">        </span><span class="o">---</span><span class="w"> </span><span class="nv">stall</span><span class="w"> </span><span class="o">---</span>
<span class="nv">sub</span>:<span class="w">              </span><span class="k">IF</span><span class="w">   </span><span class="nv">ID</span><span class="w">   </span><span class="nv">EX</span><span class="w">  </span><span class="nv">MEM</span><span class="w">  </span><span class="nv">WB</span>

<span class="mi">2</span><span class="w"> </span><span class="nv">cycle</span><span class="w"> </span><span class="nv">stall</span><span class="w"> </span><span class="nv">occurs</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Performance</span><span class="w"> </span><span class="nv">degradation</span>
</code></pre></div>

<h3 id="52-forwardingbypassing">5.2 Forwarding/Bypassing<a class="header-link" href="#52-forwardingbypassing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Pass</span><span class="w"> </span><span class="n">ALU</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="n">directly</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="n">instruction</span>

<span class="k">add</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t1</span>
<span class="n">sub</span><span class="w"> </span><span class="err">$</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t3</span>

<span class="nc">Time</span><span class="err">:</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">2</span><span class="w">    </span><span class="mi">3</span><span class="w">    </span><span class="mi">4</span><span class="w">    </span><span class="mi">5</span><span class="w">    </span><span class="mi">6</span>
<span class="k">add</span><span class="err">:</span><span class="w">    </span><span class="k">IF</span><span class="w">   </span><span class="n">ID</span><span class="w">  </span><span class="o">[</span><span class="n">EX</span><span class="o">]</span><span class="w"> </span><span class="n">MEM</span><span class="w">  </span><span class="n">WB</span>
<span class="w">                  </span><span class="err">â”‚</span>
<span class="w">                  </span><span class="err">â””â”€â”€â”€â”€â”€â–¶</span><span class="w"> </span><span class="n">Forwarding</span>
<span class="nl">sub</span><span class="p">:</span><span class="w">         </span><span class="k">IF</span><span class="w">   </span><span class="n">ID</span><span class="w">  </span><span class="o">[</span><span class="n">EX</span><span class="o">]</span><span class="w"> </span><span class="n">MEM</span><span class="w">  </span><span class="n">WB</span>
<span class="w">                       </span><span class="err">â†‘</span>
<span class="w">                    </span><span class="k">Use</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="w"> </span><span class="k">value</span>

<span class="n">Execution</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n">stalls</span><span class="err">!</span>
</code></pre></div>

<h3 id="forwarding-paths">Forwarding Paths<a class="header-link" href="#forwarding-paths" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Forwarding Unit                       â”‚
â”‚                                                         â”‚
â”‚   EX/MEM.ALUResult â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                                   â–¼                     â”‚
â”‚   MEM/WB.ALUResult â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ MUX â”€â”€â–¶ ALU input     â”‚
â”‚                                   â–²                     â”‚
â”‚   ID/EX.RegisterRs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Forwarding conditions:
1. EX/MEM.RegisterRd == ID/EX.RegisterRs
2. MEM/WB.RegisterRd == ID/EX.RegisterRs
</code></pre></div>

<h3 id="53-load-use-hazard">5.3 Load-Use Hazard<a class="header-link" href="#53-load-use-hazard" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Cases</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">resolved</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="nl">forwarding</span><span class="p">:</span>

<span class="n">lw</span><span class="w">  </span><span class="err">$</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="err">$</span><span class="n">t0</span><span class="p">)</span><span class="w">     </span><span class="err">#</span><span class="w"> </span><span class="k">Load</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">memory</span>
<span class="k">add</span><span class="w"> </span><span class="err">$</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">t3</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="k">Use</span><span class="w"> </span><span class="n">immediately</span>

<span class="nc">Time</span><span class="err">:</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">2</span><span class="w">    </span><span class="mi">3</span><span class="w">    </span><span class="mi">4</span><span class="w">    </span><span class="mi">5</span><span class="w">    </span><span class="mi">6</span><span class="w">    </span><span class="mi">7</span>
<span class="nl">lw</span><span class="p">:</span><span class="w">     </span><span class="k">IF</span><span class="w">   </span><span class="n">ID</span><span class="w">   </span><span class="n">EX</span><span class="w">  </span><span class="o">[</span><span class="n">MEM</span><span class="o">]</span><span class="w"> </span><span class="n">WB</span>
<span class="w">                       </span><span class="err">â”‚</span>
<span class="w">                       </span><span class="err">â””â”€â”€â”€â–¶</span><span class="w"> </span><span class="k">Data</span><span class="w"> </span><span class="n">available</span>
<span class="k">add</span><span class="err">:</span><span class="w">         </span><span class="k">IF</span><span class="w">   </span><span class="n">ID</span><span class="w">  </span><span class="n">stall</span><span class="w"> </span><span class="o">[</span><span class="n">EX</span><span class="o">]</span><span class="w"> </span><span class="n">MEM</span><span class="w">  </span><span class="n">WB</span>
<span class="w">                   </span><span class="err">â†‘</span>
<span class="w">              </span><span class="n">Need</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">yet</span>

<span class="mi">1</span><span class="w"> </span><span class="k">cycle</span><span class="w"> </span><span class="n">stall</span><span class="w"> </span><span class="n">mandatory</span><span class="w"> </span><span class="p">(</span><span class="k">Load</span><span class="o">-</span><span class="k">Use</span><span class="w"> </span><span class="n">Stall</span><span class="p">)</span>
</code></pre></div>

<h3 id="54-branch-prediction">5.4 Branch Prediction<a class="header-link" href="#54-branch-prediction" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">Static</span><span class="w"> </span><span class="nv">Prediction</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">Always</span><span class="w"> </span><span class="nv">Not</span><span class="w"> </span><span class="nv">Taken</span>:<span class="w"> </span><span class="nv">Predict</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">branch</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Always</span><span class="w"> </span><span class="nv">Taken</span>:<span class="w"> </span><span class="nv">Predict</span><span class="w"> </span><span class="nv">branch</span><span class="w"> </span><span class="nv">taken</span>
<span class="o">-</span><span class="w"> </span><span class="nv">BTFN</span>:<span class="w"> </span><span class="nv">Backward</span><span class="w"> </span><span class="nv">Taken</span>,<span class="w"> </span><span class="nv">Forward</span><span class="w"> </span><span class="nv">Not</span><span class="w"> </span><span class="nv">Taken</span>

<span class="nv">Dynamic</span><span class="w"> </span><span class="nv">Prediction</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">Predict</span><span class="w"> </span><span class="nv">based</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">branch</span><span class="w"> </span><span class="nv">history</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Covered</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">detail</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="nv">lesson</span>
</code></pre></div>

<h3 id="55-delayed-branch">5.5 Delayed Branch<a class="header-link" href="#55-delayed-branch" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Place always-executed instruction in slot after branch instruction

beq $t0, $t1, target
add $t2, $t3, $t4    # Delay slot (always executed)
...
target:
sub $t5, $t6, $t7

Compiler places branch-independent instruction in delay slot
</code></pre></div>

<hr />
<h2 id="6-practice-problems">6. Practice Problems<a class="header-link" href="#6-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="basic-problems">Basic Problems<a class="header-link" href="#basic-problems" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>What are the names and roles of each stage in a 5-stage pipeline?</p>
</li>
<li>
<p>How many cycles are needed to execute 100 instructions in a 5-stage pipeline? (Assume no hazards)</p>
</li>
<li>
<p>Which of the following is NOT a type of data hazard?</p>
</li>
<li>(a) RAW</li>
<li>(b) RAR</li>
<li>(c) WAR</li>
<li>(d) WAW</li>
</ol>
<h3 id="hazard-analysis">Hazard Analysis<a class="header-link" href="#hazard-analysis" title="Permanent link">&para;</a></h3>
<ol>
<li>Find the data hazards in the following code:</li>
</ol>
<div class="highlight"><pre><span></span><code>add $s0, $t0, $t1
sub $s1, $s0, $t2
and $s2, $s0, $s1
</code></pre></div>

<ol>
<li>Which hazard cannot be resolved by forwarding?</li>
</ol>
<div class="highlight"><pre><span></span><code>lw  $s0, 0($t0)
add $t1, $s0, $t2
</code></pre></div>

<h3 id="performance-calculation">Performance Calculation<a class="header-link" href="#performance-calculation" title="Permanent link">&para;</a></h3>
<ol>
<li>If 30% of 1000 instructions are branches, branch misprediction rate is 20%, and misprediction penalty is 3 cycles, what is the CPI?</li>
</ol>
<details>
<summary>Answers</summary>

1. IF (Fetch), ID (Decode), EX (Execute), MEM (Memory Access), WB (Write Back)

2. 5 + (100 - 1) = 104 cycles

3. (b) RAR - Read After Read is not a hazard

4.
- add â†’ sub: RAW on $s0
- add â†’ and: RAW on $s0
- sub â†’ and: RAW on $s1

5. Load-Use hazard. Data is only available after MEM stage of lw, so 1 cycle stall is required

6.
- Number of branch instructions: 1000 Ã— 0.3 = 300
- Mispredictions: 300 Ã— 0.2 = 60
- Penalty cycles: 60 Ã— 3 = 180
- CPI = 1 + 180/1000 = 1.18

</details>

<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./12_Branch_Prediction.md">12_Branch_Prediction.md</a> - Dynamic Branch Prediction Techniques</li>
</ul>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>Computer Organization and Design, Chapter 4 (Patterson &amp; Hennessy)</li>
<li><a href="https://www.youtube.com/watch?v=eVRdfl4zxfI">Pipeline Visualization</a></li>
<li><a href="http://www.cs.umd.edu/~meesh/411/mips-pipe/">MIPS Pipeline Simulator</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Computer_Architecture/10_Assembly_Language_Basics.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Assembly Language Basics</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Computer_Architecture/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Computer_Architecture/12_Branch_Prediction.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Branch Prediction</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}