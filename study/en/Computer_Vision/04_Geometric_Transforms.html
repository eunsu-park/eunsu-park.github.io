{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geometric Transformations - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Computer_Vision/">Computer Vision</a>
    <span class="separator">/</span>
    <span class="current">Geometric Transformations</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Geometric Transformations</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Computer_Vision/03_Color_Spaces.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Color Spaces</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Computer_Vision/05_Image_Filtering.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Image Filtering</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-image-resizing-resize">1. Image Resizing - resize()</a><ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#interpolation-methods">Interpolation Methods</a></li>
<li><a href="#interpolation-comparison-example">Interpolation Comparison Example</a></li>
<li><a href="#aspect-ratio-preserving-resize-functions">Aspect Ratio-Preserving Resize Functions</a></li>
</ul>
</li>
<li><a href="#2-flipping-and-rotation-flip-rotate">2. Flipping and Rotation - flip(), rotate()</a><ul>
<li><a href="#cv2flip">cv2.flip()</a></li>
<li><a href="#cv2rotate">cv2.rotate()</a></li>
<li><a href="#arbitrary-angle-rotation">Arbitrary Angle Rotation</a></li>
</ul>
</li>
<li><a href="#3-affine-transformation-warpaffine">3. Affine Transformation - warpAffine()</a><ul>
<li><a href="#what-is-affine-transformation">What is Affine Transformation?</a></li>
<li><a href="#translation">Translation</a></li>
<li><a href="#rotation-scale">Rotation + Scale</a></li>
<li><a href="#shear-transformation">Shear Transformation</a></li>
<li><a href="#affine-transformation-using-3-points">Affine Transformation Using 3 Points</a></li>
</ul>
</li>
<li><a href="#4-perspective-transformation-warpperspective">4. Perspective Transformation - warpPerspective()</a><ul>
<li><a href="#what-is-perspective-transformation">What is Perspective Transformation?</a></li>
<li><a href="#perspective-transformation-using-4-points">Perspective Transformation Using 4 Points</a></li>
<li><a href="#birds-eye-view">Bird's Eye View</a></li>
</ul>
</li>
<li><a href="#5-document-correction-example">5. Document Correction Example</a><ul>
<li><a href="#automated-document-scan-pipeline">Automated Document Scan Pipeline</a></li>
<li><a href="#implementation-code">Implementation Code</a></li>
<li><a href="#manual-4-point-selection-mouse-click">Manual 4-Point Selection (Mouse Click)</a></li>
</ul>
</li>
<li><a href="#6-practice-problems">6. Practice Problems</a><ul>
<li><a href="#exercise-1-batch-resize">Exercise 1: Batch Resize</a></li>
<li><a href="#exercise-2-image-rotation-animation">Exercise 2: Image Rotation Animation</a></li>
<li><a href="#exercise-3-id-card-scanner">Exercise 3: ID Card Scanner</a></li>
<li><a href="#exercise-4-image-mosaic">Exercise 4: Image Mosaic</a></li>
<li><a href="#exercise-5-ar-card-effect">Exercise 5: AR Card Effect</a></li>
</ul>
</li>
<li><a href="#7-next-steps">7. Next Steps</a></li>
<li><a href="#8-references">8. References</a><ul>
<li><a href="#official-documentation">Official Documentation</a></li>
<li><a href="#related-learning-materials">Related Learning Materials</a></li>
<li><a href="#additional-references">Additional References</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="geometric-transformations">Geometric Transformations<a class="header-link" href="#geometric-transformations" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Geometric transformations are operations that change the spatial position of an image. This includes resizing, rotation, translation, flipping, and perspective transformations. In this document, we'll learn about OpenCV's geometric transformation functions and practical examples.</p>
<p><strong>Difficulty</strong>: â­â­ (Beginner-Intermediate)</p>
<p><strong>Learning Objectives</strong>:
- Understand <code>cv2.resize()</code> and interpolation methods
- Use rotation and flipping functions
- Apply affine transformation (warpAffine)
- Apply perspective transformation (warpPerspective)
- Implement document scanning/correction examples</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-image-resizing---resize">Image Resizing - resize()</a></li>
<li><a href="#2-flipping-and-rotation---flip-rotate">Flipping and Rotation - flip(), rotate()</a></li>
<li><a href="#3-affine-transformation---warpaffine">Affine Transformation - warpAffine()</a></li>
<li><a href="#4-perspective-transformation---warpperspective">Perspective Transformation - warpPerspective()</a></li>
<li><a href="#5-document-correction-example">Document Correction Example</a></li>
<li><a href="#6-practice-problems">Practice Problems</a></li>
<li><a href="#7-next-steps">Next Steps</a></li>
<li><a href="#8-references">References</a></li>
</ol>
<hr />
<h2 id="1-image-resizing-resize">1. Image Resizing - resize()<a class="header-link" href="#1-image-resizing-resize" title="Permanent link">&para;</a></h2>
<h3 id="basic-usage">Basic Usage<a class="header-link" href="#basic-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Method 1: Specify size directly (width, height order!)</span>
<span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">))</span>

<span class="c1"># Method 2: Specify by ratio</span>
<span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Reduce to 50%</span>

<span class="c1"># Method 3: Maintain aspect ratio based on one dimension</span>
<span class="n">new_width</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">new_width</span> <span class="o">/</span> <span class="n">w</span>
<span class="n">new_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>
<span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span><span class="p">))</span>
</code></pre></div>

<h3 id="interpolation-methods">Interpolation Methods<a class="header-link" href="#interpolation-methods" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                       </span><span class="nx">Interpolation</span><span class="w"> </span><span class="nx">Comparison</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Method</span><span class="w">                   </span><span class="nx">Features</span><span class="w">              </span><span class="nx">Use</span><span class="w"> </span><span class="nx">Cases</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">INTER_NEAREST</span><span class="w">           </span><span class="nx">Nearest</span><span class="w"> </span><span class="nx">neighbor</span><span class="w">      </span><span class="nx">Fast</span><span class="p">,</span><span class="w"> </span><span class="nx">low</span><span class="w"> </span><span class="nx">qual</span><span class="p">.</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="nx">Nearest</span><span class="w"> </span><span class="nx">interpolation</span><span class="p">)</span><span class="w"> </span><span class="nx">Blocky</span><span class="w"> </span><span class="nx">artifacts</span><span class="w">      </span><span class="nx">Real</span><span class="o">-</span><span class="nx">time</span><span class="w"> </span><span class="nx">proc</span><span class="p">.</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">INTER_LINEAR</span><span class="w">            </span><span class="nx">Linear</span><span class="w"> </span><span class="p">(</span><span class="k">default</span><span class="p">)</span><span class="w">      </span><span class="nx">Balanced</span><span class="w"> </span><span class="kd">choice</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="nx">Bilinear</span><span class="w"> </span><span class="nx">interpolation</span><span class="p">)</span><span class="w"> </span><span class="nx">Smooth</span><span class="w"> </span><span class="nx">results</span><span class="w">      </span><span class="nx">General</span><span class="w"> </span><span class="nx">resizing</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">INTER_AREA</span><span class="w">              </span><span class="nx">Area</span><span class="w"> </span><span class="nx">interpolation</span><span class="w">    </span><span class="nx">Best</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">shrink</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="nx">Area</span><span class="o">-</span><span class="nx">based</span><span class="p">)</span><span class="w">             </span><span class="nx">Prevents</span><span class="w"> </span><span class="nx">moirÃ©</span><span class="w">       </span><span class="nx">Downsampling</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">INTER_CUBIC</span><span class="w">             </span><span class="nx">Cubic</span><span class="w"> </span><span class="nx">interpolation</span><span class="w">   </span><span class="nx">Good</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">enlarg</span><span class="p">.</span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="nx">Bicubic</span><span class="p">)</span><span class="w">                </span><span class="nx">Smooth</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">sharp</span><span class="w">     </span><span class="nx">Quality</span><span class="w"> </span><span class="nx">focus</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">INTER_LANCZOS4</span><span class="w">          </span><span class="nx">Lanczos</span><span class="w"> </span><span class="nx">interpolation</span><span class="w"> </span><span class="nx">Best</span><span class="w"> </span><span class="nx">quality</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="mi">8</span><span class="nx">x8</span><span class="w"> </span><span class="nx">neighbors</span><span class="p">)</span><span class="w">          </span><span class="nx">Sharpest</span><span class="w">            </span><span class="nx">Slow</span><span class="w"> </span><span class="nx">speed</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Recommendations</span><span class="p">:</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Shrinking</span><span class="p">:</span><span class="w"> </span><span class="nx">INTER_AREA</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Enlarging</span><span class="p">:</span><span class="w"> </span><span class="nx">INTER_CUBIC</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">INTER_LANCZOS4</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Real</span><span class="o">-</span><span class="nx">time</span><span class="p">:</span><span class="w"> </span><span class="nx">INTER_LINEAR</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">INTER_NEAREST</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="interpolation-comparison-example">Interpolation Comparison Example<a class="header-link" href="#interpolation-comparison-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>

<span class="c1"># Shrink first, then enlarge to compare differences</span>
<span class="n">small</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Reduce to 10%</span>

<span class="n">interpolations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;NEAREST&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;LINEAR&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;AREA&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;CUBIC&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_CUBIC</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;LANCZOS4&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LANCZOS4</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">interp</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">interpolations</span><span class="p">):</span>
    <span class="n">enlarged</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interp</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">enlarged</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="aspect-ratio-preserving-resize-functions">Aspect Ratio-Preserving Resize Functions<a class="header-link" href="#aspect-ratio-preserving-resize-functions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">resize_with_aspect_ratio</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inter</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resize while maintaining aspect ratio&quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">h</span>
        <span class="n">new_size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">),</span> <span class="n">height</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">w</span>
        <span class="n">new_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">new_size</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">inter</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">resize_to_fit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">,</span> <span class="n">inter</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit within maximum size while maintaining aspect ratio&quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">ratio_w</span> <span class="o">=</span> <span class="n">max_width</span> <span class="o">/</span> <span class="n">w</span>
    <span class="n">ratio_h</span> <span class="o">=</span> <span class="n">max_height</span> <span class="o">/</span> <span class="n">h</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ratio_w</span><span class="p">,</span> <span class="n">ratio_h</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ratio</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Already small enough</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="n">new_size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">new_size</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">inter</span><span class="p">)</span>


<span class="c1"># Usage example</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;large_image.jpg&#39;</span><span class="p">)</span>
<span class="n">img_fit</span> <span class="o">=</span> <span class="n">resize_to_fit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
<span class="n">img_width</span> <span class="o">=</span> <span class="n">resize_with_aspect_ratio</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">640</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="2-flipping-and-rotation-flip-rotate">2. Flipping and Rotation - flip(), rotate()<a class="header-link" href="#2-flipping-and-rotation-flip-rotate" title="Permanent link">&para;</a></h2>
<h3 id="cv2flip">cv2.flip()<a class="header-link" href="#cv2flip" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        flip() Operation                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   flipCode = 1 (horizontal)   flipCode = 0 (vertical)  flipCode = -1â”‚
â”‚                                                                 â”‚
â”‚   Original  Result            Original  Result         Original Resultâ”‚
â”‚   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”           â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”         â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”‚
â”‚   â”‚1 2â”‚   â”‚2 1â”‚           â”‚1 2â”‚   â”‚3 4â”‚         â”‚1 2â”‚  â”‚4 3â”‚  â”‚
â”‚   â”‚3 4â”‚   â”‚4 3â”‚           â”‚3 4â”‚   â”‚1 2â”‚         â”‚3 4â”‚  â”‚2 1â”‚  â”‚
â”‚   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜           â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜         â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   Left-right flip         Top-bottom flip         Both flips   â”‚
â”‚   (Mirror effect)         (Water reflection)      (180Â° rotation)â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>

<span class="c1"># Horizontal flip (left-right)</span>
<span class="n">flipped_h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Vertical flip (top-bottom)</span>
<span class="n">flipped_v</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Both directions (equivalent to 180Â° rotation)</span>
<span class="n">flipped_both</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Also possible with NumPy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">flipped_h_np</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>      <span class="c1"># Horizontal</span>
<span class="n">flipped_v_np</span> <span class="o">=</span> <span class="n">img</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>      <span class="c1"># Vertical</span>
<span class="n">flipped_both_np</span> <span class="o">=</span> <span class="n">img</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Both</span>
</code></pre></div>

<h3 id="cv2rotate">cv2.rotate()<a class="header-link" href="#cv2rotate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>

<span class="c1"># 90 degrees clockwise</span>
<span class="n">rotated_90_cw</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ROTATE_90_CLOCKWISE</span><span class="p">)</span>

<span class="c1"># 90 degrees counter-clockwise</span>
<span class="n">rotated_90_ccw</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ROTATE_90_COUNTERCLOCKWISE</span><span class="p">)</span>

<span class="c1"># 180 degrees</span>
<span class="n">rotated_180</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ROTATE_180</span><span class="p">)</span>

<span class="c1"># Check image size changes</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original: </span><span class="si">{</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>           <span class="c1"># (H, W, C)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;90Â°: </span><span class="si">{</span><span class="n">rotated_90_cw</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (W, H, C) - swapped</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;180Â°: </span><span class="si">{</span><span class="n">rotated_180</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (H, W, C) - same</span>
</code></pre></div>

<h3 id="arbitrary-angle-rotation">Arbitrary Angle Rotation<a class="header-link" href="#arbitrary-angle-rotation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rotate_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate image by arbitrary angle&quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Create rotation matrix</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

    <span class="c1"># Apply rotation</span>
    <span class="n">rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">rotated</span>


<span class="k">def</span><span class="w"> </span><span class="nf">rotate_image_full</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate image without cropping (expand canvas)&quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Rotation matrix</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># Calculate new bounds after rotation</span>
    <span class="n">cos</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">sin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">new_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">sin</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span> <span class="n">cos</span><span class="p">)</span>
    <span class="n">new_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">cos</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span> <span class="n">sin</span><span class="p">)</span>

    <span class="c1"># Adjust translation</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">new_w</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">new_h</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">rotated</span>


<span class="c1"># Usage examples</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">rotated_30</span> <span class="o">=</span> <span class="n">rotate_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>       <span class="c1"># 30Â° rotation (partially cropped)</span>
<span class="n">rotated_45_full</span> <span class="o">=</span> <span class="n">rotate_image_full</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>  <span class="c1"># 45Â° rotation (fully preserved)</span>
</code></pre></div>

<hr />
<h2 id="3-affine-transformation-warpaffine">3. Affine Transformation - warpAffine()<a class="header-link" href="#3-affine-transformation-warpaffine" title="Permanent link">&para;</a></h2>
<h3 id="what-is-affine-transformation">What is Affine Transformation?<a class="header-link" href="#what-is-affine-transformation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="n">Affine</span><span class="w"> </span><span class="n">Transformation</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="n">Affine</span><span class="w"> </span><span class="n">transformation</span><span class="w"> </span><span class="n">preserves</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">parallel</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="n">lines</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">lines</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="n">Included</span><span class="w"> </span><span class="nl">transformations</span><span class="p">:</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="k">Translation</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Rotation</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Scale</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Shear</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="n">Transformation</span><span class="w"> </span><span class="n">matrix</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="n">x3</span><span class="p">)</span><span class="err">:</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œ</span><span class="w">         </span><span class="err">â”</span><span class="w">   </span><span class="err">â”Œ</span><span class="w">                    </span><span class="err">â”</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">a</span><span class="w">  </span><span class="n">b</span><span class="w">  </span><span class="n">tx</span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">scale</span><span class="o">*</span><span class="nf">cos</span><span class="w">  </span><span class="o">-</span><span class="nf">sin</span><span class="w">  </span><span class="n">tx</span><span class="err">â”‚</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">c</span><span class="w">  </span><span class="n">d</span><span class="w">  </span><span class="n">ty</span><span class="err">â”‚</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nf">sin</span><span class="w">   </span><span class="n">scale</span><span class="o">*</span><span class="nf">cos</span><span class="w">  </span><span class="n">ty</span><span class="err">â”‚</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””</span><span class="w">         </span><span class="err">â”˜</span><span class="w">   </span><span class="err">â””</span><span class="w">                    </span><span class="err">â”˜</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">[</span><span class="n">x&#39;</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">a b tx</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">[</span><span class="n">y&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">c d ty</span><span class="o">]</span><span class="w"> </span><span class="err">Ã—</span><span class="w"> </span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="translation">Translation<a class="header-link" href="#translation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Translation matrix: move 100 in x, 50 in y</span>
<span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tx</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ty</span><span class="p">]</span>
<span class="p">])</span>

<span class="n">translated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Translated&#39;</span><span class="p">,</span> <span class="n">translated</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="rotation-scale">Rotation + Scale<a class="header-link" href="#rotation-scale" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># getRotationMatrix2D(center, angle, scale)</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">angle</span> <span class="o">=</span> <span class="mi">45</span>  <span class="c1"># 45 degrees counter-clockwise</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># 70% size</span>

<span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

<span class="n">rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
</code></pre></div>

<h3 id="shear-transformation">Shear Transformation<a class="header-link" href="#shear-transformation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Horizontal shear</span>
<span class="n">shear_x</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">M_shear_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">shear_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">])</span>
<span class="n">sheared_x</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M_shear_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">shear_x</span><span class="p">),</span> <span class="n">h</span><span class="p">))</span>

<span class="c1"># Vertical shear</span>
<span class="n">shear_y</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">M_shear_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="n">shear_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">])</span>
<span class="n">sheared_y</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M_shear_y</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span> <span class="n">shear_y</span><span class="p">)))</span>
</code></pre></div>

<h3 id="affine-transformation-using-3-points">Affine Transformation Using 3 Points<a class="header-link" href="#affine-transformation-using-3-points" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># 3 points from source</span>
<span class="n">src_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>      <span class="c1"># Top-left</span>
    <span class="p">[</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>    <span class="c1"># Top-right</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>     <span class="c1"># Bottom-left</span>
<span class="p">])</span>

<span class="c1"># 3 points after transformation</span>
<span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>    <span class="c1"># Top-left</span>
    <span class="p">[</span><span class="n">w</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>  <span class="c1"># Top-right</span>
    <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">50</span><span class="p">]</span>   <span class="c1"># Bottom-left</span>
<span class="p">])</span>

<span class="c1"># Calculate affine transformation matrix</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getAffineTransform</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">)</span>

<span class="c1"># Apply transformation</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

<span class="c1"># Mark points</span>
<span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">src_pts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pt</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">dst_pts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pt</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="4-perspective-transformation-warpperspective">4. Perspective Transformation - warpPerspective()<a class="header-link" href="#4-perspective-transformation-warpperspective" title="Permanent link">&para;</a></h2>
<h3 id="what-is-perspective-transformation">What is Perspective Transformation?<a class="header-link" href="#what-is-perspective-transformation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                       </span><span class="nv">Perspective</span><span class="w"> </span><span class="nv">Transformation</span><span class="w">                </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">   </span><span class="nv">Perspective</span><span class="w"> </span><span class="nv">transformation</span><span class="w"> </span><span class="nv">converts</span><span class="w"> </span><span class="nv">trapezoid</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">rectangle</span><span class="w">    </span>â”‚
â”‚<span class="w">   </span><span class="ss">(</span><span class="nv">or</span><span class="w"> </span><span class="nv">vice</span><span class="w"> </span><span class="nv">versa</span><span class="ss">)</span>.<span class="w"> </span><span class="nv">Transforms</span><span class="w"> </span><span class="nv">images</span><span class="w"> </span><span class="nv">captured</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="mi">3</span><span class="nv">D</span><span class="w"> </span><span class="nv">space</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="k">if</span><span class="w"> </span>â”‚
â”‚<span class="w">   </span><span class="nv">viewed</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">front</span><span class="w">                                         </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">   </span><span class="nv">Practical</span><span class="w"> </span><span class="nv">applications</span>:<span class="w">                                       </span>â”‚
â”‚<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nv">Document</span><span class="w"> </span><span class="nv">scanning</span><span class="w"> </span><span class="ss">(</span><span class="nv">tilted</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">front</span><span class="w"> </span><span class="nv">view</span><span class="ss">)</span><span class="w">            </span>â”‚
â”‚<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nv">Lane</span><span class="w"> </span><span class="nv">detection</span><span class="w"> </span><span class="ss">(</span><span class="nv">Bird</span><span class="err">&#39;s eye view)                            â”‚</span>
<span class="err">â”‚   - QR code recognition                                         â”‚</span>
<span class="err">â”‚   - Image rectification                                         â”‚</span>
<span class="err">â”‚                                                                 â”‚</span>
<span class="err">â”‚   Transformation matrix (3x3):                                  â”‚</span>
<span class="err">â”‚   â”Œ             â”                                               â”‚</span>
<span class="err">â”‚   â”‚ h11 h12 h13 â”‚                                               â”‚</span>
<span class="err">â”‚   â”‚ h21 h22 h23 â”‚                                               â”‚</span>
<span class="err">â”‚   â”‚ h31 h32 h33 â”‚                                               â”‚</span>
<span class="err">â”‚   â””             â”˜                                               â”‚</span>
<span class="err">â”‚                                                                 â”‚</span>
<span class="err">â”‚   Source (trapezoid)           Result (rectangle)               â”‚</span>
<span class="err">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚</span>
<span class="err">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚</span>
<span class="err">â”‚   â”‚ â”‚         â”‚ â”‚   â”€â”€â”€â–¶  â”‚ â”‚             â”‚ â”‚                   â”‚</span>
<span class="err">â”‚   â”‚ â”‚ Documentâ”‚ â”‚         â”‚ â”‚   Document  â”‚ â”‚                   â”‚</span>
<span class="err">â”‚   â”‚ â”‚         â”‚ â”‚         â”‚ â”‚             â”‚ â”‚                   â”‚</span>
<span class="err">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚</span>
<span class="err">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚</span>
<span class="err">â”‚                                                                 â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="perspective-transformation-using-4-points">Perspective Transformation Using 4 Points<a class="header-link" href="#perspective-transformation-using-4-points" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;tilted_document.jpg&#39;</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># 4 points from source (document corners)</span>
<span class="n">src_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>    <span class="c1"># Top-left</span>
    <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span>    <span class="c1"># Top-right</span>
    <span class="p">[</span><span class="mi">550</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>   <span class="c1"># Bottom-right</span>
    <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">380</span><span class="p">]</span>     <span class="c1"># Bottom-left</span>
<span class="p">])</span>

<span class="c1"># 4 points after transformation (front-facing rectangle)</span>
<span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">]</span>
<span class="p">])</span>

<span class="c1"># Calculate perspective transformation matrix</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">)</span>

<span class="c1"># Apply transformation</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>

<span class="c1"># Mark points</span>
<span class="n">img_with_pts</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">src_pts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">img_with_pts</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pt</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img_with_pts</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pt</span><span class="p">),</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Original with points&#39;</span><span class="p">,</span> <span class="n">img_with_pts</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Warped&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="birds-eye-view">Bird's Eye View<a class="header-link" href="#birds-eye-view" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_birds_eye_view</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">src_pts</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create bird&#39;s eye view using perspective transformation</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - img: Input image</span>
<span class="sd">    - src_pts: 4 points from source (top-left, top-right, bottom-right, bottom-left)</span>
<span class="sd">    - width, height: Output image size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">)</span>
    <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">warped</span><span class="p">,</span> <span class="n">M</span>


<span class="c1"># Example for lane detection</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;road.jpg&#39;</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># 4 points of road area (trapezoid)</span>
<span class="n">road_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
    <span class="p">[</span><span class="n">w</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">h</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">],</span>   <span class="c1"># Top-left</span>
    <span class="p">[</span><span class="n">w</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">h</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">],</span>   <span class="c1"># Top-right</span>
    <span class="p">[</span><span class="n">w</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">h</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">],</span>  <span class="c1"># Bottom-right</span>
    <span class="p">[</span><span class="n">w</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">h</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">]</span>   <span class="c1"># Bottom-left</span>
<span class="p">])</span>

<span class="n">birds_eye</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">get_birds_eye_view</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">road_pts</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="5-document-correction-example">5. Document Correction Example<a class="header-link" href="#5-document-correction-example" title="Permanent link">&para;</a></h2>
<h3 id="automated-document-scan-pipeline">Automated Document Scan Pipeline<a class="header-link" href="#automated-document-scan-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   <span class="n">Document</span> <span class="n">Scan</span> <span class="n">Pipeline</span>                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   <span class="n">Input</span> <span class="n">image</span>                                                   â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚   <span class="n">Preprocessing</span> (<span class="n">grayscale</span>, <span class="n">blur</span>, <span class="n">edge</span>)                         â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚   <span class="n">Contour</span> <span class="n">detection</span> (<span class="n">findContours</span>)                              â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚   <span class="n">Rectangle</span> <span class="n">detection</span> (<span class="n">approximate</span> <span class="nb">to</span> <span class="mi">4</span> <span class="n">points</span> <span class="k">with</span> <span class="n">approxPolyDP</span>)â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚   <span class="nb">Order</span> <span class="n">corners</span> (<span class="n">top-left</span>, <span class="n">top-right</span>, <span class="n">bottom-right</span>, <span class="n">bottom-left</span>)â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚   <span class="n">Perspective</span> <span class="n">transformation</span> (<span class="n">warpPerspective</span>)                  â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚   <span class="n">Post-processing</span> (<span class="n">binarization</span>, <span class="n">sharpening</span>)                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="implementation-code">Implementation Code<a class="header-link" href="#implementation-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">order_points</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Order 4 points: top-left, top-right, bottom-right, bottom-left&quot;&quot;&quot;</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Point with smallest sum = top-left</span>
    <span class="c1"># Point with largest sum = bottom-right</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>

    <span class="c1"># Point with smallest difference = top-right</span>
    <span class="c1"># Point with largest difference = bottom-left</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">d</span><span class="p">)]</span>
    <span class="n">rect</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">d</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">rect</span>


<span class="k">def</span><span class="w"> </span><span class="nf">four_point_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">pts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perspective transformation using 4 points&quot;&quot;&quot;</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">order_points</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
    <span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span> <span class="o">=</span> <span class="n">rect</span>

    <span class="c1"># Calculate width of new image</span>
    <span class="n">width_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">tr</span> <span class="o">-</span> <span class="n">tl</span><span class="p">)</span>
    <span class="n">width_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">br</span> <span class="o">-</span> <span class="n">bl</span><span class="p">)</span>
    <span class="n">max_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">width_top</span><span class="p">,</span> <span class="n">width_bottom</span><span class="p">))</span>

    <span class="c1"># Calculate height of new image</span>
    <span class="n">height_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">bl</span> <span class="o">-</span> <span class="n">tl</span><span class="p">)</span>
    <span class="n">height_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">br</span> <span class="o">-</span> <span class="n">tr</span><span class="p">)</span>
    <span class="n">max_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">height_left</span><span class="p">,</span> <span class="n">height_right</span><span class="p">))</span>

    <span class="c1"># Destination points</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">max_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">max_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="c1"># Perspective transformation</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
    <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">warped</span>


<span class="k">def</span><span class="w"> </span><span class="nf">find_document</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Automatically detect document region in image&quot;&quot;&quot;</span>
    <span class="c1"># Preprocessing</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">blurred</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">edged</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">blurred</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="c1"># Contour detection</span>
    <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">edged</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span>
                                    <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
    <span class="n">contours</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>

    <span class="n">doc_contour</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
        <span class="c1"># Approximate contour</span>
        <span class="n">peri</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">arcLength</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">approx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">approxPolyDP</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">peri</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Consider as document if 4 points</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">approx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">doc_contour</span> <span class="o">=</span> <span class="n">approx</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">doc_contour</span>


<span class="k">def</span><span class="w"> </span><span class="nf">scan_document</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main document scan function&quot;&quot;&quot;</span>
    <span class="c1"># Save original size</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">500.0</span>

    <span class="c1"># Resize (improve processing speed)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">),</span> <span class="mi">500</span><span class="p">))</span>

    <span class="c1"># Detect document</span>
    <span class="n">doc_contour</span> <span class="o">=</span> <span class="n">find_document</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">doc_contour</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Document not found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Adjust coordinates to original size</span>
    <span class="n">doc_contour</span> <span class="o">=</span> <span class="n">doc_contour</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ratio</span>

    <span class="c1"># Perspective transformation</span>
    <span class="n">warped</span> <span class="o">=</span> <span class="n">four_point_transform</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">doc_contour</span><span class="p">)</span>

    <span class="c1"># Post-processing (optional)</span>
    <span class="c1"># Grayscale + adaptive binarization</span>
    <span class="n">warped_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">warped_binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
        <span class="n">warped_gray</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_GAUSSIAN_C</span><span class="p">,</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">warped</span><span class="p">,</span> <span class="n">warped_binary</span>


<span class="c1"># Usage example</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;document_photo.jpg&#39;</span><span class="p">)</span>
<span class="n">result_color</span><span class="p">,</span> <span class="n">result_binary</span> <span class="o">=</span> <span class="n">scan_document</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="k">if</span> <span class="n">result_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Scanned (Color)&#39;</span><span class="p">,</span> <span class="n">result_color</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Scanned (Binary)&#39;</span><span class="p">,</span> <span class="n">result_binary</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="manual-4-point-selection-mouse-click">Manual 4-Point Selection (Mouse Click)<a class="header-link" href="#manual-4-point-selection-mouse-click" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">click_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">points</span>
    <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Select 4 corners&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4 points selected! Press &#39;s&#39; to transform.&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">manual_perspective_transform</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select 4 points with mouse for perspective transformation&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">points</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">img_display</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Select 4 corners&#39;</span><span class="p">,</span> <span class="n">img_display</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">setMouseCallback</span><span class="p">(</span><span class="s1">&#39;Select 4 corners&#39;</span><span class="p">,</span> <span class="n">click_event</span><span class="p">,</span> <span class="n">img_display</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Click 4 corners of document clockwise (starting from top-left)&quot;</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>  <span class="c1"># Reset</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">img_display</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Select 4 corners&#39;</span><span class="p">,</span> <span class="n">img_display</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>  <span class="c1"># ESC</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">four_point_transform</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># Usage example</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;document.jpg&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">manual_perspective_transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="6-practice-problems">6. Practice Problems<a class="header-link" href="#6-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-batch-resize">Exercise 1: Batch Resize<a class="header-link" href="#exercise-1-batch-resize" title="Permanent link">&para;</a></h3>
<p>Write a script that resizes all images in a folder to 800px width (maintaining aspect ratio) and saves them as JPEG with 90% quality.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Hint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>

<span class="k">def</span><span class="w"> </span><span class="nf">batch_resize</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">800</span><span class="p">):</span>
    <span class="c1"># Use os.listdir or glob.glob</span>
    <span class="k">pass</span>
</code></pre></div>

<h3 id="exercise-2-image-rotation-animation">Exercise 2: Image Rotation Animation<a class="header-link" href="#exercise-2-image-rotation-animation" title="Permanent link">&para;</a></h3>
<p>Write a program that shows an animation rotating an image from 0 to 360 degrees in 5-degree increments. Expand the canvas so the image doesn't get cropped.</p>
<h3 id="exercise-3-id-card-scanner">Exercise 3: ID Card Scanner<a class="header-link" href="#exercise-3-id-card-scanner" title="Permanent link">&para;</a></h3>
<p>Implement an ID card scanner with the following features:
1. Select 4 points with mouse
2. Generate front view with perspective transformation
3. Output in standard ID card size (85.6mm x 54mm) ratio</p>
<h3 id="exercise-4-image-mosaic">Exercise 4: Image Mosaic<a class="header-link" href="#exercise-4-image-mosaic" title="Permanent link">&para;</a></h3>
<p>Write a function that arranges multiple images in an N x M grid. Each image should be resized to the same size.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_mosaic</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">cell_size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Arrange images in rows x cols grid&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div>

<h3 id="exercise-5-ar-card-effect">Exercise 5: AR Card Effect<a class="header-link" href="#exercise-5-ar-card-effect" title="Permanent link">&para;</a></h3>
<p>Implement a simple AR effect that detects a rectangular card in an image and overlays another image on top of it.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Hint: Use reverse perspective transformation</span>
<span class="c1"># 1. Detect card region</span>
<span class="c1"># 2. Transform overlay image to fit card region</span>
<span class="c1"># 3. Composite with original</span>
</code></pre></div>

<hr />
<h2 id="7-next-steps">7. Next Steps<a class="header-link" href="#7-next-steps" title="Permanent link">&para;</a></h2>
<p>In <a href="./05_Image_Filtering.md">05_Image_Filtering.md</a>, you'll learn image filtering techniques including blur, sharpening, and custom filters!</p>
<p><strong>Next topics</strong>:
- Kernel and convolution concepts
- Blur filters (average, Gaussian, median, bilateral)
- Sharpening filters
- Custom filters (filter2D)</p>
<hr />
<h2 id="8-references">8. References<a class="header-link" href="#8-references" title="Permanent link">&para;</a></h2>
<h3 id="official-documentation">Official Documentation<a class="header-link" href="#official-documentation" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.opencv.org/4.x/da/d54/group__imgproc__transform.html#ga47a974309e9102f5f08231edc7e7529d">resize() documentation</a></li>
<li><a href="https://docs.opencv.org/4.x/da/d54/group__imgproc__transform.html#ga0203d9ee5fcd28d40dbc4a1ea4451983">warpAffine() documentation</a></li>
<li><a href="https://docs.opencv.org/4.x/da/d54/group__imgproc__transform.html#gaf73673a7e8e18ec6963e3774e6a94b87">warpPerspective() documentation</a></li>
</ul>
<h3 id="related-learning-materials">Related Learning Materials<a class="header-link" href="#related-learning-materials" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Folder</th>
<th>Related Content</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="./03_Color_Spaces.md">03_Color_Spaces.md</a></td>
<td>Color conversion, edge detection preprocessing</td>
</tr>
<tr>
<td><a href="./09_Contours.md">09_Contours.md</a></td>
<td>Used for document region detection</td>
</tr>
</tbody>
</table>
<h3 id="additional-references">Additional References<a class="header-link" href="#additional-references" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://pyimagesearch.com/2014/08/25/4-point-opencv-getperspective-transform-example/">PyImageSearch - 4-point Transform</a></li>
<li><a href="https://docs.opencv.org/4.x/da/d54/group__imgproc__transform.html#ga5bb5a1fea74ea38e1a5445ca803ff121">OpenCV Interpolation Guide</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Computer_Vision/03_Color_Spaces.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Color Spaces</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Computer_Vision/05_Image_Filtering.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Image Filtering</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}