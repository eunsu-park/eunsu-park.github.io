{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Detection - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Computer_Vision/">Computer Vision</a>
    <span class="separator">/</span>
    <span class="current">Feature Detection</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Feature Detection</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Computer_Vision/12_Histogram_Analysis.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Histogram Analysis</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Computer_Vision/14_Feature_Matching.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Feature Matching</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-feature-point-fundamentals">1. Feature Point Fundamentals</a><ul>
<li><a href="#what-are-feature-points">What are Feature Points?</a></li>
<li><a href="#feature-detection-pipeline">Feature Detection Pipeline</a></li>
<li><a href="#detector-comparison">Detector Comparison</a></li>
</ul>
</li>
<li><a href="#2-corner-detection-harris">2. Corner Detection - Harris</a><ul>
<li><a href="#concept">Concept</a></li>
<li><a href="#cv2cornerharris">cv2.cornerHarris()</a></li>
<li><a href="#sub-pixel-accuracy">Sub-pixel Accuracy</a></li>
</ul>
</li>
<li><a href="#3-good-features-to-track">3. Good Features to Track</a><ul>
<li><a href="#cv2goodfeaturestotrack">cv2.goodFeaturesToTrack()</a></li>
<li><a href="#using-mask-to-restrict-region">Using Mask to Restrict Region</a></li>
</ul>
</li>
<li><a href="#4-fast-detector">4. FAST Detector</a><ul>
<li><a href="#concept_1">Concept</a></li>
<li><a href="#cv2fastfeaturedetector">cv2.FastFeatureDetector</a></li>
<li><a href="#comparing-fast-thresholds">Comparing FAST Thresholds</a></li>
</ul>
</li>
<li><a href="#5-sift-detector">5. SIFT Detector</a><ul>
<li><a href="#concept_2">Concept</a></li>
<li><a href="#cv2sift_create">cv2.SIFT_create()</a></li>
<li><a href="#analyzing-sift-keypoints">Analyzing SIFT Keypoints</a></li>
</ul>
</li>
<li><a href="#6-orb-detector">6. ORB Detector</a><ul>
<li><a href="#concept_3">Concept</a></li>
<li><a href="#cv2orb_create">cv2.ORB_create()</a></li>
<li><a href="#sift-vs-orb-comparison">SIFT vs ORB Comparison</a></li>
</ul>
</li>
<li><a href="#7-keypoints-and-descriptors">7. Keypoints and Descriptors</a><ul>
<li><a href="#keypoint-structure">KeyPoint Structure</a></li>
<li><a href="#understanding-descriptors">Understanding Descriptors</a></li>
<li><a href="#using-various-detectors">Using Various Detectors</a></li>
</ul>
</li>
<li><a href="#8-practice-problems">8. Practice Problems</a><ul>
<li><a href="#problem-1-select-best-keypoints">Problem 1: Select Best Keypoints</a></li>
<li><a href="#problem-2-uniformly-distributed-keypoints">Problem 2: Uniformly Distributed Keypoints</a></li>
<li><a href="#problem-3-rotation-invariance-test">Problem 3: Rotation Invariance Test</a></li>
<li><a href="#recommended-problems">Recommended Problems</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="feature-detection">Feature Detection<a class="header-link" href="#feature-detection" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Features are unique and repeatable points that can be detected in an image. These include corners, blobs, edge intersections, and more. They are used in image matching, object recognition, 3D reconstruction, and other applications. In this lesson, we will learn about various feature detection algorithms including Harris, FAST, SIFT, and ORB.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-feature-point-fundamentals">Feature Point Fundamentals</a></li>
<li><a href="#2-corner-detection---harris">Corner Detection - Harris</a></li>
<li><a href="#3-good-features-to-track">Good Features to Track</a></li>
<li><a href="#4-fast-detector">FAST Detector</a></li>
<li><a href="#5-sift-detector">SIFT Detector</a></li>
<li><a href="#6-orb-detector">ORB Detector</a></li>
<li><a href="#7-keypoints-and-descriptors">Keypoints and Descriptors</a></li>
<li><a href="#8-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-feature-point-fundamentals">1. Feature Point Fundamentals<a class="header-link" href="#1-feature-point-fundamentals" title="Permanent link">&para;</a></h2>
<h3 id="what-are-feature-points">What are Feature Points?<a class="header-link" href="#what-are-feature-points" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Feature</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Keypoint</span><span class="p">:</span>
<span class="n">A</span><span class="w"> </span><span class="n">uniquely</span><span class="w"> </span><span class="n">identifiable</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">image</span>

<span class="n">Requirements</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Good</span><span class="w"> </span><span class="n">Features</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Repeatability</span><span class="p">:</span><span class="w"> </span><span class="n">Same</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">produce</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">features</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Distinctiveness</span><span class="p">:</span><span class="w"> </span><span class="n">Different</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">distinguishable</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Invariance</span><span class="p">:</span><span class="w"> </span><span class="n">Robust</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">rotation</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">lighting</span><span class="w"> </span><span class="n">changes</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Accuracy</span><span class="p">:</span><span class="w"> </span><span class="n">Precise</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">detection</span>

<span class="n">Types</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Features</span><span class="p">:</span>
<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span><span class="w">  </span><span class="n">Corner</span><span class="w">                    </span><span class="n">Blob</span><span class="w">                              </span><span class="o">|</span>
<span class="o">|</span><span class="w">                                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="o">+------</span><span class="w">              </span><span class="o">*****</span><span class="w">                             </span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">                    </span><span class="o">*******</span><span class="w">                           </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="o">---+</span><span class="w">                    </span><span class="o">********</span><span class="w">                          </span><span class="o">|</span>
<span class="o">|</span><span class="w">                            </span><span class="o">*******</span><span class="w">                           </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="n">Change</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">two</span><span class="w">            </span><span class="o">*****</span><span class="w">                             </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="n">directions</span><span class="w">               </span><span class="n">Specific</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="n">size</span><span class="w">              </span><span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>
</code></pre></div>

<h3 id="feature-detection-pipeline">Feature Detection Pipeline<a class="header-link" href="#feature-detection-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Feature</span><span class="w"> </span><span class="n">Detection</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">keypoint</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">image</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Harris</span><span class="p">,</span><span class="w"> </span><span class="n">FAST</span><span class="p">,</span><span class="w"> </span><span class="n">SIFT</span><span class="p">,</span><span class="w"> </span><span class="ow">OR</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="mf">.</span>
<span class="w">         </span><span class="err">|</span>
<span class="w">         </span><span class="n">v</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Feature</span><span class="w"> </span><span class="n">Description</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">vector</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">keypoint</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">SIFT</span><span class="w"> </span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="ow">OR</span><span class="n">B</span><span class="w"> </span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="n">BRIEF</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="mf">.</span>
<span class="w">         </span><span class="err">|</span>
<span class="w">         </span><span class="n">v</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Feature</span><span class="w"> </span><span class="n">Matching</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Compare</span><span class="w"> </span><span class="n">descriptors</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">images</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">BFMatcher</span><span class="p">,</span><span class="w"> </span><span class="n">FLANN</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="mf">.</span>
</code></pre></div>

<h3 id="detector-comparison">Detector Comparison<a class="header-link" href="#detector-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nb">+----------------+-----------+-----------+-----------+----------+</span>
<span class="c">| Algorithm      | Speed     | Rotation  | Scale     | Patent   |</span>
<span class="c">|                |           | Invariant | Invariant |          |</span>
<span class="nb">+----------------+-----------+-----------+-----------+----------+</span>
<span class="c">| Harris         | Fast      | O         | X         | None     |</span>
<span class="c">| FAST           | Very Fast | X         | X         | None     |</span>
<span class="c">| SIFT           | Slow      | O         | O         | Expired  |</span>
<span class="c">| SURF           | Medium    | O         | O         | Yes      |</span>
<span class="c">| ORB            | Fast      | O         | O         | None     |</span>
<span class="c">| AKAZE          | Medium    | O         | O         | None     |</span>
<span class="nb">+----------------+-----------+-----------+-----------+----------+</span>
</code></pre></div>

<hr />
<h2 id="2-corner-detection-harris">2. Corner Detection - Harris<a class="header-link" href="#2-corner-detection-harris" title="Permanent link">&para;</a></h2>
<h3 id="concept">Concept<a class="header-link" href="#concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Harris</span><span class="w"> </span><span class="n">Corner</span><span class="w"> </span><span class="nl">Detection:</span>
<span class="n">Analyzes</span><span class="w"> </span><span class="n">intensity</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">shifting</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">patch</span>

<span class="o">-</span><span class="w"> </span><span class="n">Flat</span><span class="w"> </span><span class="nl">region:</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">direction</span>
<span class="o">-</span><span class="w"> </span><span class="nl">Edge:</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">along</span><span class="w"> </span><span class="k">edge</span><span class="w"> </span><span class="n">direction</span><span class="p">,</span><span class="w"> </span><span class="k">large</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">perpendicular</span>
<span class="o">-</span><span class="w"> </span><span class="nl">Corner:</span><span class="w"> </span><span class="n">Large</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">directions</span>

<span class="n">Auto</span><span class="o">-</span><span class="n">correlation</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="nl">M:</span>
<span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="p">[</span><span class="n">Ix</span><span class="o">^</span><span class="mh">2</span><span class="w">    </span><span class="n">IxIy</span><span class="p">]</span>
<span class="w">        </span><span class="p">[</span><span class="n">IxIy</span><span class="w">   </span><span class="n">Iy</span><span class="o">^</span><span class="mh">2</span><span class="w"> </span><span class="p">]</span>

<span class="n">Ix</span><span class="p">,</span><span class="w"> </span><span class="nl">Iy:</span><span class="w"> </span><span class="n">Derivatives</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">directions</span>

<span class="n">Corner</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="nl">Function:</span>
<span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">det</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">trace</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">^</span><span class="mh">2</span>
<span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda1</span><span class="o">*</span><span class="n">lambda2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="p">(</span><span class="n">lambda1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lambda2</span><span class="p">)</span><span class="o">^</span><span class="mh">2</span>

<span class="o">-</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nl">threshold:</span><span class="w"> </span><span class="n">Corner</span>
<span class="o">-</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mh">0</span><span class="o">:</span><span class="w"> </span><span class="n">Flat</span>
<span class="o">-</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0</span><span class="o">:</span><span class="w"> </span><span class="n">Edge</span>
</code></pre></div>

<h3 id="cv2cornerharris">cv2.cornerHarris()<a class="header-link" href="#cv2cornerharris" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">harris_corner_detection</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Harris corner detection&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">gray</span><span class="p">)</span>

    <span class="c1"># Harris corner detection</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cornerHarris</span><span class="p">(</span>
        <span class="n">gray</span><span class="p">,</span>
        <span class="n">blockSize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>     <span class="c1"># Neighborhood size</span>
        <span class="n">ksize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>         <span class="c1"># Sobel kernel size</span>
        <span class="n">k</span><span class="o">=</span><span class="mf">0.04</span>           <span class="c1"># Harris parameter</span>
    <span class="p">)</span>

    <span class="c1"># Dilate result (emphasize corners)</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Mark corners above threshold</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">result</span><span class="p">[</span><span class="n">dst</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Harris Corners&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dst</span>

<span class="n">harris_corner_detection</span><span class="p">(</span><span class="s1">&#39;chessboard.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="sub-pixel-accuracy">Sub-pixel Accuracy<a class="header-link" href="#sub-pixel-accuracy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">harris_subpixel</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Harris corners with sub-pixel accuracy&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">gray_float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">gray</span><span class="p">)</span>

    <span class="c1"># Harris corners</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cornerHarris</span><span class="p">(</span><span class="n">gray_float</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">)</span>

    <span class="c1"># Extract corner locations</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">dst_thresh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dst_thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">dst_thresh</span><span class="p">)</span>

    <span class="c1"># Find corner centroids using connected components</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">centroids</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">connectedComponentsWithStats</span><span class="p">(</span><span class="n">dst_thresh</span><span class="p">)</span>

    <span class="c1"># Refine to sub-pixel precision</span>
    <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_EPS</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_MAX_ITER</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cornerSubPix</span><span class="p">(</span>
        <span class="n">gray</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">centroids</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>      <span class="c1"># Window size</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>    <span class="c1"># Zero zone</span>
        <span class="n">criteria</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">corner</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corners</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># First one is background</span>
            <span class="k">continue</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;SubPixel Corners&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">corners</span>

<span class="n">harris_subpixel</span><span class="p">(</span><span class="s1">&#39;chessboard.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="3-good-features-to-track">3. Good Features to Track<a class="header-link" href="#3-good-features-to-track" title="Permanent link">&para;</a></h2>
<h3 id="cv2goodfeaturestotrack">cv2.goodFeaturesToTrack()<a class="header-link" href="#cv2goodfeaturestotrack" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Shi</span><span class="o">-</span><span class="n">Tomasi</span><span class="w"> </span><span class="n">Corner</span><span class="w"> </span><span class="n">Detection</span><span class="w"> </span><span class="p">(</span><span class="n">Harris</span><span class="w"> </span><span class="n">improvement</span><span class="p">)</span><span class="o">:</span>
<span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">lambda1</span><span class="p">,</span><span class="w"> </span><span class="n">lambda2</span><span class="p">)</span>

<span class="n">More</span><span class="w"> </span><span class="n">stable</span><span class="w"> </span><span class="n">corner</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">Harris</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="n">Suitable</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">optical</span><span class="w"> </span><span class="n">flow</span><span class="w"> </span><span class="n">tracking</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">good_features_demo</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Good features detection&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># Detect good features</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">goodFeaturesToTrack</span><span class="p">(</span>
        <span class="n">gray</span><span class="p">,</span>
        <span class="n">maxCorners</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>     <span class="c1"># Maximum number of corners</span>
        <span class="n">qualityLevel</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>  <span class="c1"># Quality level (ratio of max response)</span>
        <span class="n">minDistance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>     <span class="c1"># Minimum distance between corners</span>
        <span class="n">blockSize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>        <span class="c1"># Neighborhood size</span>
        <span class="n">useHarrisDetector</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Use Shi-Tomasi</span>
        <span class="n">k</span><span class="o">=</span><span class="mf">0.04</span>              <span class="c1"># Harris parameter (when using Harris)</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">corners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">corner</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected corners: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Good Features&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">corners</span>

<span class="n">good_features_demo</span><span class="p">(</span><span class="s1">&#39;building.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="using-mask-to-restrict-region">Using Mask to Restrict Region<a class="header-link" href="#using-mask-to-restrict-region" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">features_with_mask</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect features only in specific region&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">gray</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># Create ROI mask (center region only)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">h</span><span class="o">//</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">w</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">h</span><span class="o">//</span><span class="mi">4</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Detect features only in masked region</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">goodFeaturesToTrack</span><span class="p">(</span>
        <span class="n">gray</span><span class="p">,</span>
        <span class="n">maxCorners</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">qualityLevel</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">minDistance</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="n">mask</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Show mask region</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">h</span><span class="o">//</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">w</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">h</span><span class="o">//</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">corners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">corner</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Features with Mask&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">features_with_mask</span><span class="p">(</span><span class="s1">&#39;scene.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="4-fast-detector">4. FAST Detector<a class="header-link" href="#4-fast-detector" title="Permanent link">&para;</a></h2>
<h3 id="concept_1">Concept<a class="header-link" href="#concept_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">FAST</span><span class="w"> </span><span class="p">(</span><span class="n">Features</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Accelerated</span><span class="w"> </span><span class="n">Segment</span><span class="w"> </span><span class="n">Test</span><span class="p">):</span>
<span class="n">Very</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="n">corner</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="n">algorithm</span>

<span class="n">Principle</span><span class="p">:</span>
<span class="n">Examine</span><span class="w"> </span><span class="n">circular</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="n">pixels</span><span class="p">)</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">center</span><span class="w"> </span><span class="n">pixel</span><span class="w"> </span><span class="n">P</span>

<span class="w">        </span><span class="mi">1</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">3</span>
<span class="w">     </span><span class="mi">16</span><span class="w">           </span><span class="mi">4</span>
<span class="w">   </span><span class="mi">15</span><span class="w">               </span><span class="mi">5</span>
<span class="w">  </span><span class="mi">14</span><span class="w">        </span><span class="n">P</span><span class="w">        </span><span class="mi">6</span>
<span class="w">   </span><span class="mi">13</span><span class="w">               </span><span class="mi">7</span>
<span class="w">     </span><span class="mi">12</span><span class="w">          </span><span class="mi">8</span>
<span class="w">        </span><span class="mi">11</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">9</span>

<span class="n">Decision</span><span class="w"> </span><span class="n">criterion</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
<span class="o">-</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">consecutive</span><span class="w"> </span><span class="n">pixels</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">brighter</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">P</span><span class="p">:</span><span class="w"> </span><span class="n">Corner</span>
<span class="o">-</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">consecutive</span><span class="w"> </span><span class="n">pixels</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">darker</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">P</span><span class="p">:</span><span class="w"> </span><span class="n">Corner</span>

<span class="n">Characteristics</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Very</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="p">(</span><span class="n">real</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">processing</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">rotation</span><span class="w"> </span><span class="n">invariance</span>
<span class="o">-</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="n">invariance</span>
<span class="o">-</span><span class="w"> </span><span class="n">Non</span><span class="o">-</span><span class="n">maximum</span><span class="w"> </span><span class="n">suppression</span><span class="w"> </span><span class="p">(</span><span class="n">NMS</span><span class="p">)</span><span class="w"> </span><span class="n">prevents</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">detections</span>
</code></pre></div>

<h3 id="cv2fastfeaturedetector">cv2.FastFeatureDetector<a class="header-link" href="#cv2fastfeaturedetector" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fast_detection</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FAST feature detection&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># Create FAST detector</span>
    <span class="n">fast</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FastFeatureDetector_create</span><span class="p">(</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>           <span class="c1"># Intensity threshold</span>
        <span class="n">nonmaxSuppression</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Non-maximum suppression</span>
    <span class="p">)</span>

    <span class="c1"># Detect features</span>
    <span class="n">keypoints</span> <span class="o">=</span> <span class="n">fast</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Draw results</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">keypoints</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">keypoints</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;FAST&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">keypoints</span>

<span class="n">fast_detection</span><span class="p">(</span><span class="s1">&#39;building.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="comparing-fast-thresholds">Comparing FAST Thresholds<a class="header-link" href="#comparing-fast-thresholds" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compare_fast_thresholds</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare FAST thresholds&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">thresh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>
        <span class="n">fast</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FastFeatureDetector_create</span><span class="p">(</span>
            <span class="n">threshold</span><span class="o">=</span><span class="n">thresh</span><span class="p">,</span>
            <span class="n">nonmaxSuppression</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">kps</span> <span class="o">=</span> <span class="n">fast</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">kps</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Threshold=</span><span class="si">{</span><span class="n">thresh</span><span class="si">}</span><span class="s1">, Points=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">kps</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">compare_fast_thresholds</span><span class="p">(</span><span class="s1">&#39;building.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="5-sift-detector">5. SIFT Detector<a class="header-link" href="#5-sift-detector" title="Permanent link">&para;</a></h2>
<h3 id="concept_2">Concept<a class="header-link" href="#concept_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">SIFT</span><span class="w"> </span><span class="p">(</span><span class="n">Scale</span><span class="o">-</span><span class="n">Invariant</span><span class="w"> </span><span class="n">Feature</span><span class="w"> </span><span class="nb nb-Type">Transform</span><span class="p">):</span>
<span class="n">Feature</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="n">invariant</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">rotation</span>

<span class="n">Steps</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Scale</span><span class="o">-</span><span class="n">space</span><span class="w"> </span><span class="n">extrema</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="p">(</span><span class="n">DoG</span><span class="p">:</span><span class="w"> </span><span class="n">Difference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Gaussians</span><span class="p">)</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Keypoint</span><span class="w"> </span><span class="n">localization</span><span class="w"> </span><span class="p">(</span><span class="n">sub</span><span class="o">-</span><span class="n">pixel</span><span class="w"> </span><span class="n">accuracy</span><span class="p">,</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="n">removal</span><span class="p">)</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Orientation</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="p">(</span><span class="n">gradient</span><span class="w"> </span><span class="n">histogram</span><span class="p">)</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Descriptor</span><span class="w"> </span><span class="n">computation</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="n">x4</span><span class="w"> </span><span class="n">grid</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">directions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="n">dimensions</span><span class="p">)</span>

<span class="n">Scale</span><span class="w"> </span><span class="n">Space</span><span class="p">:</span>
<span class="o">+-------------------------------------------------+</span>
<span class="o">|</span><span class="w">  </span><span class="n">Octave</span><span class="w"> </span><span class="mi">0</span><span class="w">    </span><span class="n">Octave</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="n">Octave</span><span class="w"> </span><span class="mi">2</span><span class="w">               </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="o">+-------+</span><span class="w">   </span><span class="o">+-----+</span><span class="w">    </span><span class="o">+---+</span><span class="w">                   </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">1.6</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">1.6</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="n">s</span><span class="o">=</span><span class="mf">1.6</span><span class="o">|</span><span class="w">  </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Scale</span><span class="o">-</span><span class="n">wise</span><span class="w">   </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="o">|</span><span class="w">     </span><span class="n">Gaussian</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="o">|</span><span class="w">     </span><span class="n">blur</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">3.2</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mf">3.2</span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="n">s</span><span class="o">=</span><span class="mf">3.2</span><span class="o">|</span><span class="w">                  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="o">+-------+</span><span class="w">   </span><span class="o">+-----+</span><span class="w">    </span><span class="o">+---+</span><span class="w">                   </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="n">Original</span><span class="w">    </span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="n">size</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="w"> </span><span class="n">size</span><span class="w">                </span><span class="o">|</span>
<span class="o">+-------------------------------------------------+</span>

<span class="n">DoG</span><span class="w"> </span><span class="p">(</span><span class="n">Difference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Gaussians</span><span class="p">):</span>
<span class="n">D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">*</span><span class="n">sigma</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">L</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">)</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="n">Blob</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">adjacent</span><span class="w"> </span><span class="n">scales</span>
</code></pre></div>

<h3 id="cv2sift_create">cv2.SIFT_create()<a class="header-link" href="#cv2sift_create" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sift_detection</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SIFT feature detection&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># Create SIFT detector</span>
    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">(</span>
        <span class="n">nfeatures</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>          <span class="c1"># Max features (0=unlimited)</span>
        <span class="n">nOctaveLayers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>      <span class="c1"># Layers per octave</span>
        <span class="n">contrastThreshold</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span>  <span class="c1"># Contrast threshold</span>
        <span class="n">edgeThreshold</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>     <span class="c1"># Edge threshold</span>
        <span class="n">sigma</span><span class="o">=</span><span class="mf">1.6</span>             <span class="c1"># Initial Gaussian sigma</span>
    <span class="p">)</span>

    <span class="c1"># Compute keypoints and descriptors</span>
    <span class="n">keypoints</span><span class="p">,</span> <span class="n">descriptors</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Draw results</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">keypoints</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">keypoints</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">descriptors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Descriptor size: </span><span class="si">{</span><span class="n">descriptors</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;SIFT&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">keypoints</span><span class="p">,</span> <span class="n">descriptors</span>

<span class="n">kps</span><span class="p">,</span> <span class="n">descs</span> <span class="o">=</span> <span class="n">sift_detection</span><span class="p">(</span><span class="s1">&#39;object.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="analyzing-sift-keypoints">Analyzing SIFT Keypoints<a class="header-link" href="#analyzing-sift-keypoints" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_sift_keypoints</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detailed analysis of SIFT keypoints&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">keypoints</span><span class="p">,</span> <span class="n">descriptors</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SIFT Keypoint Analysis:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="c1"># Keypoint attributes</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keypoints</span><span class="p">[:</span><span class="mi">5</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keypoint </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Location (x, y): (</span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Size (scale): </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">size</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Angle: </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">angle</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> degrees&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Response: </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">response</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Octave: </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">octave</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Scale distribution</span>
    <span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="n">kp</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="n">keypoints</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Scale range: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> ~ </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Descriptor analysis</span>
    <span class="k">if</span> <span class="n">descriptors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Descriptors:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Dimensions: </span><span class="si">{</span><span class="n">descriptors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Value range: </span><span class="si">{</span><span class="n">descriptors</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> ~ </span><span class="si">{</span><span class="n">descriptors</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">analyze_sift_keypoints</span><span class="p">(</span><span class="s1">&#39;object.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6-orb-detector">6. ORB Detector<a class="header-link" href="#6-orb-detector" title="Permanent link">&para;</a></h2>
<h3 id="concept_3">Concept<a class="header-link" href="#concept_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">ORB</span><span class="w"> </span><span class="p">(</span><span class="n">Oriented</span><span class="w"> </span><span class="n">FAST</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">Rotated</span><span class="w"> </span><span class="n">BRIEF</span><span class="p">):</span>
<span class="n">Improved</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">FAST</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">BRIEF</span><span class="p">,</span><span class="w"> </span><span class="n">patent</span><span class="o">-</span><span class="n">free</span>

<span class="n">Components</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">oFAST</span><span class="p">:</span><span class="w"> </span><span class="n">FAST</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">orientation</span><span class="w"> </span><span class="n">information</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Computes</span><span class="w"> </span><span class="n">orientation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">rotation</span><span class="w"> </span><span class="n">invariance</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="n">pyramid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="n">invariance</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">rBRIEF</span><span class="p">:</span><span class="w"> </span><span class="n">Rotated</span><span class="w"> </span><span class="n">BRIEF</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">BRIEF</span><span class="p">:</span><span class="w"> </span><span class="n">Binary</span><span class="w"> </span><span class="n">descriptor</span><span class="w"> </span><span class="p">(</span><span class="mi">256</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Learned</span><span class="w"> </span><span class="n">comparison</span><span class="w"> </span><span class="n">patterns</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">discrimination</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Fast</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Hamming</span><span class="w"> </span><span class="n">distance</span>

<span class="n">Characteristics</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Much</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">SIFT</span><span class="o">/</span><span class="n">SURF</span>
<span class="o">-</span><span class="w"> </span><span class="n">Patent</span><span class="o">-</span><span class="n">free</span>
<span class="o">-</span><span class="w"> </span><span class="n">Suitable</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">real</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">processing</span>
<span class="o">-</span><span class="w"> </span><span class="n">Binary</span><span class="w"> </span><span class="n">descriptor</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fast</span><span class="w"> </span><span class="n">matching</span>

<span class="n">BRIEF</span><span class="w"> </span><span class="n">Descriptor</span><span class="p">:</span>
<span class="n">Compare</span><span class="w"> </span><span class="n">intensities</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">patch</span>
<span class="n">tau</span><span class="p">(</span><span class="n">P</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">P</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="w">               </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">otherwise</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">comparisons</span><span class="w"> </span><span class="nb">yield</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">string</span>
</code></pre></div>

<h3 id="cv2orb_create">cv2.ORB_create()<a class="header-link" href="#cv2orb_create" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">orb_detection</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ORB feature detection&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># Create ORB detector</span>
    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">(</span>
        <span class="n">nfeatures</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>        <span class="c1"># Maximum features</span>
        <span class="n">scaleFactor</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>      <span class="c1"># Pyramid scale factor</span>
        <span class="n">nlevels</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>            <span class="c1"># Number of pyramid levels</span>
        <span class="n">edgeThreshold</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span>     <span class="c1"># Edge threshold</span>
        <span class="n">firstLevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>         <span class="c1"># First pyramid level</span>
        <span class="n">WTA_K</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>              <span class="c1"># Points to compare in BRIEF (2, 3, 4)</span>
        <span class="n">scoreType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">ORB_HARRIS_SCORE</span><span class="p">,</span>  <span class="c1"># Score type</span>
        <span class="n">patchSize</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span>         <span class="c1"># BRIEF patch size</span>
        <span class="n">fastThreshold</span><span class="o">=</span><span class="mi">20</span>      <span class="c1"># FAST threshold</span>
    <span class="p">)</span>

    <span class="c1"># Compute keypoints and descriptors</span>
    <span class="n">keypoints</span><span class="p">,</span> <span class="n">descriptors</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Draw results</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">keypoints</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">keypoints</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">descriptors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Descriptor size: </span><span class="si">{</span><span class="n">descriptors</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Descriptor type: </span><span class="si">{</span><span class="n">descriptors</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># uint8 (binary)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;ORB&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">keypoints</span><span class="p">,</span> <span class="n">descriptors</span>

<span class="n">kps</span><span class="p">,</span> <span class="n">descs</span> <span class="o">=</span> <span class="n">orb_detection</span><span class="p">(</span><span class="s1">&#39;object.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="sift-vs-orb-comparison">SIFT vs ORB Comparison<a class="header-link" href="#sift-vs-orb-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compare_sift_orb</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare SIFT and ORB performance&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># SIFT</span>
    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">kps_sift</span><span class="p">,</span> <span class="n">descs_sift</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">sift_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># ORB</span>
    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">(</span><span class="n">nfeatures</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">kps_sift</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">kps_orb</span><span class="p">,</span> <span class="n">descs_orb</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">orb_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performance Comparison:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SIFT: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">kps_sift</span><span class="p">)</span><span class="si">}</span><span class="s2"> points, </span><span class="si">{</span><span class="n">sift_time</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ORB:  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">kps_orb</span><span class="p">)</span><span class="si">}</span><span class="s2"> points, </span><span class="si">{</span><span class="n">orb_time</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speed ratio: ORB is </span><span class="si">{</span><span class="n">sift_time</span><span class="o">/</span><span class="n">orb_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x faster&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">descs_sift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">descs_orb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SIFT descriptor: </span><span class="si">{</span><span class="n">descs_sift</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">descs_sift</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ORB descriptor: </span><span class="si">{</span><span class="n">descs_orb</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">descs_orb</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Visualization</span>
    <span class="n">result_sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">kps_sift</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">result_orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">kps_orb</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">result_sift</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SIFT: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">kps_sift</span><span class="p">)</span><span class="si">}</span><span class="s1"> points&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">result_orb</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ORB: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">kps_orb</span><span class="p">)</span><span class="si">}</span><span class="s1"> points&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">compare_sift_orb</span><span class="p">(</span><span class="s1">&#39;object.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="7-keypoints-and-descriptors">7. Keypoints and Descriptors<a class="header-link" href="#7-keypoints-and-descriptors" title="Permanent link">&para;</a></h2>
<h3 id="keypoint-structure">KeyPoint Structure<a class="header-link" href="#keypoint-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">keypoint_structure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Understanding keypoint structure&quot;&quot;&quot;</span>
    <span class="c1"># Manually create keypoint</span>
    <span class="n">kp</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">KeyPoint</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mf">100.5</span><span class="p">,</span>        <span class="c1"># x coordinate</span>
        <span class="n">y</span><span class="o">=</span><span class="mf">200.5</span><span class="p">,</span>        <span class="c1"># y coordinate</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>        <span class="c1"># Feature size (diameter)</span>
        <span class="n">angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>       <span class="c1"># Orientation (degrees)</span>
        <span class="n">response</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>   <span class="c1"># Response strength</span>
        <span class="n">octave</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>       <span class="c1"># Octave (scale)</span>
        <span class="n">class_id</span><span class="o">=-</span><span class="mi">1</span>     <span class="c1"># Class ID</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KeyPoint Attributes:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Location: (</span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Size: </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Angle: </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">angle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Response: </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Octave: </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">octave</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Class ID: </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">class_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">keypoint_structure</span><span class="p">()</span>
</code></pre></div>

<h3 id="understanding-descriptors">Understanding Descriptors<a class="header-link" href="#understanding-descriptors" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_descriptors</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize descriptors&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

    <span class="c1"># SIFT descriptor (128-dimensional float)</span>
    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">kps_sift</span><span class="p">,</span> <span class="n">descs_sift</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># ORB descriptor (32 bytes = 256 bits)</span>
    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">()</span>
    <span class="n">kps_orb</span><span class="p">,</span> <span class="n">descs_orb</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># SIFT descriptor histogram</span>
    <span class="k">if</span> <span class="n">descs_sift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">descs_sift</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span> <span class="n">descs_sift</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SIFT Descriptor (128D)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension&#39;</span><span class="p">)</span>

        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">descs_sift</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SIFT Descriptors (first 50)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Keypoint&#39;</span><span class="p">)</span>

    <span class="c1"># ORB descriptor (binary)</span>
    <span class="k">if</span> <span class="n">descs_orb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">descs_orb</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Convert binary to bits</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unpackbits</span><span class="p">(</span><span class="n">descs_orb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">bits</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ORB Descriptor (256 bits)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Bit&#39;</span><span class="p">)</span>

        <span class="c1"># Multiple descriptors</span>
        <span class="n">bits_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unpackbits</span><span class="p">(</span><span class="n">descs_orb</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bits_all</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ORB Descriptors (first 50)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Bit&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Keypoint&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">visualize_descriptors</span><span class="p">(</span><span class="s1">&#39;object.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="using-various-detectors">Using Various Detectors<a class="header-link" href="#using-various-detectors" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">use_various_detectors</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use various feature detectors&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="n">detectors</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;SIFT&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">(),</span>
        <span class="s1">&#39;ORB&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">(),</span>
        <span class="s1">&#39;BRISK&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BRISK_create</span><span class="p">(),</span>
        <span class="s1">&#39;AKAZE&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">AKAZE_create</span><span class="p">(),</span>
        <span class="c1"># &#39;KAZE&#39;: cv2.KAZE_create(),  # Slow</span>
    <span class="p">}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">detector</span> <span class="ow">in</span> <span class="n">detectors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">kps</span><span class="p">,</span> <span class="n">descs</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;keypoints&#39;</span><span class="p">:</span> <span class="n">kps</span><span class="p">,</span>
            <span class="s1">&#39;descriptors&#39;</span><span class="p">:</span> <span class="n">descs</span><span class="p">,</span>
            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">kps</span><span class="p">),</span>
            <span class="s1">&#39;desc_size&#39;</span><span class="p">:</span> <span class="n">descs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">descs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Feature count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">kps</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">descs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Descriptor: </span><span class="si">{</span><span class="n">descs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">descs</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">use_various_detectors</span><span class="p">(</span><span class="s1">&#39;object.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="8-practice-problems">8. Practice Problems<a class="header-link" href="#8-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-select-best-keypoints">Problem 1: Select Best Keypoints<a class="header-link" href="#problem-1-select-best-keypoints" title="Permanent link">&para;</a></h3>
<p>Select only the 50 strongest keypoints from an image.</p>
<details>
<summary>Solution Code</summary>


<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">select_best_keypoints</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select N strongest keypoints&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># Detect many keypoints with ORB</span>
    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">(</span><span class="n">nfeatures</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">keypoints</span><span class="p">,</span> <span class="n">descriptors</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Sort by response strength</span>
    <span class="n">keypoints_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keypoints</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Select top N</span>
    <span class="n">best_keypoints</span> <span class="o">=</span> <span class="n">keypoints_sorted</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>

    <span class="c1"># Select corresponding descriptors</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">keypoints</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">kp</span><span class="p">)</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="n">best_keypoints</span><span class="p">]</span>
    <span class="n">best_descriptors</span> <span class="o">=</span> <span class="n">descriptors</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="k">if</span> <span class="n">descriptors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">best_keypoints</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span>
    <span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> Keypoints&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">best_keypoints</span><span class="p">,</span> <span class="n">best_descriptors</span>

<span class="n">kps</span><span class="p">,</span> <span class="n">descs</span> <span class="o">=</span> <span class="n">select_best_keypoints</span><span class="p">(</span><span class="s1">&#39;building.jpg&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>



</details>

<h3 id="problem-2-uniformly-distributed-keypoints">Problem 2: Uniformly Distributed Keypoints<a class="header-link" href="#problem-2-uniformly-distributed-keypoints" title="Permanent link">&para;</a></h3>
<p>Divide the image into a grid and select one keypoint from each cell.</p>
<details>
<summary>Solution Code</summary>


<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">uniform_keypoints</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select keypoints uniformly per grid cell&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">gray</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">(</span><span class="n">nfeatures</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">keypoints</span><span class="p">,</span> <span class="n">descriptors</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Calculate grid size</span>
    <span class="n">cell_h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="n">grid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cell_w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="n">grid_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Select strongest keypoint per cell</span>
    <span class="n">selected_kps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">selected_indices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># Cell region</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="n">col</span> <span class="o">*</span> <span class="n">cell_w</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cell_w</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="n">row</span> <span class="o">*</span> <span class="n">cell_h</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cell_h</span>

            <span class="c1"># Filter keypoints in cell</span>
            <span class="n">cell_kps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keypoints</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x_min</span> <span class="o">&lt;=</span> <span class="n">kp</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x_max</span> <span class="ow">and</span> <span class="n">y_min</span> <span class="o">&lt;=</span> <span class="n">kp</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">:</span>
                    <span class="n">cell_kps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">kp</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">cell_kps</span><span class="p">:</span>
                <span class="c1"># Select strongest keypoint</span>
                <span class="n">best_idx</span><span class="p">,</span> <span class="n">best_kp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cell_kps</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
                <span class="n">selected_kps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_kp</span><span class="p">)</span>
                <span class="n">selected_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_idx</span><span class="p">)</span>

    <span class="c1"># Descriptors</span>
    <span class="n">selected_descs</span> <span class="o">=</span> <span class="n">descriptors</span><span class="p">[</span><span class="n">selected_indices</span><span class="p">]</span> <span class="k">if</span> <span class="n">descriptors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">selected_kps</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span>
    <span class="p">)</span>

    <span class="c1"># Draw grid</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">*</span> <span class="n">cell_h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">row</span> <span class="o">*</span> <span class="n">cell_h</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span> <span class="o">*</span> <span class="n">cell_w</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">col</span> <span class="o">*</span> <span class="n">cell_w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Uniform Keypoints&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">selected_kps</span><span class="p">,</span> <span class="n">selected_descs</span>

<span class="n">kps</span><span class="p">,</span> <span class="n">descs</span> <span class="o">=</span> <span class="n">uniform_keypoints</span><span class="p">(</span><span class="s1">&#39;building.jpg&#39;</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</code></pre></div>



</details>

<h3 id="problem-3-rotation-invariance-test">Problem 3: Rotation Invariance Test<a class="header-link" href="#problem-3-rotation-invariance-test" title="Permanent link">&para;</a></h3>
<p>Rotate an image and verify that the same features are detected.</p>
<details>
<summary>Solution Code</summary>


<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_rotation_invariance</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">45</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test rotation invariance&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">gray</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># Rotate image</span>
    <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

    <span class="c1"># SIFT (rotation invariant)</span>
    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">(</span><span class="n">nfeatures</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">kps1</span><span class="p">,</span> <span class="n">descs1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kps2</span><span class="p">,</span> <span class="n">descs2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">rotated</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Feature matching</span>
    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">descs1</span><span class="p">,</span> <span class="n">descs2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Filter good matches (Lowe&#39;s ratio test)</span>
    <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
            <span class="n">good_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">kps1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rotated image features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">kps2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matched features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Match rate: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">kps1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="c1"># Visualization</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawMatches</span><span class="p">(</span>
        <span class="n">gray</span><span class="p">,</span> <span class="n">kps1</span><span class="p">,</span> <span class="n">rotated</span><span class="p">,</span> <span class="n">kps2</span><span class="p">,</span>
        <span class="n">good_matches</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_NOT_DRAW_SINGLE_POINTS</span>
    <span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Rotation Invariance Test&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">test_rotation_invariance</span><span class="p">(</span><span class="s1">&#39;object.jpg&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div>



</details>

<h3 id="recommended-problems">Recommended Problems<a class="header-link" href="#recommended-problems" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Difficulty</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>Basic Detection</td>
<td>Compare Harris, FAST, ORB</td>
</tr>
<tr>
<td>**</td>
<td>Performance Comparison</td>
<td>Compare detection speed and count</td>
</tr>
<tr>
<td>**</td>
<td>Parameter Tuning</td>
<td>Find optimal parameters</td>
</tr>
<tr>
<td>***</td>
<td>Scale Invariance</td>
<td>Test against size changes</td>
</tr>
<tr>
<td>***</td>
<td>Real-time Detection</td>
<td>Display features in real-time from webcam</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./14_Feature_Matching.md">14_Feature_Matching.md</a> - BFMatcher, FLANN, Homography</li>
</ul>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.opencv.org/4.x/db/d27/tutorial_py_table_of_contents_feature2d.html">OpenCV Feature Detection</a></li>
<li><a href="https://www.cs.ubc.ca/~lowe/papers/ijcv04.pdf">SIFT Paper</a></li>
<li><a href="https://www.willowgarage.com/sites/default/files/orb_final.pdf">ORB Paper</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Computer_Vision/12_Histogram_Analysis.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Histogram Analysis</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Computer_Vision/14_Feature_Matching.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Feature Matching</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}