{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Neural Network Module (DNN Module) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Computer_Vision/">Computer Vision</a>
    <span class="separator">/</span>
    <span class="current">Deep Neural Network Module (DNN Module)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Deep Neural Network Module (DNN Module)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Computer_Vision/18_Camera_Calibration.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Camera Calibration</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Computer_Vision/20_Practical_Projects.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Practical Projects</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-cv2dnn-module-overview">1. cv2.dnn Module Overview</a><ul>
<li><a href="#dnn-module-features">DNN Module Features</a></li>
<li><a href="#basic-workflow">Basic Workflow</a></li>
</ul>
</li>
<li><a href="#2-readnet-model-loading">2. readNet(): Model Loading</a><ul>
<li><a href="#loading-various-model-formats">Loading Various Model Formats</a></li>
<li><a href="#backend-and-target-configuration">Backend and Target Configuration</a></li>
<li><a href="#checking-layer-information">Checking Layer Information</a></li>
</ul>
</li>
<li><a href="#3-blobfromimage-preprocessing">3. blobFromImage(): Preprocessing</a><ul>
<li><a href="#blob-concept">Blob Concept</a></li>
<li><a href="#using-blobfromimage">Using blobFromImage</a></li>
<li><a href="#processing-multiple-images">Processing Multiple Images</a></li>
<li><a href="#visualizing-preprocessing">Visualizing Preprocessing</a></li>
</ul>
</li>
<li><a href="#4-yolo-object-detection">4. YOLO Object Detection</a><ul>
<li><a href="#yolo-overview">YOLO Overview</a></li>
<li><a href="#yolov3-implementation">YOLOv3 Implementation</a></li>
<li><a href="#yolov3-tiny-lightweight-version">YOLOv3-tiny (Lightweight Version)</a></li>
</ul>
</li>
<li><a href="#5-ssd-single-shot-detector">5. SSD (Single Shot Detector)</a><ul>
<li><a href="#ssd-overview">SSD Overview</a></li>
<li><a href="#mobilenet-ssd-implementation">MobileNet SSD Implementation</a></li>
<li><a href="#caffe-ssd-lightweight">Caffe SSD (Lightweight)</a></li>
</ul>
</li>
<li><a href="#6-dnn-face-detection">6. DNN Face Detection</a><ul>
<li><a href="#opencv-dnn-face-detector">OpenCV DNN Face Detector</a></li>
<li><a href="#real-time-dnn-face-detection">Real-time DNN Face Detection</a></li>
<li><a href="#haar-vs-dnn-face-detection-comparison">Haar vs DNN Face Detection Comparison</a></li>
</ul>
</li>
<li><a href="#7-modern-object-detection-with-onnx">7. Modern Object Detection with ONNX</a><ul>
<li><a href="#71-running-yolov8-with-opencv-dnn">7.1 Running YOLOv8 with OpenCV DNN</a></li>
<li><a href="#72-sam-segment-anything-model-with-onnx">7.2 SAM (Segment Anything Model) with ONNX</a></li>
<li><a href="#73-model-zoo-and-current-landscape-2025">7.3 Model Zoo and Current Landscape (2025)</a><ul>
<li><a href="#731-quick-start-yolov11-with-onnx">7.3.1 Quick Start: YOLOv11 with ONNX</a></li>
<li><a href="#732-rt-detr-transformer-based-detection">7.3.2 RT-DETR: Transformer-based Detection</a></li>
<li><a href="#733-model-selection-guide">7.3.3 Model Selection Guide</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#8-exercises">8. Exercises</a><ul>
<li><a href="#exercise-1-object-detection-performance-comparison">Exercise 1: Object Detection Performance Comparison</a></li>
<li><a href="#exercise-2-custom-class-filtering">Exercise 2: Custom Class Filtering</a></li>
<li><a href="#exercise-3-video-object-tracking-detection">Exercise 3: Video Object Tracking + Detection</a></li>
<li><a href="#exercise-4-model-ensemble">Exercise 4: Model Ensemble</a></li>
<li><a href="#exercise-5-real-time-object-counting-system">Exercise 5: Real-time Object Counting System</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="deep-neural-network-module-dnn-module">Deep Neural Network Module (DNN Module)<a class="header-link" href="#deep-neural-network-module-dnn-module" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>OpenCV's DNN module provides functionality to load and run inference with pre-trained deep learning models. It supports models from various frameworks including TensorFlow, Caffe, Darknet, and ONNX, and can run efficiently on both CPU and GPU.</p>
<p><strong>Difficulty</strong>: â­â­â­â­</p>
<p><strong>Prerequisites</strong>: Deep learning fundamentals, object detection, image classification</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-cv2dnn-module-overview">cv2.dnn Module Overview</a></li>
<li><a href="#2-readnet-model-loading">readNet(): Model Loading</a></li>
<li><a href="#3-blobfromimage-preprocessing">blobFromImage(): Preprocessing</a></li>
<li><a href="#4-yolo-object-detection">YOLO Object Detection</a></li>
<li><a href="#5-ssd-single-shot-detector">SSD (Single Shot Detector)</a></li>
<li><a href="#6-dnn-face-detection">DNN Face Detection</a></li>
<li><a href="#7-modern-object-detection-with-onnx">Modern Object Detection with ONNX</a></li>
<li><a href="#8-exercises">Exercises</a></li>
</ol>
<hr />
<h2 id="1-cv2dnn-module-overview">1. cv2.dnn Module Overview<a class="header-link" href="#1-cv2dnn-module-overview" title="Permanent link">&para;</a></h2>
<h3 id="dnn-module-features">DNN Module Features<a class="header-link" href="#dnn-module-features" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">OpenCV</span><span class="w"> </span><span class="nx">DNN</span><span class="w"> </span><span class="nx">Module</span><span class="p">:</span>

<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                        </span><span class="nx">cv2</span><span class="p">.</span><span class="nx">dnn</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Supported</span><span class="w"> </span><span class="nx">Frameworks</span><span class="p">:</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">Caffe</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">TensorFlow</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">Darknet</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="nx">ONNX</span><span class="w">     </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(.</span><span class="nx">caffemodel</span><span class="p">,</span><span class="err">â”‚</span><span class="w"> </span><span class="p">(.</span><span class="nx">pb</span><span class="p">)</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(.</span><span class="nx">weights</span><span class="p">,</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(.</span><span class="nx">onnx</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="p">.</span><span class="nx">prototxt</span><span class="p">)</span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">   </span><span class="p">.</span><span class="nx">cfg</span><span class="p">)</span><span class="w">     </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Execution</span><span class="w"> </span><span class="nx">Backends</span><span class="p">:</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="nx">CPU</span><span class="w">      </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">OpenCL</span><span class="w">    </span><span class="err">â”‚</span><span class="w">    </span><span class="nx">CUDA</span><span class="w">     </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">Vulkan</span><span class="w">    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="k">default</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="nx">GPU</span><span class="p">)</span><span class="w">     </span><span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="nx">NVIDIA</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="nx">multi</span><span class="o">-</span><span class="nx">GPU</span><span class="p">)</span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Features</span><span class="p">:</span><span class="w">                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Inference</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="p">(</span><span class="nx">no</span><span class="w"> </span><span class="nx">training</span><span class="p">)</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Optimized</span><span class="w"> </span><span class="nx">operations</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Multiple</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">support</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Simple</span><span class="w"> </span><span class="nx">API</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="basic-workflow">Basic Workflow<a class="header-link" href="#basic-workflow" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>DNN Inference Workflow:

1. Model Loading
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  readNet()       â”‚ â†’ Load model file
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
2. Backend/Target Setup
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ setPreferableBackend()â”‚ â†’ CPU/CUDA/OpenCL
   â”‚ setPreferableTarget() â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
3. Input Preprocessing
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ blobFromImage()  â”‚ â†’ Image â†’ Blob
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
4. Run Inference
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ net.setInput()   â”‚
   â”‚ net.forward()    â”‚ â†’ Inference result
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
5. Post-processing
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ NMS, visualization, etc. â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-readnet-model-loading">2. readNet(): Model Loading<a class="header-link" href="#2-readnet-model-loading" title="Permanent link">&para;</a></h2>
<h3 id="loading-various-model-formats">Loading Various Model Formats<a class="header-link" href="#loading-various-model-formats" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># Loading Caffe model</span>
<span class="n">net_caffe</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span>
    <span class="s1">&#39;deploy.prototxt&#39;</span><span class="p">,</span>      <span class="c1"># Network structure</span>
    <span class="s1">&#39;model.caffemodel&#39;</span>      <span class="c1"># Weights</span>
<span class="p">)</span>

<span class="c1"># Loading TensorFlow model</span>
<span class="n">net_tf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromTensorflow</span><span class="p">(</span>
    <span class="s1">&#39;frozen_inference_graph.pb&#39;</span><span class="p">,</span>  <span class="c1"># Frozen graph</span>
    <span class="s1">&#39;graph.pbtxt&#39;</span>                 <span class="c1"># Text graph (optional)</span>
<span class="p">)</span>

<span class="c1"># Loading Darknet (YOLO) model</span>
<span class="n">net_darknet</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromDarknet</span><span class="p">(</span>
    <span class="s1">&#39;yolov3.cfg&#39;</span><span class="p">,</span>           <span class="c1"># Config file</span>
    <span class="s1">&#39;yolov3.weights&#39;</span>        <span class="c1"># Weights</span>
<span class="p">)</span>

<span class="c1"># Loading ONNX model</span>
<span class="n">net_onnx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="s1">&#39;model.onnx&#39;</span><span class="p">)</span>

<span class="c1"># Generic function (auto-detect)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNet</span><span class="p">(</span><span class="s1">&#39;model.weights&#39;</span><span class="p">,</span> <span class="s1">&#39;model.cfg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="backend-and-target-configuration">Backend and Target Configuration<a class="header-link" href="#backend-and-target-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNet</span><span class="p">(</span><span class="s1">&#39;model.weights&#39;</span><span class="p">,</span> <span class="s1">&#39;model.cfg&#39;</span><span class="p">)</span>

<span class="c1"># Backend options</span>
<span class="c1"># - cv2.dnn.DNN_BACKEND_OPENCV: OpenCV built-in (default)</span>
<span class="c1"># - cv2.dnn.DNN_BACKEND_CUDA: NVIDIA CUDA</span>
<span class="c1"># - cv2.dnn.DNN_BACKEND_INFERENCE_ENGINE: Intel OpenVINO</span>

<span class="c1"># Target options</span>
<span class="c1"># - cv2.dnn.DNN_TARGET_CPU: CPU (default)</span>
<span class="c1"># - cv2.dnn.DNN_TARGET_OPENCL: OpenCL GPU</span>
<span class="c1"># - cv2.dnn.DNN_TARGET_CUDA: NVIDIA GPU</span>
<span class="c1"># - cv2.dnn.DNN_TARGET_CUDA_FP16: NVIDIA GPU (half precision)</span>

<span class="c1"># CPU execution (default)</span>
<span class="n">net</span><span class="o">.</span><span class="n">setPreferableBackend</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_BACKEND_OPENCV</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">setPreferableTarget</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_TARGET_CPU</span><span class="p">)</span>

<span class="c1"># CUDA GPU execution (if OpenCV is built with CUDA support)</span>
<span class="c1"># net.setPreferableBackend(cv2.dnn.DNN_BACKEND_CUDA)</span>
<span class="c1"># net.setPreferableTarget(cv2.dnn.DNN_TARGET_CUDA)</span>

<span class="c1"># Check available backends</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available backends:&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">getAvailableBackends</span><span class="p">())</span>
</code></pre></div>

<h3 id="checking-layer-information">Checking Layer Information<a class="header-link" href="#checking-layer-information" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNet</span><span class="p">(</span><span class="s1">&#39;yolov3.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;yolov3.weights&#39;</span><span class="p">)</span>

<span class="c1"># Layer names list</span>
<span class="n">layer_names</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">getLayerNames</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total layers: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">layer_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Layer list (partial):&quot;</span><span class="p">,</span> <span class="n">layer_names</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>

<span class="c1"># Output layers (unconnected layers)</span>
<span class="n">output_layers</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">getUnconnectedOutLayers</span><span class="p">()</span>
<span class="n">output_layer_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer_names</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output_layers</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Output layers:&quot;</span><span class="p">,</span> <span class="n">output_layer_names</span><span class="p">)</span>

<span class="c1"># Specific layer info</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">getLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer type: </span><span class="si">{</span><span class="n">layer</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="3-blobfromimage-preprocessing">3. blobFromImage(): Preprocessing<a class="header-link" href="#3-blobfromimage-preprocessing" title="Permanent link">&para;</a></h2>
<h3 id="blob-concept">Blob Concept<a class="header-link" href="#blob-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">Blob</span><span class="w"> </span><span class="ss">(</span><span class="nv">Binary</span><span class="w"> </span><span class="nv">Large</span><span class="w"> </span><span class="nv">Object</span><span class="ss">)</span>:
<span class="mi">4</span><span class="o">-</span><span class="nv">dimensional</span><span class="w"> </span><span class="nv">tensor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">DNN</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="nv">input</span>

<span class="nv">Dimension</span><span class="w"> </span><span class="nv">structure</span>:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">  </span><span class="nv">Blob</span><span class="w"> </span><span class="nv">Shape</span>:<span class="w"> </span><span class="ss">(</span><span class="nv">N</span>,<span class="w"> </span><span class="nv">C</span>,<span class="w"> </span><span class="nv">H</span>,<span class="w"> </span><span class="nv">W</span><span class="ss">)</span><span class="w">                                   </span>â”‚
â”‚<span class="w">                                                             </span>â”‚
â”‚<span class="w">  </span><span class="nv">N</span>:<span class="w"> </span><span class="nv">Batch</span><span class="w"> </span><span class="nv">Size</span><span class="w">                                              </span>â”‚
â”‚<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nv">Number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">images</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">once</span><span class="w">                   </span>â”‚
â”‚<span class="w">                                                             </span>â”‚
â”‚<span class="w">  </span><span class="nv">C</span>:<span class="w"> </span><span class="nv">Number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">Channels</span><span class="w">                                      </span>â”‚
â”‚<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nv">RGB</span>:<span class="w"> </span><span class="mi">3</span>,<span class="w"> </span><span class="nv">Grayscale</span>:<span class="w"> </span><span class="mi">1</span><span class="w">                                  </span>â”‚
â”‚<span class="w">                                                             </span>â”‚
â”‚<span class="w">  </span><span class="nv">H</span>:<span class="w"> </span><span class="nv">Height</span><span class="w">                                                  </span>â”‚
â”‚<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nv">Input</span><span class="w"> </span><span class="nv">height</span><span class="w"> </span><span class="nv">required</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">model</span><span class="w">                        </span>â”‚
â”‚<span class="w">                                                             </span>â”‚
â”‚<span class="w">  </span><span class="nv">W</span>:<span class="w"> </span><span class="nv">Width</span><span class="w">                                                   </span>â”‚
â”‚<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nv">Input</span><span class="w"> </span><span class="nv">width</span><span class="w"> </span><span class="nv">required</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">model</span><span class="w">                         </span>â”‚
â”‚<span class="w">                                                             </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Example</span>:<span class="w"> </span><span class="nv">YOLO</span><span class="w"> </span><span class="ss">(</span><span class="mi">416</span><span class="nv">x416</span><span class="ss">)</span>
<span class="nv">blob</span>.<span class="nv">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">(</span><span class="mi">1</span>,<span class="w"> </span><span class="mi">3</span>,<span class="w"> </span><span class="mi">416</span>,<span class="w"> </span><span class="mi">416</span><span class="ss">)</span>
<span class="w">             </span>â”‚<span class="w">  </span>â”‚<span class="w">   </span>â”‚<span class="w">    </span>â”‚
<span class="w">             </span>â”‚<span class="w">  </span>â”‚<span class="w">   </span>â”‚<span class="w">    </span>â””â”€â”€<span class="w"> </span><span class="nv">Width</span><span class="w"> </span><span class="mi">416</span>
<span class="w">             </span>â”‚<span class="w">  </span>â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span><span class="nv">Height</span><span class="w"> </span><span class="mi">416</span>
<span class="w">             </span>â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">RGB</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">channels</span>
<span class="w">             </span>â””â”€â”€<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">image</span>
</code></pre></div>

<h3 id="using-blobfromimage">Using blobFromImage<a class="header-link" href="#using-blobfromimage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>

<span class="c1"># Basic Blob creation</span>
<span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>                    <span class="c1"># Input image</span>
    <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span>    <span class="c1"># Scale factor (normalization)</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span>        <span class="c1"># Target size</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>         <span class="c1"># Mean subtraction</span>
    <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>            <span class="c1"># BGR â†’ RGB</span>
    <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>              <span class="c1"># Crop flag</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Blob shape: </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (1, 3, 416, 416)</span>

<span class="c1"># Various preprocessing options</span>

<span class="c1"># 1. ImageNet style (mean subtraction)</span>
<span class="n">blob_imagenet</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">scalefactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">),</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">117.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span>  <span class="c1"># ImageNet mean</span>
    <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># 2. YOLO style (0-1 normalization)</span>
<span class="n">blob_yolo</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># 3. SSD style</span>
<span class="n">blob_ssd</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">scalefactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">177.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span>
    <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="processing-multiple-images">Processing Multiple Images<a class="header-link" href="#processing-multiple-images" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">prepare_batch</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process multiple images as a batch&quot;&quot;&quot;</span>

    <span class="c1"># Method 1: Using blobFromImages</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImages</span><span class="p">(</span>
        <span class="n">images</span><span class="p">,</span>
        <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">blob</span>

<span class="c1"># Usage example</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.jpg&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">batch_blob</span> <span class="o">=</span> <span class="n">prepare_batch</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch blob shape: </span><span class="si">{</span><span class="n">batch_blob</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (4, 3, 416, 416)</span>

<span class="c1"># Input to network</span>
<span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">batch_blob</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
</code></pre></div>

<h3 id="visualizing-preprocessing">Visualizing Preprocessing<a class="header-link" href="#visualizing-preprocessing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_blob</span><span class="p">(</span><span class="n">blob</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize blob contents&quot;&quot;&quot;</span>

    <span class="c1"># blob shape: (N, C, H, W)</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># Display each channel</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">blob</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="c1"># Combined image (recombine as RGB)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">blob</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># CHW â†’ HWC</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="p">(</span><span class="n">combined</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Combined (RGB)&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Usage example</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span> <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">visualize_blob</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="4-yolo-object-detection">4. YOLO Object Detection<a class="header-link" href="#4-yolo-object-detection" title="Permanent link">&para;</a></h2>
<h3 id="yolo-overview">YOLO Overview<a class="header-link" href="#yolo-overview" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>YOLO (You Only Look Once):
Real-time object detection algorithm

Features:
<span class="k">-</span> Single pass detection (End-to-End)
<span class="k">-</span> Fast speed (real-time capable)
<span class="k">-</span> Uses full image context

Output structure:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  For each detection:                                        â”‚
â”‚  [center_x, center_y, width, height, confidence, class_scores...]â”‚
â”‚                                                             â”‚
â”‚  - center_x, center_y: Bounding box center (0-1 normalized) â”‚
â”‚  - width, height: Box size (0-1 normalized)                 â”‚
â”‚  - confidence: Object presence probability                  â”‚
â”‚  - class_scores: Probability for each class (80 classes)    â”‚
â”‚                                                             â”‚
â”‚  Example: COCO dataset (80 classes)                         â”‚
â”‚  Output vector length = 4 + 1 + 80 = 85                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

YOLO version comparison:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Version â”‚ Input    â”‚  mAP     â”‚ Speed (FPS)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ YOLOv3  â”‚ 416x416  â”‚ 33.0     â”‚ ~35 (GPU)         â”‚
â”‚ YOLOv3-tinyâ”‚ 416x416â”‚ 15.0    â”‚ ~220 (GPU)        â”‚
â”‚ YOLOv4  â”‚ 416x416  â”‚ 43.5     â”‚ ~38 (GPU)         â”‚
â”‚ YOLOv4-tinyâ”‚ 416x416â”‚ 21.7    â”‚ ~371 (GPU)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="yolov3-implementation">YOLOv3 Implementation<a class="header-link" href="#yolov3-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">YOLODetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;YOLOv3 Object Detector&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">,</span> <span class="n">names_path</span><span class="p">,</span>
                 <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nms_threshold</span><span class="o">=</span><span class="mf">0.4</span><span class="p">):</span>
        <span class="c1"># Load model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromDarknet</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setPreferableBackend</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_BACKEND_OPENCV</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setPreferableTarget</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_TARGET_CPU</span><span class="p">)</span>

        <span class="c1"># Load class names</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">names_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>

        <span class="c1"># Output layer names</span>
        <span class="n">layer_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">getLayerNames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer_names</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">getUnconnectedOutLayers</span><span class="p">()]</span>

        <span class="c1"># Thresholds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nms_threshold</span> <span class="o">=</span> <span class="n">nms_threshold</span>

        <span class="c1"># Colors (per class)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Object detection&quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Create blob</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span>
                                      <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Inference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_layers</span><span class="p">)</span>

        <span class="c1"># Parse results</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">confidences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">class_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">scores</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
                <span class="n">class_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
                <span class="n">confidence</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                    <span class="c1"># Bounding box coordinates (normalized)</span>
                    <span class="n">center_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                    <span class="n">center_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                    <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

                    <span class="c1"># Top-left coordinates</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_y</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                    <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
                    <span class="n">confidences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">))</span>
                    <span class="n">class_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_id</span><span class="p">)</span>

        <span class="c1"># Non-Maximum Suppression</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">NMSBoxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nms_threshold</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">box</span><span class="p">,</span>
                <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">confidences</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize results&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_id&#39;</span><span class="p">]]]</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

<span class="c1"># Usage example</span>
<span class="c1"># Model files download required:</span>
<span class="c1"># - yolov3.cfg: https://github.com/pjreddie/darknet/blob/master/cfg/yolov3.cfg</span>
<span class="c1"># - yolov3.weights: https://pjreddie.com/media/files/yolov3.weights</span>
<span class="c1"># - coco.names: https://github.com/pjreddie/darknet/blob/master/data/coco.names</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">YOLODetector</span><span class="p">(</span>
    <span class="s1">&#39;yolov3.cfg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;yolov3.weights&#39;</span><span class="p">,</span>
    <span class="s1">&#39;coco.names&#39;</span>
<span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;street.jpg&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected objects: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;YOLO Detection&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="yolov3-tiny-lightweight-version">YOLOv3-tiny (Lightweight Version)<a class="header-link" href="#yolov3-tiny-lightweight-version" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">yolo_tiny_detect</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fast detection using YOLOv3-tiny&quot;&quot;&quot;</span>

    <span class="c1"># Load YOLOv3-tiny</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromDarknet</span><span class="p">(</span><span class="s1">&#39;yolov3-tiny.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;yolov3-tiny.weights&#39;</span><span class="p">)</span>

    <span class="c1"># Class names</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;coco.names&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>

    <span class="c1"># Output layers</span>
    <span class="n">layer_names</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">getLayerNames</span><span class="p">()</span>
    <span class="n">output_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer_names</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">getUnconnectedOutLayers</span><span class="p">()]</span>

    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Blob and inference</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span> <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">output_layers</span><span class="p">)</span>

    <span class="c1"># Parse results</span>
    <span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span> <span class="n">class_ids</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="n">conf_threshold</span><span class="p">:</span>
                <span class="n">center_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">center_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

                <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_y</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
                <span class="n">confidences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">))</span>
                <span class="n">class_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_id</span><span class="p">)</span>

    <span class="c1"># NMS</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">NMSBoxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>

    <span class="c1"># Draw results</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classes</span><span class="p">[</span><span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">confidences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                   <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>
</code></pre></div>

<hr />
<h2 id="5-ssd-single-shot-detector">5. SSD (Single Shot Detector)<a class="header-link" href="#5-ssd-single-shot-detector" title="Permanent link">&para;</a></h2>
<h3 id="ssd-overview">SSD Overview<a class="header-link" href="#ssd-overview" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">SSD</span><span class="w"> </span><span class="p">(</span><span class="n">Single</span><span class="w"> </span><span class="n">Shot</span><span class="w"> </span><span class="n">MultiBox</span><span class="w"> </span><span class="n">Detector</span><span class="p">):</span>
<span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">multi</span><span class="o">-</span><span class="n">scale</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="n">maps</span>

<span class="n">Features</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Strong</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">detecting</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">sizes</span>
<span class="o">-</span><span class="w"> </span><span class="n">Better</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">detecting</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">YOLO</span>
<span class="o">-</span><span class="w"> </span><span class="n">Various</span><span class="w"> </span><span class="n">backbone</span><span class="w"> </span><span class="n">networks</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="p">(</span><span class="n">VGG</span><span class="p">,</span><span class="w"> </span><span class="n">MobileNet</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span><span class="p">)</span>

<span class="n">Architecture</span><span class="p">:</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Input</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="p">(</span><span class="mi">300</span><span class="n">x300</span><span class="p">)</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â–¼</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Backbone</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">VGG16</span><span class="p">,</span><span class="w"> </span><span class="n">MobileNet</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Network</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â–¼</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">38</span><span class="n">x38</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">19</span><span class="n">x19</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">10</span><span class="n">x10</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">5</span><span class="n">x5</span><span class="w"> </span><span class="o">...</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Feature</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Feature</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Feature</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Feature</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                         </span><span class="err">â”‚</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                         </span><span class="err">â–¼</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">NMS</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Final</span><span class="w"> </span><span class="n">Detection</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="mobilenet-ssd-implementation">MobileNet SSD Implementation<a class="header-link" href="#mobilenet-ssd-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SSDDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MobileNet SSD Object Detector&quot;&quot;&quot;</span>

    <span class="c1"># COCO classes (MobileNet SSD v2)</span>
    <span class="n">CLASSES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="s2">&quot;motorcycle&quot;</span><span class="p">,</span>
               <span class="s2">&quot;airplane&quot;</span><span class="p">,</span> <span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;truck&quot;</span><span class="p">,</span> <span class="s2">&quot;boat&quot;</span><span class="p">,</span> <span class="s2">&quot;traffic light&quot;</span><span class="p">,</span>
               <span class="s2">&quot;fire hydrant&quot;</span><span class="p">,</span> <span class="s2">&quot;stop sign&quot;</span><span class="p">,</span> <span class="s2">&quot;parking meter&quot;</span><span class="p">,</span> <span class="s2">&quot;bench&quot;</span><span class="p">,</span> <span class="s2">&quot;bird&quot;</span><span class="p">,</span>
               <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;horse&quot;</span><span class="p">,</span> <span class="s2">&quot;sheep&quot;</span><span class="p">,</span> <span class="s2">&quot;cow&quot;</span><span class="p">,</span> <span class="s2">&quot;elephant&quot;</span><span class="p">,</span> <span class="s2">&quot;bear&quot;</span><span class="p">,</span>
               <span class="s2">&quot;zebra&quot;</span><span class="p">,</span> <span class="s2">&quot;giraffe&quot;</span><span class="p">,</span> <span class="s2">&quot;backpack&quot;</span><span class="p">,</span> <span class="s2">&quot;umbrella&quot;</span><span class="p">,</span> <span class="s2">&quot;handbag&quot;</span><span class="p">,</span> <span class="s2">&quot;tie&quot;</span><span class="p">,</span>
               <span class="s2">&quot;suitcase&quot;</span><span class="p">,</span> <span class="s2">&quot;frisbee&quot;</span><span class="p">,</span> <span class="s2">&quot;skis&quot;</span><span class="p">,</span> <span class="s2">&quot;snowboard&quot;</span><span class="p">,</span> <span class="s2">&quot;sports ball&quot;</span><span class="p">,</span>
               <span class="s2">&quot;kite&quot;</span><span class="p">,</span> <span class="s2">&quot;baseball bat&quot;</span><span class="p">,</span> <span class="s2">&quot;baseball glove&quot;</span><span class="p">,</span> <span class="s2">&quot;skateboard&quot;</span><span class="p">,</span>
               <span class="s2">&quot;surfboard&quot;</span><span class="p">,</span> <span class="s2">&quot;tennis racket&quot;</span><span class="p">,</span> <span class="s2">&quot;bottle&quot;</span><span class="p">,</span> <span class="s2">&quot;wine glass&quot;</span><span class="p">,</span> <span class="s2">&quot;cup&quot;</span><span class="p">,</span>
               <span class="s2">&quot;fork&quot;</span><span class="p">,</span> <span class="s2">&quot;knife&quot;</span><span class="p">,</span> <span class="s2">&quot;spoon&quot;</span><span class="p">,</span> <span class="s2">&quot;bowl&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
               <span class="s2">&quot;sandwich&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;broccoli&quot;</span><span class="p">,</span> <span class="s2">&quot;carrot&quot;</span><span class="p">,</span> <span class="s2">&quot;hot dog&quot;</span><span class="p">,</span> <span class="s2">&quot;pizza&quot;</span><span class="p">,</span>
               <span class="s2">&quot;donut&quot;</span><span class="p">,</span> <span class="s2">&quot;cake&quot;</span><span class="p">,</span> <span class="s2">&quot;chair&quot;</span><span class="p">,</span> <span class="s2">&quot;couch&quot;</span><span class="p">,</span> <span class="s2">&quot;potted plant&quot;</span><span class="p">,</span> <span class="s2">&quot;bed&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dining table&quot;</span><span class="p">,</span> <span class="s2">&quot;toilet&quot;</span><span class="p">,</span> <span class="s2">&quot;tv&quot;</span><span class="p">,</span> <span class="s2">&quot;laptop&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;remote&quot;</span><span class="p">,</span>
               <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;cell phone&quot;</span><span class="p">,</span> <span class="s2">&quot;microwave&quot;</span><span class="p">,</span> <span class="s2">&quot;oven&quot;</span><span class="p">,</span> <span class="s2">&quot;toaster&quot;</span><span class="p">,</span>
               <span class="s2">&quot;sink&quot;</span><span class="p">,</span> <span class="s2">&quot;refrigerator&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;clock&quot;</span><span class="p">,</span> <span class="s2">&quot;vase&quot;</span><span class="p">,</span> <span class="s2">&quot;scissors&quot;</span><span class="p">,</span>
               <span class="s2">&quot;teddy bear&quot;</span><span class="p">,</span> <span class="s2">&quot;hair drier&quot;</span><span class="p">,</span> <span class="s2">&quot;toothbrush&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromTensorflow</span><span class="p">(</span><span class="n">weights_path</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>

        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Object detection&quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Create blob (SSD uses 300x300 or 512x512 input)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
                                      <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mf">127.5</span><span class="p">,</span> <span class="mf">127.5</span><span class="p">,</span> <span class="mf">127.5</span><span class="p">),</span>
                                      <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">127.5</span><span class="p">,</span>
                                      <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Output shape: (1, 1, N, 7)</span>
        <span class="c1"># Each detection: [batch_id, class_id, confidence, x1, y1, x2, y2]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                <span class="n">class_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

                <span class="c1"># Coordinates (normalized â†’ pixels)</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">],</span>
                    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">confidence</span><span class="p">,</span>
                    <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_id</span><span class="p">,</span>
                    <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize results&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_id&#39;</span><span class="p">]]]</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

<span class="c1"># Usage example</span>
<span class="c1"># Model download:</span>
<span class="c1"># ssd_mobilenet_v2_coco_2018_03_29.pbtxt</span>
<span class="c1"># frozen_inference_graph.pb</span>

<span class="c1"># detector = SSDDetector(</span>
<span class="c1">#     &#39;ssd_mobilenet_v2_coco.pbtxt&#39;,</span>
<span class="c1">#     &#39;frozen_inference_graph.pb&#39;</span>
<span class="c1"># )</span>
</code></pre></div>

<h3 id="caffe-ssd-lightweight">Caffe SSD (Lightweight)<a class="header-link" href="#caffe-ssd-lightweight" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ssd_caffe_detect</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">prototxt</span><span class="p">,</span> <span class="n">caffemodel</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Caffe SSD detection (MobileNet backbone)&quot;&quot;&quot;</span>

    <span class="n">CLASSES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;aeroplane&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span> <span class="s2">&quot;bird&quot;</span><span class="p">,</span> <span class="s2">&quot;boat&quot;</span><span class="p">,</span>
               <span class="s2">&quot;bottle&quot;</span><span class="p">,</span> <span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;chair&quot;</span><span class="p">,</span> <span class="s2">&quot;cow&quot;</span><span class="p">,</span> <span class="s2">&quot;diningtable&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;horse&quot;</span><span class="p">,</span> <span class="s2">&quot;motorbike&quot;</span><span class="p">,</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;pottedplant&quot;</span><span class="p">,</span>
               <span class="s2">&quot;sheep&quot;</span><span class="p">,</span> <span class="s2">&quot;sofa&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;tvmonitor&quot;</span><span class="p">]</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span><span class="n">prototxt</span><span class="p">,</span> <span class="n">caffemodel</span><span class="p">)</span>

    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Create blob</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">)),</span>
        <span class="mf">0.007843</span><span class="p">,</span>  <span class="c1"># 1/127.5</span>
        <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
        <span class="mf">127.5</span>
    <span class="p">)</span>

    <span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
    <span class="n">detections</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="n">conf_threshold</span><span class="p">:</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">box</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                                                       <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">],</span>
                <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">),</span>
                <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_id</span><span class="p">,</span>
                <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="n">CLASSES</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>

<hr />
<h2 id="6-dnn-face-detection">6. DNN Face Detection<a class="header-link" href="#6-dnn-face-detection" title="Permanent link">&para;</a></h2>
<h3 id="opencv-dnn-face-detector">OpenCV DNN Face Detector<a class="header-link" href="#opencv-dnn-face-detector" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DNNFaceDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DNN-based Face Detector (res10_300x300)&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_path</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model download:</span>
<span class="sd">        - deploy.prototxt: https://github.com/opencv/opencv/blob/master/samples/dnn/face_detector/deploy.prototxt</span>
<span class="sd">        - res10_300x300_ssd_iter_140000.caffemodel</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">config_path</span><span class="p">:</span>
            <span class="c1"># Caffe model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TensorFlow model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromTensorflow</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Face detection&quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Create blob</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">177.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span>  <span class="c1"># Mean values</span>
            <span class="n">swapRB</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="n">faces</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

                <span class="c1"># Boundary check</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

                <span class="n">faces</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">),</span>
                    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">faces</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">faces</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize results&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">face</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="n">face</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Face: </span><span class="si">{</span><span class="n">conf</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

<span class="c1"># Usage example</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">DNNFaceDetector</span><span class="p">(</span>
    <span class="s1">&#39;res10_300x300_ssd_iter_140000.caffemodel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;deploy.prototxt&#39;</span>
<span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;group_photo.jpg&#39;</span><span class="p">)</span>
<span class="n">faces</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected faces: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;DNN Face Detection&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="real-time-dnn-face-detection">Real-time DNN Face Detection<a class="header-link" href="#real-time-dnn-face-detection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">realtime_dnn_face_detection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Real-time DNN face detection&quot;&quot;&quot;</span>

    <span class="c1"># Load model</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span>
        <span class="s1">&#39;deploy.prototxt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;res10_300x300_ssd_iter_140000.caffemodel&#39;</span>
    <span class="p">)</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">fps_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Create blob</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">177.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="c1"># Process detection results</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

                <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">confidence</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                           <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate FPS</span>
        <span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">fps_time</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">fps</span> <span class="o">=</span> <span class="n">frame_count</span>
            <span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fps_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;FPS: </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                   <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;DNN Face Detection&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># Run</span>
<span class="n">realtime_dnn_face_detection</span><span class="p">()</span>
</code></pre></div>

<h3 id="haar-vs-dnn-face-detection-comparison">Haar vs DNN Face Detection Comparison<a class="header-link" href="#haar-vs-dnn-face-detection-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compare_face_detectors</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare Haar and DNN face detection&quot;&quot;&quot;</span>

    <span class="c1"># Haar Cascade</span>
    <span class="n">haar</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CascadeClassifier</span><span class="p">(</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">haarcascades</span> <span class="o">+</span> <span class="s1">&#39;haarcascade_frontalface_default.xml&#39;</span>
    <span class="p">)</span>

    <span class="c1"># DNN</span>
    <span class="n">dnn_net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span>
        <span class="s1">&#39;deploy.prototxt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;res10_300x300_ssd_iter_140000.caffemodel&#39;</span>
    <span class="p">)</span>

    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Haar detection</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">haar_faces</span> <span class="o">=</span> <span class="n">haar</span><span class="o">.</span><span class="n">detectMultiScale</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">minSize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
    <span class="n">haar_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># DNN detection</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
                                  <span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">177.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">dnn_net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
    <span class="n">dnn_detections</span> <span class="o">=</span> <span class="n">dnn_net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
    <span class="n">dnn_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># Visualize results</span>
    <span class="n">img_haar</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">img_dnn</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="n">haar_faces</span><span class="p">:</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img_haar</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dnn_detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">dnn_detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">dnn_detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img_dnn</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img_haar</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Haar: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">haar_faces</span><span class="p">)</span><span class="si">}</span><span class="s2"> faces, </span><span class="si">{</span><span class="n">haar_time</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">,</span>
               <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">dnn_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dnn_detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">dnn_detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img_dnn</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;DNN: </span><span class="si">{</span><span class="n">dnn_count</span><span class="si">}</span><span class="s2"> faces, </span><span class="si">{</span><span class="n">dnn_time</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">,</span>
               <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Display results</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">img_haar</span><span class="p">,</span> <span class="n">img_dnn</span><span class="p">])</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Haar vs DNN&#39;</span><span class="p">,</span> <span class="n">combined</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;haar&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">haar_faces</span><span class="p">),</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">haar_time</span><span class="p">},</span>
        <span class="s1">&#39;dnn&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">dnn_count</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">dnn_time</span><span class="p">}</span>
    <span class="p">}</span>

<span class="c1"># Run comparison</span>
<span class="c1"># result = compare_face_detectors(cv2.imread(&#39;group.jpg&#39;))</span>
</code></pre></div>

<hr />
<h2 id="7-modern-object-detection-with-onnx">7. Modern Object Detection with ONNX<a class="header-link" href="#7-modern-object-detection-with-onnx" title="Permanent link">&para;</a></h2>
<h3 id="71-running-yolov8-with-opencv-dnn">7.1 Running YOLOv8 with OpenCV DNN<a class="header-link" href="#71-running-yolov8-with-opencv-dnn" title="Permanent link">&para;</a></h3>
<p>YOLOv8, released by Ultralytics in 2023, represents a significant advancement in the YOLO family. It can be exported to ONNX format and run efficiently with OpenCV's DNN module.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">YOLOv8Detector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;YOLOv8 ONNX Object Detector&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onnx_model_path</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">iou_threshold</span><span class="o">=</span><span class="mf">0.4</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize YOLOv8 detector</span>

<span class="sd">        To export YOLOv8 to ONNX:</span>
<span class="sd">        pip install ultralytics</span>
<span class="sd">        yolo export model=yolov8n.pt format=onnx</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="n">onnx_model_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iou_threshold</span> <span class="o">=</span> <span class="n">iou_threshold</span>

        <span class="c1"># COCO class names (80 classes)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="s2">&quot;motorcycle&quot;</span><span class="p">,</span> <span class="s2">&quot;airplane&quot;</span><span class="p">,</span> <span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
            <span class="s2">&quot;truck&quot;</span><span class="p">,</span> <span class="s2">&quot;boat&quot;</span><span class="p">,</span> <span class="s2">&quot;traffic light&quot;</span><span class="p">,</span> <span class="s2">&quot;fire hydrant&quot;</span><span class="p">,</span> <span class="s2">&quot;stop sign&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parking meter&quot;</span><span class="p">,</span> <span class="s2">&quot;bench&quot;</span><span class="p">,</span> <span class="s2">&quot;bird&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;horse&quot;</span><span class="p">,</span> <span class="s2">&quot;sheep&quot;</span><span class="p">,</span> <span class="s2">&quot;cow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;elephant&quot;</span><span class="p">,</span> <span class="s2">&quot;bear&quot;</span><span class="p">,</span> <span class="s2">&quot;zebra&quot;</span><span class="p">,</span> <span class="s2">&quot;giraffe&quot;</span><span class="p">,</span> <span class="s2">&quot;backpack&quot;</span><span class="p">,</span> <span class="s2">&quot;umbrella&quot;</span><span class="p">,</span> <span class="s2">&quot;handbag&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tie&quot;</span><span class="p">,</span> <span class="s2">&quot;suitcase&quot;</span><span class="p">,</span> <span class="s2">&quot;frisbee&quot;</span><span class="p">,</span> <span class="s2">&quot;skis&quot;</span><span class="p">,</span> <span class="s2">&quot;snowboard&quot;</span><span class="p">,</span> <span class="s2">&quot;sports ball&quot;</span><span class="p">,</span> <span class="s2">&quot;kite&quot;</span><span class="p">,</span>
            <span class="s2">&quot;baseball bat&quot;</span><span class="p">,</span> <span class="s2">&quot;baseball glove&quot;</span><span class="p">,</span> <span class="s2">&quot;skateboard&quot;</span><span class="p">,</span> <span class="s2">&quot;surfboard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tennis racket&quot;</span><span class="p">,</span> <span class="s2">&quot;bottle&quot;</span><span class="p">,</span> <span class="s2">&quot;wine glass&quot;</span><span class="p">,</span> <span class="s2">&quot;cup&quot;</span><span class="p">,</span> <span class="s2">&quot;fork&quot;</span><span class="p">,</span> <span class="s2">&quot;knife&quot;</span><span class="p">,</span> <span class="s2">&quot;spoon&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bowl&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;sandwich&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;broccoli&quot;</span><span class="p">,</span> <span class="s2">&quot;carrot&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hot dog&quot;</span><span class="p">,</span> <span class="s2">&quot;pizza&quot;</span><span class="p">,</span> <span class="s2">&quot;donut&quot;</span><span class="p">,</span> <span class="s2">&quot;cake&quot;</span><span class="p">,</span> <span class="s2">&quot;chair&quot;</span><span class="p">,</span> <span class="s2">&quot;couch&quot;</span><span class="p">,</span> <span class="s2">&quot;potted plant&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bed&quot;</span><span class="p">,</span> <span class="s2">&quot;dining table&quot;</span><span class="p">,</span> <span class="s2">&quot;toilet&quot;</span><span class="p">,</span> <span class="s2">&quot;tv&quot;</span><span class="p">,</span> <span class="s2">&quot;laptop&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;remote&quot;</span><span class="p">,</span>
            <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;cell phone&quot;</span><span class="p">,</span> <span class="s2">&quot;microwave&quot;</span><span class="p">,</span> <span class="s2">&quot;oven&quot;</span><span class="p">,</span> <span class="s2">&quot;toaster&quot;</span><span class="p">,</span> <span class="s2">&quot;sink&quot;</span><span class="p">,</span>
            <span class="s2">&quot;refrigerator&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;clock&quot;</span><span class="p">,</span> <span class="s2">&quot;vase&quot;</span><span class="p">,</span> <span class="s2">&quot;scissors&quot;</span><span class="p">,</span> <span class="s2">&quot;teddy bear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hair drier&quot;</span><span class="p">,</span> <span class="s2">&quot;toothbrush&quot;</span>
        <span class="p">]</span>

        <span class="c1"># Generate random colors for each class</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        YOLOv8 object detection</span>

<span class="sd">        YOLOv8 output format (different from YOLOv5):</span>
<span class="sd">        - Shape: (1, 84, 8400) for 640x640 input</span>
<span class="sd">        - First 4 rows: [x_center, y_center, width, height]</span>
<span class="sd">        - Rows 4-83: class probabilities (80 classes)</span>
<span class="sd">        - No objectness score (unlike YOLOv5)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Preprocessing: letterbox resize</span>
        <span class="n">input_size</span> <span class="o">=</span> <span class="mi">640</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">input_size</span><span class="p">),</span>
            <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Inference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="c1"># YOLOv8 output shape: (1, 84, 8400)</span>
        <span class="c1"># Transpose to (8400, 84) for easier processing</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># (8400, 84)</span>

        <span class="n">boxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">confidences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">class_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Scale factors for coordinate conversion</span>
        <span class="n">x_scale</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">input_size</span>
        <span class="n">y_scale</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">input_size</span>

        <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="c1"># Extract class scores (rows 4-83)</span>
            <span class="n">class_scores</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">class_scores</span><span class="p">)</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">class_scores</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                <span class="c1"># Extract bounding box (rows 0-3: cx, cy, w, h)</span>
                <span class="n">cx</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_scale</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_scale</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_scale</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_scale</span>

                <span class="c1"># Convert to top-left corner format</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)])</span>
                <span class="n">confidences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">))</span>
                <span class="n">class_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_id</span><span class="p">)</span>

        <span class="c1"># Non-Maximum Suppression</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">NMSBoxes</span><span class="p">(</span>
            <span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iou_threshold</span>
        <span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">confidences</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize detection results&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_id&#39;</span><span class="p">]</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span>

            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">class_id</span><span class="p">]]</span>

            <span class="c1"># Draw bounding box</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Draw label</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">confidence</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">(</span><span class="n">label_w</span><span class="p">,</span> <span class="n">label_h</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTextSize</span><span class="p">(</span>
                <span class="n">label</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">label_h</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_w</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span>
                <span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">5</span><span class="p">),</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">1</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

<span class="c1"># Usage example</span>
<span class="c1"># First, export YOLOv8 model:</span>
<span class="c1"># pip install ultralytics</span>
<span class="c1"># yolo export model=yolov8n.pt format=onnx</span>
<span class="c1"># This creates yolov8n.onnx</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">YOLOv8Detector</span><span class="p">(</span><span class="s1">&#39;yolov8n.onnx&#39;</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;street.jpg&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;YOLOv8 Detection&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="72-sam-segment-anything-model-with-onnx">7.2 SAM (Segment Anything Model) with ONNX<a class="header-link" href="#72-sam-segment-anything-model-with-onnx" title="Permanent link">&para;</a></h3>
<p>Meta's Segment Anything Model (SAM) enables powerful image segmentation. While SAM is typically used with PyTorch, the encoder and decoder can be exported to ONNX and run with OpenCV DNN for inference.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SAMONNXDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplified SAM ONNX inference with OpenCV</span>

<span class="sd">    SAM consists of two components:</span>
<span class="sd">    1. Image Encoder: Encodes input image to embeddings</span>
<span class="sd">    2. Mask Decoder: Generates masks from embeddings and prompts</span>

<span class="sd">    To export SAM to ONNX, see:</span>
<span class="sd">    https://github.com/facebookresearch/segment-anything</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoder_path</span><span class="p">,</span> <span class="n">decoder_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize SAM with ONNX models</span>

<span class="sd">        Args:</span>
<span class="sd">            encoder_path: Path to encoder ONNX model</span>
<span class="sd">            decoder_path: Path to decoder ONNX model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="n">encoder_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="n">decoder_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># SAM default size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess image for SAM encoder&quot;&quot;&quot;</span>
        <span class="c1"># Resize to 1024x1024</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>

        <span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">))</span>

        <span class="c1"># Pad to square</span>
        <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">padded</span><span class="p">[:</span><span class="n">new_h</span><span class="p">,</span> <span class="p">:</span><span class="n">new_w</span><span class="p">]</span> <span class="o">=</span> <span class="n">resized</span>

        <span class="c1"># Normalize (ImageNet style)</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">padded</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">])</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">normalized</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>

        <span class="c1"># Convert to blob (1, 3, 1024, 1024)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">blob</span><span class="p">,</span> <span class="n">scale</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encode_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image embeddings using encoder&quot;&quot;&quot;</span>
        <span class="n">blob</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">scale</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">segment_with_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">point_coords</span><span class="p">,</span> <span class="n">point_labels</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Segment image with point prompts</span>

<span class="sd">        Args:</span>
<span class="sd">            img: Input image</span>
<span class="sd">            point_coords: List of (x, y) coordinates</span>
<span class="sd">            point_labels: List of labels (1=foreground, 0=background)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Segmentation mask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get image embeddings</span>
        <span class="n">embeddings</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># Scale point coordinates</span>
        <span class="n">scaled_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point_coords</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>

        <span class="c1"># Prepare decoder inputs</span>
        <span class="n">point_coords_input</span> <span class="o">=</span> <span class="n">scaled_coords</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">point_labels_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point_labels</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># Run decoder</span>
        <span class="c1"># Note: Actual SAM ONNX decoder has specific input format</span>
        <span class="c1"># This is simplified - refer to official SAM ONNX export</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="s1">&#39;image_embeddings&#39;</span><span class="p">)</span>
        <span class="c1"># Additional inputs for decoder would be set here</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">mask</span>

<span class="c1"># Conceptual usage (requires actual SAM ONNX models)</span>
<span class="c1"># sam = SAMONNXDetector(&#39;sam_vit_h_encoder.onnx&#39;, &#39;sam_vit_h_decoder.onnx&#39;)</span>
<span class="c1"># img = cv2.imread(&#39;image.jpg&#39;)</span>
<span class="c1">#</span>
<span class="c1"># # Segment with point prompt</span>
<span class="c1"># point_coords = [(100, 150)]  # Click location</span>
<span class="c1"># point_labels = [1]  # Foreground point</span>
<span class="c1"># mask = sam.segment_with_point(img, point_coords, point_labels)</span>
</code></pre></div>

<p><strong>Note</strong>: Running SAM with OpenCV DNN is complex due to its architecture. For production use, consider using the official SAM implementation or pre-built inference servers.</p>
<h3 id="73-model-zoo-and-current-landscape-2025">7.3 Model Zoo and Current Landscape (2025)<a class="header-link" href="#73-model-zoo-and-current-landscape-2025" title="Permanent link">&para;</a></h3>
<p>The object detection and segmentation landscape has evolved significantly. Here's an overview of popular models and their ONNX availability:</p>
<table>
<thead>
<tr>
<th>Model Family</th>
<th>Latest Version</th>
<th>ONNX Support</th>
<th>Use Case</th>
<th>Performance</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>YOLOv8</strong></td>
<td>v8.1 (2024)</td>
<td>âœ… Native</td>
<td>Real-time detection</td>
<td>mAP 53.9 (YOLOv8x)</td>
</tr>
<tr>
<td><strong>YOLOv9</strong></td>
<td>v9.0 (2024)</td>
<td>âœ… Export</td>
<td>Improved accuracy</td>
<td>mAP 55.6</td>
</tr>
<tr>
<td><strong>YOLOv10</strong></td>
<td>v10.0 (2024)</td>
<td>âœ… Export</td>
<td>NMS-free YOLO</td>
<td>Faster inference</td>
</tr>
<tr>
<td><strong>YOLOv11</strong></td>
<td>v11.0 (2024)</td>
<td>âœ… Export</td>
<td>Latest Ultralytics</td>
<td>State-of-the-art</td>
</tr>
<tr>
<td><strong>RT-DETR</strong></td>
<td>v2 (2024)</td>
<td>âœ… Export</td>
<td>Transformer detector</td>
<td>mAP 53.1, no NMS</td>
</tr>
<tr>
<td><strong>SAM</strong></td>
<td>v1.0 (2023)</td>
<td>âœ… Complex</td>
<td>Universal segmentation</td>
<td>Zero-shot capable</td>
</tr>
<tr>
<td><strong>SAM 2</strong></td>
<td>v2.0 (2024)</td>
<td>âœ… Complex</td>
<td>Video segmentation</td>
<td>Temporal tracking</td>
</tr>
<tr>
<td><strong>Depth Anything</strong></td>
<td>v2 (2024)</td>
<td>âœ… Export</td>
<td>Monocular depth</td>
<td>Fast, accurate</td>
</tr>
<tr>
<td><strong>GroundingDINO</strong></td>
<td>v1.5 (2024)</td>
<td>âš ï¸ Limited</td>
<td>Text-prompted detection</td>
<td>Open-vocabulary</td>
</tr>
<tr>
<td><strong>DINO v2</strong></td>
<td>v2.0 (2024)</td>
<td>âœ… Export</td>
<td>Self-supervised features</td>
<td>Strong backbone</td>
</tr>
</tbody>
</table>
<h4 id="731-quick-start-yolov11-with-onnx">7.3.1 Quick Start: YOLOv11 with ONNX<a class="header-link" href="#731-quick-start-yolov11-with-onnx" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Install Ultralytics</span>
<span class="c1"># pip install ultralytics</span>

<span class="c1"># Export YOLOv11 to ONNX (Python)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">YOLO</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="s1">&#39;yolov11n.pt&#39;</span><span class="p">)</span>  <span class="c1"># n, s, m, l, x variants</span>
<span class="n">model</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;onnx&#39;</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Creates yolov11n.onnx</span>

<span class="c1"># Then use with OpenCV (same as YOLOv8 example above)</span>
<span class="c1"># detector = YOLOv8Detector(&#39;yolov11n.onnx&#39;)  # API compatible</span>
</code></pre></div>

<h4 id="732-rt-detr-transformer-based-detection">7.3.2 RT-DETR: Transformer-based Detection<a class="header-link" href="#732-rt-detr-transformer-based-detection" title="Permanent link">&para;</a></h4>
<p>RT-DETR (Real-Time DEtection TRansformer) eliminates the need for NMS by using a transformer architecture:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RTDETRDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RT-DETR ONNX Detector (NMS-free)&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onnx_path</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="n">onnx_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>

        <span class="c1"># COCO classes (same as YOLO)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># 80 classes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RT-DETR detection (no NMS required)</span>

<span class="sd">        Output format: Direct bounding boxes and scores</span>
<span class="sd">        Shape: (1, 300, 6) - top 300 detections</span>
<span class="sd">        Each detection: [x1, y1, x2, y2, confidence, class_id]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Preprocessing (RT-DETR uses 640x640)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">640</span><span class="p">),</span>
            <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="c1"># Parse outputs (already NMS-filtered by model)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># (300, 6)</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                <span class="n">class_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

                <span class="c1"># Scale coordinates</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">],</span>
                    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">),</span>
                    <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_id</span><span class="p">,</span>
                    <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Export RT-DETR to ONNX:</span>
<span class="c1"># pip install ultralytics</span>
<span class="c1"># yolo export model=rtdetr-l.pt format=onnx</span>
</code></pre></div>

<h4 id="733-model-selection-guide">7.3.3 Model Selection Guide<a class="header-link" href="#733-model-selection-guide" title="Permanent link">&para;</a></h4>
<p><strong>For Real-time Applications (Edge Devices, Mobile)</strong>:
- YOLOv8n/s: Fastest, good for embedded systems
- YOLOv10n: No NMS overhead, even faster
- RT-DETR-s: Best accuracy/speed trade-off</p>
<p><strong>For High Accuracy (Server, Cloud)</strong>:
- YOLOv11x: State-of-the-art detection
- RT-DETR-x: Transformer advantages
- Ensemble multiple models</p>
<p><strong>For Segmentation</strong>:
- YOLOv8-seg: Instance segmentation (ONNX native)
- SAM/SAM2: Universal segmentation (prompt-based)
- Depth Anything: Depth estimation</p>
<p><strong>OpenCV DNN Compatibility</strong>:
- âœ… Full support: YOLOv8-11, RT-DETR, MobileNet-SSD
- âš ï¸ Partial: SAM (complex multi-stage pipeline)
- âŒ Limited: Models requiring custom ops (GroundingDINO)</p>
<p><strong>Performance Benchmarks (on RTX 4090, 2024)</strong>:</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Input Size</th>
<th>FPS (CUDA)</th>
<th>mAP</th>
<th>OpenCV DNN</th>
</tr>
</thead>
<tbody>
<tr>
<td>YOLOv8n</td>
<td>640</td>
<td>450</td>
<td>37.3</td>
<td>âœ… Good</td>
</tr>
<tr>
<td>YOLOv11m</td>
<td>640</td>
<td>200</td>
<td>51.5</td>
<td>âœ… Good</td>
</tr>
<tr>
<td>RT-DETR-l</td>
<td>640</td>
<td>110</td>
<td>53.1</td>
<td>âœ… Excellent</td>
</tr>
<tr>
<td>YOLOv8x</td>
<td>640</td>
<td>80</td>
<td>53.9</td>
<td>âœ… Good</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="8-exercises">8. Exercises<a class="header-link" href="#8-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-object-detection-performance-comparison">Exercise 1: Object Detection Performance Comparison<a class="header-link" href="#exercise-1-object-detection-performance-comparison" title="Permanent link">&para;</a></h3>
<p>Write a program that compares the performance of YOLO and SSD.</p>
<p><strong>Requirements</strong>:
- Use the same test image set
- Measure detection speed
- Compare detection accuracy (IoU-based)
- Visualize results</p>
<details>
<summary>Hint</summary>


<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_detectors</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">yolo_detector</span><span class="p">,</span> <span class="n">ssd_detector</span><span class="p">):</span>
    <span class="c1"># YOLO detection</span>
    <span class="n">yolo_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">yolo_results</span> <span class="o">=</span> <span class="n">yolo_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">yolo_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">yolo_start</span>

    <span class="c1"># SSD detection</span>
    <span class="n">ssd_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">ssd_results</span> <span class="o">=</span> <span class="n">ssd_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ssd_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ssd_start</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;yolo&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="n">yolo_results</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">yolo_time</span><span class="p">},</span>
        <span class="s1">&#39;ssd&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="n">ssd_results</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ssd_time</span><span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>



</details>

<h3 id="exercise-2-custom-class-filtering">Exercise 2: Custom Class Filtering<a class="header-link" href="#exercise-2-custom-class-filtering" title="Permanent link">&para;</a></h3>
<p>Implement filtering functionality to detect only specific classes.</p>
<p><strong>Requirements</strong>:
- Specify list of classes to detect
- Ignore other classes
- Set class-specific colors
- Set class-specific confidence thresholds</p>
<details>
<summary>Hint</summary>


<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FilteredDetector</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_detector</span><span class="p">,</span> <span class="n">target_classes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">base_detector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_classes</span> <span class="o">=</span> <span class="n">target_classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_thresholds</span> <span class="o">=</span> <span class="p">{</span><span class="bp">cls</span><span class="p">:</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">target_classes</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">all_results</span>
                    <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_classes</span> <span class="ow">and</span>
                    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_thresholds</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]]]</span>
        <span class="k">return</span> <span class="n">filtered</span>
</code></pre></div>



</details>

<h3 id="exercise-3-video-object-tracking-detection">Exercise 3: Video Object Tracking + Detection<a class="header-link" href="#exercise-3-video-object-tracking-detection" title="Permanent link">&para;</a></h3>
<p>Implement stable video object recognition by combining detection and tracking.</p>
<p><strong>Requirements</strong>:
- Perform detection every N frames
- Use tracking for intermediate frames
- Assign and maintain IDs
- Re-detect on tracking failure</p>
<details>
<summary>Hint</summary>


<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DetectionTracker</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detector</span><span class="p">,</span> <span class="n">detect_every_n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">detector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_every_n</span> <span class="o">=</span> <span class="n">detect_every_n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_every_n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># New detection</span>
            <span class="n">detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_trackers</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">detections</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update existing trackers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_existing_trackers</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_positions</span><span class="p">()</span>
</code></pre></div>



</details>

<h3 id="exercise-4-model-ensemble">Exercise 4: Model Ensemble<a class="header-link" href="#exercise-4-model-ensemble" title="Permanent link">&para;</a></h3>
<p>Improve accuracy by combining results from multiple models.</p>
<p><strong>Requirements</strong>:
- Use 2 or more models
- Merge detection results (Weighted NMS)
- Calibrate confidence scores
- Output final results</p>
<details>
<summary>Hint</summary>


<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ensemble_detection</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectors</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">all_boxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_classes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">detector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">detectors</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">weights</span> <span class="k">else</span> <span class="mf">1.0</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">all_boxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
            <span class="n">all_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span>
            <span class="n">all_classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_id&#39;</span><span class="p">])</span>

    <span class="c1"># Soft-NMS or Weighted Box Fusion</span>
    <span class="n">final_results</span> <span class="o">=</span> <span class="n">weighted_nms</span><span class="p">(</span><span class="n">all_boxes</span><span class="p">,</span> <span class="n">all_scores</span><span class="p">,</span> <span class="n">all_classes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final_results</span>
</code></pre></div>



</details>

<h3 id="exercise-5-real-time-object-counting-system">Exercise 5: Real-time Object Counting System<a class="header-link" href="#exercise-5-real-time-object-counting-system" title="Permanent link">&para;</a></h3>
<p>Implement a system that counts specific objects (e.g., people, vehicles) in video.</p>
<p><strong>Requirements</strong>:
- Real-time detection
- Set counting line/region
- Distinguish entry/exit
- Display statistics (hourly, cumulative)</p>
<details>
<summary>Hint</summary>


<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ObjectCounter</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detector</span><span class="p">,</span> <span class="n">count_line_y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">detector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_line_y</span> <span class="o">=</span> <span class="n">count_line_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {id: previous_y}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_in</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_out</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="c1"># Object center y coordinate</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">center_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>

            <span class="c1"># Compare with previous position to check line crossing</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
                <span class="n">prev_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">prev_y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_line_y</span> <span class="o">&lt;=</span> <span class="n">center_y</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">count_out</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">prev_y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_line_y</span> <span class="o">&gt;=</span> <span class="n">center_y</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">count_in</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">center_y</span>
</code></pre></div>



</details>

<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./20_Practical_Projects.md">20_Practical_Projects.md</a> - Document scanner, lane detection, AR markers, face filters</li>
</ul>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.opencv.org/4.x/d2/d58/tutorial_table_of_content_dnn.html">OpenCV DNN Module</a></li>
<li><a href="https://arxiv.org/abs/1506.02640">YOLO Paper</a></li>
<li><a href="https://arxiv.org/abs/1512.02325">SSD Paper</a></li>
<li><a href="https://github.com/opencv/opencv/tree/master/samples/dnn">OpenCV Model Zoo</a></li>
<li><a href="https://github.com/onnx/models">ONNX Model Zoo</a></li>
<li><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md">TensorFlow Detection Model Zoo</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Computer_Vision/18_Camera_Calibration.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Camera Calibration</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Computer_Vision/20_Practical_Projects.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Practical Projects</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}