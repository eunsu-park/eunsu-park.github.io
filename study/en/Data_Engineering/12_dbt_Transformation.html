{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dbt Transformation Tool - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Data_Engineering/">Data Engineering</a>
    <span class="separator">/</span>
    <span class="current">dbt Transformation Tool</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>dbt Transformation Tool</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Data_Engineering/11_Data_Lake_Warehouse.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Data Lake and Data Warehouse</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Data_Engineering/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Data_Engineering/13_Data_Quality_Governance.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Data Quality and Governance</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#1-dbt-overview">1. dbt Overview</a><ul>
<li><a href="#11-what-is-dbt">1.1 What is dbt?</a></li>
<li><a href="#12-dbt-core-vs-dbt-cloud">1.2 dbt Core vs dbt Cloud</a></li>
<li><a href="#13-installation">1.3 Installation</a></li>
</ul>
</li>
<li><a href="#2-project-structure">2. Project Structure</a><ul>
<li><a href="#21-project-initialization">2.1 Project Initialization</a></li>
<li><a href="#22-configuration-files">2.2 Configuration Files</a></li>
</ul>
</li>
<li><a href="#3-models">3. Models</a><ul>
<li><a href="#31-basic-models">3.1 Basic Models</a></li>
<li><a href="#32-source-definition">3.2 Source Definition</a></li>
<li><a href="#33-materialization-types">3.3 Materialization Types</a></li>
</ul>
</li>
<li><a href="#4-tests">4. Tests</a><ul>
<li><a href="#41-schema-tests">4.1 Schema Tests</a></li>
<li><a href="#42-custom-tests">4.2 Custom Tests</a></li>
<li><a href="#43-running-tests">4.3 Running Tests</a></li>
</ul>
</li>
<li><a href="#5-documentation">5. Documentation</a><ul>
<li><a href="#51-documentation-definition">5.1 Documentation Definition</a></li>
<li><a href="#52-generate-and-serve-documentation">5.2 Generate and Serve Documentation</a></li>
</ul>
</li>
<li><a href="#6-jinja-templates">6. Jinja Templates</a><ul>
<li><a href="#61-basic-jinja-syntax">6.1 Basic Jinja Syntax</a></li>
<li><a href="#62-macros">6.2 Macros</a></li>
<li><a href="#63-built-in-dbt-functions">6.3 Built-in dbt Functions</a></li>
</ul>
</li>
<li><a href="#7-incremental-processing">7. Incremental Processing</a><ul>
<li><a href="#71-basic-incremental-model">7.1 Basic Incremental Model</a></li>
<li><a href="#72-incremental-strategies">7.2 Incremental Strategies</a></li>
</ul>
</li>
<li><a href="#8-execution-commands">8. Execution Commands</a><ul>
<li><a href="#81-basic-commands">8.1 Basic Commands</a></li>
<li><a href="#82-selectors">8.2 Selectors</a></li>
</ul>
</li>
<li><a href="#practice-problems">Practice Problems</a><ul>
<li><a href="#problem-1-staging-model">Problem 1: Staging Model</a></li>
<li><a href="#problem-2-incremental-model">Problem 2: Incremental Model</a></li>
<li><a href="#problem-3-write-tests">Problem 3: Write Tests</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="dbt-transformation-tool">dbt Transformation Tool<a class="header-link" href="#dbt-transformation-tool" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>dbt (data build tool) is a SQL-based data transformation tool. It handles the Transform step in the ELT pattern and applies software engineering best practices (version control, testing, documentation) to data transformations.</p>
<hr />
<h2 id="1-dbt-overview">1. dbt Overview<a class="header-link" href="#1-dbt-overview" title="Permanent link">&para;</a></h2>
<h3 id="11-what-is-dbt">1.1 What is dbt?<a class="header-link" href="#11-what-is-dbt" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        dbt Role                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚   Handles T(Transform) in ELT Pipeline                         â”‚
â”‚                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ Extract  â”‚ â†’  â”‚   Load   â”‚ â†’  â”‚Transform â”‚               â”‚
â”‚   â”‚ (Fivetranâ”‚    â”‚  (to DW) â”‚    â”‚  (dbt)   â”‚               â”‚
â”‚   â”‚  Airbyte)â”‚    â”‚          â”‚    â”‚          â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                â”‚
â”‚   Core dbt Features:                                           â”‚
â”‚   - SQL-based model definition                                 â”‚
â”‚   - Automatic dependency management                            â”‚
â”‚   - Testing and documentation                                  â”‚
â”‚   - Jinja template support                                     â”‚
â”‚   - Version control (Git)                                      â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-dbt-core-vs-dbt-cloud">1.2 dbt Core vs dbt Cloud<a class="header-link" href="#12-dbt-core-vs-dbt-cloud" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>dbt Core</th>
<th>dbt Cloud</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cost</strong></td>
<td>Free (Open Source)</td>
<td>Paid (SaaS)</td>
</tr>
<tr>
<td><strong>Execution</strong></td>
<td>CLI</td>
<td>Web UI + API</td>
</tr>
<tr>
<td><strong>Scheduling</strong></td>
<td>External tool required (Airflow)</td>
<td>Built-in scheduler</td>
</tr>
<tr>
<td><strong>IDE</strong></td>
<td>VS Code etc.</td>
<td>Built-in IDE</td>
</tr>
<tr>
<td><strong>Collaboration</strong></td>
<td>Git-based</td>
<td>Built-in collaboration</td>
</tr>
</tbody>
</table>
<h3 id="13-installation">1.3 Installation<a class="header-link" href="#13-installation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Install dbt Core</span>
pip<span class="w"> </span>install<span class="w"> </span>dbt-core

<span class="c1"># Install database-specific adapters</span>
pip<span class="w"> </span>install<span class="w"> </span>dbt-postgres<span class="w">      </span><span class="c1"># PostgreSQL</span>
pip<span class="w"> </span>install<span class="w"> </span>dbt-snowflake<span class="w">     </span><span class="c1"># Snowflake</span>
pip<span class="w"> </span>install<span class="w"> </span>dbt-bigquery<span class="w">      </span><span class="c1"># BigQuery</span>
pip<span class="w"> </span>install<span class="w"> </span>dbt-redshift<span class="w">      </span><span class="c1"># Redshift</span>
pip<span class="w"> </span>install<span class="w"> </span>dbt-databricks<span class="w">    </span><span class="c1"># Databricks</span>

<span class="c1"># Check version</span>
dbt<span class="w"> </span>--version
</code></pre></div>

<hr />
<h2 id="2-project-structure">2. Project Structure<a class="header-link" href="#2-project-structure" title="Permanent link">&para;</a></h2>
<h3 id="21-project-initialization">2.1 Project Initialization<a class="header-link" href="#21-project-initialization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create new project</span>
dbt<span class="w"> </span>init<span class="w"> </span>my_project
<span class="nb">cd</span><span class="w"> </span>my_project

<span class="c1"># Project structure</span>
my_project/
â”œâ”€â”€<span class="w"> </span>dbt_project.yml<span class="w">          </span><span class="c1"># Project configuration</span>
â”œâ”€â”€<span class="w"> </span>profiles.yml<span class="w">             </span><span class="c1"># Connection settings (~/.dbt/profiles.yml)</span>
â”œâ”€â”€<span class="w"> </span>models/<span class="w">                  </span><span class="c1"># SQL models</span>
â”‚<span class="w">   </span>â”œâ”€â”€<span class="w"> </span>staging/<span class="w">            </span><span class="c1"># Staging models</span>
â”‚<span class="w">   </span>â”œâ”€â”€<span class="w"> </span>intermediate/<span class="w">       </span><span class="c1"># Intermediate models</span>
â”‚<span class="w">   </span>â””â”€â”€<span class="w"> </span>marts/<span class="w">              </span><span class="c1"># Final models</span>
â”œâ”€â”€<span class="w"> </span>tests/<span class="w">                   </span><span class="c1"># Custom tests</span>
â”œâ”€â”€<span class="w"> </span>macros/<span class="w">                  </span><span class="c1"># Reusable macros</span>
â”œâ”€â”€<span class="w"> </span>seeds/<span class="w">                   </span><span class="c1"># Seed data (CSV)</span>
â”œâ”€â”€<span class="w"> </span>snapshots/<span class="w">               </span><span class="c1"># SCD snapshots</span>
â”œâ”€â”€<span class="w"> </span>analyses/<span class="w">                </span><span class="c1"># Analysis queries</span>
â””â”€â”€<span class="w"> </span>target/<span class="w">                  </span><span class="c1"># Compiled results</span>
</code></pre></div>

<h3 id="22-configuration-files">2.2 Configuration Files<a class="header-link" href="#22-configuration-files" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># dbt_project.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;my_project&#39;</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0.0&#39;</span>
<span class="nt">config-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>

<span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;my_project&#39;</span>

<span class="nt">model-paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;models&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">analysis-paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;analyses&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">test-paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;tests&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">seed-paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;seeds&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">macro-paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;macros&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">snapshot-paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;snapshots&quot;</span><span class="p p-Indicator">]</span>

<span class="nt">target-path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;target&quot;</span>
<span class="nt">clean-targets</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;target&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;dbt_packages&quot;</span>

<span class="c1"># Model-specific configuration</span>
<span class="nt">models</span><span class="p">:</span>
<span class="w">  </span><span class="nt">my_project</span><span class="p">:</span>
<span class="w">    </span><span class="nt">staging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">+materialized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">view</span>
<span class="w">      </span><span class="nt">+schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class="w">    </span><span class="nt">intermediate</span><span class="p">:</span>
<span class="w">      </span><span class="nt">+materialized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ephemeral</span>
<span class="w">    </span><span class="nt">marts</span><span class="p">:</span>
<span class="w">      </span><span class="nt">+materialized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="w">      </span><span class="nt">+schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">marts</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># profiles.yml (~/.dbt/profiles.yml)</span>
<span class="nt">my_project</span><span class="p">:</span>
<span class="w">  </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dev</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">env_var(&#39;DB_PASSWORD&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">dbname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analytics</span>
<span class="w">      </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbt_dev</span>
<span class="w">      </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>

<span class="w">    </span><span class="nt">prod</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">      </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod-db.example.com</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="w">      </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">env_var(&#39;PROD_USER&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">env_var(&#39;PROD_PASSWORD&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">dbname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analytics</span>
<span class="w">      </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbt_prod</span>
<span class="w">      </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
</code></pre></div>

<hr />
<h2 id="3-models">3. Models<a class="header-link" href="#3-models" title="Permanent link">&para;</a></h2>
<h3 id="31-basic-models">3.1 Basic Models<a class="header-link" href="#31-basic-models" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- models/staging/stg_orders.sql</span>
<span class="c1">-- Staging model: Clean source data</span>

<span class="k">SELECT</span>
<span class="w">    </span><span class="n">order_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
<span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="n">order_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_date</span><span class="p">,</span>
<span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="p">,</span>
<span class="w">    </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">loaded_at</span>
<span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">source</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">order_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- models/staging/stg_customers.sql</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">customer_id</span><span class="p">,</span>
<span class="w">    </span><span class="k">TRIM</span><span class="p">(</span><span class="n">first_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">first_name</span><span class="p">,</span>
<span class="w">    </span><span class="k">TRIM</span><span class="p">(</span><span class="n">last_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">last_name</span><span class="p">,</span>
<span class="w">    </span><span class="k">LOWER</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span>
<span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">source</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;customers&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- models/marts/core/fct_orders.sql</span>
<span class="c1">-- Fact table: Orders</span>

<span class="err">{{</span>
<span class="w">    </span><span class="n">config</span><span class="p">(</span>
<span class="w">        </span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">unique_key</span><span class="o">=</span><span class="s1">&#39;order_id&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">partition_by</span><span class="o">=</span><span class="err">{</span>
<span class="w">            </span><span class="s1">&#39;field&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;data_type&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;date&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;granularity&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;month&#39;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="p">)</span>
<span class="err">}}</span>

<span class="k">WITH</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">ref</span><span class="p">(</span><span class="s1">&#39;stg_orders&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
<span class="p">),</span>

<span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">ref</span><span class="p">(</span><span class="s1">&#39;stg_customers&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
<span class="p">)</span>

<span class="k">SELECT</span>
<span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span>
<span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span>
<span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">status</span><span class="p">,</span>
<span class="w">    </span><span class="c1">-- Derived columns</span>
<span class="w">    </span><span class="k">EXTRACT</span><span class="p">(</span><span class="k">YEAR</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_year</span><span class="p">,</span>
<span class="w">    </span><span class="k">EXTRACT</span><span class="p">(</span><span class="k">MONTH</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_month</span><span class="p">,</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;high&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;low&#39;</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">order_tier</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span>
</code></pre></div>

<h3 id="32-source-definition">3.2 Source Definition<a class="header-link" href="#32-source-definition" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># models/staging/_sources.yml</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>

<span class="nt">sources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raw</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">sources&quot;</span>
<span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw_db</span>
<span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public</span>
<span class="w">    </span><span class="nt">tables</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raw</span><span class="nv"> </span><span class="s">orders</span><span class="nv"> </span><span class="s">table&quot;</span>
<span class="w">        </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Unique</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">ID&quot;</span>
<span class="w">            </span><span class="nt">tests</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unique</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Customer</span><span class="nv"> </span><span class="s">ID&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amount</span>
<span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Order</span><span class="nv"> </span><span class="s">amount&quot;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raw</span><span class="nv"> </span><span class="s">customers</span><span class="nv"> </span><span class="s">table&quot;</span>
<span class="w">        </span><span class="nt">freshness</span><span class="p">:</span>
<span class="w">          </span><span class="nt">warn_after</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="nt"> period</span><span class="p">:</span><span class="w"> </span><span class="nv">hour</span><span class="p p-Indicator">}</span>
<span class="w">          </span><span class="nt">error_after</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="nv">24</span><span class="p p-Indicator">,</span><span class="nt"> period</span><span class="p">:</span><span class="w"> </span><span class="nv">hour</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">loaded_at_field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_at</span>
</code></pre></div>

<h3 id="33-materialization-types">3.3 Materialization Types<a class="header-link" href="#33-materialization-types" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- View (default): Query executed each time</span>
<span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">(</span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="c1">-- Table: Create physical table</span>
<span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">(</span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="c1">-- Incremental: Incremental processing</span>
<span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">(</span>
<span class="w">    </span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">unique_key</span><span class="o">=</span><span class="s1">&#39;order_id&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">on_schema_change</span><span class="o">=</span><span class="s1">&#39;append_new_columns&#39;</span>
<span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">source</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_incremental</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="err">}}</span><span class="p">)</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>

<span class="c1">-- Ephemeral: Inline as CTE (no table created)</span>
<span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">(</span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;ephemeral&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
</code></pre></div>

<hr />
<h2 id="4-tests">4. Tests<a class="header-link" href="#4-tests" title="Permanent link">&para;</a></h2>
<h3 id="41-schema-tests">4.1 Schema Tests<a class="header-link" href="#41-schema-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># models/marts/core/_schema.yml</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>

<span class="nt">models</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fct_orders</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Orders</span><span class="nv"> </span><span class="s">fact</span><span class="nv"> </span><span class="s">table&quot;</span>
<span class="w">    </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Unique</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">ID&quot;</span>
<span class="w">        </span><span class="nt">tests</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unique</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>
<span class="w">        </span><span class="nt">tests</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">relationships</span><span class="p">:</span>
<span class="w">              </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ref(&#39;dim_customers&#39;)</span>
<span class="w">              </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amount</span>
<span class="w">        </span><span class="nt">tests</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dbt_utils.expression_is_true</span><span class="p">:</span>
<span class="w">              </span><span class="nt">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&gt;=</span><span class="nv"> </span><span class="s">0&quot;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">status</span>
<span class="w">        </span><span class="nt">tests</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">accepted_values</span><span class="p">:</span>
<span class="w">              </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;pending&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;completed&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;cancelled&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;refunded&#39;</span><span class="p p-Indicator">]</span>
</code></pre></div>

<h3 id="42-custom-tests">4.2 Custom Tests<a class="header-link" href="#42-custom-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- tests/assert_positive_amounts.sql</span>
<span class="c1">-- Verify all order amounts are positive</span>

<span class="k">SELECT</span>
<span class="w">    </span><span class="n">order_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">amount</span>
<span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">ref</span><span class="p">(</span><span class="s1">&#39;fct_orders&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- macros/test_row_count_equal.sql</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">row_count_equal</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">compare_model</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>

<span class="k">WITH</span><span class="w"> </span><span class="n">model_count</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="err">}}</span>
<span class="p">),</span>

<span class="n">compare_count</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="n">compare_model</span><span class="w"> </span><span class="err">}}</span>
<span class="p">)</span>

<span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">cnt</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">model_count</span><span class="p">,</span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">cnt</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">compare_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">model_count</span><span class="w"> </span><span class="n">m</span>
<span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">compare_count</span><span class="w"> </span><span class="k">c</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">cnt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">cnt</span>

<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endtest</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
</code></pre></div>

<h3 id="43-running-tests">4.3 Running Tests<a class="header-link" href="#43-running-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Run all tests</span>
dbt<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Test specific model</span>
dbt<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--select<span class="w"> </span>fct_orders

<span class="c1"># Test source freshness</span>
dbt<span class="w"> </span><span class="nb">source</span><span class="w"> </span>freshness
</code></pre></div>

<hr />
<h2 id="5-documentation">5. Documentation<a class="header-link" href="#5-documentation" title="Permanent link">&para;</a></h2>
<h3 id="51-documentation-definition">5.1 Documentation Definition<a class="header-link" href="#51-documentation-definition" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># models/marts/core/_schema.yml</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>

<span class="nt">models</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fct_orders</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">## Orders Fact Table</span>

<span class="w">      </span><span class="no">This table contains all order transactions.</span>

<span class="w">      </span><span class="no">### Use Cases</span>
<span class="w">      </span><span class="no">- Daily/monthly revenue analysis</span>
<span class="w">      </span><span class="no">- Customer purchase pattern analysis</span>
<span class="w">      </span><span class="no">- Repeat purchase rate calculation</span>

<span class="w">      </span><span class="no">### Refresh Schedule</span>
<span class="w">      </span><span class="no">- Daily at 06:00 UTC</span>

<span class="w">    </span><span class="nt">meta</span><span class="p">:</span>
<span class="w">      </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;data-team@company.com&quot;</span>
<span class="w">      </span><span class="nt">contains_pii</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">    </span><span class="nt">columns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_id</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Unique</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">identifier</span><span class="nv"> </span><span class="s">(UUID)&quot;</span>
<span class="w">        </span><span class="nt">meta</span><span class="p">:</span>
<span class="w">          </span><span class="nt">dimension</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amount</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Total</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">amount</span><span class="nv"> </span><span class="s">(USD)&quot;</span>
<span class="w">        </span><span class="nt">meta</span><span class="p">:</span>
<span class="w">          </span><span class="nt">measure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">          </span><span class="nt">aggregation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
</code></pre></div>

<h3 id="52-generate-and-serve-documentation">5.2 Generate and Serve Documentation<a class="header-link" href="#52-generate-and-serve-documentation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Generate documentation</span>
dbt<span class="w"> </span>docs<span class="w"> </span>generate

<span class="c1"># Serve documentation</span>
dbt<span class="w"> </span>docs<span class="w"> </span>serve<span class="w"> </span>--port<span class="w"> </span><span class="m">8080</span>

<span class="c1"># View at http://localhost:8080</span>
</code></pre></div>

<hr />
<h2 id="6-jinja-templates">6. Jinja Templates<a class="header-link" href="#6-jinja-templates" title="Permanent link">&para;</a></h2>
<h3 id="61-basic-jinja-syntax">6.1 Basic Jinja Syntax<a class="header-link" href="#61-basic-jinja-syntax" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Variables</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">my_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;value&#39;</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;{{ my_var }}&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">col</span>

<span class="c1">-- Conditionals</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;prod&#39;</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;high&#39;</span>
<span class="w">        </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;high&#39;</span>
<span class="w">        </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;low&#39;</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tier</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">orders</span>

<span class="c1">-- Loops</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">order_id</span><span class="p">,</span>
<span class="w">    </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;discount&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="err">{{</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="err">}}</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_</span><span class="err">{{</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="err">}}{</span><span class="o">%</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">loop</span><span class="p">.</span><span class="k">last</span><span class="w"> </span><span class="o">%</span><span class="err">}</span><span class="p">,</span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">    </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endfor</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">order_items</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">order_id</span>
</code></pre></div>

<h3 id="62-macros">6.2 Macros<a class="header-link" href="#62-macros" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- macros/generate_schema_name.sql</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="n">generate_schema_name</span><span class="p">(</span><span class="n">custom_schema_name</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="o">-%</span><span class="err">}</span>
<span class="w">    </span><span class="err">{</span><span class="o">%-</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">default_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="k">schema</span><span class="w"> </span><span class="o">-%</span><span class="err">}</span>
<span class="w">    </span><span class="err">{</span><span class="o">%-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">custom_schema_name</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">none</span><span class="w"> </span><span class="o">-%</span><span class="err">}</span>
<span class="w">        </span><span class="err">{{</span><span class="w"> </span><span class="n">default_schema</span><span class="w"> </span><span class="err">}}</span>
<span class="w">    </span><span class="err">{</span><span class="o">%-</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">-%</span><span class="err">}</span>
<span class="w">        </span><span class="err">{{</span><span class="w"> </span><span class="n">default_schema</span><span class="w"> </span><span class="err">}}</span><span class="n">_</span><span class="err">{{</span><span class="w"> </span><span class="n">custom_schema_name</span><span class="w"> </span><span class="err">}}</span>
<span class="w">    </span><span class="err">{</span><span class="o">%-</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="o">-%</span><span class="err">}</span>
<span class="err">{</span><span class="o">%-</span><span class="w"> </span><span class="n">endmacro</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>


<span class="c1">-- macros/cents_to_dollars.sql</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="n">cents_to_dollars</span><span class="p">(</span><span class="k">column_name</span><span class="p">,</span><span class="w"> </span><span class="k">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="err">{{</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="err">}}</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">precision</span><span class="w"> </span><span class="err">}}</span><span class="p">)</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endmacro</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>


<span class="c1">-- macros/limit_data_in_dev.sql</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="n">limit_data_in_dev</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">    </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;dev&#39;</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">        </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endmacro</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- Using macros</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">order_id</span><span class="p">,</span>
<span class="w">    </span><span class="err">{{</span><span class="w"> </span><span class="n">cents_to_dollars</span><span class="p">(</span><span class="s1">&#39;amount_cents&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount_dollars</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">orders</span>
<span class="err">{{</span><span class="w"> </span><span class="n">limit_data_in_dev</span><span class="p">()</span><span class="w"> </span><span class="err">}}</span>
</code></pre></div>

<h3 id="63-built-in-dbt-functions">6.3 Built-in dbt Functions<a class="header-link" href="#63-built-in-dbt-functions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- ref(): Reference another model</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">ref</span><span class="p">(</span><span class="s1">&#39;stg_orders&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="c1">-- source(): Reference source table</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">source</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;orders&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="c1">-- this: Reference current model (useful in incremental)</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_incremental</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">updated_at</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="err">}}</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>

<span class="c1">-- config(): Access configuration values</span>
<span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">&#39;materialized&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="c1">-- target: Target environment information</span>
<span class="err">{{</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="err">}}</span><span class="w">    </span><span class="c1">-- dev, prod</span>
<span class="err">{{</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="k">schema</span><span class="w"> </span><span class="err">}}</span><span class="w">  </span><span class="c1">-- dbt_dev</span>
<span class="err">{{</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="err">}}</span><span class="w">    </span><span class="c1">-- postgres, snowflake</span>
</code></pre></div>

<hr />
<h2 id="7-incremental-processing">7. Incremental Processing<a class="header-link" href="#7-incremental-processing" title="Permanent link">&para;</a></h2>
<h3 id="71-basic-incremental-model">7.1 Basic Incremental Model<a class="header-link" href="#71-basic-incremental-model" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- models/marts/fct_events.sql</span>
<span class="err">{{</span>
<span class="w">    </span><span class="n">config</span><span class="p">(</span>
<span class="w">        </span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">unique_key</span><span class="o">=</span><span class="s1">&#39;event_id&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">incremental_strategy</span><span class="o">=</span><span class="s1">&#39;delete+insert&#39;</span>
<span class="w">    </span><span class="p">)</span>
<span class="err">}}</span>

<span class="k">SELECT</span>
<span class="w">    </span><span class="n">event_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">event_type</span><span class="p">,</span>
<span class="w">    </span><span class="n">event_data</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span>
<span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">source</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;events&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_incremental</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="c1">-- Process only data since last run</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="err">}}</span><span class="p">)</span>
<span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
</code></pre></div>

<h3 id="72-incremental-strategies">7.2 Incremental Strategies<a class="header-link" href="#72-incremental-strategies" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Append (default): Only add new data</span>
<span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">(</span>
<span class="w">    </span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">incremental_strategy</span><span class="o">=</span><span class="s1">&#39;append&#39;</span>
<span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="c1">-- Delete+Insert: Delete by key then insert</span>
<span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">(</span>
<span class="w">    </span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">unique_key</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">incremental_strategy</span><span class="o">=</span><span class="s1">&#39;delete+insert&#39;</span>
<span class="p">)</span><span class="w"> </span><span class="err">}}</span>

<span class="c1">-- Merge (Snowflake, BigQuery): Use MERGE statement</span>
<span class="err">{{</span><span class="w"> </span><span class="n">config</span><span class="p">(</span>
<span class="w">    </span><span class="n">materialized</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">unique_key</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">incremental_strategy</span><span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">merge_update_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;amount&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="w"> </span><span class="err">}}</span>
</code></pre></div>

<hr />
<h2 id="8-execution-commands">8. Execution Commands<a class="header-link" href="#8-execution-commands" title="Permanent link">&para;</a></h2>
<h3 id="81-basic-commands">8.1 Basic Commands<a class="header-link" href="#81-basic-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Test connection</span>
dbt<span class="w"> </span>debug

<span class="c1"># Run all models</span>
dbt<span class="w"> </span>run

<span class="c1"># Run specific model only</span>
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>fct_orders
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>staging.*
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>+fct_orders+<span class="w">  </span><span class="c1"># Include dependencies</span>

<span class="c1"># Run tests</span>
dbt<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Build (run + test)</span>
dbt<span class="w"> </span>build

<span class="c1"># Load seed data</span>
dbt<span class="w"> </span>seed

<span class="c1"># Compile only (no execution)</span>
dbt<span class="w"> </span>compile

<span class="c1"># Clean</span>
dbt<span class="w"> </span>clean
</code></pre></div>

<h3 id="82-selectors">8.2 Selectors<a class="header-link" href="#82-selectors" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># By model name</span>
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>my_model

<span class="c1"># By path</span>
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>models/staging/*

<span class="c1"># By tag</span>
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>tag:daily

<span class="c1"># Include upstream dependencies</span>
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>+my_model

<span class="c1"># Include downstream dependencies</span>
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>my_model+

<span class="c1"># Both directions</span>
dbt<span class="w"> </span>run<span class="w"> </span>--select<span class="w"> </span>+my_model+

<span class="c1"># Exclude specific model</span>
dbt<span class="w"> </span>run<span class="w"> </span>--exclude<span class="w"> </span>my_model
</code></pre></div>

<hr />
<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-staging-model">Problem 1: Staging Model<a class="header-link" href="#problem-1-staging-model" title="Permanent link">&para;</a></h3>
<p>Create a stg_products model from the raw products table. Convert prices to dollars and handle NULL values.</p>
<h3 id="problem-2-incremental-model">Problem 2: Incremental Model<a class="header-link" href="#problem-2-incremental-model" title="Permanent link">&para;</a></h3>
<p>Write a model that incrementally processes daily sales aggregates.</p>
<h3 id="problem-3-write-tests">Problem 3: Write Tests<a class="header-link" href="#problem-3-write-tests" title="Permanent link">&para;</a></h3>
<p>Write tests for the fct_sales model (unique, not_null, positive amount check).</p>
<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Model</strong></td>
<td>SQL-based data transformation definition</td>
</tr>
<tr>
<td><strong>Source</strong></td>
<td>Raw data reference</td>
</tr>
<tr>
<td><strong>ref()</strong></td>
<td>Reference between models (automatic dependency management)</td>
</tr>
<tr>
<td><strong>Test</strong></td>
<td>Data quality validation</td>
</tr>
<tr>
<td><strong>Materialization</strong></td>
<td>view, table, incremental, ephemeral</td>
</tr>
<tr>
<td><strong>Macro</strong></td>
<td>Reusable SQL templates</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.getdbt.com/">dbt Documentation</a></li>
<li><a href="https://courses.getdbt.com/">dbt Learn</a></li>
<li><a href="https://docs.getdbt.com/guides/best-practices">dbt Best Practices</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Data_Engineering/11_Data_Lake_Warehouse.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Data Lake and Data Warehouse</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Data_Engineering/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Data_Engineering/13_Data_Quality_Governance.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Data Quality and Governance</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}