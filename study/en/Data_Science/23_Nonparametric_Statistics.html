{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23. Nonparametric Statistics - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Data_Science/">Data Science</a>
    <span class="separator">/</span>
    <span class="current">23. Nonparametric Statistics</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>23. Nonparametric Statistics</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Data_Science/22_Multivariate_Analysis.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">22. Multivariate Analysis</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Data_Science/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Data_Science/24_Experimental_Design.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">24. Experimental Design</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#1-when-nonparametric-tests-are-needed">1. When Nonparametric Tests Are Needed</a><ul>
<li><a href="#11-when-to-use-nonparametric-tests">1.1 When to Use Nonparametric Tests?</a></li>
<li><a href="#12-parametric-vs-nonparametric-test-correspondence">1.2 Parametric vs Nonparametric Test Correspondence</a></li>
</ul>
</li>
<li><a href="#2-mann-whitney-u-test">2. Mann-Whitney U Test</a><ul>
<li><a href="#21-concept">2.1 Concept</a></li>
<li><a href="#22-one-sided-tests">2.2 One-sided Tests</a></li>
</ul>
</li>
<li><a href="#3-wilcoxon-signed-rank-test">3. Wilcoxon Signed-Rank Test</a><ul>
<li><a href="#31-paired-sample-comparison">3.1 Paired Sample Comparison</a></li>
<li><a href="#32-one-sample-test-median-test">3.2 One-sample Test (Median Test)</a></li>
</ul>
</li>
<li><a href="#4-kruskal-wallis-h-test">4. Kruskal-Wallis H Test</a><ul>
<li><a href="#41-concept">4.1 Concept</a></li>
<li><a href="#42-post-hoc-tests">4.2 Post-hoc Tests</a></li>
</ul>
</li>
<li><a href="#5-friedman-test">5. Friedman Test</a><ul>
<li><a href="#51-concept">5.1 Concept</a></li>
<li><a href="#52-nemenyi-post-hoc-test">5.2 Nemenyi Post-hoc Test</a></li>
</ul>
</li>
<li><a href="#6-nonparametric-correlation-spearman-kendall">6. Nonparametric Correlation (Spearman, Kendall)</a><ul>
<li><a href="#61-spearman-rank-correlation">6.1 Spearman Rank Correlation</a></li>
<li><a href="#62-kendall-rank-correlation">6.2 Kendall Rank Correlation</a></li>
<li><a href="#63-correlation-coefficient-comparison">6.3 Correlation Coefficient Comparison</a></li>
</ul>
</li>
<li><a href="#7-practice-examples">7. Practice Examples</a><ul>
<li><a href="#71-comprehensive-nonparametric-analysis">7.1 Comprehensive Nonparametric Analysis</a></li>
</ul>
</li>
<li><a href="#8-practice-problems">8. Practice Problems</a><ul>
<li><a href="#problem-1-test-selection">Problem 1: Test Selection</a></li>
<li><a href="#problem-2-mann-whitney-u">Problem 2: Mann-Whitney U</a></li>
<li><a href="#problem-3-correlation-analysis">Problem 3: Correlation Analysis</a></li>
<li><a href="#problem-4-kruskal-wallis-post-hoc">Problem 4: Kruskal-Wallis Post-hoc</a></li>
</ul>
</li>
<li><a href="#9-key-summary">9. Key Summary</a><ul>
<li><a href="#test-selection-flowchart">Test Selection Flowchart</a></li>
<li><a href="#scipystats-functions">scipy.stats Functions</a></li>
<li><a href="#effect-size-interpretation">Effect Size Interpretation</a></li>
<li><a href="#next-chapter-preview">Next Chapter Preview</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="23-nonparametric-statistics">23. Nonparametric Statistics<a class="header-link" href="#23-nonparametric-statistics" title="Permanent link">&para;</a></h1>
<p><a href="./22_Multivariate_Analysis.md">Previous: Multivariate Analysis</a> | <a href="./24_Experimental_Design.md">Next: Experimental Design</a></p>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Nonparametric statistics are methods for analyzing data without assumptions about the population distribution. They are useful when normality is not satisfied or when sample size is small.</p>
<hr />
<h2 id="1-when-nonparametric-tests-are-needed">1. When Nonparametric Tests Are Needed<a class="header-link" href="#1-when-nonparametric-tests-are-needed" title="Permanent link">&para;</a></h2>
<h3 id="11-when-to-use-nonparametric-tests">1.1 When to Use Nonparametric Tests?<a class="header-link" href="#11-when-to-use-nonparametric-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">when_to_use_nonparametric</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;When to use nonparametric tests&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ================================================</span>
<span class="s2">    When to Use Nonparametric Tests</span>
<span class="s2">    ================================================</span>

<span class="s2">    1. Violation of Normality</span>
<span class="s2">       - Data does not follow a normal distribution</span>
<span class="s2">       - Rejection by Shapiro-Wilk test, etc.</span>

<span class="s2">    2. Small Sample Size</span>
<span class="s2">       - When n &lt; 30, CLT is difficult to apply</span>
<span class="s2">       - Normality tests also lack power</span>

<span class="s2">    3. Ordinal/Rank Data</span>
<span class="s2">       - Likert scales (1-5 points)</span>
<span class="s2">       - Ranked data</span>

<span class="s2">    4. Presence of Outliers</span>
<span class="s2">       - Compare medians instead of means (which are sensitive to extreme values)</span>
<span class="s2">       - Rank-based methods are robust to outliers</span>

<span class="s2">    5. Violation of Homogeneity Assumption</span>
<span class="s2">       - Violation of variance homogeneity (equal variance) assumption</span>

<span class="s2">    ================================================</span>
<span class="s2">    Advantages and Disadvantages of Nonparametric Tests</span>
<span class="s2">    ================================================</span>

<span class="s2">    Advantages:</span>
<span class="s2">    - No distributional assumptions required</span>
<span class="s2">    - Robust to outliers</span>
<span class="s2">    - Suitable for ordinal data</span>

<span class="s2">    Disadvantages:</span>
<span class="s2">    - Lower power than parametric tests when assumptions are met</span>
<span class="s2">    - Effect size interpretation can be difficult</span>
<span class="s2">    - Difficult to apply to some complex designs</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">when_to_use_nonparametric</span><span class="p">()</span>

<span class="c1"># Normality test example</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_normality</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform normality test&quot;&quot;&quot;</span>
    <span class="c1"># Shapiro-Wilk</span>
    <span class="n">stat_sw</span><span class="p">,</span> <span class="n">p_sw</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># D&#39;Agostino-Pearson</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">:</span>
        <span class="n">stat_da</span><span class="p">,</span> <span class="n">p_da</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stat_da</span><span class="p">,</span> <span class="n">p_da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Normality Tests ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shapiro-Wilk: W=</span><span class="si">{</span><span class="n">stat_sw</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p_sw</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">p_da</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;D&#39;Agostino-Pearson: p=</span><span class="si">{</span><span class="n">p_da</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">is_normal</span> <span class="o">=</span> <span class="n">p_sw</span> <span class="o">&gt;</span> <span class="n">alpha</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conclusion: </span><span class="si">{</span><span class="s1">&#39;Can be considered normal&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_normal</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not normal&#39;</span><span class="si">}</span><span class="s2"> (Œ±=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">is_normal</span>

<span class="c1"># Normal data</span>
<span class="n">normal_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">check_normality</span><span class="p">(</span><span class="n">normal_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Non-normal data (exponential distribution)</span>
<span class="n">skewed_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">check_normality</span><span class="p">(</span><span class="n">skewed_data</span><span class="p">)</span>
</code></pre></div>

<h3 id="12-parametric-vs-nonparametric-test-correspondence">1.2 Parametric vs Nonparametric Test Correspondence<a class="header-link" href="#12-parametric-vs-nonparametric-test-correspondence" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parametric Test</th>
<th>Nonparametric Test</th>
<th>Situation</th>
</tr>
</thead>
<tbody>
<tr>
<td>1-sample t-test</td>
<td>Wilcoxon signed-rank test</td>
<td>Single sample, median test</td>
</tr>
<tr>
<td>Independent t-test</td>
<td>Mann-Whitney U</td>
<td>Two independent samples</td>
</tr>
<tr>
<td>Paired t-test</td>
<td>Wilcoxon signed-rank test</td>
<td>Paired samples</td>
</tr>
<tr>
<td>One-way ANOVA</td>
<td>Kruskal-Wallis H</td>
<td>3+ independent samples</td>
</tr>
<tr>
<td>Repeated measures ANOVA</td>
<td>Friedman</td>
<td>3+ paired samples</td>
</tr>
<tr>
<td>Pearson correlation</td>
<td>Spearman/Kendall</td>
<td>Correlation</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-mann-whitney-u-test">2. Mann-Whitney U Test<a class="header-link" href="#2-mann-whitney-u-test" title="Permanent link">&para;</a></h2>
<h3 id="21-concept">2.1 Concept<a class="header-link" href="#21-concept" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Compare distributions of two independent samples (median or distribution location)</p>
<p><strong>Hypotheses</strong>:
- H‚ÇÄ: The two groups have identical distributions
- H‚ÇÅ: The two groups have different distributions (or one is probabilistically larger)</p>
<p><strong>Test statistic</strong>: U (based on rank sum)</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mann_whitney_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mann-Whitney U test example&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Scenario: Compare treatment effects of two groups (normality violation)</span>
    <span class="c1"># Group A: Control</span>
    <span class="c1"># Group B: Treatment</span>

    <span class="n">group_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>  <span class="c1"># Non-normal</span>
    <span class="n">group_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>  <span class="c1"># Non-normal, larger values</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Mann-Whitney U Test ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Group A: n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group_a</span><span class="p">)</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">group_a</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Group B: n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group_b</span><span class="p">)</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">group_b</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Normality tests</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Normality tests:&quot;</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">p_a</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">group_a</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">p_b</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">group_b</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Group A: p=</span><span class="si">{</span><span class="n">p_a</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Group B: p=</span><span class="si">{</span><span class="n">p_b</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Mann-Whitney U test</span>
    <span class="n">statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mann-Whitney U test:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  U statistic: </span><span class="si">{</span><span class="n">statistic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Conclusion: Significant difference between groups (p &lt; 0.05)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Conclusion: No significant difference between groups (p &gt;= 0.05)&quot;</span><span class="p">)</span>

    <span class="c1"># Effect size: rank-biserial correlation</span>
    <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_a</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_b</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">statistic</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Effect size (rank-biserial r): </span><span class="si">{</span><span class="n">r</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  |r| &lt; 0.1: Small effect&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  0.1 &lt;= |r| &lt; 0.3: Medium effect&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  |r| &gt;= 0.3: Large effect&quot;</span><span class="p">)</span>

    <span class="c1"># Visualization</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># Boxplot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Group A&#39;</span><span class="p">,</span> <span class="s1">&#39;Group B&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Boxplot&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Histogram</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">group_a</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Group A&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">group_b</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Group B&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">group_a</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;A median&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">group_b</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;B median&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution Comparison&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Rank distribution</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span><span class="p">])</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
    <span class="n">ranks_a</span> <span class="o">=</span> <span class="n">ranks</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">group_a</span><span class="p">)]</span>
    <span class="n">ranks_b</span> <span class="o">=</span> <span class="n">ranks</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">group_a</span><span class="p">):]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ranks_a</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Group A ranks&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ranks_b</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Group B ranks&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Rank&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Rank Distribution&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span>

<span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span> <span class="o">=</span> <span class="n">mann_whitney_example</span><span class="p">()</span>
</code></pre></div>

<h3 id="22-one-sided-tests">2.2 One-sided Tests<a class="header-link" href="#22-one-sided-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># One-sided test: Test if Group B is larger than Group A</span>
<span class="n">stat_greater</span><span class="p">,</span> <span class="n">p_greater</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;less&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One-sided test (B &gt; A): p = </span><span class="si">{</span><span class="n">p_greater</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">stat_less</span><span class="p">,</span> <span class="n">p_less</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">group_a</span><span class="p">,</span> <span class="n">group_b</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;greater&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One-sided test (A &gt; B): p = </span><span class="si">{</span><span class="n">p_less</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="3-wilcoxon-signed-rank-test">3. Wilcoxon Signed-Rank Test<a class="header-link" href="#3-wilcoxon-signed-rank-test" title="Permanent link">&para;</a></h2>
<h3 id="31-paired-sample-comparison">3.1 Paired Sample Comparison<a class="header-link" href="#31-paired-sample-comparison" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Test if the difference between paired measurements is zero</p>
<p><strong>Use case</strong>: Before/after comparison, paired samples</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wilcoxon_signed_rank_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wilcoxon signed-rank test example&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Scenario: Weight change before and after diet program</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">before</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="c1"># Mean 3kg reduction effect + non-normal error</span>
    <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="n">after</span> <span class="o">-</span> <span class="n">before</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Wilcoxon Signed-Rank Test ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sample size: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before: mean=</span><span class="si">{</span><span class="n">before</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">before</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After: mean=</span><span class="si">{</span><span class="n">after</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">after</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Difference: mean=</span><span class="si">{</span><span class="n">diff</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Normality test on differences</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">p_norm</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Normality of differences: p=</span><span class="si">{</span><span class="n">p_norm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Wilcoxon test</span>
    <span class="n">statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Wilcoxon test:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  W statistic: </span><span class="si">{</span><span class="n">statistic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Comparison with paired t-test</span>
    <span class="n">t_stat</span><span class="p">,</span> <span class="n">t_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_rel</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Paired t-test (for comparison):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  t statistic: </span><span class="si">{</span><span class="n">t_stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  p-value: </span><span class="si">{</span><span class="n">t_p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Effect size</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">statistic</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Effect size (r): </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Visualization</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># Before/After comparison</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Before&#39;</span><span class="p">,</span> <span class="s1">&#39;After&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Weight (kg)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Before/After Comparison&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Individual changes</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">before</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">after</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">before</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">after</span><span class="o">.</span><span class="n">mean</span><span class="p">()],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Before&#39;</span><span class="p">,</span> <span class="s1">&#39;After&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Weight (kg)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Individual Changes&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Difference distribution</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;No change&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Difference (After - Before)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Difference Distribution&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span>

<span class="n">before</span><span class="p">,</span> <span class="n">after</span> <span class="o">=</span> <span class="n">wilcoxon_signed_rank_example</span><span class="p">()</span>
</code></pre></div>

<h3 id="32-one-sample-test-median-test">3.2 One-sample Test (Median Test)<a class="header-link" href="#32-one-sample-test-median-test" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># One-sample: Test if median equals a specific value</span>
<span class="k">def</span><span class="w"> </span><span class="nf">one_sample_wilcoxon</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">hypothesized_median</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    One-sample Wilcoxon test</span>
<span class="sd">    H0: median = hypothesized_median</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diff_from_median</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">hypothesized_median</span>

    <span class="c1"># Exclude zero values</span>
    <span class="n">diff_from_median</span> <span class="o">=</span> <span class="n">diff_from_median</span><span class="p">[</span><span class="n">diff_from_median</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff_from_median</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All values equal the hypothesized median.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">diff_from_median</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== One-sample Wilcoxon Test ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;H0: median = </span><span class="si">{</span><span class="n">hypothesized_median</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample median: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;W statistic: </span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conclusion: Median is significantly different from </span><span class="si">{</span><span class="n">hypothesized_median</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conclusion: Insufficient evidence that median differs from </span><span class="si">{</span><span class="n">hypothesized_median</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Example</span>
<span class="n">sample_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
<span class="n">one_sample_wilcoxon</span><span class="p">(</span><span class="n">sample_data</span><span class="p">,</span> <span class="n">hypothesized_median</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="4-kruskal-wallis-h-test">4. Kruskal-Wallis H Test<a class="header-link" href="#4-kruskal-wallis-h-test" title="Permanent link">&para;</a></h2>
<h3 id="41-concept">4.1 Concept<a class="header-link" href="#41-concept" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Compare distributions of 3 or more independent groups (nonparametric alternative to one-way ANOVA)</p>
<p><strong>Hypotheses</strong>:
- H‚ÇÄ: All groups have identical distributions
- H‚ÇÅ: At least one group differs</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">kruskal_wallis_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Kruskal-Wallis H test example&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Scenario: Compare effects of 3 teaching methods</span>
    <span class="n">method_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="mi">60</span>  <span class="c1"># Traditional</span>
    <span class="n">method_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="mi">65</span>  <span class="c1"># Online</span>
    <span class="n">method_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="mi">70</span>  <span class="c1"># Blended</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Kruskal-Wallis H Test ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Method A: n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">method_a</span><span class="p">)</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">method_a</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method B: n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">method_b</span><span class="p">)</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">method_b</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method C: n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">method_c</span><span class="p">)</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">method_c</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Normality tests</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Normality tests:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">method_a</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">method_b</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">method_c</span><span class="p">)]:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: p=</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Kruskal-Wallis test</span>
    <span class="n">H_stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kruskal</span><span class="p">(</span><span class="n">method_a</span><span class="p">,</span> <span class="n">method_b</span><span class="p">,</span> <span class="n">method_c</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Kruskal-Wallis test:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  H statistic: </span><span class="si">{</span><span class="n">H_stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Effect size: eta-squared</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">method_a</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">method_b</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">method_c</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">eta_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">H_stat</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Effect size (Œ∑¬≤): </span><span class="si">{</span><span class="n">eta_sq</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  0.01: Small effect&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  0.06: Medium effect&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  0.14: Large effect&quot;</span><span class="p">)</span>

    <span class="c1"># Comparison with one-way ANOVA</span>
    <span class="n">F_stat</span><span class="p">,</span> <span class="n">anova_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">f_oneway</span><span class="p">(</span><span class="n">method_a</span><span class="p">,</span> <span class="n">method_b</span><span class="p">,</span> <span class="n">method_c</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">One-way ANOVA (for comparison):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  F statistic: </span><span class="si">{</span><span class="n">F_stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  p-value: </span><span class="si">{</span><span class="n">anova_p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Visualization</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Boxplot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">method_a</span><span class="p">,</span> <span class="n">method_b</span><span class="p">,</span> <span class="n">method_c</span><span class="p">],</span>
               <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Method A&#39;</span><span class="p">,</span> <span class="s1">&#39;Method B&#39;</span><span class="p">,</span> <span class="s1">&#39;Method C&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Score&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Score Distribution by Teaching Method&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Violin plot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">violinplot</span><span class="p">([</span><span class="n">method_a</span><span class="p">,</span> <span class="n">method_b</span><span class="p">,</span> <span class="n">method_c</span><span class="p">],</span> <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                           <span class="n">showmeans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showmedians</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Method A&#39;</span><span class="p">,</span> <span class="s1">&#39;Method B&#39;</span><span class="p">,</span> <span class="s1">&#39;Method C&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Score&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Violin Plot&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">method_a</span><span class="p">,</span> <span class="n">method_b</span><span class="p">,</span> <span class="n">method_c</span>

<span class="n">method_a</span><span class="p">,</span> <span class="n">method_b</span><span class="p">,</span> <span class="n">method_c</span> <span class="o">=</span> <span class="n">kruskal_wallis_example</span><span class="p">()</span>
</code></pre></div>

<h3 id="42-post-hoc-tests">4.2 Post-hoc Tests<a class="header-link" href="#42-post-hoc-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">mannwhitneyu</span>

<span class="k">def</span><span class="w"> </span><span class="nf">dunn_test_alternative</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">group_names</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Alternative to Dunn test: Bonferroni-corrected Mann-Whitney U tests</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_comparisons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">adjusted_alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">n_comparisons</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Post-hoc Tests (Bonferroni correction) ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of comparisons: </span><span class="si">{</span><span class="n">n_comparisons</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adjusted Œ±: </span><span class="si">{</span><span class="n">adjusted_alpha</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">groups</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span><span class="p">)</span>
        <span class="n">significant</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">adjusted_alpha</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;U&#39;</span><span class="p">:</span> <span class="n">stat</span><span class="p">,</span>
            <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span>
            <span class="s1">&#39;significant&#39;</span><span class="p">:</span> <span class="n">significant</span>
        <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2">: U=</span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;*&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">significant</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">method_a</span><span class="p">,</span> <span class="n">method_b</span><span class="p">,</span> <span class="n">method_c</span><span class="p">]</span>
<span class="n">group_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
<span class="n">posthoc_results</span> <span class="o">=</span> <span class="n">dunn_test_alternative</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">group_names</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="5-friedman-test">5. Friedman Test<a class="header-link" href="#5-friedman-test" title="Permanent link">&para;</a></h2>
<h3 id="51-concept">5.1 Concept<a class="header-link" href="#51-concept" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Compare 3 or more conditions in repeated measures or blocked designs</p>
<p><strong>Use case</strong>: Same subjects measured under multiple conditions</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">friedman_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Friedman test example&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Scenario: Same students&#39; scores on 3 exams</span>
    <span class="n">n_students</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="c1"># Generate correlated data (multiple exams for same students)</span>
    <span class="n">ability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_students</span><span class="p">)</span>  <span class="c1"># Baseline ability</span>
    <span class="n">exam1</span> <span class="o">=</span> <span class="n">ability</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n_students</span><span class="p">)</span>
    <span class="n">exam2</span> <span class="o">=</span> <span class="n">ability</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n_students</span><span class="p">)</span>  <span class="c1"># Slightly harder</span>
    <span class="n">exam3</span> <span class="o">=</span> <span class="n">ability</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">n_students</span><span class="p">)</span>  <span class="c1"># Harder</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Friedman Test ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Number of students: </span><span class="si">{</span><span class="n">n_students</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exam 1: median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">exam1</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exam 2: median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">exam2</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exam 3: median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">exam3</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Friedman test</span>
    <span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">friedmanchisquare</span><span class="p">(</span><span class="n">exam1</span><span class="p">,</span> <span class="n">exam2</span><span class="p">,</span> <span class="n">exam3</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Friedman test:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  œá¬≤ statistic: </span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Effect size: Kendall&#39;s W</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Number of conditions</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">stat</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_students</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Effect size (Kendall&#39;s W): </span><span class="si">{</span><span class="n">W</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  W &lt; 0.3: Weak agreement&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  0.3 &lt;= W &lt; 0.5: Moderate agreement&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  W &gt;= 0.5: Strong agreement&quot;</span><span class="p">)</span>

    <span class="c1"># Visualization</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Boxplot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">exam1</span><span class="p">,</span> <span class="n">exam2</span><span class="p">,</span> <span class="n">exam3</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Exam 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Exam 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Exam 3&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Score&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Score Distribution by Exam&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Individual profiles</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_students</span><span class="p">)):</span>  <span class="c1"># First 10 students only</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="n">exam1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">exam2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">exam3</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="n">exam1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">exam2</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">exam3</span><span class="o">.</span><span class="n">mean</span><span class="p">()],</span>
            <span class="s1">&#39;rs-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Exam 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Exam 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Exam 3&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Score&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Individual Profiles&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">exam1</span><span class="p">,</span> <span class="n">exam2</span><span class="p">,</span> <span class="n">exam3</span>

<span class="n">exam1</span><span class="p">,</span> <span class="n">exam2</span><span class="p">,</span> <span class="n">exam3</span> <span class="o">=</span> <span class="n">friedman_example</span><span class="p">()</span>
</code></pre></div>

<h3 id="52-nemenyi-post-hoc-test">5.2 Nemenyi Post-hoc Test<a class="header-link" href="#52-nemenyi-post-hoc-test" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">nemenyi_posthoc</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">group_names</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Nemenyi post-hoc test (after Friedman)</span>
<span class="sd">    Bonferroni-corrected Wilcoxon signed-rank tests</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_comparisons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">adjusted_alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">n_comparisons</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Nemenyi Post-hoc Test ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of comparisons: </span><span class="si">{</span><span class="n">n_comparisons</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adjusted Œ±: </span><span class="si">{</span><span class="n">adjusted_alpha</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">groups</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">significant</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">adjusted_alpha</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;comparison&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> vs </span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="n">stat</span><span class="p">,</span>
            <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span>
            <span class="s1">&#39;significant&#39;</span><span class="p">:</span> <span class="n">significant</span>
        <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2">: W=</span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;*&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">significant</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">exam1</span><span class="p">,</span> <span class="n">exam2</span><span class="p">,</span> <span class="n">exam3</span><span class="p">]</span>
<span class="n">group_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Exam1&#39;</span><span class="p">,</span> <span class="s1">&#39;Exam2&#39;</span><span class="p">,</span> <span class="s1">&#39;Exam3&#39;</span><span class="p">]</span>
<span class="n">nemenyi_results</span> <span class="o">=</span> <span class="n">nemenyi_posthoc</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">group_names</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6-nonparametric-correlation-spearman-kendall">6. Nonparametric Correlation (Spearman, Kendall)<a class="header-link" href="#6-nonparametric-correlation-spearman-kendall" title="Permanent link">&para;</a></h2>
<h3 id="61-spearman-rank-correlation">6.1 Spearman Rank Correlation<a class="header-link" href="#61-spearman-rank-correlation" title="Permanent link">&para;</a></h3>
<p><strong>Characteristics</strong>: Rank-based, measures monotonic relationships (need not be linear)</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">spearman_correlation_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Spearman correlation example&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Nonlinear relationship data</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Log relationship + noise</span>

    <span class="c1"># Pearson correlation</span>
    <span class="n">pearson_r</span><span class="p">,</span> <span class="n">pearson_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Spearman correlation</span>
    <span class="n">spearman_r</span><span class="p">,</span> <span class="n">spearman_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Correlation Analysis ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pearson correlation: r=</span><span class="si">{</span><span class="n">pearson_r</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">pearson_p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spearman correlation: œÅ=</span><span class="si">{</span><span class="n">spearman_r</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">spearman_p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Spearman is more appropriate for nonlinear relationships&quot;</span><span class="p">)</span>

    <span class="c1"># Visualization</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># Original data</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original Data</span><span class="se">\n</span><span class="s1">Pearson r=</span><span class="si">{</span><span class="n">pearson_r</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, Spearman œÅ=</span><span class="si">{</span><span class="n">spearman_r</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Rank transformation</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x_ranks</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_ranks</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_ranks</span><span class="p">,</span> <span class="n">y_ranks</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X Rank&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y Rank&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;After Rank Transformation&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># With outlier</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x_outlier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">])</span>  <span class="c1"># Extreme outlier</span>
    <span class="n">y_outlier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()])</span>

    <span class="n">pearson_out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x_outlier</span><span class="p">,</span> <span class="n">y_outlier</span><span class="p">)</span>
    <span class="n">spearman_out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">x_outlier</span><span class="p">,</span> <span class="n">y_outlier</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_outlier</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_outlier</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normal data&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_outlier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_outlier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Outlier&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;With Outlier</span><span class="se">\n</span><span class="s1">Pearson=</span><span class="si">{</span><span class="n">pearson_out</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, Spearman=</span><span class="si">{</span><span class="n">spearman_out</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">spearman_correlation_example</span><span class="p">()</span>
</code></pre></div>

<h3 id="62-kendall-rank-correlation">6.2 Kendall Rank Correlation<a class="header-link" href="#62-kendall-rank-correlation" title="Permanent link">&para;</a></h3>
<p><strong>Characteristics</strong>: Based on pairwise comparisons, more robust than Spearman</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">kendall_correlation_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Kendall tau correlation example&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Ordinal data (Likert scale, etc.)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">rater1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># 1-5 points</span>
    <span class="c1"># Somewhat consistent but not identical</span>
    <span class="n">rater2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rater1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Pearson (inappropriate)</span>
    <span class="n">pearson_r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">rater1</span><span class="p">,</span> <span class="n">rater2</span><span class="p">)</span>

    <span class="c1"># Spearman</span>
    <span class="n">spearman_r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">rater1</span><span class="p">,</span> <span class="n">rater2</span><span class="p">)</span>

    <span class="c1"># Kendall</span>
    <span class="n">kendall_tau</span><span class="p">,</span> <span class="n">kendall_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kendalltau</span><span class="p">(</span><span class="n">rater1</span><span class="p">,</span> <span class="n">rater2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Ordinal Data Correlation Analysis ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rater 1 distribution: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">rater1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rater 2 distribution: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">rater2</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pearson r: </span><span class="si">{</span><span class="n">pearson_r</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (inappropriate for ordinal data)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spearman œÅ: </span><span class="si">{</span><span class="n">spearman_r</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kendall œÑ: </span><span class="si">{</span><span class="n">kendall_tau</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">kendall_p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Interpretation:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  œÑ = 0: Equal concordant/discordant pairs&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  œÑ = 1: Perfect rank agreement&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  œÑ = -1: Perfect rank disagreement&quot;</span><span class="p">)</span>

    <span class="c1"># Visualization</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># Add jitter (to prevent overlapping same scores)</span>
    <span class="n">jitter1</span> <span class="o">=</span> <span class="n">rater1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">jitter2</span> <span class="o">=</span> <span class="n">rater2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">jitter1</span><span class="p">,</span> <span class="n">jitter2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Perfect agreement line&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Rater 1&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rater 2&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inter-rater Agreement</span><span class="se">\n</span><span class="s1">Kendall œÑ = </span><span class="si">{</span><span class="n">kendall_tau</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">rater1</span><span class="p">,</span> <span class="n">rater2</span>

<span class="n">rater1</span><span class="p">,</span> <span class="n">rater2</span> <span class="o">=</span> <span class="n">kendall_correlation_example</span><span class="p">()</span>
</code></pre></div>

<h3 id="63-correlation-coefficient-comparison">6.3 Correlation Coefficient Comparison<a class="header-link" href="#63-correlation-coefficient-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_correlations</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare three correlation coefficients&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    =================================================</span>
<span class="s2">    Correlation Coefficient Comparison</span>
<span class="s2">    =================================================</span>

<span class="s2">    | Characteristic | Pearson | Spearman | Kendall |</span>
<span class="s2">    |----------------|---------|----------|---------|</span>
<span class="s2">    | Relationship | Linear | Monotonic | Monotonic |</span>
<span class="s2">    | Data type | Continuous | Ordinal/Continuous | Ordinal |</span>
<span class="s2">    | Outliers | Sensitive | Robust | Very robust |</span>
<span class="s2">    | Ties handling | N/A | Average rank | Correctable |</span>
<span class="s2">    | Computation | O(n) | O(n log n) | O(n¬≤) |</span>
<span class="s2">    | Range | [-1, 1] | [-1, 1] | [-1, 1] |</span>

<span class="s2">    Selection criteria:</span>
<span class="s2">    - Continuous &amp; linear relationship ‚Üí Pearson</span>
<span class="s2">    - Non-normal/outliers/nonlinear ‚Üí Spearman</span>
<span class="s2">    - Ordinal/ranked data ‚Üí Kendall</span>
<span class="s2">    - Small sample size ‚Üí Kendall</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">compare_correlations</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="7-practice-examples">7. Practice Examples<a class="header-link" href="#7-practice-examples" title="Permanent link">&para;</a></h2>
<h3 id="71-comprehensive-nonparametric-analysis">7.1 Comprehensive Nonparametric Analysis<a class="header-link" href="#71-comprehensive-nonparametric-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">comprehensive_nonparametric_analysis</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform comprehensive nonparametric analysis</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    data_dict : dict</span>
<span class="sd">        Format: {group_name: data}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Comprehensive Nonparametric Analysis&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">group_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

    <span class="c1"># 1. Descriptive statistics</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[1] Descriptive Statistics&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">, median=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;IQR=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">75</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Normality tests</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[2] Normality Tests (Shapiro-Wilk)&quot;</span><span class="p">)</span>
    <span class="n">all_normal</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">is_normal</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">alpha</span>
        <span class="n">all_normal</span> <span class="o">=</span> <span class="n">all_normal</span> <span class="ow">and</span> <span class="n">is_normal</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: p=</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;(normal)&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_normal</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;(non-normal)&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Select and perform appropriate test</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[3] Group Comparison Test (number of groups: </span><span class="si">{</span><span class="n">n_groups</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_groups</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Two groups: Mann-Whitney U</span>
        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mann-Whitney U: U=</span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;Mann-Whitney U&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Three or more groups: Kruskal-Wallis</span>
        <span class="n">stat</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kruskal</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Kruskal-Wallis H: H=</span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;Kruskal-Wallis&quot;</span>

        <span class="c1"># Post-hoc if significant</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Post-hoc tests (Bonferroni correction):&quot;</span><span class="p">)</span>
            <span class="n">n_comp</span> <span class="o">=</span> <span class="n">n_groups</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_groups</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">adj_alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">n_comp</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_groups</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">ph_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">groups</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">sig</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span> <span class="k">if</span> <span class="n">ph_p</span> <span class="o">&lt;</span> <span class="n">adj_alpha</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">group_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2">: p=</span><span class="si">{</span><span class="n">ph_p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 4. Visualization</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Boxplot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">group_names</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_name</span><span class="si">}</span><span class="s1"> Test</span><span class="se">\n</span><span class="s1">p = </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Histogram</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution Comparison&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Usage example</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Control&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s1">&#39;Treatment A&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="mi">55</span><span class="p">,</span>
    <span class="s1">&#39;Treatment B&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="mi">60</span>
<span class="p">}</span>
<span class="n">comprehensive_nonparametric_analysis</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="8-practice-problems">8. Practice Problems<a class="header-link" href="#8-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-test-selection">Problem 1: Test Selection<a class="header-link" href="#problem-1-test-selection" title="Permanent link">&para;</a></h3>
<p>Select an appropriate nonparametric test for each situation:
1. Comparing test scores between male and female students (skewed score distribution)
2. Comparing waiting times at 3 hospitals
3. Comparing pain scores before and after treatment for the same patients</p>
<h3 id="problem-2-mann-whitney-u">Problem 2: Mann-Whitney U<a class="header-link" href="#problem-2-mann-whitney-u" title="Permanent link">&para;</a></h3>
<p>Given data for two groups:
- Group A: [23, 28, 31, 35, 39, 42]
- Group B: [18, 22, 25, 29, 33]</p>
<p>Calculate the U statistic manually and compare with scipy results.</p>
<h3 id="problem-3-correlation-analysis">Problem 3: Correlation Analysis<a class="header-link" href="#problem-3-correlation-analysis" title="Permanent link">&para;</a></h3>
<p>For 10 pairs of ranked data:
1. Calculate Spearman correlation coefficient
2. Calculate Kendall tau
3. Interpret the difference between the two coefficients</p>
<h3 id="problem-4-kruskal-wallis-post-hoc">Problem 4: Kruskal-Wallis Post-hoc<a class="header-link" href="#problem-4-kruskal-wallis-post-hoc" title="Permanent link">&para;</a></h3>
<p>When Kruskal-Wallis is significant in comparing 4 groups:
1. Number of post-hoc comparisons needed
2. Bonferroni-corrected significance level
3. Determine which pairs differ significantly</p>
<hr />
<h2 id="9-key-summary">9. Key Summary<a class="header-link" href="#9-key-summary" title="Permanent link">&para;</a></h2>
<h3 id="test-selection-flowchart">Test Selection Flowchart<a class="header-link" href="#test-selection-flowchart" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Check</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="k">type</span>
<span class="w">    </span><span class="err">‚îÇ</span>
<span class="w">    </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">Normality</span><span class="w"> </span><span class="nx">satisfied</span><span class="p">?</span><span class="w"> </span><span class="err">‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">Yes</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Parametric</span><span class="w"> </span><span class="nx">test</span>
<span class="w">    </span><span class="err">‚îÇ</span><span class="w">                           </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Nonparametric</span><span class="w"> </span><span class="nx">test</span>
<span class="w">    </span><span class="err">‚îÇ</span>
<span class="nx">Nonparametric</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">selection</span><span class="p">:</span>
<span class="w">    </span><span class="err">‚îÇ</span>
<span class="w">    </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nx">independent</span><span class="w"> </span><span class="nx">groups</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Mann</span><span class="o">-</span><span class="nx">Whitney</span><span class="w"> </span><span class="nx">U</span>
<span class="w">    </span><span class="err">‚îÇ</span>
<span class="w">    </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nx">paired</span><span class="w"> </span><span class="nx">groups</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Wilcoxon</span><span class="w"> </span><span class="nx">signed</span><span class="o">-</span><span class="nx">rank</span>
<span class="w">    </span><span class="err">‚îÇ</span>
<span class="w">    </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="mi">3</span><span class="o">+</span><span class="w"> </span><span class="nx">independent</span><span class="w"> </span><span class="nx">groups</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Kruskal</span><span class="o">-</span><span class="nx">Wallis</span><span class="w"> </span><span class="nx">H</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Post</span><span class="o">-</span><span class="nx">hoc</span><span class="p">:</span><span class="w"> </span><span class="nx">Dunn</span>
<span class="w">    </span><span class="err">‚îÇ</span>
<span class="w">    </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="mi">3</span><span class="o">+</span><span class="w"> </span><span class="nx">paired</span><span class="w"> </span><span class="nx">groups</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Friedman</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Post</span><span class="o">-</span><span class="nx">hoc</span><span class="p">:</span><span class="w"> </span><span class="nx">Nemenyi</span>
<span class="w">    </span><span class="err">‚îÇ</span>
<span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nx">Correlation</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="nx">Spearman</span><span class="w"> </span><span class="p">(</span><span class="nx">continuous</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">Kendall</span><span class="w"> </span><span class="p">(</span><span class="nx">ordinal</span><span class="p">)</span>
</code></pre></div>

<h3 id="scipystats-functions">scipy.stats Functions<a class="header-link" href="#scipystats-functions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Test</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mann-Whitney U</td>
<td><code>mannwhitneyu(x, y)</code></td>
</tr>
<tr>
<td>Wilcoxon</td>
<td><code>wilcoxon(x, y)</code></td>
</tr>
<tr>
<td>Kruskal-Wallis</td>
<td><code>kruskal(g1, g2, g3, ...)</code></td>
</tr>
<tr>
<td>Friedman</td>
<td><code>friedmanchisquare(g1, g2, g3, ...)</code></td>
</tr>
<tr>
<td>Spearman</td>
<td><code>spearmanr(x, y)</code></td>
</tr>
<tr>
<td>Kendall</td>
<td><code>kendalltau(x, y)</code></td>
</tr>
</tbody>
</table>
<h3 id="effect-size-interpretation">Effect Size Interpretation<a class="header-link" href="#effect-size-interpretation" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Test</th>
<th>Effect Size</th>
<th>Small</th>
<th>Medium</th>
<th>Large</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mann-Whitney</td>
<td>rank-biserial r</td>
<td>0.1</td>
<td>0.3</td>
<td>0.5</td>
</tr>
<tr>
<td>Kruskal-Wallis</td>
<td>Œ∑¬≤</td>
<td>0.01</td>
<td>0.06</td>
<td>0.14</td>
</tr>
<tr>
<td>Friedman</td>
<td>Kendall's W</td>
<td>0.1</td>
<td>0.3</td>
<td>0.5</td>
</tr>
</tbody>
</table>
<h3 id="next-chapter-preview">Next Chapter Preview<a class="header-link" href="#next-chapter-preview" title="Permanent link">&para;</a></h3>
<p>In Chapter 14, <strong>Experimental Design</strong>, we'll cover:
- Basic principles of experimental design
- A/B testing
- Sample size determination (power analysis)
- Sequential testing</p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Data_Science/22_Multivariate_Analysis.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">22. Multivariate Analysis</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Data_Science/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Data_Science/24_Experimental_Design.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">24. Experimental Design</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}