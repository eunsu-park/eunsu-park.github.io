{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 07: Advanced Normalization - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Database_Theory/">Database Theory</a>
    <span class="separator">/</span>
    <span class="current">Lesson 07: Advanced Normalization</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Lesson 07: Advanced Normalization</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/06_Normalization.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Lesson 06: Normalization (1NF through BCNF)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/08_Query_Processing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Lesson 08: Query Processing</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#1-introduction">1. Introduction</a><ul>
<li><a href="#11-the-hierarchy-of-normal-forms">1.1 The Hierarchy of Normal Forms</a></li>
</ul>
</li>
<li><a href="#2-multivalued-dependencies-mvds">2. Multivalued Dependencies (MVDs)</a><ul>
<li><a href="#21-motivation">2.1 Motivation</a></li>
<li><a href="#22-definition">2.2 Definition</a></li>
<li><a href="#23-intuitive-understanding">2.3 Intuitive Understanding</a></li>
<li><a href="#24-properties-of-mvds">2.4 Properties of MVDs</a></li>
<li><a href="#25-trivial-mvds">2.5 Trivial MVDs</a></li>
</ul>
</li>
<li><a href="#3-fourth-normal-form-4nf">3. Fourth Normal Form (4NF)</a><ul>
<li><a href="#31-definition">3.1 Definition</a></li>
<li><a href="#32-relationship-to-bcnf">3.2 Relationship to BCNF</a></li>
<li><a href="#33-4nf-decomposition-algorithm">3.3 4NF Decomposition Algorithm</a></li>
<li><a href="#34-worked-example">3.4 Worked Example</a></li>
<li><a href="#35-a-more-complex-example">3.5 A More Complex Example</a></li>
</ul>
</li>
<li><a href="#4-fifth-normal-form-5nf-pjnf">4. Fifth Normal Form (5NF / PJNF)</a><ul>
<li><a href="#41-join-dependencies">4.1 Join Dependencies</a></li>
<li><a href="#42-mvds-as-special-case-of-jds">4.2 MVDs as Special Case of JDs</a></li>
<li><a href="#43-definition-of-5nf">4.3 Definition of 5NF</a></li>
<li><a href="#44-example-need-for-5nf">4.4 Example: Need for 5NF</a></li>
<li><a href="#45-detecting-join-dependencies">4.5 Detecting Join Dependencies</a></li>
</ul>
</li>
<li><a href="#5-domain-key-normal-form-dknf">5. Domain-Key Normal Form (DKNF)</a><ul>
<li><a href="#51-definition">5.1 Definition</a></li>
<li><a href="#52-significance">5.2 Significance</a></li>
<li><a href="#53-example">5.3 Example</a></li>
<li><a href="#54-when-dknf-fails">5.4 When DKNF Fails</a></li>
<li><a href="#55-practical-relevance">5.5 Practical Relevance</a></li>
</ul>
</li>
<li><a href="#6-summary-of-all-normal-forms">6. Summary of All Normal Forms</a></li>
<li><a href="#7-denormalization">7. Denormalization</a><ul>
<li><a href="#71-when-to-denormalize">7.1 When to Denormalize</a></li>
<li><a href="#72-denormalization-techniques">7.2 Denormalization Techniques</a><ul>
<li><a href="#technique-1-prejoined-tables">Technique 1: Prejoined Tables</a></li>
<li><a href="#technique-2-derivedcomputed-columns">Technique 2: Derived/Computed Columns</a></li>
<li><a href="#technique-3-redundant-columns">Technique 3: Redundant Columns</a></li>
<li><a href="#technique-4-summaryaggregate-tables">Technique 4: Summary/Aggregate Tables</a></li>
<li><a href="#technique-5-materialized-views">Technique 5: Materialized Views</a></li>
</ul>
</li>
<li><a href="#73-managing-denormalized-data">7.3 Managing Denormalized Data</a></li>
<li><a href="#74-the-normalization-denormalization-spectrum">7.4 The Normalization-Denormalization Spectrum</a></li>
<li><a href="#75-decision-framework">7.5 Decision Framework</a></li>
</ul>
</li>
<li><a href="#8-star-schema-and-snowflake-schema">8. Star Schema and Snowflake Schema</a><ul>
<li><a href="#81-star-schema">8.1 Star Schema</a></li>
<li><a href="#82-snowflake-schema">8.2 Snowflake Schema</a></li>
<li><a href="#83-star-vs-snowflake">8.3 Star vs Snowflake</a></li>
<li><a href="#84-fact-table-types">8.4 Fact Table Types</a></li>
<li><a href="#85-slowly-changing-dimensions-scd">8.5 Slowly Changing Dimensions (SCD)</a></li>
</ul>
</li>
<li><a href="#9-practical-normalization-guidelines">9. Practical Normalization Guidelines</a><ul>
<li><a href="#91-rules-of-thumb">9.1 Rules of Thumb</a></li>
<li><a href="#92-common-patterns">9.2 Common Patterns</a></li>
<li><a href="#93-anti-patterns-to-avoid">9.3 Anti-Patterns to Avoid</a></li>
</ul>
</li>
<li><a href="#10-exercises">10. Exercises</a><ul>
<li><a href="#exercise-1-identifying-mvds">Exercise 1: Identifying MVDs</a></li>
<li><a href="#exercise-2-mvd-vs-fd">Exercise 2: MVD vs FD</a></li>
<li><a href="#exercise-3-star-schema-design">Exercise 3: Star Schema Design</a></li>
<li><a href="#exercise-4-4nf-decomposition">Exercise 4: 4NF Decomposition</a></li>
<li><a href="#exercise-5-denormalization-decision">Exercise 5: Denormalization Decision</a></li>
<li><a href="#exercise-6-join-dependency">Exercise 6: Join Dependency</a></li>
</ul>
</li>
<li><a href="#11-summary">11. Summary</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="lesson-07-advanced-normalization">Lesson 07: Advanced Normalization<a class="header-link" href="#lesson-07-advanced-normalization" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./06_Normalization.md">06_Normalization.md</a> | <strong>Next</strong>: <a href="./08_Query_Processing.md">08_Query_Processing.md</a></p>
<hr />
<blockquote>
<p><strong>Topic</strong>: Database Theory
<strong>Lesson</strong>: 7 of 16
<strong>Prerequisites</strong>: Functional dependencies (Lesson 05), normalization through BCNF (Lesson 06)
<strong>Objective</strong>: Understand multivalued dependencies and 4NF, join dependencies and 5NF, the theoretical ideal of DKNF, and practical denormalization strategies for real-world systems</p>
</blockquote>
<h2 id="1-introduction">1. Introduction<a class="header-link" href="#1-introduction" title="Permanent link">&para;</a></h2>
<p>In Lesson 06, we saw how functional dependencies drive normalization through BCNF. However, BCNF does not eliminate <strong>all</strong> forms of redundancy. There are situations where a relation in BCNF still contains redundant data caused by different kinds of constraints: <strong>multivalued dependencies</strong> and <strong>join dependencies</strong>.</p>
<p>This lesson covers the higher normal forms (4NF, 5NF, DKNF) that address these issues, and then pivots to the practical reality that sometimes <strong>less normalization is better</strong> ‚Äî the art of denormalization.</p>
<h3 id="11-the-hierarchy-of-normal-forms">1.1 The Hierarchy of Normal Forms<a class="header-link" href="#11-the-hierarchy-of-normal-forms" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>DKNF  (Domain-Key Normal Form ‚Äî theoretical ideal)
  ‚Üë
5NF / PJNF  (Project-Join Normal Form)
  ‚Üë
4NF  (Fourth Normal Form)
  ‚Üë
BCNF  (Boyce-Codd Normal Form)
  ‚Üë
3NF  (Third Normal Form)
  ‚Üë
2NF  (Second Normal Form)
  ‚Üë
1NF  (First Normal Form)
</code></pre></div>

<p>Each level eliminates an additional class of redundancy. In practice, BCNF is sufficient for most applications. 4NF is occasionally needed. 5NF and DKNF are primarily of theoretical interest.</p>
<hr />
<h2 id="2-multivalued-dependencies-mvds">2. Multivalued Dependencies (MVDs)<a class="header-link" href="#2-multivalued-dependencies-mvds" title="Permanent link">&para;</a></h2>
<h3 id="21-motivation">2.1 Motivation<a class="header-link" href="#21-motivation" title="Permanent link">&para;</a></h3>
<p>Consider a relation that tracks employees, their skills, and their assigned projects:</p>
<div class="highlight"><pre><span></span><code>EmpSkillProject(emp_id, skill, project)
</code></pre></div>

<p>Suppose:
- An employee's skills are <strong>independent</strong> of their project assignments
- Employee E1 has skills {Java, Python} and works on projects {Alpha, Beta}</p>
<p>To correctly represent this, we need <strong>all combinations</strong>:</p>
<div class="highlight"><pre><span></span><code>| emp_id | skill  | project |
|--------|--------|---------|
| E1     | Java   | Alpha   |
| E1     | Java   | Beta    |
| E1     | Python | Alpha   |
| E1     | Python | Beta    |
</code></pre></div>

<p>If we forget one row (e.g., E1/Python/Beta), the data incorrectly implies that E1's Python skill is not associated with the Beta project. This "all combinations" requirement is the hallmark of a <strong>multivalued dependency</strong>.</p>
<p>Note: This relation is in BCNF (the only candidate key is the entire set {emp_id, skill, project}, and there are no non-trivial FDs). Yet it has obvious redundancy ‚Äî each skill is listed once per project, and vice versa.</p>
<h3 id="22-definition">2.2 Definition<a class="header-link" href="#22-definition" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Definition</strong>: A <strong>multivalued dependency (MVD)</strong> X ‚Üí‚Üí Y holds on relation R if, for every pair of tuples t‚ÇÅ and t‚ÇÇ in R with t‚ÇÅ[X] = t‚ÇÇ[X], there exist tuples t‚ÇÉ and t‚ÇÑ in R such that:</p>
<ul>
<li>t‚ÇÉ[X] = t‚ÇÑ[X] = t‚ÇÅ[X] = t‚ÇÇ[X]</li>
<li>t‚ÇÉ[Y] = t‚ÇÅ[Y] and t‚ÇÉ[Z] = t‚ÇÇ[Z]</li>
<li>t‚ÇÑ[Y] = t‚ÇÇ[Y] and t‚ÇÑ[Z] = t‚ÇÅ[Z]</li>
</ul>
<p>where Z = R - X - Y (all remaining attributes).</p>
</blockquote>
<p>In simpler terms: if we fix X, the set of Y-values is independent of the set of Z-values. Every combination must appear.</p>
<h3 id="23-intuitive-understanding">2.3 Intuitive Understanding<a class="header-link" href="#23-intuitive-understanding" title="Permanent link">&para;</a></h3>
<p>X ‚Üí‚Üí Y means:</p>
<blockquote>
<p>"For a given value of X, the set of values Y takes is <strong>independent</strong> of the values that the remaining attributes (R - X - Y) take."</p>
</blockquote>
<p>In our example:
- emp_id ‚Üí‚Üí skill (for a given employee, skills are independent of projects)
- emp_id ‚Üí‚Üí project (for a given employee, projects are independent of skills)</p>
<h3 id="24-properties-of-mvds">2.4 Properties of MVDs<a class="header-link" href="#24-properties-of-mvds" title="Permanent link">&para;</a></h3>
<p><strong>Complementation rule</strong>: If X ‚Üí‚Üí Y, then X ‚Üí‚Üí Z where Z = R - X - Y.</p>
<p>This follows directly from the definition. In our example, emp_id ‚Üí‚Üí skill implies emp_id ‚Üí‚Üí project.</p>
<p><strong>Every FD is an MVD</strong>: If X ‚Üí Y, then X ‚Üí‚Üí Y. (But not vice versa.)</p>
<p>Proof: If X ‚Üí Y and t‚ÇÅ[X] = t‚ÇÇ[X], then t‚ÇÅ[Y] = t‚ÇÇ[Y]. The "swap" tuples t‚ÇÉ and t‚ÇÑ are just t‚ÇÅ and t‚ÇÇ themselves.</p>
<p><strong>MVD inference rules</strong> (analogous to Armstrong's axioms):</p>
<table>
<thead>
<tr>
<th>Rule</th>
<th>Statement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Complementation</td>
<td>X ‚Üí‚Üí Y ‚üπ X ‚Üí‚Üí (R - X - Y)</td>
</tr>
<tr>
<td>Augmentation</td>
<td>X ‚Üí‚Üí Y and W ‚äá Z ‚üπ XW ‚Üí‚Üí YZ</td>
</tr>
<tr>
<td>Transitivity</td>
<td>X ‚Üí‚Üí Y and Y ‚Üí‚Üí Z ‚üπ X ‚Üí‚Üí (Z - Y)</td>
</tr>
<tr>
<td>Replication</td>
<td>X ‚Üí Y ‚üπ X ‚Üí‚Üí Y</td>
</tr>
<tr>
<td>Coalescence</td>
<td>X ‚Üí‚Üí Y, Z ‚äÜ Y, W ‚à© Y = ‚àÖ, W ‚Üí Z ‚üπ X ‚Üí Z</td>
</tr>
</tbody>
</table>
<h3 id="25-trivial-mvds">2.5 Trivial MVDs<a class="header-link" href="#25-trivial-mvds" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Definition</strong>: An MVD X ‚Üí‚Üí Y is <strong>trivial</strong> if:
- Y ‚äÜ X, or
- X ‚à™ Y = R (all attributes of the relation)</p>
</blockquote>
<p>Trivial MVDs always hold and do not cause redundancy.</p>
<hr />
<h2 id="3-fourth-normal-form-4nf">3. Fourth Normal Form (4NF)<a class="header-link" href="#3-fourth-normal-form-4nf" title="Permanent link">&para;</a></h2>
<h3 id="31-definition">3.1 Definition<a class="header-link" href="#31-definition" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Definition</strong>: A relation schema R is in <strong>Fourth Normal Form (4NF)</strong> if, for every non-trivial multivalued dependency X ‚Üí‚Üí Y that holds on R:</p>
<p>X is a superkey of R.</p>
</blockquote>
<p>4NF is strictly stronger than BCNF. It eliminates redundancy caused by multivalued dependencies.</p>
<h3 id="32-relationship-to-bcnf">3.2 Relationship to BCNF<a class="header-link" href="#32-relationship-to-bcnf" title="Permanent link">&para;</a></h3>
<p>Since every FD is an MVD, if every non-trivial MVD has a superkey determinant, then every non-trivial FD also has a superkey determinant. Therefore:</p>
<div class="highlight"><pre><span></span><code><span class="mf">4</span><span class="n">NF</span><span class="w"> </span><span class="err">‚äÇ</span><span class="w"> </span><span class="n">BCNF</span><span class="w"> </span><span class="err">‚äÇ</span><span class="w"> </span><span class="mf">3</span><span class="n">NF</span><span class="w"> </span><span class="err">‚äÇ</span><span class="w"> </span><span class="mf">2</span><span class="n">NF</span><span class="w"> </span><span class="err">‚äÇ</span><span class="w"> </span><span class="mf">1</span><span class="n">NF</span>
</code></pre></div>

<p>A relation in 4NF is always in BCNF, but a relation in BCNF may not be in 4NF (as our EmpSkillProject example showed).</p>
<h3 id="33-4nf-decomposition-algorithm">3.3 4NF Decomposition Algorithm<a class="header-link" href="#33-4nf-decomposition-algorithm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">ALGORITHM</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span><span class="n">NF_Decomposition</span><span class="o">(</span><span class="n">R</span><span class="o">,</span><span class="w"> </span><span class="n">D</span><span class="o">)</span>
<span class="n">INPUT</span><span class="o">:</span><span class="w">  </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">relation</span><span class="w"> </span><span class="n">schema</span>
<span class="w">        </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">FDs</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">MVDs</span>
<span class="n">OUTPUT</span><span class="o">:</span><span class="w"> </span><span class="n">Decomposition</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="mi">4</span><span class="n">NF</span><span class="w"> </span><span class="n">relations</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">lossless</span><span class="w"> </span><span class="n">join</span>

<span class="n">result</span><span class="w"> </span><span class="err">‚Üê</span><span class="w"> </span><span class="o">{</span><span class="n">R</span><span class="o">}</span>

<span class="n">WHILE</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">exists</span><span class="w"> </span><span class="n">R·µ¢</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">4</span><span class="n">NF</span><span class="w"> </span><span class="n">DO</span>
<span class="w">    </span><span class="n">Find</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">trivial</span><span class="w"> </span><span class="n">MVD</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="err">‚Üí‚Üí</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">violates</span><span class="w"> </span><span class="mi">4</span><span class="n">NF</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">R·µ¢</span>
<span class="w">    </span><span class="o">(</span><span class="n">i</span><span class="o">.</span><span class="na">e</span><span class="o">.,</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">superkey</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">R·µ¢</span><span class="o">)</span>

<span class="w">    </span><span class="n">Replace</span><span class="w"> </span><span class="n">R·µ¢</span><span class="w"> </span><span class="k">with</span><span class="o">:</span>
<span class="w">        </span><span class="n">R‚ÇÅ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="err">‚à™</span><span class="w"> </span><span class="n">Y</span>
<span class="w">        </span><span class="n">R‚ÇÇ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R·µ¢</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Y</span><span class="w">    </span><span class="o">(</span><span class="n">equivalently</span><span class="o">,</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="err">‚à™</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R·µ¢</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Y</span><span class="o">)</span>
<span class="n">END</span><span class="w"> </span><span class="n">WHILE</span>

<span class="n">RETURN</span><span class="w"> </span><span class="n">result</span>
</code></pre></div>

<p>This is analogous to the BCNF decomposition algorithm but uses MVDs instead of FDs.</p>
<h3 id="34-worked-example">3.4 Worked Example<a class="header-link" href="#34-worked-example" title="Permanent link">&para;</a></h3>
<p><strong>EmpSkillProject(emp_id, skill, project)</strong></p>
<p>MVDs:
- emp_id ‚Üí‚Üí skill
- emp_id ‚Üí‚Üí project</p>
<p>Key: {emp_id, skill, project} (the whole relation, since no FDs exist)</p>
<p>Check 4NF: emp_id ‚Üí‚Üí skill is non-trivial, and {emp_id} is not a superkey. <strong>Violation!</strong></p>
<p>Decompose on emp_id ‚Üí‚Üí skill:
- R‚ÇÅ = {emp_id, skill}
- R‚ÇÇ = {emp_id, project}</p>
<p>Check R‚ÇÅ(emp_id, skill):
- Key: {emp_id, skill}
- Only trivial MVDs. 4NF ‚úì</p>
<p>Check R‚ÇÇ(emp_id, project):
- Key: {emp_id, project}
- Only trivial MVDs. 4NF ‚úì</p>
<p><strong>Final 4NF decomposition:</strong></p>
<div class="highlight"><pre><span></span><code>EmpSkill(emp_id, skill)       ‚Äî key: {emp_id, skill}
EmpProject(emp_id, project)   ‚Äî key: {emp_id, project}
</code></pre></div>

<h3 id="35-a-more-complex-example">3.5 A More Complex Example<a class="header-link" href="#35-a-more-complex-example" title="Permanent link">&para;</a></h3>
<p>Consider:</p>
<div class="highlight"><pre><span></span><code>CourseBook(course, teacher, book)
</code></pre></div>

<p>Suppose:
- Each course can be taught by multiple teachers
- Each course uses multiple books
- The books used for a course are the same regardless of who teaches it</p>
<p>MVDs: course ‚Üí‚Üí teacher, course ‚Üí‚Üí book</p>
<p>But suppose there's also: teacher ‚Üí book (each teacher uses a specific book, which may differ by teacher). This is an FD, not an MVD. In this case, the MVD course ‚Üí‚Üí book may NOT hold, and the analysis changes.</p>
<p>This illustrates why identifying MVDs requires careful analysis of the real-world semantics.</p>
<hr />
<h2 id="4-fifth-normal-form-5nf-pjnf">4. Fifth Normal Form (5NF / PJNF)<a class="header-link" href="#4-fifth-normal-form-5nf-pjnf" title="Permanent link">&para;</a></h2>
<h3 id="41-join-dependencies">4.1 Join Dependencies<a class="header-link" href="#41-join-dependencies" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Definition</strong>: A <strong>join dependency (JD)</strong> ‚ãà{R‚ÇÅ, R‚ÇÇ, ..., R‚Çô} holds on relation R if:</p>
<p>R = œÄ_{R‚ÇÅ}(R) ‚ãà œÄ_{R‚ÇÇ}(R) ‚ãà ... ‚ãà œÄ_{R‚Çô}(R)</p>
<p>for every legal instance of R.</p>
</blockquote>
<p>A join dependency says that R can always be losslessly decomposed into R‚ÇÅ, R‚ÇÇ, ..., R‚Çô.</p>
<h3 id="42-mvds-as-special-case-of-jds">4.2 MVDs as Special Case of JDs<a class="header-link" href="#42-mvds-as-special-case-of-jds" title="Permanent link">&para;</a></h3>
<p>Every MVD X ‚Üí‚Üí Y on R is equivalent to the join dependency ‚ãà{XY, XZ} where Z = R - X - Y.</p>
<p>So MVDs are binary join dependencies (decomposition into exactly two components). General join dependencies may require decomposition into three or more components.</p>
<h3 id="43-definition-of-5nf">4.3 Definition of 5NF<a class="header-link" href="#43-definition-of-5nf" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Definition</strong>: A relation schema R is in <strong>Fifth Normal Form (5NF)</strong>, also called <strong>Project-Join Normal Form (PJNF)</strong>, if for every non-trivial join dependency ‚ãà{R‚ÇÅ, R‚ÇÇ, ..., R‚Çô} that holds on R:</p>
<p>Every R·µ¢ is a superkey of R.</p>
</blockquote>
<p>5NF is the strongest normal form defined in terms of join dependencies. It eliminates all redundancy that can be detected through projection and join.</p>
<h3 id="44-example-need-for-5nf">4.4 Example: Need for 5NF<a class="header-link" href="#44-example-need-for-5nf" title="Permanent link">&para;</a></h3>
<p>Consider a relation about suppliers, parts, and projects:</p>
<div class="highlight"><pre><span></span><code>SPJ(supplier, part, project)
</code></pre></div>

<p>Suppose the following constraint holds: "If supplier S supplies part P, and part P is used in project J, and supplier S supplies some part to project J, then supplier S supplies part P to project J."</p>
<p>This is a <strong>cyclic join dependency</strong>:</p>
<p>‚ãà{(supplier, part), (part, project), (supplier, project)}</p>
<p>This means SPJ = œÄ_{supplier,part}(SPJ) ‚ãà œÄ_{part,project}(SPJ) ‚ãà œÄ_{supplier,project}(SPJ)</p>
<p>This JD is not implied by any MVD (it requires a three-way decomposition). If this JD holds and the entire attribute set is the only key:
- The relation may be in 4NF (no non-trivial MVDs)
- But NOT in 5NF (non-trivial JD whose components are not superkeys)</p>
<p><strong>Decomposition:</strong></p>
<div class="highlight"><pre><span></span><code>SP(supplier, part)         ‚Äî which suppliers supply which parts
PJ(part, project)          ‚Äî which parts are used in which projects
SJ(supplier, project)      ‚Äî which suppliers supply to which projects
</code></pre></div>

<h3 id="45-detecting-join-dependencies">4.5 Detecting Join Dependencies<a class="header-link" href="#45-detecting-join-dependencies" title="Permanent link">&para;</a></h3>
<p>Join dependencies are very difficult to detect in practice because:</p>
<ol>
<li>They are subtle ‚Äî the cyclic constraint in the SPJ example is not obvious</li>
<li>There is no simple test analogous to computing attribute closure</li>
<li>They must be identified from domain knowledge, not data inspection</li>
</ol>
<p>This is why 5NF is primarily of theoretical interest.</p>
<hr />
<h2 id="5-domain-key-normal-form-dknf">5. Domain-Key Normal Form (DKNF)<a class="header-link" href="#5-domain-key-normal-form-dknf" title="Permanent link">&para;</a></h2>
<h3 id="51-definition">5.1 Definition<a class="header-link" href="#51-definition" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>Definition (Fagin, 1981)</strong>: A relation schema R is in <strong>Domain-Key Normal Form (DKNF)</strong> if every constraint on R is a logical consequence of the domain constraints and key constraints of R.</p>
<ul>
<li><strong>Domain constraint</strong>: A restriction on the allowed values of an attribute (e.g., age &gt; 0, status ‚àà {'active', 'inactive'})</li>
<li><strong>Key constraint</strong>: A uniqueness constraint on a set of attributes</li>
</ul>
</blockquote>
<h3 id="52-significance">5.2 Significance<a class="header-link" href="#52-significance" title="Permanent link">&para;</a></h3>
<p>DKNF is the "ultimate" normal form. If a relation is in DKNF, it has <strong>no</strong> redundancy that can be characterized by any known type of dependency (FD, MVD, JD, or otherwise).</p>
<p>However, DKNF has a significant limitation:</p>
<blockquote>
<p><strong>There is no general algorithm to transform a relation into DKNF.</strong></p>
</blockquote>
<p>This makes DKNF a theoretical ideal ‚Äî it tells us what perfect normalization looks like, but doesn't tell us how to get there in all cases.</p>
<h3 id="53-example">5.3 Example<a class="header-link" href="#53-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Employee(emp_id, emp_name, dept, salary)
</code></pre></div>

<p>Domain constraints:
- emp_id: positive integer
- salary: positive decimal
- dept ‚àà {'Engineering', 'Marketing', 'Sales', 'HR'}</p>
<p>Key constraint: emp_id is the primary key.</p>
<p>If the only constraint is that emp_id uniquely determines all other attributes, and the domain constraints are as above, then this relation is in DKNF ‚Äî every constraint follows from the key and domain constraints alone.</p>
<h3 id="54-when-dknf-fails">5.4 When DKNF Fails<a class="header-link" href="#54-when-dknf-fails" title="Permanent link">&para;</a></h3>
<p>A relation is NOT in DKNF if there is a constraint that cannot be expressed as a domain or key constraint. For example:</p>
<div class="highlight"><pre><span></span><code>Employee(emp_id, emp_name, dept, dept_budget)
</code></pre></div>

<p>Constraint: dept ‚Üí dept_budget (all employees in the same department see the same budget).</p>
<p>This is an FD that is NOT a key constraint (dept is not a key). So this relation is not in DKNF. The solution: decompose into Employee(emp_id, emp_name, dept) and Department(dept, dept_budget), where dept is a key in the Department table.</p>
<h3 id="55-practical-relevance">5.5 Practical Relevance<a class="header-link" href="#55-practical-relevance" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Normal Form</th>
<th>Practical Use</th>
</tr>
</thead>
<tbody>
<tr>
<td>1NF - BCNF</td>
<td>Very common. Every database designer should know these.</td>
</tr>
<tr>
<td>4NF</td>
<td>Occasionally needed. Independent many-to-many relationships.</td>
</tr>
<tr>
<td>5NF</td>
<td>Rare. Cyclic constraints in specific domains.</td>
</tr>
<tr>
<td>DKNF</td>
<td>Theoretical. No practical algorithm exists.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6-summary-of-all-normal-forms">6. Summary of All Normal Forms<a class="header-link" href="#6-summary-of-all-normal-forms" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>NF</th>
<th>Condition</th>
<th>Eliminates</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1NF</strong></td>
<td>Atomic values</td>
<td>Non-relational structures</td>
</tr>
<tr>
<td><strong>2NF</strong></td>
<td>No partial FDs</td>
<td>Partial key dependencies</td>
</tr>
<tr>
<td><strong>3NF</strong></td>
<td>No transitive FDs (with prime attribute exception)</td>
<td>Transitive dependencies</td>
</tr>
<tr>
<td><strong>BCNF</strong></td>
<td>Every FD determinant is a superkey</td>
<td>All FD-based redundancy</td>
</tr>
<tr>
<td><strong>4NF</strong></td>
<td>Every non-trivial MVD determinant is a superkey</td>
<td>MVD-based redundancy</td>
</tr>
<tr>
<td><strong>5NF</strong></td>
<td>Every non-trivial JD component is a superkey</td>
<td>JD-based redundancy</td>
</tr>
<tr>
<td><strong>DKNF</strong></td>
<td>All constraints follow from domains + keys</td>
<td>All possible redundancy</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="7-denormalization">7. Denormalization<a class="header-link" href="#7-denormalization" title="Permanent link">&para;</a></h2>
<h3 id="71-when-to-denormalize">7.1 When to Denormalize<a class="header-link" href="#71-when-to-denormalize" title="Permanent link">&para;</a></h3>
<p>Normalization optimizes for <strong>data integrity</strong> and <strong>storage efficiency</strong>. But real-world systems also need <strong>read performance</strong>. Denormalization is the deliberate introduction of redundancy to improve query performance.</p>
<p>Common reasons to denormalize:</p>
<ol>
<li><strong>Expensive joins</strong>: Frequently executed queries that join many tables</li>
<li><strong>Aggregation performance</strong>: Pre-computed counts, sums, averages</li>
<li><strong>Read-heavy workloads</strong>: Systems where reads vastly outnumber writes (e.g., 100:1 ratio)</li>
<li><strong>Reporting and analytics</strong>: Complex analytical queries over historical data</li>
<li><strong>Latency requirements</strong>: Sub-millisecond response times</li>
</ol>
<h3 id="72-denormalization-techniques">7.2 Denormalization Techniques<a class="header-link" href="#72-denormalization-techniques" title="Permanent link">&para;</a></h3>
<h4 id="technique-1-prejoined-tables">Technique 1: Prejoined Tables<a class="header-link" href="#technique-1-prejoined-tables" title="Permanent link">&para;</a></h4>
<p>Store data from multiple normalized tables in a single table:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Normalized: requires join</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">email</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span>

<span class="c1">-- Denormalized: no join needed</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="n">customer_email</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">orders_denormalized</span><span class="p">;</span>
</code></pre></div>

<p><strong>Trade-off</strong>: Faster reads, but customer_name and customer_email are duplicated across all orders.</p>
<h4 id="technique-2-derivedcomputed-columns">Technique 2: Derived/Computed Columns<a class="header-link" href="#technique-2-derivedcomputed-columns" title="Permanent link">&para;</a></h4>
<p>Store pre-calculated values:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Instead of computing total each time:</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">order_items</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">order_id</span><span class="p">;</span>

<span class="c1">-- Store the total directly:</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">total_amount</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">-- Update on each item change:</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">total_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">price</span><span class="p">)</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">order_items</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">order_items</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">order_id</span>
<span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="p">;</span>
</code></pre></div>

<h4 id="technique-3-redundant-columns">Technique 3: Redundant Columns<a class="header-link" href="#technique-3-redundant-columns" title="Permanent link">&para;</a></h4>
<p>Add frequently accessed foreign-table columns to avoid joins:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Normalized</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">order_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">customers</span><span class="p">(</span><span class="n">customer_id</span><span class="p">),</span>
<span class="w">    </span><span class="n">order_date</span><span class="w"> </span><span class="nb">DATE</span>
<span class="p">);</span>

<span class="c1">-- Denormalized: add customer_name for display purposes</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">order_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">customers</span><span class="p">(</span><span class="n">customer_id</span><span class="p">),</span>
<span class="w">    </span><span class="n">customer_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w">  </span><span class="c1">-- redundant, but avoids join</span>
<span class="w">    </span><span class="n">order_date</span><span class="w"> </span><span class="nb">DATE</span>
<span class="p">);</span>
</code></pre></div>

<h4 id="technique-4-summaryaggregate-tables">Technique 4: Summary/Aggregate Tables<a class="header-link" href="#technique-4-summaryaggregate-tables" title="Permanent link">&para;</a></h4>
<p>Create separate tables for pre-computed aggregates:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">daily_sales_summary</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">sale_date</span><span class="w">   </span><span class="nb">DATE</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_orders</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_revenue</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
<span class="w">    </span><span class="n">avg_order_value</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- Populated by a nightly batch job or trigger</span>
</code></pre></div>

<h4 id="technique-5-materialized-views">Technique 5: Materialized Views<a class="header-link" href="#technique-5-materialized-views" title="Permanent link">&para;</a></h4>
<p>Some databases support materialized views ‚Äî precomputed query results stored as tables:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- PostgreSQL</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">product_sales_summary</span><span class="w"> </span><span class="k">AS</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">product_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">,</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">times_ordered</span><span class="p">,</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_quantity</span><span class="p">,</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">oi</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_revenue</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="n">p</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">order_items</span><span class="w"> </span><span class="n">oi</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oi</span><span class="p">.</span><span class="n">product_id</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">category</span><span class="p">;</span>

<span class="c1">-- Refresh periodically</span>
<span class="n">REFRESH</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">product_sales_summary</span><span class="p">;</span>
</code></pre></div>

<h3 id="73-managing-denormalized-data">7.3 Managing Denormalized Data<a class="header-link" href="#73-managing-denormalized-data" title="Permanent link">&para;</a></h3>
<p>Denormalization introduces the very anomalies that normalization was designed to prevent. Strategies to manage this:</p>
<p><strong>1. Application-level enforcement</strong></p>
<p>The application ensures consistency when writing:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_customer_name</span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
    <span class="c1"># Update the normalized source</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE customers SET name = ? WHERE id = ?&quot;</span><span class="p">,</span>
               <span class="n">new_name</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">)</span>

    <span class="c1"># Update all denormalized copies</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE orders SET customer_name = ? WHERE customer_id = ?&quot;</span><span class="p">,</span>
               <span class="n">new_name</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>

<p><strong>2. Database triggers</strong></p>
<p>Let the database maintain consistency automatically:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">sync_customer_name</span><span class="p">()</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">$$</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="k">OLD</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">THEN</span>
<span class="w">        </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">orders</span>
<span class="w">        </span><span class="k">SET</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="n">name</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="k">NEW</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="err">$$</span><span class="w"> </span><span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">trg_customer_name_sync</span>
<span class="k">AFTER</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">customers</span>
<span class="k">FOR</span><span class="w"> </span><span class="k">EACH</span><span class="w"> </span><span class="k">ROW</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">sync_customer_name</span><span class="p">();</span>
</code></pre></div>

<p><strong>3. Eventual consistency</strong></p>
<p>Accept that denormalized data may be temporarily stale:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Use a last_synced timestamp to track freshness</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders_denormalized</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">last_synced</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">;</span>

<span class="c1">-- Background job refreshes periodically</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">orders_denormalized</span><span class="w"> </span><span class="n">od</span>
<span class="k">SET</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">last_synced</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">od</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">customer_id</span>
<span class="k">AND</span><span class="w"> </span><span class="n">od</span><span class="p">.</span><span class="n">customer_name</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div>

<h3 id="74-the-normalization-denormalization-spectrum">7.4 The Normalization-Denormalization Spectrum<a class="header-link" href="#74-the-normalization-denormalization-spectrum" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Fully</span><span class="w"> </span><span class="nx">Normalized</span><span class="w"> </span><span class="p">(</span><span class="nx">BCNF</span><span class="o">/</span><span class="mi">4</span><span class="nx">NF</span><span class="p">)</span><span class="w">                    </span><span class="nx">Fully</span><span class="w"> </span><span class="nx">Denormalized</span>
<span class="err">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</span>
<span class="err">‚îÇ</span><span class="w">                                                      </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚úì</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">redundancy</span><span class="w">          </span><span class="err">‚úó</span><span class="w"> </span><span class="nx">Maximum</span><span class="w"> </span><span class="nx">redundancy</span><span class="w">       </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚úì</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">anomalies</span><span class="w">           </span><span class="err">‚úó</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">anomalies</span><span class="w"> </span><span class="nx">possible</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚úó</span><span class="w"> </span><span class="nx">Many</span><span class="w"> </span><span class="nx">joins</span><span class="w"> </span><span class="nx">needed</span><span class="w">       </span><span class="err">‚úì</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">joins</span><span class="w"> </span><span class="nx">needed</span><span class="w">          </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚úó</span><span class="w"> </span><span class="nx">Complex</span><span class="w"> </span><span class="nx">queries</span><span class="w">         </span><span class="err">‚úì</span><span class="w"> </span><span class="nx">Simple</span><span class="w"> </span><span class="nx">queries</span><span class="w">           </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚úì</span><span class="w"> </span><span class="nx">Write</span><span class="o">-</span><span class="nx">optimized</span><span class="w">         </span><span class="err">‚úì</span><span class="w"> </span><span class="nx">Read</span><span class="o">-</span><span class="nx">optimized</span><span class="w">           </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">                                                      </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w">         </span><span class="nx">OLTP</span><span class="w"> </span><span class="nx">systems</span><span class="w"> </span><span class="err">‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí</span><span class="w"> </span><span class="nx">OLAP</span><span class="o">/</span><span class="nx">Analytics</span><span class="w">         </span><span class="err">‚îÇ</span>
</code></pre></div>

<h3 id="75-decision-framework">7.5 Decision Framework<a class="header-link" href="#75-decision-framework" title="Permanent link">&para;</a></h3>
<p>Ask these questions before denormalizing:</p>
<ol>
<li><strong>Is the join truly a bottleneck?</strong> Profile first. Often, proper indexing eliminates the need for denormalization.</li>
<li><strong>What is the read:write ratio?</strong> Denormalization helps most when reads dominate (&gt;10:1).</li>
<li><strong>How critical is consistency?</strong> Financial systems demand perfect consistency; recommendation engines can tolerate staleness.</li>
<li><strong>Can materialized views suffice?</strong> They provide denormalization benefits without modifying the base schema.</li>
<li><strong>Is the team prepared to maintain it?</strong> Denormalized schemas require discipline ‚Äî every write path must update all copies.</li>
</ol>
<hr />
<h2 id="8-star-schema-and-snowflake-schema">8. Star Schema and Snowflake Schema<a class="header-link" href="#8-star-schema-and-snowflake-schema" title="Permanent link">&para;</a></h2>
<p>Data warehousing uses specific denormalized patterns optimized for analytical queries.</p>
<h3 id="81-star-schema">8.1 Star Schema<a class="header-link" href="#81-star-schema" title="Permanent link">&para;</a></h3>
<p>The star schema is the simplest data warehouse pattern. It consists of:
- One <strong>fact table</strong> at the center (measurements/events)
- Multiple <strong>dimension tables</strong> radiating outward (descriptive attributes)</p>
<div class="highlight"><pre><span></span><code><span class="w">                    </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w">   </span><span class="n">dim_date</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">date_key</span><span class="w"> </span><span class="p">(</span><span class="n">PK</span><span class="p">)</span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">full_date</span><span class="w">    </span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">year</span><span class="w">         </span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">quarter</span><span class="w">      </span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">month</span><span class="w">        </span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">day_of_week</span><span class="w">  </span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                           </span><span class="err">‚îÇ</span>
<span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">    </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><span class="w">    </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">dim_product</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">  </span><span class="n">fact_sales</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">dim_customer</span><span class="w"> </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ</span><span class="w">    </span><span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ</span><span class="w">    </span><span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">product_key</span><span class="w">  </span><span class="err">‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ</span><span class="w"> </span><span class="n">product_key</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">customer_key</span><span class="w"> </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">product_name</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">customer_key</span><span class="w"> </span><span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ</span><span class="w"> </span><span class="n">cust_name</span><span class="w">    </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">category</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">date_key</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">city</span><span class="w">         </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">subcategory</span><span class="w">  </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">store_key</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">state</span><span class="w">        </span><span class="err">‚îÇ</span>
<span class="err">‚îÇ</span><span class="w"> </span><span class="n">brand</span><span class="w">        </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">segment</span><span class="w">      </span><span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">quantity</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">unit_price</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">total_amount</span><span class="w"> </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="w">                    </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">discount</span><span class="w">     </span><span class="err">‚îÇ</span><span class="w">    </span><span class="err">‚îÇ</span><span class="w">  </span><span class="n">dim_store</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="w">                    </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><span class="w">    </span><span class="err">‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ</span>
<span class="w">                           </span><span class="err">‚îÇ</span><span class="w">            </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">store_key</span><span class="w">    </span><span class="err">‚îÇ</span>
<span class="w">                           </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ</span><span class="w"> </span><span class="n">store_name</span><span class="w">   </span><span class="err">‚îÇ</span>
<span class="w">                                        </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">city</span><span class="w">         </span><span class="err">‚îÇ</span>
<span class="w">                                        </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">state</span><span class="w">        </span><span class="err">‚îÇ</span>
<span class="w">                                        </span><span class="err">‚îÇ</span><span class="w"> </span><span class="n">region</span><span class="w">       </span><span class="err">‚îÇ</span>
<span class="w">                                        </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
</code></pre></div>

<p><strong>Key characteristics:</strong>
- Fact table has foreign keys to all dimension tables
- Dimension tables are <strong>denormalized</strong> (e.g., dim_product has category AND subcategory in one flat table)
- Queries typically filter on dimensions and aggregate facts</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Typical star schema query: total sales by product category and quarter</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">d</span><span class="p">.</span><span class="n">category</span><span class="p">,</span>
<span class="w">    </span><span class="n">dd</span><span class="p">.</span><span class="k">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">dd</span><span class="p">.</span><span class="n">quarter</span><span class="p">,</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">total_amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_sales</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">fact_sales</span><span class="w"> </span><span class="n">f</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">dim_product</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">product_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">product_key</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">dim_date</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">date_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="n">date_key</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="k">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2025</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="n">quarter</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="n">quarter</span><span class="p">,</span><span class="w"> </span><span class="n">total_sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>

<h3 id="82-snowflake-schema">8.2 Snowflake Schema<a class="header-link" href="#82-snowflake-schema" title="Permanent link">&para;</a></h3>
<p>The snowflake schema normalizes dimension tables into sub-dimensions:</p>
<div class="highlight"><pre><span></span><code>                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                         ‚îÇ  dim_brand   ‚îÇ
                         ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
                         ‚îÇ brand_key    ‚îÇ
                         ‚îÇ brand_name   ‚îÇ
                         ‚îÇ manufacturer ‚îÇ
                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇdim_subcategory‚îÇ   ‚îÇ dim_product  ‚îÇ    ‚îÇ  fact_sales  ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ subcat_key   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ product_key  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ product_key  ‚îÇ
‚îÇ subcat_name  ‚îÇ    ‚îÇ product_name ‚îÇ    ‚îÇ customer_key ‚îÇ
‚îÇ category_key ‚îÇ    ‚îÇ subcat_key   ‚îÇ    ‚îÇ date_key     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ brand_key    ‚îÇ    ‚îÇ quantity     ‚îÇ
       ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ total_amount ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇdim_category  ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ category_key ‚îÇ
‚îÇ category_name‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre></div>

<p><strong>Key characteristics:</strong>
- Dimension tables are <strong>normalized</strong> (3NF or BCNF)
- Reduces storage for large dimension tables
- Requires more joins for queries</p>
<h3 id="83-star-vs-snowflake">8.3 Star vs Snowflake<a class="header-link" href="#83-star-vs-snowflake" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Star Schema</th>
<th>Snowflake Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Dimension structure</strong></td>
<td>Flat (denormalized)</td>
<td>Normalized (2NF-BCNF)</td>
</tr>
<tr>
<td><strong>Query complexity</strong></td>
<td>Simpler (fewer joins)</td>
<td>More complex (more joins)</td>
</tr>
<tr>
<td><strong>Query performance</strong></td>
<td>Faster (fewer joins)</td>
<td>Slower (more joins)</td>
</tr>
<tr>
<td><strong>Storage</strong></td>
<td>More (redundancy in dimensions)</td>
<td>Less (no redundancy)</td>
</tr>
<tr>
<td><strong>ETL complexity</strong></td>
<td>Simpler</td>
<td>More complex</td>
</tr>
<tr>
<td><strong>Maintenance</strong></td>
<td>Updates touch more rows</td>
<td>Updates are isolated</td>
</tr>
<tr>
<td><strong>Industry preference</strong></td>
<td>Most common</td>
<td>Used when dimensions are very large</td>
</tr>
</tbody>
</table>
<h3 id="84-fact-table-types">8.4 Fact Table Types<a class="header-link" href="#84-fact-table-types" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Transaction</strong></td>
<td>One row per event</td>
<td>Each sale, click, login</td>
</tr>
<tr>
<td><strong>Periodic snapshot</strong></td>
<td>Regular intervals</td>
<td>Daily account balance, monthly inventory</td>
</tr>
<tr>
<td><strong>Accumulating snapshot</strong></td>
<td>Lifecycle tracking</td>
<td>Order: placed ‚Üí shipped ‚Üí delivered dates</td>
</tr>
<tr>
<td><strong>Factless fact</strong></td>
<td>Events with no measures</td>
<td>Student attendance (just keys)</td>
</tr>
</tbody>
</table>
<h3 id="85-slowly-changing-dimensions-scd">8.5 Slowly Changing Dimensions (SCD)<a class="header-link" href="#85-slowly-changing-dimensions-scd" title="Permanent link">&para;</a></h3>
<p>When dimension attributes change over time:</p>
<p><strong>Type 1: Overwrite</strong> ‚Äî Simply update the value. Loses history.</p>
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">dim_customer</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;New York&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">customer_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</code></pre></div>

<p><strong>Type 2: Add new row</strong> ‚Äî Create a new dimension row with effective dates.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Before: customer lived in Boston</span>
<span class="o">|</span><span class="w"> </span><span class="n">customer_key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cust_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">valid_from</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">valid_to</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="c1">-------------|---------|---------|------------|------------|---------|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">42</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">C100</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Boston</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9999</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Y</span><span class="w">       </span><span class="o">|</span>

<span class="c1">-- After: customer moved to New York</span>
<span class="o">|</span><span class="w"> </span><span class="n">customer_key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cust_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">valid_from</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">valid_to</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="c1">-------------|---------|----------|------------|------------|---------|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">42</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">C100</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Boston</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">N</span><span class="w">       </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">99</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">C100</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">York</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9999</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Y</span><span class="w">       </span><span class="o">|</span>
</code></pre></div>

<p><strong>Type 3: Add new column</strong> ‚Äî Track the previous value.</p>
<div class="highlight"><pre><span></span><code><span class="o">|</span><span class="w"> </span><span class="n">customer_key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">prev_city</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">city_change_date</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="c1">-------------|----------|-----------|-----------------|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">42</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">York</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Boston</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="w">      </span><span class="o">|</span>
</code></pre></div>

<hr />
<h2 id="9-practical-normalization-guidelines">9. Practical Normalization Guidelines<a class="header-link" href="#9-practical-normalization-guidelines" title="Permanent link">&para;</a></h2>
<h3 id="91-rules-of-thumb">9.1 Rules of Thumb<a class="header-link" href="#91-rules-of-thumb" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Start normalized, denormalize when proven necessary</strong>. Premature denormalization is a common mistake.</p>
</li>
<li>
<p><strong>OLTP systems</strong>: Normalize to at least 3NF, preferably BCNF. Write-heavy workloads demand consistency.</p>
</li>
<li>
<p><strong>OLAP/Analytics</strong>: Use star or snowflake schemas. Read-heavy analytical workloads benefit from fewer joins.</p>
</li>
<li>
<p><strong>Microservices</strong>: Each service owns its data. Normalize within a service; accept redundancy across services.</p>
</li>
<li>
<p><strong>NoSQL databases</strong>: Document stores (MongoDB) often use embedded/denormalized structures. Graph databases have their own modeling patterns. The relational normalization theory applies primarily to relational databases.</p>
</li>
</ol>
<h3 id="92-common-patterns">9.2 Common Patterns<a class="header-link" href="#92-common-patterns" title="Permanent link">&para;</a></h3>
<p><strong>Pattern 1: Lookup tables</strong> ‚Äî Small, rarely changing reference data.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Always normalize: countries, currencies, status codes</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">country_code</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">country_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>Pattern 2: Audit/history tables</strong> ‚Äî Denormalize intentionally.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Store a snapshot of the data at the time of the event</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">order_audit</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">audit_id</span><span class="w">       </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">order_id</span><span class="w">       </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">customer_name</span><span class="w">  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w">  </span><span class="c1">-- snapshot, not FK</span>
<span class="w">    </span><span class="n">product_name</span><span class="w">   </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w">  </span><span class="c1">-- snapshot, not FK</span>
<span class="w">    </span><span class="n">total_amount</span><span class="w">   </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
<span class="w">    </span><span class="n">recorded_at</span><span class="w">    </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>Pattern 3: Cache tables</strong> ‚Äî Pre-computed for performance.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Normalized source: compute from orders + order_items</span>
<span class="c1">-- Cache: updated by triggers or batch jobs</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">customer_stats</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">customer_id</span><span class="w">     </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">customers</span><span class="p">(</span><span class="n">customer_id</span><span class="p">),</span>
<span class="w">    </span><span class="n">total_orders</span><span class="w">    </span><span class="nb">INT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_spent</span><span class="w">     </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">last_order_date</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w">      </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>
</code></pre></div>

<h3 id="93-anti-patterns-to-avoid">9.3 Anti-Patterns to Avoid<a class="header-link" href="#93-anti-patterns-to-avoid" title="Permanent link">&para;</a></h3>
<p><strong>1. Entity-Attribute-Value (EAV)</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- AVOID: pseudo-flexible but terrible for queries and integrity</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">entity_id</span><span class="w">   </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">attr_name</span><span class="w">   </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">attr_value</span><span class="w">  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<p>Problems: no type safety, no referential integrity, horrific query performance.</p>
<p><strong>2. Over-normalization</strong></p>
<p>Splitting a table like <code>Address(street, city, state, zip)</code> into <code>Address(street, zip_id)</code> + <code>ZipCode(zip_id, city, state)</code> is technically correct (zip ‚Üí city, state) but rarely beneficial ‚Äî zip code data changes extremely rarely.</p>
<p><strong>3. One True Lookup Table (OTLT)</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- AVOID: putting all reference data in one table</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">lookup</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">lookup_type</span><span class="w">  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="n">lookup_code</span><span class="w">  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="n">lookup_value</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<p>Problems: no foreign key integrity, no type-specific validation, confusing semantics.</p>
<hr />
<h2 id="10-exercises">10. Exercises<a class="header-link" href="#10-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-identifying-mvds">Exercise 1: Identifying MVDs<a class="header-link" href="#exercise-1-identifying-mvds" title="Permanent link">&para;</a></h3>
<p>Given R(student, course, hobby), where a student's courses are independent of their hobbies:</p>
<ol>
<li>What MVDs hold?</li>
<li>What is the highest normal form?</li>
<li>Decompose into 4NF.</li>
</ol>
<details>
<summary>Solution</summary>

1. **MVDs**: student ‚Üí‚Üí course and student ‚Üí‚Üí hobby (by complementation)

2. **Highest NF**: The only key is {student, course, hobby}. No non-trivial FDs exist, so BCNF holds. But the MVD student ‚Üí‚Üí course has determinant {student} which is not a superkey. **BCNF but not 4NF.**

3. **4NF decomposition**:
   - R‚ÇÅ(student, course) ‚Äî key: {student, course}
   - R‚ÇÇ(student, hobby) ‚Äî key: {student, hobby}

   Both are in 4NF (only trivial MVDs remain). ‚úì
</details>

<h3 id="exercise-2-mvd-vs-fd">Exercise 2: MVD vs FD<a class="header-link" href="#exercise-2-mvd-vs-fd" title="Permanent link">&para;</a></h3>
<p>Given R(A, B, C) with the constraint: for each value of A, the set of B-values is fixed regardless of C-values.</p>
<ol>
<li>Is this an FD or an MVD?</li>
<li>Does A ‚Üí B hold?</li>
<li>Does A ‚Üí‚Üí B hold?</li>
</ol>
<details>
<summary>Solution</summary>

1. This is an **MVD**. The constraint says the B-values and C-values are independent given A.

2. **A ‚Üí B does NOT necessarily hold.** An FD A ‚Üí B would mean each A-value is associated with exactly one B-value. The constraint says A is associated with a **set** of B-values, which may have more than one element.

3. **A ‚Üí‚Üí B holds.** This is exactly the definition of a multivalued dependency: for a given A, the set of B-values is independent of C-values.

Example:

<div class="highlight"><pre><span></span><code>| A  | B  | C  |
|----|----|----|
| a1 | b1 | c1 |
| a1 | b1 | c2 |
| a1 | b2 | c1 |
| a1 | b2 | c2 |
</code></pre></div>


A ‚Üí‚Üí B holds (every A-B combo appears with every C). A ‚Üí B does not hold (a1 maps to both b1 and b2).
</details>

<h3 id="exercise-3-star-schema-design">Exercise 3: Star Schema Design<a class="header-link" href="#exercise-3-star-schema-design" title="Permanent link">&para;</a></h3>
<p>Design a star schema for a library lending system. The fact is a "book checkout event." Identify:
1. The fact table and its measures
2. At least 3 dimension tables
3. Sample SQL query using the schema</p>
<details>
<summary>Solution</summary>

**Fact table: fact_checkout**

<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">fact_checkout</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">checkout_key</span><span class="w">    </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">date_key</span><span class="w">        </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">dim_date</span><span class="p">(</span><span class="n">date_key</span><span class="p">),</span>
<span class="w">    </span><span class="n">book_key</span><span class="w">        </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">dim_book</span><span class="p">(</span><span class="n">book_key</span><span class="p">),</span>
<span class="w">    </span><span class="n">patron_key</span><span class="w">      </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">dim_patron</span><span class="p">(</span><span class="n">patron_key</span><span class="p">),</span>
<span class="w">    </span><span class="n">branch_key</span><span class="w">      </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">dim_branch</span><span class="p">(</span><span class="n">branch_key</span><span class="p">),</span>
<span class="w">    </span><span class="c1">-- Measures</span>
<span class="w">    </span><span class="n">days_borrowed</span><span class="w">   </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">is_returned</span><span class="w">     </span><span class="nb">BOOLEAN</span><span class="p">,</span>
<span class="w">    </span><span class="n">late_fee</span><span class="w">        </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>



**Dimension tables:**

<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dim_date</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">date_key</span><span class="w">    </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">full_date</span><span class="w">   </span><span class="nb">DATE</span><span class="p">,</span>
<span class="w">    </span><span class="k">year</span><span class="w">        </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="k">month</span><span class="w">       </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">day_of_week</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="w">    </span><span class="n">is_weekend</span><span class="w">  </span><span class="nb">BOOLEAN</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dim_book</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">book_key</span><span class="w">    </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">isbn</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="w">    </span><span class="n">title</span><span class="w">       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
<span class="w">    </span><span class="n">author</span><span class="w">      </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">genre</span><span class="w">       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="n">publisher</span><span class="w">   </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">pub_year</span><span class="w">    </span><span class="nb">INT</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dim_patron</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">patron_key</span><span class="w">  </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">patron_id</span><span class="w">   </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="w">    </span><span class="n">name</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">membership</span><span class="w">  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="w">  </span><span class="c1">-- &#39;adult&#39;, &#39;student&#39;, &#39;senior&#39;</span>
<span class="w">    </span><span class="n">city</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dim_branch</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">branch_key</span><span class="w">  </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">branch_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">city</span><span class="w">        </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="k">state</span><span class="w">       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>



**Sample query: most popular genres by month:**

<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">dd</span><span class="p">.</span><span class="k">year</span><span class="p">,</span>
<span class="w">    </span><span class="n">dd</span><span class="p">.</span><span class="k">month</span><span class="p">,</span>
<span class="w">    </span><span class="n">db</span><span class="p">.</span><span class="n">genre</span><span class="p">,</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">checkouts</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">fact_checkout</span><span class="w"> </span><span class="n">f</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">dim_date</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">date_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="n">date_key</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">dim_book</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">book_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">book_key</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="k">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2025</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">genre</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dd</span><span class="p">.</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">checkouts</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>


</details>

<h3 id="exercise-4-4nf-decomposition">Exercise 4: 4NF Decomposition<a class="header-link" href="#exercise-4-4nf-decomposition" title="Permanent link">&para;</a></h3>
<p>Given R(A, B, C, D) with:
- A ‚Üí‚Üí B
- A ‚Üí C</p>
<p>Decompose into 4NF.</p>
<details>
<summary>Solution</summary>

First, identify all dependencies:
- A ‚Üí‚Üí B implies A ‚Üí‚Üí CD (complementation, since R - A - B = {C, D})
- A ‚Üí C (FD, which implies A ‚Üí‚Üí C)

Key: Consider {A, B, D}‚Å∫ or find the actual key. With A ‚Üí C, we get C from A. So we need A plus enough to determine B and D. If A ‚Üí‚Üí B, then B is multi-valued, so B must be in the key. Similarly D might be in the key.

Key candidates: {A, B, D} (since A determines only C functionally, and B and D are independent of each other given A).

Check 4NF: A ‚Üí‚Üí B is non-trivial, and {A} is not a superkey. Violation!

**Decompose on A ‚Üí‚Üí B:**
- R‚ÇÅ(A, B) ‚Äî key: {A, B}
- R‚ÇÇ(A, C, D) ‚Äî key: {A, D} (since A ‚Üí C)

Check R‚ÇÅ(A, B): Only trivial MVDs. 4NF ‚úì
Check R‚ÇÇ(A, C, D): A ‚Üí C. Is {A} a superkey? {A}‚Å∫ = {A, C}. No, D is not determined. Key is {A, D}. A ‚Üí C is an FD where A is not a superkey ‚Äî this violates BCNF!

**Decompose R‚ÇÇ on A ‚Üí C:**
- R‚ÇÉ(A, C) ‚Äî key: {A}
- R‚ÇÑ(A, D) ‚Äî key: {A, D}

**Final 4NF decomposition:**

<div class="highlight"><pre><span></span><code>R‚ÇÅ(A, B)    ‚Äî key: {A, B}
R‚ÇÉ(A, C)    ‚Äî key: {A}
R‚ÇÑ(A, D)    ‚Äî key: {A, D}
</code></pre></div>



All in 4NF ‚úì.
</details>

<h3 id="exercise-5-denormalization-decision">Exercise 5: Denormalization Decision<a class="header-link" href="#exercise-5-denormalization-decision" title="Permanent link">&para;</a></h3>
<p>For each scenario, would you normalize or denormalize? Explain your reasoning.</p>
<ol>
<li>An e-commerce product catalog with 10M products, read:write ratio of 1000:1</li>
<li>A banking transaction system processing wire transfers</li>
<li>A social media news feed showing posts with author names and profile pictures</li>
<li>A scientific data collection system recording sensor readings every second</li>
</ol>
<details>
<summary>Solution</summary>

1. **Product catalog (10M products, 1000:1 read:write)**: **Denormalize.** The overwhelming read dominance justifies redundancy. Use a denormalized product table with category names, brand names, etc. embedded directly. Consider a materialized view for search/filter pages. Updates are infrequent and can be batch-processed.

2. **Banking wire transfers**: **Normalize (BCNF).** Financial data demands perfect consistency. Every cent must be accounted for exactly once. The performance cost of joins is acceptable ‚Äî correctness is paramount. Use normalized tables with proper foreign keys and constraints.

3. **Social media news feed**: **Denormalize.** News feeds are read-heavy and latency-sensitive. Store author name and profile picture URL directly in the feed item (or use a cache layer like Redis). Accept eventual consistency ‚Äî if a user changes their profile picture, it's acceptable for old posts to show the old picture temporarily.

4. **Sensor data collection**: **Hybrid.** The sensor metadata (sensor_id, location, type) should be normalized (rarely changes). The time-series readings can use a specialized pattern ‚Äî either a time-series database (InfluxDB, TimescaleDB) or a denormalized wide table partitioned by time. The key constraint is write throughput, not join complexity.
</details>

<h3 id="exercise-6-join-dependency">Exercise 6: Join Dependency<a class="header-link" href="#exercise-6-join-dependency" title="Permanent link">&para;</a></h3>
<p>Given R(A, B, C) with the join dependency ‚ãà{(A,B), (B,C), (A,C)}:</p>
<ol>
<li>Is this relation necessarily in 4NF?</li>
<li>Is it in 5NF?</li>
<li>Decompose into 5NF.</li>
</ol>
<details>
<summary>Solution</summary>

1. **4NF?** Possibly yes. The JD ‚ãà{(A,B), (B,C), (A,C)} is a ternary join dependency, not implied by any MVD. If there are no non-trivial MVDs, the relation is in 4NF.

2. **5NF?** No. The JD ‚ãà{(A,B), (B,C), (A,C)} is non-trivial (it's not implied by candidate keys). If the only key is {A, B, C} (all attributes), then {A,B}, {B,C}, and {A,C} are not superkeys. **Not in 5NF.**

3. **5NF decomposition:**
   ```
   R‚ÇÅ(A, B)   ‚Äî key: {A, B}
   R‚ÇÇ(B, C)   ‚Äî key: {B, C}
   R‚ÇÉ(A, C)   ‚Äî key: {A, C}
   ```

   The JD guarantees this decomposition is lossless: R = R‚ÇÅ ‚ãà R‚ÇÇ ‚ãà R‚ÇÉ. Each component has only trivial JDs. All in 5NF ‚úì.
</details>

<hr />
<h2 id="11-summary">11. Summary<a class="header-link" href="#11-summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Key Point</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MVD (X ‚Üí‚Üí Y)</strong></td>
<td>For a given X, Y-values are independent of other attributes</td>
</tr>
<tr>
<td><strong>4NF</strong></td>
<td>Every non-trivial MVD determinant is a superkey</td>
</tr>
<tr>
<td><strong>Join Dependency</strong></td>
<td>R can be losslessly decomposed into multiple projections</td>
</tr>
<tr>
<td><strong>5NF (PJNF)</strong></td>
<td>Every non-trivial JD component is a superkey</td>
</tr>
<tr>
<td><strong>DKNF</strong></td>
<td>All constraints follow from domains and keys (theoretical ideal)</td>
</tr>
<tr>
<td><strong>Denormalization</strong></td>
<td>Intentional redundancy for read performance</td>
</tr>
<tr>
<td><strong>Star Schema</strong></td>
<td>Fact table + flat dimension tables (data warehousing)</td>
</tr>
<tr>
<td><strong>Snowflake Schema</strong></td>
<td>Fact table + normalized dimension tables</td>
</tr>
</tbody>
</table>
<p>The key practical takeaway: <strong>normalize by default (BCNF), and denormalize deliberately and with discipline when performance demands it</strong>. Document every denormalization decision and its maintenance strategy.</p>
<p>The next lesson covers query processing ‚Äî how the database engine actually executes the queries against these schemas, and how the optimizer chooses efficient execution plans.</p>
<hr />
<p><strong>Previous</strong>: <a href="./06_Normalization.md">06_Normalization.md</a> | <strong>Next</strong>: <a href="./08_Query_Processing.md">08_Query_Processing.md</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/06_Normalization.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Lesson 06: Normalization (1NF through BCNF)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/08_Query_Processing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Lesson 08: Query Processing</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}