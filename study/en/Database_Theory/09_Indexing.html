{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>09. Indexing - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Database_Theory/">Database Theory</a>
    <span class="separator">/</span>
    <span class="current">09. Indexing</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>09. Indexing</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/08_Query_Processing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Lesson 08: Query Processing</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/10_Transaction_Theory.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">10. Transaction Theory</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-why-indexing-matters">1. Why Indexing Matters</a><ul>
<li><a href="#the-fundamental-problem">The Fundamental Problem</a></li>
<li><a href="#sequential-vs-indexed-access">Sequential vs. Indexed Access</a></li>
<li><a href="#when-not-to-use-an-index">When Not to Use an Index</a></li>
<li><a href="#cost-model-basics">Cost Model Basics</a></li>
</ul>
</li>
<li><a href="#2-ordered-indices">2. Ordered Indices</a><ul>
<li><a href="#index-structure-fundamentals">Index Structure Fundamentals</a></li>
<li><a href="#21-primary-index">2.1 Primary Index</a></li>
<li><a href="#22-clustering-index">2.2 Clustering Index</a></li>
<li><a href="#23-secondary-index">2.3 Secondary Index</a></li>
<li><a href="#dense-vs-sparse-indices">Dense vs. Sparse Indices</a></li>
<li><a href="#multi-level-indices">Multi-Level Indices</a></li>
</ul>
</li>
<li><a href="#3-b-tree">3. B-Tree</a><ul>
<li><a href="#31-structure">3.1 Structure</a></li>
<li><a href="#32-search">3.2 Search</a></li>
<li><a href="#33-insertion">3.3 Insertion</a></li>
<li><a href="#34-deletion">3.4 Deletion</a></li>
<li><a href="#35-complexity-analysis">3.5 Complexity Analysis</a></li>
</ul>
</li>
<li><a href="#4-btree">4. B+Tree</a><ul>
<li><a href="#41-structure-and-properties">4.1 Structure and Properties</a></li>
<li><a href="#node-format">Node Format</a></li>
<li><a href="#42-btree-vs-b-tree-comparison">4.2 B+Tree vs. B-Tree Comparison</a></li>
<li><a href="#43-search-in-btree">4.3 Search in B+Tree</a></li>
<li><a href="#44-insertion-in-btree">4.4 Insertion in B+Tree</a></li>
<li><a href="#45-deletion-in-btree">4.5 Deletion in B+Tree</a></li>
<li><a href="#46-bulk-loading">4.6 Bulk Loading</a></li>
<li><a href="#47-height-and-performance-analysis">4.7 Height and Performance Analysis</a></li>
</ul>
</li>
<li><a href="#5-hash-based-indexing">5. Hash-Based Indexing</a><ul>
<li><a href="#51-static-hashing">5.1 Static Hashing</a></li>
<li><a href="#52-extendible-hashing">5.2 Extendible Hashing</a></li>
<li><a href="#53-linear-hashing">5.3 Linear Hashing</a></li>
<li><a href="#hash-vs-btree-comparison">Hash vs. B+Tree Comparison</a></li>
</ul>
</li>
<li><a href="#6-bitmap-index">6. Bitmap Index</a><ul>
<li><a href="#61-concept">6.1 Concept</a></li>
<li><a href="#62-bitmap-operations">6.2 Bitmap Operations</a></li>
<li><a href="#63-when-to-use-bitmap-indices">6.3 When to Use Bitmap Indices</a></li>
<li><a href="#64-bitmap-compression">6.4 Bitmap Compression</a></li>
<li><a href="#65-space-analysis">6.5 Space Analysis</a></li>
</ul>
</li>
<li><a href="#7-multi-dimensional-indexing">7. Multi-Dimensional Indexing</a><ul>
<li><a href="#71-the-problem">7.1 The Problem</a></li>
<li><a href="#72-r-tree">7.2 R-Tree</a></li>
<li><a href="#73-kd-tree">7.3 kd-Tree</a></li>
</ul>
</li>
<li><a href="#8-index-selection-and-design-guidelines">8. Index Selection and Design Guidelines</a><ul>
<li><a href="#81-index-selection-problem">8.1 Index Selection Problem</a></li>
<li><a href="#82-covering-index">8.2 Covering Index</a></li>
<li><a href="#83-composite-multi-column-index">8.3 Composite (Multi-Column) Index</a></li>
<li><a href="#84-partial-index">8.4 Partial Index</a></li>
<li><a href="#85-expression-index">8.5 Expression Index</a></li>
<li><a href="#86-practical-guidelines">8.6 Practical Guidelines</a></li>
</ul>
</li>
<li><a href="#9-index-structures-in-major-databases">9. Index Structures in Major Databases</a><ul>
<li><a href="#postgresql">PostgreSQL</a></li>
<li><a href="#mysql-innodb">MySQL InnoDB</a></li>
<li><a href="#summary-table">Summary Table</a></li>
</ul>
</li>
<li><a href="#10-exercises">10. Exercises</a><ul>
<li><a href="#conceptual-questions">Conceptual Questions</a></li>
<li><a href="#practical-questions">Practical Questions</a></li>
<li><a href="#analysis-questions">Analysis Questions</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="09-indexing">09. Indexing<a class="header-link" href="#09-indexing" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./08_Query_Processing.md">Query Processing and Optimization</a> | <strong>Next</strong>: <a href="./10_Transaction_Theory.md">Transaction Theory</a></p>
<hr />
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand why indexing is critical for database performance</li>
<li>Distinguish between ordered indices: primary, clustering, and secondary</li>
<li>Master B-Tree and B+Tree structures, operations, and complexity</li>
<li>Learn hash-based indexing techniques: static, extendible, and linear hashing</li>
<li>Understand bitmap indices and multi-dimensional index structures</li>
<li>Apply index design guidelines in practice</li>
</ul>
<hr />
<h2 id="1-why-indexing-matters">1. Why Indexing Matters<a class="header-link" href="#1-why-indexing-matters" title="Permanent link">&para;</a></h2>
<h3 id="the-fundamental-problem">The Fundamental Problem<a class="header-link" href="#the-fundamental-problem" title="Permanent link">&para;</a></h3>
<p>Consider a table <code>employees</code> with 1,000,000 rows stored on disk. Each disk block holds 10 rows, so the table occupies 100,000 blocks. To find a single employee by ID:</p>
<div class="highlight"><pre><span></span><code>Without index:  Scan all 100,000 blocks  â†’  O(n) disk I/Os
With index:     Follow index pointers     â†’  O(log n) disk I/Os
</code></pre></div>

<p>For 100,000 blocks:
- <strong>Sequential scan</strong>: up to 100,000 block reads
- <strong>B+Tree index</strong> (branching factor 200): approximately log_200(1,000,000) â‰ˆ 3 block reads</p>
<p>This is a <strong>33,000x improvement</strong> in I/O cost.</p>
<h3 id="sequential-vs-indexed-access">Sequential vs. Indexed Access<a class="header-link" href="#sequential-vs-indexed-access" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Sequential Access (Table Scan):
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ Blk1 â”‚ Blk2 â”‚ Blk3 â”‚ Blk4 â”‚ Blk5 â”‚ ...  â”‚ BlkN â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
  â†‘ Read every block sequentially

Indexed Access:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Index Root     â”‚  â† 1 I/O
â”‚  [50â”‚100â”‚150]    â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
   â†“      â†“      â†“
 â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”
 â”‚Leafâ”‚ â”‚Leafâ”‚ â”‚Leafâ”‚  â† 1 I/O (follow pointer)
 â””â”€â”€â”¬â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜
    â†“
 â”Œâ”€â”€â”€â”€â”€â”€â”
 â”‚ Data â”‚  â† 1 I/O (fetch actual record)
 â”‚ Blockâ”‚
 â””â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="when-not-to-use-an-index">When Not to Use an Index<a class="header-link" href="#when-not-to-use-an-index" title="Permanent link">&para;</a></h3>
<p>Indexes are not always beneficial:</p>
<ul>
<li><strong>Small tables</strong>: A sequential scan of a few blocks is faster than index traversal overhead</li>
<li><strong>High selectivity queries</strong>: If a query returns most rows (e.g., &gt;15-20% of the table), a full scan is cheaper</li>
<li><strong>Frequent writes</strong>: Every INSERT, UPDATE, or DELETE must also update the index</li>
<li><strong>Low-cardinality columns</strong>: Indexing a boolean column with a B+Tree is wasteful (bitmap index may be appropriate)</li>
</ul>
<h3 id="cost-model-basics">Cost Model Basics<a class="header-link" href="#cost-model-basics" title="Permanent link">&para;</a></h3>
<p>The cost of disk access dominates query performance. We measure in terms of <strong>block transfers</strong> (reading/writing a disk block) and <strong>seeks</strong> (moving the disk head).</p>
<p>Let:
- <code>b</code> = number of blocks in the file
- <code>n</code> = number of records
- <code>f</code> = blocking factor (records per block), so <code>b = âŒˆn/fâŒ‰</code></p>
<table>
<thead>
<tr>
<th>Access Method</th>
<th>Average Cost (equality search)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linear scan (unsorted)</td>
<td>b/2 block transfers</td>
</tr>
<tr>
<td>Linear scan (sorted)</td>
<td>âŒˆlogâ‚‚(b)âŒ‰ (binary search)</td>
</tr>
<tr>
<td>Primary index (sorted)</td>
<td>âŒˆlogâ‚‚(b_i)âŒ‰ + 1, where b_i = index blocks</td>
</tr>
<tr>
<td>B+Tree</td>
<td>âŒˆlog_p(b)âŒ‰ + 1, where p = branching factor</td>
</tr>
<tr>
<td>Hash index</td>
<td>1 (ideal) to 2 (with overflow)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-ordered-indices">2. Ordered Indices<a class="header-link" href="#2-ordered-indices" title="Permanent link">&para;</a></h2>
<h3 id="index-structure-fundamentals">Index Structure Fundamentals<a class="header-link" href="#index-structure-fundamentals" title="Permanent link">&para;</a></h3>
<p>An <strong>index</strong> is a data structure that maps <strong>search key values</strong> to <strong>pointers</strong> (record identifiers or block addresses). The search key need not be a primary key -- any attribute or set of attributes can serve as a search key.</p>
<div class="highlight"><pre><span></span><code>Index Entry Format:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Search Key   â”‚ Pointer(s)  â”‚
â”‚ Value        â”‚ to Records  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="21-primary-index">2.1 Primary Index<a class="header-link" href="#21-primary-index" title="Permanent link">&para;</a></h3>
<p>A <strong>primary index</strong> is built on the <strong>ordering key</strong> of a sequentially ordered file. The file is physically sorted on the indexed attribute.</p>
<div class="highlight"><pre><span></span><code>Primary Index on Employee ID (file sorted by ID):

Index:                         Data File:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 100 â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ 100 â”‚ Alice â”‚ ... â”‚ Block 1
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                 â”‚ 105 â”‚ Bob   â”‚ ... â”‚
â”‚ 200 â”‚  â”€â”€â”€â”€â”€â”€â”               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ 200 â”‚ Carol â”‚ ... â”‚ Block 2
â”‚ 300 â”‚  â”€â”€â”€â”€â”€â”€â”               â”‚ 210 â”‚ Dave  â”‚ ... â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ 300 â”‚ Eve   â”‚ ... â”‚ Block 3
                               â”‚ 350 â”‚ Frank â”‚ ... â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Properties:</strong>
- One index entry per <strong>block</strong> (not per record) -- this is a sparse index
- The search key is the same attribute the file is sorted on
- Very efficient for equality and range queries
- Only <strong>one</strong> primary index can exist per table (since the file can only be sorted one way)</p>
<h3 id="22-clustering-index">2.2 Clustering Index<a class="header-link" href="#22-clustering-index" title="Permanent link">&para;</a></h3>
<p>A <strong>clustering index</strong> is built on a non-key attribute that the file is physically ordered on. Multiple records may share the same search key value.</p>
<div class="highlight"><pre><span></span><code>Clustering Index on Department:

Index:                         Data File (sorted by dept):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Acctg    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ Acctg  â”‚ Alice â”‚ 60000   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤            â”‚ Acctg  â”‚ Bob   â”‚ 55000   â”‚
â”‚ Eng      â”‚  â”€â”€â”€â”€â”€â”€â”          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤  â””â”€â”€â”€â”€â”€â”€â†’ â”‚ Eng    â”‚ Carol â”‚ 80000   â”‚
â”‚ Sales    â”‚  â”€â”€â”€â”€â”€â”€â”          â”‚ Eng    â”‚ Dave  â”‚ 75000   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚ Eng    â”‚ Eve   â”‚ 72000   â”‚
                      â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â””â”€â”€â”€â”€â”€â†’  â”‚ Sales  â”‚ Frank â”‚ 50000   â”‚
                               â”‚ Sales  â”‚ Grace â”‚ 52000   â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Properties:</strong>
- One index entry per <strong>distinct value</strong> of the search key
- Each pointer leads to the first block containing that value
- Efficient for grouping and aggregation queries</p>
<h3 id="23-secondary-index">2.3 Secondary Index<a class="header-link" href="#23-secondary-index" title="Permanent link">&para;</a></h3>
<p>A <strong>secondary index</strong> provides an alternative access path on a non-ordering attribute. The file is <strong>not</strong> sorted on this attribute.</p>
<div class="highlight"><pre><span></span><code>Secondary Index on Salary:

Index (sorted by salary):      Data File (sorted by ID, NOT salary):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 50000 â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ 100 â”‚ Alice â”‚ 60000     â”‚ Block 1
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤               â”‚ 105 â”‚ Bob   â”‚ 50000     â”‚
â”‚ 55000 â”‚  â”€â”€â”€â”€â”€â”€â”              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤  â”‚            â”‚ 200 â”‚ Carol â”‚ 80000     â”‚ Block 2
â”‚ 60000 â”‚  â”€â”€â”€â”€â”€â”€â”â”‚            â”‚ 210 â”‚ Dave  â”‚ 55000     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤  â”‚â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 72000 â”‚  â”€â”€â”    â”‚â”‚           â”‚ 300 â”‚ Eve   â”‚ 72000     â”‚ Block 3
â”‚ ...   â”‚    â”‚    â”‚â”‚           â”‚ 350 â”‚ Frank â”‚ 75000     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜    â”‚â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚â”‚â”‚  (pointers cross block boundaries)
</code></pre></div>

<p><strong>Properties:</strong>
- Must be a <strong>dense index</strong> (one entry per record, not per block) since data is not sorted by the search key
- Multiple secondary indices can exist on the same table
- Less efficient for range queries (random I/O pattern due to non-sequential data)
- An extra level of indirection (bucket of pointers) is sometimes used for duplicate key values</p>
<h3 id="dense-vs-sparse-indices">Dense vs. Sparse Indices<a class="header-link" href="#dense-vs-sparse-indices" title="Permanent link">&para;</a></h3>
<p><strong>Dense Index</strong>: One index entry for <strong>every record</strong> in the data file.</p>
<div class="highlight"><pre><span></span><code><span class="nv">Dense</span><span class="w"> </span><span class="nv">Index</span>:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="mi">100</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â”¼â”€â”€â”€â†’<span class="w"> </span>â”‚<span class="w"> </span><span class="mi">100</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Alice</span><span class="w">  </span>â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¤<span class="w">     </span>â”‚<span class="w"> </span><span class="mi">105</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Bob</span><span class="w">    </span>â”‚<span class="w"> </span>â†â”€â”€<span class="w"> </span><span class="nv">entry</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">105</span><span class="w"> </span><span class="nv">exists</span>
â”‚<span class="w"> </span><span class="mi">105</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â”¼â”€â”€â”€â†’<span class="w"> </span>â”‚<span class="w">              </span>â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¤<span class="w">     </span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="mi">200</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â”¼â”€â”€â”€â†’<span class="w"> </span>â”‚<span class="w"> </span><span class="mi">200</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Carol</span><span class="w">  </span>â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¤<span class="w">     </span>â”‚<span class="w"> </span><span class="mi">210</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Dave</span><span class="w">   </span>â”‚
â”‚<span class="w"> </span><span class="mi">210</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â”¼â”€â”€â”€â†’<span class="w"> </span>â”‚<span class="w">              </span>â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Sparse Index</strong>: One index entry for <strong>some records</strong> (typically one per block).</p>
<div class="highlight"><pre><span></span><code><span class="nv">Sparse</span><span class="w"> </span><span class="nv">Index</span>:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="mi">100</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â”¼â”€â”€â”€â†’<span class="w"> </span>â”‚<span class="w"> </span><span class="mi">100</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Alice</span><span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Block</span><span class="w"> </span><span class="mi">1</span>
â”‚<span class="w">     </span>â”‚<span class="w">   </span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="mi">105</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Bob</span><span class="w">    </span>â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">no</span><span class="w"> </span><span class="nv">entry</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">105</span><span class="ss">)</span>
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¤<span class="w">     </span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="mi">200</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â”¼â”€â”€â”€â†’<span class="w"> </span>â”‚<span class="w"> </span><span class="mi">200</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Carol</span><span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Block</span><span class="w"> </span><span class="mi">2</span>
â”‚<span class="w">     </span>â”‚<span class="w">   </span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="mi">210</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Dave</span><span class="w">   </span>â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">no</span><span class="w"> </span><span class="nv">entry</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">210</span><span class="ss">)</span>
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Comparison:</strong></p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Dense Index</th>
<th>Sparse Index</th>
</tr>
</thead>
<tbody>
<tr>
<td>Space</td>
<td>Larger (entry per record)</td>
<td>Smaller (entry per block)</td>
</tr>
<tr>
<td>Search</td>
<td>Direct lookup possible</td>
<td>May need to scan within block</td>
</tr>
<tr>
<td>Requirement</td>
<td>Works on unsorted files</td>
<td>Requires sorted data file</td>
</tr>
<tr>
<td>Maintenance</td>
<td>More updates on insert/delete</td>
<td>Fewer updates</td>
</tr>
<tr>
<td>Use case</td>
<td>Secondary indices</td>
<td>Primary indices</td>
</tr>
</tbody>
</table>
<h3 id="multi-level-indices">Multi-Level Indices<a class="header-link" href="#multi-level-indices" title="Permanent link">&para;</a></h3>
<p>When the index itself is too large to fit in memory, we can build an <strong>index on the index</strong>:</p>
<div class="highlight"><pre><span></span><code>Level 2 (outer index):
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”
â”‚  1   â”‚ â”€â”€â”¼â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ 500  â”‚ â”€â”€â”¼â”€â”   â”‚  1   â”‚ â”€â”€â”¼â”€â”€â”€â†’ Data Block 1
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚   â”‚ 100  â”‚ â”€â”€â”¼â”€â”€â”€â†’ Data Block 2
              â”‚   â”‚ 200  â”‚ â”€â”€â”¼â”€â”€â”€â†’ Data Block 3
              â”‚   â”‚ ...  â”‚   â”‚
              â”‚   â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
              â”‚   Level 1 (inner index, part 1)
              â”‚
              â””â†’ â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”
                 â”‚ 500  â”‚ â”€â”€â”¼â”€â”€â”€â†’ Data Block K
                 â”‚ 600  â”‚ â”€â”€â”¼â”€â”€â”€â†’ Data Block K+1
                 â”‚ ...  â”‚   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
                 Level 1 (inner index, part 2)
</code></pre></div>

<p>This naturally leads us to tree-structured indices, specifically B-Trees and B+Trees.</p>
<hr />
<h2 id="3-b-tree">3. B-Tree<a class="header-link" href="#3-b-tree" title="Permanent link">&para;</a></h2>
<h3 id="31-structure">3.1 Structure<a class="header-link" href="#31-structure" title="Permanent link">&para;</a></h3>
<p>A <strong>B-Tree</strong> of order <code>m</code> (also called a B-Tree of degree <code>m</code>) satisfies:</p>
<ol>
<li>Every node has at most <code>m</code> children</li>
<li>Every internal node (except root) has at least <code>âŒˆm/2âŒ‰</code> children</li>
<li>The root has at least 2 children (if it is not a leaf)</li>
<li>All leaves appear at the same level</li>
<li>A non-leaf node with <code>k</code> children contains <code>k-1</code> keys</li>
</ol>
<div class="highlight"><pre><span></span><code>B-Tree of order 4 (each node holds up to 3 keys):

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   30     â”‚
                    â””â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”˜
                  â”Œâ”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”
           â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
           â”‚ 10 â”‚ 20 â”‚    â”‚ 40 â”‚ 50   â”‚
           â””â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”˜    â””â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”˜
            â†“   â†“   â†“      â†“   â†“    â†“
          â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”  â”Œâ”€â”€â”â”Œâ”€â”€â” â”Œâ”€â”€â”€â”
          â”‚5 â”‚â”‚15â”‚â”‚25â”‚  â”‚35â”‚â”‚45â”‚ â”‚55  â”‚
          â”‚8 â”‚â”‚  â”‚â”‚  â”‚  â”‚  â”‚â”‚  â”‚ â”‚60  â”‚
          â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜  â””â”€â”€â”˜â””â”€â”€â”˜ â””â”€â”€â”€â”˜

Note: In a B-Tree (unlike B+Tree), data pointers
exist at EVERY node, not just leaves.
</code></pre></div>

<p><strong>Node structure</strong> (internal node with <code>n</code> keys):</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="nv">P</span>â‚<span class="w"> </span>â”‚<span class="w"> </span><span class="nv">K</span>â‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">P</span>â‚‚<span class="w"> </span>â”‚<span class="w"> </span><span class="nv">K</span>â‚‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">P</span>â‚ƒ<span class="w"> </span>â”‚<span class="w"> </span>...<span class="w"> </span>â”‚<span class="w"> </span><span class="nv">P</span>â‚™â‚Šâ‚â”‚
â”‚<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">D</span>â‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">D</span>â‚‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">     </span>â”‚<span class="w">    </span>â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
<span class="w">  </span>â†“<span class="w">          </span>â†“<span class="w">          </span>â†“<span class="w">            </span>â†“
<span class="nv">subtree</span><span class="w">    </span><span class="nv">subtree</span><span class="w">    </span><span class="nv">subtree</span><span class="w">      </span><span class="nv">subtree</span>
<span class="o">&lt;</span><span class="w"> </span><span class="nv">K</span>â‚<span class="w">     </span>[<span class="nv">K</span>â‚,<span class="nv">K</span>â‚‚<span class="ss">)</span><span class="w">   </span>[<span class="nv">K</span>â‚‚,<span class="nv">K</span>â‚ƒ<span class="ss">)</span><span class="w">      </span>â‰¥<span class="w"> </span><span class="nv">K</span>â‚™

<span class="nv">Where</span>:
<span class="w">  </span><span class="nv">P</span>áµ¢<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pointer</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">child</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="ss">(</span><span class="nv">or</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">block</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">leaf</span><span class="ss">)</span>
<span class="w">  </span><span class="nv">K</span>áµ¢<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">search</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">value</span>
<span class="w">  </span><span class="nv">D</span>áµ¢<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pointer</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">record</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">K</span>áµ¢
</code></pre></div>

<h3 id="32-search">3.2 Search<a class="header-link" href="#32-search" title="Permanent link">&para;</a></h3>
<p>Searching a B-Tree for key <code>K</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">BTREE</span><span class="o">-</span><span class="k">SEARCH</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="err">â‰¤</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">n</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="k">key</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="err">:</span>
<span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="err">â‰¤</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">n</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="k">key</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="err">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">           </span><span class="o">//</span><span class="w"> </span><span class="k">Found</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">node</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nl">leaf</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NOT_FOUND</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">disk</span>
<span class="w">    </span><span class="k">DISK</span><span class="o">-</span><span class="k">READ</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">child</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BTREE</span><span class="o">-</span><span class="k">SEARCH</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">child</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">)</span>
</code></pre></div>

<p><strong>Complexity</strong>: O(log_m n) disk I/Os, where n is the number of keys and m is the order.</p>
<h3 id="33-insertion">3.3 Insertion<a class="header-link" href="#33-insertion" title="Permanent link">&para;</a></h3>
<p>Insert key <code>K</code> into a B-Tree of order <code>m</code>:</p>
<ol>
<li><strong>Find</strong> the appropriate leaf node using search</li>
<li><strong>Insert</strong> the key in sorted order within the leaf</li>
<li>If the node overflows (has <code>m</code> keys):</li>
<li><strong>Split</strong> the node into two nodes at the median key</li>
<li><strong>Promote</strong> the median key to the parent</li>
<li>Recursively handle parent overflow if needed</li>
</ol>
<p><strong>Example: Insert 25 into a B-Tree of order 3 (max 2 keys per node):</strong></p>
<div class="highlight"><pre><span></span><code>Before:
        â”Œâ”€â”€â”€â”€â”
        â”‚ 20 â”‚
        â””â”€â”¬â”€â”€â”˜
     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
  â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”
  â”‚10â”‚15â”‚   â”‚22â”‚30 â”‚  â† Node is full
  â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜

Step 1: Key 25 belongs in the right leaf [22, 30].
Step 2: Insert â†’ [22, 25, 30] â€” overflow! (3 keys &gt; max 2)
Step 3: Split at median (25). Promote 25 to parent.

After:
        â”Œâ”€â”€â”€â”€â”€â”€â”
        â”‚20â”‚25 â”‚
        â””â”¬â”€â”€â”¬â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”
 â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”  â”Œâ”€â”€â”
 â”‚10â”‚15â”‚ â”‚22â”‚  â”‚30â”‚
 â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”˜  â””â”€â”€â”˜
</code></pre></div>

<h3 id="34-deletion">3.4 Deletion<a class="header-link" href="#34-deletion" title="Permanent link">&para;</a></h3>
<p>Delete key <code>K</code> from a B-Tree of order <code>m</code>:</p>
<ol>
<li><strong>Find</strong> the node containing <code>K</code></li>
<li>If <code>K</code> is in a <strong>leaf</strong>: remove it directly</li>
<li>If <code>K</code> is in an <strong>internal node</strong>: replace with predecessor (or successor) from leaf, then delete from leaf</li>
<li>If the node <strong>underflows</strong> (fewer than <code>âŒˆm/2âŒ‰ - 1</code> keys):</li>
<li><strong>Redistribute</strong> (borrow) from a sibling if possible</li>
<li>Otherwise, <strong>merge</strong> with a sibling and pull down a key from the parent</li>
<li>Recursively handle parent underflow</li>
</ol>
<p><strong>Example: Delete 20 from above tree (order 3, min 1 key per non-root node):</strong></p>
<div class="highlight"><pre><span></span><code>Before:
        â”Œâ”€â”€â”€â”€â”€â”€â”
        â”‚20â”‚25 â”‚
        â””â”¬â”€â”€â”¬â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”
 â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”  â”Œâ”€â”€â”
 â”‚10â”‚15â”‚ â”‚22â”‚  â”‚30â”‚
 â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”˜  â””â”€â”€â”˜

Step 1: Key 20 is in an internal node.
Step 2: Replace with in-order predecessor (15).
Step 3: Delete 15 from the leaf.

After replacement:
        â”Œâ”€â”€â”€â”€â”€â”€â”
        â”‚15â”‚25 â”‚
        â””â”¬â”€â”€â”¬â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”
 â”Œâ”€â”€â”   â”Œâ”€â”€â”   â”Œâ”€â”€â”
 â”‚10â”‚   â”‚22â”‚   â”‚30â”‚
 â””â”€â”€â”˜   â””â”€â”€â”˜   â””â”€â”€â”˜
</code></pre></div>

<h3 id="35-complexity-analysis">3.5 Complexity Analysis<a class="header-link" href="#35-complexity-analysis" title="Permanent link">&para;</a></h3>
<p>For a B-Tree of order <code>m</code> with <code>n</code> keys:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Disk I/Os</th>
<th>CPU Time</th>
</tr>
</thead>
<tbody>
<tr>
<td>Search</td>
<td>O(log_m n)</td>
<td>O(m Â· log_m n)</td>
</tr>
<tr>
<td>Insert</td>
<td>O(log_m n)</td>
<td>O(m Â· log_m n)</td>
</tr>
<tr>
<td>Delete</td>
<td>O(log_m n)</td>
<td>O(m Â· log_m n)</td>
</tr>
</tbody>
</table>
<p><strong>Height bound</strong>: For <code>n â‰¥ 1</code> keys and minimum degree <code>t = âŒˆm/2âŒ‰</code>:</p>
<div class="highlight"><pre><span></span><code>h â‰¤ log_t((n+1)/2)
</code></pre></div>

<p>With a typical branching factor of 100-200, a tree of height 3-4 can index <strong>billions</strong> of records.</p>
<hr />
<h2 id="4-btree">4. B+Tree<a class="header-link" href="#4-btree" title="Permanent link">&para;</a></h2>
<h3 id="41-structure-and-properties">4.1 Structure and Properties<a class="header-link" href="#41-structure-and-properties" title="Permanent link">&para;</a></h3>
<p>The <strong>B+Tree</strong> is the most widely used index structure in relational databases (PostgreSQL, MySQL InnoDB, Oracle, SQL Server all use B+Trees). It differs from the B-Tree in crucial ways:</p>
<ol>
<li><strong>All data pointers are in leaf nodes</strong> -- internal nodes only store keys and child pointers</li>
<li><strong>Leaf nodes are linked</strong> in a doubly-linked list for efficient range scans</li>
<li><strong>Keys in internal nodes are duplicated</strong> in leaves (internal keys serve only as guides)</li>
</ol>
<div class="highlight"><pre><span></span><code>B+Tree Structure:

Internal Nodes (guide keys only):
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  30  â”‚  60  â”‚
                    â””â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“            â†“           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 10 â”‚ 20 â”‚  â”‚ 40 â”‚ 50 â”‚  â”‚ 70 â”‚ 80 â”‚
        â””â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”˜  â””â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”˜  â””â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”˜
          â†“  â†“  â†“      â†“  â†“  â†“      â†“  â†“  â†“

Leaf Nodes (actual data, linked):
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚ 5,8 â”‚â†”â”‚10,15â”‚â†”â”‚20,25â”‚â†”â”‚30,35â”‚â†”â”‚40,45â”‚â†”â”‚50,55â”‚â†”â”‚60,65â”‚â†”â”‚70,75â”‚â†”â”‚80,85â”‚
â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚
â”‚ D*  â”‚  â”‚ D*  â”‚  â”‚ D*  â”‚  â”‚ D*  â”‚  â”‚ D*  â”‚  â”‚ D*  â”‚  â”‚ D*  â”‚  â”‚ D*  â”‚  â”‚ D*  â”‚
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
  â†‘                                                                          â†‘
Head                                              Leaf chain (doubly linked) Tail

D* = pointer to actual data record
</code></pre></div>

<h3 id="node-format">Node Format<a class="header-link" href="#node-format" title="Permanent link">&para;</a></h3>
<p><strong>Internal node</strong> (order <code>m</code>, at most <code>m</code> pointers, <code>m-1</code> keys):</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ Pâ‚ â”‚ Kâ‚  â”‚ Pâ‚‚ â”‚ Kâ‚‚  â”‚ Pâ‚ƒ â”‚ ... â”‚ Pâ‚˜â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
All keys in subtree(Pâ‚) &lt; Kâ‚
Kâ‚ â‰¤ all keys in subtree(Pâ‚‚) &lt; Kâ‚‚
...
Kâ‚˜â‚‹â‚ â‰¤ all keys in subtree(Pâ‚˜)
</code></pre></div>

<p><strong>Leaf node</strong> (at most <code>m-1</code> key-pointer pairs, plus sibling pointer):</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="nv">K</span>â‚,<span class="nv">D</span>â‚â”‚<span class="nv">K</span>â‚‚,<span class="nv">D</span>â‚‚â”‚<span class="nv">K</span>â‚ƒ,<span class="nv">D</span>â‚ƒâ”‚<span class="w"> </span>...<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">P</span>â‚™â‚‘â‚“â‚œ<span class="w">  </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="nv">D</span>áµ¢<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pointer</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">record</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">K</span>áµ¢
<span class="nv">P</span>â‚™â‚‘â‚“â‚œ<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pointer</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="nv">leaf</span><span class="w"> </span><span class="nv">node</span>
</code></pre></div>

<h3 id="42-btree-vs-b-tree-comparison">4.2 B+Tree vs. B-Tree Comparison<a class="header-link" href="#42-btree-vs-b-tree-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>B-Tree</th>
<th>B+Tree</th>
</tr>
</thead>
<tbody>
<tr>
<td>Data pointers</td>
<td>At every node</td>
<td>Only at leaf nodes</td>
</tr>
<tr>
<td>Key duplication</td>
<td>No duplicates</td>
<td>Internal keys duplicated in leaves</td>
</tr>
<tr>
<td>Leaf linking</td>
<td>Not linked</td>
<td>Doubly linked list</td>
</tr>
<tr>
<td>Range queries</td>
<td>Must traverse tree multiple times</td>
<td>Follow leaf chain</td>
</tr>
<tr>
<td>Fan-out</td>
<td>Lower (data pointers take space)</td>
<td>Higher (internal nodes are slimmer)</td>
</tr>
<tr>
<td>Equality search</td>
<td>May terminate early (at internal node)</td>
<td>Always goes to leaf</td>
</tr>
<tr>
<td>Space usage</td>
<td>Slightly less total</td>
<td>Slightly more (key duplication)</td>
</tr>
<tr>
<td>Practical use</td>
<td>Rarely used in databases</td>
<td>Standard in all major RDBMS</td>
</tr>
</tbody>
</table>
<h3 id="43-search-in-btree">4.3 Search in B+Tree<a class="header-link" href="#43-search-in-btree" title="Permanent link">&para;</a></h3>
<p><strong>Equality search</strong> for key <code>K</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">BPLUS</span><span class="o">-</span><span class="k">SEARCH</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nl">leaf</span><span class="p">:</span>
<span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smallest</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="k">key</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">exists</span><span class="err">:</span>
<span class="w">            </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">child</span><span class="o">[</span><span class="n">last</span><span class="o">]</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">rightmost</span><span class="w"> </span><span class="n">child</span>
<span class="w">        </span><span class="k">else</span><span class="err">:</span>
<span class="w">            </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">.</span><span class="n">child</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">i</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Now</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="nl">leaf</span><span class="p">:</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">K</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">pointer</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">node</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nl">K</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">pointer</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NOT_FOUND</span>
</code></pre></div>

<p><strong>Range search</strong> for keys in <code>[lo, hi]</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">BPLUS</span><span class="o">-</span><span class="nv">RANGE</span><span class="o">-</span><span class="nv">SEARCH</span><span class="ss">(</span><span class="nv">root</span>,<span class="w"> </span><span class="nv">lo</span>,<span class="w"> </span><span class="nv">hi</span><span class="ss">)</span>:
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Step</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">Find</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">leaf</span><span class="w"> </span><span class="nv">containing</span><span class="w"> </span><span class="nv">lo</span>
<span class="w">    </span><span class="nv">leaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">find</span><span class="w"> </span><span class="nv">leaf</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">lo</span><span class="w"> </span><span class="ss">(</span><span class="nv">using</span><span class="w"> </span><span class="nv">equality</span><span class="w"> </span><span class="nv">search</span><span class="w"> </span><span class="nv">logic</span><span class="ss">)</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Step</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">Scan</span><span class="w"> </span><span class="nv">leaves</span><span class="w"> </span><span class="nv">via</span><span class="w"> </span><span class="nv">linked</span><span class="w"> </span><span class="nv">list</span>
<span class="w">    </span><span class="nv">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[]
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">leaf</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">null</span>:
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="ss">(</span><span class="nv">key</span>,<span class="w"> </span><span class="nv">pointer</span><span class="ss">)</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">leaf</span>:
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">hi</span>:
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nv">results</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">lo</span>:
<span class="w">                </span><span class="nv">results</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">pointer</span><span class="ss">)</span>
<span class="w">        </span><span class="nv">leaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">leaf</span>.<span class="k">next</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Follow</span><span class="w"> </span><span class="nv">leaf</span><span class="w"> </span><span class="nv">chain</span><span class="o">!</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">results</span>
</code></pre></div>

<p>This is why B+Trees excel at range queries -- once you find the starting leaf, you simply follow the linked list.</p>
<h3 id="44-insertion-in-btree">4.4 Insertion in B+Tree<a class="header-link" href="#44-insertion-in-btree" title="Permanent link">&para;</a></h3>
<p>Insert key <code>K</code> with data pointer <code>D</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">BPLUS</span><span class="o">-</span><span class="k">INSERT</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">leaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">leaf</span><span class="w"> </span><span class="n">node</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">leaf</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="nl">room</span><span class="p">:</span>
<span class="w">        </span><span class="k">insert</span><span class="w"> </span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">leaf</span>
<span class="w">    </span><span class="k">else</span><span class="err">:</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Leaf</span><span class="w"> </span><span class="nl">overflow</span><span class="p">:</span><span class="w"> </span><span class="n">split</span>
<span class="w">        </span><span class="k">Create</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">leaf</span><span class="w"> </span><span class="n">L</span><span class="s1">&#39;</span>
<span class="s1">        Distribute entries evenly: first âŒˆm/2âŒ‰ stay, rest go to L&#39;</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Copy</span><span class="w"> </span><span class="nl">up</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">L</span><span class="s1">&#39; goes to parent</span>
<span class="s1">        parent-key = L&#39;</span><span class="p">.</span><span class="k">key</span><span class="o">[</span><span class="n">1</span><span class="o">]</span>
<span class="w">        </span><span class="k">INSERT</span><span class="o">-</span><span class="ow">IN</span><span class="o">-</span><span class="n">PARENT</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="o">-</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="s1">&#39;)</span>

<span class="s1">    Update leaf linked list pointers</span>

<span class="s1">INSERT-IN-PARENT(left, key, right):</span>
<span class="s1">    if parent has room:</span>
<span class="s1">        insert (key, right pointer) in parent</span>
<span class="s1">    else:</span>
<span class="s1">        // Internal node overflow: split</span>
<span class="s1">        Create new internal node N&#39;</span>
<span class="w">        </span><span class="nl">Distribute</span><span class="p">:</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="err">âŒˆ</span><span class="n">m</span><span class="o">/</span><span class="mi">2</span><span class="err">âŒ‰</span><span class="w"> </span><span class="n">pointers</span><span class="w"> </span><span class="n">stay</span><span class="p">,</span><span class="w"> </span><span class="n">rest</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;</span>

<span class="s1">        // Push up: the middle key goes to parent (NOT copied)</span>
<span class="s1">        middle-key = the key that separates the two halves</span>
<span class="s1">        INSERT-IN-PARENT(parent, middle-key, N&#39;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Important distinction:</strong>
- Leaf split: <strong>copy up</strong> (the separator key exists in both the leaf and the parent)
- Internal split: <strong>push up</strong> (the separator key moves to the parent and is removed from the splitting node)</p>
<p><strong>Example: Insert 7 into a B+Tree of order 3 (max 2 keys per leaf):</strong></p>
<div class="highlight"><pre><span></span><code>Before:
           â”Œâ”€â”€â”€â”€â”
           â”‚ 5  â”‚
           â””â”¬â”€â”€â”€â”˜
       â”Œâ”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”
    â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
    â”‚ 3,4 â”‚ â”€â”€â†’ â”‚ 5,6  â”‚
    â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜

Step 1: Key 7 belongs in leaf [5, 6]. Leaf is full.
Step 2: Split leaf: [5] and [6, 7]. Copy up key 6 to parent.

After:
           â”Œâ”€â”€â”€â”€â”€â”€â”
           â”‚ 5 â”‚ 6â”‚
           â””â”¬â”€â”€â”¬â”€â”€â”˜
       â”Œâ”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”
    â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
    â”‚ 3,4 â”‚â†’â”‚ 5 â”‚â†’â”‚ 6,7 â”‚
    â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="45-deletion-in-btree">4.5 Deletion in B+Tree<a class="header-link" href="#45-deletion-in-btree" title="Permanent link">&para;</a></h3>
<p>Delete key <code>K</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">BPLUS</span><span class="o">-</span><span class="nv">DELETE</span><span class="ss">(</span><span class="nv">root</span>,<span class="w"> </span><span class="nv">K</span><span class="ss">)</span>:
<span class="w">    </span><span class="nv">leaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">find</span><span class="w"> </span><span class="nv">leaf</span><span class="w"> </span><span class="nv">containing</span><span class="w"> </span><span class="nv">K</span>
<span class="w">    </span><span class="nv">Remove</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">leaf</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">leaf</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">enough</span><span class="w"> </span><span class="nv">keys</span><span class="w"> </span><span class="ss">(</span>â‰¥<span class="w"> </span>âŒˆ<span class="ss">(</span><span class="nv">m</span><span class="o">-</span><span class="mi">1</span><span class="ss">)</span><span class="o">/</span><span class="mi">2</span>âŒ‰<span class="ss">)</span>:
<span class="w">        </span><span class="nv">done</span><span class="w"> </span><span class="ss">(</span><span class="nv">may</span><span class="w"> </span><span class="nv">need</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="nv">parent</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">changed</span><span class="ss">)</span>
<span class="w">    </span><span class="k">else</span>:
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nv">Underflow</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">sibling</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">extra</span><span class="w"> </span><span class="nv">keys</span>:
<span class="w">            </span><span class="nv">redistribute</span><span class="w"> </span><span class="ss">(</span><span class="nv">borrow</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">sibling</span><span class="ss">)</span>
<span class="w">            </span><span class="nv">update</span><span class="w"> </span><span class="nv">parent</span><span class="w"> </span><span class="nv">key</span>
<span class="w">        </span><span class="k">else</span>:
<span class="w">            </span><span class="nv">merge</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">sibling</span>
<span class="w">            </span><span class="nv">delete</span><span class="w"> </span><span class="nv">entry</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">parent</span>
<span class="w">            </span><span class="nv">recursively</span><span class="w"> </span><span class="nv">handle</span><span class="w"> </span><span class="nv">parent</span><span class="w"> </span><span class="nv">underflow</span>
</code></pre></div>

<p><strong>Leaf merge</strong> removes a key from the parent. <strong>Internal node merge</strong> pulls down a key from the parent. When the root is left with a single child, the child becomes the new root (tree height decreases).</p>
<h3 id="46-bulk-loading">4.6 Bulk Loading<a class="header-link" href="#46-bulk-loading" title="Permanent link">&para;</a></h3>
<p>Building a B+Tree one insertion at a time from an empty tree is inefficient. <strong>Bulk loading</strong> is used when creating an index on existing data:</p>
<div class="highlight"><pre><span></span><code>BULK-LOAD(sorted_data, m):
    // Step 1: Sort data by search key (external sort if needed)

    // Step 2: Fill leaf nodes sequentially
    for each key in sorted_data:
        add to current leaf
        if leaf full:
            start new leaf
            add separator to parent level

    // Step 3: Build internal levels bottom-up
    repeat for each level until root is created
</code></pre></div>

<p><strong>Advantages of bulk loading:</strong>
- Sequential I/O instead of random I/O
- Fill factor can be controlled (e.g., 90% full for future inserts)
- O(n log_m n) total, but with much better constants</p>
<p><strong>PostgreSQL:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- CREATE INDEX uses bulk loading internally when table has data</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_emp_salary</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">salary</span><span class="p">);</span>

<span class="c1">-- REINDEX rebuilds an index (useful after heavy updates)</span>
<span class="k">REINDEX</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_emp_salary</span><span class="p">;</span>
</code></pre></div>

<h3 id="47-height-and-performance-analysis">4.7 Height and Performance Analysis<a class="header-link" href="#47-height-and-performance-analysis" title="Permanent link">&para;</a></h3>
<p>For a B+Tree of order <code>m</code> with <code>n</code> search key values:</p>
<p><strong>Maximum height:</strong></p>
<div class="highlight"><pre><span></span><code>h â‰¤ âŒˆlog_{âŒˆm/2âŒ‰}(n)âŒ‰
</code></pre></div>

<p><strong>Practical example:</strong></p>
<p>Given:
- Block size: 4 KB
- Key size: 8 bytes, pointer size: 8 bytes
- Internal node fan-out: m = 4096 / (8 + 8) = 256
- Leaf entries: (m-1) = 255 per leaf</p>
<p>For n = 100,000,000 (100 million) records:</p>
<div class="highlight"><pre><span></span><code>Height = âŒˆlogâ‚â‚‚â‚ˆ(100,000,000)âŒ‰ = âŒˆlogâ‚â‚‚â‚ˆ(10â¸)âŒ‰ â‰ˆ âŒˆ8/2.1âŒ‰ â‰ˆ 4
</code></pre></div>

<p>So <strong>4 disk reads</strong> suffice to find any record among 100 million. In practice, the root and top levels are cached in memory, reducing this to <strong>1-2 disk reads</strong>.</p>
<hr />
<h2 id="5-hash-based-indexing">5. Hash-Based Indexing<a class="header-link" href="#5-hash-based-indexing" title="Permanent link">&para;</a></h2>
<h3 id="51-static-hashing">5.1 Static Hashing<a class="header-link" href="#51-static-hashing" title="Permanent link">&para;</a></h3>
<p>A <strong>hash index</strong> uses a hash function <code>h(K)</code> to map search key values directly to bucket addresses.</p>
<div class="highlight"><pre><span></span><code><span class="n">Hash</span><span class="w"> </span><span class="k">Function</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="n">maps</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">bucket</span><span class="w"> </span><span class="nl">number</span><span class="p">:</span>

<span class="k">Key</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="ss">&quot;Alice&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="k">Key</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;Bob&quot;</span><span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="ss">&quot;Bob&quot;</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">Key</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;Carol&quot;</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="ss">&quot;Carol&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="p">(</span><span class="n">collision</span><span class="err">!</span><span class="p">)</span>

<span class="n">Bucket</span><span class="w"> </span><span class="k">Array</span><span class="err">:</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Bucket</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Bob, ...</span><span class="o">]</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Bucket</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">empty</span><span class="o">]</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Bucket</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Alice, ...</span><span class="o">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Carol, ...</span><span class="o">]</span><span class="w">  </span><span class="p">(</span><span class="n">overflow</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Bucket</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Dave, ...</span><span class="o">]</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<p><strong>Properties:</strong>
- <strong>Ideal case</strong>: O(1) lookup -- one disk read
- <strong>Overflow handling</strong>: Chaining (linked list of overflow buckets)
- <strong>Weakness</strong>: Fixed number of buckets. Performance degrades as file grows</p>
<p><strong>Hash function requirements:</strong>
1. <strong>Uniform distribution</strong>: Keys should be spread evenly across buckets
2. <strong>Deterministic</strong>: Same key always maps to the same bucket
3. <strong>Fast computation</strong>: O(1) time</p>
<h3 id="52-extendible-hashing">5.2 Extendible Hashing<a class="header-link" href="#52-extendible-hashing" title="Permanent link">&para;</a></h3>
<p><strong>Extendible hashing</strong> adapts to data growth by using a <strong>directory</strong> that doubles in size as needed, without reorganizing the entire file.</p>
<p><strong>Key concepts:</strong>
- <strong>Global depth</strong> (<code>d</code>): Number of bits of the hash value used by the directory
- <strong>Local depth</strong> (<code>dáµ¢</code>): Number of bits used by bucket <code>i</code>
- Directory size = <code>2^d</code> entries</p>
<div class="highlight"><pre><span></span><code><span class="nv">Example</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">global</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>:

<span class="nv">Hash</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="ss">(</span><span class="nv">binary</span><span class="ss">)</span>:<span class="w">        </span><span class="nv">Directory</span><span class="w"> </span><span class="ss">(</span><span class="nv">d</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>:
<span class="nv">h</span><span class="ss">(</span><span class="nv">K</span>â‚<span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">01001</span>...<span class="w">            </span>â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<span class="nv">h</span><span class="ss">(</span><span class="nv">K</span>â‚‚<span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10110</span>...<span class="w">            </span>â”‚<span class="w"> </span><span class="mi">00</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â†’<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="ss">(</span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="mi">2</span><span class="ss">)</span>
<span class="nv">h</span><span class="ss">(</span><span class="nv">K</span>â‚ƒ<span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">00101</span>...<span class="w">            </span>â”‚<span class="w"> </span><span class="mi">01</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â†’<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="ss">(</span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="mi">2</span><span class="ss">)</span>
<span class="nv">h</span><span class="ss">(</span><span class="nv">K</span>â‚„<span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11010</span>...<span class="w">            </span>â”‚<span class="w"> </span><span class="mi">10</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â†’<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="ss">(</span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>
<span class="nv">h</span><span class="ss">(</span><span class="nv">K</span>â‚…<span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10011</span>...<span class="w">            </span>â”‚<span class="w"> </span><span class="mi">11</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â†’<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="ss">(</span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>
<span class="w">                             </span>â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Note</span>:<span class="w"> </span><span class="nv">Entries</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="nv">both</span><span class="w"> </span><span class="nv">point</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="nv">C</span>
<span class="nv">because</span><span class="w"> </span><span class="nv">C</span><span class="err">&#39;s local depth (1) &lt; global depth (2).</span>
<span class="err">Only the first bit matters for Bucket C.</span>
</code></pre></div>

<p><strong>Bucket split when bucket overflows:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">If</span><span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="ss">(</span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="mi">2</span><span class="ss">)</span><span class="w"> </span><span class="nv">overflows</span>:

<span class="nv">Case</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">global</span><span class="w"> </span><span class="nv">depth</span>
<span class="w">  </span>â†’<span class="w"> </span><span class="nv">Split</span><span class="w"> </span><span class="nv">bucket</span>,<span class="w"> </span><span class="nv">increase</span><span class="w"> </span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span>
<span class="w">  </span>â†’<span class="w"> </span><span class="nv">Redistribute</span><span class="w"> </span><span class="nv">entries</span>
<span class="w">  </span>â†’<span class="w"> </span><span class="nv">Update</span><span class="w"> </span><span class="nv">directory</span><span class="w"> </span><span class="nv">pointers</span>

<span class="nv">Case</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">global</span><span class="w"> </span><span class="nv">depth</span>
<span class="w">  </span>â†’<span class="w"> </span><span class="nv">Double</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">directory</span><span class="w"> </span><span class="ss">(</span><span class="nv">global</span><span class="w"> </span><span class="nv">depth</span><span class="w"> </span><span class="nv">increases</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>
<span class="w">  </span>â†’<span class="w"> </span><span class="nv">Split</span><span class="w"> </span><span class="nv">bucket</span>,<span class="w"> </span><span class="nv">increase</span><span class="w"> </span><span class="nv">local</span><span class="w"> </span><span class="nv">depth</span>
<span class="w">  </span>â†’<span class="w"> </span><span class="nv">Redistribute</span><span class="w"> </span><span class="nv">entries</span>
<span class="w">  </span>â†’<span class="w"> </span><span class="nv">Update</span><span class="w"> </span><span class="nv">directory</span><span class="w"> </span><span class="nv">pointers</span>
</code></pre></div>

<p><strong>Advantages:</strong>
- No overflow chains (splits handle growth)
- At most 2 disk accesses for any lookup (1 for directory, 1 for bucket)
- Grows gracefully</p>
<p><strong>Disadvantages:</strong>
- Directory can become large if data is skewed
- Directory doubling is expensive (though infrequent)</p>
<h3 id="53-linear-hashing">5.3 Linear Hashing<a class="header-link" href="#53-linear-hashing" title="Permanent link">&para;</a></h3>
<p><strong>Linear hashing</strong> avoids the directory entirely. Buckets are split in a <strong>round-robin</strong> fashion, one at a time, controlled by a split pointer.</p>
<p><strong>Key idea:</strong>
- Maintain a <strong>split pointer</strong> <code>s</code> that tracks the next bucket to split
- Use two hash functions: <code>hâ‚€(K) = K mod N</code> and <code>hâ‚(K) = K mod 2N</code>
- When a bucket overflows, split the bucket at the split pointer (not necessarily the overflowing bucket)</p>
<div class="highlight"><pre><span></span><code><span class="nv">State</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">N</span><span class="o">=</span><span class="mi">4</span><span class="w"> </span><span class="nv">buckets</span>,<span class="w"> </span><span class="nv">split</span><span class="w"> </span><span class="nv">pointer</span><span class="w"> </span><span class="nv">s</span><span class="o">=</span><span class="mi">1</span>:

<span class="nv">Buckets</span>:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>â”‚<span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">records</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">h</span>â‚<span class="ss">(</span><span class="nv">K</span><span class="ss">)</span><span class="o">=</span><span class="mi">0</span>]<span class="w">    </span><span class="ss">(</span><span class="nv">already</span><span class="w"> </span><span class="nv">split</span>,<span class="w"> </span><span class="nv">uses</span><span class="w"> </span><span class="nv">h</span>â‚<span class="ss">)</span>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>â”‚<span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">records</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">h</span>â‚€<span class="ss">(</span><span class="nv">K</span><span class="ss">)</span><span class="o">=</span><span class="mi">1</span>]<span class="w">    </span>â†<span class="w"> </span><span class="nv">split</span><span class="w"> </span><span class="nv">pointer</span><span class="w"> </span><span class="nv">s</span>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>â”‚<span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">records</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">h</span>â‚€<span class="ss">(</span><span class="nv">K</span><span class="ss">)</span><span class="o">=</span><span class="mi">2</span>]<span class="w">    </span><span class="ss">(</span><span class="nv">not</span><span class="w"> </span><span class="nv">yet</span><span class="w"> </span><span class="nv">split</span>,<span class="w"> </span><span class="nv">uses</span><span class="w"> </span><span class="nv">h</span>â‚€<span class="ss">)</span>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span>â”‚<span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">records</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">h</span>â‚€<span class="ss">(</span><span class="nv">K</span><span class="ss">)</span><span class="o">=</span><span class="mi">3</span>]<span class="w">    </span><span class="ss">(</span><span class="nv">not</span><span class="w"> </span><span class="nv">yet</span><span class="w"> </span><span class="nv">split</span>,<span class="w"> </span><span class="nv">uses</span><span class="w"> </span><span class="nv">h</span>â‚€<span class="ss">)</span>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span>â”‚<span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">records</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">h</span>â‚<span class="ss">(</span><span class="nv">K</span><span class="ss">)</span><span class="o">=</span><span class="mi">4</span>]<span class="w">    </span><span class="ss">(</span><span class="nv">created</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">splitting</span><span class="w"> </span><span class="nv">Bucket</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Lookup</span><span class="w"> </span><span class="nv">algorithm</span>:
<span class="w">  </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">h</span>â‚€<span class="ss">(</span><span class="nv">K</span><span class="ss">)</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="nv">e</span>.<span class="nv">g</span>.,<span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">mod</span><span class="w"> </span><span class="mi">4</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">s</span>:<span class="w">           </span><span class="o">//</span><span class="w"> </span><span class="nv">bucket</span><span class="w"> </span><span class="nv">already</span><span class="w"> </span><span class="nv">split</span>
<span class="w">      </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">h</span>â‚<span class="ss">(</span><span class="nv">K</span><span class="ss">)</span><span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">mod</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nv">instead</span>
<span class="w">  </span><span class="nv">search</span><span class="w"> </span><span class="nv">bucket</span><span class="w"> </span><span class="nv">b</span>
</code></pre></div>

<p><strong>When to split:</strong>
- Split is triggered when any bucket overflows
- The bucket at the split pointer is split (not the overflowing bucket!)
- The overflowing bucket uses overflow chains temporarily
- Split pointer advances: <code>s = s + 1</code>
- When <code>s = N</code>, a round is complete: <code>N = 2N</code>, <code>s = 0</code>, advance hash functions</p>
<p><strong>Advantages:</strong>
- No directory needed
- Smooth growth (one bucket at a time)
- Guaranteed O(1) average access</p>
<p><strong>Disadvantages:</strong>
- Temporary overflow chains
- Splitting may not relieve the actual overflowing bucket immediately</p>
<h3 id="hash-vs-btree-comparison">Hash vs. B+Tree Comparison<a class="header-link" href="#hash-vs-btree-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Criteria</th>
<th>Hash Index</th>
<th>B+Tree Index</th>
</tr>
</thead>
<tbody>
<tr>
<td>Equality query</td>
<td>O(1) -- excellent</td>
<td>O(log n) -- good</td>
</tr>
<tr>
<td>Range query</td>
<td>Not supported</td>
<td>Excellent (leaf chain)</td>
</tr>
<tr>
<td>Ordered traversal</td>
<td>Not supported</td>
<td>Natural (leaf scan)</td>
</tr>
<tr>
<td>Dynamic growth</td>
<td>Extendible/linear</td>
<td>Splits and merges</td>
</tr>
<tr>
<td>Space usage</td>
<td>Can waste space (empty buckets)</td>
<td>Good utilization (~67%)</td>
</tr>
<tr>
<td>Implementation</td>
<td>Simpler</td>
<td>More complex</td>
</tr>
<tr>
<td>Common in RDBMS</td>
<td>PostgreSQL (hash), Redis</td>
<td>All major RDBMS</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6-bitmap-index">6. Bitmap Index<a class="header-link" href="#6-bitmap-index" title="Permanent link">&para;</a></h2>
<h3 id="61-concept">6.1 Concept<a class="header-link" href="#61-concept" title="Permanent link">&para;</a></h3>
<p>A <strong>bitmap index</strong> creates a bit vector for each distinct value of an indexed attribute. Each bit corresponds to a row in the table.</p>
<div class="highlight"><pre><span></span><code><span class="n">Table</span><span class="o">:</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">(</span><span class="mi">8</span><span class="w"> </span><span class="n">rows</span><span class="o">)</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">RID</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Name</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Dept</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Alice</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Eng</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">F</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">1</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Bob</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Sales</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">M</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Carol</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Eng</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">F</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Dave</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">HR</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="n">M</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">4</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Eve</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Eng</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">F</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">5</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Frank</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Sales</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">M</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Grace</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">HR</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="n">F</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Hank</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Eng</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">M</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="n">Bitmap</span><span class="w"> </span><span class="n">Index</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">Dept</span><span class="o">:</span>
<span class="w">  </span><span class="n">Eng</span><span class="o">:</span><span class="w">   </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="w">  </span><span class="o">(</span><span class="n">rows</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">7</span><span class="o">)</span>
<span class="w">  </span><span class="n">Sales</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span><span class="w">  </span><span class="o">(</span><span class="n">rows</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="mi">5</span><span class="o">)</span>
<span class="w">  </span><span class="n">HR</span><span class="o">:</span><span class="w">    </span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span><span class="w">  </span><span class="o">(</span><span class="n">rows</span><span class="w"> </span><span class="mi">3</span><span class="o">,</span><span class="mi">6</span><span class="o">)</span>

<span class="n">Bitmap</span><span class="w"> </span><span class="n">Index</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">Gender</span><span class="o">:</span>
<span class="w">  </span><span class="n">F</span><span class="o">:</span><span class="w">     </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span><span class="w">  </span><span class="o">(</span><span class="n">rows</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">6</span><span class="o">)</span>
<span class="w">  </span><span class="n">M</span><span class="o">:</span><span class="w">     </span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="w">  </span><span class="o">(</span><span class="n">rows</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">)</span>
</code></pre></div>

<h3 id="62-bitmap-operations">6.2 Bitmap Operations<a class="header-link" href="#62-bitmap-operations" title="Permanent link">&para;</a></h3>
<p>Queries can be answered by combining bitmaps using <strong>bitwise operations</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">Query</span><span class="o">:</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">female</span><span class="w"> </span><span class="n">engineers</span>

<span class="w">  </span><span class="n">Dept</span><span class="o">=</span><span class="n">Eng</span><span class="o">:</span><span class="w">  </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span>
<span class="w">  </span><span class="n">AND</span>
<span class="w">  </span><span class="n">Gender</span><span class="o">=</span><span class="n">F</span><span class="o">:</span><span class="w">  </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span>
<span class="w">  </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="n">Result</span><span class="o">:</span><span class="w">    </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">2</span><span class="o">,</span><span class="w"> </span><span class="mi">4</span>
<span class="w">                                         </span><span class="o">(</span><span class="n">Alice</span><span class="o">,</span><span class="w"> </span><span class="n">Carol</span><span class="o">,</span><span class="w"> </span><span class="n">Eve</span><span class="o">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">Query</span><span class="o">:</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">HR</span>

<span class="w">  </span><span class="n">Dept</span><span class="o">=</span><span class="n">Sales</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span>
<span class="w">  </span><span class="n">OR</span>
<span class="w">  </span><span class="n">Dept</span><span class="o">=</span><span class="n">HR</span><span class="o">:</span><span class="w">    </span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span>
<span class="w">  </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="n">Result</span><span class="o">:</span><span class="w">     </span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">3</span><span class="o">,</span><span class="w"> </span><span class="mi">5</span><span class="o">,</span><span class="w"> </span><span class="mi">6</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">Query</span><span class="o">:</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">engineers</span>

<span class="w">  </span><span class="n">NOT</span><span class="w"> </span><span class="n">Dept</span><span class="o">=</span><span class="n">Eng</span><span class="o">:</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span>
<span class="w">  </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="n">Result</span><span class="o">:</span><span class="w">           </span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">0</span><span class="o">]</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="mi">1</span><span class="o">,</span><span class="w"> </span><span class="mi">3</span><span class="o">,</span><span class="w"> </span><span class="mi">5</span><span class="o">,</span><span class="w"> </span><span class="mi">6</span>
</code></pre></div>

<h3 id="63-when-to-use-bitmap-indices">6.3 When to Use Bitmap Indices<a class="header-link" href="#63-when-to-use-bitmap-indices" title="Permanent link">&para;</a></h3>
<p><strong>Ideal for:</strong>
- <strong>Low cardinality</strong> attributes (Gender: 2 values, Status: 3-5 values)
- <strong>Data warehousing</strong> with mostly read-only access
- <strong>Complex multi-attribute queries</strong> (AND/OR combinations)
- <strong>Counting queries</strong> (COUNT with WHERE) -- just count set bits
- <strong>Star schema</strong> fact tables with many dimension foreign keys</p>
<p><strong>Not ideal for:</strong>
- <strong>High cardinality</strong> attributes (e.g., unique IDs -- one bitmap per value!)
- <strong>OLTP</strong> with frequent updates (updating a bitmap on every insert is expensive)
- <strong>Highly concurrent</strong> environments (bitmap locks affect many rows)</p>
<h3 id="64-bitmap-compression">6.4 Bitmap Compression<a class="header-link" href="#64-bitmap-compression" title="Permanent link">&para;</a></h3>
<p>For large tables, bitmaps can become very large. Compression techniques help:</p>
<p><strong>Run-Length Encoding (RLE):</strong></p>
<div class="highlight"><pre><span></span><code>Original:  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0]
RLE:       (0, 11), (1, 1), (0, 4)    â†’ &quot;11 zeros, 1 one, 4 zeros&quot;
</code></pre></div>

<p><strong>Word-Aligned Hybrid (WAH):</strong>
Used in Oracle and other systems. Compresses sequences of identical words (32 or 64 bits) while still allowing efficient bitwise operations on the compressed form.</p>
<p><strong>Roaring Bitmaps:</strong>
A modern compression technique that partitions the bitmap into chunks and uses the optimal representation (array, bitmap, or run) for each chunk. Widely used in Apache Lucene, Apache Spark, and other systems.</p>
<h3 id="65-space-analysis">6.5 Space Analysis<a class="header-link" href="#65-space-analysis" title="Permanent link">&para;</a></h3>
<p>For a table with <code>n</code> rows and an attribute with <code>c</code> distinct values:</p>
<div class="highlight"><pre><span></span><code>Uncompressed bitmap size = n Ã— c bits = nc/8 bytes

Compared to B+Tree:
B+Tree index size â‰ˆ n Ã— (key_size + pointer_size) bytes
</code></pre></div>

<p><strong>Example</strong>: 1 million rows, attribute with 5 values:
- Bitmap: 1,000,000 x 5 / 8 = 625,000 bytes â‰ˆ 610 KB
- B+Tree: 1,000,000 x (8 + 8) = 16,000,000 bytes â‰ˆ 15.3 MB</p>
<p>Bitmap is <strong>25x smaller</strong> for low-cardinality attributes.</p>
<hr />
<h2 id="7-multi-dimensional-indexing">7. Multi-Dimensional Indexing<a class="header-link" href="#7-multi-dimensional-indexing" title="Permanent link">&para;</a></h2>
<h3 id="71-the-problem">7.1 The Problem<a class="header-link" href="#71-the-problem" title="Permanent link">&para;</a></h3>
<p>Standard B+Trees and hash indices work well for <strong>one-dimensional</strong> search keys. But many queries involve <strong>multiple dimensions</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Spatial query</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">restaurants</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">latitude</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">37</span><span class="p">.</span><span class="mi">7</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">37</span><span class="p">.</span><span class="mi">8</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">longitude</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">-</span><span class="mi">122</span><span class="p">.</span><span class="mi">5</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">-</span><span class="mi">122</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>

<span class="c1">-- Multi-attribute range query</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">50</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</code></pre></div>

<p>A B+Tree on <code>(latitude, longitude)</code> can efficiently filter on <code>latitude</code> but then must scan all matching entries for <code>longitude</code>. True multi-dimensional indices address both dimensions simultaneously.</p>
<h3 id="72-r-tree">7.2 R-Tree<a class="header-link" href="#72-r-tree" title="Permanent link">&para;</a></h3>
<p>The <strong>R-Tree</strong> (Rectangle Tree) is the most widely used spatial index. It organizes data using <strong>minimum bounding rectangles (MBRs)</strong>.</p>
<div class="highlight"><pre><span></span><code>R-Tree Structure:

Root: [MBRâ‚, MBRâ‚‚]
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
       â”‚   â”‚   MBRâ‚    â”‚    â”‚    MBRâ‚‚      â”‚  â”‚
       â”‚   â”‚ â”Œâ”€â”€â” â”Œâ”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”  â”‚  â”‚
       â”‚   â”‚ â”‚P1â”‚ â”‚P2â”‚ â”‚    â”‚ â”‚P3 â”‚  â”‚P4â”‚  â”‚  â”‚
       â”‚   â”‚ â””â”€â”€â”˜ â””â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”˜  â””â”€â”€â”˜  â”‚  â”‚
       â”‚   â”‚      â”Œâ”€â”€â” â”‚    â”‚     â”Œâ”€â”€â”     â”‚  â”‚
       â”‚   â”‚      â”‚P5â”‚ â”‚    â”‚     â”‚P6â”‚     â”‚  â”‚
       â”‚   â”‚      â””â”€â”€â”˜ â”‚    â”‚     â””â”€â”€â”˜     â”‚  â”‚
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each internal node: [MBRâ‚, ptrâ‚, MBRâ‚‚, ptrâ‚‚, ...]
Each leaf node: [MBRâ‚, oidâ‚, MBRâ‚‚, oidâ‚‚, ...]
</code></pre></div>

<p><strong>Properties:</strong>
- Balanced tree (all leaves at the same level)
- Each node contains between <code>âŒˆm/2âŒ‰</code> and <code>m</code> entries
- MBRs at a given level may overlap
- Search may need to follow multiple paths (unlike B+Tree)</p>
<p><strong>Operations:</strong>
- <strong>Search</strong>: Start at root, descend into all children whose MBR overlaps the query rectangle
- <strong>Insert</strong>: Choose the subtree whose MBR needs the least enlargement; split if necessary
- <strong>Used in</strong>: PostgreSQL (GiST indices), Oracle Spatial, PostGIS</p>
<h3 id="73-kd-tree">7.3 kd-Tree<a class="header-link" href="#73-kd-tree" title="Permanent link">&para;</a></h3>
<p>The <strong>kd-tree</strong> (k-dimensional tree) partitions space by alternating splitting dimensions at each level.</p>
<div class="highlight"><pre><span></span><code><span class="mf">2</span><span class="n">D</span><span class="w"> </span><span class="n">kd</span><span class="o">-</span><span class="n">tree</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="p">(</span><span class="n">splitting</span><span class="w"> </span><span class="kr">on</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mf">...</span><span class="p">):</span>

<span class="kd">Data</span><span class="w"> </span><span class="n">points</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">4</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mf">9</span><span class="p">,</span><span class="mf">6</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="mf">7</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mf">8</span><span class="p">,</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mf">7</span><span class="p">,</span><span class="mf">2</span><span class="p">)</span>

<span class="w">                    </span><span class="p">(</span><span class="mf">7</span><span class="p">,</span><span class="mf">2</span><span class="p">)</span><span class="w">          </span><span class="n">Split</span><span class="w"> </span><span class="kr">on</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mf">7</span>
<span class="w">                   </span><span class="o">/</span><span class="w">     </span><span class="err">\</span>
<span class="w">              </span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">4</span><span class="p">)</span><span class="w">       </span><span class="p">(</span><span class="mf">9</span><span class="p">,</span><span class="mf">6</span><span class="p">)</span><span class="w">    </span><span class="n">Split</span><span class="w"> </span><span class="kr">on</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mf">6</span>
<span class="w">             </span><span class="o">/</span><span class="w">    </span><span class="err">\</span><span class="w">          </span><span class="err">\</span>
<span class="w">          </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">)</span><span class="w">  </span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="mf">7</span><span class="p">)</span><span class="w">      </span><span class="p">(</span><span class="mf">8</span><span class="p">,</span><span class="mf">1</span><span class="p">)</span><span class="w">  </span><span class="n">Split</span><span class="w"> </span><span class="kr">on</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mf">8</span>

<span class="n">Spatial</span><span class="w"> </span><span class="n">partitioning</span><span class="p">:</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="mf">9</span><span class="p">,</span><span class="mf">6</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">Â·</span><span class="w">      </span><span class="err">â”‚</span><span class="w">     </span><span class="err">Â·</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚â”€â”€â”€â”€â”€â”€â”€</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">4</span><span class="p">)</span><span class="err">â”€â”€â”€â”€â”€â”€</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">Â·</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="mf">7</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="mf">8</span><span class="p">,</span><span class="mf">1</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">Â·</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">        </span><span class="n">x</span><span class="o">=</span><span class="mf">7</span><span class="w">    </span><span class="p">(</span><span class="n">split</span><span class="w"> </span><span class="n">line</span><span class="p">)</span>
</code></pre></div>

<p><strong>Properties:</strong>
- Binary tree (each node splits space in half)
- Efficient for low-dimensional data (d â‰¤ 20)
- Search: O(n^(1-1/d) + k) where k is the number of results
- Not balanced for dynamic data (use variants like k-d-B tree)</p>
<p><strong>Comparison of spatial indices:</strong></p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>R-Tree</th>
<th>kd-Tree</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dimensions</td>
<td>Works for any d</td>
<td>Best for low d</td>
</tr>
<tr>
<td>Dynamic updates</td>
<td>Good (designed for it)</td>
<td>Poor (may unbalance)</td>
</tr>
<tr>
<td>Disk-based</td>
<td>Yes (designed for it)</td>
<td>Originally in-memory</td>
</tr>
<tr>
<td>Overlap</td>
<td>Allows overlap</td>
<td>No overlap</td>
</tr>
<tr>
<td>Use case</td>
<td>GIS, spatial databases</td>
<td>k-NN search, in-memory</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="8-index-selection-and-design-guidelines">8. Index Selection and Design Guidelines<a class="header-link" href="#8-index-selection-and-design-guidelines" title="Permanent link">&para;</a></h2>
<h3 id="81-index-selection-problem">8.1 Index Selection Problem<a class="header-link" href="#81-index-selection-problem" title="Permanent link">&para;</a></h3>
<p>Choosing the right indices is critical for performance. The <strong>index selection problem</strong> asks: given a workload (set of queries), which indices should be created?</p>
<p><strong>Factors to consider:</strong>
1. <strong>Query patterns</strong>: Which columns appear in WHERE, JOIN, ORDER BY, GROUP BY?
2. <strong>Update frequency</strong>: How often are INSERT, UPDATE, DELETE executed?
3. <strong>Data distribution</strong>: Cardinality and selectivity of each column
4. <strong>Storage budget</strong>: Each index costs disk space and maintenance overhead
5. <strong>Correlation</strong>: Columns that are frequently queried together</p>
<h3 id="82-covering-index">8.2 Covering Index<a class="header-link" href="#82-covering-index" title="Permanent link">&para;</a></h3>
<p>A <strong>covering index</strong> includes all columns needed by a query, so the database can answer the query from the index alone without accessing the table (<strong>index-only scan</strong>).</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Query:</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="p">;</span>

<span class="c1">-- Non-covering index (requires table access):</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_dept</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">department</span><span class="p">);</span>
<span class="c1">-- Finds matching rows via index, then fetches name, salary from table</span>

<span class="c1">-- Covering index (no table access needed):</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_dept_covering</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">department</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="p">);</span>
<span class="c1">-- All needed columns are in the index</span>
</code></pre></div>

<p><strong>PostgreSQL INCLUDE syntax:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- INCLUDE columns are stored in the leaf level but not in the search key</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_dept_incl</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">department</span><span class="p">)</span><span class="w"> </span><span class="n">INCLUDE</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="p">);</span>
<span class="c1">-- department is the search key; name and salary are payload only</span>
</code></pre></div>

<p><strong>Benefits:</strong>
- Eliminates table access (huge I/O savings)
- Particularly effective for frequently-run queries</p>
<p><strong>Trade-offs:</strong>
- Larger index size
- More columns to maintain on updates</p>
<h3 id="83-composite-multi-column-index">8.3 Composite (Multi-Column) Index<a class="header-link" href="#83-composite-multi-column-index" title="Permanent link">&para;</a></h3>
<p>A <strong>composite index</strong> is built on multiple columns. The column order matters significantly.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_dept_salary</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">department</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="p">);</span>
</code></pre></div>

<p>This index is useful for:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Uses full index (both columns):</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">80000</span><span class="p">;</span>

<span class="c1">-- Uses index prefix (department only):</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="p">;</span>

<span class="c1">-- Does NOT use this index efficiently:</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">80000</span><span class="p">;</span><span class="w">  </span><span class="c1">-- salary is not a prefix</span>
</code></pre></div>

<p><strong>Leftmost prefix rule</strong>: A composite index on <code>(A, B, C)</code> can be used for queries on:
- <code>A</code>
- <code>A, B</code>
- <code>A, B, C</code></p>
<p>But NOT efficiently for:
- <code>B</code> alone
- <code>C</code> alone
- <code>B, C</code></p>
<h3 id="84-partial-index">8.4 Partial Index<a class="header-link" href="#84-partial-index" title="Permanent link">&para;</a></h3>
<p>A <strong>partial index</strong> indexes only a subset of rows, defined by a predicate.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Index only active employees (if 90% are inactive, index is much smaller)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_active_emp</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">;</span>

<span class="c1">-- Index only recent orders</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_recent_orders</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">;</span>

<span class="c1">-- Index only non-null values</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</code></pre></div>

<p><strong>Benefits:</strong>
- Smaller index size (fewer entries)
- Faster to maintain (fewer updates)
- Better cache utilization</p>
<h3 id="85-expression-index">8.5 Expression Index<a class="header-link" href="#85-expression-index" title="Permanent link">&para;</a></h3>
<p>Some databases support indexing computed expressions:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- PostgreSQL: index on expression</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_lower_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="k">lower</span><span class="p">(</span><span class="n">email</span><span class="p">));</span>

<span class="c1">-- Useful for case-insensitive searches:</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">lower</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;alice@example.com&#39;</span><span class="p">;</span>

<span class="c1">-- Index on year extracted from timestamp:</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_order_year</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">(</span><span class="k">EXTRACT</span><span class="p">(</span><span class="k">YEAR</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">order_date</span><span class="p">));</span>
</code></pre></div>

<h3 id="86-practical-guidelines">8.6 Practical Guidelines<a class="header-link" href="#86-practical-guidelines" title="Permanent link">&para;</a></h3>
<p><strong>Rule 1: Index columns in WHERE, JOIN, ORDER BY</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- This query benefits from indices on customer_id, order_date, status</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
</code></pre></div>

<p><strong>Rule 2: Consider selectivity</strong>
- High selectivity (few matching rows) = good index candidate
- Low selectivity (most rows match) = poor index candidate
- Rule of thumb: Index is useful if it selects &lt; 15-20% of rows</p>
<p><strong>Rule 3: Avoid over-indexing</strong></p>
<div class="highlight"><pre><span></span><code>Each index costs:
- Disk space (size of the index structure)
- Insert overhead: ~1 B+Tree insert per index
- Update overhead: delete old + insert new per index
- Vacuum/maintenance overhead

Typical guideline: 3-5 indices per table, rarely more than 10
</code></pre></div>

<p><strong>Rule 4: Use EXPLAIN to verify index usage</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">ANALYZE</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="p">;</span>

<span class="c1">-- Look for:</span>
<span class="c1">-- &quot;Index Scan&quot; or &quot;Index Only Scan&quot; â†’ index is being used</span>
<span class="c1">-- &quot;Seq Scan&quot; â†’ index is NOT being used (or doesn&#39;t exist)</span>
<span class="c1">-- &quot;Bitmap Index Scan&quot; â†’ bitmap index used for multi-condition queries</span>
</code></pre></div>

<p><strong>Rule 5: Monitor and maintain indices</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1">-- PostgreSQL: check index usage statistics</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">schemaname</span><span class="p">,</span><span class="w"> </span><span class="n">tablename</span><span class="p">,</span><span class="w"> </span><span class="n">indexname</span><span class="p">,</span><span class="w"> </span><span class="n">idx_scan</span><span class="p">,</span><span class="w"> </span><span class="n">idx_tup_read</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_user_indexes</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">idx_scan</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
<span class="c1">-- Indices with idx_scan = 0 are unused and can be dropped</span>

<span class="c1">-- Check index size</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_relation_size</span><span class="p">(</span><span class="s1">&#39;idx_emp_salary&#39;</span><span class="p">));</span>

<span class="c1">-- Rebuild fragmented indices</span>
<span class="k">REINDEX</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_emp_salary</span><span class="p">;</span>
</code></pre></div>

<hr />
<h2 id="9-index-structures-in-major-databases">9. Index Structures in Major Databases<a class="header-link" href="#9-index-structures-in-major-databases" title="Permanent link">&para;</a></h2>
<h3 id="postgresql">PostgreSQL<a class="header-link" href="#postgresql" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- B+Tree (default)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_btree</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">table</span><span class="p">(</span><span class="k">column</span><span class="p">);</span>

<span class="c1">-- Hash (equality only, WAL-logged since v10)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_hash</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">hash</span><span class="p">(</span><span class="k">column</span><span class="p">);</span>

<span class="c1">-- GiST (Generalized Search Tree -- R-Tree, full-text, etc.)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_gist</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">gist</span><span class="p">(</span><span class="n">geom_column</span><span class="p">);</span>

<span class="c1">-- GIN (Generalized Inverted Index -- arrays, JSONB, full-text)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_gin</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">gin</span><span class="p">(</span><span class="n">jsonb_column</span><span class="p">);</span>

<span class="c1">-- BRIN (Block Range Index -- large sorted tables)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_brin</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">brin</span><span class="p">(</span><span class="n">timestamp_column</span><span class="p">);</span>

<span class="c1">-- SP-GiST (Space-Partitioned GiST -- kd-tree, radix tree)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_spgist</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">spgist</span><span class="p">(</span><span class="n">point_column</span><span class="p">);</span>
</code></pre></div>

<h3 id="mysql-innodb">MySQL InnoDB<a class="header-link" href="#mysql-innodb" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>- Primary key = clustered B+Tree index (data stored in leaf nodes)
- Secondary indices store the primary key value (not a row pointer)
- This means secondary index lookup requires two B+Tree traversals:
  1. Secondary index â†’ primary key value
  2. Primary index â†’ actual row data
</code></pre></div>

<h3 id="summary-table">Summary Table<a class="header-link" href="#summary-table" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Index Type</th>
<th>Best For</th>
<th>Limitation</th>
</tr>
</thead>
<tbody>
<tr>
<td>B+Tree</td>
<td>General purpose, range, ORDER BY</td>
<td>Not great for multi-dimension</td>
</tr>
<tr>
<td>Hash</td>
<td>Exact equality lookup</td>
<td>No range support</td>
</tr>
<tr>
<td>Bitmap</td>
<td>Low cardinality, analytics</td>
<td>Poor for OLTP, high cardinality</td>
</tr>
<tr>
<td>GiST/R-Tree</td>
<td>Spatial, geometric data</td>
<td>Overlap can slow search</td>
</tr>
<tr>
<td>GIN</td>
<td>Full-text, arrays, JSONB</td>
<td>Large index, slow updates</td>
</tr>
<tr>
<td>BRIN</td>
<td>Very large, naturally ordered tables</td>
<td>Low precision</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="10-exercises">10. Exercises<a class="header-link" href="#10-exercises" title="Permanent link">&para;</a></h2>
<h3 id="conceptual-questions">Conceptual Questions<a class="header-link" href="#conceptual-questions" title="Permanent link">&para;</a></h3>
<p><strong>Exercise 1</strong>: Explain why a secondary index must be dense (one entry per record) while a primary index can be sparse (one entry per block).</p>
<p><strong>Exercise 2</strong>: A table has 500,000 records stored in blocks of 4 KB each. Each record is 200 bytes. A B+Tree index on the primary key uses 8-byte keys and 8-byte pointers. Each index node is one block (4 KB).</p>
<p>(a) How many records fit in one data block?
(b) How many data blocks does the table occupy?
(c) What is the maximum fan-out (order) of the B+Tree?
(d) What is the maximum height of the B+Tree?
(e) How many disk I/Os are needed for an equality search using the index vs. a full table scan?</p>
<p><strong>Exercise 3</strong>: Compare B-Tree and B+Tree. Why do virtually all database systems use B+Trees instead of B-Trees?</p>
<p><strong>Exercise 4</strong>: A bitmap index is created on a <code>color</code> column with 8 distinct values in a table with 10 million rows.</p>
<p>(a) What is the total uncompressed size of the bitmap index?
(b) If only 0.1% of rows have color = 'purple', how compressible is the purple bitmap using run-length encoding?
(c) Compare this to a B+Tree index on the same column.</p>
<h3 id="practical-questions">Practical Questions<a class="header-link" href="#practical-questions" title="Permanent link">&para;</a></h3>
<p><strong>Exercise 5</strong>: For the following query workload, design an indexing strategy:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Q1 (90% of traffic): exact lookup</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="p">;</span>

<span class="c1">-- Q2 (5% of traffic): range scan with sort</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>

<span class="c1">-- Q3 (3% of traffic): multi-column filter</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">?</span><span class="p">;</span>

<span class="c1">-- Q4 (2% of traffic): text search</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">ILIKE</span><span class="w"> </span><span class="s1">&#39;%smith%&#39;</span><span class="p">;</span>
</code></pre></div>

<p>For each query, specify:
(a) What index (or indices) would you create?
(b) What type of index (B+Tree, hash, GIN, etc.)?
(c) Would you use a composite, covering, or partial index?</p>
<p><strong>Exercise 6</strong>: Given the following extendible hash directory with global depth 2 and bucket capacity 2:</p>
<div class="highlight"><pre><span></span><code><span class="n">Directory</span><span class="o">:</span><span class="w">          </span><span class="n">Buckets</span><span class="o">:</span>
<span class="mi">00</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Bucket</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">[</span><span class="n">h</span><span class="o">=</span><span class="mi">00110</span><span class="o">,</span><span class="w"> </span><span class="n">h</span><span class="o">=</span><span class="mi">00010</span><span class="o">]</span><span class="w">  </span><span class="o">(</span><span class="n">local</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="mi">2</span><span class="o">)</span>
<span class="mi">01</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Bucket</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">[</span><span class="n">h</span><span class="o">=</span><span class="mi">01100</span><span class="o">]</span><span class="w">            </span><span class="o">(</span><span class="n">local</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="mi">2</span><span class="o">)</span>
<span class="mi">10</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Bucket</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">[</span><span class="n">h</span><span class="o">=</span><span class="mi">10001</span><span class="o">,</span><span class="w"> </span><span class="n">h</span><span class="o">=</span><span class="mi">10110</span><span class="o">]</span><span class="w">  </span><span class="o">(</span><span class="n">local</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="mi">2</span><span class="o">)</span>
<span class="mi">11</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Bucket</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">[</span><span class="n">h</span><span class="o">=</span><span class="mi">11000</span><span class="o">]</span><span class="w">            </span><span class="o">(</span><span class="n">local</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="mi">2</span><span class="o">)</span>
</code></pre></div>

<p>Show the state of the directory and buckets after inserting a record with hash value <code>h = 00001</code>.</p>
<p><strong>Exercise 7</strong>: Consider a linear hashing scheme with 4 initial buckets (N=4), split pointer s=0, and bucket capacity 2. The hash functions are hâ‚€(K) = K mod 4 and hâ‚(K) = K mod 8. Starting with:</p>
<div class="highlight"><pre><span></span><code>Bucket 0: [8, 16]   (full)
Bucket 1: [5]
Bucket 2: [10]
Bucket 3: [7, 15]   (full)
</code></pre></div>

<p>Show the state after inserting keys 12, 9, and 3 (one at a time).</p>
<h3 id="analysis-questions">Analysis Questions<a class="header-link" href="#analysis-questions" title="Permanent link">&para;</a></h3>
<p><strong>Exercise 8</strong>: Prove that the height of a B+Tree with order <code>m</code> and <code>n</code> keys is at most <code>âŒˆlog_{âŒˆm/2âŒ‰}(n)âŒ‰</code>.</p>
<p><strong>Exercise 9</strong>: A database administrator notices that a query <code>SELECT COUNT(*) FROM orders WHERE status = 'pending'</code> takes 2 seconds on a table with 50 million rows. The <code>status</code> column has 5 distinct values. Recommend an indexing strategy and estimate the improvement.</p>
<p><strong>Exercise 10</strong>: You have a table <code>sensor_data</code> with 1 billion rows, columns <code>(sensor_id, timestamp, value, location_x, location_y)</code>, and the following query patterns:</p>
<ul>
<li>Time-range queries: <code>WHERE timestamp BETWEEN ? AND ?</code></li>
<li>Sensor-specific queries: <code>WHERE sensor_id = ? AND timestamp BETWEEN ? AND ?</code></li>
<li>Spatial queries: <code>WHERE location_x BETWEEN ? AND ? AND location_y BETWEEN ? AND ?</code></li>
<li>Aggregations: <code>SELECT sensor_id, AVG(value) FROM ... GROUP BY sensor_id</code></li>
</ul>
<p>Design a comprehensive indexing strategy. Consider B+Tree, BRIN, GiST, and composite indices. Justify your choices.</p>
<hr />
<p><strong>Previous</strong>: <a href="./08_Query_Processing.md">Query Processing and Optimization</a> | <strong>Next</strong>: <a href="./10_Transaction_Theory.md">Transaction Theory</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/08_Query_Processing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Lesson 08: Query Processing</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/10_Transaction_Theory.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">10. Transaction Theory</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}