{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10. Transaction Theory - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Database_Theory/">Database Theory</a>
    <span class="separator">/</span>
    <span class="current">10. Transaction Theory</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>10. Transaction Theory</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/09_Indexing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">09. Indexing</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/11_Concurrency_Control.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">11. Concurrency Control</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-transaction-concept">1. Transaction Concept</a><ul>
<li><a href="#what-is-a-transaction">What is a Transaction?</a></li>
<li><a href="#why-transactions-matter">Why Transactions Matter</a></li>
</ul>
</li>
<li><a href="#2-acid-properties">2. ACID Properties</a><ul>
<li><a href="#21-atomicity-all-or-nothing">2.1 Atomicity (All or Nothing)</a></li>
<li><a href="#22-consistency">2.2 Consistency</a></li>
<li><a href="#23-isolation">2.3 Isolation</a></li>
<li><a href="#24-durability">2.4 Durability</a></li>
<li><a href="#acid-summary">ACID Summary</a></li>
</ul>
</li>
<li><a href="#3-transaction-states">3. Transaction States</a><ul>
<li><a href="#state-descriptions">State Descriptions</a></li>
<li><a href="#after-abort-restart-or-kill">After Abort: Restart or Kill?</a></li>
</ul>
</li>
<li><a href="#4-schedules">4. Schedules</a><ul>
<li><a href="#41-what-is-a-schedule">4.1 What is a Schedule?</a></li>
<li><a href="#42-serial-schedule">4.2 Serial Schedule</a></li>
<li><a href="#43-serializable-schedule">4.3 Serializable Schedule</a></li>
</ul>
</li>
<li><a href="#5-conflict-serializability">5. Conflict Serializability</a><ul>
<li><a href="#51-conflicting-operations">5.1 Conflicting Operations</a></li>
<li><a href="#52-conflict-equivalence">5.2 Conflict Equivalence</a></li>
<li><a href="#53-conflict-serializable">5.3 Conflict Serializable</a></li>
<li><a href="#54-precedence-graph-serialization-graph">5.4 Precedence Graph (Serialization Graph)</a></li>
<li><a href="#55-topological-sort-for-serial-order">5.5 Topological Sort for Serial Order</a></li>
</ul>
</li>
<li><a href="#6-view-serializability">6. View Serializability</a><ul>
<li><a href="#61-definition">6.1 Definition</a></li>
<li><a href="#62-conflict-vs-view-serializability">6.2 Conflict vs. View Serializability</a></li>
<li><a href="#63-blind-writes">6.3 Blind Writes</a></li>
</ul>
</li>
<li><a href="#7-recoverability">7. Recoverability</a><ul>
<li><a href="#71-recoverable-schedules">7.1 Recoverable Schedules</a></li>
<li><a href="#72-cascadeless-schedules-avoiding-cascading-rollbacks">7.2 Cascadeless Schedules (Avoiding Cascading Rollbacks)</a></li>
<li><a href="#73-strict-schedules">7.3 Strict Schedules</a></li>
<li><a href="#74-hierarchy-of-schedule-properties">7.4 Hierarchy of Schedule Properties</a></li>
</ul>
</li>
<li><a href="#8-isolation-levels">8. Isolation Levels</a><ul>
<li><a href="#81-motivation">8.1 Motivation</a></li>
<li><a href="#82-anomalies-phenomena">8.2 Anomalies (Phenomena)</a></li>
<li><a href="#83-sql-isolation-levels">8.3 SQL Isolation Levels</a></li>
<li><a href="#84-read-uncommitted">8.4 Read Uncommitted</a></li>
<li><a href="#85-read-committed">8.5 Read Committed</a></li>
<li><a href="#86-repeatable-read">8.6 Repeatable Read</a></li>
<li><a href="#87-serializable">8.7 Serializable</a></li>
</ul>
</li>
<li><a href="#9-the-phantom-problem">9. The Phantom Problem</a><ul>
<li><a href="#91-why-phantoms-are-special">9.1 Why Phantoms Are Special</a></li>
<li><a href="#92-solutions-to-the-phantom-problem">9.2 Solutions to the Phantom Problem</a></li>
</ul>
</li>
<li><a href="#10-snapshot-isolation">10. Snapshot Isolation</a><ul>
<li><a href="#101-concept">10.1 Concept</a></li>
<li><a href="#102-first-committer-wins-rule">10.2 First-Committer-Wins Rule</a></li>
<li><a href="#103-snapshot-isolation-vs-serializability">10.3 Snapshot Isolation vs. Serializability</a></li>
<li><a href="#104-serializable-snapshot-isolation-ssi">10.4 Serializable Snapshot Isolation (SSI)</a></li>
<li><a href="#105-si-in-practice">10.5 SI in Practice</a></li>
</ul>
</li>
<li><a href="#11-testing-for-serializability-complete-algorithm">11. Testing for Serializability: Complete Algorithm</a><ul>
<li><a href="#step-by-step-algorithm">Step-by-Step Algorithm</a></li>
<li><a href="#detailed-example">Detailed Example</a></li>
</ul>
</li>
<li><a href="#12-exercises">12. Exercises</a><ul>
<li><a href="#conceptual-questions">Conceptual Questions</a></li>
<li><a href="#serializability-analysis">Serializability Analysis</a></li>
<li><a href="#isolation-levels">Isolation Levels</a></li>
<li><a href="#advanced-questions">Advanced Questions</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="10-transaction-theory">10. Transaction Theory<a class="header-link" href="#10-transaction-theory" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./09_Indexing.md">Indexing</a> | <strong>Next</strong>: <a href="./11_Concurrency_Control.md">Concurrency Control</a></p>
<hr />
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand the transaction concept and ACID properties in depth</li>
<li>Trace through transaction state transitions</li>
<li>Analyze schedules for conflict serializability using precedence graphs</li>
<li>Distinguish recoverable, cascadeless, and strict schedules</li>
<li>Understand SQL isolation levels and the anomalies they permit</li>
<li>Reason about snapshot isolation and its trade-offs</li>
</ul>
<hr />
<h2 id="1-transaction-concept">1. Transaction Concept<a class="header-link" href="#1-transaction-concept" title="Permanent link">&para;</a></h2>
<h3 id="what-is-a-transaction">What is a Transaction?<a class="header-link" href="#what-is-a-transaction" title="Permanent link">&para;</a></h3>
<p>A <strong>transaction</strong> is a logical unit of work that accesses and possibly modifies the contents of a database. It comprises a sequence of operations (reads and writes) that must be treated as an <strong>indivisible</strong> unit.</p>
<p><strong>Real-world analogy</strong>: A bank transfer from account A to account B:</p>
<div class="highlight"><pre><span></span><code>Transaction T: Transfer $100 from A to B

    read(A)           // A = 1000
    A = A - 100       // A = 900
    write(A)
    read(B)           // B = 500
    B = B + 100       // B = 600
    write(B)
    commit
</code></pre></div>

<p>If the system crashes between <code>write(A)</code> and <code>write(B)</code>, the money would vanish -- $100 deducted from A but never credited to B. Transactions prevent this.</p>
<h3 id="why-transactions-matter">Why Transactions Matter<a class="header-link" href="#why-transactions-matter" title="Permanent link">&para;</a></h3>
<p>Transactions provide two critical guarantees:</p>
<ol>
<li><strong>Failure atomicity</strong>: If a failure occurs during execution, all partial effects are undone</li>
<li><strong>Isolation</strong>: Concurrent transactions do not interfere with each other</li>
</ol>
<p>Without transactions, a database cannot ensure <strong>data consistency</strong> in the presence of failures and concurrent access.</p>
<hr />
<h2 id="2-acid-properties">2. ACID Properties<a class="header-link" href="#2-acid-properties" title="Permanent link">&para;</a></h2>
<p>The ACID properties are the four fundamental guarantees that a transaction processing system must provide.</p>
<h3 id="21-atomicity-all-or-nothing">2.1 Atomicity (All or Nothing)<a class="header-link" href="#21-atomicity-all-or-nothing" title="Permanent link">&para;</a></h3>
<p>A transaction is an <strong>atomic</strong> unit: either all of its operations are reflected in the database, or none are.</p>
<div class="highlight"><pre><span></span><code><span class="nv">Transaction</span><span class="w"> </span><span class="nv">T</span>:<span class="w"> </span><span class="nv">Transfer</span><span class="w"> </span><span class="mh">$100</span>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="nv">read</span><span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w">             </span>â”‚
â”‚<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="w">         </span>â”‚
â”‚<span class="w"> </span><span class="nv">write</span><span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w">            </span>â”‚
â”‚<span class="w"> </span>â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">crash</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€<span class="w"> </span>â”‚<span class="w"> </span>â†<span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">crash</span><span class="w"> </span><span class="nv">here</span>,<span class="w"> </span><span class="nv">undo</span><span class="w"> </span><span class="nv">write</span><span class="ss">(</span><span class="nv">A</span><span class="ss">)</span>
â”‚<span class="w"> </span><span class="nv">read</span><span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w">             </span>â”‚
â”‚<span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span><span class="w">         </span>â”‚
â”‚<span class="w"> </span><span class="nv">write</span><span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w">            </span>â”‚
â”‚<span class="w"> </span><span class="nv">commit</span><span class="w">              </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Either</span><span class="w"> </span><span class="nv">BOTH</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">persist</span>,<span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">NEITHER</span><span class="w"> </span><span class="nv">does</span>.
</code></pre></div>

<p><strong>Implementation</strong>: The recovery subsystem uses <strong>logs</strong> to undo incomplete transactions and redo committed ones (covered in Lesson 12).</p>
<h3 id="22-consistency">2.2 Consistency<a class="header-link" href="#22-consistency" title="Permanent link">&para;</a></h3>
<p>A transaction must transform the database from one <strong>consistent state</strong> to another. Consistency is defined by:</p>
<ul>
<li><strong>Integrity constraints</strong>: Primary keys, foreign keys, CHECK constraints, NOT NULL</li>
<li><strong>Application-level invariants</strong>: e.g., total money in the bank must be constant</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">Consistent</span><span class="w"> </span><span class="n">State</span><span class="p">:</span>
<span class="w">  </span><span class="n">Account</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">Account</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span>
<span class="w">  </span><span class="n">Invariant</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span>

<span class="n">During</span><span class="w"> </span><span class="n">Transaction</span><span class="p">:</span>
<span class="w">  </span><span class="n">After</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">A</span><span class="p">):</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1400</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="n">INCONSISTENT</span>
<span class="w">  </span><span class="n">After</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">B</span><span class="p">):</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="n">CONSISTENT</span><span class="w"> </span><span class="n">again</span>

<span class="n">The</span><span class="w"> </span><span class="n">intermediate</span><span class="w"> </span><span class="n">inconsistency</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">acceptable</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">visible</span>
<span class="n">to</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="p">(</span><span class="n">ensured</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">Isolation</span><span class="p">)</span><span class="o">.</span>
</code></pre></div>

<p><strong>Responsibility</strong>: Consistency is a shared responsibility:
- The <strong>DBMS</strong> enforces declared integrity constraints
- The <strong>application</strong> (programmer) must ensure transaction logic preserves application-level invariants</p>
<h3 id="23-isolation">2.3 Isolation<a class="header-link" href="#23-isolation" title="Permanent link">&para;</a></h3>
<p>Each transaction must execute as if it were the <strong>only</strong> transaction in the system. Concurrent transactions must not see each other's intermediate states.</p>
<div class="highlight"><pre><span></span><code><span class="nv">Without</span><span class="w"> </span><span class="nv">Isolation</span>:

<span class="nv">T1</span>:<span class="w"> </span><span class="nv">read</span><span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="o">=</span><span class="mi">1000</span>,<span class="w"> </span><span class="nv">A</span><span class="o">=</span><span class="mi">900</span>,<span class="w"> </span><span class="nv">write</span><span class="ss">(</span><span class="nv">A</span><span class="ss">)</span>
<span class="w">                                    </span><span class="nv">T2</span>:<span class="w"> </span><span class="nv">read</span><span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="o">=</span><span class="mi">900</span><span class="w"> </span>â†<span class="w"> </span><span class="nv">sees</span><span class="w"> </span><span class="nv">partial</span><span class="w"> </span><span class="nb">result</span><span class="o">!</span>
<span class="nv">T1</span>:<span class="w"> </span><span class="nv">read</span><span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="o">=</span><span class="mi">500</span>,<span class="w"> </span><span class="nv">B</span><span class="o">=</span><span class="mi">600</span>,<span class="w"> </span><span class="nv">write</span><span class="ss">(</span><span class="nv">B</span><span class="ss">)</span>
<span class="nv">T1</span>:<span class="w"> </span><span class="nv">commit</span>
<span class="w">                                    </span><span class="nv">T2</span>:<span class="w"> </span><span class="nv">read</span><span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="o">=</span><span class="mi">600</span>
<span class="w">                                    </span><span class="nv">T2</span>:<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">900</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">600</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span>â†<span class="w"> </span><span class="nv">correct</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">luck</span>

<span class="nv">But</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">T2</span><span class="w"> </span><span class="nv">had</span><span class="w"> </span><span class="nv">read</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">before</span><span class="w"> </span><span class="nv">T1</span><span class="w"> </span><span class="nv">wrote</span><span class="w"> </span><span class="nv">it</span>:
<span class="w">                                    </span><span class="nv">T2</span>:<span class="w"> </span><span class="nv">read</span><span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="o">=</span><span class="mi">500</span>
<span class="w">                                    </span><span class="nv">T2</span>:<span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">900</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1400</span><span class="w"> </span>â†<span class="w"> </span><span class="nv">WRONG</span><span class="o">!</span>
</code></pre></div>

<p><strong>Implementation</strong>: The concurrency control subsystem uses locks, timestamps, or MVCC (covered in Lesson 11).</p>
<h3 id="24-durability">2.4 Durability<a class="header-link" href="#24-durability" title="Permanent link">&para;</a></h3>
<p>Once a transaction has <strong>committed</strong>, its effects must persist even if the system crashes immediately afterward.</p>
<div class="highlight"><pre><span></span><code><span class="n">T</span><span class="o">:</span><span class="w"> </span><span class="n">write</span><span class="o">(</span><span class="n">A</span><span class="o">),</span><span class="w"> </span><span class="n">write</span><span class="o">(</span><span class="n">B</span><span class="o">),</span><span class="w"> </span><span class="n">commit</span>
<span class="w">                                    </span><span class="err">â†</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="n">here</span>

<span class="n">After</span><span class="w"> </span><span class="n">recovery</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">900</span><span class="o">,</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="w">   </span><span class="err">â†</span><span class="w"> </span><span class="n">Committed</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="n">survive</span>
</code></pre></div>

<p><strong>Implementation</strong>: The recovery subsystem uses <strong>Write-Ahead Logging (WAL)</strong> and <strong>checkpoints</strong> to ensure committed data survives crashes (covered in Lesson 12).</p>
<h3 id="acid-summary">ACID Summary<a class="header-link" href="#acid-summary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Guarantee</th>
<th>Implemented By</th>
</tr>
</thead>
<tbody>
<tr>
<td>Atomicity</td>
<td>All or nothing</td>
<td>Recovery system (undo)</td>
</tr>
<tr>
<td>Consistency</td>
<td>Valid state to valid state</td>
<td>DBMS constraints + app logic</td>
</tr>
<tr>
<td>Isolation</td>
<td>No interference between concurrent txns</td>
<td>Concurrency control</td>
</tr>
<tr>
<td>Durability</td>
<td>Committed data survives crashes</td>
<td>Recovery system (redo) + WAL</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-transaction-states">3. Transaction States<a class="header-link" href="#3-transaction-states" title="Permanent link">&para;</a></h2>
<p>A transaction goes through a well-defined set of states during its lifecycle:</p>
<div class="highlight"><pre><span></span><code>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     begin          â”‚          â”‚
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚  Active  â”‚
                    â”‚          â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚
                    last statement
                    executed
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Partially    â”‚
                â”‚   Committed    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                   â”‚         â”‚
              output has    failure
              been written  detected
              to disk
                   â”‚         â”‚
                   â–¼         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Committed â”‚  â”‚ Failed â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                               â”‚
                          rollback
                          complete
                               â”‚
                               â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Aborted â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="state-descriptions">State Descriptions<a class="header-link" href="#state-descriptions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>State</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Active</strong></td>
<td>The initial state. The transaction stays in this state while executing read/write operations.</td>
</tr>
<tr>
<td><strong>Partially Committed</strong></td>
<td>After the last statement has been executed. The transaction's effects may still be in volatile memory (buffer).</td>
</tr>
<tr>
<td><strong>Committed</strong></td>
<td>After all changes have been successfully written to stable storage. The transaction is complete and its effects are permanent.</td>
</tr>
<tr>
<td><strong>Failed</strong></td>
<td>After discovery that normal execution can no longer proceed (e.g., constraint violation, deadlock, system error).</td>
</tr>
<tr>
<td><strong>Aborted</strong></td>
<td>After the transaction has been rolled back and the database is restored to the state before the transaction began.</td>
</tr>
</tbody>
</table>
<h3 id="after-abort-restart-or-kill">After Abort: Restart or Kill?<a class="header-link" href="#after-abort-restart-or-kill" title="Permanent link">&para;</a></h3>
<p>When a transaction aborts, the system has two options:</p>
<ol>
<li><strong>Restart</strong>: Re-execute the transaction (appropriate for transient failures like deadlocks)</li>
<li><strong>Kill</strong>: Terminate the transaction entirely (appropriate for logical errors, constraint violations)</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">-- Transaction that might be restarted after deadlock:</span>
<span class="k">BEGIN</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="c1">-- If deadlock detected â†’ abort â†’ restart automatically</span>

<span class="c1">-- Transaction that should be killed:</span>
<span class="k">BEGIN</span><span class="p">;</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;duplicate@email.com&#39;</span><span class="p">);</span>
<span class="c1">-- If unique constraint violation â†’ abort â†’ do NOT restart</span>
</code></pre></div>

<hr />
<h2 id="4-schedules">4. Schedules<a class="header-link" href="#4-schedules" title="Permanent link">&para;</a></h2>
<h3 id="41-what-is-a-schedule">4.1 What is a Schedule?<a class="header-link" href="#41-what-is-a-schedule" title="Permanent link">&para;</a></h3>
<p>A <strong>schedule</strong> (or <strong>history</strong>) represents the chronological order in which instructions of concurrent transactions are executed. A schedule must preserve the <strong>internal ordering</strong> of each transaction.</p>
<p><strong>Notation</strong>: We focus on read and write operations:
- <code>r_i(X)</code> = Transaction <code>T_i</code> reads data item <code>X</code>
- <code>w_i(X)</code> = Transaction <code>T_i</code> writes data item <code>X</code>
- <code>c_i</code> = Transaction <code>T_i</code> commits
- <code>a_i</code> = Transaction <code>T_i</code> aborts</p>
<h3 id="42-serial-schedule">4.2 Serial Schedule<a class="header-link" href="#42-serial-schedule" title="Permanent link">&para;</a></h3>
<p>A <strong>serial schedule</strong> executes transactions one after another, with no interleaving:</p>
<div class="highlight"><pre><span></span><code><span class="nv">Serial</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="nv">S1</span><span class="w"> </span><span class="ss">(</span><span class="nv">T1</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">T2</span><span class="ss">)</span>:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="nv">T1</span>:<span class="w"> </span><span class="nv">r</span>â‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">r</span>â‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span><span class="nv">c</span>â‚<span class="w">   </span>â”‚
â”‚<span class="w">                                     </span>â”‚
â”‚<span class="w">         </span><span class="nv">T2</span>:<span class="w"> </span><span class="nv">r</span>â‚‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">r</span>â‚‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span><span class="nv">c</span>â‚‚<span class="w"> </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Serial</span><span class="w"> </span><span class="nv">Schedule</span><span class="w"> </span><span class="nv">S2</span><span class="w"> </span><span class="ss">(</span><span class="nv">T2</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">T1</span><span class="ss">)</span>:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="nv">T2</span>:<span class="w"> </span><span class="nv">r</span>â‚‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">r</span>â‚‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span><span class="nv">c</span>â‚‚<span class="w">   </span>â”‚
â”‚<span class="w">                                     </span>â”‚
â”‚<span class="w">         </span><span class="nv">T1</span>:<span class="w"> </span><span class="nv">r</span>â‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">r</span>â‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span><span class="nv">c</span>â‚<span class="w"> </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Properties:</strong>
- Always correct (each transaction sees a consistent database)
- No concurrency -- poor performance
- For <code>n</code> transactions, there are <code>n!</code> possible serial schedules</p>
<h3 id="43-serializable-schedule">4.3 Serializable Schedule<a class="header-link" href="#43-serializable-schedule" title="Permanent link">&para;</a></h3>
<p>A <strong>serializable schedule</strong> is a concurrent schedule that produces the same result as <strong>some</strong> serial schedule. It is the gold standard of correctness.</p>
<div class="highlight"><pre><span></span><code>Serializable Schedule S3 (interleaved, but equivalent to S1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1: râ‚(A) wâ‚(A)                             â”‚
â”‚                    T2: râ‚‚(A) wâ‚‚(A)           â”‚
â”‚ T1:                           râ‚(B) wâ‚(B) câ‚â”‚
â”‚                    T2:                râ‚‚(B) wâ‚‚(B) câ‚‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

This may or may not be serializable â€” we need formal tests to determine this.
</code></pre></div>

<hr />
<h2 id="5-conflict-serializability">5. Conflict Serializability<a class="header-link" href="#5-conflict-serializability" title="Permanent link">&para;</a></h2>
<h3 id="51-conflicting-operations">5.1 Conflicting Operations<a class="header-link" href="#51-conflicting-operations" title="Permanent link">&para;</a></h3>
<p>Two operations <strong>conflict</strong> if:
1. They belong to <strong>different</strong> transactions
2. They access the <strong>same</strong> data item
3. At least one of them is a <strong>write</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">Conflict</span><span class="w"> </span><span class="nx">types</span><span class="p">:</span>

<span class="nx">râ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="p">(</span><span class="nx">both</span><span class="w"> </span><span class="nx">reads</span><span class="p">)</span>
<span class="nx">râ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="nx">wâ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Read</span><span class="o">-</span><span class="nx">Write</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="p">(</span><span class="nx">RW</span><span class="p">)</span>
<span class="nx">wâ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Write</span><span class="o">-</span><span class="nx">Read</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="p">(</span><span class="nx">WR</span><span class="p">)</span>
<span class="nx">wâ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="nx">wâ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Write</span><span class="o">-</span><span class="nx">Write</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="p">(</span><span class="nx">WW</span><span class="p">)</span>
</code></pre></div>

<p><strong>Non-conflicting</strong> operations can be <strong>swapped</strong> in a schedule without changing the result.</p>
<h3 id="52-conflict-equivalence">5.2 Conflict Equivalence<a class="header-link" href="#52-conflict-equivalence" title="Permanent link">&para;</a></h3>
<p>Two schedules are <strong>conflict equivalent</strong> if one can be transformed into the other by a series of swaps of <strong>adjacent non-conflicting</strong> operations.</p>
<h3 id="53-conflict-serializable">5.3 Conflict Serializable<a class="header-link" href="#53-conflict-serializable" title="Permanent link">&para;</a></h3>
<p>A schedule is <strong>conflict serializable</strong> if it is conflict equivalent to some serial schedule.</p>
<p><strong>Example: Is this schedule conflict serializable?</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">Schedule</span><span class="w"> </span><span class="nx">S</span><span class="p">:</span><span class="w"> </span><span class="nx">râ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="nx">wâ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="nx">râ‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="nx">wâ‚‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span>

<span class="nx">Step</span><span class="o">-</span><span class="nx">by</span><span class="o">-</span><span class="nx">step</span><span class="w"> </span><span class="nx">analysis</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">râ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">):</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">swap</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">):</span><span class="w"> </span><span class="nx">RW</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="nx">reads</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="nx">writes</span><span class="w"> </span><span class="p">(</span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="p">?</span><span class="w"> </span><span class="nx">No</span><span class="p">,</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="nx">must</span><span class="w"> </span><span class="nx">come</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">A</span><span class="p">)</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">wâ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">):</span><span class="w"> </span><span class="nx">WW</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="nx">writes</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="nx">writes</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">Tâ‚‚</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">râ‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">B</span><span class="p">):</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">conflict</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">B</span><span class="p">):</span><span class="w"> </span><span class="nx">RW</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">B</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="nx">reads</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="nx">writes</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">Tâ‚</span>
<span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">wâ‚‚</span><span class="p">(</span><span class="nx">B</span><span class="p">):</span><span class="w"> </span><span class="nx">WW</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">B</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">Tâ‚‚</span>

<span class="nx">For</span><span class="w"> </span><span class="nx">A</span><span class="p">:</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="nx">implies</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚</span>
<span class="w">       </span><span class="nx">from</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">wâ‚‚</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="nx">implies</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚‚</span>
<span class="nx">For</span><span class="w"> </span><span class="nx">B</span><span class="p">:</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="nx">râ‚‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="nx">implies</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚</span>
<span class="w">       </span><span class="nx">from</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="nx">wâ‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">wâ‚‚</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="nx">implies</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚‚</span>

<span class="nx">We</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">both</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="nx">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Tâ‚</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">cycle</span><span class="p">,</span><span class="w"> </span><span class="nx">so</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">schedule</span>
<span class="k">is</span><span class="w"> </span><span class="nx">NOT</span><span class="w"> </span><span class="nx">conflict</span><span class="w"> </span><span class="nx">serializable</span><span class="p">.</span>
</code></pre></div>

<h3 id="54-precedence-graph-serialization-graph">5.4 Precedence Graph (Serialization Graph)<a class="header-link" href="#54-precedence-graph-serialization-graph" title="Permanent link">&para;</a></h3>
<p>The <strong>precedence graph</strong> provides an efficient algorithm for testing conflict serializability.</p>
<p><strong>Construction:</strong>
1. Create a node for each transaction <code>T_i</code>
2. Add a directed edge <code>T_i â†’ T_j</code> if there exists a pair of conflicting operations where <code>T_i</code>'s operation comes first</p>
<p><strong>Theorem</strong>: A schedule is conflict serializable <strong>if and only if</strong> its precedence graph is <strong>acyclic</strong> (has no cycles).</p>
<p><strong>Example 1: Serializable schedule</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">Schedule</span><span class="o">:</span><span class="w"> </span><span class="n">râ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">râ‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span>

<span class="n">Conflicts</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w">  </span><span class="o">(</span><span class="n">WR</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">A</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w">  </span><span class="o">(</span><span class="n">WW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">A</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w">  </span><span class="o">(</span><span class="n">WR</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">B</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w">  </span><span class="o">(</span><span class="n">WW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">B</span><span class="o">)</span>

<span class="n">Precedence</span><span class="w"> </span><span class="n">Graph</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span>

<span class="n">No</span><span class="w"> </span><span class="n">cycle</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Conflict</span><span class="w"> </span><span class="n">serializable</span><span class="w"> </span><span class="o">(</span><span class="n">equivalent</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">serial</span><span class="w"> </span><span class="n">order</span><span class="o">:</span><span class="w"> </span><span class="n">Tâ‚</span><span class="o">,</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="o">)</span>
</code></pre></div>

<p><strong>Example 2: Non-serializable schedule</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">Schedule</span><span class="o">:</span><span class="w"> </span><span class="n">râ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span>

<span class="n">Conflicts</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">râ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w">  </span><span class="o">(</span><span class="n">RW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">A</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w">  </span><span class="o">(</span><span class="n">RW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">B</span><span class="o">)</span>

<span class="n">Precedence</span><span class="w"> </span><span class="n">Graph</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span>
<span class="w">     </span><span class="err">â†‘</span><span class="w">       </span><span class="err">â”‚</span>
<span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="n">Cycle</span><span class="w"> </span><span class="n">detected</span><span class="o">:</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">conflict</span><span class="w"> </span><span class="n">serializable</span>
</code></pre></div>

<p><strong>Example 3: Three transactions</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">Schedule</span><span class="o">:</span><span class="w"> </span><span class="n">râ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">râ‚ƒ</span><span class="o">(</span><span class="n">C</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">C</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚ƒ</span><span class="o">(</span><span class="n">A</span><span class="o">)</span>

<span class="n">Conflicts</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w">  </span><span class="o">(</span><span class="n">RW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">B</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">râ‚ƒ</span><span class="o">(</span><span class="n">C</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">C</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚ƒ</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w">  </span><span class="o">(</span><span class="n">RW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">C</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">râ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚ƒ</span><span class="o">(</span><span class="n">A</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚ƒ</span><span class="w">  </span><span class="o">(</span><span class="n">RW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">A</span><span class="o">)</span>

<span class="n">Precedence</span><span class="w"> </span><span class="n">Graph</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="n">Tâ‚ƒ</span>
<span class="w">     </span><span class="err">â†‘</span><span class="w">       </span><span class="err">â”‚</span>
<span class="w">     </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â†“</span>
<span class="w">     </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="err">â†â”˜</span>

<span class="n">Cycle</span><span class="o">:</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚ƒ</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">conflict</span><span class="w"> </span><span class="n">serializable</span>
</code></pre></div>

<h3 id="55-topological-sort-for-serial-order">5.5 Topological Sort for Serial Order<a class="header-link" href="#55-topological-sort-for-serial-order" title="Permanent link">&para;</a></h3>
<p>If the precedence graph is acyclic, a <strong>topological sort</strong> gives a valid serial order:</p>
<div class="highlight"><pre><span></span><code>Precedence Graph:
    Tâ‚ â”€â”€â†’ Tâ‚ƒ
    Tâ‚‚ â”€â”€â†’ Tâ‚ƒ
    Tâ‚‚ â”€â”€â†’ Tâ‚

Topological sort: Tâ‚‚, Tâ‚, Tâ‚ƒ
This is the equivalent serial schedule.
</code></pre></div>

<p><strong>Algorithm:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nv">TOPOLOGICAL</span><span class="o">-</span><span class="nv">SORT</span><span class="ss">(</span><span class="nv">graph</span><span class="ss">)</span>:
<span class="w">    </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[]
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">graph</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">nodes</span>:
<span class="w">        </span><span class="nv">find</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">incoming</span><span class="w"> </span><span class="nv">edges</span>
<span class="w">        </span><span class="nv">add</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nb">result</span>
<span class="w">        </span><span class="nv">remove</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">its</span><span class="w"> </span><span class="nv">outgoing</span><span class="w"> </span><span class="nv">edges</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">graph</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">nodes</span><span class="w"> </span><span class="nv">removed</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">result</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nv">valid</span><span class="w"> </span><span class="nv">serial</span><span class="w"> </span><span class="nv">order</span>
<span class="w">    </span><span class="k">else</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">CYCLE</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">serializable</span>
</code></pre></div>

<hr />
<h2 id="6-view-serializability">6. View Serializability<a class="header-link" href="#6-view-serializability" title="Permanent link">&para;</a></h2>
<h3 id="61-definition">6.1 Definition<a class="header-link" href="#61-definition" title="Permanent link">&para;</a></h3>
<p>Two schedules <code>S</code> and <code>S'</code> are <strong>view equivalent</strong> if:</p>
<ol>
<li><strong>Initial reads</strong>: If <code>T_i</code> reads the initial value of <code>X</code> in <code>S</code>, then <code>T_i</code> reads the initial value of <code>X</code> in <code>S'</code></li>
<li><strong>Updated reads</strong>: If <code>T_i</code> reads the value of <code>X</code> written by <code>T_j</code> in <code>S</code>, then <code>T_i</code> reads the value of <code>X</code> written by <code>T_j</code> in <code>S'</code></li>
<li><strong>Final writes</strong>: If <code>T_i</code> performs the final write of <code>X</code> in <code>S</code>, then <code>T_i</code> performs the final write of <code>X</code> in <code>S'</code></li>
</ol>
<p>A schedule is <strong>view serializable</strong> if it is view equivalent to some serial schedule.</p>
<h3 id="62-conflict-vs-view-serializability">6.2 Conflict vs. View Serializability<a class="header-link" href="#62-conflict-vs-view-serializability" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>View Serializable âŠ‡ Conflict Serializable

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        All Schedules                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    View Serializable              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Conflict Serializable      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   Serial Schedules    â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Key facts:</strong>
- Every conflict serializable schedule is view serializable
- The converse is NOT true (some view serializable schedules are not conflict serializable)
- Testing view serializability is <strong>NP-complete</strong>
- Testing conflict serializability is <strong>polynomial</strong> (cycle detection in precedence graph)
- In practice, DBMS use conflict serializability (or weaker guarantees) due to computational feasibility</p>
<h3 id="63-blind-writes">6.3 Blind Writes<a class="header-link" href="#63-blind-writes" title="Permanent link">&para;</a></h3>
<p>The schedules that are view serializable but NOT conflict serializable involve <strong>blind writes</strong> -- writes that are not preceded by a read of the same item.</p>
<div class="highlight"><pre><span></span><code><span class="n">Schedule</span><span class="o">:</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span>

<span class="n">Precedence</span><span class="w"> </span><span class="n">graph</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w">  </span><span class="o">(</span><span class="n">WW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">A</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">B</span><span class="o">):</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w">  </span><span class="o">(</span><span class="n">WW</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">B</span><span class="o">)</span>
<span class="n">Cycle</span><span class="o">!</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">conflict</span><span class="w"> </span><span class="n">serializable</span>

<span class="n">But</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">IS</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">serializable</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">View</span><span class="w"> </span><span class="n">equivalent</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">serial</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">Tâ‚</span><span class="o">,</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">worry</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="o">(</span><span class="n">initial</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">reads</span><span class="o">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Final</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">A</span><span class="o">:</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">schedules</span><span class="w"> </span><span class="err">âœ“</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Final</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">B</span><span class="o">:</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">schedules</span><span class="w"> </span><span class="err">âœ“</span>
</code></pre></div>

<hr />
<h2 id="7-recoverability">7. Recoverability<a class="header-link" href="#7-recoverability" title="Permanent link">&para;</a></h2>
<p>Serializability alone is not sufficient for correctness. We also need schedules that allow proper <strong>recovery</strong> from transaction failures.</p>
<h3 id="71-recoverable-schedules">7.1 Recoverable Schedules<a class="header-link" href="#71-recoverable-schedules" title="Permanent link">&para;</a></h3>
<p>A schedule is <strong>recoverable</strong> if, for every pair of transactions <code>T_i</code> and <code>T_j</code>, if <code>T_j</code> reads a value written by <code>T_i</code>, then <code>T_i</code> commits <strong>before</strong> <code>T_j</code> commits.</p>
<div class="highlight"><pre><span></span><code><span class="n">Recoverable</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="o">...................</span><span class="w"> </span><span class="n">câ‚</span>
<span class="w">    </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w">        </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="o">.................</span><span class="w"> </span><span class="n">câ‚‚</span>
<span class="w">    </span><span class="o">(</span><span class="n">Tâ‚</span><span class="w"> </span><span class="n">commits</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="n">commits</span><span class="w"> </span><span class="err">âœ“</span><span class="o">)</span>

<span class="n">NOT</span><span class="w"> </span><span class="n">Recoverable</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="o">........................</span><span class="w"> </span><span class="n">aâ‚</span><span class="w"> </span><span class="o">(</span><span class="n">abort</span><span class="o">!)</span>
<span class="w">    </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w">        </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="o">.....</span><span class="w"> </span><span class="n">câ‚‚</span>
<span class="w">    </span><span class="o">(</span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="n">committed</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">Tâ‚</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">data</span><span class="o">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="n">aborts</span><span class="w"> </span><span class="n">later</span><span class="o">!)</span>
<span class="w">    </span><span class="n">Problem</span><span class="o">:</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">committed</span><span class="w"> </span><span class="err">â€”</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">undo</span><span class="w"> </span><span class="n">Tâ‚‚</span>
</code></pre></div>

<p><strong>Why it matters</strong>: If a schedule is not recoverable, a cascading abort might need to undo an already-committed transaction, violating durability.</p>
<h3 id="72-cascadeless-schedules-avoiding-cascading-rollbacks">7.2 Cascadeless Schedules (Avoiding Cascading Rollbacks)<a class="header-link" href="#72-cascadeless-schedules-avoiding-cascading-rollbacks" title="Permanent link">&para;</a></h3>
<p>A <strong>cascading rollback</strong> occurs when the abort of one transaction forces the abort of other transactions that read its uncommitted data.</p>
<div class="highlight"><pre><span></span><code><span class="nv">Cascading</span><span class="w"> </span><span class="nv">Rollback</span>:
<span class="w">    </span><span class="nv">T</span>â‚:<span class="w"> </span><span class="nv">w</span>â‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span>...................<span class="w"> </span><span class="nv">a</span>â‚<span class="w"> </span><span class="ss">(</span><span class="nv">abort</span><span class="o">!</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">T</span>â‚‚:<span class="w">        </span><span class="nv">r</span>â‚‚<span class="ss">(</span><span class="nv">A</span><span class="ss">)</span><span class="w"> </span><span class="nv">w</span>â‚‚<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span>........<span class="w">  </span>â†<span class="w"> </span><span class="nv">must</span><span class="w"> </span><span class="nv">abort</span><span class="w"> </span><span class="ss">(</span><span class="nv">read</span><span class="w"> </span><span class="nv">T</span>â‚<span class="err">&#39;s data)</span>
<span class="w">    </span><span class="nv">T</span>â‚ƒ:<span class="w">                    </span><span class="nv">r</span>â‚ƒ<span class="ss">(</span><span class="nv">B</span><span class="ss">)</span><span class="w"> </span>...<span class="w">  </span>â†<span class="w"> </span><span class="nv">must</span><span class="w"> </span><span class="nv">abort</span><span class="w"> </span><span class="ss">(</span><span class="nv">read</span><span class="w"> </span><span class="nv">T</span>â‚‚<span class="err">&#39;s data)</span>

<span class="nv">T</span>â‚<span class="err">&#39;s abort cascades to Tâ‚‚, then to Tâ‚ƒ.</span>
</code></pre></div>

<p>A schedule is <strong>cascadeless</strong> (or <strong>avoids cascading rollbacks</strong>, ACR) if every transaction reads only values written by <strong>committed</strong> transactions.</p>
<div class="highlight"><pre><span></span><code><span class="n">Cascadeless</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="o">............</span><span class="w"> </span><span class="n">câ‚</span>
<span class="w">    </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w">                         </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w">    </span><span class="err">â†</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="n">committed</span>
</code></pre></div>

<p><strong>Relationship</strong>: Every cascadeless schedule is recoverable, but not vice versa.</p>
<h3 id="73-strict-schedules">7.3 Strict Schedules<a class="header-link" href="#73-strict-schedules" title="Permanent link">&para;</a></h3>
<p>A schedule is <strong>strict</strong> if no transaction reads or overwrites a value written by an uncommitted transaction.</p>
<div class="highlight"><pre><span></span><code><span class="n">Strict</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="o">............</span><span class="w"> </span><span class="n">câ‚</span>
<span class="w">    </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w">                         </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="n">committed</span>

<span class="n">Cascadeless</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">Strict</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w"> </span><span class="o">............</span><span class="w"> </span><span class="n">câ‚</span>
<span class="w">    </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w">        </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="w">                             </span><span class="err">â†</span><span class="w"> </span><span class="n">overwrites</span><span class="w"> </span><span class="n">Tâ‚</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">uncommitted</span><span class="w"> </span><span class="n">data</span>
<span class="w">    </span><span class="o">(</span><span class="n">No</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">uncommitted</span><span class="w"> </span><span class="n">data</span><span class="o">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">cascadeless</span><span class="o">)</span>
<span class="w">    </span><span class="o">(</span><span class="n">But</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="n">overwrites</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="n">commits</span><span class="o">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">strict</span><span class="o">)</span>
</code></pre></div>

<p><strong>Why strictness matters</strong>: Strict schedules simplify recovery because the "before image" of a write can be used for undo without worrying about other transactions' writes in between.</p>
<h3 id="74-hierarchy-of-schedule-properties">7.4 Hierarchy of Schedule Properties<a class="header-link" href="#74-hierarchy-of-schedule-properties" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Strict âŠ‚ Cascadeless âŠ‚ Recoverable âŠ‚ All Schedules

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           All Schedules                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       Recoverable                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚     Cascadeless (ACR)        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚      Strict            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚    Serial        â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<table>
<thead>
<tr>
<th>Property</th>
<th>Condition</th>
<th>Recovery Benefit</th>
</tr>
</thead>
<tbody>
<tr>
<td>Recoverable</td>
<td>T_j reads from T_i â†’ T_i commits before T_j</td>
<td>Can always undo uncommitted txns</td>
</tr>
<tr>
<td>Cascadeless</td>
<td>Only read committed data</td>
<td>No cascading aborts</td>
</tr>
<tr>
<td>Strict</td>
<td>No read/overwrite of uncommitted data</td>
<td>Simple undo (restore before-image)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="8-isolation-levels">8. Isolation Levels<a class="header-link" href="#8-isolation-levels" title="Permanent link">&para;</a></h2>
<h3 id="81-motivation">8.1 Motivation<a class="header-link" href="#81-motivation" title="Permanent link">&para;</a></h3>
<p>Full serializability provides maximum correctness but at a significant performance cost (more locking, less concurrency). Many applications can tolerate weaker isolation for better throughput.</p>
<p>The <strong>SQL standard</strong> defines four isolation levels, each permitting certain anomalies:</p>
<h3 id="82-anomalies-phenomena">8.2 Anomalies (Phenomena)<a class="header-link" href="#82-anomalies-phenomena" title="Permanent link">&para;</a></h3>
<p><strong>Dirty Read</strong>: Reading data written by an uncommitted transaction.</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">wâ‚</span><span class="o">(</span><span class="n">A</span><span class="o">=</span><span class="mi">100</span><span class="o">)</span><span class="w"> </span><span class="o">............</span><span class="w"> </span><span class="n">aâ‚</span><span class="w"> </span><span class="o">(</span><span class="n">abort</span><span class="o">,</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">reverts</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">50</span><span class="o">)</span>
<span class="n">Tâ‚‚</span><span class="o">:</span><span class="w">            </span><span class="n">râ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">)=</span><span class="mi">100</span><span class="w">       </span><span class="err">â†</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">&quot;dirty&quot;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="mi">100</span>
</code></pre></div>

<p><strong>Non-Repeatable Read (Fuzzy Read)</strong>: Reading the same item twice yields different values.</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w">                   </span><span class="n">râ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)=</span><span class="mi">50</span><span class="w"> </span><span class="o">..............</span><span class="w"> </span><span class="n">râ‚</span><span class="o">(</span><span class="n">A</span><span class="o">)=</span><span class="mi">100</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">different</span><span class="o">!</span>
<span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="n">wâ‚‚</span><span class="o">(</span><span class="n">A</span><span class="o">=</span><span class="mi">100</span><span class="o">)</span><span class="w"> </span><span class="n">câ‚‚</span>
</code></pre></div>

<p><strong>Phantom Read</strong>: A query returns different sets of rows when executed twice.</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">dept</span><span class="o">=</span><span class="s1">&#39;Eng&#39;</span><span class="w">  </span><span class="err">â†’</span><span class="w">  </span><span class="o">{</span><span class="n">Alice</span><span class="o">,</span><span class="w"> </span><span class="n">Bob</span><span class="o">}</span>
<span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="n">INSERT</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">VALUES</span><span class="o">(</span><span class="s1">&#39;Carol&#39;</span><span class="o">,</span><span class="s1">&#39;Eng&#39;</span><span class="o">)</span><span class="w">  </span><span class="n">câ‚‚</span>
<span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">dept</span><span class="o">=</span><span class="s1">&#39;Eng&#39;</span><span class="w">  </span><span class="err">â†’</span><span class="w">  </span><span class="o">{</span><span class="n">Alice</span><span class="o">,</span><span class="w"> </span><span class="n">Bob</span><span class="o">,</span><span class="w"> </span><span class="n">Carol</span><span class="o">}</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">phantom</span><span class="o">!</span>
</code></pre></div>

<h3 id="83-sql-isolation-levels">8.3 SQL Isolation Levels<a class="header-link" href="#83-sql-isolation-levels" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Isolation Level</th>
<th>Dirty Read</th>
<th>Non-Repeatable Read</th>
<th>Phantom Read</th>
</tr>
</thead>
<tbody>
<tr>
<td>Read Uncommitted</td>
<td>Possible</td>
<td>Possible</td>
<td>Possible</td>
</tr>
<tr>
<td>Read Committed</td>
<td>Not possible</td>
<td>Possible</td>
<td>Possible</td>
</tr>
<tr>
<td>Repeatable Read</td>
<td>Not possible</td>
<td>Not possible</td>
<td>Possible</td>
</tr>
<tr>
<td>Serializable</td>
<td>Not possible</td>
<td>Not possible</td>
<td>Not possible</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="c1">-- Setting isolation level in SQL:</span>
<span class="k">SET</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="k">ISOLATION</span><span class="w"> </span><span class="k">LEVEL</span><span class="w"> </span><span class="k">READ</span><span class="w"> </span><span class="k">COMMITTED</span><span class="p">;</span>
<span class="c1">-- or</span>
<span class="k">BEGIN</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="k">ISOLATION</span><span class="w"> </span><span class="k">LEVEL</span><span class="w"> </span><span class="k">SERIALIZABLE</span><span class="p">;</span>
</code></pre></div>

<h3 id="84-read-uncommitted">8.4 Read Uncommitted<a class="header-link" href="#84-read-uncommitted" title="Permanent link">&para;</a></h3>
<p>The weakest level. Transactions can read uncommitted ("dirty") data from other transactions.</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="o">(</span><span class="n">READ</span><span class="w"> </span><span class="n">UNCOMMITTED</span><span class="o">)</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">;</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">Meanwhile</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">updating</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">hasn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">committed</span><span class="o">:</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">;</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">;</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="mi">500</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">dirty</span><span class="w"> </span><span class="n">read</span><span class="o">!</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="n">rolls</span><span class="w"> </span><span class="n">back</span><span class="o">,</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">real</span><span class="w"> </span><span class="n">value</span>
</code></pre></div>

<p><strong>Use case</strong>: Approximate aggregates, monitoring dashboards where exact values are not critical.</p>
<p><strong>Implementation</strong>: No read locks acquired. Writers still acquire write locks.</p>
<h3 id="85-read-committed">8.5 Read Committed<a class="header-link" href="#85-read-committed" title="Permanent link">&para;</a></h3>
<p>Each read sees only data committed <strong>at the time of the read</strong>. No dirty reads, but the same query may return different results if another transaction commits between reads.</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="o">(</span><span class="n">READ</span><span class="w"> </span><span class="n">COMMITTED</span><span class="o">)</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">;</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">;</span><span class="w"> </span><span class="n">COMMIT</span><span class="o">;</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">;</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="mi">500</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">repeatable</span><span class="w"> </span><span class="n">read</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">Both</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">saw</span><span class="w"> </span><span class="n">committed</span><span class="w"> </span><span class="n">data</span><span class="o">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">values</span>
</code></pre></div>

<p><strong>Default in</strong>: PostgreSQL, Oracle, SQL Server</p>
<p><strong>Implementation</strong>: Read locks are acquired and released immediately (not held until commit). Write locks held until commit.</p>
<h3 id="86-repeatable-read">8.6 Repeatable Read<a class="header-link" href="#86-repeatable-read" title="Permanent link">&para;</a></h3>
<p>Once a transaction reads a data item, it will always see the same value for that item throughout the transaction (no dirty reads, no non-repeatable reads). However, <strong>phantom rows</strong> can still appear.</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="o">(</span><span class="n">REPEATABLE</span><span class="w"> </span><span class="n">READ</span><span class="o">)</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">dept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="o">;</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="o">{</span><span class="n">Alice</span><span class="o">,</span><span class="w"> </span><span class="n">Bob</span><span class="o">}</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="n">INSERT</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">VALUES</span><span class="o">(</span><span class="s1">&#39;Carol&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="o">);</span><span class="w"> </span><span class="n">COMMIT</span><span class="o">;</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">dept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="o">;</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="o">{</span><span class="n">Alice</span><span class="o">,</span><span class="w"> </span><span class="n">Bob</span><span class="o">,</span><span class="w"> </span><span class="n">Carol</span><span class="o">}</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">phantom</span><span class="o">!</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">Re</span><span class="o">-</span><span class="n">read</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Alice</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">Bob</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="n">gives</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">(</span><span class="n">no</span><span class="w"> </span><span class="n">fuzzy</span><span class="w"> </span><span class="n">reads</span><span class="o">)</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">But</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">row</span><span class="w"> </span><span class="o">(</span><span class="n">Carol</span><span class="o">)</span><span class="w"> </span><span class="n">appeared</span><span class="w"> </span><span class="err">â€”</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">phantom</span>
</code></pre></div>

<p><strong>Implementation</strong>: Read locks held until commit. But new rows matching the predicate are not locked (no predicate locking).</p>
<h3 id="87-serializable">8.7 Serializable<a class="header-link" href="#87-serializable" title="Permanent link">&para;</a></h3>
<p>The strongest isolation level. Transactions execute as if they were serial. No anomalies of any kind.</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="o">(</span><span class="n">SERIALIZABLE</span><span class="o">)</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">dept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="o">;</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="o">{</span><span class="n">Alice</span><span class="o">,</span><span class="w"> </span><span class="n">Bob</span><span class="o">}</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="n">INSERT</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">VALUES</span><span class="o">(</span><span class="s1">&#39;Carol&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="o">);</span>
<span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">BLOCKED</span><span class="w"> </span><span class="o">(</span><span class="n">or</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">commit</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">SSI</span><span class="o">)</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">Tâ‚</span><span class="w"> </span><span class="n">completes</span>
<span class="w">    </span><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">dept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="o">;</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="o">{</span><span class="n">Alice</span><span class="o">,</span><span class="w"> </span><span class="n">Bob</span><span class="o">}</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">result</span>
<span class="n">COMMIT</span><span class="o">;</span>
</code></pre></div>

<p><strong>Implementation options:</strong>
- <strong>Strict 2PL with predicate locks</strong> (or index-range locks): traditional approach
- <strong>Serializable Snapshot Isolation (SSI)</strong>: PostgreSQL's approach (optimistic, MVCC-based)</p>
<hr />
<h2 id="9-the-phantom-problem">9. The Phantom Problem<a class="header-link" href="#9-the-phantom-problem" title="Permanent link">&para;</a></h2>
<h3 id="91-why-phantoms-are-special">9.1 Why Phantoms Are Special<a class="header-link" href="#91-why-phantoms-are-special" title="Permanent link">&para;</a></h3>
<p>The phantom problem is fundamentally different from dirty reads and non-repeatable reads:</p>
<ul>
<li>Dirty/non-repeatable reads involve <strong>existing rows</strong> being modified</li>
<li>Phantoms involve <strong>new rows</strong> being inserted (or existing rows being modified to match a predicate)</li>
</ul>
<p>Standard row-level locking cannot prevent phantoms because <strong>you cannot lock rows that do not yet exist</strong>.</p>
<h3 id="92-solutions-to-the-phantom-problem">9.2 Solutions to the Phantom Problem<a class="header-link" href="#92-solutions-to-the-phantom-problem" title="Permanent link">&para;</a></h3>
<p><strong>Predicate Locking:</strong>
Lock based on the query predicate rather than individual rows.</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">dept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span>
<span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="n">Lock</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;no other transaction may insert/update/delete</span>
<span class="s2">             any row where dept = &#39;Eng&#39;&quot;</span>
</code></pre></div>

<p>Predicate locking is expensive in general (predicates can be arbitrarily complex).</p>
<p><strong>Index-Range Locking (Next-Key Locking):</strong>
A practical approximation. Lock a range of index entries, including the "gap" between entries.</p>
<div class="highlight"><pre><span></span><code><span class="n">B</span><span class="o">+</span><span class="n">Tree</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="nl">dept</span><span class="p">:</span>
<span class="p">...</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Acctg</span><span class="o">]</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Eng</span><span class="o">]</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="o">[</span><span class="n">HR</span><span class="o">]</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Sales</span><span class="o">]</span><span class="w"> </span><span class="err">â”€â”€â†’</span><span class="w"> </span><span class="p">...</span>

<span class="n">Lock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s1">&#39;HR&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">exclusive</span><span class="p">).</span>
<span class="n">This</span><span class="w"> </span><span class="n">prevents</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">dept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Eng&#39;</span><span class="p">.</span>

<span class="n">MySQL</span><span class="w"> </span><span class="n">InnoDB</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="ss">&quot;next-key locking.&quot;</span>
</code></pre></div>

<p><strong>Serializable Snapshot Isolation (SSI):</strong>
PostgreSQL's approach. Detect serialization anomalies at commit time using dependency tracking (no predicate locks needed).</p>
<hr />
<h2 id="10-snapshot-isolation">10. Snapshot Isolation<a class="header-link" href="#10-snapshot-isolation" title="Permanent link">&para;</a></h2>
<h3 id="101-concept">10.1 Concept<a class="header-link" href="#101-concept" title="Permanent link">&para;</a></h3>
<p><strong>Snapshot Isolation (SI)</strong> is a multiversion concurrency control scheme that gives each transaction a consistent <strong>snapshot</strong> of the database as of the transaction's start time.</p>
<div class="highlight"><pre><span></span><code>Database state at time 100: A=50, B=100

Tâ‚ starts at time 100: sees snapshot {A=50, B=100}
Tâ‚‚ starts at time 100: sees snapshot {A=50, B=100}

Tâ‚: write(A=75)
Tâ‚‚: read(A) â†’ 50  (reads from its snapshot, not Tâ‚&#39;s write)
Tâ‚: commit at time 105

Tâ‚‚: read(A) â†’ 50  (STILL 50! Tâ‚‚&#39;s snapshot is from time 100)
Tâ‚‚: commit at time 110
</code></pre></div>

<h3 id="102-first-committer-wins-rule">10.2 First-Committer-Wins Rule<a class="header-link" href="#102-first-committer-wins-rule" title="Permanent link">&para;</a></h3>
<p>SI prevents lost updates using the <strong>first-committer-wins</strong> (FCW) rule:</p>
<div class="highlight"><pre><span></span><code>Tâ‚ starts at time 100, Tâ‚‚ starts at time 100

Tâ‚: write(A=75) ............ commit â†’ succeeds (first to commit A)
Tâ‚‚: write(A=80) ......................... commit â†’ ABORTED!
     (Tâ‚‚ tried to write A, but A was already modified and
      committed by Tâ‚ since Tâ‚‚&#39;s snapshot)
</code></pre></div>

<h3 id="103-snapshot-isolation-vs-serializability">10.3 Snapshot Isolation vs. Serializability<a class="header-link" href="#103-snapshot-isolation-vs-serializability" title="Permanent link">&para;</a></h3>
<p>SI prevents dirty reads, non-repeatable reads, and phantoms. But SI is <strong>NOT serializable</strong>! It permits the <strong>write skew</strong> anomaly.</p>
<p><strong>Write Skew Example:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">Constraint</span><span class="o">:</span><span class="w"> </span><span class="n">At</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">doctor</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">call</span><span class="o">.</span>
<span class="n">Initially</span><span class="o">:</span><span class="w"> </span><span class="n">doctor_A</span><span class="o">.</span><span class="na">on_call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="o">,</span><span class="w"> </span><span class="n">doctor_B</span><span class="o">.</span><span class="na">on_call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="n">Tâ‚</span><span class="w"> </span><span class="o">(</span><span class="n">snapshot</span><span class="o">):</span><span class="w"> </span><span class="n">sees</span><span class="w"> </span><span class="n">A</span><span class="o">.</span><span class="na">on_call</span><span class="o">=</span><span class="n">T</span><span class="o">,</span><span class="w"> </span><span class="n">B</span><span class="o">.</span><span class="na">on_call</span><span class="o">=</span><span class="n">T</span>
<span class="n">Tâ‚‚</span><span class="w"> </span><span class="o">(</span><span class="n">snapshot</span><span class="o">):</span><span class="w"> </span><span class="n">sees</span><span class="w"> </span><span class="n">A</span><span class="o">.</span><span class="na">on_call</span><span class="o">=</span><span class="n">T</span><span class="o">,</span><span class="w"> </span><span class="n">B</span><span class="o">.</span><span class="na">on_call</span><span class="o">=</span><span class="n">T</span>

<span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The other doctor (B) is on call, so I can go off call&quot;</span>
<span class="w">    </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">doctors</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">on_call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="o">;</span>

<span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The other doctor (A) is on call, so I can go off call&quot;</span>
<span class="w">    </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">doctors</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">on_call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="o">;</span>

<span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">commit</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">succeeds</span><span class="w"> </span><span class="o">(</span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="n">hasn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">committed</span><span class="w"> </span><span class="n">yet</span><span class="o">,</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">WW</span><span class="w"> </span><span class="n">conflict</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">A</span><span class="o">)</span>
<span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="n">commit</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">succeeds</span><span class="w"> </span><span class="o">(</span><span class="n">Tâ‚</span><span class="w"> </span><span class="n">modified</span><span class="w"> </span><span class="n">A</span><span class="o">,</span><span class="w"> </span><span class="n">Tâ‚‚</span><span class="w"> </span><span class="n">modified</span><span class="w"> </span><span class="n">B</span><span class="o">,</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">WW</span><span class="w"> </span><span class="n">conflict</span><span class="o">!)</span>

<span class="n">Result</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="o">.</span><span class="na">on_call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="o">,</span><span class="w"> </span><span class="n">B</span><span class="o">.</span><span class="na">on_call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">NOBODY</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">call</span><span class="o">!</span><span class="w"> </span><span class="n">Constraint</span><span class="w"> </span><span class="n">violated</span><span class="o">!</span>
</code></pre></div>

<p>In a serializable execution, one transaction would see the other's update and maintain the constraint. SI allows this because Tâ‚ and Tâ‚‚ read from their snapshots and write to <strong>different</strong> items.</p>
<h3 id="104-serializable-snapshot-isolation-ssi">10.4 Serializable Snapshot Isolation (SSI)<a class="header-link" href="#104-serializable-snapshot-isolation-ssi" title="Permanent link">&para;</a></h3>
<p><strong>SSI</strong> extends SI to detect and prevent anomalies like write skew. It tracks <strong>read-write dependencies</strong> between concurrent transactions and aborts transactions that form dangerous structures.</p>
<div class="highlight"><pre><span></span><code><span class="nv">SSI</span><span class="w"> </span><span class="nv">detects</span><span class="w"> </span><span class="s2">&quot;dangerous structures&quot;</span>:
<span class="w">  </span><span class="nv">T</span>â‚<span class="w"> </span>â†’<span class="ss">(</span><span class="nv">rw</span><span class="ss">)</span>â†’<span class="w"> </span><span class="nv">T</span>â‚‚<span class="w"> </span>â†’<span class="ss">(</span><span class="nv">rw</span><span class="ss">)</span>â†’<span class="w"> </span><span class="nv">T</span>â‚ƒ
<span class="w">  </span><span class="ss">(</span><span class="nv">where</span><span class="w"> </span><span class="nv">T</span>â‚<span class="w"> </span><span class="nv">reads</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">T</span>â‚‚<span class="w"> </span><span class="nv">overwrites</span>,
<span class="w">   </span><span class="nv">and</span><span class="w"> </span><span class="nv">T</span>â‚‚<span class="w"> </span><span class="nv">reads</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">T</span>â‚ƒ<span class="w"> </span><span class="nv">overwrites</span><span class="ss">)</span>

<span class="k">If</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">pattern</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">detected</span>,<span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">transactions</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">aborted</span>.
</code></pre></div>

<p><strong>PostgreSQL</strong>: Uses SSI for <code>SERIALIZABLE</code> isolation level since version 9.1. It is an optimistic approach -- transactions proceed without blocking, and conflicts are detected at commit time.</p>
<h3 id="105-si-in-practice">10.5 SI in Practice<a class="header-link" href="#105-si-in-practice" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Database</th>
<th>Default Level</th>
<th>SI Support</th>
<th>True Serializable</th>
</tr>
</thead>
<tbody>
<tr>
<td>PostgreSQL</td>
<td>Read Committed</td>
<td>Yes (REPEATABLE READ)</td>
<td>Yes (SSI)</td>
</tr>
<tr>
<td>Oracle</td>
<td>Read Committed</td>
<td>Yes (SERIALIZABLE*)</td>
<td>No (SI only, not true serial)</td>
</tr>
<tr>
<td>MySQL InnoDB</td>
<td>Repeatable Read</td>
<td>Partial (gap locking)</td>
<td>Yes (lock-based)</td>
</tr>
<tr>
<td>SQL Server</td>
<td>Read Committed</td>
<td>Yes (SNAPSHOT)</td>
<td>Yes (lock-based)</td>
</tr>
<tr>
<td>CockroachDB</td>
<td>Serializable</td>
<td>Yes</td>
<td>Yes (SSI)</td>
</tr>
</tbody>
</table>
<p>*Note: Oracle's "SERIALIZABLE" level actually provides Snapshot Isolation, not true serializability.</p>
<hr />
<h2 id="11-testing-for-serializability-complete-algorithm">11. Testing for Serializability: Complete Algorithm<a class="header-link" href="#11-testing-for-serializability-complete-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="step-by-step-algorithm">Step-by-Step Algorithm<a class="header-link" href="#step-by-step-algorithm" title="Permanent link">&para;</a></h3>
<p>Given a schedule <code>S</code> with transactions <code>Tâ‚, Tâ‚‚, ..., Tâ‚™</code>:</p>
<div class="highlight"><pre><span></span><code>SERIALIZABILITY-TEST(S):

1. Initialize precedence graph G with nodes Tâ‚, ..., Tâ‚™

2. For each data item X accessed by two or more transactions:
   a. For each pair of operations on X in temporal order:
      <span class="k">-</span> If r_i(X) precedes w_j(X) and i â‰  j:
          add edge T_i â†’ T_j  (RW conflict)
      <span class="k">-</span> If w_i(X) precedes r_j(X) and i â‰  j:
          add edge T_i â†’ T_j  (WR conflict)
      <span class="k">-</span> If w_i(X) precedes w_j(X) and i â‰  j:
          add edge T_i â†’ T_j  (WW conflict)

3. Check if G has a cycle:
   <span class="k">-</span> Use DFS or topological sort
   <span class="k">-</span> If no cycle: S is conflict serializable
     The topological sort gives the equivalent serial order
   <span class="k">-</span> If cycle exists: S is NOT conflict serializable
</code></pre></div>

<h3 id="detailed-example">Detailed Example<a class="header-link" href="#detailed-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Schedule S:
  râ‚(A) râ‚‚(A) wâ‚(A) râ‚ƒ(A) wâ‚ƒ(A) wâ‚‚(B) râ‚ƒ(B) wâ‚(B) câ‚ câ‚‚ câ‚ƒ

Step 1: Nodes: Tâ‚, Tâ‚‚, Tâ‚ƒ

Step 2: Analyze conflicts by data item:

  Data item A:
    râ‚(A) &lt; wâ‚(A): same transaction, skip
    râ‚‚(A) &lt; wâ‚(A): RW conflict â†’ Tâ‚‚ â†’ Tâ‚
    râ‚‚(A) &lt; wâ‚ƒ(A): RW conflict â†’ Tâ‚‚ â†’ Tâ‚ƒ
    wâ‚(A) &lt; râ‚ƒ(A): WR conflict â†’ Tâ‚ â†’ Tâ‚ƒ
    wâ‚(A) &lt; wâ‚ƒ(A): WW conflict â†’ Tâ‚ â†’ Tâ‚ƒ

  Data item B:
    wâ‚‚(B) &lt; râ‚ƒ(B): WR conflict â†’ Tâ‚‚ â†’ Tâ‚ƒ
    wâ‚‚(B) &lt; wâ‚(B): WW conflict â†’ Tâ‚‚ â†’ Tâ‚
    râ‚ƒ(B) &lt; wâ‚(B): RW conflict â†’ Tâ‚ƒ â†’ Tâ‚

Step 3: Precedence graph:

    Tâ‚‚ â†’ Tâ‚ (from A: RW and B: WW)
    Tâ‚‚ â†’ Tâ‚ƒ (from A: RW and B: WR)
    Tâ‚ â†’ Tâ‚ƒ (from A: WR, WW)
    Tâ‚ƒ â†’ Tâ‚ (from B: RW)

         Tâ‚‚
        â†™  â†˜
      Tâ‚ â‡„ Tâ‚ƒ

    Cycle: Tâ‚ â†’ Tâ‚ƒ â†’ Tâ‚

    Result: NOT conflict serializable
</code></pre></div>

<hr />
<h2 id="12-exercises">12. Exercises<a class="header-link" href="#12-exercises" title="Permanent link">&para;</a></h2>
<h3 id="conceptual-questions">Conceptual Questions<a class="header-link" href="#conceptual-questions" title="Permanent link">&para;</a></h3>
<p><strong>Exercise 1</strong>: For each ACID property, give a concrete example of what could go wrong if that property were violated. Use a banking scenario with accounts and transfers.</p>
<p><strong>Exercise 2</strong>: Draw the transaction state diagram and trace the states for the following scenario:
- Transaction T begins and reads data item A
- T computes a new value and writes A
- The system detects a constraint violation
- T is rolled back</p>
<p><strong>Exercise 3</strong>: Explain why every cascadeless schedule is recoverable, but not every recoverable schedule is cascadeless. Provide example schedules for each case.</p>
<h3 id="serializability-analysis">Serializability Analysis<a class="header-link" href="#serializability-analysis" title="Permanent link">&para;</a></h3>
<p><strong>Exercise 4</strong>: Determine whether each of the following schedules is conflict serializable. If yes, give the equivalent serial order. If no, identify the cycle in the precedence graph.</p>
<p>(a) <code>râ‚(A) râ‚‚(B) wâ‚(B) wâ‚‚(A) câ‚ câ‚‚</code></p>
<p>(b) <code>râ‚(A) wâ‚‚(A) wâ‚(A) râ‚‚(A) câ‚ câ‚‚</code></p>
<p>(c) <code>râ‚ƒ(B) râ‚(A) wâ‚ƒ(A) râ‚‚(B) wâ‚‚(A) wâ‚(B) câ‚ câ‚‚ câ‚ƒ</code></p>
<p>(d) <code>râ‚(A) râ‚‚(B) râ‚ƒ(C) wâ‚(B) wâ‚‚(C) wâ‚ƒ(A) câ‚ câ‚‚ câ‚ƒ</code></p>
<p><strong>Exercise 5</strong>: Given the schedule:</p>
<div class="highlight"><pre><span></span><code>râ‚(X) râ‚‚(X) wâ‚‚(X) râ‚(Y) wâ‚(Y) wâ‚‚(Y) câ‚ câ‚‚
</code></pre></div>

<p>(a) Draw the precedence graph.
(b) Is it conflict serializable?
(c) Is it recoverable?
(d) Is it cascadeless?
(e) Is it strict?</p>
<p><strong>Exercise 6</strong>: Construct a schedule that is:
(a) View serializable but NOT conflict serializable
(b) Recoverable but NOT cascadeless
(c) Cascadeless but NOT strict</p>
<h3 id="isolation-levels">Isolation Levels<a class="header-link" href="#isolation-levels" title="Permanent link">&para;</a></h3>
<p><strong>Exercise 7</strong>: For each scenario, identify the minimum isolation level required to prevent the anomaly:</p>
<p>(a) An inventory system where reading an uncommitted quantity could lead to overselling.</p>
<p>(b) A report that sums account balances, and the sum must be consistent (no partially-applied transfers).</p>
<p>(c) A query that counts employees per department, and the count must not change within the same transaction.</p>
<p><strong>Exercise 8</strong>: Write a concrete SQL scenario that demonstrates the <strong>write skew</strong> anomaly under Snapshot Isolation. Explain why this cannot happen under true Serializable isolation.</p>
<p><strong>Exercise 9</strong>: Consider a schedule with three transactions:</p>
<div class="highlight"><pre><span></span><code><span class="n">Tâ‚</span><span class="o">:</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">A</span>
<span class="n">Tâ‚‚</span><span class="o">:</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">B</span>
<span class="n">Tâ‚ƒ</span><span class="o">:</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">C</span>
</code></pre></div>

<p>(a) If running under Read Committed, what anomalies can occur?
(b) Under Repeatable Read?
(c) Under Serializable?</p>
<h3 id="advanced-questions">Advanced Questions<a class="header-link" href="#advanced-questions" title="Permanent link">&para;</a></h3>
<p><strong>Exercise 10</strong>: Prove that the number of possible serial schedules for <code>n</code> transactions is <code>n!</code>. Then explain why testing all <code>n!</code> serial schedules to verify serializability is impractical, and how the precedence graph provides a polynomial-time alternative.</p>
<p><strong>Exercise 11</strong>: Oracle's <code>SERIALIZABLE</code> isolation level actually provides Snapshot Isolation, not true serializability. Design a test case (specific table schema and two concurrent transactions) that would expose this difference. What result would Oracle give vs. a truly serializable system?</p>
<p><strong>Exercise 12</strong>: A system uses Repeatable Read isolation. Transaction Tâ‚ runs <code>SELECT COUNT(*) FROM orders WHERE status = 'pending'</code> twice within the same transaction. Between the two selects, transaction Tâ‚‚ inserts a new order with status = 'pending' and commits.</p>
<p>(a) What values does Tâ‚ see for the two COUNT queries?
(b) Is this a phantom read?
(c) How would Serializable isolation handle this differently?
(d) How does MySQL InnoDB's "Repeatable Read" with gap locking handle this compared to the SQL standard definition?</p>
<hr />
<p><strong>Previous</strong>: <a href="./09_Indexing.md">Indexing</a> | <strong>Next</strong>: <a href="./11_Concurrency_Control.md">Concurrency Control</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/09_Indexing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">09. Indexing</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/11_Concurrency_Control.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">11. Concurrency Control</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}