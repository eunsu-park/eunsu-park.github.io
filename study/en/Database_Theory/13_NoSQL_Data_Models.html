{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoSQL Data Models - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Database_Theory/">Database Theory</a>
    <span class="separator">/</span>
    <span class="current">NoSQL Data Models</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>NoSQL Data Models</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/12_Recovery_Systems.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">12. Recovery Systems</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/14_Distributed_Databases.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Distributed Databases</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-motivation-limits-of-the-relational-model">1. Motivation: Limits of the Relational Model</a><ul>
<li><a href="#11-the-impedance-mismatch">1.1 The Impedance Mismatch</a></li>
<li><a href="#12-scalability-challenges">1.2 Scalability Challenges</a></li>
<li><a href="#13-schema-rigidity">1.3 Schema Rigidity</a></li>
<li><a href="#14-the-nosql-movement">1.4 The NoSQL Movement</a></li>
</ul>
</li>
<li><a href="#2-the-cap-theorem">2. The CAP Theorem</a><ul>
<li><a href="#21-statement">2.1 Statement</a></li>
<li><a href="#22-understanding-each-property">2.2 Understanding Each Property</a></li>
<li><a href="#23-proof-sketch">2.3 Proof Sketch</a></li>
<li><a href="#24-cap-in-practice">2.4 CAP in Practice</a></li>
<li><a href="#25-pacelc-extension">2.5 PACELC Extension</a></li>
</ul>
</li>
<li><a href="#3-base-vs-acid">3. BASE vs ACID</a><ul>
<li><a href="#31-acid-recap">3.1 ACID Recap</a></li>
<li><a href="#32-base-properties">3.2 BASE Properties</a></li>
<li><a href="#33-detailed-comparison">3.3 Detailed Comparison</a></li>
<li><a href="#34-eventual-consistency-models">3.4 Eventual Consistency Models</a></li>
</ul>
</li>
<li><a href="#4-key-value-stores">4. Key-Value Stores</a><ul>
<li><a href="#41-data-model">4.1 Data Model</a></li>
<li><a href="#42-operations">4.2 Operations</a></li>
<li><a href="#43-redis">4.3 Redis</a></li>
<li><a href="#44-amazon-dynamodb">4.4 Amazon DynamoDB</a></li>
<li><a href="#45-limitations-of-key-value-stores">4.5 Limitations of Key-Value Stores</a></li>
</ul>
</li>
<li><a href="#5-document-stores">5. Document Stores</a><ul>
<li><a href="#51-data-model">5.1 Data Model</a></li>
<li><a href="#52-json-vs-bson">5.2 JSON vs BSON</a></li>
<li><a href="#53-mongodb">5.3 MongoDB</a></li>
<li><a href="#54-schema-design-patterns">5.4 Schema Design Patterns</a></li>
<li><a href="#55-indexing-in-mongodb">5.5 Indexing in MongoDB</a></li>
<li><a href="#56-limitations-of-document-stores">5.6 Limitations of Document Stores</a></li>
</ul>
</li>
<li><a href="#6-wide-column-stores">6. Wide-Column Stores</a><ul>
<li><a href="#61-data-model">6.1 Data Model</a></li>
<li><a href="#62-cassandra">6.2 Cassandra</a></li>
<li><a href="#63-hbase">6.3 HBase</a></li>
<li><a href="#64-use-cases-for-wide-column-stores">6.4 Use Cases for Wide-Column Stores</a></li>
<li><a href="#65-limitations">6.5 Limitations</a></li>
</ul>
</li>
<li><a href="#7-graph-databases">7. Graph Databases</a><ul>
<li><a href="#71-the-property-graph-model">7.1 The Property Graph Model</a></li>
<li><a href="#72-why-graphs">7.2 Why Graphs?</a></li>
<li><a href="#73-cypher-query-language">7.3 Cypher Query Language</a></li>
<li><a href="#74-graph-use-cases">7.4 Graph Use Cases</a></li>
<li><a href="#75-limitations-of-graph-databases">7.5 Limitations of Graph Databases</a></li>
</ul>
</li>
<li><a href="#8-comparison-matrix-when-to-use-which-model">8. Comparison Matrix: When to Use Which Model</a><ul>
<li><a href="#81-decision-matrix">8.1 Decision Matrix</a></li>
<li><a href="#82-decision-flowchart">8.2 Decision Flowchart</a></li>
<li><a href="#83-concrete-recommendations">8.3 Concrete Recommendations</a></li>
</ul>
</li>
<li><a href="#9-polyglot-persistence">9. Polyglot Persistence</a><ul>
<li><a href="#91-definition">9.1 Definition</a></li>
<li><a href="#92-architecture-example">9.2 Architecture Example</a></li>
<li><a href="#93-benefits">9.3 Benefits</a></li>
<li><a href="#94-challenges">9.4 Challenges</a></li>
<li><a href="#95-mitigating-challenges">9.5 Mitigating Challenges</a></li>
<li><a href="#96-when-not-to-use-polyglot-persistence">9.6 When NOT to Use Polyglot Persistence</a></li>
</ul>
</li>
<li><a href="#10-exercises">10. Exercises</a><ul>
<li><a href="#exercise-1-cap-theorem-analysis">Exercise 1: CAP Theorem Analysis</a></li>
<li><a href="#exercise-2-data-model-selection">Exercise 2: Data Model Selection</a></li>
<li><a href="#exercise-3-redis-design">Exercise 3: Redis Design</a></li>
<li><a href="#exercise-4-mongodb-schema-design">Exercise 4: MongoDB Schema Design</a></li>
<li><a href="#exercise-5-cassandra-data-modeling">Exercise 5: Cassandra Data Modeling</a></li>
<li><a href="#exercise-6-cypher-queries">Exercise 6: Cypher Queries</a></li>
<li><a href="#exercise-7-polyglot-persistence-design">Exercise 7: Polyglot Persistence Design</a></li>
<li><a href="#exercise-8-cap-theorem-proof-extension">Exercise 8: CAP Theorem Proof Extension</a></li>
<li><a href="#exercise-9-consistency-model-classification">Exercise 9: Consistency Model Classification</a></li>
<li><a href="#exercise-10-comparative-analysis">Exercise 10: Comparative Analysis</a></li>
</ul>
</li>
<li><a href="#11-references">11. References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="nosql-data-models">NoSQL Data Models<a class="header-link" href="#nosql-data-models" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./12_Concurrency_Control.md">12. Concurrency Control</a> | <strong>Next</strong>: <a href="./14_Distributed_Databases.md">14. Distributed Databases</a></p>
<hr />
<p>The relational model has served as the dominant paradigm for data management since Codd's seminal 1970 paper. Yet as the internet evolved from thousands of users to billions, and as data grew from megabytes to petabytes, practitioners discovered scenarios where the relational model's strict guarantees became liabilities rather than assets. This lesson explores the NoSQL revolution: why it happened, what models emerged, and how to choose the right data model for a given problem.</p>
<p><strong>Difficulty</strong>: â­â­â­</p>
<p><strong>Learning Objectives</strong>:
- Explain why the relational model struggles at web scale
- State and interpret the CAP theorem with its formal proof sketch
- Contrast BASE and ACID consistency models
- Design data models using key-value, document, wide-column, and graph paradigms
- Write basic queries in each NoSQL paradigm
- Apply a decision framework to select the appropriate data model
- Understand polyglot persistence and its architectural implications</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-motivation-limits-of-the-relational-model">Motivation: Limits of the Relational Model</a></li>
<li><a href="#2-the-cap-theorem">The CAP Theorem</a></li>
<li><a href="#3-base-vs-acid">BASE vs ACID</a></li>
<li><a href="#4-key-value-stores">Key-Value Stores</a></li>
<li><a href="#5-document-stores">Document Stores</a></li>
<li><a href="#6-wide-column-stores">Wide-Column Stores</a></li>
<li><a href="#7-graph-databases">Graph Databases</a></li>
<li><a href="#8-comparison-matrix-when-to-use-which-model">Comparison Matrix: When to Use Which Model</a></li>
<li><a href="#9-polyglot-persistence">Polyglot Persistence</a></li>
<li><a href="#10-exercises">Exercises</a></li>
<li><a href="#11-references">References</a></li>
</ol>
<hr />
<h2 id="1-motivation-limits-of-the-relational-model">1. Motivation: Limits of the Relational Model<a class="header-link" href="#1-motivation-limits-of-the-relational-model" title="Permanent link">&para;</a></h2>
<h3 id="11-the-impedance-mismatch">1.1 The Impedance Mismatch<a class="header-link" href="#11-the-impedance-mismatch" title="Permanent link">&para;</a></h3>
<p>Relational databases store data in flat, two-dimensional tables. Modern applications, however, work with rich, nested objects: a single "order" in an e-commerce application includes line items, shipping addresses, payment details, and promotional codes. Mapping these hierarchical objects to normalized tables requires complex JOIN operations at read time and multi-table INSERT operations at write time.</p>
<div class="highlight"><pre><span></span><code><span class="nx">Application</span><span class="w"> </span><span class="nx">Object</span><span class="w">              </span><span class="nx">Relational</span><span class="w"> </span><span class="nx">Tables</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">            </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Order</span><span class="w">             </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">orders</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">line_items</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€</span><span class="w"> </span><span class="nx">customer</span><span class="w">      </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”€â”€â–¶</span><span class="w">    </span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span class="w">   </span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€</span><span class="w"> </span><span class="nx">items</span><span class="p">[]</span><span class="w">       </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">order_id</span><span class="w"> </span><span class="err">â”‚â”€â”€â–¶â”‚</span><span class="w"> </span><span class="nx">order_id</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€</span><span class="w"> </span><span class="nx">shipping_addr</span><span class="w"> </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">cust_id</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">product_id</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€</span><span class="w"> </span><span class="nx">payment</span><span class="w">       </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">total</span><span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">quantity</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">            </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">                                      </span><span class="err">â”‚</span>
<span class="w">                                      </span><span class="err">â–¼</span>
<span class="w">                                </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">                                </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">addresses</span><span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">payments</span><span class="w"> </span><span class="err">â”‚</span>
<span class="w">                                </span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span class="w">   </span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="w">                                </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">order_id</span><span class="w">     </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">order_id</span><span class="w"> </span><span class="err">â”‚</span>
<span class="w">                                </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">street</span><span class="w">       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">method</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">                                </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">city</span><span class="w">         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">amount</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">                                </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<p>This "impedance mismatch" between the application's object model and the database's relational model creates overhead in code complexity, development time, and runtime performance.</p>
<h3 id="12-scalability-challenges">1.2 Scalability Challenges<a class="header-link" href="#12-scalability-challenges" title="Permanent link">&para;</a></h3>
<p>Relational databases were designed for vertical scaling (bigger machines). When you need more capacity, you buy a faster CPU, more RAM, or faster disks. This approach has hard limits:</p>
<table>
<thead>
<tr>
<th>Scaling Dimension</th>
<th>Vertical (Scale Up)</th>
<th>Horizontal (Scale Out)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Approach</strong></td>
<td>Bigger machine</td>
<td>More machines</td>
</tr>
<tr>
<td><strong>Cost curve</strong></td>
<td>Exponential</td>
<td>Linear</td>
</tr>
<tr>
<td><strong>Theoretical limit</strong></td>
<td>Hardware ceiling</td>
<td>Virtually unlimited</td>
</tr>
<tr>
<td><strong>Downtime for upgrade</strong></td>
<td>Usually required</td>
<td>Rolling upgrades</td>
</tr>
<tr>
<td><strong>Relational DB support</strong></td>
<td>Natural fit</td>
<td>Extremely difficult</td>
</tr>
<tr>
<td><strong>NoSQL support</strong></td>
<td>Possible</td>
<td>Natural fit</td>
</tr>
</tbody>
</table>
<p>Horizontal scaling requires distributing data across multiple nodes, which fundamentally conflicts with several relational guarantees:</p>
<ul>
<li><strong>JOINs across partitions</strong> become network operations with unpredictable latency.</li>
<li><strong>Distributed transactions</strong> require complex coordination protocols (2PC) that reduce throughput.</li>
<li><strong>Schema changes</strong> (ALTER TABLE) on billions of rows across hundreds of nodes are operationally dangerous.</li>
</ul>
<h3 id="13-schema-rigidity">1.3 Schema Rigidity<a class="header-link" href="#13-schema-rigidity" title="Permanent link">&para;</a></h3>
<p>Relational databases enforce a rigid schema: every row in a table has the same columns. In agile development, requirements change frequently. Each schema change requires:</p>
<ol>
<li>Writing a migration script</li>
<li>Testing the migration against production-sized data</li>
<li>Coordinating the deployment with application code changes</li>
<li>Potentially locking the table during ALTER TABLE operations</li>
</ol>
<p>For applications with rapidly evolving data models (social media feeds, IoT sensor data, content management), this rigidity imposes significant operational overhead.</p>
<h3 id="14-the-nosql-movement">1.4 The NoSQL Movement<a class="header-link" href="#14-the-nosql-movement" title="Permanent link">&para;</a></h3>
<p>The term "NoSQL" emerged around 2009, initially standing for "Not Only SQL" to emphasize that these systems complement rather than replace relational databases. The key motivations were:</p>
<ul>
<li><strong>Horizontal scalability</strong>: distribute data across commodity hardware</li>
<li><strong>Flexible schemas</strong>: adapt to changing data structures without migrations</li>
<li><strong>High availability</strong>: remain operational even when nodes fail</li>
<li><strong>Performance</strong>: optimize for specific access patterns rather than general-purpose queries</li>
<li><strong>Developer productivity</strong>: store data in formats that match application objects</li>
</ul>
<blockquote>
<p><strong>Historical Note</strong>: Google's Bigtable paper (2006) and Amazon's Dynamo paper (2007) are considered the foundational papers of the NoSQL movement. They demonstrated that relaxing relational guarantees could achieve performance and scalability that was previously impossible.</p>
</blockquote>
<hr />
<h2 id="2-the-cap-theorem">2. The CAP Theorem<a class="header-link" href="#2-the-cap-theorem" title="Permanent link">&para;</a></h2>
<h3 id="21-statement">2.1 Statement<a class="header-link" href="#21-statement" title="Permanent link">&para;</a></h3>
<p>The CAP theorem, formulated by Eric Brewer in 2000 and formally proved by Gilbert and Lynch in 2002, states:</p>
<blockquote>
<p><strong>CAP Theorem</strong>: In a distributed data store, it is impossible to simultaneously guarantee all three of the following properties:
- <strong>Consistency (C)</strong>: Every read receives the most recent write or an error.
- <strong>Availability (A)</strong>: Every request receives a (non-error) response, without the guarantee that it contains the most recent write.
- <strong>Partition Tolerance (P)</strong>: The system continues to operate despite an arbitrary number of messages being dropped (or delayed) by the network between nodes.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Consistency   â”‚
                    â”‚       (C)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                   CA        â”‚        CP
               (impossible   â”‚    (sacrifice
               in distributedâ”‚    availability)
               systems)      â”‚
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
   â”‚Availabilityâ”‚                           â”‚ Partition â”‚
   â”‚    (A)    â”‚                            â”‚ Tolerance â”‚
   â”‚           â”‚                            â”‚    (P)    â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    (sacrifice
                     consistency)
</code></pre></div>

<h3 id="22-understanding-each-property">2.2 Understanding Each Property<a class="header-link" href="#22-understanding-each-property" title="Permanent link">&para;</a></h3>
<p><strong>Consistency</strong> (Linearizability): If client A writes value <code>v</code> to key <code>k</code>, then any subsequent read of <code>k</code> by any client must return <code>v</code> (or a more recent value). This is linearizable consistency -- the strongest form. It means the system behaves as if there is a single copy of the data.</p>
<p><strong>Availability</strong>: Every request received by a non-failing node must result in a response. The system cannot simply ignore requests or return errors when it is uncertain about the state.</p>
<p><strong>Partition Tolerance</strong>: A network partition occurs when messages between nodes are lost or arbitrarily delayed. In any real distributed system, network partitions are inevitable (cables get cut, switches fail, datacenters lose connectivity). Therefore, P is not optional in practice.</p>
<h3 id="23-proof-sketch">2.3 Proof Sketch<a class="header-link" href="#23-proof-sketch" title="Permanent link">&para;</a></h3>
<p>The proof by Gilbert and Lynch (2002) proceeds by contradiction:</p>
<p><strong>Setup</strong>: Consider the simplest possible distributed system with two nodes, N1 and N2, connected by a network. Both nodes store a copy of a variable <code>v</code>, initially set to <code>v0</code>.</p>
<p><strong>Assume</strong> the system guarantees all three properties: C, A, and P.</p>
<p><strong>Step 1</strong>: A network partition occurs between N1 and N2. Messages sent from N1 to N2 (and vice versa) are lost. By P, the system must continue to operate.</p>
<p><strong>Step 2</strong>: A client sends a write request to N1, setting <code>v = v1</code>. By A, N1 must accept this write and respond to the client. However, because of the partition, N1 cannot propagate this update to N2.</p>
<p><strong>Step 3</strong>: Another client sends a read request to N2 for the value of <code>v</code>. By A, N2 must respond. The only value N2 has is <code>v0</code> (the old value), because the update from N1 was lost in the partition.</p>
<p><strong>Step 4</strong>: N2 returns <code>v0</code>, but the most recent write was <code>v1</code>. This violates C (linearizability).</p>
<p><strong>Contradiction</strong>: We assumed C, A, and P, but derived a violation of C. Therefore, it is impossible to guarantee all three simultaneously.</p>
<div class="highlight"><pre><span></span><code>    N1                          N2
    â”Œâ”€â”€â”                       â”Œâ”€â”€â”
    â”‚v0â”‚                       â”‚v0â”‚    Initial state
    â””â”€â”€â”˜                       â””â”€â”€â”˜
     â”‚                          â”‚
     â”‚    â•³â•³â•³ PARTITION â•³â•³â•³    â”‚     Network partition
     â”‚                          â”‚
   write(v1)                    â”‚
     â”‚                          â”‚
    â”Œâ”€â”€â”                       â”Œâ”€â”€â”
    â”‚v1â”‚    cannot replicate   â”‚v0â”‚    N1 updated, N2 stale
    â””â”€â”€â”˜    â”€â”€â”€â”€â”€â”€â•³â”€â”€â”€â”€â”€â”€â–¶     â””â”€â”€â”˜
                                â”‚
                             read(v) â†’ returns v0  â† VIOLATES C
</code></pre></div>

<h3 id="24-cap-in-practice">2.4 CAP in Practice<a class="header-link" href="#24-cap-in-practice" title="Permanent link">&para;</a></h3>
<p>Since network partitions are unavoidable in distributed systems, the real choice is between:</p>
<ul>
<li>
<p><strong>CP systems</strong>: Sacrifice availability during partitions. When a partition occurs, the system may refuse to answer some requests to maintain consistency. Examples: HBase, MongoDB (with majority read concern), etcd, ZooKeeper.</p>
</li>
<li>
<p><strong>AP systems</strong>: Sacrifice consistency during partitions. When a partition occurs, the system continues to serve requests but may return stale data. Examples: Cassandra, DynamoDB, CouchDB, Riak.</p>
</li>
</ul>
<p><strong>Important nuances</strong>:</p>
<ol>
<li>
<p><strong>CAP is about behavior during partitions only.</strong> When there is no partition, a system can provide both C and A.</p>
</li>
<li>
<p><strong>Consistency is a spectrum.</strong> Between strict linearizability and eventual consistency, there are many intermediate levels (causal consistency, read-your-writes, monotonic reads).</p>
</li>
<li>
<p><strong>The choice is per-operation, not per-system.</strong> A single database can offer different consistency guarantees for different operations. For example, MongoDB allows you to choose <code>readConcern: "majority"</code> (CP) or <code>readConcern: "local"</code> (AP) on a per-query basis.</p>
</li>
</ol>
<h3 id="25-pacelc-extension">2.5 PACELC Extension<a class="header-link" href="#25-pacelc-extension" title="Permanent link">&para;</a></h3>
<p>Daniel Abadi proposed the PACELC theorem as a refinement:</p>
<blockquote>
<p><strong>PACELC</strong>: If there is a <strong>P</strong>artition, choose between <strong>A</strong>vailability and <strong>C</strong>onsistency; <strong>E</strong>lse (when the system is running normally), choose between <strong>L</strong>atency and <strong>C</strong>onsistency.</p>
</blockquote>
<table>
<thead>
<tr>
<th>System</th>
<th>P â†’ A or C?</th>
<th>E â†’ L or C?</th>
<th>Classification</th>
</tr>
</thead>
<tbody>
<tr>
<td>DynamoDB</td>
<td>A</td>
<td>L</td>
<td>PA/EL</td>
</tr>
<tr>
<td>Cassandra</td>
<td>A</td>
<td>L</td>
<td>PA/EL</td>
</tr>
<tr>
<td>MongoDB</td>
<td>C</td>
<td>C</td>
<td>PC/EC</td>
</tr>
<tr>
<td>HBase</td>
<td>C</td>
<td>C</td>
<td>PC/EC</td>
</tr>
<tr>
<td>PNUTS (Yahoo)</td>
<td>A</td>
<td>C</td>
<td>PA/EC</td>
</tr>
<tr>
<td>Spanner</td>
<td>C</td>
<td>C</td>
<td>PC/EC</td>
</tr>
</tbody>
</table>
<p>This captures the observation that even when no partition exists, systems make latency-consistency tradeoffs.</p>
<hr />
<h2 id="3-base-vs-acid">3. BASE vs ACID<a class="header-link" href="#3-base-vs-acid" title="Permanent link">&para;</a></h2>
<p>We covered ACID in detail in <a href="./11_Transaction_Theory.md">Lesson 11</a>. Let us now contrast it with the BASE model that most NoSQL systems adopt.</p>
<h3 id="31-acid-recap">3.1 ACID Recap<a class="header-link" href="#31-acid-recap" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Atomicity</strong></td>
<td>All operations in a transaction succeed or all fail</td>
</tr>
<tr>
<td><strong>Consistency</strong></td>
<td>A transaction brings the database from one valid state to another</td>
</tr>
<tr>
<td><strong>Isolation</strong></td>
<td>Concurrent transactions do not interfere with each other</td>
</tr>
<tr>
<td><strong>Durability</strong></td>
<td>Once committed, data survives system failures</td>
</tr>
</tbody>
</table>
<h3 id="32-base-properties">3.2 BASE Properties<a class="header-link" href="#32-base-properties" title="Permanent link">&para;</a></h3>
<p>BASE is a backronym proposed by Eric Brewer as the counterpoint to ACID:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Basically Available</strong></td>
<td>The system guarantees availability (in the CAP sense)</td>
</tr>
<tr>
<td><strong>Soft state</strong></td>
<td>The state of the system may change over time, even without input, due to eventual consistency propagation</td>
</tr>
<tr>
<td><strong>Eventually consistent</strong></td>
<td>Given enough time without new updates, all replicas will converge to the same state</td>
</tr>
</tbody>
</table>
<h3 id="33-detailed-comparison">3.3 Detailed Comparison<a class="header-link" href="#33-detailed-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="w">          </span><span class="nx">ACID</span><span class="w">                                    </span><span class="nx">BASE</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">            </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Strong</span><span class="w"> </span><span class="nx">consistency</span><span class="w">    </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Eventual</span><span class="w"> </span><span class="nx">consistency</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Pessimistic</span><span class="w"> </span><span class="nx">locking</span><span class="w">   </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Optimistic</span><span class="w"> </span><span class="nx">replication</span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Centralized</span><span class="w">           </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Distributed</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Schema</span><span class="o">-</span><span class="nx">first</span><span class="w">          </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Schema</span><span class="o">-</span><span class="nx">flexible</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Scale</span><span class="w"> </span><span class="nx">up</span><span class="w">              </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Scale</span><span class="w"> </span><span class="nx">out</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Complex</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">support</span><span class="w"> </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Simple</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">patterns</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Lower</span><span class="w"> </span><span class="nx">availability</span><span class="w">    </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Higher</span><span class="w"> </span><span class="nx">availability</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Higher</span><span class="w"> </span><span class="nx">latency</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="nx">PC</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Lower</span><span class="w"> </span><span class="nx">latency</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">            </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<table>
<thead>
<tr>
<th>Dimension</th>
<th>ACID</th>
<th>BASE</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Target</strong></td>
<td>Correctness above all</td>
<td>Availability above all</td>
</tr>
<tr>
<td><strong>Reads</strong></td>
<td>Always see latest write</td>
<td>May see stale data</td>
</tr>
<tr>
<td><strong>Conflict resolution</strong></td>
<td>Prevent conflicts (locks)</td>
<td>Detect and resolve (CRDTs, LWW)</td>
</tr>
<tr>
<td><strong>Application complexity</strong></td>
<td>Simple (DB handles consistency)</td>
<td>Complex (app handles conflicts)</td>
</tr>
<tr>
<td><strong>Use cases</strong></td>
<td>Banking, inventory, booking</td>
<td>Social feeds, analytics, caching</td>
</tr>
</tbody>
</table>
<h3 id="34-eventual-consistency-models">3.4 Eventual Consistency Models<a class="header-link" href="#34-eventual-consistency-models" title="Permanent link">&para;</a></h3>
<p>"Eventually consistent" is not a single model but a family of consistency guarantees:</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Guarantee</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Strong eventual consistency</strong></td>
<td>Replicas that have received the same set of updates are in the same state (no conflicts)</td>
</tr>
<tr>
<td><strong>Causal consistency</strong></td>
<td>If operation A causally precedes B, all nodes see A before B</td>
</tr>
<tr>
<td><strong>Read-your-writes</strong></td>
<td>A process always sees its own writes</td>
</tr>
<tr>
<td><strong>Monotonic reads</strong></td>
<td>If a process reads value v, subsequent reads will never return a value older than v</td>
</tr>
<tr>
<td><strong>Monotonic writes</strong></td>
<td>Writes from a process are applied in order at all replicas</td>
</tr>
<tr>
<td><strong>Session consistency</strong></td>
<td>Within a session, read-your-writes + monotonic reads</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4-key-value-stores">4. Key-Value Stores<a class="header-link" href="#4-key-value-stores" title="Permanent link">&para;</a></h2>
<h3 id="41-data-model">4.1 Data Model<a class="header-link" href="#41-data-model" title="Permanent link">&para;</a></h3>
<p>The key-value store is the simplest NoSQL data model. It is essentially a distributed hash table:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                  </span>Key-Value<span class="w"> </span>Store<span class="w">                 </span>â”‚
â”‚<span class="w">                                                 </span>â”‚
â”‚<span class="w">   </span>Key<span class="w"> </span>(String)<span class="w">          </span>Value<span class="w"> </span>(Opaque<span class="w"> </span>Blob)<span class="w">     </span>â”‚
â”‚<span class="w">   </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w">         </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w">     </span>â”‚
â”‚<span class="w">   </span>&quot;user:1001&quot;<span class="w">     </span>â†’<span class="w">     </span>{&quot;name&quot;:<span class="w"> </span>&quot;Alice&quot;,<span class="w"> </span>...}<span class="w">  </span>â”‚
â”‚<span class="w">   </span>&quot;session:abc&quot;<span class="w">   </span>â†’<span class="w">     </span>{token_data...}<span class="w">         </span>â”‚
â”‚<span class="w">   </span>&quot;cache:page:42&quot;<span class="w"> </span>â†’<span class="w">     </span>&quot;<span class="nt">&lt;html&gt;</span>...<span class="nt">&lt;/html&gt;</span>&quot;<span class="w">      </span>â”‚
â”‚<span class="w">   </span>&quot;counter:views&quot;<span class="w"> </span>â†’<span class="w">     </span>&quot;1547382&quot;<span class="w">               </span>â”‚
â”‚<span class="w">                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Characteristics</strong>:
- <strong>Keys</strong> are unique strings (or byte arrays)
- <strong>Values</strong> are opaque blobs -- the store does not interpret their contents
- <strong>Operations</strong> are simple: GET, PUT, DELETE (and sometimes atomic increment, TTL)
- <strong>No secondary indexes</strong> (unless added as a separate feature)
- <strong>No JOINs, no aggregations, no complex queries</strong></p>
<h3 id="42-operations">4.2 Operations<a class="header-link" href="#42-operations" title="Permanent link">&para;</a></h3>
<p>The API is minimal by design:</p>
<div class="highlight"><pre><span></span><code>#<span class="w"> </span><span class="nv">Fundamental</span><span class="w"> </span><span class="nv">operations</span>
<span class="nv">PUT</span><span class="ss">(</span><span class="nv">key</span>,<span class="w"> </span><span class="nv">value</span><span class="ss">)</span><span class="w">         </span>#<span class="w"> </span><span class="nv">Store</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">key</span><span class="o">-</span><span class="nv">value</span><span class="w"> </span><span class="nv">pair</span>
<span class="nv">GET</span><span class="ss">(</span><span class="nv">key</span><span class="ss">)</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">value</span><span class="w">        </span>#<span class="w"> </span><span class="nv">Retrieve</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">key</span>
<span class="nv">DELETE</span><span class="ss">(</span><span class="nv">key</span><span class="ss">)</span><span class="w">             </span>#<span class="w"> </span><span class="nv">Remove</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">key</span><span class="o">-</span><span class="nv">value</span><span class="w"> </span><span class="nv">pair</span>

#<span class="w"> </span><span class="nv">Extended</span><span class="w"> </span><span class="nv">operations</span><span class="w"> </span><span class="ss">(</span><span class="nv">vendor</span><span class="o">-</span><span class="nv">specific</span><span class="ss">)</span>
<span class="nv">EXISTS</span><span class="ss">(</span><span class="nv">key</span><span class="ss">)</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">bool</span><span class="w">      </span>#<span class="w"> </span><span class="nv">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">exists</span>
<span class="nv">EXPIRE</span><span class="ss">(</span><span class="nv">key</span>,<span class="w"> </span><span class="nv">ttl</span><span class="ss">)</span><span class="w">        </span>#<span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="nv">time</span><span class="o">-</span><span class="nv">to</span><span class="o">-</span><span class="nv">live</span>
<span class="nv">INCR</span><span class="ss">(</span><span class="nv">key</span><span class="ss">)</span><span class="w">               </span>#<span class="w"> </span><span class="nv">Atomic</span><span class="w"> </span><span class="nv">increment</span>
<span class="nv">MGET</span><span class="ss">(</span><span class="nv">key1</span>,<span class="w"> </span><span class="nv">key2</span>,<span class="w"> </span>...<span class="ss">)</span><span class="w">   </span>#<span class="w"> </span><span class="nv">Batch</span><span class="w"> </span><span class="nv">retrieval</span>
</code></pre></div>

<h3 id="43-redis">4.3 Redis<a class="header-link" href="#43-redis" title="Permanent link">&para;</a></h3>
<p>Redis (Remote Dictionary Server) is an in-memory key-value store that supports rich data structures.</p>
<p><strong>Data structures in Redis</strong>:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis Data Types                                      â”‚
â”‚                                                       â”‚
â”‚  STRING:  &quot;hello&quot;                                     â”‚
â”‚  LIST:    [a, b, c, d]                                â”‚
â”‚  SET:     {a, b, c}                                   â”‚
â”‚  SORTED SET: {(a,1.0), (b,2.5), (c,3.7)}            â”‚
â”‚  HASH:    {field1: val1, field2: val2}                â”‚
â”‚  BITMAP:  01101001...                                 â”‚
â”‚  STREAM:  [(id1, {k:v}), (id2, {k:v}), ...]         â”‚
â”‚  GEOSPATIAL: {(member, lat, lon), ...}                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Example Redis session</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">Strings</span>
<span class="k">SET</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="err">:</span><span class="n">name</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span>
<span class="k">GET</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="err">:</span><span class="n">name</span><span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span>

<span class="err">#</span><span class="w"> </span><span class="n">Hash</span><span class="w"> </span><span class="p">(</span><span class="ow">like</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">mini</span><span class="o">-</span><span class="n">document</span><span class="p">)</span>
<span class="n">HSET</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="ss">&quot;alice@example.com&quot;</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="ss">&quot;30&quot;</span>
<span class="n">HGET</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w"> </span><span class="n">name</span><span class="w">                   </span><span class="err">#</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="ss">&quot;Alice&quot;</span>
<span class="n">HGETALL</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w">                     </span><span class="err">#</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Alice</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">alice</span><span class="nv">@example</span><span class="p">.</span><span class="n">com</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span>

<span class="err">#</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="n">pattern</span><span class="p">)</span>
<span class="n">LPUSH</span><span class="w"> </span><span class="nl">notifications</span><span class="p">:</span><span class="mi">1001</span><span class="w"> </span><span class="ss">&quot;New order #42&quot;</span>
<span class="n">LPUSH</span><span class="w"> </span><span class="nl">notifications</span><span class="p">:</span><span class="mi">1001</span><span class="w"> </span><span class="ss">&quot;Payment received&quot;</span>
<span class="n">LRANGE</span><span class="w"> </span><span class="nl">notifications</span><span class="p">:</span><span class="mi">1001</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="err">#</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;Payment received&quot;, &quot;New order #42&quot;</span><span class="o">]</span>

<span class="err">#</span><span class="w"> </span><span class="n">Sorted</span><span class="w"> </span><span class="k">Set</span><span class="w"> </span><span class="p">(</span><span class="n">leaderboard</span><span class="p">)</span>
<span class="n">ZADD</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="ss">&quot;player:alice&quot;</span>
<span class="n">ZADD</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="mi">2300</span><span class="w"> </span><span class="ss">&quot;player:bob&quot;</span>
<span class="n">ZADD</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="mi">1800</span><span class="w"> </span><span class="ss">&quot;player:charlie&quot;</span>
<span class="n">ZREVRANGE</span><span class="w"> </span><span class="n">leaderboard</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">WITHSCORES</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nl">bob</span><span class="p">:</span><span class="mi">2300</span><span class="p">,</span><span class="w"> </span><span class="nl">charlie</span><span class="p">:</span><span class="mi">1800</span><span class="p">,</span><span class="w"> </span><span class="nl">alice</span><span class="p">:</span><span class="mi">1500</span>

<span class="err">#</span><span class="w"> </span><span class="k">Atomic</span><span class="w"> </span><span class="n">increment</span><span class="w"> </span><span class="p">(</span><span class="n">page</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">counter</span><span class="p">)</span>
<span class="n">INCR</span><span class="w"> </span><span class="nl">page</span><span class="p">:</span><span class="nl">views</span><span class="p">:</span><span class="n">homepage</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="mi">1</span>
<span class="n">INCR</span><span class="w"> </span><span class="nl">page</span><span class="p">:</span><span class="nl">views</span><span class="p">:</span><span class="n">homepage</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="mi">2</span>

<span class="err">#</span><span class="w"> </span><span class="n">TTL</span><span class="w"> </span><span class="p">(</span><span class="k">session</span><span class="w"> </span><span class="n">management</span><span class="p">)</span>
<span class="k">SET</span><span class="w"> </span><span class="k">session</span><span class="err">:</span><span class="n">abc123</span><span class="w"> </span><span class="ss">&quot;{user_id: 1001}&quot;</span><span class="w"> </span><span class="n">EX</span><span class="w"> </span><span class="mi">3600</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="n">Expires</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">hour</span>
<span class="n">TTL</span><span class="w"> </span><span class="k">session</span><span class="err">:</span><span class="n">abc123</span><span class="w">                              </span><span class="err">#</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="mi">3598</span><span class="w"> </span><span class="p">(</span><span class="n">seconds</span><span class="w"> </span><span class="n">remaining</span><span class="p">)</span>
</code></pre></div>

<p><strong>Use cases for Redis</strong>:
- <strong>Caching</strong>: Store frequently accessed data with TTL
- <strong>Session storage</strong>: User sessions with automatic expiration
- <strong>Rate limiting</strong>: Use INCR with EXPIRE for sliding windows
- <strong>Real-time leaderboards</strong>: Sorted sets for ranking
- <strong>Pub/Sub messaging</strong>: Lightweight message broker
- <strong>Distributed locks</strong>: SETNX (SET if Not eXists) for mutual exclusion</p>
<h3 id="44-amazon-dynamodb">4.4 Amazon DynamoDB<a class="header-link" href="#44-amazon-dynamodb" title="Permanent link">&para;</a></h3>
<p>DynamoDB is a fully managed, serverless key-value and document database by AWS.</p>
<p><strong>Key concepts</strong>:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DynamoDB Table                                          â”‚
â”‚                                                         â”‚
â”‚  Partition Key (PK)  â”‚  Sort Key (SK)  â”‚  Attributes    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  &quot;USER#1001&quot;         â”‚  &quot;PROFILE&quot;      â”‚  {name, email} â”‚
â”‚  &quot;USER#1001&quot;         â”‚  &quot;ORDER#001&quot;    â”‚  {total, date} â”‚
â”‚  &quot;USER#1001&quot;         â”‚  &quot;ORDER#002&quot;    â”‚  {total, date} â”‚
â”‚  &quot;USER#1002&quot;         â”‚  &quot;PROFILE&quot;      â”‚  {name, email} â”‚
â”‚                                                         â”‚
â”‚  PK â†’ determines partition (physical location)          â”‚
â”‚  PK + SK â†’ uniquely identifies an item                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Single-table design</strong>: Unlike relational databases where you normalize data into many tables, DynamoDB best practices recommend putting all entities into a single table and using composite keys to model relationships:</p>
<div class="highlight"><pre><span></span><code>PK              SK                  Attributes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
USER#1001       PROFILE             name=Alice, email=...
USER#1001       ORDER#2024-001      total=99.99, status=shipped
USER#1001       ORDER#2024-002      total=45.50, status=pending
PRODUCT#ABC     METADATA            name=Widget, price=9.99
PRODUCT#ABC     REVIEW#1001         rating=5, text=&quot;Great!&quot;
ORDER#2024-001  ITEM#ABC            qty=2, price=9.99
</code></pre></div>

<p><strong>Access patterns</strong> drive the design:
- Get user profile: <code>PK = "USER#1001", SK = "PROFILE"</code>
- List user's orders: <code>PK = "USER#1001", SK begins_with "ORDER#"</code>
- Get order items: <code>PK = "ORDER#2024-001", SK begins_with "ITEM#"</code></p>
<h3 id="45-limitations-of-key-value-stores">4.5 Limitations of Key-Value Stores<a class="header-link" href="#45-limitations-of-key-value-stores" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>No ad-hoc queries</strong>: You can only look up by key; no way to say "find all users in city X"</li>
<li><strong>No relationships</strong>: No JOINs, no foreign keys</li>
<li><strong>Application-level consistency</strong>: The application must manage data consistency across keys</li>
<li><strong>Data modeling complexity</strong>: Denormalization and single-table design require careful upfront planning</li>
</ul>
<hr />
<h2 id="5-document-stores">5. Document Stores<a class="header-link" href="#5-document-stores" title="Permanent link">&para;</a></h2>
<h3 id="51-data-model">5.1 Data Model<a class="header-link" href="#51-data-model" title="Permanent link">&para;</a></h3>
<p>Document stores extend the key-value model by making the value a structured, queryable document (typically JSON or BSON):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;order_1001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;customer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice Chen&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;street&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123 Main St&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;city&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CA&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;zip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;94105&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;product_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;qty&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">9.99</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;product_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;P002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Gadget&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;qty&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">24.99</span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">44.97</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shipped&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-15T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;electronics&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;priority&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Key characteristics</strong>:
- <strong>Self-describing</strong>: Each document contains its structure
- <strong>Nested structures</strong>: Objects within objects, arrays of objects
- <strong>Flexible schema</strong>: Different documents in the same collection can have different fields
- <strong>Rich querying</strong>: Unlike key-value stores, you can query by any field, including nested fields
- <strong>Indexes</strong>: Secondary indexes on any field, including fields within nested objects</p>
<h3 id="52-json-vs-bson">5.2 JSON vs BSON<a class="header-link" href="#52-json-vs-bson" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>JSON</th>
<th>BSON</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Format</strong></td>
<td>Text-based</td>
<td>Binary</td>
</tr>
<tr>
<td><strong>Readability</strong></td>
<td>Human-readable</td>
<td>Machine-optimized</td>
</tr>
<tr>
<td><strong>Data types</strong></td>
<td>String, Number, Boolean, null, Object, Array</td>
<td>20+ types including Date, ObjectId, Decimal128, Binary</td>
</tr>
<tr>
<td><strong>Size</strong></td>
<td>Compact for text</td>
<td>Slightly larger (type prefixes)</td>
</tr>
<tr>
<td><strong>Parsing</strong></td>
<td>Slower (text parsing)</td>
<td>Faster (direct memory mapping)</td>
</tr>
<tr>
<td><strong>Used by</strong></td>
<td>CouchDB, Elasticsearch</td>
<td>MongoDB</td>
</tr>
</tbody>
</table>
<h3 id="53-mongodb">5.3 MongoDB<a class="header-link" href="#53-mongodb" title="Permanent link">&para;</a></h3>
<p>MongoDB is the most popular document database, using BSON as its storage format.</p>
<p><strong>Core concepts</strong>:</p>
<div class="highlight"><pre><span></span><code>Relational           MongoDB
â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€
Database      â†’      Database
Table         â†’      Collection
Row           â†’      Document
Column        â†’      Field
JOIN          â†’      Embedding / $lookup
Primary Key   â†’      _id field
Index         â†’      Index
</code></pre></div>

<p><strong>CRUD Operations</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// INSERT</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span>
<span class="w">  </span><span class="nx">customer</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">product</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">qty</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">9.99</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">product</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Gadget&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">qty</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">24.99</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nx">total</span><span class="o">:</span><span class="w"> </span><span class="mf">44.97</span><span class="p">,</span>
<span class="w">  </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// FIND (Query)</span>
<span class="c1">// Find all pending orders for Alice</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
<span class="w">  </span><span class="s2">&quot;customer.name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span>
<span class="p">});</span>

<span class="c1">// Find orders with total &gt; 100, sorted by date</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="nx">total</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span>
<span class="w">         </span><span class="p">.</span><span class="nx">sort</span><span class="p">({</span><span class="w"> </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">})</span>
<span class="w">         </span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span>

<span class="c1">// Find orders containing a specific product</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;items.product&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Widget&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// UPDATE</span>
<span class="c1">// Set order status to shipped</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;shipped&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">$currentDate</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">updated_at</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Add an item to an existing order</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">(</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$push</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">product</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doohickey&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">qty</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="mf">5.99</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">);</span>

<span class="c1">// DELETE</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cancelled&quot;</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>

<p><strong>Aggregation Pipeline</strong>: MongoDB's framework for complex data processing:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Revenue by product category in the last 30 days</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
<span class="w">  </span><span class="c1">// Stage 1: Filter recent orders</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gte</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">30</span><span class="o">*</span><span class="mf">24</span><span class="o">*</span><span class="mf">60</span><span class="o">*</span><span class="mf">60</span><span class="o">*</span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$ne</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cancelled&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}},</span>
<span class="w">  </span><span class="c1">// Stage 2: Unwind items array (one document per item)</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$unwind</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$items&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="c1">// Stage 3: Group by product and sum revenue</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$group</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$items.product&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">total_revenue</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$sum</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$multiply</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;$items.qty&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;$items.price&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">total_units</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$sum</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$items.qty&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">order_count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$sum</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}},</span>
<span class="w">  </span><span class="c1">// Stage 4: Sort by revenue descending</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$sort</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">total_revenue</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="c1">// Stage 5: Limit to top 10</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">$limit</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="p">}</span>
<span class="p">]);</span>
</code></pre></div>

<h3 id="54-schema-design-patterns">5.4 Schema Design Patterns<a class="header-link" href="#54-schema-design-patterns" title="Permanent link">&para;</a></h3>
<p>In document databases, the key design decision is <strong>embedding vs referencing</strong>:</p>
<p><strong>Embedding</strong> (denormalization):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_1001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;orders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;order_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;O001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">44.97</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;order_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;O002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">89.50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Referencing</strong> (normalization):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Users collection</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_1001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Orders collection</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;O001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_1001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">44.97</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;O002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_1001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">89.50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<p><strong>Decision criteria</strong>:</p>
<table>
<thead>
<tr>
<th>Factor</th>
<th>Embed</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td>Data is read together?</td>
<td>Yes â†’ Embed</td>
<td>No â†’ Reference</td>
</tr>
<tr>
<td>Data size unbounded?</td>
<td>No â†’ Embed</td>
<td>Yes â†’ Reference (16MB doc limit)</td>
</tr>
<tr>
<td>Data updated independently?</td>
<td>No â†’ Embed</td>
<td>Yes â†’ Reference</td>
</tr>
<tr>
<td>Cardinality</td>
<td>One-to-few</td>
<td>One-to-many / Many-to-many</td>
</tr>
</tbody>
</table>
<p><strong>Common patterns</strong>:</p>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Subset</strong></td>
<td>Embed most-used fields, reference the rest</td>
<td>Product summary embedded, full specs referenced</td>
</tr>
<tr>
<td><strong>Extended Reference</strong></td>
<td>Store a copy of frequently accessed fields from a referenced document</td>
<td>Order stores customer name + email (not full profile)</td>
</tr>
<tr>
<td><strong>Computed</strong></td>
<td>Pre-compute and store derived values</td>
<td>Store order total rather than computing from items every time</td>
</tr>
<tr>
<td><strong>Bucket</strong></td>
<td>Group time-series data into buckets</td>
<td>One document per hour of sensor readings</td>
</tr>
<tr>
<td><strong>Outlier</strong></td>
<td>Handle documents that exceed embedding limits differently</td>
<td>Flag "has_overflow" and store excess in overflow collection</td>
</tr>
</tbody>
</table>
<h3 id="55-indexing-in-mongodb">5.5 Indexing in MongoDB<a class="header-link" href="#55-indexing-in-mongodb" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Single-field index</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Compound index</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;customer.email&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Multikey index (on array fields)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;items.product&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Text index (full-text search)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;items.product&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">notes</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// TTL index (auto-delete after expiration)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">expireAfterSeconds</span><span class="o">:</span><span class="w"> </span><span class="mf">3600</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// Unique index</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">unique</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>

<h3 id="56-limitations-of-document-stores">5.6 Limitations of Document Stores<a class="header-link" href="#56-limitations-of-document-stores" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>No multi-document ACID transactions</strong> (historically; MongoDB added them in v4.0, but with performance overhead)</li>
<li><strong>Data duplication</strong>: Denormalization means updates may need to touch many documents</li>
<li><strong>Unbounded document growth</strong>: Documents that grow without limit degrade performance</li>
<li><strong>No built-in referential integrity</strong>: The application must enforce foreign key-like constraints</li>
</ul>
<hr />
<h2 id="6-wide-column-stores">6. Wide-Column Stores<a class="header-link" href="#6-wide-column-stores" title="Permanent link">&para;</a></h2>
<h3 id="61-data-model">6.1 Data Model<a class="header-link" href="#61-data-model" title="Permanent link">&para;</a></h3>
<p>Wide-column stores (also called column-family stores) organize data by columns rather than rows. They should not be confused with columnar analytical databases (like Parquet or ClickHouse); wide-column stores are designed for operational workloads.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Wide</span><span class="o">-</span><span class="k">Column</span><span class="w"> </span><span class="n">Store</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">Row</span><span class="w"> </span><span class="k">Key</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="k">Column</span><span class="w"> </span><span class="nl">Family</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;profile&quot;</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">CF</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;activity&quot;</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">Alice</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">last_login</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">email</span><span class="p">:</span><span class="w"> </span><span class="n">alice</span><span class="nv">@ex</span><span class="p">.</span><span class="n">com</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">page_views</span><span class="p">:</span><span class="w"> </span><span class="mi">1547</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">city</span><span class="p">:</span><span class="w"> </span><span class="n">San</span><span class="w"> </span><span class="n">Francisco</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">user</span><span class="err">:</span><span class="mi">1002</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">Bob</span><span class="w">                 </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">last_login</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">email</span><span class="p">:</span><span class="w"> </span><span class="n">bob</span><span class="nv">@ex</span><span class="p">.</span><span class="n">com</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">page_views</span><span class="p">:</span><span class="w"> </span><span class="mi">892</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">phone</span><span class="p">:</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">555</span><span class="o">-</span><span class="mi">0123</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="nl">last_purchase</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                           </span><span class="err">â”‚</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Note</span><span class="p">:</span><span class="w"> </span><span class="k">user</span><span class="err">:</span><span class="mi">1001</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="ss">&quot;phone&quot;</span><span class="w"> </span><span class="k">column</span><span class="p">,</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">        </span><span class="k">user</span><span class="err">:</span><span class="mi">1002</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="ss">&quot;last_purchase&quot;</span><span class="w"> </span><span class="k">column</span><span class="p">.</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">        </span><span class="k">Each</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">columns</span><span class="err">!</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<p><strong>Key concepts</strong>:
- <strong>Row Key</strong>: The primary identifier, determines data distribution across nodes
- <strong>Column Family</strong>: A group of related columns, defined at table creation time
- <strong>Column</strong>: A name-value pair within a column family
- <strong>Sparse storage</strong>: Rows do not need to have the same columns; empty columns consume no storage
- <strong>Timestamps</strong>: Each cell (row key + column) can store multiple timestamped versions</p>
<h3 id="62-cassandra">6.2 Cassandra<a class="header-link" href="#62-cassandra" title="Permanent link">&para;</a></h3>
<p>Apache Cassandra is a distributed wide-column store designed for high availability with no single point of failure.</p>
<p><strong>Architecture</strong>:</p>
<div class="highlight"><pre><span></span><code>                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚      Cassandra Ring          â”‚
                  â”‚                              â”‚
                  â”‚     N1 â”€â”€â”€ N2                â”‚
                  â”‚    /         \               â”‚
                  â”‚  N6           N3             â”‚
                  â”‚    \         /               â”‚
                  â”‚     N5 â”€â”€â”€ N4                â”‚
                  â”‚                              â”‚
                  â”‚  Every node is equal          â”‚
                  â”‚  (no master/slave)           â”‚
                  â”‚  Data distributed by         â”‚
                  â”‚  consistent hashing          â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>CQL (Cassandra Query Language)</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Create keyspace (like a database)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">KEYSPACE</span><span class="w"> </span><span class="n">ecommerce</span>
<span class="k">WITH</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="s1">&#39;class&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;NetworkTopologyStrategy&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;dc1&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dc2&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="err">}</span><span class="p">;</span>

<span class="c1">-- Create table with compound primary key</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">customer_id</span><span class="w"> </span><span class="n">UUID</span><span class="p">,</span>
<span class="w">  </span><span class="n">order_date</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">order_id</span><span class="w"> </span><span class="n">UUID</span><span class="p">,</span>
<span class="w">  </span><span class="n">total</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">,</span>
<span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">items</span><span class="w"> </span><span class="n">LIST</span><span class="o">&lt;</span><span class="n">FROZEN</span><span class="o">&lt;</span><span class="n">item_type</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">((</span><span class="n">customer_id</span><span class="p">),</span><span class="w"> </span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="n">order_id</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">CLUSTERING</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">order_date</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>

<span class="c1">-- The PRIMARY KEY has two parts:</span>
<span class="c1">--   Partition key: (customer_id) â†’ determines which node stores the data</span>
<span class="c1">--   Clustering key: order_date, order_id â†’ determines sort order within partition</span>

<span class="c1">-- Insert data</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_date</span><span class="p">,</span><span class="w"> </span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">uuid</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;2024-11-15&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">uuid</span><span class="p">(),</span><span class="w"> </span><span class="mi">44</span><span class="p">.</span><span class="mi">97</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;shipped&#39;</span><span class="p">);</span>

<span class="c1">-- Query by partition key (FAST - goes to one node)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">550</span><span class="n">e8400</span><span class="o">-</span><span class="n">e29b</span><span class="o">-</span><span class="mi">41</span><span class="n">d4</span><span class="o">-</span><span class="n">a716</span><span class="o">-</span><span class="mi">446655440000</span><span class="p">;</span>

<span class="c1">-- Query with clustering key range (FAST - sequential read within partition)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">550</span><span class="n">e8400</span><span class="o">-</span><span class="n">e29b</span><span class="o">-</span><span class="mi">41</span><span class="n">d4</span><span class="o">-</span><span class="n">a716</span><span class="o">-</span><span class="mi">446655440000</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2024-01-01&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">;</span>

<span class="c1">-- Query without partition key (SLOW - requires ALLOW FILTERING, scans all nodes)</span>
<span class="c1">-- ANTI-PATTERN: avoid this in production!</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ecommerce</span><span class="p">.</span><span class="n">orders</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span><span class="w"> </span><span class="n">ALLOW</span><span class="w"> </span><span class="n">FILTERING</span><span class="p">;</span>
</code></pre></div>

<p><strong>Data modeling principle</strong>: In Cassandra, you model tables around queries, not around entities. If you have N different queries, you may need N different tables (each optimized for one query).</p>
<h3 id="63-hbase">6.3 HBase<a class="header-link" href="#63-hbase" title="Permanent link">&para;</a></h3>
<p>Apache HBase is a wide-column store built on top of HDFS (Hadoop Distributed File System), inspired by Google's Bigtable.</p>
<p><strong>Key differences from Cassandra</strong>:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Cassandra</th>
<th>HBase</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Architecture</strong></td>
<td>Peer-to-peer (no master)</td>
<td>Master-RegionServer</td>
</tr>
<tr>
<td><strong>Consistency</strong></td>
<td>Tunable (AP by default)</td>
<td>Strong (CP)</td>
</tr>
<tr>
<td><strong>Write path</strong></td>
<td>Log-structured merge tree</td>
<td>Log-structured merge tree</td>
</tr>
<tr>
<td><strong>Storage</strong></td>
<td>Own storage engine</td>
<td>HDFS</td>
</tr>
<tr>
<td><strong>Query language</strong></td>
<td>CQL (SQL-like)</td>
<td>Java API / HBase Shell</td>
</tr>
<tr>
<td><strong>Best for</strong></td>
<td>Write-heavy, multi-datacenter</td>
<td>Random read/write on HDFS data</td>
</tr>
</tbody>
</table>
<h3 id="64-use-cases-for-wide-column-stores">6.4 Use Cases for Wide-Column Stores<a class="header-link" href="#64-use-cases-for-wide-column-stores" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Time-series data</strong>: IoT sensor readings, metrics, logs (row key = device_id, clustering key = timestamp)</li>
<li><strong>Event logging</strong>: Store application events partitioned by user or service</li>
<li><strong>Content management</strong>: Store articles, comments, and metadata</li>
<li><strong>Recommendation engines</strong>: Store user-item interaction matrices</li>
<li><strong>Messaging systems</strong>: Store messages partitioned by conversation</li>
</ul>
<h3 id="65-limitations">6.5 Limitations<a class="header-link" href="#65-limitations" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>No JOINs</strong>: All data for a query must be in one table (denormalized)</li>
<li><strong>Limited secondary indexes</strong>: Querying by non-key columns is expensive</li>
<li><strong>Complex data modeling</strong>: Designing effective partition keys requires deep understanding of access patterns</li>
<li><strong>No multi-partition transactions</strong> (Cassandra added lightweight transactions with Paxos, but they are slow)</li>
</ul>
<hr />
<h2 id="7-graph-databases">7. Graph Databases<a class="header-link" href="#7-graph-databases" title="Permanent link">&para;</a></h2>
<h3 id="71-the-property-graph-model">7.1 The Property Graph Model<a class="header-link" href="#71-the-property-graph-model" title="Permanent link">&para;</a></h3>
<p>Graph databases store data as a network of nodes and edges, making them ideal for data with complex, interconnected relationships.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Property</span><span class="w"> </span><span class="nx">Graph</span><span class="w"> </span><span class="nx">Model</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">NODE</span><span class="w"> </span><span class="p">(</span><span class="nx">Vertex</span><span class="p">)</span><span class="w">                    </span><span class="nx">EDGE</span><span class="w"> </span><span class="p">(</span><span class="nx">Relationship</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">             </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Label</span><span class="p">:</span><span class="w"> </span><span class="nx">Person</span><span class="w">   </span><span class="err">â”‚</span><span class="w">             </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">FOLLOWS</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Properties</span><span class="p">:</span><span class="w">     </span><span class="err">â”‚</span><span class="w">             </span><span class="nx">Properties</span><span class="p">:</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="w"> </span><span class="err">â”‚â”€â”€</span><span class="nx">FOLLOWS</span><span class="err">â”€â”€â–¶</span><span class="w">   </span><span class="nx">since</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2023-01&quot;</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w">       </span><span class="err">â”‚</span><span class="w">             </span><span class="nx">Direction</span><span class="p">:</span><span class="w"> </span><span class="nx">Alice</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Bob</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Nodes</span><span class="w"> </span><span class="nx">have</span><span class="p">:</span><span class="w">                     </span><span class="nx">Edges</span><span class="w"> </span><span class="nx">have</span><span class="p">:</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">One</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">labels</span><span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="nx">Exactly</span><span class="w"> </span><span class="nx">one</span><span class="w"> </span><span class="k">type</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Zero</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">properties</span><span class="w">       </span><span class="o">-</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="nx">direction</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Unique</span><span class="w"> </span><span class="nx">ID</span><span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="nx">Zero</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">properties</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                  </span><span class="o">-</span><span class="w"> </span><span class="nx">Start</span><span class="w"> </span><span class="nx">node</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="nx">node</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<p><strong>Example graph</strong>:</p>
<div class="highlight"><pre><span></span><code>(Alice:Person)â”€â”€[:FOLLOWS]â”€â”€â–¶(Bob:Person)
     â”‚                            â”‚
     â”‚                            â”‚
  [:LIKES]                    [:WROTE]
     â”‚                            â”‚
     â–¼                            â–¼
(Neo4j:Product)              (Review:Review)
  {name: &quot;Neo4j&quot;}             {rating: 5,
                               text: &quot;Great DB!&quot;}
     â–²
     â”‚
  [:MADE_BY]
     â”‚
(Neo4j Inc:Company)
  {founded: 2007}
</code></pre></div>

<h3 id="72-why-graphs">7.2 Why Graphs?<a class="header-link" href="#72-why-graphs" title="Permanent link">&para;</a></h3>
<p>Consider a social network query: "Find friends of friends who also like the same products as me."</p>
<p><strong>In SQL</strong> (relational):</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Friends of friends who like the same products</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">fof</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">me</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">friendships</span><span class="w"> </span><span class="n">f1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">friendships</span><span class="w"> </span><span class="n">f2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">friend_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">user_likes</span><span class="w"> </span><span class="n">ul1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ul1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">user_likes</span><span class="w"> </span><span class="n">ul2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">friend_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ul2</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Alice&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">ul1</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ul2</span><span class="p">.</span><span class="n">product_id</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">friend_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>

<span class="c1">-- This requires multiple JOINs, and performance degrades</span>
<span class="c1">-- exponentially with the depth of traversal.</span>
</code></pre></div>

<p><strong>In Cypher</strong> (Neo4j):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Same query, expressed naturally as a graph traversal</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="p">:</span><span class="n">FRIEND</span><span class="o">]-&gt;</span><span class="p">()</span><span class="o">-[</span><span class="p">:</span><span class="n">FRIEND</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">fof</span><span class="p">:</span><span class="n">Person</span><span class="p">),</span>
<span class="w">      </span><span class="p">(</span><span class="n">me</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">LIKES</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">product</span><span class="p">:</span><span class="n">Product</span><span class="p">)</span><span class="o">&lt;-[</span><span class="p">:</span><span class="n">LIKES</span><span class="o">]-</span><span class="p">(</span><span class="n">fof</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">fof</span><span class="w"> </span><span class="p">&lt;&gt;</span><span class="w"> </span><span class="n">me</span>
<span class="k">RETURN</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">fof</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div>

<p><strong>Performance comparison</strong>: For relationship-heavy queries, graph databases maintain constant performance regardless of dataset size (because traversal is local), while relational databases degrade as tables grow (because JOINs scan larger index structures).</p>
<div class="highlight"><pre><span></span><code>Query Time
    â”‚
    â”‚  Relational (JOIN-based)
    â”‚  â•±
    â”‚ â•±
    â”‚â•±                    Graph DB (traversal-based)
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Data Size
</code></pre></div>

<h3 id="73-cypher-query-language">7.3 Cypher Query Language<a class="header-link" href="#73-cypher-query-language" title="Permanent link">&para;</a></h3>
<p>Cypher is Neo4j's declarative graph query language. Its syntax uses ASCII art to represent graph patterns.</p>
<p><strong>Pattern syntax</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w">              </span><span class="o">--</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">node</span>
<span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Label</span><span class="p">)</span><span class="w">           </span><span class="o">--</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">label</span>
<span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Label</span><span class="w"> </span><span class="p">{</span><span class="n">prop</span><span class="p">:</span><span class="w"> </span><span class="n">v</span><span class="p">})</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="n">filter</span>
<span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">TYPE</span><span class="p">]</span><span class="o">-&gt;</span><span class="w">         </span><span class="o">--</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directed</span><span class="w"> </span><span class="n">relationship</span>
<span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">TYPE</span><span class="o">*</span><span class="mf">1.</span><span class="o">.</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="w">    </span><span class="o">--</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">variable</span><span class="o">-</span><span class="n">length</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">hops</span><span class="p">)</span>
</code></pre></div>

<p><strong>CREATE operations</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Create nodes</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="p">})</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="m">28</span><span class="p">})</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">:</span><span class="n">Product</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Widget&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">:</span><span class="w"> </span><span class="m">9</span><span class="p">.</span><span class="m">99</span><span class="p">})</span>

<span class="c1">// Create relationships</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">}),</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="w"> </span><span class="p">{</span><span class="n">since</span><span class="p">:</span><span class="w"> </span><span class="n">date</span><span class="p">(</span><span class="s">&quot;2023-01-15&quot;</span><span class="p">)}</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">bob</span><span class="p">);</span>

<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">}),</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="p">:</span><span class="n">Product</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Widget&quot;</span><span class="p">})</span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="w"> </span><span class="p">{</span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="n">date</span><span class="p">(</span><span class="s">&quot;2024-03-20&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">qty</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="p">}</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
</code></pre></div>

<p><strong>READ operations</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Find all people Alice follows</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">friend</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">friend</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>

<span class="c1">// Find shortest path between two people</span>
<span class="k">MATCH</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shortestPath</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="p">*</span><span class="o">]-</span><span class="p">(</span><span class="n">bob</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">path</span><span class="p">;</span>

<span class="c1">// Recommendation: products bought by people who bought the same products as Alice</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Product</span><span class="p">)</span><span class="o">&lt;-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="o">]-</span><span class="p">(</span><span class="n">other</span><span class="p">),</span>
<span class="w">      </span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">rec</span><span class="p">:</span><span class="n">Product</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">PURCHASED</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">rec</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">COUNT</span><span class="p">(*)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="m">5</span><span class="p">;</span>

<span class="c1">// PageRank-style influence: who has the most followers?</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">&lt;-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">COUNT</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">followers</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">followers</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="m">10</span><span class="p">;</span>

<span class="c1">// Community detection: find clusters of mutual follows</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div>

<p><strong>UPDATE and DELETE</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Update a property</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span>
<span class="k">SET</span><span class="w"> </span><span class="n">alice</span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">31</span><span class="p">;</span>

<span class="c1">// Add a label</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span>
<span class="k">SET</span><span class="w"> </span><span class="n">alice</span><span class="p">:</span><span class="n">PremiumUser</span><span class="p">;</span>

<span class="c1">// Delete a relationship</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">alice</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-[</span><span class="n">r</span><span class="p">:</span><span class="n">FOLLOWS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">bob</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span>
<span class="k">DELETE</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>

<span class="c1">// Delete a node and all its relationships</span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Eve&quot;</span><span class="p">})</span>
<span class="n">DETACH</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</code></pre></div>

<h3 id="74-graph-use-cases">7.4 Graph Use Cases<a class="header-link" href="#74-graph-use-cases" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>Why Graphs Excel</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Social networks</strong></td>
<td>Friend-of-friend queries, influence, community detection</td>
</tr>
<tr>
<td><strong>Recommendation engines</strong></td>
<td>Collaborative filtering via graph traversal</td>
</tr>
<tr>
<td><strong>Fraud detection</strong></td>
<td>Identify suspicious patterns in transaction networks</td>
</tr>
<tr>
<td><strong>Knowledge graphs</strong></td>
<td>Represent entities and their relationships (Google Knowledge Graph, Wikidata)</td>
</tr>
<tr>
<td><strong>Network/IT operations</strong></td>
<td>Model network topology, trace dependencies, root cause analysis</td>
</tr>
<tr>
<td><strong>Supply chain</strong></td>
<td>Track products through manufacturing, shipping, distribution</td>
</tr>
<tr>
<td><strong>Access control</strong></td>
<td>Model permission hierarchies and inheritance</td>
</tr>
<tr>
<td><strong>Biology</strong></td>
<td>Protein interaction networks, gene regulatory networks</td>
</tr>
</tbody>
</table>
<h3 id="75-limitations-of-graph-databases">7.5 Limitations of Graph Databases<a class="header-link" href="#75-limitations-of-graph-databases" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Not designed for aggregations</strong>: SUM, AVG, GROUP BY are not where graphs shine</li>
<li><strong>Storage overhead</strong>: Storing relationship pointers for every edge uses more space than relational foreign keys</li>
<li><strong>Limited horizontal scaling</strong>: Partitioning a highly connected graph across nodes is an NP-hard problem (graph partitioning)</li>
<li><strong>Smaller ecosystem</strong>: Fewer tools, fewer developers, less community support compared to relational or document databases</li>
<li><strong>Write throughput</strong>: Generally lower than key-value or wide-column stores</li>
</ul>
<hr />
<h2 id="8-comparison-matrix-when-to-use-which-model">8. Comparison Matrix: When to Use Which Model<a class="header-link" href="#8-comparison-matrix-when-to-use-which-model" title="Permanent link">&para;</a></h2>
<h3 id="81-decision-matrix">8.1 Decision Matrix<a class="header-link" href="#81-decision-matrix" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Criterion</th>
<th>Key-Value</th>
<th>Document</th>
<th>Wide-Column</th>
<th>Graph</th>
<th>Relational</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Schema flexibility</strong></td>
<td>High (opaque values)</td>
<td>High (JSON)</td>
<td>Medium (column families fixed)</td>
<td>High (property graph)</td>
<td>Low (fixed schema)</td>
</tr>
<tr>
<td><strong>Query complexity</strong></td>
<td>Key lookup only</td>
<td>Rich queries on fields</td>
<td>Partition-key based</td>
<td>Graph traversal</td>
<td>Full SQL</td>
</tr>
<tr>
<td><strong>Relationships</strong></td>
<td>None</td>
<td>Embedded/referenced</td>
<td>Denormalized</td>
<td>First-class</td>
<td>JOINs</td>
</tr>
<tr>
<td><strong>Write throughput</strong></td>
<td>Very high</td>
<td>High</td>
<td>Very high</td>
<td>Medium</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Read latency</strong></td>
<td>Sub-millisecond</td>
<td>Low</td>
<td>Low (partition key)</td>
<td>Variable (depth)</td>
<td>Variable</td>
</tr>
<tr>
<td><strong>Horizontal scaling</strong></td>
<td>Excellent</td>
<td>Good</td>
<td>Excellent</td>
<td>Limited</td>
<td>Poor</td>
</tr>
<tr>
<td><strong>ACID transactions</strong></td>
<td>Limited</td>
<td>Per-document (multi-doc in some)</td>
<td>Limited</td>
<td>Per-node (some support multi)</td>
<td>Full</td>
</tr>
<tr>
<td><strong>Aggregations</strong></td>
<td>None</td>
<td>Aggregation pipeline</td>
<td>Limited</td>
<td>Limited</td>
<td>Full SQL</td>
</tr>
</tbody>
</table>
<h3 id="82-decision-flowchart">8.2 Decision Flowchart<a class="header-link" href="#82-decision-flowchart" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="w">                         </span><span class="nx">What</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">primary</span><span class="w"> </span><span class="nx">need</span><span class="p">?</span>
<span class="w">                                   </span><span class="err">â”‚</span>
<span class="w">                </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">                </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="w">          </span><span class="nx">High</span><span class="o">-</span><span class="nx">speed</span><span class="w">         </span><span class="nx">Rich</span><span class="w"> </span><span class="nx">queries</span><span class="w">       </span><span class="nx">Complex</span>
<span class="w">          </span><span class="nx">simple</span><span class="w"> </span><span class="nx">lookups</span><span class="w">     </span><span class="nx">on</span><span class="w"> </span><span class="nx">structured</span><span class="w">      </span><span class="nx">relationships</span>
<span class="w">                </span><span class="err">â”‚</span><span class="w">            </span><span class="nx">data</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="w">                </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="w">           </span><span class="nx">Key</span><span class="o">-</span><span class="nx">Value</span><span class="w">          </span><span class="nx">Document</span><span class="w">           </span><span class="nx">Graph</span><span class="w"> </span><span class="nx">DB</span>
<span class="w">           </span><span class="p">(</span><span class="nx">Redis</span><span class="p">,</span><span class="w">            </span><span class="p">(</span><span class="nx">MongoDB</span><span class="p">,</span><span class="w">          </span><span class="p">(</span><span class="nx">Neo4j</span><span class="p">,</span>
<span class="w">            </span><span class="nx">DynamoDB</span><span class="p">)</span><span class="w">          </span><span class="nx">CouchDB</span><span class="p">)</span><span class="w">           </span><span class="nx">Neptune</span><span class="p">)</span>
<span class="w">                                   </span><span class="err">â”‚</span>
<span class="w">                              </span><span class="nx">Need</span><span class="w"> </span><span class="nx">massive</span>
<span class="w">                              </span><span class="nx">write</span><span class="w"> </span><span class="nx">scale</span><span class="p">?</span>
<span class="w">                              </span><span class="err">â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”</span>
<span class="w">                              </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span>
<span class="w">                             </span><span class="nx">Yes</span><span class="w">       </span><span class="nx">No</span>
<span class="w">                              </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span>
<span class="w">                         </span><span class="nx">Wide</span><span class="o">-</span><span class="nx">Column</span><span class="w">  </span><span class="nx">Document</span>
<span class="w">                         </span><span class="p">(</span><span class="nx">Cassandra</span><span class="p">)</span><span class="w">  </span><span class="p">(</span><span class="nx">MongoDB</span><span class="p">)</span>
</code></pre></div>

<h3 id="83-concrete-recommendations">8.3 Concrete Recommendations<a class="header-link" href="#83-concrete-recommendations" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Recommended Model</th>
<th>Reasoning</th>
</tr>
</thead>
<tbody>
<tr>
<td>User sessions</td>
<td>Key-Value (Redis)</td>
<td>Simple GET/SET with TTL</td>
</tr>
<tr>
<td>Product catalog</td>
<td>Document (MongoDB)</td>
<td>Flexible attributes per product category</td>
</tr>
<tr>
<td>IoT time-series</td>
<td>Wide-Column (Cassandra)</td>
<td>Massive write throughput, time-ordered partitions</td>
</tr>
<tr>
<td>Social graph</td>
<td>Graph (Neo4j)</td>
<td>Relationship traversal is the core operation</td>
</tr>
<tr>
<td>Financial transactions</td>
<td>Relational (PostgreSQL)</td>
<td>ACID compliance mandatory</td>
</tr>
<tr>
<td>Content management</td>
<td>Document (MongoDB)</td>
<td>Nested, variable structures</td>
</tr>
<tr>
<td>Real-time analytics</td>
<td>Wide-Column + Key-Value</td>
<td>Cassandra for storage, Redis for caching</td>
</tr>
<tr>
<td>Fraud detection</td>
<td>Graph (Neo4j)</td>
<td>Pattern matching across transaction networks</td>
</tr>
<tr>
<td>Shopping cart</td>
<td>Key-Value (Redis) or Document</td>
<td>Fast read/write, flexible structure</td>
</tr>
<tr>
<td>Recommendation engine</td>
<td>Graph + Document</td>
<td>Graph for relationships, Document for item metadata</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9-polyglot-persistence">9. Polyglot Persistence<a class="header-link" href="#9-polyglot-persistence" title="Permanent link">&para;</a></h2>
<h3 id="91-definition">9.1 Definition<a class="header-link" href="#91-definition" title="Permanent link">&para;</a></h3>
<p>Polyglot persistence is the practice of using different data storage technologies for different parts of an application, based on the specific access patterns and requirements of each component.</p>
<p>The term was coined by Martin Fowler and Pramod Sadalage in 2011.</p>
<h3 id="92-architecture-example">9.2 Architecture Example<a class="header-link" href="#92-architecture-example" title="Permanent link">&para;</a></h3>
<p>Consider an e-commerce platform:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    E-Commerce Platform                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Product      â”‚  â”‚  Order       â”‚  â”‚  User          â”‚        â”‚
â”‚  â”‚  Service      â”‚  â”‚  Service     â”‚  â”‚  Service       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                 â”‚                   â”‚                  â”‚
â”‚         â–¼                 â–¼                   â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  MongoDB     â”‚  â”‚  PostgreSQL  â”‚  â”‚  PostgreSQL    â”‚        â”‚
â”‚  â”‚  (Catalog)   â”‚  â”‚  (Orders)    â”‚  â”‚  (Users)       â”‚        â”‚
â”‚  â”‚              â”‚  â”‚  ACID txns   â”‚  â”‚  Auth + RBAC   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Redis       â”‚  â”‚  Neo4j       â”‚  â”‚  Elasticsearch â”‚        â”‚
â”‚  â”‚  (Cache +    â”‚  â”‚  (Recom-     â”‚  â”‚  (Search)      â”‚        â”‚
â”‚  â”‚   Sessions)  â”‚  â”‚   mendations)â”‚  â”‚                â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚  Cassandra   â”‚  â”‚  S3 / Blob   â”‚                             â”‚
â”‚  â”‚  (Analytics  â”‚  â”‚  (Images,    â”‚                             â”‚
â”‚  â”‚   Events)    â”‚  â”‚   Files)     â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="93-benefits">9.3 Benefits<a class="header-link" href="#93-benefits" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Optimized performance</strong>: Each service uses the database best suited to its access patterns</li>
<li><strong>Independent scaling</strong>: Scale each database independently based on its workload</li>
<li><strong>Technology flexibility</strong>: Teams can adopt the best tool for their specific problem</li>
</ul>
<h3 id="94-challenges">9.4 Challenges<a class="header-link" href="#94-challenges" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Operational complexity</strong>: Multiple database technologies require diverse expertise</li>
<li><strong>Data consistency</strong>: Keeping data synchronized across databases is difficult</li>
<li><strong>Monitoring and debugging</strong>: Different monitoring tools, different log formats</li>
<li><strong>Cross-store queries</strong>: Joining data from MongoDB and PostgreSQL requires application-level logic</li>
<li><strong>Transaction boundaries</strong>: A single business operation may span multiple databases (e.g., "place order" writes to PostgreSQL for the order and Redis for the cache)</li>
</ul>
<h3 id="95-mitigating-challenges">9.5 Mitigating Challenges<a class="header-link" href="#95-mitigating-challenges" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Challenge</th>
<th>Mitigation Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Data consistency</td>
<td>Event-driven architecture (Kafka/RabbitMQ) for eventual consistency</td>
</tr>
<tr>
<td>Cross-store queries</td>
<td>API composition at the application/gateway layer</td>
</tr>
<tr>
<td>Operational complexity</td>
<td>Platform team with shared infrastructure (Kubernetes, Terraform)</td>
</tr>
<tr>
<td>Transaction boundaries</td>
<td>Saga pattern or outbox pattern for distributed transactions</td>
</tr>
<tr>
<td>Monitoring</td>
<td>Unified observability (OpenTelemetry, Grafana)</td>
</tr>
</tbody>
</table>
<h3 id="96-when-not-to-use-polyglot-persistence">9.6 When NOT to Use Polyglot Persistence<a class="header-link" href="#96-when-not-to-use-polyglot-persistence" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Small teams</strong>: The operational overhead is not justified</li>
<li><strong>Simple applications</strong>: A single PostgreSQL instance handles most workloads well</li>
<li><strong>Strict consistency requirements</strong>: Multiple databases make global consistency nearly impossible</li>
<li><strong>Early-stage startups</strong>: Premature optimization; start with one database and split later</li>
</ul>
<blockquote>
<p><strong>Rule of Thumb</strong>: Start with PostgreSQL for everything. When you hit specific, measurable limitations (performance, scale, data model mismatch), then consider introducing a specialized database for that specific use case.</p>
</blockquote>
<hr />
<h2 id="10-exercises">10. Exercises<a class="header-link" href="#10-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-cap-theorem-analysis">Exercise 1: CAP Theorem Analysis<a class="header-link" href="#exercise-1-cap-theorem-analysis" title="Permanent link">&para;</a></h3>
<p>For each of the following systems, classify them as CP or AP. Justify your answer.</p>
<ol>
<li>A banking system that processes wire transfers between accounts.</li>
<li>A social media "likes" counter that shows approximate counts.</li>
<li>A DNS system.</li>
<li>A distributed configuration store (like etcd or ZooKeeper).</li>
<li>A shopping cart service.</li>
</ol>
<h3 id="exercise-2-data-model-selection">Exercise 2: Data Model Selection<a class="header-link" href="#exercise-2-data-model-selection" title="Permanent link">&para;</a></h3>
<p>For each of the following scenarios, choose the most appropriate NoSQL data model (key-value, document, wide-column, or graph) and design a basic schema.</p>
<ol>
<li>
<p><strong>Real-time multiplayer game</strong>: Store player positions, scores, and game state for 100,000 concurrent players. Updates happen 60 times per second per player.</p>
</li>
<li>
<p><strong>Recipe website</strong>: Store recipes with variable ingredients, steps, nutritional information, user ratings, and comments. Users should be able to search by ingredient.</p>
</li>
<li>
<p><strong>Genealogy application</strong>: Store family trees with parent-child relationships, marriages, and historical records spanning centuries.</p>
</li>
<li>
<p><strong>IoT fleet management</strong>: Store GPS coordinates, speed, and fuel level from 50,000 vehicles, sampled every 5 seconds.</p>
</li>
</ol>
<h3 id="exercise-3-redis-design">Exercise 3: Redis Design<a class="header-link" href="#exercise-3-redis-design" title="Permanent link">&para;</a></h3>
<p>Design a Redis data model for a rate limiter that:
- Allows 100 API requests per user per minute
- Returns the remaining request count with each response
- Resets the counter at the start of each minute window</p>
<p>Write the pseudocode for the <code>check_rate_limit(user_id)</code> function using Redis commands.</p>
<h3 id="exercise-4-mongodb-schema-design">Exercise 4: MongoDB Schema Design<a class="header-link" href="#exercise-4-mongodb-schema-design" title="Permanent link">&para;</a></h3>
<p>You are building a blog platform. Design a MongoDB schema considering these access patterns:
1. Display a blog post with all its comments
2. Display the 10 most recent posts by a specific author
3. Display the 10 most recent posts across all authors
4. Count the total number of comments per post</p>
<p>Consider:
- A post can have 0 to 10,000 comments
- Comments can have replies (up to 3 levels deep)
- Authors have profiles with name, bio, and avatar</p>
<p>Provide your schema as JSON document examples and explain your embedding vs referencing decisions.</p>
<h3 id="exercise-5-cassandra-data-modeling">Exercise 5: Cassandra Data Modeling<a class="header-link" href="#exercise-5-cassandra-data-modeling" title="Permanent link">&para;</a></h3>
<p>Design a Cassandra schema for a messaging application with these queries:
1. Get all messages in a conversation, sorted by timestamp (most recent first)
2. Get all conversations for a user, sorted by last activity
3. Get unread message count per conversation for a user</p>
<p>Write the CQL CREATE TABLE statements and explain your partition key and clustering key choices.</p>
<h3 id="exercise-6-cypher-queries">Exercise 6: Cypher Queries<a class="header-link" href="#exercise-6-cypher-queries" title="Permanent link">&para;</a></h3>
<p>Given the following graph:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">WORKS_AT</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Company</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;TechCorp&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">WORKS_AT</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Company</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;TechCorp&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">WORKS_AT</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Company</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;DataInc&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">KNOWS</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">KNOWS</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">KNOWS</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">WORKS_AT</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Company</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;DataInc&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Java&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">})</span>
<span class="p">(</span><span class="o">:</span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">:</span><span class="n">SKILL</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">:</span><span class="n">Technology</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Java&quot;</span><span class="p">})</span>
</code></pre></div>

<p>Write Cypher queries for:
1. Find all people who know someone at "DataInc" (but do not themselves work at DataInc).
2. Find all people who share at least 2 skills with Bob.
3. Find the shortest path between Alice and Charlie.
4. Recommend companies to Alice based on where her connections work (exclude her own company).</p>
<h3 id="exercise-7-polyglot-persistence-design">Exercise 7: Polyglot Persistence Design<a class="header-link" href="#exercise-7-polyglot-persistence-design" title="Permanent link">&para;</a></h3>
<p>You are architecting a ride-sharing platform (similar to Uber/Lyft). The application requires:
- Real-time driver location tracking (updated every 2 seconds)
- Ride booking and payment processing
- Driver and rider profiles with ratings
- Route calculation and ETA estimation
- Ride history and analytics
- Fraud detection (identifying suspicious patterns in ride requests)</p>
<p>Design a polyglot persistence architecture:
1. Identify each data domain and its access patterns.
2. Choose a database technology for each domain. Justify your choice.
3. Draw an architecture diagram showing how data flows between services.
4. Identify the main data consistency challenges and propose solutions.</p>
<h3 id="exercise-8-cap-theorem-proof-extension">Exercise 8: CAP Theorem Proof Extension<a class="header-link" href="#exercise-8-cap-theorem-proof-extension" title="Permanent link">&para;</a></h3>
<p>Extend the Gilbert-Lynch proof sketch from Section 2.3 to show that a <strong>three-node</strong> system (N1, N2, N3) also cannot satisfy C, A, and P simultaneously when the network partitions into two groups: {N1} and {N2, N3}.</p>
<p>Specifically:
1. Define the initial state.
2. Describe the partition.
3. Show the write to the minority partition (N1).
4. Show the read from the majority partition (N2 or N3).
5. Identify the contradiction.</p>
<h3 id="exercise-9-consistency-model-classification">Exercise 9: Consistency Model Classification<a class="header-link" href="#exercise-9-consistency-model-classification" title="Permanent link">&para;</a></h3>
<p>For each scenario below, determine the minimum consistency model required (from strongest to weakest: linearizability, sequential consistency, causal consistency, read-your-writes, eventual consistency):</p>
<ol>
<li>A user updates their profile picture and immediately views their profile page.</li>
<li>In a group chat, if Alice replies to Bob's message, everyone should see Bob's message before Alice's reply.</li>
<li>An inventory system must never oversell a product.</li>
<li>A "like" counter that can be slightly inaccurate but must eventually reflect all likes.</li>
<li>An email system where a user always sees their sent messages in the Sent folder.</li>
</ol>
<h3 id="exercise-10-comparative-analysis">Exercise 10: Comparative Analysis<a class="header-link" href="#exercise-10-comparative-analysis" title="Permanent link">&para;</a></h3>
<p>Write a 500-word essay comparing how you would model a university enrollment system (students, courses, enrollments, professors, departments) using:
1. A relational database (PostgreSQL)
2. A document database (MongoDB)
3. A graph database (Neo4j)</p>
<p>For each model:
- Draw/describe the schema
- Write two representative queries
- List one advantage and one disadvantage of the model for this use case</p>
<hr />
<h2 id="11-references">11. References<a class="header-link" href="#11-references" title="Permanent link">&para;</a></h2>
<ol>
<li>Brewer, E. (2000). "Towards Robust Distributed Systems" (CAP Theorem keynote). ACM PODC.</li>
<li>Gilbert, S. &amp; Lynch, N. (2002). "Brewer's Conjecture and the Feasibility of Consistent, Available, Partition-Tolerant Web Services." ACM SIGACT News.</li>
<li>DeCandia, G. et al. (2007). "Dynamo: Amazon's Highly Available Key-Value Store." SOSP.</li>
<li>Chang, F. et al. (2006). "Bigtable: A Distributed Storage System for Structured Data." OSDI.</li>
<li>Cattell, R. (2011). "Scalable SQL and NoSQL Data Stores." ACM SIGMOD Record.</li>
<li>Sadalage, P. &amp; Fowler, M. (2012). <em>NoSQL Distilled</em>. Addison-Wesley.</li>
<li>Robinson, I., Webber, J., &amp; Eifrem, E. (2015). <em>Graph Databases</em>. O'Reilly Media.</li>
<li>Abadi, D. (2012). "Consistency Tradeoffs in Modern Distributed Database System Design." IEEE Computer.</li>
<li>MongoDB Manual. "Data Modeling Introduction." https://www.mongodb.com/docs/manual/core/data-modeling-introduction/</li>
<li>Apache Cassandra Documentation. https://cassandra.apache.org/doc/latest/</li>
</ol>
<hr />
<p><strong>Previous</strong>: <a href="./12_Concurrency_Control.md">12. Concurrency Control</a> | <strong>Next</strong>: <a href="./14_Distributed_Databases.md">14. Distributed Databases</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/12_Recovery_Systems.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">12. Recovery Systems</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/14_Distributed_Databases.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Distributed Databases</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}