{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewSQL and Modern Trends - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Database_Theory/">Database Theory</a>
    <span class="separator">/</span>
    <span class="current">NewSQL and Modern Trends</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>NewSQL and Modern Trends</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/14_Distributed_Databases.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Distributed Databases</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/16_Database_Design_Case_Study.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Database Design Case Study</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-newsql-motivation-and-design-philosophy">1. NewSQL: Motivation and Design Philosophy</a><ul>
<li><a href="#11-the-gap-between-sql-and-nosql">1.1 The Gap Between SQL and NoSQL</a></li>
<li><a href="#12-newsql-definition">1.2 NewSQL Definition</a></li>
<li><a href="#13-architectural-innovations">1.3 Architectural Innovations</a></li>
<li><a href="#14-newsql-vs-sharded-postgresql">1.4 NewSQL vs Sharded PostgreSQL</a></li>
</ul>
</li>
<li><a href="#2-google-spanner">2. Google Spanner</a><ul>
<li><a href="#21-overview">2.1 Overview</a></li>
<li><a href="#22-truetime">2.2 TrueTime</a></li>
<li><a href="#23-external-consistency-via-commit-wait">2.3 External Consistency via Commit Wait</a></li>
<li><a href="#24-spanner-sql-and-features">2.4 Spanner SQL and Features</a></li>
<li><a href="#25-spanner-summary">2.5 Spanner Summary</a></li>
</ul>
</li>
<li><a href="#3-cockroachdb">3. CockroachDB</a><ul>
<li><a href="#31-overview">3.1 Overview</a></li>
<li><a href="#32-architecture">3.2 Architecture</a></li>
<li><a href="#33-multi-active-availability">3.3 Multi-Active Availability</a></li>
<li><a href="#34-serializable-isolation-without-truetime">3.4 Serializable Isolation Without TrueTime</a></li>
<li><a href="#35-key-features">3.5 Key Features</a></li>
<li><a href="#36-cockroachdb-summary">3.6 CockroachDB Summary</a></li>
</ul>
</li>
<li><a href="#4-tidb">4. TiDB</a><ul>
<li><a href="#41-overview">4.1 Overview</a></li>
<li><a href="#42-architecture">4.2 Architecture</a></li>
<li><a href="#43-htap-bridging-oltp-and-olap">4.3 HTAP: Bridging OLTP and OLAP</a></li>
<li><a href="#44-tidb-summary">4.4 TiDB Summary</a></li>
</ul>
</li>
<li><a href="#5-vector-databases">5. Vector Databases</a><ul>
<li><a href="#51-motivation">5.1 Motivation</a></li>
<li><a href="#52-embeddings">5.2 Embeddings</a></li>
<li><a href="#53-similarity-metrics">5.3 Similarity Metrics</a></li>
<li><a href="#54-approximate-nearest-neighbor-ann-search">5.4 Approximate Nearest Neighbor (ANN) Search</a></li>
<li><a href="#55-vector-database-systems">5.5 Vector Database Systems</a></li>
<li><a href="#56-use-cases-for-vector-databases">5.6 Use Cases for Vector Databases</a></li>
<li><a href="#57-choosing-a-vector-database">5.7 Choosing a Vector Database</a></li>
</ul>
</li>
<li><a href="#6-time-series-databases">6. Time-Series Databases</a><ul>
<li><a href="#61-what-is-time-series-data">6.1 What is Time-Series Data?</a></li>
<li><a href="#62-characteristics-of-time-series-data">6.2 Characteristics of Time-Series Data</a></li>
<li><a href="#63-tsdb-optimizations">6.3 TSDB Optimizations</a></li>
<li><a href="#64-timescaledb">6.4 TimescaleDB</a></li>
<li><a href="#65-influxdb">6.5 InfluxDB</a></li>
<li><a href="#66-tsdb-comparison">6.6 TSDB Comparison</a></li>
</ul>
</li>
<li><a href="#7-graph-analytics-at-scale">7. Graph Analytics at Scale</a><ul>
<li><a href="#71-beyond-graph-databases">7.1 Beyond Graph Databases</a></li>
<li><a href="#72-apache-spark-graphx">7.2 Apache Spark GraphX</a></li>
<li><a href="#73-tigergraph">7.3 TigerGraph</a></li>
<li><a href="#74-graph-analytics-comparison">7.4 Graph Analytics Comparison</a></li>
</ul>
</li>
<li><a href="#8-database-as-a-service">8. Database-as-a-Service</a><ul>
<li><a href="#81-the-serverless-database-trend">8.1 The Serverless Database Trend</a></li>
<li><a href="#82-neon">8.2 Neon</a></li>
<li><a href="#83-planetscale">8.3 PlanetScale</a></li>
<li><a href="#84-supabase">8.4 Supabase</a></li>
<li><a href="#85-dbaas-comparison">8.5 DBaaS Comparison</a></li>
</ul>
</li>
<li><a href="#9-data-lakehouse">9. Data Lakehouse</a><ul>
<li><a href="#91-the-evolution-of-data-architecture">9.1 The Evolution of Data Architecture</a></li>
<li><a href="#92-what-is-a-lakehouse">9.2 What is a Lakehouse?</a></li>
<li><a href="#93-delta-lake">9.3 Delta Lake</a></li>
<li><a href="#94-apache-iceberg">9.4 Apache Iceberg</a></li>
<li><a href="#95-lakehouse-vs-traditional-architectures">9.5 Lakehouse vs Traditional Architectures</a></li>
</ul>
</li>
<li><a href="#10-exercises">10. Exercises</a><ul>
<li><a href="#exercise-1-newsql-comparison">Exercise 1: NewSQL Comparison</a></li>
<li><a href="#exercise-2-truetime-and-commit-wait">Exercise 2: TrueTime and Commit Wait</a></li>
<li><a href="#exercise-3-vector-database-design">Exercise 3: Vector Database Design</a></li>
<li><a href="#exercise-4-time-series-schema-design">Exercise 4: Time-Series Schema Design</a></li>
<li><a href="#exercise-5-htap-scenario-analysis">Exercise 5: HTAP Scenario Analysis</a></li>
<li><a href="#exercise-6-database-selection">Exercise 6: Database Selection</a></li>
<li><a href="#exercise-7-lakehouse-design">Exercise 7: Lakehouse Design</a></li>
<li><a href="#exercise-8-serverless-database-evaluation">Exercise 8: Serverless Database Evaluation</a></li>
<li><a href="#exercise-9-consistent-hashing-in-cockroachdb">Exercise 9: Consistent Hashing in CockroachDB</a></li>
<li><a href="#exercise-10-essay-question">Exercise 10: Essay Question</a></li>
</ul>
</li>
<li><a href="#11-references">11. References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="newsql-and-modern-trends">NewSQL and Modern Trends<a class="header-link" href="#newsql-and-modern-trends" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./14_Distributed_Databases.md">14. Distributed Databases</a> | <strong>Next</strong>: <a href="./16_Database_Design_Case_Study.md">16. Database Design Case Study</a></p>
<hr />
<p>The database landscape has evolved dramatically since the NoSQL revolution. A new generation of systems aims to combine the best of both worlds: the horizontal scalability and availability of NoSQL with the ACID guarantees and SQL interface of relational databases. Beyond NewSQL, entirely new categories of databases have emerged to serve specialized workloads -- vector similarity search for AI, time-series storage for IoT, and graph analytics at scale. This lesson surveys the cutting edge of database technology and the architectural innovations that make these systems possible.</p>
<p><strong>Difficulty</strong>: â­â­â­</p>
<p><strong>Learning Objectives</strong>:
- Explain the NewSQL design philosophy and how it reconciles ACID with horizontal scalability
- Describe Google Spanner's TrueTime mechanism and external consistency
- Compare CockroachDB, TiDB, and Spanner architectures
- Understand vector databases and similarity search algorithms (HNSW, IVF)
- Explain time-series database optimizations
- Evaluate graph analytics platforms for large-scale analysis
- Assess Database-as-a-Service offerings
- Understand the data lakehouse paradigm and its relationship to databases</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-newsql-motivation-and-design-philosophy">NewSQL: Motivation and Design Philosophy</a></li>
<li><a href="#2-google-spanner">Google Spanner</a></li>
<li><a href="#3-cockroachdb">CockroachDB</a></li>
<li><a href="#4-tidb">TiDB</a></li>
<li><a href="#5-vector-databases">Vector Databases</a></li>
<li><a href="#6-time-series-databases">Time-Series Databases</a></li>
<li><a href="#7-graph-analytics-at-scale">Graph Analytics at Scale</a></li>
<li><a href="#8-database-as-a-service">Database-as-a-Service</a></li>
<li><a href="#9-data-lakehouse">Data Lakehouse</a></li>
<li><a href="#10-exercises">Exercises</a></li>
<li><a href="#11-references">References</a></li>
</ol>
<hr />
<h2 id="1-newsql-motivation-and-design-philosophy">1. NewSQL: Motivation and Design Philosophy<a class="header-link" href="#1-newsql-motivation-and-design-philosophy" title="Permanent link">&para;</a></h2>
<h3 id="11-the-gap-between-sql-and-nosql">1.1 The Gap Between SQL and NoSQL<a class="header-link" href="#11-the-gap-between-sql-and-nosql" title="Permanent link">&para;</a></h3>
<p>By the early 2010s, the database world had split into two camps:</p>
<div class="highlight"><pre><span></span><code>Traditional SQL                              NoSQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ ACID transactions      â”‚    â”‚ âœ“ Horizontal scalability â”‚
â”‚ âœ“ SQL interface          â”‚    â”‚ âœ“ High availability      â”‚
â”‚ âœ“ Rich query capability  â”‚    â”‚ âœ“ Flexible schemas       â”‚
â”‚ âœ“ Strong consistency     â”‚    â”‚ âœ“ Low latency            â”‚
â”‚ âœ— Horizontal scaling     â”‚    â”‚ âœ— No ACID (usually)      â”‚
â”‚ âœ— Geographic distributionâ”‚    â”‚ âœ— No SQL (or limited)    â”‚
â”‚ âœ— Auto-failover          â”‚    â”‚ âœ— Weak consistency       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    GAP: Can we have both?

NewSQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ ACID transactions      â”‚
â”‚ âœ“ SQL interface          â”‚
â”‚ âœ“ Horizontal scalability â”‚
â”‚ âœ“ High availability      â”‚
â”‚ âœ“ Strong consistency     â”‚
â”‚ âœ“ Geographic distributionâ”‚
â”‚ âœ“ Auto-failover          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-newsql-definition">1.2 NewSQL Definition<a class="header-link" href="#12-newsql-definition" title="Permanent link">&para;</a></h3>
<p>The term "NewSQL" was coined by Matthew Aslett of the 451 Group in 2011 to describe a new class of relational database management systems that:</p>
<ol>
<li><strong>Provide ACID guarantees</strong> for read-write transactions</li>
<li><strong>Use SQL</strong> as the primary interface</li>
<li><strong>Scale horizontally</strong> across commodity hardware using shared-nothing architecture</li>
<li><strong>Achieve throughput</strong> comparable to or exceeding NoSQL systems for OLTP workloads</li>
</ol>
<h3 id="13-architectural-innovations">1.3 Architectural Innovations<a class="header-link" href="#13-architectural-innovations" title="Permanent link">&para;</a></h3>
<p>NewSQL systems typically employ three key innovations:</p>
<p><strong>1. Sharding with distributed transactions</strong>: Data is automatically partitioned (sharded) across nodes, but the system provides transparent distributed transactions via consensus protocols (Paxos/Raft), making the sharding invisible to the application.</p>
<p><strong>2. Multi-version concurrency control (MVCC)</strong>: Instead of locking, NewSQL systems use MVCC with globally ordered timestamps, allowing reads to proceed without blocking writes.</p>
<p><strong>3. Consensus-based replication</strong>: Each partition (shard) is replicated across multiple nodes using Raft or Paxos, providing both high availability and strong consistency.</p>
<div class="highlight"><pre><span></span><code>NewSQL Architecture (Generic):

Client â”€â”€â–¶ SQL Layer (Parse, Plan, Optimize)
                â”‚
                â–¼
           Transaction Layer (Distributed MVCC, 2PC/Raft)
                â”‚
                â–¼
           Storage Layer (Sharded, Replicated)
           â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
           â”‚Shard 1â”‚  â”‚Shard 2â”‚  â”‚Shard 3â”‚
           â”‚R1,R2,R3â”‚  â”‚R1,R2,R3â”‚  â”‚R1,R2,R3â”‚  â† Each shard has
           â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜     3 replicas (Raft group)
</code></pre></div>

<h3 id="14-newsql-vs-sharded-postgresql">1.4 NewSQL vs Sharded PostgreSQL<a class="header-link" href="#14-newsql-vs-sharded-postgresql" title="Permanent link">&para;</a></h3>
<p>A common question is: "Why not just shard PostgreSQL?" The answer reveals what makes NewSQL special:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Sharded PostgreSQL (Citus)</th>
<th>NewSQL (CockroachDB)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cross-shard transactions</strong></td>
<td>Limited (2PC across shards)</td>
<td>Full ACID (Raft + MVCC)</td>
</tr>
<tr>
<td><strong>Automatic resharding</strong></td>
<td>Manual or semi-automatic</td>
<td>Automatic range splitting</td>
</tr>
<tr>
<td><strong>Schema changes</strong></td>
<td>Rolling DDL required</td>
<td>Online schema changes</td>
</tr>
<tr>
<td><strong>Replication</strong></td>
<td>Async/sync (per shard)</td>
<td>Raft (per range)</td>
</tr>
<tr>
<td><strong>Failover</strong></td>
<td>Manual or scripted</td>
<td>Automatic (Raft leader election)</td>
</tr>
<tr>
<td><strong>Global distribution</strong></td>
<td>Possible but complex</td>
<td>Built-in (geo-partitioning)</td>
</tr>
<tr>
<td><strong>Compatibility</strong></td>
<td>Full PostgreSQL</td>
<td>PostgreSQL wire protocol (subset)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-google-spanner">2. Google Spanner<a class="header-link" href="#2-google-spanner" title="Permanent link">&para;</a></h2>
<h3 id="21-overview">2.1 Overview<a class="header-link" href="#21-overview" title="Permanent link">&para;</a></h3>
<p>Google Spanner, introduced in a 2012 paper, is the first system to distribute data at global scale while providing <strong>externally consistent</strong> (linearizable) transactions. It is the original NewSQL system that inspired all others.</p>
<div class="highlight"><pre><span></span><code>Google Spanner Architecture:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Universe                              â”‚
â”‚                                                             â”‚
â”‚  Zone (US-East)        Zone (EU-West)        Zone (Asia)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Spanserver 1  â”‚    â”‚ Spanserver 4  â”‚    â”‚ Spanserver 7â”‚ â”‚
â”‚  â”‚ Spanserver 2  â”‚    â”‚ Spanserver 5  â”‚    â”‚ Spanserver 8â”‚ â”‚
â”‚  â”‚ Spanserver 3  â”‚    â”‚ Spanserver 6  â”‚    â”‚ Spanserver 9â”‚ â”‚
â”‚  â”‚               â”‚    â”‚               â”‚    â”‚             â”‚ â”‚
â”‚  â”‚ â”Œâ”€TrueTimeâ”€â”  â”‚    â”‚ â”Œâ”€TrueTimeâ”€â”  â”‚    â”‚ â”Œâ”€TrueTimeâ”â”‚ â”‚
â”‚  â”‚ â”‚GPS+Atomicâ”‚  â”‚    â”‚ â”‚GPS+Atomicâ”‚  â”‚    â”‚ â”‚GPS+Atom.â”‚â”‚ â”‚
â”‚  â”‚ â”‚  Clocks  â”‚  â”‚    â”‚ â”‚  Clocks  â”‚  â”‚    â”‚ â”‚ Clocks  â”‚â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="22-truetime">2.2 TrueTime<a class="header-link" href="#22-truetime" title="Permanent link">&para;</a></h3>
<p>The key innovation in Spanner is <strong>TrueTime</strong>, a globally synchronized clock API that returns a time interval rather than a single timestamp.</p>
<div class="highlight"><pre><span></span><code><span class="n">Traditional</span><span class="w"> </span><span class="n">clock</span><span class="p">:</span><span class="w">    </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">T</span><span class="w">           </span><span class="p">(</span><span class="n">single</span><span class="w"> </span><span class="n">point</span><span class="p">,</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="n">error</span><span class="p">)</span>
<span class="n">TrueTime</span><span class="p">:</span><span class="w">            </span><span class="n">TT</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="o">-</span><span class="err">Îµ</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">+</span><span class="err">Îµ</span><span class="p">]</span><span class="w">  </span><span class="p">(</span><span class="n">interval</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">bounded</span><span class="w"> </span><span class="n">error</span><span class="p">)</span>

<span class="n">Where</span><span class="w"> </span><span class="err">Îµ</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="n">uncertainty</span><span class="p">,</span><span class="w"> </span><span class="n">typically</span><span class="w"> </span><span class="mi">1</span><span class="o">-</span><span class="mi">7</span><span class="w"> </span><span class="n">milliseconds</span><span class="o">.</span>

<span class="n">TrueTime</span><span class="w"> </span><span class="n">guarantees</span><span class="p">:</span>
<span class="w">  </span><span class="n">For</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">invocation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">TT</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="n">returning</span><span class="w"> </span><span class="p">[</span><span class="n">earliest</span><span class="p">,</span><span class="w"> </span><span class="n">latest</span><span class="p">]:</span>
<span class="w">    </span><span class="n">earliest</span><span class="w"> </span><span class="err">â‰¤</span><span class="w"> </span><span class="n">actual_time</span><span class="w"> </span><span class="err">â‰¤</span><span class="w"> </span><span class="n">latest</span>

<span class="n">TrueTime</span><span class="w"> </span><span class="n">Implementation</span><span class="p">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">GPS</span><span class="w"> </span><span class="n">receivers</span><span class="p">:</span><span class="w"> </span><span class="n">provide</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">accurate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">nanoseconds</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Atomic</span><span class="w"> </span><span class="n">clocks</span><span class="p">:</span><span class="w"> </span><span class="n">drift</span><span class="w"> </span><span class="n">slowly</span><span class="p">,</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">GPS</span><span class="w"> </span><span class="k">signal</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">lost</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Multiple</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">sources</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">datacenter</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">redundancy</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Marzullo</span><span class="s1">&#39;s algorithm to compute tight bounds</span>
</code></pre></div>

<h3 id="23-external-consistency-via-commit-wait">2.3 External Consistency via Commit Wait<a class="header-link" href="#23-external-consistency-via-commit-wait" title="Permanent link">&para;</a></h3>
<p>Spanner uses TrueTime to achieve <strong>external consistency</strong> (also called strict serializability or linearizability): if transaction T1 commits before transaction T2 starts (in real time), then T1's commit timestamp is less than T2's commit timestamp.</p>
<div class="highlight"><pre><span></span><code>Commit Wait Protocol:

1. Transaction T acquires all locks
2. T picks commit timestamp s = TT.now().latest
3. COMMIT WAIT: T waits until TT.after(s) is true
   i.e., waits until the clock uncertainty has passed
4. T commits with timestamp s and releases locks

Why this works:
  <span class="k">-</span> T picked s = TT.now().latest at some real time t_pick
  <span class="k">-</span> After commit wait, real time t_commit satisfies t_commit &gt; s
  <span class="k">-</span> Any future transaction T&#39; starting after t_commit will get
    s&#39; = TT.now().latest &gt; t_commit &gt; s
  <span class="k">-</span> Therefore s &lt; s&#39; â†’ T serializes before T&#39; (external consistency)

Timeline:
  â”œâ”€â”€â”€â”€â”€â”€â”¤Îµâ”œâ”€â”€â”€â”€â”€â”€â”¤
  |      |s|      |
  |      |        |
  |   TT.now()    |
  |   [T-Îµ, T+Îµ]  |
  |               |
  |    Commit     |
  |    Wait       |
  |               |
  |               â”œâ”€â”€ TT.after(s) = true â†’ COMMIT
</code></pre></div>

<p><strong>Cost of commit wait</strong>: Average ~7ms latency added to every write transaction (the average clock uncertainty).</p>
<h3 id="24-spanner-sql-and-features">2.4 Spanner SQL and Features<a class="header-link" href="#24-spanner-sql-and-features" title="Permanent link">&para;</a></h3>
<p>Spanner supports a dialect of SQL with extensions for distributed semantics:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Create a table with interleaving (co-locate child rows with parent)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Customers</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">CustomerId</span><span class="w"> </span><span class="n">INT64</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">Name</span><span class="w"> </span><span class="n">STRING</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">  </span><span class="n">Email</span><span class="w"> </span><span class="n">STRING</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">CustomerId</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">CustomerId</span><span class="w"> </span><span class="n">INT64</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">OrderId</span><span class="w"> </span><span class="n">INT64</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">Total</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">,</span>
<span class="w">  </span><span class="n">CreatedAt</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">CustomerId</span><span class="p">,</span><span class="w"> </span><span class="n">OrderId</span><span class="p">),</span>
<span class="w">  </span><span class="n">INTERLEAVE</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">PARENT</span><span class="w"> </span><span class="n">Customers</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">;</span>

<span class="c1">-- Interleaving physically co-locates orders with their customer</span>
<span class="c1">-- This eliminates network round-trips for customer-order joins!</span>

<span class="c1">-- Read-write transaction (serializable)</span>
<span class="k">BEGIN</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="p">;</span>
<span class="w">  </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">Accounts</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">AccountId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">Accounts</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Balance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">AccountId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="k">COMMIT</span><span class="p">;</span>

<span class="c1">-- Read-only transaction (no locks, no commit wait)</span>
<span class="c1">-- Uses a snapshot timestamp for consistent reads</span>
<span class="k">SET</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="k">READ</span><span class="w"> </span><span class="k">ONLY</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>

<span class="c1">-- Stale reads (bounded staleness, for lower latency)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span>
<span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">MAX_STALENESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="n">s</span><span class="p">);</span>
</code></pre></div>

<h3 id="25-spanner-summary">2.5 Spanner Summary<a class="header-link" href="#25-spanner-summary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Detail</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Consistency</strong></td>
<td>External consistency (linearizability)</td>
</tr>
<tr>
<td><strong>Clock</strong></td>
<td>TrueTime (GPS + atomic clocks)</td>
</tr>
<tr>
<td><strong>Replication</strong></td>
<td>Multi-Paxos per split</td>
</tr>
<tr>
<td><strong>Partitioning</strong></td>
<td>Range-based, automatic split/merge</td>
</tr>
<tr>
<td><strong>Transactions</strong></td>
<td>2PC across Paxos groups</td>
</tr>
<tr>
<td><strong>SQL</strong></td>
<td>ANSI SQL with extensions</td>
</tr>
<tr>
<td><strong>Availability</strong></td>
<td>99.999% SLA (5 nines)</td>
</tr>
<tr>
<td><strong>Latency</strong></td>
<td>~7ms write (commit wait), low ms reads</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-cockroachdb">3. CockroachDB<a class="header-link" href="#3-cockroachdb" title="Permanent link">&para;</a></h2>
<h3 id="31-overview">3.1 Overview<a class="header-link" href="#31-overview" title="Permanent link">&para;</a></h3>
<p>CockroachDB (CRDB) is an open-source NewSQL database inspired by Spanner but designed to run without specialized hardware (no GPS/atomic clocks). It is named after the cockroach for its resilience -- it is designed to survive failures at every level.</p>
<h3 id="32-architecture">3.2 Architecture<a class="header-link" href="#32-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>CockroachDB Architecture:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SQL Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Gateway  â”‚  â”‚ Gateway  â”‚  â”‚ Gateway  â”‚  (any node)   â”‚
â”‚  â”‚ Node     â”‚  â”‚ Node     â”‚  â”‚ Node     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚              â”‚              â”‚                    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                      â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Distribution Layer                     â”‚  â”‚
â”‚  â”‚  Key space divided into Ranges (~512MB each)       â”‚  â”‚
â”‚  â”‚  Each Range is a Raft group (3+ replicas)          â”‚  â”‚
â”‚  â”‚  Range 1: [a, f)   Range 2: [f, m)   Range 3: ... â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Storage Layer (Pebble)                 â”‚  â”‚
â”‚  â”‚  LSM-tree based key-value store                    â”‚  â”‚
â”‚  â”‚  MVCC timestamps on every key                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="33-multi-active-availability">3.3 Multi-Active Availability<a class="header-link" href="#33-multi-active-availability" title="Permanent link">&para;</a></h3>
<p>Unlike traditional primary-standby setups, CockroachDB has no single leader for the entire database. Each Range has its own Raft leader, and leaders are distributed across all nodes:</p>
<div class="highlight"><pre><span></span><code><span class="nv">Node</span><span class="w"> </span><span class="mi">1</span><span class="w">                  </span><span class="nv">Node</span><span class="w"> </span><span class="mi">2</span><span class="w">                  </span><span class="nv">Node</span><span class="w"> </span><span class="mi">3</span>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">A</span>:<span class="w"> </span><span class="nv">LEADER</span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">A</span>:<span class="w"> </span><span class="nv">Follower</span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">A</span>:<span class="w"> </span><span class="nv">Follower</span>â”‚
â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">B</span>:<span class="w"> </span><span class="nv">Follower</span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">B</span>:<span class="w"> </span><span class="nv">LEADER</span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">B</span>:<span class="w"> </span><span class="nv">Follower</span>â”‚
â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">C</span>:<span class="w"> </span><span class="nv">Follower</span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">C</span>:<span class="w"> </span><span class="nv">Follower</span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Range</span><span class="w"> </span><span class="nv">C</span>:<span class="w"> </span><span class="nv">LEADER</span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Every</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="nv">serves</span><span class="w"> </span><span class="nv">both</span><span class="w"> </span><span class="nv">reads</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="ss">(</span><span class="k">for</span><span class="w"> </span><span class="nv">ranges</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">leads</span><span class="ss">)</span>.
<span class="nv">No</span><span class="w"> </span><span class="nv">single</span><span class="w"> </span><span class="nv">point</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">failure</span><span class="o">!</span>
</code></pre></div>

<h3 id="34-serializable-isolation-without-truetime">3.4 Serializable Isolation Without TrueTime<a class="header-link" href="#34-serializable-isolation-without-truetime" title="Permanent link">&para;</a></h3>
<p>Since CRDB runs on commodity hardware without TrueTime, it uses a different mechanism for transaction ordering:</p>
<p><strong>Hybrid Logical Clocks (HLC)</strong>: Combine a physical clock component with a logical counter.</p>
<div class="highlight"><pre><span></span><code>HLC = (physical_time, logical_counter, node_id)

Rules:
1. Local event: HLC.physical = max(HLC.physical, wall_clock)
                HLC.logical += 1
2. Send message: attach current HLC
3. Receive message with HLC_msg:
   HLC.physical = max(HLC.physical, HLC_msg.physical, wall_clock)
   if HLC.physical == HLC_msg.physical:
     HLC.logical = max(HLC.logical, HLC_msg.logical) + 1
   else:
     HLC.logical = 0
</code></pre></div>

<p><strong>Clock skew handling</strong>: CRDB enforces a maximum clock offset (default 500ms). If clocks drift beyond this, nodes are taken out of the cluster. For transactions that might be affected by clock skew, CRDB uses <strong>uncertainty intervals</strong> and <strong>read refreshes</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Transaction</span><span class="w"> </span><span class="nx">T1</span><span class="w"> </span><span class="nx">reads</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="nx">K</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="nx">t</span><span class="p">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">T1</span><span class="w"> </span><span class="nx">observes</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="nx">V</span><span class="w"> </span><span class="nx">written</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="nx">t_w</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">t_w</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">within</span><span class="w"> </span><span class="nx">T1</span><span class="err">&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">uncertainty</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="p">[</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">max_offset</span><span class="p">]:</span>
<span class="w">    </span><span class="nx">T1</span><span class="w"> </span><span class="nx">cannot</span><span class="w"> </span><span class="nx">determine</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">V</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">written</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">T1</span><span class="w"> </span><span class="nx">started</span>
<span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="nx">T1</span><span class="w"> </span><span class="nx">pushes</span><span class="w"> </span><span class="nx">its</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="nx">forward</span><span class="w"> </span><span class="nx">past</span><span class="w"> </span><span class="nx">t_w</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">retries</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">read</span>

<span class="nx">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">called</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="s">&quot;read restart&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">ensures</span><span class="w"> </span><span class="nx">serializability</span><span class="p">.</span>
</code></pre></div>

<h3 id="35-key-features">3.5 Key Features<a class="header-link" href="#35-key-features" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Geo-partitioning: pin data to specific regions</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">LIST</span><span class="w"> </span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;US&#39;</span><span class="p">),</span>
<span class="w">  </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">eu</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;DE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;FR&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;UK&#39;</span><span class="p">),</span>
<span class="w">  </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">asia</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;JP&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;KR&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SG&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span>
<span class="w">  </span><span class="n">CONFIGURE</span><span class="w"> </span><span class="k">ZONE</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="k">constraints</span><span class="o">=</span><span class="s1">&#39;[+region=us-east1]&#39;</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">eu</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span>
<span class="w">  </span><span class="n">CONFIGURE</span><span class="w"> </span><span class="k">ZONE</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="k">constraints</span><span class="o">=</span><span class="s1">&#39;[+region=europe-west1]&#39;</span><span class="p">;</span>

<span class="c1">-- Follows leader (low-latency reads from nearest replica)</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">CONFIGURE</span><span class="w"> </span><span class="k">ZONE</span><span class="w"> </span><span class="k">USING</span>
<span class="w">  </span><span class="n">lease_preferences</span><span class="o">=</span><span class="s1">&#39;[[+region=us-east1],[+region=europe-west1]]&#39;</span><span class="p">;</span>

<span class="c1">-- Online schema changes (no downtime)</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">discount</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="c1">-- Runs as a background job, no table locks!</span>

<span class="c1">-- Change data capture (CDC)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">CHANGEFEED</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="s1">&#39;kafka://broker:9092&#39;</span><span class="p">;</span>
</code></pre></div>

<h3 id="36-cockroachdb-summary">3.6 CockroachDB Summary<a class="header-link" href="#36-cockroachdb-summary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Detail</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Consistency</strong></td>
<td>Serializable isolation</td>
</tr>
<tr>
<td><strong>Clock</strong></td>
<td>HLC (Hybrid Logical Clock)</td>
</tr>
<tr>
<td><strong>Replication</strong></td>
<td>Raft per Range</td>
</tr>
<tr>
<td><strong>Partitioning</strong></td>
<td>Automatic range splitting (~512MB)</td>
</tr>
<tr>
<td><strong>SQL</strong></td>
<td>PostgreSQL wire protocol compatible</td>
</tr>
<tr>
<td><strong>Geo-distribution</strong></td>
<td>Geo-partitioning, follower reads</td>
</tr>
<tr>
<td><strong>Schema changes</strong></td>
<td>Online, non-blocking</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td>BSL (free for most uses)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4-tidb">4. TiDB<a class="header-link" href="#4-tidb" title="Permanent link">&para;</a></h2>
<h3 id="41-overview">4.1 Overview<a class="header-link" href="#41-overview" title="Permanent link">&para;</a></h3>
<p>TiDB (Ti stands for Titanium) is an open-source NewSQL database created by PingCAP. Its distinguishing feature is <strong>HTAP (Hybrid Transactional/Analytical Processing)</strong>: it can handle both OLTP and OLAP workloads in a single system.</p>
<h3 id="42-architecture">4.2 Architecture<a class="header-link" href="#42-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>TiDB Architecture:

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Client â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼          â–¼          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ TiDB   â”‚ â”‚ TiDB   â”‚ â”‚ TiDB   â”‚   SQL Layer
         â”‚ Server â”‚ â”‚ Server â”‚ â”‚ Server â”‚   (stateless)
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
              â”‚          â”‚          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼          â–¼          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ TiKV   â”‚ â”‚ TiKV   â”‚ â”‚ TiKV   â”‚   Row Store (OLTP)
         â”‚(Raft)  â”‚ â”‚(Raft)  â”‚ â”‚(Raft)  â”‚   (transactional)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼          â–¼          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚TiFlash â”‚ â”‚TiFlash â”‚ â”‚TiFlash â”‚   Column Store (OLAP)
         â”‚(Raft   â”‚ â”‚(Raft   â”‚ â”‚(Raft   â”‚   (analytical)
         â”‚Learner)â”‚ â”‚Learner)â”‚ â”‚Learner)â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Placement Driver (PD): Cluster metadata, timestamp oracle, scheduling
</code></pre></div>

<h3 id="43-htap-bridging-oltp-and-olap">4.3 HTAP: Bridging OLTP and OLAP<a class="header-link" href="#43-htap-bridging-oltp-and-olap" title="Permanent link">&para;</a></h3>
<p>Traditional architectures separate OLTP (write-heavy, row-oriented) and OLAP (read-heavy, column-oriented) into different systems, with ETL pipelines between them. TiDB unifies both:</p>
<div class="highlight"><pre><span></span><code>Traditional Architecture:
  OLTP (MySQL) â”€â”€ETLâ”€â”€â–¶ OLAP (Data Warehouse)
                        (hours of delay)

TiDB HTAP Architecture:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              TiDB                         â”‚
  â”‚                                           â”‚
  â”‚  OLTP query â”€â”€â–¶ TiKV (row store)         â”‚
  â”‚  OLAP query â”€â”€â–¶ TiFlash (column store)   â”‚
  â”‚                                           â”‚
  â”‚  Raft replication: TiKV â”€â”€â–¶ TiFlash      â”‚
  â”‚  (real-time, asynchronous via Raft Learner)â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>TiKV</strong> (row store): Stores data in key-value pairs ordered by primary key. Optimized for point reads and writes (OLTP). Uses Raft for replication and RocksDB for storage.</p>
<p><strong>TiFlash</strong> (column store): Stores the same data in columnar format. Optimized for scans, aggregations, and analytical queries (OLAP). Receives data via Raft Learner protocol (asynchronous, does not affect TiKV write latency).</p>
<p><strong>Query routing</strong>: The TiDB SQL optimizer automatically decides whether to use TiKV or TiFlash for each part of a query:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- OLTP query â†’ routed to TiKV</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12345</span><span class="p">;</span>

<span class="c1">-- OLAP query â†’ routed to TiFlash</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">quantity</span><span class="p">),</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">order_items</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_id</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>

<span class="c1">-- Hybrid query â†’ TiKV for point lookup, TiFlash for aggregation</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">stats</span><span class="p">.</span><span class="n">total_spent</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">c</span>
<span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_spent</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span>
<span class="w">  </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span>
<span class="w">  </span><span class="k">HAVING</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span>
<span class="p">)</span><span class="w"> </span><span class="n">stats</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stats</span><span class="p">.</span><span class="n">customer_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</code></pre></div>

<h3 id="44-tidb-summary">4.4 TiDB Summary<a class="header-link" href="#44-tidb-summary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Detail</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Consistency</strong></td>
<td>Snapshot isolation (default), serializable (optional)</td>
</tr>
<tr>
<td><strong>Clock</strong></td>
<td>Timestamp Oracle (centralized, via PD)</td>
</tr>
<tr>
<td><strong>Replication</strong></td>
<td>Raft per Region</td>
</tr>
<tr>
<td><strong>HTAP</strong></td>
<td>TiKV (row) + TiFlash (column)</td>
</tr>
<tr>
<td><strong>SQL</strong></td>
<td>MySQL wire protocol compatible</td>
</tr>
<tr>
<td><strong>Storage engine</strong></td>
<td>RocksDB (TiKV), ClickHouse-derived (TiFlash)</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td>Apache 2.0 (open source)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5-vector-databases">5. Vector Databases<a class="header-link" href="#5-vector-databases" title="Permanent link">&para;</a></h2>
<h3 id="51-motivation">5.1 Motivation<a class="header-link" href="#51-motivation" title="Permanent link">&para;</a></h3>
<p>The rise of deep learning has created a new data type: <strong>embeddings</strong> -- high-dimensional vectors that represent the semantic meaning of text, images, audio, or any object.</p>
<div class="highlight"><pre><span></span><code>Traditional DB query:          Vector DB query:
&quot;Find user with id = 42&quot;      &quot;Find items similar to this image&quot;
Exact match on a key           Nearest neighbors in vector space

                    â”Œâ”€ Vector Space â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                   â”‚
                    â”‚    â—(cat image)                   â”‚
                    â”‚      â— (kitten image)             â”‚
                    â”‚        â— (query: cat photo)       â”‚
                    â”‚                                   â”‚
                    â”‚                     â—(car image)  â”‚
                    â”‚                   â— (truck image) â”‚
                    â”‚                                   â”‚
                    â”‚ â—(sunset photo)                   â”‚
                    â”‚   â— (beach photo)                 â”‚
                    â”‚                                   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="52-embeddings">5.2 Embeddings<a class="header-link" href="#52-embeddings" title="Permanent link">&para;</a></h3>
<p>An embedding is a learned representation that maps an object to a fixed-dimensional vector such that semantically similar objects have nearby vectors.</p>
<div class="highlight"><pre><span></span><code>Text embeddings (e.g., OpenAI text-embedding-3-small, 1536 dimensions):
  &quot;The cat sat on the mat&quot;   â†’ [0.023, -0.041, 0.108, ..., 0.055]  (1536 dims)
  &quot;A kitten rested on a rug&quot; â†’ [0.021, -0.039, 0.112, ..., 0.051]  (similar!)
  &quot;Stock prices fell today&quot;  â†’ [-0.087, 0.032, -0.005, ..., 0.019] (different)

Image embeddings (e.g., CLIP, 512 dimensions):
  photo_of_cat.jpg â†’ [0.15, -0.23, ..., 0.08]   (512 dims)
  photo_of_dog.jpg â†’ [0.12, -0.19, ..., 0.11]   (nearby in vector space)
</code></pre></div>

<h3 id="53-similarity-metrics">5.3 Similarity Metrics<a class="header-link" href="#53-similarity-metrics" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Formula</th>
<th>Range</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cosine similarity</strong></td>
<td><code>cos(A,B) = (A . B) / (|A| * |B|)</code></td>
<td>[-1, 1]</td>
<td>Text similarity (direction matters)</td>
</tr>
<tr>
<td><strong>Euclidean distance (L2)</strong></td>
<td><code>d = sqrt(sum((a_i - b_i)^2))</code></td>
<td>[0, inf)</td>
<td>Image similarity, spatial data</td>
</tr>
<tr>
<td><strong>Dot product</strong></td>
<td><code>A . B = sum(a_i * b_i)</code></td>
<td>(-inf, inf)</td>
<td>Recommendation (magnitude matters)</td>
</tr>
<tr>
<td><strong>Manhattan distance (L1)</strong></td>
<td><code>d = sum(|a_i - b_i|)</code></td>
<td>[0, inf)</td>
<td>Sparse vectors</td>
</tr>
</tbody>
</table>
<h3 id="54-approximate-nearest-neighbor-ann-search">5.4 Approximate Nearest Neighbor (ANN) Search<a class="header-link" href="#54-approximate-nearest-neighbor-ann-search" title="Permanent link">&para;</a></h3>
<p>Exact nearest neighbor search in high dimensions is computationally prohibitive (curse of dimensionality). Vector databases use <strong>approximate</strong> algorithms that trade a small accuracy loss for massive speed gains.</p>
<p><strong>Inverted File Index (IVF)</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">IVF</span><span class="w"> </span><span class="nv">Algorithm</span>:

<span class="mi">1</span>.<span class="w"> </span><span class="nv">TRAINING</span>:<span class="w"> </span><span class="nv">Cluster</span><span class="w"> </span><span class="nv">vectors</span><span class="w"> </span><span class="nv">into</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">centroids</span><span class="w"> </span><span class="ss">(</span><span class="nv">K</span><span class="o">-</span><span class="nv">means</span><span class="ss">)</span>
<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<span class="w">   </span>â”‚<span class="w">  </span>â—<span class="w">  </span>â—<span class="w"> </span><span class="nv">C1</span><span class="w">        </span>â—<span class="w">  </span>â—<span class="w">  </span>â—<span class="w">           </span>â”‚
<span class="w">   </span>â”‚<span class="w">    </span>â—<span class="w">       </span>â—<span class="w">        </span><span class="nv">C2</span><span class="w">  </span>â—<span class="w">         </span>â”‚
<span class="w">   </span>â”‚<span class="w">                                    </span>â”‚
<span class="w">   </span>â”‚<span class="w">       </span>â—<span class="w"> </span><span class="nv">C3</span><span class="w">                         </span>â”‚
<span class="w">   </span>â”‚<span class="w">     </span>â—<span class="w">    </span>â—<span class="w">                         </span>â”‚
<span class="w">   </span>â”‚<span class="w">    </span>â—<span class="w">                  </span>â—<span class="w"> </span>â—<span class="w">          </span>â”‚
<span class="w">   </span>â”‚<span class="w">                      </span>â—<span class="w">  </span><span class="nv">C4</span><span class="w"> </span>â—<span class="w">      </span>â”‚
<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="w">   </span><span class="nv">C1</span>,<span class="w"> </span><span class="nv">C2</span>,<span class="w"> </span><span class="nv">C3</span>,<span class="w"> </span><span class="nv">C4</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">cluster</span><span class="w"> </span><span class="nv">centroids</span>

<span class="mi">2</span>.<span class="w"> </span><span class="nv">INDEXING</span>:<span class="w"> </span><span class="nv">Assign</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">vector</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">its</span><span class="w"> </span><span class="nv">nearest</span><span class="w"> </span><span class="nv">centroid</span>
<span class="w">   </span><span class="nv">Inverted</span><span class="w"> </span><span class="nv">lists</span>:
<span class="w">   </span><span class="nv">C1</span><span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">v1</span>,<span class="w"> </span><span class="nv">v5</span>,<span class="w"> </span><span class="nv">v12</span>,<span class="w"> </span><span class="nv">v33</span>,<span class="w"> </span>...]
<span class="w">   </span><span class="nv">C2</span><span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">v2</span>,<span class="w"> </span><span class="nv">v7</span>,<span class="w"> </span><span class="nv">v15</span>,<span class="w"> </span><span class="nv">v41</span>,<span class="w"> </span>...]
<span class="w">   </span><span class="nv">C3</span><span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">v3</span>,<span class="w"> </span><span class="nv">v9</span>,<span class="w"> </span><span class="nv">v22</span>,<span class="w"> </span><span class="nv">v37</span>,<span class="w"> </span>...]
<span class="w">   </span><span class="nv">C4</span><span class="w"> </span>â†’<span class="w"> </span>[<span class="nv">v4</span>,<span class="w"> </span><span class="nv">v11</span>,<span class="w"> </span><span class="nv">v19</span>,<span class="w"> </span><span class="nv">v45</span>,<span class="w"> </span>...]

<span class="mi">3</span>.<span class="w"> </span><span class="nv">SEARCH</span>:<span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="nv">q</span>,<span class="w"> </span><span class="nv">find</span><span class="w"> </span><span class="nv">nprobe</span><span class="w"> </span><span class="nv">nearest</span><span class="w"> </span><span class="nv">centroids</span>,
<span class="w">   </span><span class="k">then</span><span class="w"> </span><span class="nv">search</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">those</span><span class="w"> </span><span class="nv">clusters</span><span class="err">&#39; vectors</span>
<span class="err">   nprobe=1: search 1 cluster (fast, less accurate)</span>
<span class="err">   nprobe=K: search all clusters (slow, exact)</span>
</code></pre></div>

<p><strong>HNSW (Hierarchical Navigable Small World)</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">HNSW</span><span class="w"> </span><span class="nv">Algorithm</span>:

<span class="nv">Build</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">multi</span><span class="o">-</span><span class="nv">layer</span><span class="w"> </span><span class="nv">graph</span><span class="w"> </span><span class="nv">where</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">Layer</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ss">(</span><span class="nv">bottom</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">contains</span><span class="w"> </span><span class="nv">ALL</span><span class="w"> </span><span class="nv">vectors</span>,<span class="w"> </span><span class="nv">densely</span><span class="w"> </span><span class="nv">connected</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Layer</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">contains</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">SUBSET</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">vectors</span>,<span class="w"> </span><span class="nv">sparser</span><span class="w"> </span><span class="nv">connections</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Layer</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">even</span><span class="w"> </span><span class="nv">fewer</span><span class="w"> </span><span class="nv">vectors</span>,<span class="w"> </span><span class="nv">even</span><span class="w"> </span><span class="nv">sparser</span>
<span class="o">-</span><span class="w"> </span>...
<span class="o">-</span><span class="w"> </span><span class="nv">Top</span><span class="w"> </span><span class="nv">layer</span>:<span class="w"> </span><span class="nv">very</span><span class="w"> </span><span class="nv">few</span><span class="w"> </span><span class="nv">vectors</span>,<span class="w"> </span><span class="nv">long</span><span class="o">-</span><span class="nv">range</span><span class="w"> </span><span class="nv">connections</span>

<span class="nv">Search</span><span class="w"> </span><span class="nv">traversal</span>:

<span class="nv">Layer</span><span class="w"> </span><span class="mi">3</span>:<span class="w">  </span><span class="nv">A</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">B</span><span class="w">          </span><span class="ss">(</span><span class="nv">few</span><span class="w"> </span><span class="nv">nodes</span>,<span class="w"> </span><span class="nv">long</span><span class="w"> </span><span class="nv">jumps</span><span class="ss">)</span>
<span class="w">          </span>â”‚<span class="w">                     </span>â”‚
<span class="nv">Layer</span><span class="w"> </span><span class="mi">2</span>:<span class="w">  </span><span class="nv">A</span><span class="w"> </span>â”€â”€â”€â”€<span class="w"> </span><span class="nv">C</span><span class="w"> </span>â”€â”€â”€â”€<span class="w"> </span><span class="nv">D</span><span class="w"> </span>â”€â”€â”€â”€<span class="w"> </span><span class="nv">B</span><span class="w">          </span><span class="ss">(</span><span class="nv">more</span><span class="w"> </span><span class="nv">nodes</span><span class="ss">)</span>
<span class="w">          </span>â”‚<span class="w">      </span>â”‚<span class="w">      </span>â”‚<span class="w">      </span>â”‚
<span class="nv">Layer</span><span class="w"> </span><span class="mi">1</span>:<span class="w">  </span><span class="nv">A</span><span class="w"> </span>â”€<span class="w"> </span><span class="nv">E</span><span class="w"> </span>â”€<span class="w"> </span><span class="nv">C</span><span class="w"> </span>â”€<span class="w"> </span><span class="nv">F</span><span class="w"> </span>â”€<span class="w"> </span><span class="nv">D</span><span class="w"> </span>â”€<span class="w"> </span><span class="nv">G</span><span class="w"> </span>â”€<span class="w"> </span><span class="nv">B</span><span class="w">      </span><span class="ss">(</span><span class="nv">even</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">nodes</span><span class="ss">)</span>
<span class="w">          </span>â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”‚
<span class="nv">Layer</span><span class="w"> </span><span class="mi">0</span>:<span class="w">  </span><span class="nv">A</span><span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="nv">H</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">J</span><span class="w"> </span><span class="nv">D</span><span class="w"> </span><span class="nv">K</span><span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">M</span><span class="w">      </span><span class="ss">(</span><span class="nv">all</span><span class="w"> </span><span class="nv">nodes</span>,<span class="w"> </span><span class="nv">short</span><span class="w"> </span><span class="nv">connections</span><span class="ss">)</span>
<span class="w">                              </span>â†‘
<span class="w">                          </span><span class="nv">query</span><span class="w"> </span><span class="nv">point</span>

<span class="nv">Search</span>:<span class="w"> </span><span class="nv">Start</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">top</span><span class="w"> </span><span class="nv">layer</span>,<span class="w"> </span><span class="nv">greedily</span><span class="w"> </span><span class="nv">move</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">nearest</span><span class="w"> </span><span class="nv">neighbor</span>,
<span class="w">        </span><span class="nv">descend</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="nv">layer</span>,<span class="w"> </span><span class="nv">repeat</span>.
<span class="w">        </span><span class="nv">At</span><span class="w"> </span><span class="nv">Layer</span><span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="nv">explore</span><span class="w"> </span><span class="nv">local</span><span class="w"> </span><span class="nv">neighborhood</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">final</span><span class="w"> </span><span class="nb">result</span>.

<span class="nv">Time</span><span class="w"> </span><span class="nv">complexity</span>:<span class="w"> </span><span class="nv">O</span><span class="ss">(</span><span class="nv">log</span><span class="w"> </span><span class="nv">N</span><span class="ss">)</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="ss">(</span><span class="nv">vs</span><span class="w"> </span><span class="nv">O</span><span class="ss">(</span><span class="nv">N</span><span class="ss">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">brute</span><span class="w"> </span><span class="nv">force</span><span class="ss">)</span>
</code></pre></div>

<h3 id="55-vector-database-systems">5.5 Vector Database Systems<a class="header-link" href="#55-vector-database-systems" title="Permanent link">&para;</a></h3>
<p><strong>Pinecone</strong> (fully managed):</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pinecone</span>

<span class="c1"># Initialize</span>
<span class="n">pinecone</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="s2">&quot;us-east-1-aws&quot;</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">pinecone</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;product-search&quot;</span><span class="p">)</span>

<span class="c1"># Upsert vectors</span>
<span class="n">index</span><span class="o">.</span><span class="n">upsert</span><span class="p">(</span><span class="n">vectors</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;prod_1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;electronics&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mf">99.99</span><span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;prod_2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;clothing&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mf">49.99</span><span class="p">}),</span>
<span class="p">])</span>

<span class="c1"># Query: find 5 most similar products</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="n">vector</span><span class="o">=</span><span class="p">[</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">],</span>  <span class="c1"># query embedding</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="nb">filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="s2">&quot;electronics&quot;</span><span class="p">}},</span>  <span class="c1"># metadata filter</span>
    <span class="n">include_metadata</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>Milvus</strong> (open source):</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pymilvus</span><span class="w"> </span><span class="kn">import</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">FieldSchema</span><span class="p">,</span> <span class="n">CollectionSchema</span><span class="p">,</span> <span class="n">DataType</span>

<span class="c1"># Define schema</span>
<span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">FieldSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">is_primary</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">FieldSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;embedding&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">FLOAT_VECTOR</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">768</span><span class="p">),</span>
    <span class="n">FieldSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">CollectionSchema</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
<span class="n">collection</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

<span class="c1"># Create HNSW index</span>
<span class="n">index_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="s2">&quot;COSINE&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_type&quot;</span><span class="p">:</span> <span class="s2">&quot;HNSW&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;efConstruction&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">collection</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;embedding&quot;</span><span class="p">,</span> <span class="n">index_params</span><span class="p">)</span>

<span class="c1"># Search</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">query_embedding</span><span class="p">],</span>
    <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;embedding&quot;</span><span class="p">,</span>
    <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="s2">&quot;COSINE&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ef&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}},</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>pgvector</strong> (PostgreSQL extension):</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Enable extension</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="n">vector</span><span class="p">;</span>

<span class="c1">-- Create table with vector column</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">documents</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">content</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">embedding</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="mi">1536</span><span class="p">)</span><span class="w">  </span><span class="c1">-- 1536-dimensional vector</span>
<span class="p">);</span>

<span class="c1">-- Create HNSW index</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">documents</span>
<span class="w">  </span><span class="k">USING</span><span class="w"> </span><span class="n">hnsw</span><span class="w"> </span><span class="p">(</span><span class="n">embedding</span><span class="w"> </span><span class="n">vector_cosine_ops</span><span class="p">)</span>
<span class="w">  </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">ef_construction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>

<span class="c1">-- Insert</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">documents</span><span class="w"> </span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">embedding</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;The cat sat on the mat&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[0.023, -0.041, ...]&#39;</span><span class="p">);</span>

<span class="c1">-- Similarity search (cosine distance)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">embedding</span><span class="w"> </span><span class="o">&lt;=&gt;</span><span class="w"> </span><span class="s1">&#39;[0.025, -0.038, ...]&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">similarity</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">documents</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">embedding</span><span class="w"> </span><span class="o">&lt;=&gt;</span><span class="w"> </span><span class="s1">&#39;[0.025, -0.038, ...]&#39;</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="c1">-- Hybrid search: vector similarity + metadata filter</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">embedding</span><span class="w"> </span><span class="o">&lt;=&gt;</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">similarity</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">documents</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;science&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">embedding</span><span class="w"> </span><span class="o">&lt;=&gt;</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>

<h3 id="56-use-cases-for-vector-databases">5.6 Use Cases for Vector Databases<a class="header-link" href="#56-use-cases-for-vector-databases" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Semantic search</strong></td>
<td>Find documents by meaning, not just keywords</td>
</tr>
<tr>
<td><strong>RAG (Retrieval-Augmented Generation)</strong></td>
<td>Store knowledge base embeddings; retrieve context for LLM prompts</td>
</tr>
<tr>
<td><strong>Recommendation systems</strong></td>
<td>Find items similar to user preferences (collaborative filtering via embeddings)</td>
</tr>
<tr>
<td><strong>Image search</strong></td>
<td>Find visually similar images</td>
</tr>
<tr>
<td><strong>Anomaly detection</strong></td>
<td>Identify vectors far from normal clusters</td>
</tr>
<tr>
<td><strong>Deduplication</strong></td>
<td>Find near-duplicate documents or images</td>
</tr>
<tr>
<td><strong>Multimodal search</strong></td>
<td>Search across text, images, and audio using shared embedding spaces (CLIP)</td>
</tr>
</tbody>
</table>
<h3 id="57-choosing-a-vector-database">5.7 Choosing a Vector Database<a class="header-link" href="#57-choosing-a-vector-database" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>System</th>
<th>Type</th>
<th>Hosting</th>
<th>Strengths</th>
<th>Limitations</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Pinecone</strong></td>
<td>Managed</td>
<td>Cloud only</td>
<td>Simple API, auto-scaling</td>
<td>Vendor lock-in, cost</td>
</tr>
<tr>
<td><strong>Milvus</strong></td>
<td>Open source</td>
<td>Self-hosted / Zilliz Cloud</td>
<td>Feature-rich, GPU support</td>
<td>Operational complexity</td>
</tr>
<tr>
<td><strong>Weaviate</strong></td>
<td>Open source</td>
<td>Self-hosted / Cloud</td>
<td>GraphQL API, modules</td>
<td>Newer, smaller ecosystem</td>
</tr>
<tr>
<td><strong>Qdrant</strong></td>
<td>Open source</td>
<td>Self-hosted / Cloud</td>
<td>Rust-based (fast), filtering</td>
<td>Smaller community</td>
</tr>
<tr>
<td><strong>pgvector</strong></td>
<td>Extension</td>
<td>Any PostgreSQL</td>
<td>No new infra, full SQL</td>
<td>Limited scale, no GPU</td>
</tr>
<tr>
<td><strong>Chroma</strong></td>
<td>Open source</td>
<td>Embedded / Server</td>
<td>Simple, Python-native</td>
<td>Limited production features</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6-time-series-databases">6. Time-Series Databases<a class="header-link" href="#6-time-series-databases" title="Permanent link">&para;</a></h2>
<h3 id="61-what-is-time-series-data">6.1 What is Time-Series Data?<a class="header-link" href="#61-what-is-time-series-data" title="Permanent link">&para;</a></h3>
<p>Time-series data consists of measurements or events indexed by time. It has unique characteristics that general-purpose databases handle poorly.</p>
<div class="highlight"><pre><span></span><code>Time-series data examples:

IoT sensor readings:
  timestamp            | device_id | temperature | humidity
  2024-11-15T10:00:00  | sensor_42 | 23.5        | 65.2
  2024-11-15T10:00:01  | sensor_42 | 23.6        | 65.1
  2024-11-15T10:00:02  | sensor_42 | 23.5        | 65.3
  ...

Application metrics:
  timestamp            | service   | metric     | value
  2024-11-15T10:00:00  | api-gw    | latency_ms | 42
  2024-11-15T10:00:00  | api-gw    | req_count  | 1547
  2024-11-15T10:00:00  | api-gw    | error_rate | 0.02
  ...
</code></pre></div>

<h3 id="62-characteristics-of-time-series-data">6.2 Characteristics of Time-Series Data<a class="header-link" href="#62-characteristics-of-time-series-data" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>Implication</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Write-heavy</strong></td>
<td>Continuous ingestion, rarely updated after write</td>
</tr>
<tr>
<td><strong>Time-ordered</strong></td>
<td>Data naturally ordered by timestamp; most queries involve time ranges</td>
</tr>
<tr>
<td><strong>Append-only</strong></td>
<td>New data is always newer; old data is rarely modified</td>
</tr>
<tr>
<td><strong>High cardinality</strong></td>
<td>Millions of unique series (device_id x metric combinations)</td>
</tr>
<tr>
<td><strong>Downsampling</strong></td>
<td>Old data can be aggregated (1-second â†’ 1-minute â†’ 1-hour)</td>
</tr>
<tr>
<td><strong>TTL (expiry)</strong></td>
<td>Old data has diminishing value; auto-delete after retention period</td>
</tr>
<tr>
<td><strong>Compression</strong></td>
<td>Temporal locality enables high compression ratios (10-20x)</td>
</tr>
</tbody>
</table>
<h3 id="63-tsdb-optimizations">6.3 TSDB Optimizations<a class="header-link" href="#63-tsdb-optimizations" title="Permanent link">&para;</a></h3>
<p><strong>Time-based partitioning</strong>: Data is automatically partitioned by time, enabling efficient time-range queries and data lifecycle management.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Time-based partitioning                             â”‚
â”‚                                                     â”‚
â”‚  Chunk 1        Chunk 2        Chunk 3        ...   â”‚
â”‚  [Nov 1-7]     [Nov 8-14]    [Nov 15-21]          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Data â”‚      â”‚ Data â”‚      â”‚ Data â”‚              â”‚
â”‚  â”‚ Indexâ”‚      â”‚ Indexâ”‚      â”‚ Indexâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                     â”‚
â”‚  Query: WHERE time &gt; &#39;Nov 10&#39; AND time &lt; &#39;Nov 20&#39;  â”‚
â”‚  â†’ Only scans Chunk 2 and Chunk 3!                  â”‚
â”‚                                                     â”‚
â”‚  Retention: DROP Chunk 1 (instant, no row-by-row)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Delta-of-delta compression</strong>: Consecutive timestamps are similar (e.g., every 10 seconds). Store the delta between deltas.</p>
<div class="highlight"><pre><span></span><code><span class="nv">Raw</span><span class="w"> </span><span class="nv">timestamps</span>:<span class="w">     </span><span class="mi">1700000000</span>,<span class="w"> </span><span class="mi">1700000010</span>,<span class="w"> </span><span class="mi">1700000020</span>,<span class="w"> </span><span class="mi">1700000030</span>
<span class="nv">Deltas</span>:<span class="w">                        </span><span class="mi">10</span>,<span class="w">          </span><span class="mi">10</span>,<span class="w">          </span><span class="mi">10</span>
<span class="nv">Delta</span><span class="o">-</span><span class="nv">of</span><span class="o">-</span><span class="nv">deltas</span>:<span class="w">                            </span><span class="mi">0</span>,<span class="w">           </span><span class="mi">0</span>

<span class="nv">Compression</span>:<span class="w"> </span><span class="nv">store</span><span class="w"> </span><span class="nv">base</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">delta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">delta</span><span class="o">-</span><span class="nv">of</span><span class="o">-</span><span class="nv">deltas</span>
<span class="w">  </span><span class="mi">1700000000</span>,<span class="w"> </span><span class="mi">10</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="ss">(</span><span class="mi">4</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="nv">instead</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nv">full</span><span class="w"> </span><span class="nv">timestamps</span><span class="ss">)</span>

<span class="k">For</span><span class="w"> </span><span class="nv">values</span>:<span class="w"> </span><span class="nv">Gorilla</span><span class="w"> </span><span class="nv">compression</span><span class="w"> </span><span class="ss">(</span><span class="nv">XOR</span><span class="o">-</span><span class="nv">based</span>,<span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">Facebook</span><span class="err">&#39;s Gorilla paper)</span>
<span class="err">  If consecutive values are similar, XOR is mostly zeros â†’ compress well</span>
</code></pre></div>

<p><strong>Downsampling</strong>: Automatically aggregate old data to reduce storage.</p>
<div class="highlight"><pre><span></span><code>Raw data (1-second resolution):     â†’ 86,400 points/day/series
After 7 days: downsample to 1-min  â†’ 1,440 points/day/series
After 30 days: downsample to 1-hr  â†’ 24 points/day/series
After 1 year: downsample to 1-day  â†’ 1 point/day/series

Storage reduction: 86,400x over 1 year!
</code></pre></div>

<h3 id="64-timescaledb">6.4 TimescaleDB<a class="header-link" href="#64-timescaledb" title="Permanent link">&para;</a></h3>
<p>TimescaleDB is a time-series extension for PostgreSQL, preserving full SQL capability.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Create a hypertable (auto-partitioned by time)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">metrics</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">time</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">device_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">temperature</span><span class="w"> </span><span class="n">DOUBLE</span><span class="w"> </span><span class="k">PRECISION</span><span class="p">,</span>
<span class="w">  </span><span class="n">humidity</span><span class="w"> </span><span class="n">DOUBLE</span><span class="w"> </span><span class="k">PRECISION</span>
<span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">create_hypertable</span><span class="p">(</span><span class="s1">&#39;metrics&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;time&#39;</span><span class="p">);</span>

<span class="c1">-- Automatic partitioning by time (chunks)</span>
<span class="c1">-- Each chunk is a separate PostgreSQL table</span>

<span class="c1">-- Continuous aggregate (materialized, auto-refreshing)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">hourly_stats</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">timescaledb</span><span class="p">.</span><span class="n">continuous</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span>
<span class="k">SELECT</span>
<span class="w">  </span><span class="n">time_bucket</span><span class="p">(</span><span class="s1">&#39;1 hour&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">bucket</span><span class="p">,</span>
<span class="w">  </span><span class="n">device_id</span><span class="p">,</span>
<span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_temp</span><span class="p">,</span>
<span class="w">  </span><span class="k">MAX</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">max_temp</span><span class="p">,</span>
<span class="w">  </span><span class="k">MIN</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">min_temp</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">metrics</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">bucket</span><span class="p">,</span><span class="w"> </span><span class="n">device_id</span><span class="p">;</span>

<span class="c1">-- Retention policy (auto-delete old data)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">add_retention_policy</span><span class="p">(</span><span class="s1">&#39;metrics&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;90 days&#39;</span><span class="p">);</span>

<span class="c1">-- Compression policy</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">metrics</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">timescaledb</span><span class="p">.</span><span class="n">compress</span><span class="p">,</span>
<span class="w">  </span><span class="n">timescaledb</span><span class="p">.</span><span class="n">compress_segmentby</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;device_id&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n">timescaledb</span><span class="p">.</span><span class="n">compress_orderby</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;time DESC&#39;</span>
<span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">add_compression_policy</span><span class="p">(</span><span class="s1">&#39;metrics&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;7 days&#39;</span><span class="p">);</span>

<span class="c1">-- Query: last 24 hours, 5-minute averages</span>
<span class="k">SELECT</span>
<span class="w">  </span><span class="n">time_bucket</span><span class="p">(</span><span class="s1">&#39;5 minutes&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">bucket</span><span class="p">,</span>
<span class="w">  </span><span class="n">device_id</span><span class="p">,</span>
<span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_temp</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">metrics</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;24 hours&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">device_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;sensor_42&#39;</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">bucket</span><span class="p">,</span><span class="w"> </span><span class="n">device_id</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">bucket</span><span class="p">;</span>
</code></pre></div>

<h3 id="65-influxdb">6.5 InfluxDB<a class="header-link" href="#65-influxdb" title="Permanent link">&para;</a></h3>
<p>InfluxDB is a purpose-built time-series database with its own query language (Flux) and line protocol.</p>
<div class="highlight"><pre><span></span><code><span class="p">#</span><span class="w"> </span><span class="n">InfluxDB</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="n">Protocol</span><span class="w"> </span><span class="p">(</span><span class="n">write</span><span class="p">)</span>
<span class="n">cpu</span><span class="p">,</span><span class="n">host</span><span class="o">=</span><span class="n">server01</span><span class="p">,</span><span class="n">region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="w"> </span><span class="n">usage</span><span class="o">=</span><span class="mf">0.72</span><span class="p">,</span><span class="n">system</span><span class="o">=</span><span class="mf">0.15</span><span class="w"> </span><span class="mh">1700000000000000000</span>
<span class="n">cpu</span><span class="p">,</span><span class="n">host</span><span class="o">=</span><span class="n">server02</span><span class="p">,</span><span class="n">region</span><span class="o">=</span><span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="w"> </span><span class="n">usage</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span><span class="n">system</span><span class="o">=</span><span class="mf">0.08</span><span class="w"> </span><span class="mh">1700000000000000000</span>

<span class="p">#</span><span class="w"> </span><span class="nl">Structure:</span><span class="w"> </span><span class="n">measurement</span><span class="p">,</span><span class="n">tag_key</span><span class="o">=</span><span class="n">tag_value</span><span class="w"> </span><span class="n">field_key</span><span class="o">=</span><span class="n">field_value</span><span class="w"> </span><span class="n">timestamp</span>

<span class="p">#</span><span class="w"> </span><span class="n">Flux</span><span class="w"> </span><span class="nl">query:</span><span class="w"> </span><span class="n">average</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">hour</span><span class="p">,</span><span class="w"> </span><span class="mh">5</span><span class="o">-</span><span class="n">minute</span><span class="w"> </span><span class="n">windows</span>
<span class="n">from</span><span class="p">(</span><span class="nl">bucket:</span><span class="w"> </span><span class="s">&quot;monitoring&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="nl">start:</span><span class="w"> </span><span class="o">-</span><span class="mh">1</span><span class="n">h</span><span class="p">)</span>
<span class="w">  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="nl">fn:</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">_measurement</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;cpu&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">_field</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;usage&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">aggregateWindow</span><span class="p">(</span><span class="nl">every:</span><span class="w"> </span><span class="mh">5</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="nl">fn:</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="w">  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">group</span><span class="p">(</span><span class="nl">columns:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;host&quot;</span><span class="p">])</span>
</code></pre></div>

<h3 id="66-tsdb-comparison">6.6 TSDB Comparison<a class="header-link" href="#66-tsdb-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>TimescaleDB</th>
<th>InfluxDB</th>
<th>Prometheus</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Base</strong></td>
<td>PostgreSQL extension</td>
<td>Purpose-built</td>
<td>Purpose-built</td>
</tr>
<tr>
<td><strong>Query language</strong></td>
<td>Full SQL</td>
<td>Flux / InfluxQL</td>
<td>PromQL</td>
</tr>
<tr>
<td><strong>Compression</strong></td>
<td>Columnar compression</td>
<td>TSM engine</td>
<td>Gorilla + delta</td>
</tr>
<tr>
<td><strong>Clustering</strong></td>
<td>Self-managed or cloud</td>
<td>Enterprise only</td>
<td>Thanos/Cortex</td>
</tr>
<tr>
<td><strong>Cardinality</strong></td>
<td>Good (PostgreSQL indexes)</td>
<td>Limited (high cardinality = slow)</td>
<td>Limited</td>
</tr>
<tr>
<td><strong>Joins</strong></td>
<td>Full SQL joins</td>
<td>Limited</td>
<td>No</td>
</tr>
<tr>
<td><strong>Best for</strong></td>
<td>General time-series + SQL</td>
<td>Metrics, IoT</td>
<td>Infrastructure monitoring</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="7-graph-analytics-at-scale">7. Graph Analytics at Scale<a class="header-link" href="#7-graph-analytics-at-scale" title="Permanent link">&para;</a></h2>
<h3 id="71-beyond-graph-databases">7.1 Beyond Graph Databases<a class="header-link" href="#71-beyond-graph-databases" title="Permanent link">&para;</a></h3>
<p>While graph databases like Neo4j excel at transactional graph queries (OLTP), graph analytics requires processing the entire graph (OLAP): PageRank, community detection, shortest paths across billions of edges.</p>
<h3 id="72-apache-spark-graphx">7.2 Apache Spark GraphX<a class="header-link" href="#72-apache-spark-graphx" title="Permanent link">&para;</a></h3>
<p>GraphX is Spark's API for graph-parallel computation. It extends the RDD (Resilient Distributed Dataset) abstraction with a Resilient Distributed Property Graph.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphframes</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphFrame</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;GraphAnalytics&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>

<span class="c1"># Vertices DataFrame</span>
<span class="n">vertices</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;Diana&quot;</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">])</span>

<span class="c1"># Edges DataFrame</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;follows&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;follows&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;follows&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;follows&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;follows&quot;</span><span class="p">),</span>
<span class="p">],</span> <span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;dst&quot;</span><span class="p">,</span> <span class="s2">&quot;relationship&quot;</span><span class="p">])</span>

<span class="c1"># Create graph</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">GraphFrame</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">edges</span><span class="p">)</span>

<span class="c1"># PageRank</span>
<span class="n">pagerank</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">pageRank</span><span class="p">(</span><span class="n">resetProbability</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">pagerank</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;pagerank&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Connected components</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">connectedComponents</span><span class="p">()</span>
<span class="n">cc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Shortest paths</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">shortestPaths</span><span class="p">(</span><span class="n">landmarks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">])</span>
<span class="n">sp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Triangle count</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">triangleCount</span><span class="p">()</span>
<span class="n">tc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="73-tigergraph">7.3 TigerGraph<a class="header-link" href="#73-tigergraph" title="Permanent link">&para;</a></h3>
<p>TigerGraph is a distributed graph analytics platform designed for deep link analytics (multi-hop queries at scale).</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">GSQL</span><span class="o">:</span><span class="w"> </span><span class="n">TigerGraph</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="k">query</span><span class="w"> </span><span class="n">language</span>

<span class="o">//</span><span class="w"> </span><span class="n">Define</span><span class="w"> </span><span class="n">schema</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">VERTEX</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="o">(</span><span class="k">PRIMARY_ID</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">STRING</span><span class="o">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">STRING</span><span class="o">,</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">INT</span><span class="o">)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">VERTEX</span><span class="w"> </span><span class="n">Company</span><span class="w"> </span><span class="o">(</span><span class="k">PRIMARY_ID</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">STRING</span><span class="o">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">STRING</span><span class="o">)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">DIRECTED</span><span class="w"> </span><span class="k">EDGE</span><span class="w"> </span><span class="n">works_at</span><span class="w"> </span><span class="o">(</span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="o">,</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">Company</span><span class="o">,</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="k">DATETIME</span><span class="o">)</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">UNDIRECTED</span><span class="w"> </span><span class="k">EDGE</span><span class="w"> </span><span class="n">knows</span><span class="w"> </span><span class="o">(</span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="o">,</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">Person</span><span class="o">,</span><span class="w"> </span><span class="n">strength</span><span class="w"> </span><span class="k">FLOAT</span><span class="o">)</span>

<span class="o">//</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">query</span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="o">-</span><span class="n">hop</span><span class="w"> </span><span class="n">fraud</span><span class="w"> </span><span class="n">detection</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">QUERY</span><span class="w"> </span><span class="n">fraud_ring_detection</span><span class="o">(</span><span class="k">VERTEX</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span><span class="w"> </span><span class="n">seed</span><span class="o">)</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">GRAPH</span><span class="w"> </span><span class="n">social</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">people</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="n">hops</span><span class="w"> </span><span class="n">who</span><span class="w"> </span><span class="n">share</span><span class="w"> </span><span class="n">financial</span><span class="w"> </span><span class="n">connections</span>
<span class="w">  </span><span class="n">Start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">seed</span><span class="p">}</span><span class="o">;</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="m">1</span><span class="o">-</span><span class="n">hop</span><span class="o">:</span><span class="w"> </span><span class="n">direct</span><span class="w"> </span><span class="n">connections</span>
<span class="w">  </span><span class="n">hop1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Start</span><span class="o">:</span><span class="n">s</span><span class="w"> </span><span class="o">-(</span><span class="n">knows</span><span class="o">:</span><span class="n">e</span><span class="o">)-</span><span class="w"> </span><span class="n">Person</span><span class="o">:</span><span class="n">t</span>
<span class="w">         </span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">strength</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="m">0.8</span><span class="o">;</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="m">2</span><span class="o">-</span><span class="n">hop</span><span class="o">:</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">connections</span>
<span class="w">  </span><span class="n">hop2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">hop1</span><span class="o">:</span><span class="n">s</span><span class="w"> </span><span class="o">-(</span><span class="n">knows</span><span class="o">:</span><span class="n">e</span><span class="o">)-</span><span class="w"> </span><span class="n">Person</span><span class="o">:</span><span class="n">t</span>
<span class="w">         </span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">strength</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="m">0.8</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">!= </span><span class="n">seed</span><span class="o">;</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="n">financial</span><span class="w"> </span><span class="n">patterns</span>
<span class="w">  </span><span class="n">suspicious</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">hop2</span><span class="o">:</span><span class="n">t</span><span class="w"> </span><span class="o">-(</span><span class="n">works_at</span><span class="o">)- </span><span class="n">Company</span><span class="o">:</span><span class="n">c</span>
<span class="w">               </span><span class="k">WHERE</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">== </span><span class="s">&quot;shell_company_pattern&quot;</span><span class="o">;</span>

<span class="w">  </span><span class="k">PRINT</span><span class="w"> </span><span class="n">suspicious</span><span class="o">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="74-graph-analytics-comparison">7.4 Graph Analytics Comparison<a class="header-link" href="#74-graph-analytics-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Neo4j</th>
<th>Spark GraphX</th>
<th>TigerGraph</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Type</strong></td>
<td>Graph DB + Analytics</td>
<td>Distributed compute</td>
<td>Distributed graph DB</td>
</tr>
<tr>
<td><strong>Scale</strong></td>
<td>Billions of nodes</td>
<td>Billions of edges</td>
<td>Trillions of edges</td>
</tr>
<tr>
<td><strong>Query</strong></td>
<td>Cypher</td>
<td>Scala/Python API</td>
<td>GSQL</td>
</tr>
<tr>
<td><strong>Real-time</strong></td>
<td>Yes (OLTP + OLAP)</td>
<td>No (batch)</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Best for</strong></td>
<td>Mixed OLTP/OLAP graph</td>
<td>Batch analytics on Spark</td>
<td>Deep link analytics</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="8-database-as-a-service">8. Database-as-a-Service<a class="header-link" href="#8-database-as-a-service" title="Permanent link">&para;</a></h2>
<h3 id="81-the-serverless-database-trend">8.1 The Serverless Database Trend<a class="header-link" href="#81-the-serverless-database-trend" title="Permanent link">&para;</a></h3>
<p>Database-as-a-Service (DBaaS) abstracts away server provisioning, scaling, patching, and backup management. The latest wave of DBaaS offerings goes further with <strong>serverless</strong> architectures that scale to zero when not in use.</p>
<h3 id="82-neon">8.2 Neon<a class="header-link" href="#82-neon" title="Permanent link">&para;</a></h3>
<p>Neon is a serverless PostgreSQL with a separation of storage and compute, enabling instant branching and scale-to-zero.</p>
<div class="highlight"><pre><span></span><code>Neon Architecture:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Compute Layer (stateless, scale-to-zero)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Postgres â”‚  â”‚ Postgres â”‚  â”‚ Postgres â”‚  (auto) â”‚
â”‚  â”‚ Instance â”‚  â”‚ Instance â”‚  â”‚  (idle)  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       â”‚              â”‚                              â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Pageserver (page cache + WAL processing)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SafeKeeper (WAL durability, consensus)         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Object Storage (S3) - bottomless storage       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Key features</strong>:
- <strong>Scale to zero</strong>: When no queries are running, compute scales down to zero (no cost)
- <strong>Instant branching</strong>: Create a copy-on-write branch of the entire database (like git branch for data)
- <strong>Bottomless storage</strong>: Data stored in S3, no upper limit</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a branch (instant, copy-on-write)</span>
neonctl<span class="w"> </span>branches<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>staging<span class="w"> </span>--parent<span class="w"> </span>main

<span class="c1"># Each branch gets its own compute endpoint</span>
<span class="c1"># Useful for: development, testing, previews</span>
</code></pre></div>

<h3 id="83-planetscale">8.3 PlanetScale<a class="header-link" href="#83-planetscale" title="Permanent link">&para;</a></h3>
<p>PlanetScale is a serverless MySQL platform built on Vitess (YouTube's MySQL sharding middleware).</p>
<p><strong>Key features</strong>:
- <strong>Non-blocking schema changes</strong>: Schema changes run as background operations, no table locks
- <strong>Database branching</strong>: Create branches for schema changes, merge via deploy requests
- <strong>Sharding</strong>: Built on Vitess, automatic horizontal sharding</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Git-like workflow for schema changes</span>
pscale<span class="w"> </span>branch<span class="w"> </span>create<span class="w"> </span>main<span class="w"> </span>add-column
pscale<span class="w"> </span>shell<span class="w"> </span>main<span class="w"> </span>add-column

<span class="c1"># On the branch:</span>
mysql&gt;<span class="w"> </span>ALTER<span class="w"> </span>TABLE<span class="w"> </span>users<span class="w"> </span>ADD<span class="w"> </span>COLUMN<span class="w"> </span>avatar_url<span class="w"> </span>VARCHAR<span class="o">(</span><span class="m">500</span><span class="o">)</span><span class="p">;</span>

<span class="c1"># Create a deploy request (like a pull request)</span>
pscale<span class="w"> </span>deploy-request<span class="w"> </span>create<span class="w"> </span>main<span class="w"> </span>add-column

<span class="c1"># Review and merge</span>
pscale<span class="w"> </span>deploy-request<span class="w"> </span>deploy<span class="w"> </span>main<span class="w"> </span><span class="m">1</span>
<span class="c1"># Schema change applied to production with zero downtime!</span>
</code></pre></div>

<h3 id="84-supabase">8.4 Supabase<a class="header-link" href="#84-supabase" title="Permanent link">&para;</a></h3>
<p>Supabase is an open-source Firebase alternative built on PostgreSQL.</p>
<div class="highlight"><pre><span></span><code>Supabase Stack:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard / Studio (Admin UI)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Auth (GoTrue)                          â”‚  â”‚
â”‚  â”‚  Realtime (WebSocket subscriptions)     â”‚  â”‚
â”‚  â”‚  Storage (S3-compatible)                â”‚  â”‚
â”‚  â”‚  Edge Functions (Deno runtime)          â”‚  â”‚
â”‚  â”‚  PostgREST (auto-generated REST API)    â”‚  â”‚
â”‚  â”‚  pgvector (vector search)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â”‚                          â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚           â”‚   PostgreSQL    â”‚                 â”‚
â”‚           â”‚  (the source    â”‚                 â”‚
â”‚           â”‚   of truth)     â”‚                 â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">// Supabase client (auto-generated API from PostgreSQL schema)</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@supabase/supabase-js&#39;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">supabase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createClient</span><span class="p">(</span><span class="s1">&#39;https://xxx.supabase.co&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;anon-key&#39;</span><span class="p">)</span>

<span class="c1">// Query (translates to SQL automatically)</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">supabase</span>
<span class="w">  </span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name, price, categories(name)&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">gte</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">order</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ascending</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">})</span>
<span class="w">  </span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mf">20</span><span class="p">)</span>

<span class="c1">// Real-time subscription</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">subscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">supabase</span>
<span class="w">  </span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;postgres_changes&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;INSERT&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">schema</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;public&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;orders&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;New order:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">payload</span><span class="p">.</span><span class="ow">new</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">subscribe</span><span class="p">()</span>

<span class="c1">// Row Level Security (RLS) - security at the database level</span>
<span class="c1">// Users can only see their own orders</span>
<span class="c1">// CREATE POLICY &quot;Users see own orders&quot; ON orders</span>
<span class="c1">//   FOR SELECT USING (auth.uid() = user_id);</span>
</code></pre></div>

<h3 id="85-dbaas-comparison">8.5 DBaaS Comparison<a class="header-link" href="#85-dbaas-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Neon</th>
<th>PlanetScale</th>
<th>Supabase</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Engine</strong></td>
<td>PostgreSQL</td>
<td>MySQL (Vitess)</td>
<td>PostgreSQL</td>
</tr>
<tr>
<td><strong>Serverless</strong></td>
<td>Yes (scale to zero)</td>
<td>Yes</td>
<td>Partial</td>
</tr>
<tr>
<td><strong>Branching</strong></td>
<td>Database branching</td>
<td>Schema branching</td>
<td>No</td>
</tr>
<tr>
<td><strong>Sharding</strong></td>
<td>No (single node)</td>
<td>Yes (Vitess)</td>
<td>No</td>
</tr>
<tr>
<td><strong>Auto-generated API</strong></td>
<td>No</td>
<td>No</td>
<td>Yes (PostgREST)</td>
</tr>
<tr>
<td><strong>Realtime</strong></td>
<td>No</td>
<td>No</td>
<td>Yes (WebSocket)</td>
</tr>
<tr>
<td><strong>Vector search</strong></td>
<td>pgvector</td>
<td>No</td>
<td>pgvector</td>
</tr>
<tr>
<td><strong>Open source</strong></td>
<td>Yes (storage)</td>
<td>No (Vitess is OSS)</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Best for</strong></td>
<td>Dev/test, branching</td>
<td>High-scale MySQL</td>
<td>Full-stack apps</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9-data-lakehouse">9. Data Lakehouse<a class="header-link" href="#9-data-lakehouse" title="Permanent link">&para;</a></h2>
<h3 id="91-the-evolution-of-data-architecture">9.1 The Evolution of Data Architecture<a class="header-link" href="#91-the-evolution-of-data-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Era</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="nx">Warehouse</span><span class="w"> </span><span class="p">(</span><span class="mi">1990</span><span class="nx">s</span><span class="o">-</span><span class="mi">2010</span><span class="nx">s</span><span class="p">)</span>
<span class="w">  </span><span class="nx">Structured</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">ETL</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="nx">Warehouse</span><span class="w"> </span><span class="p">(</span><span class="nx">Redshift</span><span class="p">,</span><span class="w"> </span><span class="nx">Snowflake</span><span class="p">)</span>
<span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nx">Strong</span><span class="w"> </span><span class="nx">schema</span><span class="p">,</span><span class="w"> </span><span class="nx">ACID</span><span class="p">,</span><span class="w"> </span><span class="nx">SQL</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Expensive</span><span class="p">,</span><span class="w"> </span><span class="nx">limited</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">structured</span><span class="w"> </span><span class="nx">data</span>

<span class="nx">Era</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="nx">Lake</span><span class="w"> </span><span class="p">(</span><span class="mi">2010</span><span class="nx">s</span><span class="p">)</span>
<span class="w">  </span><span class="nx">All</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Dump</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">HDFS</span><span class="o">/</span><span class="nx">S3</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Process</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">Spark</span>
<span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nx">Cheap</span><span class="w"> </span><span class="nx">storage</span><span class="p">,</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">types</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">ACID</span><span class="p">,</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="nx">enforcement</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;data swamp&quot;</span>

<span class="nx">Era</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="nx">Lakehouse</span><span class="w"> </span><span class="p">(</span><span class="mi">2020</span><span class="nx">s</span><span class="p">)</span>
<span class="w">  </span><span class="nx">All</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Lake</span><span class="w"> </span><span class="nx">storage</span><span class="w"> </span><span class="p">(</span><span class="nx">S3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">Table</span><span class="w"> </span><span class="nx">format</span><span class="w"> </span><span class="p">(</span><span class="nx">Delta</span><span class="o">/</span><span class="nx">Iceberg</span><span class="p">)</span>
<span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nx">Cheap</span><span class="w"> </span><span class="nx">storage</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">ACID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">SQL</span>
<span class="w">  </span><span class="nx">Best</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">both</span><span class="w"> </span><span class="nx">worlds</span><span class="p">!</span>
</code></pre></div>

<h3 id="92-what-is-a-lakehouse">9.2 What is a Lakehouse?<a class="header-link" href="#92-what-is-a-lakehouse" title="Permanent link">&para;</a></h3>
<p>A data lakehouse combines the low-cost storage of a data lake (object storage like S3) with the data management features of a data warehouse (ACID transactions, schema enforcement, indexing).</p>
<div class="highlight"><pre><span></span><code>Data Lakehouse Architecture:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query Engines                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Spark  â”‚  â”‚  Trino  â”‚  â”‚ DuckDB  â”‚  ...         â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚
â”‚       â”‚            â”‚            â”‚                    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                    â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Table Format (metadata layer)                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚  â”‚ Delta Lake â”‚  â”‚  Apache    â”‚                   â”‚ â”‚
â”‚  â”‚  â”‚            â”‚  â”‚  Iceberg   â”‚                   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â”‚  Provides: ACID, schema evolution, time travel,   â”‚ â”‚
â”‚  â”‚  partition pruning, file-level statistics          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Object Storage                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”                    â”‚ â”‚
â”‚  â”‚  â”‚  S3  â”‚  â”‚ GCS  â”‚  â”‚ ADLS â”‚                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚
â”‚  â”‚  Data stored as Parquet/ORC files                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="93-delta-lake">9.3 Delta Lake<a class="header-link" href="#93-delta-lake" title="Permanent link">&para;</a></h3>
<p>Delta Lake, created by Databricks, adds ACID transactions to Apache Spark on data lakes.</p>
<p><strong>Transaction log</strong>: Delta Lake maintains a transaction log (<code>_delta_log/</code>) in JSON that records every change to the table. This provides:</p>
<div class="highlight"><pre><span></span><code>my_table/
â”œâ”€â”€ _delta_log/
â”‚   â”œâ”€â”€ 00000000000000000000.json   â† initial table creation
â”‚   â”œâ”€â”€ 00000000000000000001.json   â† INSERT 1000 rows
â”‚   â”œâ”€â”€ 00000000000000000002.json   â† UPDATE some rows
â”‚   â””â”€â”€ 00000000000000000003.json   â† DELETE old rows
â”œâ”€â”€ part-00000-xxxx.parquet
â”œâ”€â”€ part-00001-xxxx.parquet
â””â”€â”€ part-00002-xxxx.parquet
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">delta</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeltaTable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.jars.packages&quot;</span><span class="p">,</span> <span class="s2">&quot;io.delta:delta-core_2.12:2.4.0&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>

<span class="c1"># Write data (ACID)</span>
<span class="n">df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;overwrite&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;/data/events&quot;</span><span class="p">)</span>

<span class="c1"># Time travel: read data as of a specific version</span>
<span class="n">df_v1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;versionAsOf&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;/data/events&quot;</span><span class="p">)</span>

<span class="c1"># Time travel: read data as of a specific timestamp</span>
<span class="n">df_yesterday</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;timestampAsOf&quot;</span><span class="p">,</span> <span class="s2">&quot;2024-11-14&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;/data/events&quot;</span><span class="p">)</span>

<span class="c1"># MERGE (upsert): update existing rows, insert new ones</span>
<span class="n">deltaTable</span> <span class="o">=</span> <span class="n">DeltaTable</span><span class="o">.</span><span class="n">forPath</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="s2">&quot;/data/events&quot;</span><span class="p">)</span>
<span class="n">deltaTable</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">new_data</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">),</span>
    <span class="s2">&quot;target.id = source.id&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">whenMatchedUpdateAll</span><span class="p">()</span> \
 <span class="o">.</span><span class="n">whenNotMatchedInsertAll</span><span class="p">()</span> \
 <span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="c1"># Schema evolution</span>
<span class="n">df_new_columns</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;append&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;mergeSchema&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;/data/events&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="94-apache-iceberg">9.4 Apache Iceberg<a class="header-link" href="#94-apache-iceberg" title="Permanent link">&para;</a></h3>
<p>Apache Iceberg is an open table format for large analytic tables, designed to solve the limitations of Hive tables.</p>
<p><strong>Key advantages over Delta Lake</strong>:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Delta Lake</th>
<th>Apache Iceberg</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Engine lock-in</strong></td>
<td>Optimized for Spark</td>
<td>Engine-agnostic (Spark, Trino, Flink, Dremio)</td>
</tr>
<tr>
<td><strong>Hidden partitioning</strong></td>
<td>Explicit partition columns</td>
<td>Automatic (partition evolution without rewriting)</td>
</tr>
<tr>
<td><strong>Metadata</strong></td>
<td>JSON log + checkpoints</td>
<td>Manifest files + snapshot metadata</td>
</tr>
<tr>
<td><strong>Schema evolution</strong></td>
<td>Add/rename/drop columns</td>
<td>Full evolution including nested types</td>
</tr>
<tr>
<td><strong>Governance</strong></td>
<td>Databricks-led</td>
<td>Apache Foundation (vendor-neutral)</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="c1">-- Iceberg in Spark SQL</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">catalog</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">event_id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="w">  </span><span class="n">event_type</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">  </span><span class="n">event_time</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">properties</span><span class="w"> </span><span class="k">MAP</span><span class="o">&lt;</span><span class="n">STRING</span><span class="p">,</span><span class="w"> </span><span class="n">STRING</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">iceberg</span>
<span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">days</span><span class="p">(</span><span class="n">event_time</span><span class="p">));</span><span class="w">  </span><span class="c1">-- hidden partitioning by day</span>

<span class="c1">-- Time travel</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">catalog</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="w"> </span><span class="k">VERSION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="mi">12345</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">catalog</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="s1">&#39;2024-11-14 00:00:00&#39;</span><span class="p">;</span>

<span class="c1">-- Snapshot management</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">catalog</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="n">events</span><span class="p">.</span><span class="n">snapshots</span><span class="p">;</span>

<span class="c1">-- Expire old snapshots (reclaim storage)</span>
<span class="k">CALL</span><span class="w"> </span><span class="k">catalog</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">expire_snapshots</span><span class="p">(</span><span class="s1">&#39;db.events&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">&#39;2024-10-01&#39;</span><span class="p">);</span>
</code></pre></div>

<h3 id="95-lakehouse-vs-traditional-architectures">9.5 Lakehouse vs Traditional Architectures<a class="header-link" href="#95-lakehouse-vs-traditional-architectures" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Data Warehouse</th>
<th>Data Lake</th>
<th>Data Lakehouse</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Storage cost</strong></td>
<td>High</td>
<td>Low</td>
<td>Low</td>
</tr>
<tr>
<td><strong>Data types</strong></td>
<td>Structured only</td>
<td>All types</td>
<td>All types</td>
</tr>
<tr>
<td><strong>ACID</strong></td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Schema</strong></td>
<td>Schema-on-write</td>
<td>Schema-on-read</td>
<td>Schema-on-write (flexible)</td>
</tr>
<tr>
<td><strong>Query performance</strong></td>
<td>Excellent</td>
<td>Variable</td>
<td>Good (with indexing)</td>
</tr>
<tr>
<td><strong>Time travel</strong></td>
<td>Limited</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Governance</strong></td>
<td>Strong</td>
<td>Weak</td>
<td>Strong</td>
</tr>
<tr>
<td><strong>ML support</strong></td>
<td>Limited</td>
<td>Good (raw data)</td>
<td>Good (raw + structured)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="10-exercises">10. Exercises<a class="header-link" href="#10-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-newsql-comparison">Exercise 1: NewSQL Comparison<a class="header-link" href="#exercise-1-newsql-comparison" title="Permanent link">&para;</a></h3>
<p>Compare Google Spanner, CockroachDB, and TiDB across the following dimensions. Fill in the table:</p>
<table>
<thead>
<tr>
<th>Dimension</th>
<th>Spanner</th>
<th>CockroachDB</th>
<th>TiDB</th>
</tr>
</thead>
<tbody>
<tr>
<td>Clock mechanism</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Default isolation level</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Replication protocol</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SQL compatibility</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>HTAP support</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Open source?</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Typical deployment</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="exercise-2-truetime-and-commit-wait">Exercise 2: TrueTime and Commit Wait<a class="header-link" href="#exercise-2-truetime-and-commit-wait" title="Permanent link">&para;</a></h3>
<p>Google Spanner's TrueTime reports a clock uncertainty of <code>[T-Îµ, T+Îµ]</code> where Îµ is typically 1-7ms.</p>
<ol>
<li>Explain why Spanner must "wait out" the uncertainty before committing a transaction.</li>
<li>If Îµ = 5ms, what is the minimum commit latency for a write transaction?</li>
<li>If Îµ were 0 (perfect clock), how would this simplify the protocol?</li>
<li>Why can't CockroachDB use the same approach? What does it do instead?</li>
<li>Explain a scenario where CockroachDB's HLC approach might result in a "read restart." What is the user-visible impact?</li>
</ol>
<h3 id="exercise-3-vector-database-design">Exercise 3: Vector Database Design<a class="header-link" href="#exercise-3-vector-database-design" title="Permanent link">&para;</a></h3>
<p>You are building a RAG (Retrieval-Augmented Generation) system for a customer support chatbot. The knowledge base contains:
- 100,000 support articles (average 500 words each)
- Articles are updated weekly
- Expected query load: 1,000 queries per minute
- Latency requirement: &lt; 100ms per query</p>
<p>Design the vector database component:
1. Choose a vector database system and justify your choice.
2. Choose an embedding model and dimension size.
3. Describe your indexing strategy (IVF, HNSW, or hybrid).
4. How would you handle article updates? (re-embed entire article? chunk-level updates?)
5. How would you implement hybrid search (vector similarity + keyword matching)?</p>
<h3 id="exercise-4-time-series-schema-design">Exercise 4: Time-Series Schema Design<a class="header-link" href="#exercise-4-time-series-schema-design" title="Permanent link">&para;</a></h3>
<p>Design a TimescaleDB schema for a smart building monitoring system:
- 500 sensors across 50 floors
- Each sensor reports temperature, humidity, CO2, and occupancy every 10 seconds
- Common queries: last 24 hours for a specific floor, average per floor per hour, anomaly detection
- Data retention: raw data for 90 days, hourly aggregates for 2 years</p>
<p>Write the SQL for:
1. Table creation with hypertable
2. Continuous aggregate for hourly averages
3. Retention policy
4. Compression policy
5. A query for "floors where average temperature exceeded 28C in the last 6 hours"</p>
<h3 id="exercise-5-htap-scenario-analysis">Exercise 5: HTAP Scenario Analysis<a class="header-link" href="#exercise-5-htap-scenario-analysis" title="Permanent link">&para;</a></h3>
<p>A financial trading company currently runs:
- An OLTP database (PostgreSQL) for trade execution
- An OLAP warehouse (Snowflake) with 2-hour ETL lag for risk analysis</p>
<p>They are considering migrating to TiDB for HTAP.</p>
<ol>
<li>What are the benefits of eliminating the ETL pipeline?</li>
<li>What risks does running analytics on the same system as transactions introduce?</li>
<li>How does TiDB's architecture (TiKV + TiFlash) mitigate the resource contention risk?</li>
<li>In what scenarios would you still recommend keeping separate OLTP and OLAP systems?</li>
</ol>
<h3 id="exercise-6-database-selection">Exercise 6: Database Selection<a class="header-link" href="#exercise-6-database-selection" title="Permanent link">&para;</a></h3>
<p>For each of the following applications, select the most appropriate database technology from the options covered in this lesson. Justify your choice.</p>
<ol>
<li>A genomics research platform storing DNA sequence embeddings for similarity search across 10 billion sequences.</li>
<li>A factory monitoring system with 10,000 machines, each reporting 50 metrics every second.</li>
<li>A global banking application requiring ACID transactions with operations in 30 countries.</li>
<li>A startup building a collaborative document editor (like Google Docs) with 10,000 users.</li>
<li>A data analytics platform that needs to run SQL queries over 100 TB of event data stored in S3.</li>
</ol>
<h3 id="exercise-7-lakehouse-design">Exercise 7: Lakehouse Design<a class="header-link" href="#exercise-7-lakehouse-design" title="Permanent link">&para;</a></h3>
<p>You are designing a data platform for a ride-sharing company. Data sources include:
- Ride events (10 million rides/day)
- GPS traces (100 points per ride)
- Payment transactions
- Driver/rider profiles
- Surge pricing calculations</p>
<p>Design a lakehouse architecture:
1. Choose between Delta Lake and Apache Iceberg. Justify.
2. Define the table schemas for the three most important tables.
3. Describe the partitioning strategy for each table.
4. How would you implement time travel for auditing payment transactions?
5. What query engines would you use for (a) real-time dashboards, (b) monthly reports, (c) ML feature engineering?</p>
<h3 id="exercise-8-serverless-database-evaluation">Exercise 8: Serverless Database Evaluation<a class="header-link" href="#exercise-8-serverless-database-evaluation" title="Permanent link">&para;</a></h3>
<p>Your team is building a SaaS application with these characteristics:
- Multi-tenant (each tenant has isolated data)
- Variable load: peaks at 10x the average
- Development team needs frequent schema changes
- Budget is limited (startup)</p>
<p>Evaluate Neon, PlanetScale, and Supabase for this use case:
1. How does each handle multi-tenancy?
2. How does each handle variable load?
3. How does each handle schema changes in production?
4. What would be your recommendation and why?</p>
<h3 id="exercise-9-consistent-hashing-in-cockroachdb">Exercise 9: Consistent Hashing in CockroachDB<a class="header-link" href="#exercise-9-consistent-hashing-in-cockroachdb" title="Permanent link">&para;</a></h3>
<p>CockroachDB divides the key space into Ranges (approximately 512 MB each). Each Range is a Raft group.</p>
<ol>
<li>When a Range grows beyond 512 MB, how does CockroachDB split it? What happens to the Raft group?</li>
<li>When a node joins the cluster, how are Ranges rebalanced?</li>
<li>What is the difference between a Range split and a Range rebalance?</li>
<li>How does CockroachDB decide which node should be the Raft leader for a Range? How does this relate to geo-partitioning?</li>
</ol>
<h3 id="exercise-10-essay-question">Exercise 10: Essay Question<a class="header-link" href="#exercise-10-essay-question" title="Permanent link">&para;</a></h3>
<p>Write a 600-word essay on the following topic:</p>
<p>"The relational database is dead" has been proclaimed many times, yet PostgreSQL usage continues to grow year over year. Based on the material in this lesson (NewSQL, vector databases, time-series databases, lakehouse), argue whether the relational model is becoming more or less relevant. Support your argument with specific examples of how relational databases are adapting (e.g., pgvector, TimescaleDB as extensions) versus being replaced by specialized systems.</p>
<hr />
<h2 id="11-references">11. References<a class="header-link" href="#11-references" title="Permanent link">&para;</a></h2>
<ol>
<li>Corbett, J. et al. (2013). "Spanner: Google's Globally-Distributed Database." ACM TODS.</li>
<li>Taft, R. et al. (2020). "CockroachDB: The Resilient Geo-Distributed SQL Database." ACM SIGMOD.</li>
<li>Huang, D. et al. (2020). "TiDB: A Raft-based HTAP Database." VLDB.</li>
<li>Aslett, M. (2011). "How Will the Database Incumbents Respond to NoSQL and NewSQL?" The 451 Group.</li>
<li>Johnson, J., Douze, M., Jegou, H. (2019). "Billion-Scale Similarity Search with GPUs." IEEE Trans. on Big Data.</li>
<li>Malkov, Y. &amp; Yashunin, D. (2018). "Efficient and Robust Approximate Nearest Neighbor using Hierarchical Navigable Small World Graphs." IEEE TPAMI.</li>
<li>Armbrust, M. et al. (2021). "Lakehouse: A New Generation of Open Platforms that Unify Data Warehousing and Advanced Analytics." CIDR.</li>
<li>Armbrust, M. et al. (2020). "Delta Lake: High-Performance ACID Table Storage over Cloud Object Stores." VLDB.</li>
<li>Apache Iceberg Documentation. https://iceberg.apache.org/</li>
<li>Pelkonen, T. et al. (2015). "Gorilla: A Fast, Scalable, In-Memory Time Series Database." VLDB.</li>
<li>Neon Documentation. https://neon.tech/docs</li>
<li>CockroachDB Architecture Documentation. https://www.cockroachlabs.com/docs/stable/architecture/overview.html</li>
</ol>
<hr />
<p><strong>Previous</strong>: <a href="./14_Distributed_Databases.md">14. Distributed Databases</a> | <strong>Next</strong>: <a href="./16_Database_Design_Case_Study.md">16. Database Design Case Study</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Database_Theory/14_Distributed_Databases.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Distributed Databases</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Database_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Database_Theory/16_Database_Design_Case_Study.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Database Design Case Study</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}