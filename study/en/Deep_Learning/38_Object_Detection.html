{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>38. Object Detection - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Deep_Learning/">Deep Learning</a>
    <span class="separator">/</span>
    <span class="current">38. Object Detection</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>38. Object Detection</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Deep_Learning/37_Modern_Architectures.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">37. Modern Deep Learning Architectures</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Deep_Learning/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Deep_Learning/39_Practical_Image_Classification.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">39. Practical Image Classification Project</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-object-detection-overview">1. Object Detection Overview</a><ul>
<li><a href="#11-problem-definition">1.1 Problem Definition</a></li>
<li><a href="#12-detector-classification">1.2 Detector Classification</a></li>
<li><a href="#13-evaluation-metrics">1.3 Evaluation Metrics</a></li>
</ul>
</li>
<li><a href="#2-r-cnn-family">2. R-CNN Family</a><ul>
<li><a href="#21-r-cnn-evolution">2.1 R-CNN Evolution</a></li>
<li><a href="#22-faster-r-cnn-structure">2.2 Faster R-CNN Structure</a></li>
<li><a href="#23-rpn-region-proposal-network">2.3 RPN (Region Proposal Network)</a></li>
</ul>
</li>
<li><a href="#3-yolo-you-only-look-once">3. YOLO (You Only Look Once)</a><ul>
<li><a href="#31-yolo-evolution">3.1 YOLO Evolution</a></li>
<li><a href="#32-ultralytics-yolov8-practice">3.2 Ultralytics YOLOv8 Practice</a></li>
<li><a href="#33-yolov8-loss-function">3.3 YOLOv8 Loss Function</a></li>
</ul>
</li>
<li><a href="#4-detr-detection-transformer">4. DETR (Detection Transformer)</a><ul>
<li><a href="#41-detr-concept">4.1 DETR Concept</a></li>
<li><a href="#42-detr-implementation">4.2 DETR Implementation</a></li>
<li><a href="#43-rt-detr-real-time-detr">4.3 RT-DETR (Real-Time DETR)</a></li>
</ul>
</li>
<li><a href="#5-instance-segmentation">5. Instance Segmentation</a><ul>
<li><a href="#51-mask-r-cnn">5.1 Mask R-CNN</a></li>
<li><a href="#52-sam-segment-anything-model">5.2 SAM (Segment Anything Model)</a></li>
</ul>
</li>
<li><a href="#6-practical-tips">6. Practical Tips</a><ul>
<li><a href="#61-dataset-formats">6.1 Dataset Formats</a></li>
<li><a href="#62-training-tips">6.2 Training Tips</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a><ul>
<li><a href="#detector-selection-guide">Detector Selection Guide</a></li>
<li><a href="#key-concepts-summary">Key Concepts Summary</a></li>
<li><a href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li><a href="#references">References</a><ul>
<li><a href="#papers">Papers</a></li>
<li><a href="#code-resources">Code &amp; Resources</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <p><a href="./37_Modern_Architectures.md">Previous: Modern Deep Learning Architectures</a> | <a href="./39_Practical_Image_Classification.md">Next: Practical Image Classification Project</a></p>
<hr />
<h1 id="38-object-detection">38. Object Detection<a class="header-link" href="#38-object-detection" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand the difference between Two-stage vs One-stage detectors</li>
<li>Learn YOLO architecture and its evolution</li>
<li>Understand Faster R-CNN structure and RPN</li>
<li>Grasp DETR (Detection Transformer) concepts</li>
<li>Practice with PyTorch/Ultralytics</li>
</ul>
<hr />
<h2 id="1-object-detection-overview">1. Object Detection Overview<a class="header-link" href="#1-object-detection-overview" title="Permanent link">&para;</a></h2>
<h3 id="11-problem-definition">1.1 Problem Definition<a class="header-link" href="#11-problem-definition" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                  </span><span class="nv">Computer</span><span class="w"> </span><span class="nv">Vision</span><span class="w"> </span><span class="nv">Task</span><span class="w"> </span><span class="nv">Comparison</span><span class="w">                </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Image</span><span class="w"> </span><span class="nv">Classification</span><span class="w">                                        </span>â”‚
â”‚<span class="w">     </span>â””â”€<span class="w"> </span><span class="nv">Entire</span><span class="w"> </span><span class="nv">image</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Single</span><span class="w"> </span><span class="nv">class</span><span class="w">                              </span>â”‚
â”‚<span class="w">     </span>â””â”€<span class="w"> </span><span class="nv">Output</span>:<span class="w"> </span><span class="s2">&quot;dog&quot;</span><span class="w">                                            </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Object</span><span class="w"> </span><span class="nv">Detection</span><span class="w">                                            </span>â”‚
â”‚<span class="w">     </span>â””â”€<span class="w"> </span><span class="nv">Image</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Multiple</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">locations</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">classes</span><span class="w">             </span>â”‚
â”‚<span class="w">     </span>â””â”€<span class="w"> </span><span class="nv">Output</span>:<span class="w"> </span>[<span class="ss">(</span><span class="nv">x1</span>,<span class="nv">y1</span>,<span class="nv">x2</span>,<span class="nv">y2</span>,<span class="w"> </span><span class="s2">&quot;dog&quot;</span>,<span class="w"> </span><span class="mi">0</span>.<span class="mi">95</span><span class="ss">)</span>,<span class="w"> </span>...]<span class="w">              </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">3</span>.<span class="w"> </span><span class="nv">Semantic</span><span class="w"> </span><span class="nv">Segmentation</span><span class="w">                                       </span>â”‚
â”‚<span class="w">     </span>â””â”€<span class="w"> </span><span class="nv">Assign</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">pixel</span><span class="w">                              </span>â”‚
â”‚<span class="w">     </span>â””â”€<span class="w"> </span><span class="nv">Objects</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">distinguished</span><span class="w">         </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">4</span>.<span class="w"> </span><span class="nv">Instance</span><span class="w"> </span><span class="nv">Segmentation</span><span class="w">                                       </span>â”‚
â”‚<span class="w">     </span>â””â”€<span class="w"> </span><span class="nv">Object</span><span class="w"> </span><span class="nv">detection</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">pixel</span><span class="w"> </span><span class="nv">mask</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">object</span><span class="w">           </span>â”‚
â”‚<span class="w">     </span>â””â”€<span class="w"> </span><span class="nv">Distinguish</span><span class="w"> </span><span class="nv">individual</span><span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="nv">even</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">class</span><span class="w">   </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-detector-classification">1.2 Detector Classification<a class="header-link" href="#12-detector-classification" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">Detector</span><span class="w"> </span><span class="nv">Classification</span><span class="w">                       </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">           </span><span class="nv">Two</span><span class="o">-</span><span class="nv">Stage</span><span class="w"> </span><span class="nv">Detectors</span><span class="w">                            </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Stage</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">Region</span><span class="w"> </span><span class="nv">Proposal</span><span class="w"> </span><span class="ss">(</span><span class="nv">generate</span><span class="w"> </span><span class="nv">candidates</span><span class="ss">)</span><span class="w">         </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Stage</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">Classification</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">Regression</span><span class="w">                    </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                           </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Examples</span>:<span class="w"> </span><span class="nv">R</span><span class="o">-</span><span class="nv">CNN</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Fast</span><span class="w"> </span><span class="nv">R</span><span class="o">-</span><span class="nv">CNN</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Faster</span><span class="w"> </span><span class="nv">R</span><span class="o">-</span><span class="nv">CNN</span><span class="w">            </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">      </span><span class="nv">Pros</span>:<span class="w"> </span><span class="nv">High</span><span class="w"> </span><span class="nv">accuracy</span><span class="w">                                 </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">      </span><span class="nv">Cons</span>:<span class="w"> </span><span class="nv">Slow</span><span class="w"> </span><span class="nv">speed</span><span class="w">                                    </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">           </span><span class="nv">One</span><span class="o">-</span><span class="nv">Stage</span><span class="w"> </span><span class="nv">Detectors</span><span class="w">                            </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Single</span><span class="w"> </span><span class="nv">network</span><span class="w"> </span><span class="nv">predicting</span><span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">together</span><span class="w">    </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                           </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Examples</span>:<span class="w"> </span><span class="nv">YOLO</span>,<span class="w"> </span><span class="nv">SSD</span>,<span class="w"> </span><span class="nv">RetinaNet</span>,<span class="w"> </span><span class="nv">CenterNet</span><span class="w">              </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">      </span><span class="nv">Pros</span>:<span class="w"> </span><span class="nv">Fast</span><span class="w"> </span><span class="nv">speed</span>,<span class="w"> </span><span class="nv">real</span><span class="o">-</span><span class="nv">time</span><span class="w"> </span><span class="nv">processing</span><span class="w"> </span><span class="nv">possible</span><span class="w">    </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">      </span><span class="nv">Cons</span>:<span class="w"> </span><span class="nv">Difficulty</span><span class="w"> </span><span class="nv">detecting</span><span class="w"> </span><span class="nv">small</span><span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="ss">(</span><span class="nv">improved</span><span class="ss">)</span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">           </span><span class="nv">Transformer</span><span class="o">-</span><span class="nv">based</span><span class="w"> </span><span class="nv">Detectors</span><span class="w">                    </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">DETR</span>,<span class="w"> </span><span class="nv">Deformable</span><span class="w"> </span><span class="nv">DETR</span>,<span class="w"> </span><span class="nv">RT</span><span class="o">-</span><span class="nv">DETR</span><span class="w">                          </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="k">End</span><span class="o">-</span><span class="nv">to</span><span class="o">-</span><span class="k">end</span><span class="w"> </span><span class="nv">training</span>,<span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">NMS</span><span class="w"> </span><span class="nv">required</span><span class="w">                   </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="13-evaluation-metrics">1.3 Evaluation Metrics<a class="header-link" href="#13-evaluation-metrics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Object detection evaluation metrics</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_iou</span><span class="p">(</span><span class="n">box1</span><span class="p">,</span> <span class="n">box2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    IoU (Intersection over Union) calculation</span>

<span class="sd">    Args:</span>
<span class="sd">        box1, box2: [x1, y1, x2, y2] format</span>

<span class="sd">    Returns:</span>
<span class="sd">        IoU value (0~1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Intersection coordinates</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">box2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="c1"># Intersection area</span>
    <span class="n">inter_area</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>

    <span class="c1"># Union area</span>
    <span class="n">box1_area</span> <span class="o">=</span> <span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">box1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">box1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">box2_area</span> <span class="o">=</span> <span class="p">(</span><span class="n">box2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">box2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">box2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">box2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">union_area</span> <span class="o">=</span> <span class="n">box1_area</span> <span class="o">+</span> <span class="n">box2_area</span> <span class="o">-</span> <span class="n">inter_area</span>

    <span class="k">return</span> <span class="n">inter_area</span> <span class="o">/</span> <span class="n">union_area</span> <span class="k">if</span> <span class="n">union_area</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># Example</span>
<span class="n">pred_box</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
<span class="n">gt_box</span> <span class="o">=</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IoU: </span><span class="si">{</span><span class="n">calculate_iou</span><span class="p">(</span><span class="n">pred_box</span><span class="p">,</span><span class="w"> </span><span class="n">gt_box</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># approximately 0.68</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">mAP (mean Average Precision) calculation process:</span>

<span class="sd">1. For each class:</span>
<span class="sd">   - Sort predictions by confidence</span>
<span class="sd">   - TP if IoU &gt; threshold, otherwise FP</span>
<span class="sd">   - Calculate Precision-Recall curve</span>
<span class="sd">   - AP = area under the curve</span>

<span class="sd">2. mAP = average of all class APs</span>

<span class="sd">COCO dataset metrics:</span>
<span class="sd">- mAP@0.5: IoU=0.5 threshold</span>
<span class="sd">- mAP@0.75: IoU=0.75 threshold (strict)</span>
<span class="sd">- mAP@[.5:.95]: average of IoU from 0.5 to 0.95</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>

<hr />
<h2 id="2-r-cnn-family">2. R-CNN Family<a class="header-link" href="#2-r-cnn-family" title="Permanent link">&para;</a></h2>
<h3 id="21-r-cnn-evolution">2.1 R-CNN Evolution<a class="header-link" href="#21-r-cnn-evolution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">R</span><span class="o">-</span><span class="n">CNN</span><span class="w"> </span><span class="n">Family</span><span class="w"> </span><span class="n">Evolution</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">R</span><span class="o">-</span><span class="n">CNN</span><span class="w"> </span><span class="p">(</span><span class="mh">2014</span><span class="p">)</span><span class="o">:</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Image</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Selective</span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">CNN</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">SVM</span><span class="w">     </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Search</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="n">AlexNet</span><span class="p">)</span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Classifier</span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="mh">2000</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Problem:</span><span class="w"> </span><span class="o">~</span><span class="mh">2000</span><span class="w"> </span><span class="n">CNN</span><span class="w"> </span><span class="n">passes</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">slow</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Fast</span><span class="w"> </span><span class="n">R</span><span class="o">-</span><span class="n">CNN</span><span class="w"> </span><span class="p">(</span><span class="mh">2015</span><span class="p">)</span><span class="o">:</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Image</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">CNN</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">RoI</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">FC</span><span class="w"> </span><span class="o">+</span><span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Feature</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Pooling</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Softmax</span><span class="w"> </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Map</span><span class="w">      </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Improvement:</span><span class="w"> </span><span class="n">Single</span><span class="w"> </span><span class="n">CNN</span><span class="w"> </span><span class="n">pass</span><span class="p">,</span><span class="w"> </span><span class="n">RoI</span><span class="w"> </span><span class="n">Pooling</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="n">extraction</span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Problem:</span><span class="w"> </span><span class="n">Selective</span><span class="w"> </span><span class="n">Search</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">slow</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Faster</span><span class="w"> </span><span class="n">R</span><span class="o">-</span><span class="n">CNN</span><span class="w"> </span><span class="p">(</span><span class="mh">2015</span><span class="p">)</span><span class="o">:</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Image</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Backbone</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">RPN</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Head</span><span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="n">ResNet</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Innovation:</span><span class="w"> </span><span class="n">RPN</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">Region</span><span class="w"> </span><span class="n">Proposal</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">learnable</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="22-faster-r-cnn-structure">2.2 Faster R-CNN Structure<a class="header-link" href="#22-faster-r-cnn-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torchvision</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.models.detection</span><span class="w"> </span><span class="kn">import</span> <span class="n">fasterrcnn_resnet50_fpn_v2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.models.detection.faster_rcnn</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastRCNNPredictor</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomFasterRCNN</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom Faster R-CNN model&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            num_classes: Number of classes including background (e.g., 10 objects â†’ 11)</span>
<span class="sd">            pretrained: Use COCO pretrained weights</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load pretrained model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">fasterrcnn_resnet50_fpn_v2</span><span class="p">(</span>
            <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;DEFAULT&quot;</span> <span class="k">if</span> <span class="n">pretrained</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="c1"># Replace box predictor (adjust for number of classes)</span>
        <span class="n">in_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">roi_heads</span><span class="o">.</span><span class="n">box_predictor</span><span class="o">.</span><span class="n">cls_score</span><span class="o">.</span><span class="n">in_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">roi_heads</span><span class="o">.</span><span class="n">box_predictor</span> <span class="o">=</span> <span class="n">FastRCNNPredictor</span><span class="p">(</span>
            <span class="n">in_features</span><span class="p">,</span> <span class="n">num_classes</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>


<span class="k">def</span><span class="w"> </span><span class="nf">train_faster_rcnn</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Faster R-CNN training example&quot;&quot;&quot;</span>

    <span class="c1"># Create model (background + 10 classes)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">CustomFasterRCNN</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="c1"># Dummy data</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

    <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;boxes&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">]]),</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>  <span class="c1"># class ID</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;boxes&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">]]),</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">]),</span>
        <span class="p">}</span>
    <span class="p">]</span>

    <span class="c1"># Forward pass (returns loss in training mode)</span>
    <span class="n">loss_dict</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

    <span class="c1"># Loss types:</span>
    <span class="c1"># - loss_classifier: class classification loss</span>
    <span class="c1"># - loss_box_reg: box regression loss</span>
    <span class="c1"># - loss_objectness: RPN object/non-object classification</span>
    <span class="c1"># - loss_rpn_box_reg: RPN box regression</span>

    <span class="n">total_loss</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">loss</span> <span class="k">for</span> <span class="n">loss</span> <span class="ow">in</span> <span class="n">loss_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total loss: </span><span class="si">{</span><span class="n">total_loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">loss_dict</span>


<span class="k">def</span><span class="w"> </span><span class="nf">inference_faster_rcnn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Faster R-CNN inference&quot;&quot;&quot;</span>

    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">([</span><span class="n">image</span><span class="p">])</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Filter predictions above threshold</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;boxes&quot;</span><span class="p">:</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;boxes&quot;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
        <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
        <span class="s2">&quot;scores&quot;</span><span class="p">:</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>

<h3 id="23-rpn-region-proposal-network">2.3 RPN (Region Proposal Network)<a class="header-link" href="#23-rpn-region-proposal-network" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RPN key concepts:</span>

<span class="sd">1. Anchor Boxes:</span>
<span class="sd">   - Pre-defined boxes of multiple sizes/ratios at each location</span>
<span class="sd">   - Example: 3 scales Ã— 3 ratios = 9 anchors</span>

<span class="sd">2. Outputs:</span>
<span class="sd">   - objectness score: object presence probability (2-class)</span>
<span class="sd">   - box regression: anchor â†’ actual box transformation</span>

<span class="sd">3. Training:</span>
<span class="sd">   - Positive: anchors with IoU &gt; 0.7</span>
<span class="sd">   - Negative: anchors with IoU &lt; 0.3</span>
<span class="sd">   - Ignored: between 0.3~0.7</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SimpleRPN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simplified RPN implementation&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">in_channels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
        <span class="n">num_anchors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>  <span class="c1"># 3 scales Ã— 3 ratios</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># 3Ã—3 conv for feature processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># objectness prediction (object/background)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectness</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">num_anchors</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># bbox regression (dx, dy, dw, dh)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox_reg</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">num_anchors</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_map</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            feature_map: (B, C, H, W)</span>

<span class="sd">        Returns:</span>
<span class="sd">            objectness: (B, num_anchors*2, H, W)</span>
<span class="sd">            bbox_deltas: (B, num_anchors*4, H, W)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">feature_map</span><span class="p">))</span>

        <span class="n">objectness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectness</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">bbox_deltas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_reg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">objectness</span><span class="p">,</span> <span class="n">bbox_deltas</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_anchors</span><span class="p">(</span>
    <span class="n">feature_size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
    <span class="n">anchor_scales</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span>
    <span class="n">anchor_ratios</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>
    <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate anchor boxes</span>

<span class="sd">    Args:</span>
<span class="sd">        feature_size: (H, W) feature map size</span>
<span class="sd">        anchor_scales: square root of anchor area</span>
<span class="sd">        anchor_ratios: width/height ratios</span>
<span class="sd">        stride: downsampling ratio from original image</span>

<span class="sd">    Returns:</span>
<span class="sd">        anchors: (H*W*num_anchors, 4) anchor coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">feature_size</span>
    <span class="n">anchors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">H</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="p">):</span>
            <span class="c1"># feature map position â†’ original image coordinates</span>
            <span class="n">cx</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">stride</span>
            <span class="n">cy</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">stride</span>

            <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">anchor_scales</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="n">anchor_ratios</span><span class="p">:</span>
                    <span class="c1"># width/height based on ratio</span>
                    <span class="n">anchor_w</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">anchor_h</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">/</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

                    <span class="c1"># (x1, y1, x2, y2) format</span>
                    <span class="n">anchors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                        <span class="n">cx</span> <span class="o">-</span> <span class="n">anchor_w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">cy</span> <span class="o">-</span> <span class="n">anchor_h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">cx</span> <span class="o">+</span> <span class="n">anchor_w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">cy</span> <span class="o">+</span> <span class="n">anchor_h</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="p">])</span>

    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">anchors</span><span class="p">)</span>

<span class="c1"># Example</span>
<span class="n">anchors</span> <span class="o">=</span> <span class="n">generate_anchors</span><span class="p">((</span><span class="mi">38</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>  <span class="c1"># 600Ã—800 image, stride=16</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">anchors</span><span class="p">)</span><span class="si">}</span><span class="s2"> anchors&quot;</span><span class="p">)</span>  <span class="c1"># 38*50*9 = 17,100</span>
</code></pre></div>

<hr />
<h2 id="3-yolo-you-only-look-once">3. YOLO (You Only Look Once)<a class="header-link" href="#3-yolo-you-only-look-once" title="Permanent link">&para;</a></h2>
<h3 id="31-yolo-evolution">3.1 YOLO Evolution<a class="header-link" href="#31-yolo-evolution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="nx">YOLO</span><span class="w"> </span><span class="nx">Version</span><span class="w"> </span><span class="nx">Comparison</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv1</span><span class="w"> </span><span class="p">(</span><span class="mi">2016</span><span class="p">):</span><span class="w"> </span><span class="nx">Grid</span><span class="o">-</span><span class="nx">based</span><span class="w"> </span><span class="nx">detection</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">single</span><span class="w"> </span><span class="nx">CNN</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv2</span><span class="w"> </span><span class="p">(</span><span class="mi">2017</span><span class="p">):</span><span class="w"> </span><span class="nx">Batch</span><span class="w"> </span><span class="nx">Norm</span><span class="p">,</span><span class="w"> </span><span class="nx">Anchor</span><span class="w"> </span><span class="nx">Boxes</span><span class="w"> </span><span class="nx">introduction</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv3</span><span class="w"> </span><span class="p">(</span><span class="mi">2018</span><span class="p">):</span><span class="w"> </span><span class="nx">Darknet</span><span class="o">-</span><span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="nx">FPN</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">-</span><span class="nx">scale</span><span class="w"> </span><span class="nx">predictions</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv4</span><span class="w"> </span><span class="p">(</span><span class="mi">2020</span><span class="p">):</span><span class="w"> </span><span class="nx">CSPDarknet</span><span class="p">,</span><span class="w"> </span><span class="nx">SPP</span><span class="p">,</span><span class="w"> </span><span class="nx">PANet</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv5</span><span class="w"> </span><span class="p">(</span><span class="mi">2020</span><span class="p">):</span><span class="w"> </span><span class="nx">PyTorch</span><span class="w"> </span><span class="nx">implementation</span><span class="p">,</span><span class="w"> </span><span class="nx">Ultralytics</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv6</span><span class="w"> </span><span class="p">(</span><span class="mi">2022</span><span class="p">):</span><span class="w"> </span><span class="nx">Speed</span><span class="w"> </span><span class="nx">optimization</span><span class="p">,</span><span class="w"> </span><span class="nx">EfficientRep</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv7</span><span class="w"> </span><span class="p">(</span><span class="mi">2022</span><span class="p">):</span><span class="w"> </span><span class="nx">E</span><span class="o">-</span><span class="nx">ELAN</span><span class="p">,</span><span class="w"> </span><span class="nx">Auxiliary</span><span class="w"> </span><span class="nx">Head</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv8</span><span class="w"> </span><span class="p">(</span><span class="mi">2023</span><span class="p">):</span><span class="w"> </span><span class="nx">Unified</span><span class="w"> </span><span class="nx">Framework</span><span class="p">,</span><span class="w"> </span><span class="nx">Anchor</span><span class="o">-</span><span class="nx">free</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv9</span><span class="w"> </span><span class="p">(</span><span class="mi">2024</span><span class="p">):</span><span class="w"> </span><span class="nx">GELAN</span><span class="p">,</span><span class="w"> </span><span class="nx">PGI</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv10</span><span class="w"> </span><span class="p">(</span><span class="mi">2024</span><span class="p">):</span><span class="w"> </span><span class="nx">NMS</span><span class="o">-</span><span class="nx">free</span><span class="p">,</span><span class="w"> </span><span class="nx">Dual</span><span class="w"> </span><span class="nx">Assignments</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLO11</span><span class="w"> </span><span class="p">(</span><span class="mi">2024</span><span class="p">):</span><span class="w"> </span><span class="nx">Faster</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">accurate</span><span class="w"> </span><span class="nx">version</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Performance</span><span class="w"> </span><span class="p">(</span><span class="nx">COCO</span><span class="w"> </span><span class="nx">val2017</span><span class="p">)</span><span class="w">    </span><span class="nx">mAP50</span><span class="o">-</span><span class="mi">95</span><span class="w">   </span><span class="nx">Speed</span><span class="w"> </span><span class="p">(</span><span class="nx">ms</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv8n</span><span class="w">                         </span><span class="m m-Double">37.3</span><span class="w">        </span><span class="m m-Double">1.2</span><span class="w">       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv8s</span><span class="w">                         </span><span class="m m-Double">44.9</span><span class="w">        </span><span class="m m-Double">1.9</span><span class="w">       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv8m</span><span class="w">                         </span><span class="m m-Double">50.2</span><span class="w">        </span><span class="m m-Double">4.3</span><span class="w">       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv8l</span><span class="w">                         </span><span class="m m-Double">52.9</span><span class="w">        </span><span class="m m-Double">6.7</span><span class="w">       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLOv8x</span><span class="w">                         </span><span class="m m-Double">53.9</span><span class="w">        </span><span class="m m-Double">9.8</span><span class="w">       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">YOLO11x</span><span class="w">                         </span><span class="m m-Double">54.7</span><span class="w">        </span><span class="m m-Double">11.3</span><span class="w">      </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="32-ultralytics-yolov8-practice">3.2 Ultralytics YOLOv8 Practice<a class="header-link" href="#32-ultralytics-yolov8-practice" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">YOLO</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="c1"># ===============================</span>
<span class="c1"># 1. Model Loading</span>
<span class="c1"># ===============================</span>

<span class="c1"># Load pretrained model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="s2">&quot;yolov8n.pt&quot;</span><span class="p">)</span>  <span class="c1"># nano version (fastest)</span>
<span class="c1"># model = YOLO(&quot;yolov8s.pt&quot;)  # small</span>
<span class="c1"># model = YOLO(&quot;yolov8m.pt&quot;)  # medium</span>
<span class="c1"># model = YOLO(&quot;yolov8l.pt&quot;)  # large</span>
<span class="c1"># model = YOLO(&quot;yolov8x.pt&quot;)  # extra-large</span>

<span class="c1"># Create empty model for training</span>
<span class="c1"># model = YOLO(&quot;yolov8n.yaml&quot;)</span>


<span class="c1"># ===============================</span>
<span class="c1"># 2. Inference</span>
<span class="c1"># ===============================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">detect_objects</span><span class="p">(</span><span class="n">image_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Object detection on image&quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">conf_threshold</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">boxes</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of detected objects: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
            <span class="c1"># Coordinates</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">xyxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="c1"># Class and confidence</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">conf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">conf</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> at (</span><span class="si">{</span><span class="n">x1</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y1</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x2</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y2</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Usage example</span>
<span class="c1"># results = detect_objects(&quot;image.jpg&quot;)</span>

<span class="c1"># Visualize results</span>
<span class="c1"># results[0].show()  # Display image</span>
<span class="c1"># results[0].save(&quot;result.jpg&quot;)  # Save</span>


<span class="c1"># ===============================</span>
<span class="c1"># 3. Video/Webcam Detection</span>
<span class="c1"># ===============================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">detect_video</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Real-time detection on video or webcam</span>

<span class="sd">    Args:</span>
<span class="sd">        source: 0=webcam, or video file path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># return as generator</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="c1"># Per-frame processing</span>
        <span class="n">annotated_frame</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  <span class="c1"># frame with boxes drawn</span>

        <span class="c1"># Can display with cv2.imshow() etc.</span>
        <span class="k">yield</span> <span class="n">annotated_frame</span>


<span class="c1"># ===============================</span>
<span class="c1"># 4. Custom Dataset Training</span>
<span class="c1"># ===============================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">train_custom_model</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Train YOLO on custom dataset&quot;&quot;&quot;</span>

    <span class="c1"># Dataset yaml file example (data.yaml):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    path: /path/to/dataset</span>
<span class="sd">    train: images/train</span>
<span class="sd">    val: images/val</span>

<span class="sd">    names:</span>
<span class="sd">      0: cat</span>
<span class="sd">      1: dog</span>
<span class="sd">      2: bird</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Model training</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="s2">&quot;yolov8n.pt&quot;</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="s2">&quot;data.yaml&quot;</span><span class="p">,</span>
        <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">imgsz</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span>
        <span class="n">batch</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># GPU 0, or &quot;cpu&quot;</span>
        <span class="n">patience</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Early stopping</span>
        <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">project</span><span class="o">=</span><span class="s2">&quot;runs/detect&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;custom_model&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>


<span class="c1"># ===============================</span>
<span class="c1"># 5. Model Export</span>
<span class="c1"># ===============================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">export_model</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export model to various formats&quot;&quot;&quot;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="s2">&quot;yolov8n.pt&quot;</span><span class="p">)</span>

    <span class="c1"># Export to ONNX</span>
    <span class="n">model</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;onnx&quot;</span><span class="p">)</span>

    <span class="c1"># Export to TensorRT (GPU inference optimization)</span>
    <span class="c1"># model.export(format=&quot;engine&quot;)</span>

    <span class="c1"># Export to CoreML (Apple)</span>
    <span class="c1"># model.export(format=&quot;coreml&quot;)</span>

    <span class="c1"># Export to TFLite (mobile)</span>
    <span class="c1"># model.export(format=&quot;tflite&quot;)</span>
</code></pre></div>

<h3 id="33-yolov8-loss-function">3.3 YOLOv8 Loss Function<a class="header-link" href="#33-yolov8-loss-function" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">YOLOv8 loss function components:</span>

<span class="sd">1. Box Loss (CIoU Loss):</span>
<span class="sd">   - Accuracy of box location and size</span>
<span class="sd">   - CIoU = IoU - (distance penalty + aspect ratio penalty)</span>

<span class="sd">2. Classification Loss (BCE):</span>
<span class="sd">   - Binary cross entropy for each class</span>
<span class="sd">   - Focal Loss variant can be used</span>

<span class="sd">3. DFL Loss (Distribution Focal Loss):</span>
<span class="sd">   - Distribution prediction for box boundaries</span>
<span class="sd">   - New regression method in YOLOv8</span>

<span class="sd">Total Loss = Î»_box * L_box + Î»_cls * L_cls + Î»_dfl * L_dfl</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ciou_loss</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">,</span> <span class="n">target_boxes</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complete IoU Loss</span>

<span class="sd">    Args:</span>
<span class="sd">        pred_boxes: (N, 4) predicted boxes [x1, y1, x2, y2]</span>
<span class="sd">        target_boxes: (N, 4) ground truth boxes</span>

<span class="sd">    Returns:</span>
<span class="sd">        CIoU loss</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># IoU calculation</span>
    <span class="n">inter_x1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">inter_y1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">inter_x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">inter_y2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>

    <span class="n">inter_area</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">inter_x2</span> <span class="o">-</span> <span class="n">inter_x1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
                 <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">inter_y2</span> <span class="o">-</span> <span class="n">inter_y1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">pred_area</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">target_area</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> \
                  <span class="p">(</span><span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">union_area</span> <span class="o">=</span> <span class="n">pred_area</span> <span class="o">+</span> <span class="n">target_area</span> <span class="o">-</span> <span class="n">inter_area</span>
    <span class="n">iou</span> <span class="o">=</span> <span class="n">inter_area</span> <span class="o">/</span> <span class="p">(</span><span class="n">union_area</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>

    <span class="c1"># Center point distance</span>
    <span class="n">pred_cx</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">pred_cy</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">target_cx</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">target_cy</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">center_dist_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_cx</span> <span class="o">-</span> <span class="n">target_cx</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pred_cy</span> <span class="o">-</span> <span class="n">target_cy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="c1"># Diagonal distance (enclosing box)</span>
    <span class="n">enclose_x1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">enclose_y1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">enclose_x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">enclose_y2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>

    <span class="n">enclose_diag_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">enclose_x2</span> <span class="o">-</span> <span class="n">enclose_x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
                      <span class="p">(</span><span class="n">enclose_y2</span> <span class="o">-</span> <span class="n">enclose_y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="c1"># Aspect ratio consistency</span>
    <span class="n">pred_w</span> <span class="o">=</span> <span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">pred_h</span> <span class="o">=</span> <span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">pred_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">target_w</span> <span class="o">=</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">target_h</span> <span class="o">=</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_boxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">target_w</span> <span class="o">/</span> <span class="p">(</span><span class="n">target_h</span> <span class="o">+</span> <span class="n">eps</span><span class="p">))</span> <span class="o">-</span>
         <span class="n">torch</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">pred_w</span> <span class="o">/</span> <span class="p">(</span><span class="n">pred_h</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)))</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">iou</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>

    <span class="c1"># CIoU</span>
    <span class="n">ciou</span> <span class="o">=</span> <span class="n">iou</span> <span class="o">-</span> <span class="p">(</span><span class="n">center_dist_sq</span> <span class="o">/</span> <span class="p">(</span><span class="n">enclose_diag_sq</span> <span class="o">+</span> <span class="n">eps</span><span class="p">))</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">v</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ciou</span>
</code></pre></div>

<hr />
<h2 id="4-detr-detection-transformer">4. DETR (Detection Transformer)<a class="header-link" href="#4-detr-detection-transformer" title="Permanent link">&para;</a></h2>
<h3 id="41-detr-concept">4.1 DETR Concept<a class="header-link" href="#41-detr-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="nx">DETR</span><span class="w"> </span><span class="nx">Architecture</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Traditional</span><span class="w"> </span><span class="nx">detector</span><span class="w"> </span><span class="nx">issues</span><span class="p">:</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Anchor</span><span class="w"> </span><span class="nx">design</span><span class="w"> </span><span class="nx">required</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">NMS</span><span class="w"> </span><span class="p">(</span><span class="nx">Non</span><span class="o">-</span><span class="nx">Maximum</span><span class="w"> </span><span class="nx">Suppression</span><span class="p">)</span><span class="w"> </span><span class="nx">post</span><span class="o">-</span><span class="nx">processing</span><span class="w"> </span><span class="nx">required</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Complex</span><span class="w"> </span><span class="nx">pipeline</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">DETR</span><span class="w"> </span><span class="nx">innovations</span><span class="p">:</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">End</span><span class="o">-</span><span class="nx">to</span><span class="o">-</span><span class="nx">end</span><span class="w"> </span><span class="nx">training</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Direct</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="nx">prediction</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">Object</span><span class="w"> </span><span class="nx">Queries</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Training</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">Hungarian</span><span class="w"> </span><span class="nx">Matching</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">NMS</span><span class="w"> </span><span class="nx">required</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Backbone</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Transformer</span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">FFN</span><span class="w"> </span><span class="nx">Heads</span><span class="w">             </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="nx">ResNet</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Encoder</span><span class="o">/</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="kd">class</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">box</span><span class="p">)</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Decoder</span><span class="w">    </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â†“</span><span class="w">                 </span><span class="err">â†“</span><span class="w">                      </span><span class="err">â†“</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Feature</span><span class="w"> </span><span class="nx">Map</span><span class="w">    </span><span class="nx">Object</span><span class="w"> </span><span class="nx">Queries</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w">      </span><span class="mi">100</span><span class="w"> </span><span class="nx">prediction</span><span class="w"> </span><span class="nx">outputs</span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nx">Positional</span><span class="w">   </span><span class="err">â†“</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="nx">Encoding</span><span class="w">     </span><span class="k">Self</span><span class="o">-</span><span class="nx">attention</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">Cross</span><span class="o">-</span><span class="nx">attention</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="42-detr-implementation">4.2 DETR Implementation<a class="header-link" href="#42-detr-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">resnet50</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DETR</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplified DETR implementation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_queries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">hidden_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
        <span class="n">nheads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">num_encoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
        <span class="n">num_decoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Backbone</span>
        <span class="n">backbone</span> <span class="o">=</span> <span class="n">resnet50</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">backbone</span><span class="o">.</span><span class="n">children</span><span class="p">())[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Feature map â†’ hidden_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Transformer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Transformer</span><span class="p">(</span>
            <span class="n">d_model</span><span class="o">=</span><span class="n">hidden_dim</span><span class="p">,</span>
            <span class="n">nhead</span><span class="o">=</span><span class="n">nheads</span><span class="p">,</span>
            <span class="n">num_encoder_layers</span><span class="o">=</span><span class="n">num_encoder_layers</span><span class="p">,</span>
            <span class="n">num_decoder_layers</span><span class="o">=</span><span class="n">num_decoder_layers</span><span class="p">,</span>
            <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Object Queries (learned embeddings)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_embed</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">num_queries</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>

        <span class="c1"># Output heads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># +1 for no-object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox_head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>  <span class="c1"># cx, cy, w, h</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># Positional Encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_embed</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">hidden_dim</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_embed</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">hidden_dim</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            x: (B, 3, H, W) input image</span>

<span class="sd">        Returns:</span>
<span class="sd">            class_logits: (B, num_queries, num_classes+1)</span>
<span class="sd">            bbox_pred: (B, num_queries, 4)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Backbone feature extraction</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># (B, 2048, H/32, W/32)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>  <span class="c1"># (B, 256, H/32, W/32)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Generate Positional Encoding</span>
        <span class="n">pos_embed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_positional_encoding</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># Flatten for Transformer</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># (B, H*W, 256)</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">src</span> <span class="o">+</span> <span class="n">pos_embed</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Object Queries</span>
        <span class="n">query_embed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_embed</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Transformer</span>
        <span class="n">tgt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">query_embed</span><span class="p">)</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span> <span class="o">+</span> <span class="n">query_embed</span><span class="p">)</span>  <span class="c1"># (B, num_queries, 256)</span>

        <span class="c1"># Predictions</span>
        <span class="n">class_logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_head</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span>
        <span class="n">bbox_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_head</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">class_logits</span><span class="p">,</span> <span class="n">bbox_pred</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_positional_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate 2D Positional Encoding&quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

        <span class="n">x_embed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_embed</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># (W, 128)</span>
        <span class="n">y_embed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_embed</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>  <span class="c1"># (H, 128)</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span>
            <span class="n">x_embed</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">y_embed</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (H, W, 256)</span>

        <span class="k">return</span> <span class="n">pos</span>


<span class="c1"># Hungarian Matching Loss (simplified)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HungarianMatcher</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimal matching between predictions and GT</span>

<span class="sd">    Cost = Î»_cls * L_cls + Î»_box * L_box + Î»_giou * L_giou</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cost_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cost_bbox</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cost_giou</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_class</span> <span class="o">=</span> <span class="n">cost_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_bbox</span> <span class="o">=</span> <span class="n">cost_bbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_giou</span> <span class="o">=</span> <span class="n">cost_giou</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform bipartite matching using</span>
<span class="sd">        scipy.optimize.linear_sum_assignment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Implementation omitted (uses scipy)</span>
        <span class="k">pass</span>
</code></pre></div>

<h3 id="43-rt-detr-real-time-detr">4.3 RT-DETR (Real-Time DETR)<a class="header-link" href="#43-rt-detr-real-time-detr" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">RTDETR</span>

<span class="c1"># RT-DETR usage (Ultralytics)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RTDETR</span><span class="p">(</span><span class="s2">&quot;rtdetr-l.pt&quot;</span><span class="p">)</span>

<span class="c1"># Inference</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="s2">&quot;image.jpg&quot;</span><span class="p">)</span>

<span class="c1"># Training</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s2">&quot;coco.yaml&quot;</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RT-DETR features:</span>
<span class="sd">- Maintains DETR&#39;s end-to-end advantages</span>
<span class="sd">- Real-time inference possible (YOLO-level speed)</span>
<span class="sd">- Efficient Hybrid Encoder</span>
<span class="sd">- IoU-aware Query Selection</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>

<hr />
<h2 id="5-instance-segmentation">5. Instance Segmentation<a class="header-link" href="#5-instance-segmentation" title="Permanent link">&para;</a></h2>
<h3 id="51-mask-r-cnn">5.1 Mask R-CNN<a class="header-link" href="#51-mask-r-cnn" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.models.detection</span><span class="w"> </span><span class="kn">import</span> <span class="n">maskrcnn_resnet50_fpn_v2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.models.detection.mask_rcnn</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaskRCNNPredictor</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_mask_rcnn</span><span class="p">(</span><span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create custom Mask R-CNN</span>

<span class="sd">    Mask R-CNN = Faster R-CNN + Mask Head</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">maskrcnn_resnet50_fpn_v2</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">)</span>

    <span class="c1"># Replace box predictor</span>
    <span class="n">in_features</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">roi_heads</span><span class="o">.</span><span class="n">box_predictor</span><span class="o">.</span><span class="n">cls_score</span><span class="o">.</span><span class="n">in_features</span>
    <span class="n">model</span><span class="o">.</span><span class="n">roi_heads</span><span class="o">.</span><span class="n">box_predictor</span> <span class="o">=</span> <span class="n">FastRCNNPredictor</span><span class="p">(</span><span class="n">in_features</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>

    <span class="c1"># Replace mask predictor</span>
    <span class="n">in_features_mask</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">roi_heads</span><span class="o">.</span><span class="n">mask_predictor</span><span class="o">.</span><span class="n">conv5_mask</span><span class="o">.</span><span class="n">in_channels</span>
    <span class="n">hidden_layer</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">model</span><span class="o">.</span><span class="n">roi_heads</span><span class="o">.</span><span class="n">mask_predictor</span> <span class="o">=</span> <span class="n">MaskRCNNPredictor</span><span class="p">(</span>
        <span class="n">in_features_mask</span><span class="p">,</span> <span class="n">hidden_layer</span><span class="p">,</span> <span class="n">num_classes</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span>


<span class="k">def</span><span class="w"> </span><span class="nf">inference_mask_rcnn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mask R-CNN inference&quot;&quot;&quot;</span>

    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">([</span><span class="n">image</span><span class="p">])</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;boxes&quot;</span><span class="p">:</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;boxes&quot;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
        <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
        <span class="s2">&quot;scores&quot;</span><span class="p">:</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
        <span class="s2">&quot;masks&quot;</span><span class="p">:</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;masks&quot;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>  <span class="c1"># (N, 1, H, W) soft masks</span>
    <span class="p">}</span>

    <span class="c1"># Convert to hard masks</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;masks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;masks&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (N, H, W)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># YOLOv8-seg usage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">YOLO</span>

<span class="n">seg_model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="s2">&quot;yolov8n-seg.pt&quot;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">seg_model</span><span class="p">(</span><span class="s2">&quot;image.jpg&quot;</span><span class="p">)</span>

<span class="c1"># Extract masks from results</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">masks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">masks</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># (N, H, W)</span>
</code></pre></div>

<h3 id="52-sam-segment-anything-model">5.2 SAM (Segment Anything Model)<a class="header-link" href="#52-sam-segment-anything-model" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">segment_anything</span><span class="w"> </span><span class="kn">import</span> <span class="n">sam_model_registry</span><span class="p">,</span> <span class="n">SamPredictor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Load SAM model</span>
<span class="n">sam</span> <span class="o">=</span> <span class="n">sam_model_registry</span><span class="p">[</span><span class="s2">&quot;vit_h&quot;</span><span class="p">](</span><span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;sam_vit_h.pth&quot;</span><span class="p">)</span>
<span class="n">predictor</span> <span class="o">=</span> <span class="n">SamPredictor</span><span class="p">(</span><span class="n">sam</span><span class="p">)</span>

<span class="c1"># Set image</span>
<span class="n">predictor</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>  <span class="c1"># (H, W, 3) numpy array</span>

<span class="c1"># Segmentation with point prompt</span>
<span class="n">input_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">375</span><span class="p">]])</span>  <span class="c1"># click coordinates</span>
<span class="n">input_label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 1 = foreground</span>

<span class="n">masks</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">logits</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">point_coords</span><span class="o">=</span><span class="n">input_point</span><span class="p">,</span>
    <span class="n">point_labels</span><span class="o">=</span><span class="n">input_label</span><span class="p">,</span>
    <span class="n">multimask_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># return 3 mask candidates</span>
<span class="p">)</span>

<span class="c1"># Segmentation with box prompt</span>
<span class="n">input_box</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">])</span>  <span class="c1"># x1, y1, x2, y2</span>

<span class="n">masks</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">logits</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">box</span><span class="o">=</span><span class="n">input_box</span><span class="p">,</span>
    <span class="n">multimask_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SAM features:</span>
<span class="sd">- Promptable segmentation (point, box, text)</span>
<span class="sd">- Zero-shot generalization</span>
<span class="sd">- Very high segmentation quality</span>
<span class="sd">- Large model with slow speed â†’ lightweight versions like MobileSAM, FastSAM exist</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>

<hr />
<h2 id="6-practical-tips">6. Practical Tips<a class="header-link" href="#6-practical-tips" title="Permanent link">&para;</a></h2>
<h3 id="61-dataset-formats">6.1 Dataset Formats<a class="header-link" href="#61-dataset-formats" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Major dataset formats:</span>

<span class="sd">1. COCO Format:</span>
<span class="sd">   - All annotations stored in annotations.json</span>
<span class="sd">   - Images and annotations separated</span>

<span class="sd">2. YOLO Format:</span>
<span class="sd">   - .txt file for each image</span>
<span class="sd">   - class x_center y_center width height (normalized)</span>

<span class="sd">3. Pascal VOC Format:</span>
<span class="sd">   - XML file for each image annotation</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># YOLO format example (labels/train/image001.txt)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">0 0.5 0.5 0.2 0.3</span>
<span class="sd">1 0.3 0.7 0.1 0.15</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># COCO to YOLO conversion</span>
<span class="k">def</span><span class="w"> </span><span class="nf">coco_to_yolo</span><span class="p">(</span><span class="n">coco_box</span><span class="p">,</span> <span class="n">img_width</span><span class="p">,</span> <span class="n">img_height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    COCO: [x_min, y_min, width, height]</span>
<span class="sd">    YOLO: [x_center, y_center, width, height] (normalized)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">coco_box</span>

    <span class="n">x_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">img_width</span>
    <span class="n">y_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">img_height</span>
    <span class="n">w_norm</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">img_width</span>
    <span class="n">h_norm</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">img_height</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">,</span> <span class="n">w_norm</span><span class="p">,</span> <span class="n">h_norm</span><span class="p">]</span>
</code></pre></div>

<h3 id="62-training-tips">6.2 Training Tips<a class="header-link" href="#62-training-tips" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Object detection training checklist:</span>

<span class="sd">1. Data Quality</span>
<span class="sd">   - Verify label accuracy</span>
<span class="sd">   - Handle class imbalance (Focal Loss, oversampling)</span>
<span class="sd">   - Use appropriate augmentation</span>

<span class="sd">2. Hyperparameters</span>
<span class="sd">   - Learning rate: 1e-4 ~ 1e-3 (starting from pretrained)</span>
<span class="sd">   - Batch size: as large as possible within GPU memory</span>
<span class="sd">   - Image size: use model default (YOLO: 640)</span>

<span class="sd">3. Augmentation Strategy</span>
<span class="sd">   - Mosaic: compose 4 images (YOLO)</span>
<span class="sd">   - MixUp: image blending</span>
<span class="sd">   - Basic: Flip, Scale, Color Jitter</span>

<span class="sd">4. Model Selection</span>
<span class="sd">   - Real-time: YOLO (YOLOv8n, YOLOv8s)</span>
<span class="sd">   - Accuracy: Faster R-CNN, DETR</span>
<span class="sd">   - Segmentation: YOLOv8-seg, Mask R-CNN</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Ultralytics training example</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">YOLO</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="s2">&quot;yolov8n.pt&quot;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="s2">&quot;data.yaml&quot;</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">imgsz</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span>
    <span class="n">batch</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>

    <span class="c1"># Augmentation</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>      <span class="c1"># Mosaic probability</span>
    <span class="n">mixup</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>       <span class="c1"># MixUp probability</span>
    <span class="n">hsv_h</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span>     <span class="c1"># Hue augmentation</span>
    <span class="n">hsv_s</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>       <span class="c1"># Saturation augmentation</span>
    <span class="n">hsv_v</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>       <span class="c1"># Value augmentation</span>
    <span class="n">degrees</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>     <span class="c1"># Rotation</span>
    <span class="n">translate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>   <span class="c1"># Translation</span>
    <span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>       <span class="c1"># Scale</span>
    <span class="n">fliplr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>      <span class="c1"># Horizontal flip</span>

    <span class="c1"># Regularization</span>
    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span>

    <span class="c1"># Training schedule</span>
    <span class="n">warmup_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">warmup_momentum</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">warmup_bias_lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">lr0</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>        <span class="c1"># Initial learning rate</span>
    <span class="n">lrf</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>        <span class="c1"># Final learning rate ratio</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<h3 id="detector-selection-guide">Detector Selection Guide<a class="header-link" href="#detector-selection-guide" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Requirements</th>
<th>Recommended Model</th>
</tr>
</thead>
<tbody>
<tr>
<td>Real-time (30+ FPS)</td>
<td>YOLOv8n/s</td>
</tr>
<tr>
<td>High accuracy</td>
<td>YOLOv8x, Faster R-CNN</td>
</tr>
<tr>
<td>Small objects</td>
<td>YOLO + SAHI, RetinaNet</td>
</tr>
<tr>
<td>Instance segmentation</td>
<td>YOLOv8-seg, Mask R-CNN</td>
</tr>
<tr>
<td>End-to-end</td>
<td>DETR, RT-DETR</td>
</tr>
<tr>
<td>Zero-shot</td>
<td>Grounding DINO, SAM</td>
</tr>
</tbody>
</table>
<h3 id="key-concepts-summary">Key Concepts Summary<a class="header-link" href="#key-concepts-summary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>IoU</td>
<td>Box overlap degree (0~1)</td>
</tr>
<tr>
<td>mAP</td>
<td>mean Average Precision (accuracy metric)</td>
</tr>
<tr>
<td>NMS</td>
<td>Non-Maximum Suppression (duplicate box removal)</td>
</tr>
<tr>
<td>Anchor</td>
<td>Pre-defined reference boxes</td>
</tr>
<tr>
<td>FPN</td>
<td>Multi-scale feature extraction</td>
</tr>
<tr>
<td>GIoU/CIoU</td>
<td>Improved IoU loss functions</td>
</tr>
</tbody>
</table>
<h3 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="24_Semantic_Segmentation.md">24_Semantic_Segmentation.md</a>: Semantic Segmentation</li>
<li><a href="../../Computer_Vision/19_DNN_Module.md">Computer_Vision/19_DNN_Module.md</a>: OpenCV DNN</li>
</ul>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<h3 id="papers">Papers<a class="header-link" href="#papers" title="Permanent link">&para;</a></h3>
<ul>
<li>"Faster R-CNN" (Ren et al., 2015)</li>
<li>"YOLO: You Only Look Once" (Redmon et al., 2016)</li>
<li>"DETR: End-to-End Object Detection with Transformers" (Carion et al., 2020)</li>
<li>"Segment Anything" (Kirillov et al., 2023)</li>
</ul>
<h3 id="code-resources">Code &amp; Resources<a class="header-link" href="#code-resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/ultralytics/ultralytics">Ultralytics YOLOv8</a></li>
<li><a href="https://pytorch.org/vision/stable/models.html#object-detection">torchvision detection</a></li>
<li><a href="https://cocodataset.org/">COCO Dataset</a></li>
<li><a href="https://roboflow.com/">Roboflow</a> - Dataset management</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Deep_Learning/37_Modern_Architectures.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">37. Modern Deep Learning Architectures</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Deep_Learning/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Deep_Learning/39_Practical_Image_Classification.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">39. Practical Image Classification Project</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}