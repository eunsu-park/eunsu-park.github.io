{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05. BLE Connectivity - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/IoT_Embedded/">IoT Embedded</a>
    <span class="separator">/</span>
    <span class="current">05. BLE Connectivity</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>05. BLE Connectivity</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/IoT_Embedded/04_WiFi_Networking.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">04. WiFi Networking</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/IoT_Embedded/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/IoT_Embedded/06_MQTT_Protocol.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">06. MQTT Protocol</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#1-ble-basics">1. BLE Basics</a><ul>
<li><a href="#11-ble-vs-classic-bluetooth">1.1 BLE vs Classic Bluetooth</a></li>
<li><a href="#12-ble-protocol-stack">1.2 BLE Protocol Stack</a></li>
<li><a href="#13-gatt-generic-attribute-profile-structure">1.3 GATT (Generic Attribute Profile) Structure</a></li>
</ul>
</li>
<li><a href="#2-python-ble-programming-with-bleak">2. Python BLE Programming with bleak</a><ul>
<li><a href="#21-bleak-library-installation">2.1 bleak Library Installation</a></li>
<li><a href="#22-ble-device-scanning">2.2 BLE Device Scanning</a></li>
<li><a href="#23-connect-to-ble-device">2.3 Connect to BLE Device</a></li>
<li><a href="#24-read-characteristic">2.4 Read Characteristic</a></li>
<li><a href="#25-write-characteristic">2.5 Write Characteristic</a></li>
<li><a href="#26-notification-handling">2.6 Notification Handling</a></li>
</ul>
</li>
<li><a href="#3-standard-ble-services-and-characteristics">3. Standard BLE Services and Characteristics</a><ul>
<li><a href="#31-common-standard-uuids">3.1 Common Standard UUIDs</a></li>
<li><a href="#32-read-device-information">3.2 Read Device Information</a></li>
</ul>
</li>
<li><a href="#4-practical-project-ble-sensor-monitor">4. Practical Project: BLE Sensor Monitor</a></li>
<li><a href="#5-ble-security">5. BLE Security</a><ul>
<li><a href="#51-security-features">5.1 Security Features</a></li>
<li><a href="#52-pairing-in-python">5.2 Pairing in Python</a></li>
</ul>
</li>
<li><a href="#6-troubleshooting">6. Troubleshooting</a><ul>
<li><a href="#61-common-issues">6.1 Common Issues</a></li>
<li><a href="#62-bluetooth-service-management">6.2 Bluetooth Service Management</a></li>
<li><a href="#63-debug-logging">6.3 Debug Logging</a></li>
</ul>
</li>
<li><a href="#7-summary">7. Summary</a><ul>
<li><a href="#completed-tasks">Completed Tasks</a></li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#hands-on-exercises">Hands-On Exercises</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="05-ble-connectivity">05. BLE Connectivity<a class="header-link" href="#05-ble-connectivity" title="Permanent link">&para;</a></h1>
<p>This lesson covers Bluetooth Low Energy (BLE) communication for IoT devices. We'll learn BLE protocol basics, GATT structure, Python BLE programming with the bleak library, and sensor data collection via BLE.</p>
<hr />
<h2 id="1-ble-basics">1. BLE Basics<a class="header-link" href="#1-ble-basics" title="Permanent link">&para;</a></h2>
<h3 id="11-ble-vs-classic-bluetooth">1.1 BLE vs Classic Bluetooth<a class="header-link" href="#11-ble-vs-classic-bluetooth" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Classic Bluetooth</th>
<th>BLE (Bluetooth Low Energy)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Audio streaming, file transfer</td>
<td>IoT sensors, wearables</td>
</tr>
<tr>
<td><strong>Power Consumption</strong></td>
<td>High (100mA)</td>
<td>Very low (10-50Î¼A)</td>
</tr>
<tr>
<td><strong>Data Rate</strong></td>
<td>1-3 Mbps</td>
<td>125-1000 kbps</td>
</tr>
<tr>
<td><strong>Range</strong></td>
<td>10-100m</td>
<td>10-50m</td>
</tr>
<tr>
<td><strong>Connection Time</strong></td>
<td>~6 seconds</td>
<td>~6ms</td>
</tr>
<tr>
<td><strong>Use Cases</strong></td>
<td>Audio devices, smartphones</td>
<td>Fitness trackers, smart home sensors</td>
</tr>
</tbody>
</table>
<p><strong>BLE Advantages:</strong>
- Ultra-low power â†’ suitable for battery operation
- Fast connection establishment
- Simple device implementation
- Widely supported (smartphones, tablets, PCs)</p>
<h3 id="12-ble-protocol-stack">1.2 BLE Protocol Stack<a class="header-link" href="#12-ble-protocol-stack" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Application Layer            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     GATT (Generic Attribute)     â”‚  â† Service/Characteristic definitions
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ATT (Attribute Protocol)     â”‚  â† Read/Write/Notify operations
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     L2CAP (Logical Link Control) â”‚  â† Data segmentation/reassembly
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Link Layer                   â”‚  â† Advertising, connection management
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Physical Layer               â”‚  â† 2.4GHz radio transmission
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="13-gatt-generic-attribute-profile-structure">1.3 GATT (Generic Attribute Profile) Structure<a class="header-link" href="#13-gatt-generic-attribute-profile-structure" title="Permanent link">&para;</a></h3>
<p>GATT defines how BLE devices exchange data using a hierarchical structure:</p>
<div class="highlight"><pre><span></span><code>Device
  â””â”€â”€ Service (UUID: 0x180F - Battery Service)
       â”œâ”€â”€ Characteristic (UUID: 0x2A19 - Battery Level)
       â”‚    â”œâ”€â”€ Properties: Read, Notify
       â”‚    â”œâ”€â”€ Value: 0x64 (100%)
       â”‚    â””â”€â”€ Descriptor (Client Characteristic Configuration)
       â””â”€â”€ Characteristic (UUID: 0x2A1A - Battery Power State)
            â””â”€â”€ Value: ...
</code></pre></div>

<p><strong>Key Concepts:</strong>
- <strong>Service</strong>: Logical grouping of related characteristics (e.g., Heart Rate Service, Temperature Service)
- <strong>Characteristic</strong>: Individual data point (e.g., Heart Rate Measurement, Temperature Value)
- <strong>Properties</strong>: Read, Write, Notify, Indicate
- <strong>UUID</strong>: Unique identifier (16-bit for standard services, 128-bit for custom)</p>
<hr />
<h2 id="2-python-ble-programming-with-bleak">2. Python BLE Programming with bleak<a class="header-link" href="#2-python-ble-programming-with-bleak" title="Permanent link">&para;</a></h2>
<h3 id="21-bleak-library-installation">2.1 bleak Library Installation<a class="header-link" href="#21-bleak-library-installation" title="Permanent link">&para;</a></h3>
<p><code>bleak</code> is a cross-platform Python BLE library.</p>
<div class="highlight"><pre><span></span><code>pip3<span class="w"> </span>install<span class="w"> </span>bleak
</code></pre></div>

<p><strong>Dependencies (Linux):</strong></p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>bluez
</code></pre></div>

<h3 id="22-ble-device-scanning">2.2 BLE Device Scanning<a class="header-link" href="#22-ble-device-scanning" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakScanner</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scan_devices</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scanning for BLE devices...&quot;</span><span class="p">)</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="k">await</span> <span class="n">BleakScanner</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span><span class="si">}</span><span class="s2"> device(s):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Address: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   RSSI: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">rssi</span><span class="si">}</span><span class="s2"> dBm&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">scan_devices</span><span class="p">())</span>
</code></pre></div>

<p><strong>Output Example:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nv">Scanning</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">BLE</span><span class="w"> </span><span class="nv">devices</span>...

<span class="nv">Found</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">device</span><span class="ss">(</span><span class="nv">s</span><span class="ss">)</span>:

<span class="mi">1</span>.<span class="w"> </span><span class="nv">Mi</span><span class="w"> </span><span class="nv">Smart</span><span class="w"> </span><span class="nv">Band</span><span class="w"> </span><span class="mi">5</span>
<span class="w">   </span><span class="nv">Address</span>:<span class="w"> </span><span class="nv">A4</span>:<span class="nv">C1</span>:<span class="mi">38</span>:<span class="nv">XX</span>:<span class="nv">XX</span>:<span class="nv">XX</span>
<span class="w">   </span><span class="nv">RSSI</span>:<span class="w"> </span><span class="o">-</span><span class="mi">56</span><span class="w"> </span><span class="nv">dBm</span>

<span class="mi">2</span>.<span class="w"> </span><span class="nv">Arduino</span><span class="w"> </span><span class="nv">Nano</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="nv">BLE</span>
<span class="w">   </span><span class="nv">Address</span>:<span class="w"> </span><span class="mi">00</span>:<span class="mi">11</span>:<span class="mi">22</span>:<span class="nv">XX</span>:<span class="nv">XX</span>:<span class="nv">XX</span>
<span class="w">   </span><span class="nv">RSSI</span>:<span class="w"> </span><span class="o">-</span><span class="mi">72</span><span class="w"> </span><span class="nv">dBm</span>

<span class="mi">3</span>.<span class="w"> </span><span class="nv">Unknown</span>
<span class="w">   </span><span class="nv">Address</span>:<span class="w"> </span><span class="nv">F0</span>:<span class="mi">98</span>:<span class="mi">9</span><span class="nv">D</span>:<span class="nv">XX</span>:<span class="nv">XX</span>:<span class="nv">XX</span>
<span class="w">   </span><span class="nv">RSSI</span>:<span class="w"> </span><span class="o">-</span><span class="mi">85</span><span class="w"> </span><span class="nv">dBm</span>
</code></pre></div>

<h3 id="23-connect-to-ble-device">2.3 Connect to BLE Device<a class="header-link" href="#23-connect-to-ble-device" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect_device</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected: </span><span class="si">{</span><span class="n">client</span><span class="o">.</span><span class="n">is_connected</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># List all services</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Services:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">services</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Service] </span><span class="si">{</span><span class="n">service</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">service</span><span class="o">.</span><span class="n">characteristics</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [Char] </span><span class="si">{</span><span class="n">char</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Properties: </span><span class="si">{</span><span class="n">char</span><span class="o">.</span><span class="n">properties</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Replace with your device address</span>
    <span class="n">ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;A4:C1:38:XX:XX:XX&quot;</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">connect_device</span><span class="p">(</span><span class="n">ADDRESS</span><span class="p">))</span>
</code></pre></div>

<h3 id="24-read-characteristic">2.4 Read Characteristic<a class="header-link" href="#24-read-characteristic" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>

<span class="c1"># Standard UUIDs</span>
<span class="n">BATTERY_SERVICE_UUID</span> <span class="o">=</span> <span class="s2">&quot;0000180f-0000-1000-8000-00805f9b34fb&quot;</span>
<span class="n">BATTERY_LEVEL_CHAR_UUID</span> <span class="o">=</span> <span class="s2">&quot;00002a19-0000-1000-8000-00805f9b34fb&quot;</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_battery_level</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># Read battery level</span>
        <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">BATTERY_LEVEL_CHAR_UUID</span><span class="p">)</span>
        <span class="n">battery_level</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Battery Level: </span><span class="si">{</span><span class="n">battery_level</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;A4:C1:38:XX:XX:XX&quot;</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">read_battery_level</span><span class="p">(</span><span class="n">ADDRESS</span><span class="p">))</span>
</code></pre></div>

<h3 id="25-write-characteristic">2.5 Write Characteristic<a class="header-link" href="#25-write-characteristic" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">char_uuid</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># Write data to characteristic</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">write_gatt_char</span><span class="p">(</span><span class="n">char_uuid</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data written: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;00:11:22:XX:XX:XX&quot;</span>
    <span class="n">CHAR_UUID</span> <span class="o">=</span> <span class="s2">&quot;0000ffe1-0000-1000-8000-00805f9b34fb&quot;</span>

    <span class="c1"># Send command (example: LED ON)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">])</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">write_data</span><span class="p">(</span><span class="n">ADDRESS</span><span class="p">,</span> <span class="n">CHAR_UUID</span><span class="p">,</span> <span class="n">command</span><span class="p">))</span>
</code></pre></div>

<h3 id="26-notification-handling">2.6 Notification Handling<a class="header-link" href="#26-notification-handling" title="Permanent link">&para;</a></h3>
<p>Notifications allow the device to push data without polling.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">notification_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Callback for notifications&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Notification from </span><span class="si">{</span><span class="n">sender</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Parse data (example: temperature sensor)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Temperature: </span><span class="si">{</span><span class="n">temp</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">Â°C&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">subscribe_notifications</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">char_uuid</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Start notifications</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">start_notify</span><span class="p">(</span><span class="n">char_uuid</span><span class="p">,</span> <span class="n">notification_handler</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subscribed to notifications on </span><span class="si">{</span><span class="n">char_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Keep connection alive</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># Stop notifications</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">stop_notify</span><span class="p">(</span><span class="n">char_uuid</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unsubscribed from notifications&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;A4:C1:38:XX:XX:XX&quot;</span>
    <span class="n">CHAR_UUID</span> <span class="o">=</span> <span class="s2">&quot;00002a1c-0000-1000-8000-00805f9b34fb&quot;</span>  <span class="c1"># Temperature Measurement</span>

    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">subscribe_notifications</span><span class="p">(</span><span class="n">ADDRESS</span><span class="p">,</span> <span class="n">CHAR_UUID</span><span class="p">))</span>
</code></pre></div>

<hr />
<h2 id="3-standard-ble-services-and-characteristics">3. Standard BLE Services and Characteristics<a class="header-link" href="#3-standard-ble-services-and-characteristics" title="Permanent link">&para;</a></h2>
<h3 id="31-common-standard-uuids">3.1 Common Standard UUIDs<a class="header-link" href="#31-common-standard-uuids" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Service</th>
<th>UUID</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Battery Service</strong></td>
<td>0x180F</td>
<td>Battery information</td>
</tr>
<tr>
<td><strong>Device Information</strong></td>
<td>0x180A</td>
<td>Manufacturer, model, firmware</td>
</tr>
<tr>
<td><strong>Heart Rate</strong></td>
<td>0x180D</td>
<td>Heart rate monitoring</td>
</tr>
<tr>
<td><strong>Environmental Sensing</strong></td>
<td>0x181A</td>
<td>Temperature, humidity, pressure</td>
</tr>
<tr>
<td><strong>Health Thermometer</strong></td>
<td>0x1809</td>
<td>Body temperature</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>UUID</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Battery Level</strong></td>
<td>0x2A19</td>
<td>uint8</td>
<td>Battery percentage (0-100)</td>
</tr>
<tr>
<td><strong>Temperature</strong></td>
<td>0x2A1C</td>
<td>sint16</td>
<td>Temperature (Ã—0.01Â°C)</td>
</tr>
<tr>
<td><strong>Humidity</strong></td>
<td>0x2A6F</td>
<td>uint16</td>
<td>Humidity (Ã—0.01%)</td>
</tr>
<tr>
<td><strong>Manufacturer Name</strong></td>
<td>0x2A29</td>
<td>string</td>
<td>Manufacturer name</td>
</tr>
<tr>
<td><strong>Firmware Revision</strong></td>
<td>0x2A26</td>
<td>string</td>
<td>Firmware version</td>
</tr>
</tbody>
</table>
<h3 id="32-read-device-information">3.2 Read Device Information<a class="header-link" href="#32-read-device-information" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>

<span class="n">DEVICE_INFO_SERVICE</span> <span class="o">=</span> <span class="s2">&quot;0000180a-0000-1000-8000-00805f9b34fb&quot;</span>
<span class="n">MANUFACTURER_CHAR</span> <span class="o">=</span> <span class="s2">&quot;00002a29-0000-1000-8000-00805f9b34fb&quot;</span>
<span class="n">MODEL_CHAR</span> <span class="o">=</span> <span class="s2">&quot;00002a24-0000-1000-8000-00805f9b34fb&quot;</span>
<span class="n">FIRMWARE_CHAR</span> <span class="o">=</span> <span class="s2">&quot;00002a26-0000-1000-8000-00805f9b34fb&quot;</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_device_info</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">manufacturer</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">MANUFACTURER_CHAR</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manufacturer: </span><span class="si">{</span><span class="n">manufacturer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Manufacturer: N/A&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">MODEL_CHAR</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model: N/A&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">firmware</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">FIRMWARE_CHAR</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Firmware: </span><span class="si">{</span><span class="n">firmware</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Firmware: N/A&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;A4:C1:38:XX:XX:XX&quot;</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">read_device_info</span><span class="p">(</span><span class="n">ADDRESS</span><span class="p">))</span>
</code></pre></div>

<hr />
<h2 id="4-practical-project-ble-sensor-monitor">4. Practical Project: BLE Sensor Monitor<a class="header-link" href="#4-practical-project-ble-sensor-monitor" title="Permanent link">&para;</a></h2>
<p>Comprehensive BLE sensor monitoring system with reconnection logic.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span><span class="p">,</span> <span class="n">BleakScanner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BLESensorMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device_address</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_name</span> <span class="o">=</span> <span class="n">device_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_address</span> <span class="o">=</span> <span class="n">device_address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Characteristic UUIDs (customize for your device)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BATTERY_UUID</span> <span class="o">=</span> <span class="s2">&quot;00002a19-0000-1000-8000-00805f9b34fb&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TEMP_UUID</span> <span class="o">=</span> <span class="s2">&quot;00002a1c-0000-1000-8000-00805f9b34fb&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HUMIDITY_UUID</span> <span class="o">=</span> <span class="s2">&quot;00002a6f-0000-1000-8000-00805f9b34fb&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find device by name or address&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_address</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_address</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scanning for device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="k">await</span> <span class="n">BleakScanner</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_name</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found device: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">device</span><span class="o">.</span><span class="n">address</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">notification_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle notifications from device&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEMP_UUID</span><span class="p">:</span>
            <span class="c1"># Temperature (Ã—0.01Â°C)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] Temperature: </span><span class="si">{</span><span class="n">temp</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">Â°C&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">HUMIDITY_UUID</span><span class="p">:</span>
            <span class="c1"># Humidity (Ã—0.01%)</span>
            <span class="n">humidity</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] Humidity: </span><span class="si">{</span><span class="n">humidity</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] Notification from </span><span class="si">{</span><span class="n">sender</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_battery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read battery level&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BATTERY_UUID</span><span class="p">)</span>
            <span class="n">battery</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Battery Level: </span><span class="si">{</span><span class="n">battery</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">battery</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read battery: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connect to device and subscribe to notifications&quot;&quot;&quot;</span>
        <span class="n">address</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_device</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Read battery level</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_battery</span><span class="p">()</span>

            <span class="c1"># Subscribe to notifications</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">start_notify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEMP_UUID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">notification_handler</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subscribed to temperature notifications&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Temperature notifications not available&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">start_notify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HUMIDITY_UUID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">notification_handler</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Subscribed to humidity notifications&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Humidity notifications not available&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Disconnect from device&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Disconnected&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main monitoring loop with auto-reconnect&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrying in 10 seconds...&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Stay connected and handle notifications</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                    <span class="c1"># Periodic battery check (every 60 seconds)</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_battery</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during monitoring: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reconnecting in 5 seconds...&quot;</span><span class="p">)</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop monitoring&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Method 1: Search by device name</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="n">BLESensorMonitor</span><span class="p">(</span><span class="n">device_name</span><span class="o">=</span><span class="s2">&quot;Arduino Nano 33 BLE&quot;</span><span class="p">)</span>

    <span class="c1"># Method 2: Direct connection with address</span>
    <span class="c1"># monitor = BLESensorMonitor(device_address=&quot;A4:C1:38:XX:XX:XX&quot;)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">monitor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Stopping monitor...&quot;</span><span class="p">)</span>
        <span class="n">monitor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">monitor</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>

<p><strong>Features:</strong>
- âœ… Device scanning by name or direct address connection
- âœ… Automatic reconnection on disconnect
- âœ… Notification handling for temperature/humidity
- âœ… Periodic battery level checks
- âœ… Comprehensive error handling and logging</p>
<hr />
<h2 id="5-ble-security">5. BLE Security<a class="header-link" href="#5-ble-security" title="Permanent link">&para;</a></h2>
<h3 id="51-security-features">5.1 Security Features<a class="header-link" href="#51-security-features" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Pairing</strong></td>
<td>Authentication process between devices</td>
</tr>
<tr>
<td><strong>Bonding</strong></td>
<td>Storing encryption keys for future connections</td>
</tr>
<tr>
<td><strong>Encryption</strong></td>
<td>AES-128 CCM encryption for data transmission</td>
</tr>
<tr>
<td><strong>Privacy</strong></td>
<td>MAC address randomization to prevent tracking</td>
</tr>
</tbody>
</table>
<h3 id="52-pairing-in-python">5.2 Pairing in Python<a class="header-link" href="#52-pairing-in-python" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">pair_device</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># Pairing is usually handled automatically by the OS</span>
        <span class="c1"># On Linux, you may need to use bluetoothctl:</span>
        <span class="c1"># $ bluetoothctl</span>
        <span class="c1"># [bluetooth]# pair A4:C1:38:XX:XX:XX</span>

        <span class="n">paired</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">pair</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pairing successful: </span><span class="si">{</span><span class="n">paired</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Now you can access protected characteristics</span>
        <span class="c1"># ...</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;A4:C1:38:XX:XX:XX&quot;</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pair_device</span><span class="p">(</span><span class="n">ADDRESS</span><span class="p">))</span>
</code></pre></div>

<p><strong>Manual Pairing (Linux):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Start bluetoothctl</span>
bluetoothctl

<span class="c1"># Scan for devices</span>
scan<span class="w"> </span>on

<span class="c1"># Pair with device</span>
pair<span class="w"> </span>A4:C1:38:XX:XX:XX

<span class="c1"># Trust device (auto-connect in future)</span>
trust<span class="w"> </span>A4:C1:38:XX:XX:XX

<span class="c1"># Connect</span>
connect<span class="w"> </span>A4:C1:38:XX:XX:XX
</code></pre></div>

<hr />
<h2 id="6-troubleshooting">6. Troubleshooting<a class="header-link" href="#6-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="61-common-issues">6.1 Common Issues<a class="header-link" href="#61-common-issues" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>No devices found</strong></td>
<td>Bluetooth disabled, device out of range</td>
<td>Check <code>hciconfig</code>, move closer to device</td>
</tr>
<tr>
<td><strong>Connection timeout</strong></td>
<td>Device not advertising, already connected</td>
<td>Reset device, disconnect other connections</td>
</tr>
<tr>
<td><strong>Permission denied</strong></td>
<td>Insufficient privileges</td>
<td>Run with sudo or add user to bluetooth group</td>
</tr>
<tr>
<td><strong>Characteristic not found</strong></td>
<td>Wrong UUID, service not available</td>
<td>Verify UUID, check device documentation</td>
</tr>
<tr>
<td><strong>Notifications not working</strong></td>
<td>Client Characteristic Configuration Descriptor (CCCD) not enabled</td>
<td>Ensure start_notify is called correctly</td>
</tr>
</tbody>
</table>
<h3 id="62-bluetooth-service-management">6.2 Bluetooth Service Management<a class="header-link" href="#62-bluetooth-service-management" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check Bluetooth status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>bluetooth

<span class="c1"># Restart Bluetooth service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>bluetooth

<span class="c1"># Check Bluetooth adapter</span>
hciconfig

<span class="c1"># Enable adapter</span>
sudo<span class="w"> </span>hciconfig<span class="w"> </span>hci0<span class="w"> </span>up

<span class="c1"># Scan for devices (command line)</span>
sudo<span class="w"> </span>hcitool<span class="w"> </span>lescan

<span class="c1"># Reset Bluetooth adapter</span>
sudo<span class="w"> </span>hciconfig<span class="w"> </span>hci0<span class="w"> </span>reset
</code></pre></div>

<h3 id="63-debug-logging">6.3 Debug Logging<a class="header-link" href="#63-debug-logging" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bleak</span><span class="w"> </span><span class="kn">import</span> <span class="n">BleakClient</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="c1"># Enable debug logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">debug_connection</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">BleakClient</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected: </span><span class="si">{</span><span class="n">client</span><span class="o">.</span><span class="n">is_connected</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># List all services and characteristics</span>
        <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">services</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Service] </span><span class="si">{</span><span class="n">service</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">service</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">service</span><span class="o">.</span><span class="n">characteristics</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [Char] </span><span class="si">{</span><span class="n">char</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Properties: </span><span class="si">{</span><span class="n">char</span><span class="o">.</span><span class="n">properties</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Handle: </span><span class="si">{</span><span class="n">char</span><span class="o">.</span><span class="n">handle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Try to read if readable</span>
                <span class="k">if</span> <span class="s2">&quot;read&quot;</span> <span class="ow">in</span> <span class="n">char</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">read_gatt_char</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Value: </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Read failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug_connection</span><span class="p">(</span><span class="s2">&quot;A4:C1:38:XX:XX:XX&quot;</span><span class="p">))</span>
</code></pre></div>

<hr />
<h2 id="7-summary">7. Summary<a class="header-link" href="#7-summary" title="Permanent link">&para;</a></h2>
<h3 id="completed-tasks">Completed Tasks<a class="header-link" href="#completed-tasks" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ… <strong>BLE Basics</strong>: BLE vs Classic Bluetooth, protocol stack, GATT structure</li>
<li>âœ… <strong>bleak Library</strong>: Device scanning, connection, read/write/notify operations</li>
<li>âœ… <strong>Standard Services</strong>: Battery Service, Environmental Sensing, Device Information</li>
<li>âœ… <strong>Practical Project</strong>: Complete BLE sensor monitor with auto-reconnect</li>
<li>âœ… <strong>Security</strong>: Pairing, encryption, privacy features</li>
<li>âœ… <strong>Troubleshooting</strong>: Common issues and solutions</li>
</ul>
<h3 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Next Lesson</th>
<th>Topic</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>06. MQTT Protocol</strong></td>
<td>IoT messaging protocol</td>
<td>Mosquitto broker, pub/sub patterns, QoS levels</td>
</tr>
<tr>
<td><strong>07. HTTP REST for IoT</strong></td>
<td>RESTful API design</td>
<td>Flask server, CRUD operations, request validation</td>
</tr>
<tr>
<td><strong>08. Edge AI with TFLite</strong></td>
<td>Machine learning on edge</td>
<td>TensorFlow Lite, model optimization, inference</td>
</tr>
</tbody>
</table>
<h3 id="hands-on-exercises">Hands-On Exercises<a class="header-link" href="#hands-on-exercises" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Heart Rate Monitor</strong>:</li>
<li>Connect to BLE heart rate sensor</li>
<li>Display real-time heart rate</li>
<li>
<p>Log data to CSV file with timestamps</p>
</li>
<li>
<p><strong>Multi-Device Monitor</strong>:</p>
</li>
<li>Connect to multiple BLE sensors simultaneously</li>
<li>Aggregate data from all sensors</li>
<li>
<p>Display unified dashboard</p>
</li>
<li>
<p><strong>BLE Proximity Alert</strong>:</p>
</li>
<li>Monitor RSSI (signal strength)</li>
<li>Alert when device moves out of range</li>
<li>
<p>Implement geofencing logic</p>
</li>
<li>
<p><strong>Custom BLE Server</strong> (Advanced):</p>
</li>
<li>Use Raspberry Pi as BLE peripheral</li>
<li>Expose GPIO state as BLE characteristics</li>
<li>Allow remote LED control via BLE</li>
</ol>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://bleak.readthedocs.io/">bleak Documentation</a></li>
<li><a href="https://www.bluetooth.com/specifications/gatt/">Bluetooth SIG Specifications</a></li>
<li><a href="https://www.bluetooth.com/specifications/assigned-numbers/">GATT Services and Characteristics</a></li>
<li><a href="https://www.bluetooth.com/blog/bluetooth-pairing-part-1-pairing-feature-exchange/">BLE Security Guide</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/IoT_Embedded/04_WiFi_Networking.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">04. WiFi Networking</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/IoT_Embedded/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/IoT_Embedded/06_MQTT_Protocol.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">06. MQTT Protocol</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}