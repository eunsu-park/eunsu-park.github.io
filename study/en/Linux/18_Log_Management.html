{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Management - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Linux/">Linux</a>
    <span class="separator">/</span>
    <span class="current">Log Management</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Log Management</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Linux/17_SELinux_AppArmor.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">SELinux and AppArmor</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Linux/19_Backup_Recovery.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Backup and Recovery</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-linux-log-system-overview">1. Linux Log System Overview</a><ul>
<li><a href="#log-system-architecture">Log System Architecture</a></li>
<li><a href="#main-log-files">Main Log Files</a></li>
<li><a href="#log-priority-severity">Log Priority (Severity)</a></li>
</ul>
</li>
<li><a href="#2-systemd-journald">2. systemd-journald</a><ul>
<li><a href="#journald-configuration">journald Configuration</a></li>
<li><a href="#enabling-persistent-storage">Enabling Persistent Storage</a></li>
<li><a href="#checking-journal-status">Checking Journal Status</a></li>
</ul>
</li>
<li><a href="#3-advanced-journalctl-usage">3. Advanced journalctl Usage</a><ul>
<li><a href="#basic-queries">Basic Queries</a></li>
<li><a href="#time-based-filtering">Time-based Filtering</a></li>
<li><a href="#serviceunit-filtering">Service/Unit Filtering</a></li>
<li><a href="#priority-filtering">Priority Filtering</a></li>
<li><a href="#output-formats">Output Formats</a></li>
<li><a href="#complex-queries">Complex Queries</a></li>
<li><a href="#journal-maintenance">Journal Maintenance</a></li>
</ul>
</li>
<li><a href="#4-rsyslog-configuration">4. rsyslog Configuration</a><ul>
<li><a href="#basic-rsyslog-configuration">Basic rsyslog Configuration</a></li>
<li><a href="#filter-syntax">Filter Syntax</a></li>
<li><a href="#advanced-filtering">Advanced Filtering</a></li>
<li><a href="#using-templates">Using Templates</a></li>
<li><a href="#conditional-processing">Conditional Processing</a></li>
</ul>
</li>
<li><a href="#5-logrotate">5. logrotate</a><ul>
<li><a href="#basic-configuration">Basic Configuration</a></li>
<li><a href="#application-specific-configuration">Application-specific Configuration</a></li>
<li><a href="#advanced-options">Advanced Options</a></li>
<li><a href="#testing-logrotate">Testing logrotate</a></li>
</ul>
</li>
<li><a href="#6-remote-log-collection">6. Remote Log Collection</a><ul>
<li><a href="#rsyslog-server-configuration">rsyslog Server Configuration</a></li>
<li><a href="#rsyslog-client-configuration">rsyslog Client Configuration</a></li>
<li><a href="#tls-encryption-setup">TLS Encryption Setup</a></li>
<li><a href="#firewall-configuration">Firewall Configuration</a></li>
</ul>
</li>
<li><a href="#7-log-analysis-tools">7. Log Analysis Tools</a><ul>
<li><a href="#lnav-log-navigator">lnav (Log Navigator)</a></li>
<li><a href="#multitail">multitail</a></li>
<li><a href="#goaccess-web-log-analysis">GoAccess (Web Log Analysis)</a></li>
<li><a href="#simple-analysis-commands">Simple Analysis Commands</a></li>
</ul>
</li>
<li><a href="#practice-problems">Practice Problems</a><ul>
<li><a href="#problem-1-journalctl-query">Problem 1: journalctl Query</a></li>
<li><a href="#problem-2-rsyslog-filter">Problem 2: rsyslog Filter</a></li>
<li><a href="#problem-3-logrotate-configuration">Problem 3: logrotate Configuration</a></li>
</ul>
</li>
<li><a href="#answers">Answers</a><ul>
<li><a href="#problem-1-answer">Problem 1 Answer</a></li>
<li><a href="#problem-2-answer">Problem 2 Answer</a></li>
<li><a href="#problem-3-answer">Problem 3 Answer</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="log-management">Log Management<a class="header-link" href="#log-management" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<p>Through this document, you will learn:</p>
<ul>
<li>systemd-journald configuration and usage</li>
<li>rsyslog configuration and filtering</li>
<li>Log rotation with logrotate</li>
<li>Remote log collection setup</li>
</ul>
<p><strong>Difficulty</strong>: Intermediate-Advanced</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-linux-log-system-overview">Linux Log System Overview</a></li>
<li><a href="#2-systemd-journald">systemd-journald</a></li>
<li><a href="#3-advanced-journalctl-usage">Advanced journalctl Usage</a></li>
<li><a href="#4-rsyslog-configuration">rsyslog Configuration</a></li>
<li><a href="#5-logrotate">logrotate</a></li>
<li><a href="#6-remote-log-collection">Remote Log Collection</a></li>
<li><a href="#7-log-analysis-tools">Log Analysis Tools</a></li>
</ol>
<hr />
<h2 id="1-linux-log-system-overview">1. Linux Log System Overview<a class="header-link" href="#1-linux-log-system-overview" title="Permanent link">&para;</a></h2>
<h3 id="log-system-architecture">Log System Architecture<a class="header-link" href="#log-system-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">Applications</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Services</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">                </span><span class="err">â”‚</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="w">                </span><span class="err">â–¼</span><span class="w">                         </span><span class="err">â–¼</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">    </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="w">       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="n">rsyslog</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">syslog</span><span class="o">-</span><span class="n">ng</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="p">(</span><span class="n">Binary</span><span class="w"> </span><span class="n">journal</span><span class="p">)</span><span class="w">       </span><span class="err">â”‚â”€â”€â–¶â”‚</span><span class="w">    </span><span class="p">(</span><span class="n">Text</span><span class="w"> </span><span class="nb">log</span><span class="w"> </span><span class="n">files</span><span class="p">)</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">                </span><span class="err">â”‚</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="w">                </span><span class="err">â–¼</span><span class="w">                         </span><span class="err">â–¼</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="w">        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/*.</span><span class="n">log</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="w">        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Remote</span><span class="w"> </span><span class="n">server</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="main-log-files">Main Log Files<a class="header-link" href="#main-log-files" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>File</th>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/var/log/messages</code></td>
<td>General system messages (RHEL/CentOS)</td>
</tr>
<tr>
<td><code>/var/log/syslog</code></td>
<td>General system messages (Ubuntu/Debian)</td>
</tr>
<tr>
<td><code>/var/log/auth.log</code></td>
<td>Authentication logs (Ubuntu)</td>
</tr>
<tr>
<td><code>/var/log/secure</code></td>
<td>Authentication logs (RHEL)</td>
</tr>
<tr>
<td><code>/var/log/kern.log</code></td>
<td>Kernel messages</td>
</tr>
<tr>
<td><code>/var/log/dmesg</code></td>
<td>Boot time kernel messages</td>
</tr>
<tr>
<td><code>/var/log/cron</code></td>
<td>Cron job logs</td>
</tr>
<tr>
<td><code>/var/log/maillog</code></td>
<td>Mail server logs</td>
</tr>
</tbody>
</table>
<h3 id="log-priority-severity">Log Priority (Severity)<a class="header-link" href="#log-priority-severity" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Level</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>emerg</td>
<td>System unusable</td>
</tr>
<tr>
<td>1</td>
<td>alert</td>
<td>Immediate action required</td>
</tr>
<tr>
<td>2</td>
<td>crit</td>
<td>Critical error</td>
</tr>
<tr>
<td>3</td>
<td>err</td>
<td>Error</td>
</tr>
<tr>
<td>4</td>
<td>warning</td>
<td>Warning</td>
</tr>
<tr>
<td>5</td>
<td>notice</td>
<td>Normal but noteworthy</td>
</tr>
<tr>
<td>6</td>
<td>info</td>
<td>Informational message</td>
</tr>
<tr>
<td>7</td>
<td>debug</td>
<td>Debug message</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-systemd-journald">2. systemd-journald<a class="header-link" href="#2-systemd-journald" title="Permanent link">&para;</a></h2>
<h3 id="journald-configuration">journald Configuration<a class="header-link" href="#journald-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Configuration file</span>
sudo<span class="w"> </span>vi<span class="w"> </span>/etc/systemd/journald.conf
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># /etc/systemd/journald.conf</span>
<span class="k">[Journal]</span>
<span class="c1"># Storage method: volatile(memory), persistent(disk), auto, none</span>
<span class="na">Storage</span><span class="o">=</span><span class="s">persistent</span>

<span class="c1"># Maximum size (for disk storage)</span>
<span class="na">SystemMaxUse</span><span class="o">=</span><span class="s">500M</span>
<span class="na">SystemKeepFree</span><span class="o">=</span><span class="s">1G</span>
<span class="na">SystemMaxFileSize</span><span class="o">=</span><span class="s">50M</span>
<span class="na">SystemMaxFiles</span><span class="o">=</span><span class="s">100</span>

<span class="c1"># Runtime storage (memory)</span>
<span class="na">RuntimeMaxUse</span><span class="o">=</span><span class="s">50M</span>

<span class="c1"># Log compression</span>
<span class="na">Compress</span><span class="o">=</span><span class="s">yes</span>

<span class="c1"># Sealing (tamper-evident)</span>
<span class="na">Seal</span><span class="o">=</span><span class="s">yes</span>

<span class="c1"># Forward to rsyslog</span>
<span class="na">ForwardToSyslog</span><span class="o">=</span><span class="s">yes</span>

<span class="c1"># Console output</span>
<span class="na">ForwardToConsole</span><span class="o">=</span><span class="s">no</span>

<span class="c1"># Maximum retention period</span>
<span class="na">MaxRetentionSec</span><span class="o">=</span><span class="s">1month</span>

<span class="c1"># Rate limiting</span>
<span class="na">RateLimitIntervalSec</span><span class="o">=</span><span class="s">30s</span>
<span class="na">RateLimitBurst</span><span class="o">=</span><span class="s">10000</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Apply configuration</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>systemd-journald
</code></pre></div>

<h3 id="enabling-persistent-storage">Enabling Persistent Storage<a class="header-link" href="#enabling-persistent-storage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create journal directory (persistent storage)</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/journal
sudo<span class="w"> </span>systemd-tmpfiles<span class="w"> </span>--create<span class="w"> </span>--prefix<span class="w"> </span>/var/log/journal

<span class="c1"># Set permissions</span>
sudo<span class="w"> </span>chown<span class="w"> </span>root:systemd-journal<span class="w"> </span>/var/log/journal
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">2755</span><span class="w"> </span>/var/log/journal

<span class="c1"># Restart journald</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>systemd-journald
</code></pre></div>

<h3 id="checking-journal-status">Checking Journal Status<a class="header-link" href="#checking-journal-status" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Disk usage</span>
journalctl<span class="w"> </span>--disk-usage

<span class="c1"># Check journal files</span>
journalctl<span class="w"> </span>--header

<span class="c1"># Verify journal integrity</span>
journalctl<span class="w"> </span>--verify
</code></pre></div>

<hr />
<h2 id="3-advanced-journalctl-usage">3. Advanced journalctl Usage<a class="header-link" href="#3-advanced-journalctl-usage" title="Permanent link">&para;</a></h2>
<h3 id="basic-queries">Basic Queries<a class="header-link" href="#basic-queries" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># All logs</span>
journalctl

<span class="c1"># Reverse order (newest first)</span>
journalctl<span class="w"> </span>-r

<span class="c1"># Real-time follow</span>
journalctl<span class="w"> </span>-f

<span class="c1"># Last N lines</span>
journalctl<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span>

<span class="c1"># Output without pager</span>
journalctl<span class="w"> </span>--no-pager
</code></pre></div>

<h3 id="time-based-filtering">Time-based Filtering<a class="header-link" href="#time-based-filtering" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Today&#39;s logs</span>
journalctl<span class="w"> </span>--since<span class="w"> </span>today

<span class="c1"># Yesterday&#39;s logs</span>
journalctl<span class="w"> </span>--since<span class="w"> </span>yesterday<span class="w"> </span>--until<span class="w"> </span>today

<span class="c1"># Specific time range</span>
journalctl<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;2024-01-15 10:00:00&quot;</span><span class="w"> </span>--until<span class="w"> </span><span class="s2">&quot;2024-01-15 12:00:00&quot;</span>

<span class="c1"># Relative time</span>
journalctl<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;1 hour ago&quot;</span>
journalctl<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;30 minutes ago&quot;</span>

<span class="c1"># Boot related</span>
journalctl<span class="w"> </span>-b<span class="w">          </span><span class="c1"># Current boot</span>
journalctl<span class="w"> </span>-b<span class="w"> </span>-1<span class="w">       </span><span class="c1"># Previous boot</span>
journalctl<span class="w"> </span>--list-boots<span class="w"> </span><span class="c1"># Boot list</span>
</code></pre></div>

<h3 id="serviceunit-filtering">Service/Unit Filtering<a class="header-link" href="#serviceunit-filtering" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Specific service</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>nginx.service
journalctl<span class="w"> </span>-u<span class="w"> </span>nginx<span class="w"> </span>-u<span class="w"> </span>php-fpm

<span class="c1"># Kernel messages</span>
journalctl<span class="w"> </span>-k

<span class="c1"># Specific PID</span>
journalctl<span class="w"> </span><span class="nv">_PID</span><span class="o">=</span><span class="m">1234</span>

<span class="c1"># Specific executable</span>
journalctl<span class="w"> </span>/usr/bin/bash

<span class="c1"># Specific user</span>
journalctl<span class="w"> </span><span class="nv">_UID</span><span class="o">=</span><span class="m">1000</span>
</code></pre></div>

<h3 id="priority-filtering">Priority Filtering<a class="header-link" href="#priority-filtering" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Error and above</span>
journalctl<span class="w"> </span>-p<span class="w"> </span>err

<span class="c1"># Warning and above</span>
journalctl<span class="w"> </span>-p<span class="w"> </span>warning

<span class="c1"># Range specification</span>
journalctl<span class="w"> </span>-p<span class="w"> </span>err..crit

<span class="c1"># Numeric specification</span>
journalctl<span class="w"> </span>-p<span class="w"> </span><span class="m">3</span>
</code></pre></div>

<h3 id="output-formats">Output Formats<a class="header-link" href="#output-formats" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># JSON format</span>
journalctl<span class="w"> </span>-o<span class="w"> </span>json
journalctl<span class="w"> </span>-o<span class="w"> </span>json-pretty

<span class="c1"># Verbose output</span>
journalctl<span class="w"> </span>-o<span class="w"> </span>verbose

<span class="c1"># Short output</span>
journalctl<span class="w"> </span>-o<span class="w"> </span>short
journalctl<span class="w"> </span>-o<span class="w"> </span>short-precise<span class="w">  </span><span class="c1"># Include microseconds</span>

<span class="c1"># cat style (message only)</span>
journalctl<span class="w"> </span>-o<span class="w"> </span>cat

<span class="c1"># Export format</span>
journalctl<span class="w"> </span>-o<span class="w"> </span><span class="nb">export</span>
</code></pre></div>

<h3 id="complex-queries">Complex Queries<a class="header-link" href="#complex-queries" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Combination (AND)</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>nginx<span class="w"> </span>-p<span class="w"> </span>err<span class="w"> </span>--since<span class="w"> </span>today

<span class="c1"># Custom fields</span>
journalctl<span class="w"> </span><span class="nv">_SYSTEMD_UNIT</span><span class="o">=</span>sshd.service<span class="w"> </span><span class="nv">_PID</span><span class="o">=</span><span class="m">1234</span>

<span class="c1"># Message search</span>
journalctl<span class="w"> </span>-g<span class="w"> </span><span class="s2">&quot;error|fail|critical&quot;</span>

<span class="c1"># List field values</span>
journalctl<span class="w"> </span>-F<span class="w"> </span>_SYSTEMD_UNIT
journalctl<span class="w"> </span>-F<span class="w"> </span>PRIORITY
</code></pre></div>

<h3 id="journal-maintenance">Journal Maintenance<a class="header-link" href="#journal-maintenance" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete old logs (time-based)</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>--vacuum-time<span class="o">=</span>30d

<span class="c1"># Delete old logs (size-based)</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>--vacuum-size<span class="o">=</span>500M

<span class="c1"># Delete based on file count</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>--vacuum-files<span class="o">=</span><span class="m">10</span>

<span class="c1"># Delete all journals</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>--rotate
sudo<span class="w"> </span>journalctl<span class="w"> </span>--vacuum-time<span class="o">=</span>1s
</code></pre></div>

<hr />
<h2 id="4-rsyslog-configuration">4. rsyslog Configuration<a class="header-link" href="#4-rsyslog-configuration" title="Permanent link">&para;</a></h2>
<h3 id="basic-rsyslog-configuration">Basic rsyslog Configuration<a class="header-link" href="#basic-rsyslog-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Main configuration file</span>
sudo<span class="w"> </span>vi<span class="w"> </span>/etc/rsyslog.conf
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rsyslog.conf (main sections)</span>

<span class="c1"># Load modules</span>
module<span class="o">(</span><span class="nv">load</span><span class="o">=</span><span class="s2">&quot;imuxsock&quot;</span><span class="o">)</span><span class="w">    </span><span class="c1"># Local system log</span>
module<span class="o">(</span><span class="nv">load</span><span class="o">=</span><span class="s2">&quot;imjournal&quot;</span><span class="o">)</span><span class="w">   </span><span class="c1"># journald integration</span>
module<span class="o">(</span><span class="nv">load</span><span class="o">=</span><span class="s2">&quot;imklog&quot;</span><span class="o">)</span><span class="w">      </span><span class="c1"># Kernel log</span>

<span class="c1"># Global settings</span>
global<span class="o">(</span>
<span class="w">    </span><span class="nv">workDirectory</span><span class="o">=</span><span class="s2">&quot;/var/lib/rsyslog&quot;</span>
<span class="w">    </span><span class="nv">maxMessageSize</span><span class="o">=</span><span class="s2">&quot;64k&quot;</span>
<span class="o">)</span>

<span class="c1"># Default rules</span>
*.info<span class="p">;</span>mail.none<span class="p">;</span>authpriv.none<span class="p">;</span>cron.none<span class="w">    </span>/var/log/messages
authpriv.*<span class="w">                                   </span>/var/log/secure
mail.*<span class="w">                                       </span>-/var/log/maillog
cron.*<span class="w">                                       </span>/var/log/cron
*.emerg<span class="w">                                      </span>:omusrmsg:*
</code></pre></div>

<h3 id="filter-syntax">Filter Syntax<a class="header-link" href="#filter-syntax" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Basic syntax: facility.priority  action</span>

<span class="c1"># facility: auth, authpriv, cron, daemon, kern, mail, user, local0-7, *</span>
<span class="c1"># priority: emerg, alert, crit, err, warning, notice, info, debug, none, *</span>

<span class="c1"># Examples</span>
kern.*<span class="w">                      </span>/var/log/kern.log<span class="w">        </span><span class="c1"># All kernel messages</span>
*.crit<span class="w">                      </span>/var/log/critical.log<span class="w">    </span><span class="c1"># All critical errors</span>
mail.err<span class="w">                    </span>/var/log/mail-err.log<span class="w">    </span><span class="c1"># Mail errors</span>
*.info<span class="p">;</span>mail.none<span class="w">            </span>/var/log/messages<span class="w">        </span><span class="c1"># info and above, exclude mail</span>
</code></pre></div>

<h3 id="advanced-filtering">Advanced Filtering<a class="header-link" href="#advanced-filtering" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rsyslog.d/custom.conf</span>

<span class="c1"># Property-based filter</span>
:programname,<span class="w"> </span>isequal,<span class="w"> </span><span class="s2">&quot;nginx&quot;</span><span class="w"> </span>/var/log/nginx/access.log
:programname,<span class="w"> </span>startswith,<span class="w"> </span><span class="s2">&quot;postfix&quot;</span><span class="w"> </span>/var/log/mail/postfix.log

<span class="c1"># Message content based</span>
:msg,<span class="w"> </span>contains,<span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="w"> </span>/var/log/errors.log
:msg,<span class="w"> </span>regex,<span class="w"> </span><span class="s2">&quot;failed.*authentication&quot;</span><span class="w"> </span>/var/log/auth-failures.log

<span class="c1"># Complex conditions</span>
<span class="k">if</span><span class="w"> </span><span class="nv">$programname</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;sshd&#39;</span><span class="w"> </span>and<span class="w"> </span><span class="nv">$msg</span><span class="w"> </span>contains<span class="w"> </span><span class="s1">&#39;Failed&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>action<span class="o">(</span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;omfile&quot;</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/var/log/ssh-failures.log&quot;</span><span class="o">)</span>
<span class="w">    </span>stop
<span class="o">}</span>
</code></pre></div>

<h3 id="using-templates">Using Templates<a class="header-link" href="#using-templates" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Custom log format</span>
template<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;CustomFormat&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="nv">string</span><span class="o">=</span><span class="s2">&quot;%timegenerated% %HOSTNAME% %syslogtag%%msg%\n&quot;</span><span class="o">)</span>

<span class="c1"># JSON format</span>
template<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;JsonFormat&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>constant<span class="o">(</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;{&quot;</span><span class="o">)</span>
<span class="w">    </span>constant<span class="o">(</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;\&quot;timestamp\&quot;:\&quot;&quot;</span><span class="o">)</span><span class="w">     </span>property<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;timereported&quot;</span><span class="w"> </span><span class="nv">dateFormat</span><span class="o">=</span><span class="s2">&quot;rfc3339&quot;</span><span class="o">)</span>
<span class="w">    </span>constant<span class="o">(</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;\&quot;,\&quot;host\&quot;:\&quot;&quot;</span><span class="o">)</span><span class="w">       </span>property<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;hostname&quot;</span><span class="o">)</span>
<span class="w">    </span>constant<span class="o">(</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;\&quot;,\&quot;program\&quot;:\&quot;&quot;</span><span class="o">)</span><span class="w">    </span>property<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;programname&quot;</span><span class="o">)</span>
<span class="w">    </span>constant<span class="o">(</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;\&quot;,\&quot;severity\&quot;:\&quot;&quot;</span><span class="o">)</span><span class="w">   </span>property<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;syslogseverity-text&quot;</span><span class="o">)</span>
<span class="w">    </span>constant<span class="o">(</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;\&quot;,\&quot;message\&quot;:\&quot;&quot;</span><span class="o">)</span><span class="w">    </span>property<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;msg&quot;</span><span class="w"> </span><span class="nv">format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="o">)</span>
<span class="w">    </span>constant<span class="o">(</span><span class="nv">value</span><span class="o">=</span><span class="s2">&quot;\&quot;}\n&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1"># Apply template</span>
*.*<span class="w"> </span>action<span class="o">(</span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;omfile&quot;</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/var/log/json.log&quot;</span><span class="w"> </span><span class="nv">template</span><span class="o">=</span><span class="s2">&quot;JsonFormat&quot;</span><span class="o">)</span>
</code></pre></div>

<h3 id="conditional-processing">Conditional Processing<a class="header-link" href="#conditional-processing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># RainerScript syntax</span>
<span class="k">if</span><span class="w"> </span><span class="nv">$programname</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">$syslogseverity</span><span class="w"> </span>&lt;<span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="c1"># Error and above go to separate file</span>
<span class="w">        </span>action<span class="o">(</span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;omfile&quot;</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/var/log/nginx/error.log&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="c1"># Rest go to general log</span>
<span class="w">        </span>action<span class="o">(</span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;omfile&quot;</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/var/log/nginx/access.log&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span>stop
<span class="o">}</span>
</code></pre></div>

<hr />
<h2 id="5-logrotate">5. logrotate<a class="header-link" href="#5-logrotate" title="Permanent link">&para;</a></h2>
<h3 id="basic-configuration">Basic Configuration<a class="header-link" href="#basic-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Global configuration</span>
sudo<span class="w"> </span>vi<span class="w"> </span>/etc/logrotate.conf
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># /etc/logrotate.conf</span>

<span class="c1"># Rotation cycle: daily, weekly, monthly</span>
weekly

<span class="c1"># Number of logs to keep</span>
rotate<span class="w"> </span><span class="m">4</span>

<span class="c1"># Create new log file</span>
create

<span class="c1"># Use date extension</span>
dateext

<span class="c1"># Compression</span>
compress
delaycompress

<span class="c1"># Ignore empty log files</span>
notifempty

<span class="c1"># Include individual configurations</span>
include<span class="w"> </span>/etc/logrotate.d
</code></pre></div>

<h3 id="application-specific-configuration">Application-specific Configuration<a class="header-link" href="#application-specific-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/logrotate.d/nginx</span>
/var/log/nginx/*.log<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>daily
<span class="w">    </span>missingok
<span class="w">    </span>rotate<span class="w"> </span><span class="m">14</span>
<span class="w">    </span>compress
<span class="w">    </span>delaycompress
<span class="w">    </span>notifempty
<span class="w">    </span>create<span class="w"> </span><span class="m">0640</span><span class="w"> </span>www-data<span class="w"> </span>adm
<span class="w">    </span>sharedscripts
<span class="w">    </span>postrotate
<span class="w">        </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>/var/run/nginx.pid<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">kill</span><span class="w"> </span>-USR1<span class="w"> </span><span class="sb">`</span>cat<span class="w"> </span>/var/run/nginx.pid<span class="sb">`</span>
<span class="w">    </span>endscript
<span class="o">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># /etc/logrotate.d/mysql</span>
/var/log/mysql/*.log<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>daily
<span class="w">    </span>rotate<span class="w"> </span><span class="m">7</span>
<span class="w">    </span>missingok
<span class="w">    </span>create<span class="w"> </span><span class="m">640</span><span class="w"> </span>mysql<span class="w"> </span>adm
<span class="w">    </span>compress
<span class="w">    </span>sharedscripts
<span class="w">    </span>postrotate
<span class="w">        </span><span class="nb">test</span><span class="w"> </span>-x<span class="w"> </span>/usr/bin/mysqladmin<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>/root/.my.cnf<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span>/usr/bin/mysqladmin<span class="w"> </span>flush-logs
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span>endscript
<span class="o">}</span>
</code></pre></div>

<h3 id="advanced-options">Advanced Options<a class="header-link" href="#advanced-options" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/logrotate.d/custom-app</span>
/var/log/myapp/*.log<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Rotation cycle</span>
<span class="w">    </span>daily

<span class="w">    </span><span class="c1"># Number to keep</span>
<span class="w">    </span>rotate<span class="w"> </span><span class="m">30</span>

<span class="w">    </span><span class="c1"># Size-based rotation</span>
<span class="w">    </span>size<span class="w"> </span>100M

<span class="w">    </span><span class="c1"># Minimum size (don&#39;t rotate if smaller)</span>
<span class="w">    </span>minsize<span class="w"> </span>10M

<span class="w">    </span><span class="c1"># Maximum retention period</span>
<span class="w">    </span>maxage<span class="w"> </span><span class="m">365</span>

<span class="w">    </span><span class="c1"># Compression settings</span>
<span class="w">    </span>compress
<span class="w">    </span>compresscmd<span class="w"> </span>/usr/bin/xz
<span class="w">    </span>compressoptions<span class="w"> </span>-9
<span class="w">    </span>compressext<span class="w"> </span>.xz
<span class="w">    </span>delaycompress

<span class="w">    </span><span class="c1"># No error if file missing</span>
<span class="w">    </span>missingok

<span class="w">    </span><span class="c1"># Don&#39;t rotate empty files</span>
<span class="w">    </span>notifempty

<span class="w">    </span><span class="c1"># Create new file</span>
<span class="w">    </span>create<span class="w"> </span><span class="m">0644</span><span class="w"> </span>root<span class="w"> </span>root

<span class="w">    </span><span class="c1"># Or keep existing file</span>
<span class="w">    </span><span class="c1"># copytruncate</span>

<span class="w">    </span><span class="c1"># Scripts</span>
<span class="w">    </span>prerotate
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;About to rotate logs&quot;</span>
<span class="w">    </span>endscript

<span class="w">    </span>postrotate
<span class="w">        </span>systemctl<span class="w"> </span>reload<span class="w"> </span>myapp
<span class="w">    </span>endscript

<span class="w">    </span>firstaction
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting log rotation batch&quot;</span>
<span class="w">    </span>endscript

<span class="w">    </span>lastaction
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Finished log rotation batch&quot;</span>
<span class="w">    </span>endscript
<span class="o">}</span>
</code></pre></div>

<h3 id="testing-logrotate">Testing logrotate<a class="header-link" href="#testing-logrotate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Dry run (no actual execution)</span>
sudo<span class="w"> </span>logrotate<span class="w"> </span>-d<span class="w"> </span>/etc/logrotate.d/nginx

<span class="c1"># Force execution</span>
sudo<span class="w"> </span>logrotate<span class="w"> </span>-f<span class="w"> </span>/etc/logrotate.d/nginx

<span class="c1"># Verbose output</span>
sudo<span class="w"> </span>logrotate<span class="w"> </span>-v<span class="w"> </span>/etc/logrotate.conf

<span class="c1"># Check status file</span>
cat<span class="w"> </span>/var/lib/logrotate/status
</code></pre></div>

<hr />
<h2 id="6-remote-log-collection">6. Remote Log Collection<a class="header-link" href="#6-remote-log-collection" title="Permanent link">&para;</a></h2>
<h3 id="rsyslog-server-configuration">rsyslog Server Configuration<a class="header-link" href="#rsyslog-server-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rsyslog.conf (server)</span>

<span class="c1"># Enable UDP reception</span>
module<span class="o">(</span><span class="nv">load</span><span class="o">=</span><span class="s2">&quot;imudp&quot;</span><span class="o">)</span>
input<span class="o">(</span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;imudp&quot;</span><span class="w"> </span><span class="nv">port</span><span class="o">=</span><span class="s2">&quot;514&quot;</span><span class="o">)</span>

<span class="c1"># Enable TCP reception</span>
module<span class="o">(</span><span class="nv">load</span><span class="o">=</span><span class="s2">&quot;imtcp&quot;</span><span class="o">)</span>
input<span class="o">(</span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;imtcp&quot;</span><span class="w"> </span><span class="nv">port</span><span class="o">=</span><span class="s2">&quot;514&quot;</span><span class="o">)</span>

<span class="c1"># Separate logs by host</span>
<span class="nv">$template</span><span class="w"> </span>RemoteLogs,<span class="s2">&quot;/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log&quot;</span>
*.*<span class="w"> </span>?RemoteLogs

<span class="c1"># Or using RainerScript</span>
template<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;RemoteLogsByHost&quot;</span><span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="nv">string</span><span class="o">=</span><span class="s2">&quot;/var/log/remote/%HOSTNAME%/%</span><span class="nv">$YEAR</span><span class="s2">%-%</span><span class="nv">$MONTH</span><span class="s2">%-%</span><span class="nv">$DAY</span><span class="s2">%.log&quot;</span><span class="o">)</span>

<span class="k">if</span><span class="w"> </span><span class="nv">$fromhost</span>-ip<span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>action<span class="o">(</span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;omfile&quot;</span><span class="w"> </span><span class="nv">dynaFile</span><span class="o">=</span><span class="s2">&quot;RemoteLogsByHost&quot;</span><span class="o">)</span>
<span class="w">    </span>stop
<span class="o">}</span>
</code></pre></div>

<h3 id="rsyslog-client-configuration">rsyslog Client Configuration<a class="header-link" href="#rsyslog-client-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rsyslog.d/remote.conf (client)</span>

<span class="c1"># Send via UDP (@)</span>
*.*<span class="w"> </span>@logserver.example.com:514

<span class="c1"># Send via TCP (@@)</span>
*.*<span class="w"> </span>@@logserver.example.com:514

<span class="c1"># Send only specific logs</span>
auth.*<span class="w"> </span>@@logserver.example.com:514
*.err<span class="w"> </span>@@logserver.example.com:514

<span class="c1"># Queue configuration (reliable delivery)</span>
action<span class="o">(</span>
<span class="w">    </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;omfwd&quot;</span>
<span class="w">    </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;logserver.example.com&quot;</span>
<span class="w">    </span><span class="nv">port</span><span class="o">=</span><span class="s2">&quot;514&quot;</span>
<span class="w">    </span><span class="nv">protocol</span><span class="o">=</span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span>queue.type<span class="o">=</span><span class="s2">&quot;LinkedList&quot;</span>
<span class="w">    </span>queue.filename<span class="o">=</span><span class="s2">&quot;remote_queue&quot;</span>
<span class="w">    </span>queue.saveOnShutdown<span class="o">=</span><span class="s2">&quot;on&quot;</span>
<span class="w">    </span>queue.maxDiskSpace<span class="o">=</span><span class="s2">&quot;1g&quot;</span>
<span class="w">    </span>action.resumeRetryCount<span class="o">=</span><span class="s2">&quot;-1&quot;</span>
<span class="o">)</span>
</code></pre></div>

<h3 id="tls-encryption-setup">TLS Encryption Setup<a class="header-link" href="#tls-encryption-setup" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Server configuration</span>
module<span class="o">(</span><span class="nv">load</span><span class="o">=</span><span class="s2">&quot;imtcp&quot;</span>
<span class="w">    </span>StreamDriver.Name<span class="o">=</span><span class="s2">&quot;gtls&quot;</span>
<span class="w">    </span>StreamDriver.Mode<span class="o">=</span><span class="s2">&quot;1&quot;</span>
<span class="w">    </span>StreamDriver.AuthMode<span class="o">=</span><span class="s2">&quot;x509/name&quot;</span>
<span class="o">)</span>

global<span class="o">(</span>
<span class="w">    </span><span class="nv">DefaultNetstreamDriver</span><span class="o">=</span><span class="s2">&quot;gtls&quot;</span>
<span class="w">    </span><span class="nv">DefaultNetstreamDriverCAFile</span><span class="o">=</span><span class="s2">&quot;/etc/rsyslog.d/ca.pem&quot;</span>
<span class="w">    </span><span class="nv">DefaultNetstreamDriverCertFile</span><span class="o">=</span><span class="s2">&quot;/etc/rsyslog.d/server-cert.pem&quot;</span>
<span class="w">    </span><span class="nv">DefaultNetstreamDriverKeyFile</span><span class="o">=</span><span class="s2">&quot;/etc/rsyslog.d/server-key.pem&quot;</span>
<span class="o">)</span>

input<span class="o">(</span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;imtcp&quot;</span><span class="w"> </span><span class="nv">port</span><span class="o">=</span><span class="s2">&quot;6514&quot;</span><span class="o">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Client configuration</span>
global<span class="o">(</span>
<span class="w">    </span><span class="nv">DefaultNetstreamDriver</span><span class="o">=</span><span class="s2">&quot;gtls&quot;</span>
<span class="w">    </span><span class="nv">DefaultNetstreamDriverCAFile</span><span class="o">=</span><span class="s2">&quot;/etc/rsyslog.d/ca.pem&quot;</span>
<span class="w">    </span><span class="nv">DefaultNetstreamDriverCertFile</span><span class="o">=</span><span class="s2">&quot;/etc/rsyslog.d/client-cert.pem&quot;</span>
<span class="w">    </span><span class="nv">DefaultNetstreamDriverKeyFile</span><span class="o">=</span><span class="s2">&quot;/etc/rsyslog.d/client-key.pem&quot;</span>
<span class="o">)</span>

action<span class="o">(</span>
<span class="w">    </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;omfwd&quot;</span>
<span class="w">    </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;logserver.example.com&quot;</span>
<span class="w">    </span><span class="nv">port</span><span class="o">=</span><span class="s2">&quot;6514&quot;</span>
<span class="w">    </span><span class="nv">protocol</span><span class="o">=</span><span class="s2">&quot;tcp&quot;</span>
<span class="w">    </span><span class="nv">StreamDriver</span><span class="o">=</span><span class="s2">&quot;gtls&quot;</span>
<span class="w">    </span><span class="nv">StreamDriverMode</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
<span class="w">    </span><span class="nv">StreamDriverAuthMode</span><span class="o">=</span><span class="s2">&quot;x509/name&quot;</span>
<span class="o">)</span>
</code></pre></div>

<h3 id="firewall-configuration">Firewall Configuration<a class="header-link" href="#firewall-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># RHEL/CentOS (firewalld)</span>
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--add-port<span class="o">=</span><span class="m">514</span>/tcp
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--add-port<span class="o">=</span><span class="m">514</span>/udp
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload

<span class="c1"># Ubuntu (ufw)</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">514</span>/tcp
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">514</span>/udp
</code></pre></div>

<hr />
<h2 id="7-log-analysis-tools">7. Log Analysis Tools<a class="header-link" href="#7-log-analysis-tools" title="Permanent link">&para;</a></h2>
<h3 id="lnav-log-navigator">lnav (Log Navigator)<a class="header-link" href="#lnav-log-navigator" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Installation</span>
<span class="c1"># Ubuntu/Debian</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>lnav

<span class="c1"># RHEL/CentOS</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>epel-release
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>lnav

<span class="c1"># Usage</span>
lnav<span class="w"> </span>/var/log/syslog
lnav<span class="w"> </span>/var/log/nginx/*.log

<span class="c1"># Remote log (SSH)</span>
lnav<span class="w"> </span>ssh://user@server/var/log/syslog

<span class="c1"># Filtering (internal commands)</span>
:filter-in<span class="w"> </span>error
:filter-out<span class="w"> </span>debug
</code></pre></div>

<h3 id="multitail">multitail<a class="header-link" href="#multitail" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Installation</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>multitail<span class="w">  </span><span class="c1"># Ubuntu</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>multitail<span class="w">  </span><span class="c1"># RHEL</span>

<span class="c1"># Monitor multiple files simultaneously</span>
multitail<span class="w"> </span>/var/log/syslog<span class="w"> </span>/var/log/auth.log

<span class="c1"># Color distinction</span>
multitail<span class="w"> </span>-ci<span class="w"> </span>green<span class="w"> </span>/var/log/access.log<span class="w"> </span>-ci<span class="w"> </span>red<span class="w"> </span>/var/log/error.log
</code></pre></div>

<h3 id="goaccess-web-log-analysis">GoAccess (Web Log Analysis)<a class="header-link" href="#goaccess-web-log-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Installation</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>goaccess<span class="w">  </span><span class="c1"># Ubuntu</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>goaccess<span class="w">  </span><span class="c1"># RHEL</span>

<span class="c1"># Real-time analysis in terminal</span>
goaccess<span class="w"> </span>/var/log/nginx/access.log<span class="w"> </span>-c

<span class="c1"># Generate HTML report</span>
goaccess<span class="w"> </span>/var/log/nginx/access.log<span class="w"> </span>-o<span class="w"> </span>report.html<span class="w"> </span>--log-format<span class="o">=</span>COMBINED

<span class="c1"># Real-time HTML dashboard</span>
goaccess<span class="w"> </span>/var/log/nginx/access.log<span class="w"> </span>-o<span class="w"> </span>/var/www/html/report.html<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--log-format<span class="o">=</span>COMBINED<span class="w"> </span>--real-time-html
</code></pre></div>

<h3 id="simple-analysis-commands">Simple Analysis Commands<a class="header-link" href="#simple-analysis-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Top requesting IPs</span>
awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>/var/log/nginx/access.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head

<span class="c1"># HTTP status code distribution</span>
awk<span class="w"> </span><span class="s1">&#39;{print $9}&#39;</span><span class="w"> </span>/var/log/nginx/access.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn

<span class="c1"># Requests by hour</span>
awk<span class="w"> </span><span class="s1">&#39;{print $4}&#39;</span><span class="w"> </span>/var/log/nginx/access.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d:<span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c

<span class="c1"># Error message frequency</span>
grep<span class="w"> </span>-i<span class="w"> </span>error<span class="w"> </span>/var/log/syslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head

<span class="c1"># Failed SSH logins</span>
grep<span class="w"> </span><span class="s2">&quot;Failed password&quot;</span><span class="w"> </span>/var/log/auth.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $11}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn
</code></pre></div>

<hr />
<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-journalctl-query">Problem 1: journalctl Query<a class="header-link" href="#problem-1-journalctl-query" title="Permanent link">&para;</a></h3>
<p>Write commands to query logs with the following conditions:
1. Only nginx service error logs (today)
2. Output logs for a specific PID (1234) in JSON
3. Kernel warning and above messages from the last hour</p>
<h3 id="problem-2-rsyslog-filter">Problem 2: rsyslog Filter<a class="header-link" href="#problem-2-rsyslog-filter" title="Permanent link">&para;</a></h3>
<p>Write rsyslog rules that meet the following requirements:
- Save all auth messages to <code>/var/log/auth-all.log</code>
- Also save messages containing "Failed" to <code>/var/log/failures.log</code>
- Send error and above logs to remote server <code>192.168.1.100</code></p>
<h3 id="problem-3-logrotate-configuration">Problem 3: logrotate Configuration<a class="header-link" href="#problem-3-logrotate-configuration" title="Permanent link">&para;</a></h3>
<p>For logs in <code>/var/log/myapp/</code> directory:
- Daily rotation
- Keep for 30 days
- Rotate when exceeding 100MB
- xz compression
- Send SIGHUP to application after rotation</p>
<hr />
<h2 id="answers">Answers<a class="header-link" href="#answers" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-answer">Problem 1 Answer<a class="header-link" href="#problem-1-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. nginx error logs (today)</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>nginx<span class="w"> </span>-p<span class="w"> </span>err<span class="w"> </span>--since<span class="w"> </span>today

<span class="c1"># 2. PID 1234 JSON output</span>
journalctl<span class="w"> </span><span class="nv">_PID</span><span class="o">=</span><span class="m">1234</span><span class="w"> </span>-o<span class="w"> </span>json-pretty

<span class="c1"># 3. Kernel warning and above (1 hour)</span>
journalctl<span class="w"> </span>-k<span class="w"> </span>-p<span class="w"> </span>warning<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;1 hour ago&quot;</span>
</code></pre></div>

<h3 id="problem-2-answer">Problem 2 Answer<a class="header-link" href="#problem-2-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rsyslog.d/custom.conf</span>

<span class="c1"># auth log</span>
auth.*<span class="w">  </span>/var/log/auth-all.log

<span class="c1"># Messages containing Failed</span>
:msg,<span class="w"> </span>contains,<span class="w"> </span><span class="s2">&quot;Failed&quot;</span><span class="w"> </span>/var/log/failures.log

<span class="c1"># Remote transmission (error and above)</span>
*.err<span class="w"> </span>@@192.168.1.100:514
</code></pre></div>

<h3 id="problem-3-answer">Problem 3 Answer<a class="header-link" href="#problem-3-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/logrotate.d/myapp</span>
/var/log/myapp/*.log<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>daily
<span class="w">    </span>rotate<span class="w"> </span><span class="m">30</span>
<span class="w">    </span>size<span class="w"> </span>100M
<span class="w">    </span>compress
<span class="w">    </span>compresscmd<span class="w"> </span>/usr/bin/xz
<span class="w">    </span>compressext<span class="w"> </span>.xz
<span class="w">    </span>delaycompress
<span class="w">    </span>missingok
<span class="w">    </span>notifempty
<span class="w">    </span>create<span class="w"> </span><span class="m">0644</span><span class="w"> </span>root<span class="w"> </span>root
<span class="w">    </span>postrotate
<span class="w">        </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>/var/run/myapp.pid<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">kill</span><span class="w"> </span>-HUP<span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/var/run/myapp.pid<span class="k">)</span>
<span class="w">    </span>endscript
<span class="o">}</span>
</code></pre></div>

<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./19_Backup_Recovery.md">19_Backup_Recovery.md</a> - rsync, Borg Backup, disaster recovery strategy</li>
</ul>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd-journald.service.html">systemd Journal</a></li>
<li><a href="https://www.rsyslog.com/doc/">rsyslog Documentation</a></li>
<li><a href="https://linux.die.net/man/8/logrotate">logrotate Manual</a></li>
<li><code>man journalctl</code>, <code>man rsyslog.conf</code>, <code>man logrotate</code></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Linux/17_SELinux_AppArmor.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">SELinux and AppArmor</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Linux/19_Backup_Recovery.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Backup and Recovery</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}