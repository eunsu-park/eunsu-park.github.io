{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible Basics - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Linux/">Linux</a>
    <span class="separator">/</span>
    <span class="current">Ansible Basics</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Ansible Basics</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Linux/21_Virtualization_KVM.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Virtualization (KVM)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Linux/23_Advanced_Networking.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Advanced Networking</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-ansible-overview">1. Ansible Overview</a><ul>
<li><a href="#what-is-ansible">What is Ansible?</a></li>
<li><a href="#ansible-vs-other-tools">Ansible vs Other Tools</a></li>
</ul>
</li>
<li><a href="#2-installation-and-configuration">2. Installation and Configuration</a><ul>
<li><a href="#installing-ansible">Installing Ansible</a></li>
<li><a href="#ssh-key-configuration">SSH Key Configuration</a></li>
<li><a href="#ansiblecfg-configuration">ansible.cfg Configuration</a></li>
</ul>
</li>
<li><a href="#3-inventory">3. Inventory</a><ul>
<li><a href="#ini-format">INI Format</a></li>
<li><a href="#yaml-format">YAML Format</a></li>
<li><a href="#dynamic-inventory">Dynamic Inventory</a></li>
<li><a href="#verifying-inventory">Verifying Inventory</a></li>
</ul>
</li>
<li><a href="#4-ad-hoc-commands">4. Ad-hoc Commands</a><ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#frequently-used-modules">Frequently Used Modules</a></li>
<li><a href="#privilege-escalation">Privilege Escalation</a></li>
<li><a href="#parallel-execution">Parallel Execution</a></li>
</ul>
</li>
<li><a href="#5-playbook">5. Playbook</a><ul>
<li><a href="#basic-structure">Basic Structure</a></li>
<li><a href="#running-playbooks">Running Playbooks</a></li>
<li><a href="#conditionals-when">Conditionals (when)</a></li>
<li><a href="#loops">Loops</a></li>
<li><a href="#handlers">Handlers</a></li>
<li><a href="#blocks">Blocks</a></li>
</ul>
</li>
<li><a href="#6-variables-and-facts">6. Variables and Facts</a><ul>
<li><a href="#variable-definition-locations">Variable Definition Locations</a></li>
<li><a href="#variable-file-structure">Variable File Structure</a></li>
<li><a href="#group_varshost_vars-examples">group_vars/host_vars Examples</a></li>
<li><a href="#using-variables-in-playbooks">Using Variables in Playbooks</a></li>
<li><a href="#facts">Facts</a></li>
<li><a href="#jinja2-templates">Jinja2 Templates</a></li>
</ul>
</li>
<li><a href="#7-roles">7. Roles</a><ul>
<li><a href="#role-structure">Role Structure</a></li>
<li><a href="#creating-roles">Creating Roles</a></li>
<li><a href="#role-example">Role Example</a></li>
<li><a href="#using-roles">Using Roles</a></li>
<li><a href="#ansible-galaxy">Ansible Galaxy</a></li>
</ul>
</li>
<li><a href="#8-ansible-vault">8. Ansible Vault</a><ul>
<li><a href="#basic-vault-usage">Basic Vault Usage</a></li>
<li><a href="#vault-usage-example">Vault Usage Example</a></li>
<li><a href="#running-playbooks_1">Running Playbooks</a></li>
<li><a href="#string-encryption">String Encryption</a></li>
</ul>
</li>
<li><a href="#practice-problems">Practice Problems</a><ul>
<li><a href="#problem-1-write-inventory">Problem 1: Write Inventory</a></li>
<li><a href="#problem-2-write-playbook">Problem 2: Write Playbook</a></li>
<li><a href="#problem-3-write-role">Problem 3: Write Role</a></li>
</ul>
</li>
<li><a href="#answers">Answers</a><ul>
<li><a href="#problem-1-answer">Problem 1 Answer</a></li>
<li><a href="#problem-2-answer">Problem 2 Answer</a></li>
<li><a href="#problem-3-answer">Problem 3 Answer</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="ansible-basics">Ansible Basics<a class="header-link" href="#ansible-basics" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<p>Through this document, you will learn:</p>
<ul>
<li>Ansible concepts and architecture</li>
<li>Inventory and Ad-hoc commands</li>
<li>Writing and executing Playbooks</li>
<li>Roles and variable management</li>
</ul>
<p><strong>Difficulty</strong>: â­â­â­ (Intermediate-Advanced)</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-ansible-overview">Ansible Overview</a></li>
<li><a href="#2-installation-and-configuration">Installation and Configuration</a></li>
<li><a href="#3-inventory">Inventory</a></li>
<li><a href="#4-ad-hoc-commands">Ad-hoc Commands</a></li>
<li><a href="#5-playbook">Playbook</a></li>
<li><a href="#6-variables-and-facts">Variables and Facts</a></li>
<li><a href="#7-roles">Roles</a></li>
<li><a href="#8-ansible-vault">Ansible Vault</a></li>
</ol>
<hr />
<h2 id="1-ansible-overview">1. Ansible Overview<a class="header-link" href="#1-ansible-overview" title="Permanent link">&para;</a></h2>
<h3 id="what-is-ansible">What is Ansible?<a class="header-link" href="#what-is-ansible" title="Permanent link">&para;</a></h3>
<p>Ansible is an IT automation tool that works via SSH without requiring agents.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Control Node                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Ansible                                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Playbooks (YAML)                                â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Inventory                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Modules                                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Plugins                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ SSH
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Managed Node  â”‚  â”‚ Managed Node  â”‚  â”‚ Managed Node  â”‚
â”‚ (web-server1) â”‚  â”‚ (web-server2) â”‚  â”‚ (db-server)   â”‚
â”‚   No agent    â”‚  â”‚   No agent    â”‚  â”‚   No agent    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="ansible-vs-other-tools">Ansible vs Other Tools<a class="header-link" href="#ansible-vs-other-tools" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Ansible</th>
<th>Puppet</th>
<th>Chef</th>
</tr>
</thead>
<tbody>
<tr>
<td>Agent</td>
<td>Not required</td>
<td>Required</td>
<td>Required</td>
</tr>
<tr>
<td>Language</td>
<td>YAML</td>
<td>Ruby DSL</td>
<td>Ruby</td>
</tr>
<tr>
<td>Push/Pull</td>
<td>Push</td>
<td>Pull</td>
<td>Pull</td>
</tr>
<tr>
<td>Learning Curve</td>
<td>Low</td>
<td>Medium</td>
<td>High</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-installation-and-configuration">2. Installation and Configuration<a class="header-link" href="#2-installation-and-configuration" title="Permanent link">&para;</a></h2>
<h3 id="installing-ansible">Installing Ansible<a class="header-link" href="#installing-ansible" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Ubuntu/Debian</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ansible

<span class="c1"># RHEL/CentOS</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>epel-release
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>ansible

<span class="c1"># Install via pip (recommended)</span>
pip3<span class="w"> </span>install<span class="w"> </span>ansible

<span class="c1"># Check version</span>
ansible<span class="w"> </span>--version
</code></pre></div>

<h3 id="ssh-key-configuration">SSH Key Configuration<a class="header-link" href="#ssh-key-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Generate SSH key</span>
ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-f<span class="w"> </span>~/.ssh/ansible_key

<span class="c1"># Copy key to target server</span>
ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>~/.ssh/ansible_key.pub<span class="w"> </span>user@target-server

<span class="c1"># Test SSH connection</span>
ssh<span class="w"> </span>-i<span class="w"> </span>~/.ssh/ansible_key<span class="w"> </span>user@target-server
</code></pre></div>

<h3 id="ansiblecfg-configuration">ansible.cfg Configuration<a class="header-link" href="#ansiblecfg-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/ansible/ansible.cfg (global)</span>
<span class="c1"># ~/.ansible.cfg (user)</span>
<span class="c1"># ./ansible.cfg (project)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ansible.cfg</span>
<span class="k">[defaults]</span>
<span class="na">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">./inventory</span>
<span class="na">remote_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">ansible</span>
<span class="na">private_key_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">~/.ssh/ansible_key</span>
<span class="na">host_key_checking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
<span class="na">retry_files_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
<span class="na">forks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">20</span>
<span class="na">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">30</span>

<span class="k">[privilege_escalation]</span>
<span class="na">become</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">become_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">sudo</span>
<span class="na">become_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">root</span>
<span class="na">become_ask_pass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>

<span class="k">[ssh_connection]</span>
<span class="na">pipelining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">ssh_args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">-o ControlMaster=auto -o ControlPersist=60s</span>
</code></pre></div>

<hr />
<h2 id="3-inventory">3. Inventory<a class="header-link" href="#3-inventory" title="Permanent link">&para;</a></h2>
<h3 id="ini-format">INI Format<a class="header-link" href="#ini-format" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># inventory/hosts</span>
<span class="k">[webservers]</span>
<span class="na">web1.example.com</span>
<span class="na">web2.example.com ansible_host</span><span class="o">=</span><span class="s">192.168.1.11</span>

<span class="k">[dbservers]</span>
<span class="na">db1.example.com ansible_host</span><span class="o">=</span><span class="s">192.168.1.21 ansible_port=2222</span>
<span class="na">db2.example.com ansible_user</span><span class="o">=</span><span class="s">dbadmin</span>

<span class="k">[loadbalancers]</span>
<span class="na">lb1.example.com</span>

<span class="c1"># Group of groups</span>
<span class="k">[production:children]</span>
<span class="na">webservers</span>
<span class="na">dbservers</span>
<span class="na">loadbalancers</span>

<span class="c1"># Group variables</span>
<span class="k">[webservers:vars]</span>
<span class="na">http_port</span><span class="o">=</span><span class="s">80</span>
<span class="na">max_clients</span><span class="o">=</span><span class="s">200</span>

<span class="k">[all:vars]</span>
<span class="na">ansible_python_interpreter</span><span class="o">=</span><span class="s">/usr/bin/python3</span>
</code></pre></div>

<h3 id="yaml-format">YAML Format<a class="header-link" href="#yaml-format" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># inventory/hosts.yml</span>
<span class="nt">all</span><span class="p">:</span>
<span class="w">  </span><span class="nt">children</span><span class="p">:</span>
<span class="w">    </span><span class="nt">webservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">web1.example.com</span><span class="p">:</span>
<span class="w">        </span><span class="nt">web2.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.11</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">max_clients</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>

<span class="w">    </span><span class="nt">dbservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">db1.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.21</span>
<span class="w">          </span><span class="nt">ansible_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2222</span>
<span class="w">        </span><span class="nt">db2.example.com</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbadmin</span>

<span class="w">    </span><span class="nt">production</span><span class="p">:</span>
<span class="w">      </span><span class="nt">children</span><span class="p">:</span>
<span class="w">        </span><span class="nt">webservers</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dbservers</span><span class="p">:</span>

<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_python_interpreter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/python3</span>
</code></pre></div>

<h3 id="dynamic-inventory">Dynamic Inventory<a class="header-link" href="#dynamic-inventory" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># AWS EC2 dynamic inventory</span>
pip<span class="w"> </span>install<span class="w"> </span>boto3<span class="w"> </span>botocore

<span class="c1"># ansible.cfg</span>
<span class="o">[</span>defaults<span class="o">]</span>
<span class="nv">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>aws_ec2.yml
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># aws_ec2.yml</span>
<span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amazon.aws.aws_ec2</span>
<span class="nt">regions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ap-northeast-2</span>
<span class="nt">keyed_groups</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags.Environment</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">env</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">instance_type</span>
<span class="w">    </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">type</span>
<span class="nt">compose</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ansible_host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public_ip_address</span>
</code></pre></div>

<h3 id="verifying-inventory">Verifying Inventory<a class="header-link" href="#verifying-inventory" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># List hosts</span>
ansible-inventory<span class="w"> </span>--list
ansible-inventory<span class="w"> </span>--graph

<span class="c1"># Specific group</span>
ansible<span class="w"> </span>webservers<span class="w"> </span>--list-hosts

<span class="c1"># Check host variables</span>
ansible-inventory<span class="w"> </span>--host<span class="w"> </span>web1.example.com
</code></pre></div>

<hr />
<h2 id="4-ad-hoc-commands">4. Ad-hoc Commands<a class="header-link" href="#4-ad-hoc-commands" title="Permanent link">&para;</a></h2>
<h3 id="basic-usage">Basic Usage<a class="header-link" href="#basic-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ansible<span class="w"> </span>&lt;pattern&gt;<span class="w"> </span>-m<span class="w"> </span>&lt;module&gt;<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;&lt;arguments&gt;&quot;</span>

<span class="c1"># Examples</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping
ansible<span class="w"> </span>webservers<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;uptime&quot;</span>
ansible<span class="w"> </span>dbservers<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;df -h | grep /dev/sda&quot;</span>
</code></pre></div>

<h3 id="frequently-used-modules">Frequently Used Modules<a class="header-link" href="#frequently-used-modules" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ping (connection test)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping

<span class="c1"># command (basic command execution)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;hostname&quot;</span>

<span class="c1"># shell (use shell features)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;cat /etc/os-release | grep VERSION&quot;</span>

<span class="c1"># copy (file copy)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>copy<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;src=/local/file dest=/remote/path mode=0644&quot;</span>

<span class="c1"># file (file/directory management)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>file<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;path=/tmp/testdir state=directory mode=0755&quot;</span>

<span class="c1"># yum/apt (package management)</span>
ansible<span class="w"> </span>webservers<span class="w"> </span>-m<span class="w"> </span>yum<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=httpd state=present&quot;</span>
ansible<span class="w"> </span>webservers<span class="w"> </span>-m<span class="w"> </span>apt<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=nginx state=present update_cache=yes&quot;</span>

<span class="c1"># service (service management)</span>
ansible<span class="w"> </span>webservers<span class="w"> </span>-m<span class="w"> </span>service<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=nginx state=started enabled=yes&quot;</span>

<span class="c1"># user (user management)</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>user<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=deploy state=present groups=sudo&quot;</span>

<span class="c1"># setup (gather system information)</span>
ansible<span class="w"> </span>web1<span class="w"> </span>-m<span class="w"> </span>setup
ansible<span class="w"> </span>web1<span class="w"> </span>-m<span class="w"> </span>setup<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;filter=ansible_distribution*&quot;</span>
</code></pre></div>

<h3 id="privilege-escalation">Privilege Escalation<a class="header-link" href="#privilege-escalation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Use sudo</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>apt<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=vim state=present&quot;</span><span class="w"> </span>--become

<span class="c1"># As specific user</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;whoami&quot;</span><span class="w"> </span>--become<span class="w"> </span>--become-user<span class="o">=</span>postgres
</code></pre></div>

<h3 id="parallel-execution">Parallel Execution<a class="header-link" href="#parallel-execution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Adjust number of concurrent hosts</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping<span class="w"> </span>-f<span class="w"> </span><span class="m">50</span><span class="w">  </span><span class="c1"># 50 concurrent executions</span>

<span class="c1"># Sequential execution</span>
ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping<span class="w"> </span>-f<span class="w"> </span><span class="m">1</span>
</code></pre></div>

<hr />
<h2 id="5-playbook">5. Playbook<a class="header-link" href="#5-playbook" title="Permanent link">&para;</a></h2>
<h3 id="basic-structure">Basic Structure<a class="header-link" href="#basic-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># site.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure webservers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">        </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start nginx service</span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure databases</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install PostgreSQL</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>

<h3 id="running-playbooks">Running Playbooks<a class="header-link" href="#running-playbooks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Basic execution</span>
ansible-playbook<span class="w"> </span>site.yml

<span class="c1"># Specify inventory</span>
ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory/production<span class="w"> </span>site.yml

<span class="c1"># Dry run (check without changes)</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--check

<span class="c1"># Show differences</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--diff

<span class="c1"># Verbose output</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>-v<span class="w">    </span><span class="c1"># verbose</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>-vvv<span class="w">  </span><span class="c1"># very verbose</span>

<span class="c1"># Limit to specific hosts</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--limit<span class="w"> </span>web1.example.com

<span class="c1"># Use tags</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--tags<span class="w"> </span><span class="s2">&quot;install,configure&quot;</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--skip-tags<span class="w"> </span><span class="s2">&quot;debug&quot;</span>

<span class="c1"># Start at specific task</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--start-at-task<span class="w"> </span><span class="s2">&quot;Start nginx service&quot;</span>
</code></pre></div>

<h3 id="conditionals-when">Conditionals (when)<a class="header-link" href="#conditionals-when" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache (RHEL)</span>
<span class="w">    </span><span class="nt">yum</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache (Debian)</span>
<span class="w">    </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check if file exists</span>
<span class="w">    </span><span class="nt">stat</span><span class="p">:</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/myapp.conf</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config_file</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create config if not exists</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp.conf.j2</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/myapp.conf</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not config_file.stat.exists</span>
</code></pre></div>

<h3 id="loops">Loops<a class="header-link" href="#loops" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install multiple packages</span>
<span class="w">    </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vim</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create users</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.groups</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;alice&#39;</span><span class="p p-Indicator">,</span><span class="nt"> groups</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;sudo&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;bob&#39;</span><span class="p p-Indicator">,</span><span class="nt"> groups</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;developers&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install packages with apt</span>
<span class="w">    </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">packages</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
</code></pre></div>

<h3 id="handlers">Handlers<a class="header-link" href="#handlers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy nginx config</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">    </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy site config</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span>
<span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site.conf.j2</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/sites-available/mysite</span>
<span class="w">    </span><span class="nt">notify</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clear cache</span>

<span class="nt">handlers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clear cache</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/cache/nginx</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</code></pre></div>

<h3 id="blocks">Blocks<a class="header-link" href="#blocks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install and configure app</span>
<span class="w">    </span><span class="nt">block</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install package</span>
<span class="w">        </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure app</span>
<span class="w">        </span><span class="nt">template</span><span class="p">:</span>
<span class="w">          </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp.conf.j2</span>
<span class="w">          </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/myapp/config.yml</span>

<span class="w">    </span><span class="nt">rescue</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rollback on failure</span>
<span class="w">        </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>

<span class="w">    </span><span class="nt">always</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always run cleanup</span>
<span class="w">        </span><span class="nt">file</span><span class="p">:</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/install_temp</span>
<span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>

<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install_myapp | default(true)</span>
<span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div>

<hr />
<h2 id="6-variables-and-facts">6. Variables and Facts<a class="header-link" href="#6-variables-and-facts" title="Permanent link">&para;</a></h2>
<h3 id="variable-definition-locations">Variable Definition Locations<a class="header-link" href="#variable-definition-locations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Priority</span><span class="w"> </span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">high</span><span class="p">):</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="n">defaults</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">group_vars</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">host_vars</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">playbook</span><span class="w"> </span><span class="n">group_vars</span>
<span class="mf">6.</span><span class="w"> </span><span class="n">playbook</span><span class="w"> </span><span class="n">host_vars</span>
<span class="mf">7.</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="n">facts</span>
<span class="mf">8.</span><span class="w"> </span><span class="n">play</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">9.</span><span class="w"> </span><span class="n">play</span><span class="w"> </span><span class="n">vars_prompt</span>
<span class="mf">10.</span><span class="w"> </span><span class="n">play</span><span class="w"> </span><span class="n">vars_files</span>
<span class="mf">11.</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">12.</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">13.</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">14.</span><span class="w"> </span><span class="n">include_vars</span>
<span class="mf">15.</span><span class="w"> </span><span class="n">set_facts</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">registered</span><span class="w"> </span><span class="n">vars</span>
<span class="mf">16.</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="n">parameters</span>
<span class="mf">17.</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="n">vars</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">e</span><span class="p">)</span>
</code></pre></div>

<h3 id="variable-file-structure">Variable File Structure<a class="header-link" href="#variable-file-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">project</span><span class="o">/</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">ansible</span><span class="o">.</span><span class="n">cfg</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">inventory</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">hosts</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">group_vars</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">all</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">webservers</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">dbservers</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">host_vars</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">web1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">db1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">playbooks</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">site</span><span class="o">.</span><span class="n">yml</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">roles</span><span class="o">/</span>
</code></pre></div>

<h3 id="group_varshost_vars-examples">group_vars/host_vars Examples<a class="header-link" href="#group_varshost_vars-examples" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># inventory/group_vars/all.yml</span>
<span class="nn">---</span>
<span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="nt">ntp_servers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.pool.ntp.org</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.pool.ntp.org</span>

<span class="c1"># inventory/group_vars/webservers.yml</span>
<span class="nn">---</span>
<span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>

<span class="c1"># inventory/host_vars/web1.example.com.yml</span>
<span class="nn">---</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="nt">custom_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

<h3 id="using-variables-in-playbooks">Using Variables in Playbooks<a class="header-link" href="#using-variables-in-playbooks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web servers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">    </span><span class="nt">app_version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.2.3&quot;</span>
<span class="w">    </span><span class="nt">app_env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>

<span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars/common.yml</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;vars/{{</span><span class="nv"> </span><span class="s">ansible_os_family</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/{{</span><span class="nv"> </span><span class="s">app_name</span><span class="nv"> </span><span class="s">}}/config.yml&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set runtime variable</span>
<span class="w">      </span><span class="nt">set_fact</span><span class="p">:</span>
<span class="w">        </span><span class="nt">runtime_var</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_hostname</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">app_version</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>

<h3 id="facts">Facts<a class="header-link" href="#facts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Use auto-gathered facts</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print OS info</span>
<span class="w">    </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">      </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;OS:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_distribution</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_distribution_version</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">  </span><span class="c1"># Custom facts (stored on target host)</span>
<span class="w">  </span><span class="c1"># /etc/ansible/facts.d/custom.fact</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create custom fact</span>
<span class="w">    </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">[app]</span>
<span class="w">        </span><span class="no">version=1.2.3</span>
<span class="w">        </span><span class="no">environment=production</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ansible/facts.d/custom.fact</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>

<span class="w">  </span><span class="c1"># Refresh facts</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Refresh facts</span>
<span class="w">    </span><span class="nt">setup</span><span class="p">:</span>
<span class="w">      </span><span class="nt">filter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_local</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use custom fact</span>
<span class="w">    </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">      </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;App</span><span class="nv"> </span><span class="s">version:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_local.custom.app.version</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>

<h3 id="jinja2-templates">Jinja2 Templates<a class="header-link" href="#jinja2-templates" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c">{# templates/nginx.conf.j2 #}</span>
<span class="x">worker_processes </span><span class="cp">{{</span> <span class="nv">nginx_worker_processes</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="s1">&#39;auto&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">;</span>

<span class="x">events {</span>
<span class="x">    worker_connections </span><span class="cp">{{</span> <span class="nv">nginx_worker_connections</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="m">1024</span><span class="o">)</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">}</span>

<span class="x">http {</span>
<span class="x">    server {</span>
<span class="x">        listen </span><span class="cp">{{</span> <span class="nv">http_port</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">        server_name </span><span class="cp">{{</span> <span class="nv">ansible_fqdn</span> <span class="cp">}}</span><span class="x">;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">location</span> <span class="k">in</span> <span class="nv">nginx_locations</span> <span class="o">|</span> <span class="nf">default</span><span class="o">([])</span> <span class="cp">%}</span>
<span class="x">        location </span><span class="cp">{{</span> <span class="nv">location.path</span> <span class="cp">}}</span><span class="x"> {</span>
<span class="x">            proxy_pass </span><span class="cp">{{</span> <span class="nv">location.proxy</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">        }</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">enable_ssl</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="kp">false</span><span class="o">)</span> <span class="cp">%}</span>
<span class="x">        ssl_certificate </span><span class="cp">{{</span> <span class="nv">ssl_cert_path</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">        ssl_certificate_key </span><span class="cp">{{</span> <span class="nv">ssl_key_path</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<hr />
<h2 id="7-roles">7. Roles<a class="header-link" href="#7-roles" title="Permanent link">&para;</a></h2>
<h3 id="role-structure">Role Structure<a class="header-link" href="#role-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">roles</span><span class="o">/</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">webserver</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">defaults</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># Default variables (low priority)</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">files</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="k">static</span><span class="o">.</span><span class="n">conf</span><span class="w">   </span><span class="c1"># Static files</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">handlers</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># Handlers</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">meta</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># Dependencies, metadata</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">tasks</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># Tasks</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">templates</span><span class="o">/</span>
<span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">j2</span><span class="w"> </span><span class="c1"># Jinja2 templates</span>
<span class="w">    </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">vars</span><span class="o">/</span>
<span class="w">        </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">yml</span><span class="w">      </span><span class="c1"># Variables (high priority)</span>
</code></pre></div>

<h3 id="creating-roles">Creating Roles<a class="header-link" href="#creating-roles" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create basic structure</span>
ansible-galaxy<span class="w"> </span>init<span class="w"> </span>roles/webserver
</code></pre></div>

<h3 id="role-example">Role Example<a class="header-link" href="#role-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># roles/webserver/defaults/main.yml</span>
<span class="nn">---</span>
<span class="nt">nginx_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nt">nginx_worker_processes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<span class="nt">nginx_sites</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># roles/webserver/tasks/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
<span class="w">  </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure nginx</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure sites</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site.conf.j2</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/nginx/sites-available/{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Enable sites</span>
<span class="w">  </span><span class="nt">file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/nginx/sites-available/{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/nginx/sites-enabled/{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">link</span>
<span class="w">  </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_sites</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start nginx</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># roles/webserver/handlers/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload nginx</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reloaded</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># roles/webserver/meta/main.yml</span>
<span class="nn">---</span>
<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firewall</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">firewall_allowed_ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nginx_port</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>

<h3 id="using-roles">Using Roles<a class="header-link" href="#using-roles" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># site.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure web servers</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webserver</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">nginx_sites</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysite</span>
<span class="w">            </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">            </span><span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/mysite</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure databases</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
</code></pre></div>

<h3 id="ansible-galaxy">Ansible Galaxy<a class="header-link" href="#ansible-galaxy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Search roles</span>
ansible-galaxy<span class="w"> </span>search<span class="w"> </span>nginx

<span class="c1"># Install role</span>
ansible-galaxy<span class="w"> </span>install<span class="w"> </span>geerlingguy.nginx

<span class="c1"># Install collection</span>
ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>community.general

<span class="c1"># Install from requirements.yml</span>
ansible-galaxy<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.yml
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># requirements.yml</span>
<span class="nn">---</span>
<span class="nt">roles</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy.nginx</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.1.0&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geerlingguy.postgresql</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.3.1&quot;</span>

<span class="nt">collections</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">community.general</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&gt;=6.0.0&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amazon.aws</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5.0.0&quot;</span>
</code></pre></div>

<hr />
<h2 id="8-ansible-vault">8. Ansible Vault<a class="header-link" href="#8-ansible-vault" title="Permanent link">&para;</a></h2>
<h3 id="basic-vault-usage">Basic Vault Usage<a class="header-link" href="#basic-vault-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create new encrypted file</span>
ansible-vault<span class="w"> </span>create<span class="w"> </span>secrets.yml

<span class="c1"># Encrypt existing file</span>
ansible-vault<span class="w"> </span>encrypt<span class="w"> </span>vars/secrets.yml

<span class="c1"># Decrypt file</span>
ansible-vault<span class="w"> </span>decrypt<span class="w"> </span>vars/secrets.yml

<span class="c1"># Edit file</span>
ansible-vault<span class="w"> </span>edit<span class="w"> </span>secrets.yml

<span class="c1"># View file contents</span>
ansible-vault<span class="w"> </span>view<span class="w"> </span>secrets.yml

<span class="c1"># Change password</span>
ansible-vault<span class="w"> </span>rekey<span class="w"> </span>secrets.yml
</code></pre></div>

<h3 id="vault-usage-example">Vault Usage Example<a class="header-link" href="#vault-usage-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># vars/secrets.yml (encrypted)</span>
<span class="nn">---</span>
<span class="nt">db_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SuperSecretPassword123&quot;</span>
<span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sk-1234567890abcdef&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars/secrets.yml</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure database</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/app/db.conf</span>
<span class="w">      </span><span class="c1"># {{ db_password }} is available</span>
</code></pre></div>

<h3 id="running-playbooks_1">Running Playbooks<a class="header-link" href="#running-playbooks_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Password prompt</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--ask-vault-pass

<span class="c1"># Password file</span>
ansible-playbook<span class="w"> </span>site.yml<span class="w"> </span>--vault-password-file<span class="w"> </span>~/.vault_pass

<span class="c1"># Environment variable</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ANSIBLE_VAULT_PASSWORD_FILE</span><span class="o">=</span>~/.vault_pass
ansible-playbook<span class="w"> </span>site.yml
</code></pre></div>

<h3 id="string-encryption">String Encryption<a class="header-link" href="#string-encryption" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Encrypt string only</span>
ansible-vault<span class="w"> </span>encrypt_string<span class="w"> </span><span class="s1">&#39;MySecretPassword&#39;</span><span class="w"> </span>--name<span class="w"> </span><span class="s1">&#39;db_password&#39;</span>

<span class="c1"># Output (use directly in YAML)</span>
db_password:<span class="w"> </span>!vault<span class="w"> </span><span class="p">|</span>
<span class="w">          </span><span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span><span class="m">1</span>.1<span class="p">;</span>AES256
<span class="w">          </span><span class="m">66386439653236</span>...
</code></pre></div>

<hr />
<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-write-inventory">Problem 1: Write Inventory<a class="header-link" href="#problem-1-write-inventory" title="Permanent link">&para;</a></h3>
<p>Write the inventory in YAML format for the following servers:
- app1, app2 (webservers group)
- db1 (dbservers group)
- All servers: ansible_user=deploy
- webservers: http_port=8080</p>
<h3 id="problem-2-write-playbook">Problem 2: Write Playbook<a class="header-link" href="#problem-2-write-playbook" title="Permanent link">&para;</a></h3>
<p>Write a Playbook that installs and starts nginx:
- Support both RedHat and Debian families
- Use handlers for service restart
- Use tags (install, configure)</p>
<h3 id="problem-3-write-role">Problem 3: Write Role<a class="header-link" href="#problem-3-write-role" title="Permanent link">&para;</a></h3>
<p>Write tasks/main.yml for a Role that installs PostgreSQL:
- Install packages
- Start service
- Create initial database</p>
<hr />
<h2 id="answers">Answers<a class="header-link" href="#answers" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-answer">Problem 1 Answer<a class="header-link" href="#problem-1-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># inventory/hosts.yml</span>
<span class="nt">all</span><span class="p">:</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">children</span><span class="p">:</span>
<span class="w">    </span><span class="nt">webservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">        </span><span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="nt">dbservers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">db1</span><span class="p">:</span>
</code></pre></div>

<h3 id="problem-2-answer">Problem 2 Answer<a class="header-link" href="#problem-2-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install and configure nginx</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx (RedHat)</span>
<span class="w">      </span><span class="nt">yum</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx (Debian)</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">        </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy nginx config</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.conf.j2</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/nginx.conf</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start nginx</span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>

<span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart nginx</span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</code></pre></div>

<h3 id="problem-3-answer">Problem 3 Answer<a class="header-link" href="#problem-3-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># roles/postgresql/tasks/main.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install PostgreSQL</span>
<span class="w">  </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql-contrib</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3-psycopg2</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start PostgreSQL service</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create application database</span>
<span class="w">  </span><span class="nt">become_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">  </span><span class="nt">postgresql_db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">pg_database</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;appdb&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create database user</span>
<span class="w">  </span><span class="nt">become_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">  </span><span class="nt">postgresql_user</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">pg_user</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;appuser&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">pg_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">db</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">pg_database</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;appdb&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">priv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div>

<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./23_Advanced_Networking.md">23_Advanced_Networking.md</a> - VLAN, bonding, iptables/nftables</li>
</ul>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.ansible.com/">Ansible Documentation</a></li>
<li><a href="https://galaxy.ansible.com/">Ansible Galaxy</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/tips_tricks/ansible_tips_tricks.html">Ansible Best Practices</a></li>
<li><code>ansible-doc -l</code>, <code>ansible-doc &lt;module&gt;</code></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Linux/21_Virtualization_KVM.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Virtualization (KVM)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Linux/23_Advanced_Networking.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Advanced Networking</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}