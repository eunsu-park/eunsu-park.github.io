{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Integration - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Linux/">Linux</a>
    <span class="separator">/</span>
    <span class="current">Cloud Integration</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Cloud Integration</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Linux/23_Advanced_Networking.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Advanced Networking</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Linux/25_High_Availability_Cluster.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">High Availability Cluster</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-cloud-init-overview">1. cloud-init Overview</a><ul>
<li><a href="#what-is-cloud-init">What is cloud-init?</a></li>
<li><a href="#cloud-init-boot-stages">cloud-init Boot Stages</a></li>
<li><a href="#checking-cloud-init-status">Checking cloud-init Status</a></li>
</ul>
</li>
<li><a href="#2-cloud-init-configuration">2. cloud-init Configuration</a><ul>
<li><a href="#user-data-formats">user-data Formats</a></li>
<li><a href="#multipart-user-data">Multipart user-data</a></li>
<li><a href="#cloud-config-modules">cloud-config Modules</a></li>
<li><a href="#testing-cloud-init-locally">Testing cloud-init Locally</a></li>
</ul>
</li>
<li><a href="#3-aws-cli">3. AWS CLI</a><ul>
<li><a href="#installing-aws-cli">Installing AWS CLI</a></li>
<li><a href="#configuring-aws-cli">Configuring AWS CLI</a></li>
<li><a href="#basic-aws-cli-usage">Basic AWS CLI Usage</a></li>
<li><a href="#common-aws-cli-commands">Common AWS CLI Commands</a></li>
</ul>
</li>
<li><a href="#4-ec2-metadata">4. EC2 Metadata</a><ul>
<li><a href="#imdsv1-legacy">IMDSv1 (Legacy)</a></li>
<li><a href="#imdsv2-recommended">IMDSv2 (Recommended)</a></li>
<li><a href="#key-metadata-paths">Key Metadata Paths</a></li>
<li><a href="#querying-user-data">Querying user-data</a></li>
</ul>
</li>
<li><a href="#5-instance-profiles-and-iam">5. Instance Profiles and IAM</a><ul>
<li><a href="#using-aws-cli-with-iam-roles">Using AWS CLI with IAM Roles</a></li>
<li><a href="#directly-using-iam-role-credentials">Directly Using IAM Role Credentials</a></li>
<li><a href="#using-iam-roles-in-scripts">Using IAM Roles in Scripts</a></li>
</ul>
</li>
<li><a href="#6-other-cloud-clis">6. Other Cloud CLIs</a><ul>
<li><a href="#google-cloud-cli-gcloud">Google Cloud CLI (gcloud)</a></li>
<li><a href="#azure-cli-az">Azure CLI (az)</a></li>
<li><a href="#multi-cloud-metadata">Multi-Cloud Metadata</a></li>
</ul>
</li>
<li><a href="#7-cloud-native-operations">7. Cloud-Native Operations</a><ul>
<li><a href="#instance-bootstrap-script">Instance Bootstrap Script</a></li>
<li><a href="#using-parameter-store">Using Parameter Store</a></li>
<li><a href="#log-management-cloudwatch">Log Management (CloudWatch)</a></li>
</ul>
</li>
<li><a href="#practice-problems">Practice Problems</a><ul>
<li><a href="#problem-1-cloud-init-configuration">Problem 1: cloud-init Configuration</a></li>
<li><a href="#problem-2-aws-cli-query">Problem 2: AWS CLI Query</a></li>
<li><a href="#problem-3-imdsv2-script">Problem 3: IMDSv2 Script</a></li>
</ul>
</li>
<li><a href="#answers">Answers</a><ul>
<li><a href="#problem-1-answer">Problem 1 Answer</a></li>
<li><a href="#problem-2-answer">Problem 2 Answer</a></li>
<li><a href="#problem-3-answer">Problem 3 Answer</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="cloud-integration">Cloud Integration<a class="header-link" href="#cloud-integration" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<p>Through this document, you will learn:</p>
<ul>
<li>Instance initialization using cloud-init</li>
<li>AWS CLI installation and configuration</li>
<li>EC2 metadata service utilization</li>
<li>Linux operations in cloud environments</li>
</ul>
<p><strong>Difficulty</strong>: â­â­â­ (Intermediate-Advanced)</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-cloud-init-overview">cloud-init Overview</a></li>
<li><a href="#2-cloud-init-configuration">cloud-init Configuration</a></li>
<li><a href="#3-aws-cli">AWS CLI</a></li>
<li><a href="#4-ec2-metadata">EC2 Metadata</a></li>
<li><a href="#5-instance-profiles-and-iam">Instance Profiles and IAM</a></li>
<li><a href="#6-other-cloud-clis">Other Cloud CLIs</a></li>
<li><a href="#7-cloud-native-operations">Cloud-Native Operations</a></li>
</ol>
<hr />
<h2 id="1-cloud-init-overview">1. cloud-init Overview<a class="header-link" href="#1-cloud-init-overview" title="Permanent link">&para;</a></h2>
<h3 id="what-is-cloud-init">What is cloud-init?<a class="header-link" href="#what-is-cloud-init" title="Permanent link">&para;</a></h3>
<p>cloud-init is a tool that automates the initial configuration of cloud instances.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Instance Boot                            â”‚
â”‚                         â”‚                                   â”‚
â”‚                         â–¼                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚  cloud-init     â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                       â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â–¼             â–¼             â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚user-data â”‚  â”‚meta-data â”‚  â”‚vendor-   â”‚                 â”‚
â”‚  â”‚(user)    â”‚  â”‚(cloud)   â”‚  â”‚data      â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                       â”‚                                     â”‚
â”‚                       â–¼                                     â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚        â”‚ Network configuration        â”‚                    â”‚
â”‚        â”‚ SSH key setup                â”‚                    â”‚
â”‚        â”‚ Package installation         â”‚                    â”‚
â”‚        â”‚ Script execution             â”‚                    â”‚
â”‚        â”‚ User creation                â”‚                    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="cloud-init-boot-stages">cloud-init Boot Stages<a class="header-link" href="#cloud-init-boot-stages" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Stage</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Generator</strong></td>
<td>systemd decides whether to run cloud-init</td>
</tr>
<tr>
<td><strong>Local</strong></td>
<td>Network configuration from local datasource</td>
</tr>
<tr>
<td><strong>Network</strong></td>
<td>Fetch metadata</td>
</tr>
<tr>
<td><strong>Config</strong></td>
<td>Run cloud-config modules</td>
</tr>
<tr>
<td><strong>Final</strong></td>
<td>Final scripts, package installation</td>
</tr>
</tbody>
</table>
<h3 id="checking-cloud-init-status">Checking cloud-init Status<a class="header-link" href="#checking-cloud-init-status" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check status</span>
cloud-init<span class="w"> </span>status

<span class="c1"># Detailed status</span>
cloud-init<span class="w"> </span>status<span class="w"> </span>--long

<span class="c1"># View logs</span>
cat<span class="w"> </span>/var/log/cloud-init.log
cat<span class="w"> </span>/var/log/cloud-init-output.log

<span class="c1"># Analysis</span>
cloud-init<span class="w"> </span>analyze<span class="w"> </span>show
cloud-init<span class="w"> </span>analyze<span class="w"> </span>blame
</code></pre></div>

<hr />
<h2 id="2-cloud-init-configuration">2. cloud-init Configuration<a class="header-link" href="#2-cloud-init-configuration" title="Permanent link">&para;</a></h2>
<h3 id="user-data-formats">user-data Formats<a class="header-link" href="#user-data-formats" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">#cloud-config</span>

<span class="c1"># Create users</span>
<span class="nt">users</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">    </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sudo</span>
<span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
<span class="w">    </span><span class="nt">sudo</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;ALL=(ALL)</span><span class="nv"> </span><span class="s">NOPASSWD:ALL&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">ssh_authorized_keys</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh-rsa AAAAB3... user@host</span>

<span class="c1"># SSH keys</span>
<span class="nt">ssh_authorized_keys</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh-rsa AAAAB3... admin@company</span>

<span class="c1"># Package update and installation</span>
<span class="nt">package_update</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">package_upgrade</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vim</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">htop</span>

<span class="c1"># Write files</span>
<span class="nt">write_files</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/sites-available/default</span>
<span class="w">    </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">server {</span>
<span class="w">          </span><span class="no">listen 80;</span>
<span class="w">          </span><span class="no">server_name _;</span>
<span class="w">          </span><span class="no">root /var/www/html;</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root:root</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/scripts/startup.sh</span>
<span class="w">    </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">#!/bin/bash</span>
<span class="w">      </span><span class="no">echo &quot;Instance started at $(date)&quot; &gt;&gt; /var/log/startup.log</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0755&#39;</span>

<span class="c1"># Run commands</span>
<span class="nt">runcmd</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemctl enable nginx</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemctl start nginx</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/scripts/startup.sh</span>

<span class="c1"># Hostname configuration</span>
<span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-server-01</span>
<span class="nt">fqdn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-server-01.example.com</span>

<span class="c1"># Timezone</span>
<span class="nt">timezone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Asia/Seoul</span>

<span class="c1"># NTP</span>
<span class="nt">ntp</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">servers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.pool.ntp.org</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.pool.ntp.org</span>

<span class="c1"># Reboot</span>
<span class="nt">power_state</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reboot</span>
<span class="w">  </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Rebooting</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">initial</span><span class="nv"> </span><span class="s">setup&quot;</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">  </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

<h3 id="multipart-user-data">Multipart user-data<a class="header-link" href="#multipart-user-data" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># Used for part-handler or combining multiple formats</span>

<span class="c1"># Content-Type: multipart/mixed; boundary=&quot;==BOUNDARY==&quot;</span>
<span class="c1"># MIME-Version: 1.0</span>

<span class="c1"># --==BOUNDARY==</span>
<span class="c1"># Content-Type: text/cloud-config; charset=&quot;us-ascii&quot;</span>

<span class="c1">#cloud-config</span>
packages:
<span class="w">  </span>-<span class="w"> </span>nginx

<span class="c1"># --==BOUNDARY==</span>
<span class="c1"># Content-Type: text/x-shellscript; charset=&quot;us-ascii&quot;</span>

<span class="c1">#!/bin/bash</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello from shell script&quot;</span>

<span class="c1"># --==BOUNDARY==--</span>
</code></pre></div>

<h3 id="cloud-config-modules">cloud-config Modules<a class="header-link" href="#cloud-config-modules" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">#cloud-config</span>

<span class="c1"># Disk configuration</span>
<span class="nt">disk_setup</span><span class="p">:</span>
<span class="w">  </span><span class="nt">/dev/xvdf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">table_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpt</span>
<span class="w">    </span><span class="nt">layout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">overwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">fs_setup</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<span class="w">    </span><span class="nt">filesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ext4</span>
<span class="w">    </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/xvdf1</span>

<span class="nt">mounts</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/dev/xvdf1&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/data&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ext4&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;defaults,nofail&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p p-Indicator">]</span>

<span class="c1"># chef/puppet/ansible integration</span>
<span class="nt">chef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">install_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">omnibus</span>
<span class="w">  </span><span class="nt">server_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://chef.example.com</span>
<span class="w">  </span><span class="nt">node_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web01</span>

<span class="nt">puppet</span><span class="p">:</span>
<span class="w">  </span><span class="nt">install_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">packages</span>
<span class="w">  </span><span class="nt">conf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span>
<span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">puppet.example.com</span>

<span class="nt">ansible</span><span class="p">:</span>
<span class="w">  </span><span class="nt">install_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">  </span><span class="nt">pull</span><span class="p">:</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/user/ansible-repo.git</span>
<span class="w">    </span><span class="nt">playbook_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">site.yml</span>

<span class="c1"># Final message</span>
<span class="nt">final_message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Instance</span><span class="nv"> </span><span class="s">ready</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">$UPTIME</span><span class="nv"> </span><span class="s">seconds&quot;</span>
</code></pre></div>

<h3 id="testing-cloud-init-locally">Testing cloud-init Locally<a class="header-link" href="#testing-cloud-init-locally" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Validate cloud-init configuration</span>
cloud-init<span class="w"> </span>schema<span class="w"> </span>--config-file<span class="w"> </span>user-data.yaml

<span class="c1"># Dry run (no actual execution)</span>
cloud-init<span class="w"> </span>single<span class="w"> </span>--name<span class="w"> </span>write_files<span class="w"> </span>--frequency<span class="w"> </span>once

<span class="c1"># Re-run (for testing purposes)</span>
sudo<span class="w"> </span>cloud-init<span class="w"> </span>clean<span class="w"> </span>--logs
sudo<span class="w"> </span>cloud-init<span class="w"> </span>init
sudo<span class="w"> </span>cloud-init<span class="w"> </span>modules<span class="w"> </span>--mode<span class="w"> </span>config
sudo<span class="w"> </span>cloud-init<span class="w"> </span>modules<span class="w"> </span>--mode<span class="w"> </span>final
</code></pre></div>

<hr />
<h2 id="3-aws-cli">3. AWS CLI<a class="header-link" href="#3-aws-cli" title="Permanent link">&para;</a></h2>
<h3 id="installing-aws-cli">Installing AWS CLI<a class="header-link" href="#installing-aws-cli" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Linux x86_64</span>
curl<span class="w"> </span><span class="s2">&quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;awscliv2.zip&quot;</span>
unzip<span class="w"> </span>awscliv2.zip
sudo<span class="w"> </span>./aws/install

<span class="c1"># Linux ARM</span>
curl<span class="w"> </span><span class="s2">&quot;https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;awscliv2.zip&quot;</span>
unzip<span class="w"> </span>awscliv2.zip
sudo<span class="w"> </span>./aws/install

<span class="c1"># Check version</span>
aws<span class="w"> </span>--version

<span class="c1"># Configure auto-completion</span>
<span class="nb">complete</span><span class="w"> </span>-C<span class="w"> </span><span class="s1">&#39;/usr/local/bin/aws_completer&#39;</span><span class="w"> </span>aws
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;complete -C &#39;/usr/local/bin/aws_completer&#39; aws&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</code></pre></div>

<h3 id="configuring-aws-cli">Configuring AWS CLI<a class="header-link" href="#configuring-aws-cli" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Initial configuration</span>
aws<span class="w"> </span>configure

<span class="c1"># Profile configuration</span>
aws<span class="w"> </span>configure<span class="w"> </span>--profile<span class="w"> </span>production
aws<span class="w"> </span>configure<span class="w"> </span>--profile<span class="w"> </span>development

<span class="c1"># Directly edit configuration files</span>
cat<span class="w"> </span>~/.aws/config
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ~/.aws/config</span>
<span class="k">[default]</span>
<span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">ap-northeast-2</span>
<span class="na">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">json</span>

<span class="k">[profile production]</span>
<span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">ap-northeast-2</span>
<span class="na">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">json</span>

<span class="k">[profile development]</span>
<span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">us-east-1</span>
<span class="na">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">table</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ~/.aws/credentials</span>
<span class="k">[default]</span>
<span class="na">aws_access_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">AKIAIOSFODNN7EXAMPLE</span>
<span class="na">aws_secret_access_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span>

<span class="k">[production]</span>
<span class="na">aws_access_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">AKIAIOSFODNN7PRODKEY</span>
<span class="na">aws_secret_access_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">wJalrXUtnFEMI/K7MDENG/bPxRfiCYPRODKEY</span>
</code></pre></div>

<h3 id="basic-aws-cli-usage">Basic AWS CLI Usage<a class="header-link" href="#basic-aws-cli-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># List EC2 instances</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances

<span class="c1"># Specific instance information</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span>--instance-ids<span class="w"> </span>i-0123456789abcdef0

<span class="c1"># Filtering</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filters<span class="w"> </span><span class="s2">&quot;Name=instance-state-name,Values=running&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;Reservations[].Instances[].{ID:InstanceId,IP:PrivateIpAddress,Name:Tags[?Key==`Name`].Value|[0]}&#39;</span>

<span class="c1"># Use profile</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span>--profile<span class="w"> </span>production

<span class="c1"># Specify output format</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span>--output<span class="w"> </span>table
aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span>--output<span class="w"> </span>yaml
</code></pre></div>

<h3 id="common-aws-cli-commands">Common AWS CLI Commands<a class="header-link" href="#common-aws-cli-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># S3</span>
aws<span class="w"> </span>s3<span class="w"> </span>ls
aws<span class="w"> </span>s3<span class="w"> </span>cp<span class="w"> </span>file.txt<span class="w"> </span>s3://my-bucket/
aws<span class="w"> </span>s3<span class="w"> </span>sync<span class="w"> </span>./local-dir<span class="w"> </span>s3://my-bucket/dir/
aws<span class="w"> </span>s3<span class="w"> </span>rm<span class="w"> </span>s3://my-bucket/file.txt

<span class="c1"># EC2</span>
aws<span class="w"> </span>ec2<span class="w"> </span>start-instances<span class="w"> </span>--instance-ids<span class="w"> </span>i-0123456789abcdef0
aws<span class="w"> </span>ec2<span class="w"> </span>stop-instances<span class="w"> </span>--instance-ids<span class="w"> </span>i-0123456789abcdef0
aws<span class="w"> </span>ec2<span class="w"> </span>create-tags<span class="w"> </span>--resources<span class="w"> </span>i-0123456789abcdef0<span class="w"> </span>--tags<span class="w"> </span><span class="nv">Key</span><span class="o">=</span>Name,Value<span class="o">=</span>MyServer

<span class="c1"># EBS</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-volumes
aws<span class="w"> </span>ec2<span class="w"> </span>create-snapshot<span class="w"> </span>--volume-id<span class="w"> </span>vol-0123456789abcdef0

<span class="c1"># Security Groups</span>
aws<span class="w"> </span>ec2<span class="w"> </span>describe-security-groups
aws<span class="w"> </span>ec2<span class="w"> </span>authorize-security-group-ingress<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--group-id<span class="w"> </span>sg-0123456789abcdef0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--protocol<span class="w"> </span>tcp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--port<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cidr<span class="w"> </span><span class="m">0</span>.0.0.0/0

<span class="c1"># IAM</span>
aws<span class="w"> </span>iam<span class="w"> </span>list-users
aws<span class="w"> </span>iam<span class="w"> </span>list-roles

<span class="c1"># SSM (Systems Manager)</span>
aws<span class="w"> </span>ssm<span class="w"> </span>start-session<span class="w"> </span>--target<span class="w"> </span>i-0123456789abcdef0
aws<span class="w"> </span>ssm<span class="w"> </span>send-command<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--instance-ids<span class="w"> </span>i-0123456789abcdef0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--document-name<span class="w"> </span><span class="s2">&quot;AWS-RunShellScript&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--parameters<span class="w"> </span><span class="nv">commands</span><span class="o">=[</span><span class="s2">&quot;echo hello&quot;</span><span class="o">]</span>
</code></pre></div>

<hr />
<h2 id="4-ec2-metadata">4. EC2 Metadata<a class="header-link" href="#4-ec2-metadata" title="Permanent link">&para;</a></h2>
<h3 id="imdsv1-legacy">IMDSv1 (Legacy)<a class="header-link" href="#imdsv1-legacy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Instance ID</span>
curl<span class="w"> </span>http://169.254.169.254/latest/meta-data/instance-id

<span class="c1"># Availability Zone</span>
curl<span class="w"> </span>http://169.254.169.254/latest/meta-data/placement/availability-zone

<span class="c1"># Public IP</span>
curl<span class="w"> </span>http://169.254.169.254/latest/meta-data/public-ipv4

<span class="c1"># Private IP</span>
curl<span class="w"> </span>http://169.254.169.254/latest/meta-data/local-ipv4

<span class="c1"># IAM role credentials</span>
curl<span class="w"> </span>http://169.254.169.254/latest/meta-data/iam/security-credentials/my-role
</code></pre></div>

<h3 id="imdsv2-recommended">IMDSv2 (Recommended)<a class="header-link" href="#imdsv2-recommended" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Get token</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;http://169.254.169.254/latest/api/token&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span><span class="k">)</span>

<span class="c1"># Query metadata</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://169.254.169.254/latest/meta-data/instance-id

<span class="c1"># Define as function</span>
get_metadata<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-sX<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;http://169.254.169.254/latest/api/token&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span><span class="k">)</span>
<span class="w">    </span>curl<span class="w"> </span>-sH<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span><span class="s2">&quot;http://169.254.169.254/latest/meta-data/</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
get_metadata<span class="w"> </span>instance-id
get_metadata<span class="w"> </span>local-ipv4
get_metadata<span class="w"> </span>placement/availability-zone
</code></pre></div>

<h3 id="key-metadata-paths">Key Metadata Paths<a class="header-link" href="#key-metadata-paths" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Path</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>instance-id</code></td>
<td>Instance ID</td>
</tr>
<tr>
<td><code>instance-type</code></td>
<td>Instance type</td>
</tr>
<tr>
<td><code>ami-id</code></td>
<td>AMI ID</td>
</tr>
<tr>
<td><code>local-hostname</code></td>
<td>Private hostname</td>
</tr>
<tr>
<td><code>local-ipv4</code></td>
<td>Private IP</td>
</tr>
<tr>
<td><code>public-hostname</code></td>
<td>Public hostname</td>
</tr>
<tr>
<td><code>public-ipv4</code></td>
<td>Public IP</td>
</tr>
<tr>
<td><code>placement/availability-zone</code></td>
<td>Availability Zone</td>
</tr>
<tr>
<td><code>placement/region</code></td>
<td>Region</td>
</tr>
<tr>
<td><code>mac</code></td>
<td>MAC address</td>
</tr>
<tr>
<td><code>security-groups</code></td>
<td>Security groups</td>
</tr>
<tr>
<td><code>iam/security-credentials/&lt;role&gt;</code></td>
<td>IAM role credentials</td>
</tr>
</tbody>
</table>
<h3 id="querying-user-data">Querying user-data<a class="header-link" href="#querying-user-data" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Query user-data with IMDSv2</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;http://169.254.169.254/latest/api/token&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span><span class="k">)</span>

curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://169.254.169.254/latest/user-data
</code></pre></div>

<hr />
<h2 id="5-instance-profiles-and-iam">5. Instance Profiles and IAM<a class="header-link" href="#5-instance-profiles-and-iam" title="Permanent link">&para;</a></h2>
<h3 id="using-aws-cli-with-iam-roles">Using AWS CLI with IAM Roles<a class="header-link" href="#using-aws-cli-with-iam-roles" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># If an IAM role is attached to the instance, credentials are used automatically</span>
<span class="c1"># No separate aws configure needed</span>

<span class="c1"># S3 access (if role has permission)</span>
aws<span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span>s3://my-bucket/

<span class="c1"># Check current credentials</span>
aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity
</code></pre></div>

<h3 id="directly-using-iam-role-credentials">Directly Using IAM Role Credentials<a class="header-link" href="#directly-using-iam-role-credentials" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Get credentials from metadata</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-sX<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;http://169.254.169.254/latest/api/token&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span><span class="k">)</span>

<span class="nv">ROLE_NAME</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-sH<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://169.254.169.254/latest/meta-data/iam/security-credentials/<span class="k">)</span>

<span class="nv">CREDS</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-sH<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://169.254.169.254/latest/meta-data/iam/security-credentials/<span class="nv">$ROLE_NAME</span><span class="k">)</span>

<span class="c1"># Set as environment variables</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$CREDS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.AccessKeyId&#39;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$CREDS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.SecretAccessKey&#39;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SESSION_TOKEN</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$CREDS</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.Token&#39;</span><span class="k">)</span>

<span class="c1"># Use AWS CLI</span>
aws<span class="w"> </span>s3<span class="w"> </span>ls
</code></pre></div>

<h3 id="using-iam-roles-in-scripts">Using IAM Roles in Scripts<a class="header-link" href="#using-iam-roles-in-scripts" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># backup-to-s3.sh</span>

<span class="nv">BUCKET</span><span class="o">=</span><span class="s2">&quot;my-backup-bucket&quot;</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/var/backup&quot;</span>
<span class="nv">TIMESTAMP</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d-%H%M%S<span class="k">)</span>
<span class="nv">INSTANCE_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>http://169.254.169.254/latest/meta-data/instance-id<span class="k">)</span>

<span class="c1"># Create backup</span>
tar<span class="w"> </span>-czf<span class="w"> </span>/tmp/backup-<span class="nv">$TIMESTAMP</span>.tar.gz<span class="w"> </span><span class="nv">$BACKUP_DIR</span>

<span class="c1"># Upload to S3 (using instance role)</span>
aws<span class="w"> </span>s3<span class="w"> </span>cp<span class="w"> </span>/tmp/backup-<span class="nv">$TIMESTAMP</span>.tar.gz<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>s3://<span class="nv">$BUCKET</span>/backups/<span class="nv">$INSTANCE_ID</span>/backup-<span class="nv">$TIMESTAMP</span>.tar.gz

<span class="c1"># Cleanup</span>
rm<span class="w"> </span>/tmp/backup-<span class="nv">$TIMESTAMP</span>.tar.gz

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup completed: s3://</span><span class="nv">$BUCKET</span><span class="s2">/backups/</span><span class="nv">$INSTANCE_ID</span><span class="s2">/backup-</span><span class="nv">$TIMESTAMP</span><span class="s2">.tar.gz&quot;</span>
</code></pre></div>

<hr />
<h2 id="6-other-cloud-clis">6. Other Cloud CLIs<a class="header-link" href="#6-other-cloud-clis" title="Permanent link">&para;</a></h2>
<h3 id="google-cloud-cli-gcloud">Google Cloud CLI (gcloud)<a class="header-link" href="#google-cloud-cli-gcloud" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Installation</span>
curl<span class="w"> </span>-O<span class="w"> </span>https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-cli-linux-x86_64.tar.gz
tar<span class="w"> </span>-xf<span class="w"> </span>google-cloud-cli-linux-x86_64.tar.gz
./google-cloud-sdk/install.sh

<span class="c1"># Initialize</span>
gcloud<span class="w"> </span>init

<span class="c1"># Authentication</span>
gcloud<span class="w"> </span>auth<span class="w"> </span>login
gcloud<span class="w"> </span>auth<span class="w"> </span>application-default<span class="w"> </span>login

<span class="c1"># Basic commands</span>
gcloud<span class="w"> </span>compute<span class="w"> </span>instances<span class="w"> </span>list
gcloud<span class="w"> </span>compute<span class="w"> </span>instances<span class="w"> </span>describe<span class="w"> </span>my-instance
gcloud<span class="w"> </span>compute<span class="w"> </span>ssh<span class="w"> </span>my-instance
</code></pre></div>

<h3 id="azure-cli-az">Azure CLI (az)<a class="header-link" href="#azure-cli-az" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Installation (Ubuntu)</span>
curl<span class="w"> </span>-sL<span class="w"> </span>https://aka.ms/InstallAzureCLIDeb<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash

<span class="c1"># Login</span>
az<span class="w"> </span>login

<span class="c1"># Set subscription</span>
az<span class="w"> </span>account<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--subscription<span class="w"> </span><span class="s2">&quot;My Subscription&quot;</span>

<span class="c1"># Basic commands</span>
az<span class="w"> </span>vm<span class="w"> </span>list
az<span class="w"> </span>vm<span class="w"> </span>show<span class="w"> </span>-g<span class="w"> </span>myResourceGroup<span class="w"> </span>-n<span class="w"> </span>myVM
az<span class="w"> </span>vm<span class="w"> </span>start<span class="w"> </span>-g<span class="w"> </span>myResourceGroup<span class="w"> </span>-n<span class="w"> </span>myVM
</code></pre></div>

<h3 id="multi-cloud-metadata">Multi-Cloud Metadata<a class="header-link" href="#multi-cloud-metadata" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># AWS</span>
curl<span class="w"> </span>http://169.254.169.254/latest/meta-data/

<span class="c1"># GCP</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Metadata-Flavor: Google&quot;</span><span class="w"> </span>http://metadata.google.internal/computeMetadata/v1/

<span class="c1"># Azure</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Metadata:true&quot;</span><span class="w"> </span><span class="s2">&quot;http://169.254.169.254/metadata/instance?api-version=2021-02-01&quot;</span>
</code></pre></div>

<hr />
<h2 id="7-cloud-native-operations">7. Cloud-Native Operations<a class="header-link" href="#7-cloud-native-operations" title="Permanent link">&para;</a></h2>
<h3 id="instance-bootstrap-script">Instance Bootstrap Script<a class="header-link" href="#instance-bootstrap-script" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># bootstrap.sh - EC2 user-data script</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail

<span class="c1"># Log configuration</span>
<span class="nb">exec</span><span class="w"> </span>&gt;<span class="w"> </span>&gt;<span class="o">(</span>tee<span class="w"> </span>/var/log/bootstrap.log<span class="o">)</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Bootstrap started at </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># Variables</span>
<span class="nv">REGION</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>http://169.254.169.254/latest/meta-data/placement/region<span class="k">)</span>
<span class="nv">INSTANCE_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>http://169.254.169.254/latest/meta-data/instance-id<span class="k">)</span>

<span class="c1"># Package update</span>
apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y

<span class="c1"># Install required packages</span>
apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>awscli<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>jq<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>nginx<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>docker.io

<span class="c1"># Docker configuration</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>docker
systemctl<span class="w"> </span>start<span class="w"> </span>docker
usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span>ubuntu

<span class="c1"># Get environment info from tags</span>
<span class="nv">ENVIRONMENT</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>ec2<span class="w"> </span>describe-tags<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--region<span class="w"> </span><span class="nv">$REGION</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filters<span class="w"> </span><span class="s2">&quot;Name=resource-id,Values=</span><span class="nv">$INSTANCE_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;Name=key,Values=Environment&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;Tags[0].Value&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>

<span class="c1"># Environment-specific configuration</span>
<span class="k">case</span><span class="w"> </span><span class="nv">$ENVIRONMENT</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span>production<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Configuring for production&quot;</span>
<span class="w">        </span><span class="c1"># production configuration</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span>staging<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Configuring for staging&quot;</span>
<span class="w">        </span><span class="c1"># staging configuration</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Unknown environment: </span><span class="nv">$ENVIRONMENT</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>

<span class="c1"># Install CloudWatch agent</span>
wget<span class="w"> </span>https://s3.amazonaws.com/amazoncloudwatch-agent/ubuntu/amd64/latest/amazon-cloudwatch-agent.deb
dpkg<span class="w"> </span>-i<span class="w"> </span>amazon-cloudwatch-agent.deb

<span class="c1"># Start Nginx</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>nginx
systemctl<span class="w"> </span>start<span class="w"> </span>nginx

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Bootstrap completed at </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>

<h3 id="using-parameter-store">Using Parameter Store<a class="header-link" href="#using-parameter-store" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># Get configuration from SSM Parameter Store</span>

<span class="nv">REGION</span><span class="o">=</span><span class="s2">&quot;ap-northeast-2&quot;</span>

<span class="c1"># Get parameters</span>
<span class="nv">DB_HOST</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>ssm<span class="w"> </span>get-parameter<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--region<span class="w"> </span><span class="nv">$REGION</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;/myapp/production/db/host&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;Parameter.Value&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>

<span class="nv">DB_PASSWORD</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>ssm<span class="w"> </span>get-parameter<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--region<span class="w"> </span><span class="nv">$REGION</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;/myapp/production/db/password&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--with-decryption<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;Parameter.Value&#39;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>

<span class="c1"># Set as environment variables</span>
<span class="nb">export</span><span class="w"> </span>DB_HOST
<span class="nb">export</span><span class="w"> </span>DB_PASSWORD

<span class="c1"># Start application</span>
<span class="nb">exec</span><span class="w"> </span>/opt/myapp/bin/start
</code></pre></div>

<h3 id="log-management-cloudwatch">Log Management (CloudWatch)<a class="header-link" href="#log-management-cloudwatch" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json</span>
<span class="p p-Indicator">{</span>
<span class="w">  </span><span class="s">&quot;logs&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">    </span><span class="s">&quot;logs_collected&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">      </span><span class="s">&quot;files&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">        </span><span class="s">&quot;collect_list&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">          </span><span class="p p-Indicator">{</span>
<span class="w">            </span><span class="s">&quot;file_path&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/var/log/nginx/access.log&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;log_group_name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/aws/ec2/nginx/access&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;log_stream_name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;{instance_id}&quot;</span>
<span class="w">          </span><span class="p p-Indicator">},</span>
<span class="w">          </span><span class="p p-Indicator">{</span>
<span class="w">            </span><span class="s">&quot;file_path&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/var/log/nginx/error.log&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;log_group_name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/aws/ec2/nginx/error&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;log_stream_name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;{instance_id}&quot;</span>
<span class="w">          </span><span class="p p-Indicator">},</span>
<span class="w">          </span><span class="p p-Indicator">{</span>
<span class="w">            </span><span class="s">&quot;file_path&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/var/log/syslog&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;log_group_name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/aws/ec2/syslog&quot;</span><span class="p p-Indicator">,</span>
<span class="w">            </span><span class="s">&quot;log_stream_name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;{instance_id}&quot;</span>
<span class="w">          </span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">},</span>
<span class="w">  </span><span class="s">&quot;metrics&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">    </span><span class="s">&quot;metrics_collected&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">      </span><span class="s">&quot;mem&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">        </span><span class="s">&quot;measurement&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;mem_used_percent&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">},</span>
<span class="w">      </span><span class="s">&quot;disk&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">        </span><span class="s">&quot;measurement&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;disk_used_percent&quot;</span><span class="p p-Indicator">],</span>
<span class="w">        </span><span class="s">&quot;resources&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">}</span>
<span class="p p-Indicator">}</span>
</code></pre></div>

<hr />
<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-cloud-init-configuration">Problem 1: cloud-init Configuration<a class="header-link" href="#problem-1-cloud-init-configuration" title="Permanent link">&para;</a></h3>
<p>Write a cloud-config with the following requirements:
- Create user <code>webadmin</code> (with sudo privileges)
- Install nginx
- Set timezone to Asia/Seoul</p>
<h3 id="problem-2-aws-cli-query">Problem 2: AWS CLI Query<a class="header-link" href="#problem-2-aws-cli-query" title="Permanent link">&para;</a></h3>
<p>Write an AWS CLI command that outputs running EC2 instances' Instance ID, Name, and Private IP in table format.</p>
<h3 id="problem-3-imdsv2-script">Problem 3: IMDSv2 Script<a class="header-link" href="#problem-3-imdsv2-script" title="Permanent link">&para;</a></h3>
<p>Write a script that outputs the instance's availability zone and instance type using IMDSv2.</p>
<hr />
<h2 id="answers">Answers<a class="header-link" href="#answers" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-answer">Problem 1 Answer<a class="header-link" href="#problem-1-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">#cloud-config</span>

<span class="nt">users</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webadmin</span>
<span class="w">    </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sudo</span>
<span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
<span class="w">    </span><span class="nt">sudo</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;ALL=(ALL)</span><span class="nv"> </span><span class="s">NOPASSWD:ALL&#39;</span><span class="p p-Indicator">]</span>

<span class="nt">package_update</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">packages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>

<span class="nt">timezone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Asia/Seoul</span>

<span class="nt">runcmd</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemctl enable nginx</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemctl start nginx</span>
</code></pre></div>

<h3 id="problem-2-answer">Problem 2 Answer<a class="header-link" href="#problem-2-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>aws<span class="w"> </span>ec2<span class="w"> </span>describe-instances<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filters<span class="w"> </span><span class="s2">&quot;Name=instance-state-name,Values=running&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span><span class="s1">&#39;Reservations[].Instances[].{ID:InstanceId,Name:Tags[?Key==`Name`].Value|[0],IP:PrivateIpAddress}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>table
</code></pre></div>

<h3 id="problem-3-answer">Problem 3 Answer<a class="header-link" href="#problem-3-answer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Get token</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-sX<span class="w"> </span>PUT<span class="w"> </span><span class="s2">&quot;http://169.254.169.254/latest/api/token&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;</span><span class="k">)</span>

<span class="c1"># Query metadata</span>
<span class="nv">AZ</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-sH<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://169.254.169.254/latest/meta-data/placement/availability-zone<span class="k">)</span>

<span class="nv">INSTANCE_TYPE</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-sH<span class="w"> </span><span class="s2">&quot;X-aws-ec2-metadata-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://169.254.169.254/latest/meta-data/instance-type<span class="k">)</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Availability Zone: </span><span class="nv">$AZ</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Instance Type: </span><span class="nv">$INSTANCE_TYPE</span><span class="s2">&quot;</span>
</code></pre></div>

<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./25_High_Availability_Cluster.md">25_High_Availability_Cluster.md</a> - Pacemaker, Corosync, DRBD</li>
</ul>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://cloudinit.readthedocs.io/">cloud-init Documentation</a></li>
<li><a href="https://docs.aws.amazon.com/cli/">AWS CLI Documentation</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html">EC2 Instance Metadata</a></li>
<li><code>man cloud-init</code>, <code>aws help</code></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Linux/23_Advanced_Networking.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Advanced Networking</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Linux/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Linux/25_High_Availability_Cluster.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">High Availability Cluster</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}