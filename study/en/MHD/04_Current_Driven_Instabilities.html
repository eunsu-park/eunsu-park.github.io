{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4. Current-Driven Instabilities - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/MHD/">MHD</a>
    <span class="separator">/</span>
    <span class="current">4. Current-Driven Instabilities</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>4. Current-Driven Instabilities</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/MHD/03_Pressure_Driven_Instabilities.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">3. Pressure-Driven Instabilities</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/MHD/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/MHD/05_Reconnection_Theory.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">5. Magnetic Reconnection Theory</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-introduction-to-current-driven-instabilities">1. Introduction to Current-Driven Instabilities</a></li>
<li><a href="#2-kink-instability">2. Kink Instability</a><ul>
<li><a href="#21-external-kink-mode">2.1 External Kink Mode</a></li>
<li><a href="#22-sharp-boundary-model">2.2 Sharp-Boundary Model</a></li>
<li><a href="#23-internal-kink-mode">2.3 Internal Kink Mode</a></li>
<li><a href="#24-sausage-instability-m0">2.4 Sausage Instability (m=0)</a></li>
<li><a href="#25-helical-perturbations">2.5 Helical Perturbations</a></li>
</ul>
</li>
<li><a href="#3-tearing-mode-theory">3. Tearing Mode Theory</a><ul>
<li><a href="#31-resistive-instability-basics">3.1 Resistive Instability Basics</a></li>
<li><a href="#32-tearing-layer-analysis">3.2 Tearing Layer Analysis</a></li>
<li><a href="#33-parameter">3.3 Œî' Parameter</a></li>
<li><a href="#34-growth-rate-scaling">3.4 Growth Rate Scaling</a></li>
<li><a href="#35-magnetic-island-width">3.5 Magnetic Island Width</a></li>
</ul>
</li>
<li><a href="#4-resistive-wall-mode">4. Resistive Wall Mode</a><ul>
<li><a href="#41-wall-stabilization">4.1 Wall Stabilization</a></li>
<li><a href="#42-growth-rate">4.2 Growth Rate</a></li>
<li><a href="#43-feedback-stabilization">4.3 Feedback Stabilization</a></li>
</ul>
</li>
<li><a href="#5-neoclassical-tearing-mode-ntm">5. Neoclassical Tearing Mode (NTM)</a><ul>
<li><a href="#51-bootstrap-current-drive">5.1 Bootstrap Current Drive</a></li>
<li><a href="#52-modified-rutherford-equation">5.2 Modified Rutherford Equation</a></li>
<li><a href="#53-threshold-and-metastability">5.3 Threshold and Metastability</a></li>
<li><a href="#54-suppression-techniques">5.4 Suppression Techniques</a></li>
</ul>
</li>
<li><a href="#6-numerical-implementation">6. Numerical Implementation</a><ul>
<li><a href="#61-kink-mode-growth-rate">6.1 Kink Mode Growth Rate</a></li>
<li><a href="#62-calculation-for-tearing-mode">6.2 Œî' Calculation for Tearing Mode</a></li>
<li><a href="#63-rutherford-island-evolution">6.3 Rutherford Island Evolution</a></li>
</ul>
</li>
<li><a href="#7-experimental-observations">7. Experimental Observations</a><ul>
<li><a href="#71-sawteeth-in-tokamaks">7.1 Sawteeth in Tokamaks</a></li>
<li><a href="#72-disruptions">7.2 Disruptions</a></li>
<li><a href="#73-neoclassical-tearing-modes">7.3 Neoclassical Tearing Modes</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
<li><a href="#practice-problems">Practice Problems</a><ul>
<li><a href="#problem-1-external-kink-stability">Problem 1: External Kink Stability</a></li>
<li><a href="#problem-2-sawtooth-period">Problem 2: Sawtooth Period</a></li>
<li><a href="#problem-3-tearing-mode">Problem 3: Tearing Mode Œî'</a></li>
<li><a href="#problem-4-magnetic-island-width">Problem 4: Magnetic Island Width</a></li>
<li><a href="#problem-5-resistive-wall-mode">Problem 5: Resistive Wall Mode</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="4-current-driven-instabilities">4. Current-Driven Instabilities<a class="header-link" href="#4-current-driven-instabilities" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand kink instabilities (external and internal) driven by plasma current</li>
<li>Analyze the sausage instability and its stabilization</li>
<li>Derive tearing mode theory and magnetic island formation</li>
<li>Study resistive wall modes and feedback stabilization</li>
<li>Understand neoclassical tearing modes (NTMs) in tokamaks</li>
<li>Compute Œî' parameter and growth rates for tearing modes</li>
<li>Implement numerical solvers for current-driven instabilities</li>
<li>Connect theory to experimental observations (sawteeth, disruptions)</li>
</ul>
<h2 id="1-introduction-to-current-driven-instabilities">1. Introduction to Current-Driven Instabilities<a class="header-link" href="#1-introduction-to-current-driven-instabilities" title="Permanent link">&para;</a></h2>
<p>Current-driven instabilities are MHD modes where the <strong>free energy source</strong> is the plasma current (or equivalently, the magnetic field configuration). Unlike pressure-driven modes, these can exist even at <strong>zero pressure</strong>.</p>
<p><strong>Key features</strong>:
- Driven by current/magnetic field configuration
- Can be ideal (no resistivity) or resistive (reconnection)
- Often limit maximum achievable plasma current
- Lead to major disruptions in tokamaks</p>
<div class="highlight"><pre><span></span><code>Classification of Current-Driven Instabilities:
==============================================

IDEAL MHD (Œ∑ = 0):
‚îú‚îÄ External kink (m=1): Column bends, q(a) &lt; 1
‚îú‚îÄ Internal kink (m=1): Core kink, q(0) &lt; 1
‚îî‚îÄ Sausage (m=0): Pinching/expansion, stabilized by Bz

RESISTIVE MHD (Œ∑ ‚â† 0):
‚îú‚îÄ Tearing mode: Magnetic reconnection at q = m/n
‚îú‚îÄ Resistive wall mode: Wall-stabilized kink
‚îî‚îÄ Neoclassical tearing mode (NTM): Bootstrap current
</code></pre></div>

<h2 id="2-kink-instability">2. Kink Instability<a class="header-link" href="#2-kink-instability" title="Permanent link">&para;</a></h2>
<h3 id="21-external-kink-mode">2.1 External Kink Mode<a class="header-link" href="#21-external-kink-mode" title="Permanent link">&para;</a></h3>
<p>The <strong>external kink</strong> (m=1, n=1 in toroidal systems) is a global displacement of the plasma column.</p>
<p><strong>Physical picture</strong>:</p>
<div class="highlight"><pre><span></span><code>External Kink (m=1):
===================

Before:          After:
   ‚îÇ                ‚ï±
   ‚îÇ               ‚ï±  ‚Üê Column bends
   ‚îÇ     ‚Üí        ‚îÇ
   ‚îÇ               ‚ï≤
   ‚îÇ                ‚ï≤

Entire plasma column
displaces helically
</code></pre></div>

<p><strong>Energy balance</strong>:
- <strong>Destabilizing</strong>: Magnetic pressure imbalance when column bends
- <strong>Stabilizing</strong>: Axial field $B_z$ provides line-bending energy</p>
<p><strong>Kruskal-Shafranov criterion</strong> (from Lesson 2):</p>
<p>$$
q(a) > \frac{m}{n}
$$</p>
<p>For $(m,n) = (1,1)$:</p>
<p>$$
q(a) > 1
$$</p>
<h3 id="22-sharp-boundary-model">2.2 Sharp-Boundary Model<a class="header-link" href="#22-sharp-boundary-model" title="Permanent link">&para;</a></h3>
<p>For a sharp-boundary Z-pinch with:
- Radius $a$
- Current $I$
- Axial field $B_z$</p>
<p>The dispersion relation for $m=1$ kink:</p>
<p>$$
\omega^2 = -\frac{B_\theta^2(a)}{\mu_0\rho}\left(1 - q^2(a)\right)
$$</p>
<p><strong>Stability</strong>:
- If $q(a) < 1$: $\omega^2 < 0$ ‚Üí <strong>unstable</strong>
- If $q(a) > 1$: $\omega^2 > 0$ ‚Üí <strong>stable</strong> (oscillatory)</p>
<p><strong>Growth rate</strong> (when unstable):</p>
<p>$$
\gamma = \frac{B_\theta(a)}{\sqrt{\mu_0\rho}}\sqrt{1 - q^2(a)}
$$</p>
<p>This is on the <strong>Alfv√©n timescale</strong>: $\tau_A \sim a/v_A$.</p>
<h3 id="23-internal-kink-mode">2.3 Internal Kink Mode<a class="header-link" href="#23-internal-kink-mode" title="Permanent link">&para;</a></h3>
<p>The <strong>internal kink</strong> mode occurs when $q < 1$ somewhere in the plasma (typically on-axis).</p>
<p><strong>Characteristics</strong>:
- Localized to region where $q < 1$
- Does not require wall or edge instability
- Causes <strong>sawtooth oscillations</strong> in tokamaks</p>
<p><strong>Sawtooth crash</strong>:
1. Central temperature rises
2. Central current density rises
3. $q(0)$ drops below 1
4. Internal kink triggers
5. Rapid reconnection flattens $T$ and $q$ profiles
6. Cycle repeats</p>
<div class="highlight"><pre><span></span><code>Sawtooth Oscillation:
====================

T‚ÇÄ |     ‚ï±|     ‚ï±|     ‚ï±
   |    ‚ï± |    ‚ï± |    ‚ï±
   |   ‚ï±  |   ‚ï±  |   ‚ï±
   |  ‚ï±   |  ‚ï±   |  ‚ï±
   | ‚ï±    | ‚ï±    | ‚ï±
   |‚ï±_____|‚ï±_____|‚ï±_____ time
     ‚Üë      ‚Üë      ‚Üë
   Crash  Crash  Crash
   (m=1,n=1 internal kink)
</code></pre></div>

<p><strong>Bussac criterion</strong> for internal kink stability:</p>
<p>$$
\beta_p < \frac{0.3}{q_0^2}
$$</p>
<p>where $\beta_p$ is poloidal beta and $q_0 = q(0)$.</p>
<h3 id="24-sausage-instability-m0">2.4 Sausage Instability (m=0)<a class="header-link" href="#24-sausage-instability-m0" title="Permanent link">&para;</a></h3>
<p>The <strong>sausage mode</strong> ($m=0$) is a symmetric pinching/expansion:</p>
<div class="highlight"><pre><span></span><code>Sausage Mode (m=0):
==================

Before:        After:
  ‚ïë‚ïë‚ïë‚ïë‚ïë         ‚ïë‚ïë‚ïë‚ïë‚ïë
  ‚ïë‚ïë‚ïë‚ïë‚ïë    ‚Üí   ‚ï±‚ïë‚ïë‚ïë‚ïë‚ïë‚ï≤
  ‚ïë‚ïë‚ïë‚ïë‚ïë         ‚ïë‚ïë‚ïë‚ïë‚ïë
  ‚ïë‚ïë‚ïë‚ïë‚ïë        ‚ï±‚ïë‚ïë‚ïë‚ïë‚ïë‚ï≤
  ‚ïë‚ïë‚ïë‚ïë‚ïë         ‚ïë‚ïë‚ïë‚ïë‚ïë

Column pinches and expands
alternately along z
</code></pre></div>

<p><strong>Dispersion relation</strong> (Z-pinch, no $B_z$):</p>
<p>$$
\omega^2 = -\frac{B_\theta^2(a)}{\mu_0\rho}k_z^2 a^2
$$</p>
<p>Always unstable ($\omega^2 < 0$) for $k_z \neq 0$.</p>
<p><strong>With axial field</strong> $B_z$:</p>
<p>$$
\omega^2 = \frac{B_\theta^2(a)}{\mu_0\rho}k_z^2 a^2\left(\frac{B_z^2}{B_\theta^2(a)} - 1\right)
$$</p>
<p><strong>Stability</strong>: Stable if $B_z > B_\theta(a)$, i.e., $q(a) > 1$.</p>
<h3 id="25-helical-perturbations">2.5 Helical Perturbations<a class="header-link" href="#25-helical-perturbations" title="Permanent link">&para;</a></h3>
<p>General helical perturbation:</p>
<p>$$
\boldsymbol{\xi} = \hat{\boldsymbol{\xi}}(r)e^{i(m\theta + k_z z - \omega t)}
$$</p>
<p>For a cylinder with toroidal identification: $k_z = n/R_0$.</p>
<p><strong>Resonant surface</strong>: Where $\mathbf{k}\cdot\mathbf{B} = 0$:</p>
<p>$$
mB_\theta(r_s) + k_z B_z = 0 \quad \Rightarrow \quad q(r_s) = \frac{m}{n}
$$</p>
<p>At the resonant surface, field line bending vanishes ‚Üí <strong>ideal MHD becomes singular</strong> ‚Üí resistivity required.</p>
<h2 id="3-tearing-mode-theory">3. Tearing Mode Theory<a class="header-link" href="#3-tearing-mode-theory" title="Permanent link">&para;</a></h2>
<h3 id="31-resistive-instability-basics">3.1 Resistive Instability Basics<a class="header-link" href="#31-resistive-instability-basics" title="Permanent link">&para;</a></h3>
<p>In <strong>ideal MHD</strong>, magnetic topology is conserved (frozen-in theorem). In <strong>resistive MHD</strong>, finite resistivity $\eta$ allows <strong>magnetic reconnection</strong>.</p>
<p><strong>Tearing mode</strong>: Resistive instability at rational surfaces where $q = m/n$.</p>
<p><strong>Physical mechanism</strong>:
1. Perturbation creates current sheet at $q = m/n$ surface
2. Resistive diffusion breaks field lines
3. Reconnection forms magnetic islands
4. Islands grow, tearing apart flux surfaces</p>
<div class="highlight"><pre><span></span><code><span class="gh">Tearing Mode and Magnetic Islands:</span>
<span class="gh">==================================</span>

Initial:           Reconnected:
 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê            ‚ïê‚ïê‚ïê‚ï±‚ïê‚ï≤‚ïê‚ïê‚ïê
 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê    ‚Üí       ‚ïê‚ïê‚ï±   ‚ï≤‚ïê‚ïê  (O-point)
 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê            ‚ïê‚ï±  ‚äó  ‚ï≤‚ïê
   ‚Üë                 ‚ï≤     ‚ï±
Rational              ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
surface              (X-point)

Island width w grows with time
</code></pre></div>

<h3 id="32-tearing-layer-analysis">3.2 Tearing Layer Analysis<a class="header-link" href="#32-tearing-layer-analysis" title="Permanent link">&para;</a></h3>
<p>Near the resonant surface $r = r_s$, there is a narrow <strong>tearing layer</strong> of width $\delta$.</p>
<p><strong>Layer structure</strong>:
- Inner layer ($|r - r_s| < \delta$): resistivity important
- Outer region ($|r - r_s| > \delta$): ideal MHD</p>
<p><strong>Boundary layer equation</strong> (constant-$\psi$ regime):</p>
<p>$$
\frac{d^4\psi}{dx^4} - k^2\frac{d^2\psi}{dx^2} + \frac{i\omega\mu_0}{\eta}\psi = 0
$$</p>
<p>where $x = r - r_s$ is distance from resonant surface.</p>
<p><strong>Matching condition</strong>: Inner solution must match outer ideal solution.</p>
<h3 id="33-parameter">3.3 Œî' Parameter<a class="header-link" href="#33-parameter" title="Permanent link">&para;</a></h3>
<p>The <strong>Œî' parameter</strong> characterizes the jump in logarithmic derivative of $\psi$ across the resonant surface:</p>
<p>$$
\Delta' = \left[\frac{d(\ln\psi')}{dr}\right]_{r_s^+}^{r_s^-} = \left(\frac{1}{\psi'}\frac{d\psi'}{dr}\right)_{r_s^+} - \left(\frac{1}{\psi'}\frac{d\psi'}{dr}\right)_{r_s^-}
$$</p>
<p>where $\psi$ is the perturbed poloidal flux.</p>
<p><strong>Stability criterion</strong>:
- $\Delta' > 0$: <strong>unstable</strong> (tearing)
- $\Delta' < 0$: <strong>stable</strong>
- $\Delta' = 0$: <strong>marginal</strong></p>
<h3 id="34-growth-rate-scaling">3.4 Growth Rate Scaling<a class="header-link" href="#34-growth-rate-scaling" title="Permanent link">&para;</a></h3>
<p>The growth rate depends on regime:</p>
<p><strong>Constant-$\psi$ regime</strong> (resistivity-dominated):</p>
<p>$$
\gamma \propto \eta^{3/5}(\Delta')^{4/5}
$$</p>
<p><strong>Non-constant-$\psi$ regime</strong> (slower):</p>
<p>$$
\gamma \propto \eta^{1/3}(\Delta')
$$</p>
<p><strong>Typical values</strong>:
- $\eta \sim 10^{-9}$ (tokamak conditions)
- $\gamma \sim 10^2 - 10^4$ s$^{-1}$ (much slower than Alfv√©n)</p>
<h3 id="35-magnetic-island-width">3.5 Magnetic Island Width<a class="header-link" href="#35-magnetic-island-width" title="Permanent link">&para;</a></h3>
<p>The saturated island width is related to the reconnected flux $\delta\psi$:</p>
<p>$$
w = 4\sqrt{\frac{\delta\psi r_s}{m B_\theta(r_s)}}
$$</p>
<p><strong>Island growth</strong>: Described by the <strong>Rutherford equation</strong>:</p>
<p>$$
\frac{d(\delta\psi)}{dt} = \eta J_s \Delta'(w) w
$$</p>
<p>where $\Delta'(w)$ depends on island width.</p>
<p><strong>Nonlinear evolution</strong>:
- Small islands: $\Delta'(w) \approx \Delta'(0)$ ‚Üí exponential growth
- Large islands: $\Delta'(w)$ decreases ‚Üí saturation or continued growth</p>
<h2 id="4-resistive-wall-mode">4. Resistive Wall Mode<a class="header-link" href="#4-resistive-wall-mode" title="Permanent link">&para;</a></h2>
<h3 id="41-wall-stabilization">4.1 Wall Stabilization<a class="header-link" href="#41-wall-stabilization" title="Permanent link">&para;</a></h3>
<p>A <strong>conducting wall</strong> near the plasma can stabilize ideal external kink modes by inducing <strong>image currents</strong> that cancel the perturbation.</p>
<p><strong>Ideal wall</strong> (perfect conductor, $r = r_w$):
- Perturbation induces surface current
- Image current exactly cancels external field
- External kink stabilized even if $q(a) < 1$</p>
<p><strong>Resistive wall</strong> (finite conductivity):
- Image current decays on resistive timescale $\tau_w = \mu_0\sigma d r_w$
- Mode grows slowly: $\gamma \sim 1/\tau_w$</p>
<div class="highlight"><pre><span></span><code>Resistive Wall Mode:
===================

        Plasma
          ‚ïë
          ‚ïë  ‚Üê Perturbation
          ‚ïë
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê  Resistive wall
       ‚Üì
    Induced current
    (decays on œÑw)

Œ≥ ~ 1/œÑw &lt;&lt; Œ≥_ideal
</code></pre></div>

<h3 id="42-growth-rate">4.2 Growth Rate<a class="header-link" href="#42-growth-rate" title="Permanent link">&para;</a></h3>
<p>For a resistive wall at radius $r_w$, the growth rate:</p>
<p>$$
\gamma_{RWM} \approx \frac{1}{\tau_w}\frac{r_w - a}{r_w}
$$</p>
<p>where $\tau_w = \mu_0\sigma d r_w$ is the wall time constant, $\sigma$ is conductivity, $d$ is wall thickness.</p>
<p><strong>Typical values</strong>:
- $\tau_w \sim 0.01 - 1$ s (copper wall)
- $\gamma_{RWM} \sim 1 - 100$ s$^{-1}$ (intermediate timescale)</p>
<h3 id="43-feedback-stabilization">4.3 Feedback Stabilization<a class="header-link" href="#43-feedback-stabilization" title="Permanent link">&para;</a></h3>
<p>Since RWM grows slowly, it can be <strong>actively stabilized</strong> by feedback coils:</p>
<ol>
<li>Detect mode (magnetic sensors)</li>
<li>Compute correction field</li>
<li>Drive coils to cancel perturbation</li>
<li>Feedback must be faster than $\gamma_{RWM}$</li>
</ol>
<p><strong>Applications</strong>:
- High-beta tokamak operation
- Advanced scenarios ($q(0) < 1$)
- Maintained equilibrium beyond no-wall beta limit</p>
<h2 id="5-neoclassical-tearing-mode-ntm">5. Neoclassical Tearing Mode (NTM)<a class="header-link" href="#5-neoclassical-tearing-mode-ntm" title="Permanent link">&para;</a></h2>
<h3 id="51-bootstrap-current-drive">5.1 Bootstrap Current Drive<a class="header-link" href="#51-bootstrap-current-drive" title="Permanent link">&para;</a></h3>
<p>In a tokamak, <strong>bootstrap current</strong> arises from pressure gradient due to collisional momentum conservation:</p>
<p>$$
J_{bs} \propto \frac{dp}{dr}
$$</p>
<p>When a magnetic island forms:
- Island flattens pressure profile locally
- Bootstrap current is reduced inside island
- Missing current creates helical current perturbation
- Perturbation drives further island growth</p>
<p><strong>Positive feedback loop</strong> ‚Üí <strong>metastable NTM</strong></p>
<h3 id="52-modified-rutherford-equation">5.2 Modified Rutherford Equation<a class="header-link" href="#52-modified-rutherford-equation" title="Permanent link">&para;</a></h3>
<p>The island evolution including bootstrap drive:</p>
<p>$$
\tau_r\frac{dw}{dt} = r_s\Delta'(w) + r_s\frac{L_q}{L_p}\beta_p\left(\frac{w_d^2}{w^2} - \frac{w_{sat}^2}{w^2 + w_{sat}^2}\right)
$$</p>
<p>where:
- $\tau_r$: resistive diffusion time
- $\Delta'(w)$: stability index (can be negative)
- $L_q = q/(dq/dr)$: shear length
- $L_p = p/(dp/dr)$: pressure scale length
- $\beta_p$: poloidal beta
- $w_d$: threshold width for onset
- $w_{sat}$: saturated width</p>
<h3 id="53-threshold-and-metastability">5.3 Threshold and Metastability<a class="header-link" href="#53-threshold-and-metastability" title="Permanent link">&para;</a></h3>
<p><strong>Key feature</strong>: NTM requires a <strong>seed island</strong> to grow.</p>
<ul>
<li>Small perturbation ($w < w_d$): island decays</li>
<li>Above threshold ($w > w_d$): island grows to $w_{sat}$</li>
</ul>
<p><strong>Triggering mechanisms</strong>:
- Sawtooth crash
- ELM
- Other MHD events</p>
<div class="highlight"><pre><span></span><code><span class="n">NTM</span><span class="w"> </span><span class="nl">Metastability:</span>
<span class="o">=================</span>

<span class="n">dw</span><span class="o">/</span><span class="n">dt</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="err">‚ï±</span>
<span class="w">      </span><span class="o">|</span><span class="w">       </span><span class="err">‚ï±</span><span class="w"> </span><span class="err">‚Üê</span><span class="w"> </span><span class="n">Growth</span><span class="w"> </span><span class="n">region</span>
<span class="w">      </span><span class="o">|</span><span class="w">      </span><span class="err">‚ï±</span>
<span class="w">      </span><span class="o">|</span><span class="n">_____</span><span class="err">‚ï±</span><span class="n">_________</span><span class="w"> </span><span class="n">w</span>
<span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="err">‚ï±</span><span class="w">  </span><span class="err">‚Üë</span><span class="w">   </span><span class="err">‚Üë</span>
<span class="w">      </span><span class="o">|</span><span class="w">   </span><span class="err">‚ï±</span><span class="w">  </span><span class="n">w_d</span><span class="w"> </span><span class="n">w_sat</span>
<span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="err">‚ï±</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="err">‚ï±</span><span class="w"> </span><span class="err">‚Üê</span><span class="w"> </span><span class="n">Decay</span><span class="w"> </span><span class="n">region</span>

<span class="n">Two</span><span class="w"> </span><span class="n">stable</span><span class="w"> </span><span class="nl">states:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">island</span><span class="p">)</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w_sat</span><span class="w"> </span><span class="p">(</span><span class="n">saturated</span><span class="p">)</span>
</code></pre></div>

<h3 id="54-suppression-techniques">5.4 Suppression Techniques<a class="header-link" href="#54-suppression-techniques" title="Permanent link">&para;</a></h3>
<p><strong>Methods to suppress NTM</strong>:
1. <strong>Electron cyclotron current drive (ECCD)</strong>: Drive current at island O-point to replace missing bootstrap current
2. <strong>Reduce beta</strong>: Lower pressure gradient ‚Üí smaller bootstrap drive
3. <strong>Increase rotation</strong>: Stabilize through velocity shear
4. <strong>Avoid triggers</strong>: Reduce sawtooth amplitude, control ELMs</p>
<h2 id="6-numerical-implementation">6. Numerical Implementation<a class="header-link" href="#6-numerical-implementation" title="Permanent link">&para;</a></h2>
<h3 id="61-kink-mode-growth-rate">6.1 Kink Mode Growth Rate<a class="header-link" href="#61-kink-mode-growth-rate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">kink_growth_rate</span><span class="p">(</span><span class="n">q_edge</span><span class="p">,</span> <span class="n">Btheta</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute external kink growth rate for cylindrical plasma</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    q_edge: safety factor at edge</span>
<span class="sd">    Btheta: poloidal field at edge [T]</span>
<span class="sd">    rho: plasma density [kg/m^3]</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    gamma: growth rate [1/s] (0 if stable)</span>
<span class="sd">    stable: True if stable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span>

    <span class="k">if</span> <span class="n">q_edge</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Unstable</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">Btheta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">rho</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q_edge</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">stable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Stable</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">stable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">stable</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_kink_stability</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot kink growth rate vs q(a)&quot;&quot;&quot;</span>

    <span class="c1"># Plasma parameters</span>
    <span class="n">Btheta</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># T</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="mf">1e-6</span>    <span class="c1"># kg/m^3</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span>

    <span class="n">vA</span> <span class="o">=</span> <span class="n">Btheta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)</span>  <span class="c1"># Alfv√©n speed</span>

    <span class="c1"># Safety factor range</span>
    <span class="n">q_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">gamma_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_vals</span><span class="p">:</span>
        <span class="n">gamma</span><span class="p">,</span> <span class="n">stable</span> <span class="o">=</span> <span class="n">kink_growth_rate</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">Btheta</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
        <span class="n">gamma_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>

    <span class="n">gamma_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_vals</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># Plot growth rate</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_vals</span><span class="p">,</span> <span class="n">gamma_vals</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Mark stability boundary</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stability boundary (q=1)&#39;</span><span class="p">)</span>

    <span class="c1"># Shade unstable region</span>
    <span class="n">unstable_mask</span> <span class="o">=</span> <span class="n">q_vals</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">unstable_mask</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">q_vals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gamma_vals</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">unstable_mask</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unstable&#39;</span><span class="p">)</span>

    <span class="c1"># Shade stable region</span>
    <span class="n">stable_mask</span> <span class="o">=</span> <span class="n">q_vals</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">q_vals</span><span class="p">[</span><span class="n">stable_mask</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gamma_vals</span><span class="p">[</span><span class="n">stable_mask</span><span class="p">],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stable&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Edge safety factor q(a)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Growth rate Œ≥ [1/s]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;External Kink Growth Rate (v‚Çê = </span><span class="si">{</span><span class="n">vA</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> m/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span><span class="w"> </span><span class="nf">example_kink_instability</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze external kink for various configurations&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== External Kink Instability Analysis ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Plasma parameters</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>       <span class="c1"># Minor radius [m]</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mf">1e6</span>       <span class="c1"># Plasma current [A]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mf">1e20</span>      <span class="c1"># Density [m^-3]</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mf">1e7</span>       <span class="c1"># Temperature [K]</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span>
    <span class="n">mp</span> <span class="o">=</span> <span class="mf">1.67e-27</span>

    <span class="n">rho</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">mp</span>

    <span class="c1"># Poloidal field at edge</span>
    <span class="n">Btheta</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">I</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plasma parameters:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Radius: a = </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Current: I = </span><span class="si">{</span><span class="n">I</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s2"> MA&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Density: n = </span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Edge poloidal field: BŒ∏(a) = </span><span class="si">{</span><span class="n">Btheta</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> T&quot;</span><span class="p">)</span>

    <span class="c1"># Test various toroidal fields (varying q)</span>
    <span class="n">R0</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># Major radius</span>
    <span class="n">Bt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>  <span class="c1"># Toroidal field [T]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Kink stability for various toroidal fields (R0 = </span><span class="si">{</span><span class="n">R0</span><span class="si">}</span><span class="s2"> m):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">Bt</span> <span class="ow">in</span> <span class="n">Bt_values</span><span class="p">:</span>
        <span class="c1"># Safety factor</span>
        <span class="n">q_edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">Bt</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">R0</span> <span class="o">*</span> <span class="n">Btheta</span><span class="p">)</span>

        <span class="c1"># Growth rate</span>
        <span class="n">gamma</span><span class="p">,</span> <span class="n">stable</span> <span class="o">=</span> <span class="n">kink_growth_rate</span><span class="p">(</span><span class="n">q_edge</span><span class="p">,</span> <span class="n">Btheta</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>

        <span class="c1"># Alfv√©n time</span>
        <span class="n">vA</span> <span class="o">=</span> <span class="n">Btheta</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)</span>
        <span class="n">tau_A</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">vA</span>

        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;STABLE&quot;</span> <span class="k">if</span> <span class="n">stable</span> <span class="k">else</span> <span class="s2">&quot;UNSTABLE&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Bt = </span><span class="si">{</span><span class="n">Bt</span><span class="si">}</span><span class="s2"> T:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  q(a) = </span><span class="si">{</span><span class="n">q_edge</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">stable</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Growth rate: Œ≥ = </span><span class="si">{</span><span class="n">gamma</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s^-1&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Growth time: œÑ = </span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Alfv√©n time: œÑA = </span><span class="si">{</span><span class="n">tau_A</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Œ≥/œâA = </span><span class="si">{</span><span class="n">gamma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tau_A</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_kink_stability</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/tmp/kink_stability.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Kink stability plot saved to /tmp/kink_stability.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">example_kink_instability</span><span class="p">()</span>
</code></pre></div>

<h3 id="62-calculation-for-tearing-mode">6.2 Œî' Calculation for Tearing Mode<a class="header-link" href="#62-calculation-for-tearing-mode" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>

<span class="k">def</span><span class="w"> </span><span class="nf">solve_outer_region</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">q_profile</span><span class="p">,</span> <span class="n">psi_rs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve ideal MHD equation in outer region</span>

<span class="sd">    d/dr(r d psi/dr) - m¬≤ psi/r = 0 at resonance</span>

<span class="sd">    Near resonance: psi ~ C+ (r-rs)  for r &gt; rs</span>
<span class="sd">                          C- (r-rs)  for r &lt; rs</span>

<span class="sd">    Returns derivative at rs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Simplified: assume psi&#39; = const near rs</span>
    <span class="c1"># In reality, solve ODE from boundaries</span>

    <span class="c1"># For a simple current profile, analytical Œî&#39; exists</span>
    <span class="c1"># Here we use a model</span>

    <span class="c1"># Estimate from q-profile curvature</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">q_rs</span> <span class="o">=</span> <span class="n">q_profile</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
    <span class="n">q_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">q_profile</span><span class="p">(</span><span class="n">rs</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">-</span> <span class="n">q_profile</span><span class="p">(</span><span class="n">rs</span> <span class="o">-</span> <span class="n">dr</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dr</span><span class="p">)</span>
    <span class="n">q_pp</span> <span class="o">=</span> <span class="p">(</span><span class="n">q_profile</span><span class="p">(</span><span class="n">rs</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">q_profile</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span> <span class="o">+</span> <span class="n">q_profile</span><span class="p">(</span><span class="n">rs</span> <span class="o">-</span> <span class="n">dr</span><span class="p">))</span> <span class="o">/</span> <span class="n">dr</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Approximate Œî&#39; from q&#39;&#39;</span>
    <span class="c1"># Œî&#39; ‚âà (2/r_s) + (q&#39;&#39;/q&#39;)</span>
    <span class="n">Delta_prime</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">rs</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">q_pp</span> <span class="o">/</span> <span class="n">q_p</span><span class="p">)</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">q_p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-10</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">Delta_prime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">tearing_growth_rate</span><span class="p">(</span><span class="n">Delta_prime</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">Btheta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate tearing mode growth rate</span>

<span class="sd">    Œ≥ ~ Œ∑^(3/5) Œî&#39;^(4/5)  (constant-psi regime)</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    Delta_prime: stability index [1/m]</span>
<span class="sd">    eta: resistivity [Ohm*m]</span>
<span class="sd">    rs: resonant surface radius [m]</span>
<span class="sd">    Btheta: poloidal field [T]</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    gamma: growth rate [1/s]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span>

    <span class="k">if</span> <span class="n">Delta_prime</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>  <span class="c1"># Stable</span>

    <span class="c1"># Resistive diffusion time</span>
    <span class="n">tau_R</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">eta</span>

    <span class="c1"># Scaling (constant-psi)</span>
    <span class="c1"># Œ≥ ~ (Œ∑/œÑA)^(3/5) Œî&#39;^(4/5) / rs</span>
    <span class="c1"># Simplified estimate</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">eta</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Delta_prime</span> <span class="o">*</span> <span class="n">rs</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gamma</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_delta_prime</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot Œî&#39; for various current profiles&quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Plasma radius</span>
    <span class="n">R0</span> <span class="o">=</span> <span class="mf">3.0</span>

    <span class="c1"># Different current profiles</span>
    <span class="n">profiles</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Parabolic&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;Peaked&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;Hollow&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Panel 1: q-profiles</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">q_func</span> <span class="ow">in</span> <span class="n">profiles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">q_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">q_func</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">r_vals</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_vals</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="n">q_vals</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Mark rational surfaces</span>
    <span class="k">for</span> <span class="n">q_rational</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">q_rational</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">q_rational</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;q=</span><span class="si">{</span><span class="n">q_rational</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r/a&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;q(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Safety Factor Profiles&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Panel 2: Œî&#39; at q=2 surface</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">q_target</span> <span class="o">=</span> <span class="mf">2.0</span>

    <span class="n">Delta_primes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rs_vals</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">q_func</span> <span class="ow">in</span> <span class="n">profiles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Find resonant surface where q = 2</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">r_vals</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">q_func</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">q_target</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">rs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Delta_p</span> <span class="o">=</span> <span class="n">solve_outer_region</span><span class="p">(</span><span class="n">r_vals</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">q_func</span><span class="p">,</span> <span class="n">psi_rs</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="n">Delta_primes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Delta_p</span><span class="p">)</span>
            <span class="n">rs_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Delta_primes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">rs_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
    <span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">profiles</span><span class="p">))</span>

    <span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">Delta_primes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

    <span class="c1"># Mark stability boundary</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Œî</span><span class="se">\&#39;</span><span class="s1">=0 (marginal)&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">profiles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Œî</span><span class="se">\&#39;</span><span class="s1"> [1/m]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tearing Stability Index at q=</span><span class="si">{</span><span class="n">q_target</span><span class="si">}</span><span class="s1"> (m=</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

    <span class="c1"># Annotate stability</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">Delta_primes</span><span class="p">,</span> <span class="n">bars</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">dp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;UNSTABLE&quot;</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;STABLE&quot;</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dp</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span><span class="w"> </span><span class="nf">example_tearing_mode</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze tearing mode for tokamak&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Tearing Mode Analysis ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Parameters</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">R0</span> <span class="o">=</span> <span class="mf">3.0</span>
    <span class="n">Bt</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="n">Ip</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="mf">1e-7</span>  <span class="c1"># Resistivity [Ohm*m]</span>

    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span>

    <span class="c1"># Poloidal field</span>
    <span class="n">Btheta</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">Ip</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># q-profile (parabolic)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">q_profile</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="n">q0</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">qa</span> <span class="o">=</span> <span class="mf">3.0</span>
        <span class="k">return</span> <span class="n">q0</span> <span class="o">+</span> <span class="p">(</span><span class="n">qa</span> <span class="o">-</span> <span class="n">q0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Find q=2 surface</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">q_target</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="n">n</span>

    <span class="n">r_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">r_vals</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">q_profile</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">q_target</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span>
            <span class="k">break</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plasma parameters:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minor radius: a = </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Major radius: R0 = </span><span class="si">{</span><span class="n">R0</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Plasma current: Ip = </span><span class="si">{</span><span class="n">Ip</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s2"> MA&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Resistivity: Œ∑ = </span><span class="si">{</span><span class="n">eta</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> Œ©¬∑m&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Resonant surface (m=</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  q = </span><span class="si">{</span><span class="n">q_target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Location: rs = </span><span class="si">{</span><span class="n">rs</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m (rs/a = </span><span class="si">{</span><span class="n">rs</span><span class="o">/</span><span class="n">a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="c1"># Compute Œî&#39;</span>
    <span class="n">Delta_p</span> <span class="o">=</span> <span class="n">solve_outer_region</span><span class="p">(</span><span class="n">r_vals</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">q_profile</span><span class="p">,</span> <span class="n">psi_rs</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Stability index:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Œî&#39; = </span><span class="si">{</span><span class="n">Delta_p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m^-1&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">Delta_p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Status: UNSTABLE (tearing mode)&quot;</span><span class="p">)</span>

        <span class="c1"># Growth rate</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">tearing_growth_rate</span><span class="p">(</span><span class="n">Delta_p</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">Btheta</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Growth rate:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Œ≥ = </span><span class="si">{</span><span class="n">gamma</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s^-1&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Growth time: œÑ = </span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>

        <span class="c1"># Compare to resistive diffusion time</span>
        <span class="n">tau_R</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">eta</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Resistive time: œÑR = </span><span class="si">{</span><span class="n">tau_R</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Œ≥ œÑR = </span><span class="si">{</span><span class="n">gamma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tau_R</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Estimate island width (nonlinear)</span>
        <span class="c1"># Simplified: w ~ sqrt(Œî&#39; * rs)</span>
        <span class="n">w_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Delta_p</span> <span class="o">*</span> <span class="n">rs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>  <span class="c1"># Order of magnitude</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Estimated saturated island width: w ~ </span><span class="si">{</span><span class="n">w_estimate</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (w/rs = </span><span class="si">{</span><span class="n">w_estimate</span><span class="o">/</span><span class="n">rs</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Status: STABLE&quot;</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_delta_prime</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/tmp/tearing_delta_prime.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Œî&#39; plot saved to /tmp/tearing_delta_prime.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">example_tearing_mode</span><span class="p">()</span>
</code></pre></div>

<h3 id="63-rutherford-island-evolution">6.3 Rutherford Island Evolution<a class="header-link" href="#63-rutherford-island-evolution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rutherford_equation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Delta_prime_func</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">Js</span><span class="p">,</span> <span class="n">rs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rutherford equation for island width evolution</span>

<span class="sd">    œÑR dw/dt = r_s Œî&#39;(w) w</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    t: time [s]</span>
<span class="sd">    w: island width [m]</span>
<span class="sd">    Delta_prime_func: function Œî&#39;(w)</span>
<span class="sd">    eta: resistivity [Ohm*m]</span>
<span class="sd">    Js: current density at resonant surface [A/m^2]</span>
<span class="sd">    rs: resonant surface radius [m]</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dw/dt: growth rate [m/s]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span>

    <span class="c1"># Resistive time</span>
    <span class="n">tau_R</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">eta</span>

    <span class="c1"># Œî&#39;(w)</span>
    <span class="n">Delta_p</span> <span class="o">=</span> <span class="n">Delta_prime_func</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

    <span class="c1"># Rutherford equation</span>
    <span class="n">dwdt</span> <span class="o">=</span> <span class="p">(</span><span class="n">rs</span> <span class="o">*</span> <span class="n">Delta_p</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau_R</span>

    <span class="k">return</span> <span class="n">dwdt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">Delta_prime_saturating</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">Delta0</span><span class="p">,</span> <span class="n">w_sat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Œî&#39;(w) model with saturation</span>

<span class="sd">    Œî&#39;(w) = Œî0 * (1 - w¬≤/w_sat¬≤)</span>

<span class="sd">    As w ‚Üí w_sat, Œî&#39; ‚Üí 0 ‚Üí saturation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">w</span> <span class="o">&gt;=</span> <span class="n">w_sat</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Delta0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">w_sat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_island_evolution</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulate and plot island evolution&quot;&quot;&quot;</span>

    <span class="c1"># Parameters</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="mf">0.3</span>      <span class="c1"># Resonant surface [m]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="mf">1e-7</span>    <span class="c1"># Resistivity [Ohm*m]</span>
    <span class="n">Js</span> <span class="o">=</span> <span class="mf">1e6</span>      <span class="c1"># Current density [A/m^2]</span>
    <span class="n">Delta0</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c1"># Initial Œî&#39; [1/m]</span>
    <span class="n">w_sat</span> <span class="o">=</span> <span class="mf">0.1</span>   <span class="c1"># Saturation width [m]</span>

    <span class="c1"># Œî&#39;(w) function</span>
    <span class="n">Delta_prime_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">Delta_prime_saturating</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">Delta0</span><span class="p">,</span> <span class="n">w_sat</span><span class="p">)</span>

    <span class="c1"># Initial condition</span>
    <span class="n">w0</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># Initial seed island [m]</span>

    <span class="c1"># Time span</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span>
    <span class="n">tau_R</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">eta</span>
    <span class="n">t_span</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="n">tau_R</span><span class="p">)</span>
    <span class="n">t_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">500</span><span class="p">)</span>

    <span class="c1"># Solve</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">rutherford_equation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Delta_prime_func</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">Js</span><span class="p">,</span> <span class="n">rs</span><span class="p">),</span>
        <span class="n">t_span</span><span class="p">,</span>
        <span class="p">[</span><span class="n">w0</span><span class="p">],</span>
        <span class="n">t_eval</span><span class="o">=</span><span class="n">t_eval</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;RK45&#39;</span>
    <span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Panel 1: Island width vs time</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">tau_R</span><span class="p">,</span> <span class="n">w</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">w_sat</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Saturation (w_sat = </span><span class="si">{</span><span class="n">w_sat</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1"> cm)&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (œÑR)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Island width [cm]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnetic Island Growth (Rutherford Equation)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Panel 2: Growth rate vs width</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Compute dw/dt</span>
    <span class="n">dwdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rutherford_equation</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">Delta_prime_func</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">Js</span><span class="p">,</span> <span class="n">rs</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">ti</span><span class="p">,</span> <span class="n">wi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">dwdt</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">w_sat</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Island width [cm]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Growth rate dw/dt [cm/s]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Island Growth Rate vs Width&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span><span class="w"> </span><span class="nf">example_island_evolution</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulate magnetic island evolution&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Magnetic Island Evolution (Rutherford Equation) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Parameters</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="mf">1e-7</span>
    <span class="n">Delta0</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="n">w_sat</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span>
    <span class="n">tau_R</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">eta</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameters:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Resonant surface: rs = </span><span class="si">{</span><span class="n">rs</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Resistivity: Œ∑ = </span><span class="si">{</span><span class="n">eta</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> Œ©¬∑m&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Initial Œî&#39;: Œî0 = </span><span class="si">{</span><span class="n">Delta0</span><span class="si">}</span><span class="s2"> m^-1&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Saturation width: w_sat = </span><span class="si">{</span><span class="n">w_sat</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2"> cm&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Resistive time: œÑR = </span><span class="si">{</span><span class="n">tau_R</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>

    <span class="c1"># Initial island</span>
    <span class="n">w0</span> <span class="o">=</span> <span class="mf">0.001</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initial seed island: w0 = </span><span class="si">{</span><span class="n">w0</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2"> cm&quot;</span><span class="p">)</span>

    <span class="c1"># Time to reach half saturation</span>
    <span class="c1"># Approximate: w(t) ~ w_sat tanh(t/œÑ_growth)</span>
    <span class="c1"># œÑ_growth ~ œÑR / (rs Œî0)</span>
    <span class="n">tau_growth</span> <span class="o">=</span> <span class="n">tau_R</span> <span class="o">/</span> <span class="p">(</span><span class="n">rs</span> <span class="o">*</span> <span class="n">Delta0</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Growth timescale: œÑ_growth ~ </span><span class="si">{</span><span class="n">tau_growth</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (œÑ_growth / œÑR = </span><span class="si">{</span><span class="n">tau_growth</span><span class="o">/</span><span class="n">tau_R</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_island_evolution</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/tmp/island_evolution.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Island evolution plot saved to /tmp/island_evolution.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">example_island_evolution</span><span class="p">()</span>
</code></pre></div>

<h2 id="7-experimental-observations">7. Experimental Observations<a class="header-link" href="#7-experimental-observations" title="Permanent link">&para;</a></h2>
<h3 id="71-sawteeth-in-tokamaks">7.1 Sawteeth in Tokamaks<a class="header-link" href="#71-sawteeth-in-tokamaks" title="Permanent link">&para;</a></h3>
<p><strong>Sawtooth oscillations</strong> are periodic crashes of central temperature caused by internal kink (m=1, n=1):</p>
<ul>
<li><strong>Ramp phase</strong>: Central heating ‚Üí $T_0$ rises, $q(0)$ drops</li>
<li><strong>Crash</strong>: When $q(0) < 1$, internal kink triggers ‚Üí fast reconnection</li>
<li><strong>Flattening</strong>: Temperature and current profiles flatten ‚Üí $q(0)$ rises above 1</li>
<li><strong>Repeat</strong>: Cycle period typically 10-100 ms</li>
</ul>
<p><strong>Impact</strong>:
- Beneficial: Prevents impurity accumulation, limits central pressure
- Detrimental: Triggers NTMs, limits fusion performance</p>
<h3 id="72-disruptions">7.2 Disruptions<a class="header-link" href="#72-disruptions" title="Permanent link">&para;</a></h3>
<p><strong>Major disruptions</strong> are catastrophic events caused by large-scale MHD instabilities:</p>
<p><strong>Thermal quench</strong> (ms timescale):
- Loss of confinement
- Temperature collapses
- Runaway electron generation</p>
<p><strong>Current quench</strong> (ms timescale):
- Plasma current decays
- Large induced voltages in structures
- Mechanical forces on vessel</p>
<p><strong>Mitigation strategies</strong> (ITER):
- Massive gas injection
- Shattered pellet injection
- Disruption prediction and avoidance</p>
<h3 id="73-neoclassical-tearing-modes">7.3 Neoclassical Tearing Modes<a class="header-link" href="#73-neoclassical-tearing-modes" title="Permanent link">&para;</a></h3>
<p>Observed in high-beta tokamak plasmas:
- Triggered by sawteeth or ELMs
- Grow to large islands (10-20% of minor radius)
- Degrade confinement
- Can lead to disruptions</p>
<p><strong>Control methods</strong>:
- ECCD at island O-point
- Rotation control
- Beta reduction</p>
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this lesson, we have studied current-driven MHD instabilities:</p>
<ol>
<li>
<p><strong>Kink Instability</strong>: External kink ($q(a) < 1$) bends entire column; internal kink ($q(0) < 1$) causes sawteeth. Stabilized by sufficient axial field ($q > 1$).</p>
</li>
<li>
<p><strong>Sausage Mode</strong>: m=0 pinching/expansion, always unstable without $B_z$. Stabilized when $B_z > B_\theta$.</p>
</li>
<li>
<p><strong>Tearing Mode</strong>: Resistive reconnection at rational surfaces ($q = m/n$). Stability determined by Œî' parameter. Growth rate $\gamma \propto \eta^{3/5}(\Delta')^{4/5}$.</p>
</li>
<li>
<p><strong>Magnetic Islands</strong>: Formed by tearing modes. Width evolution governed by Rutherford equation. Saturate when Œî'(w) ‚Üí 0.</p>
</li>
<li>
<p><strong>Resistive Wall Mode</strong>: Slow-growing kink mode on resistive wall timescale. Can be stabilized by feedback control.</p>
</li>
<li>
<p><strong>Neoclassical Tearing Mode</strong>: Metastable islands driven by missing bootstrap current. Require seed island to grow. Major concern for high-beta operation.</p>
</li>
<li>
<p><strong>Numerical Tools</strong>: Growth rate calculations, Œî' estimation, island evolution simulations.</p>
</li>
</ol>
<p>These instabilities fundamentally limit tokamak performance and motivate advanced control strategies, profile optimization, and disruption mitigation systems for ITER and future reactors.</p>
<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-external-kink-stability">Problem 1: External Kink Stability<a class="header-link" href="#problem-1-external-kink-stability" title="Permanent link">&para;</a></h3>
<p>A cylindrical Z-pinch has:
- Radius $a = 0.1$ m
- Current $I = 500$ kA
- Density $\rho = 10^{-6}$ kg/m¬≥
- No axial field initially</p>
<p><strong>(a)</strong> Compute the azimuthal field at the edge $B_\theta(a)$.</p>
<p><strong>(b)</strong> Calculate the Alfv√©n speed $v_A = B_\theta/\sqrt{\mu_0\rho}$.</p>
<p><strong>(c)</strong> Since $B_z = 0$, what is $q(a)$?</p>
<p><strong>(d)</strong> Is the configuration stable or unstable to external kink?</p>
<p><strong>(e)</strong> If unstable, compute the growth rate $\gamma$.</p>
<p><strong>(f)</strong> What minimum $B_z$ is required to stabilize the kink ($q(a) > 1$)?</p>
<h3 id="problem-2-sawtooth-period">Problem 2: Sawtooth Period<a class="header-link" href="#problem-2-sawtooth-period" title="Permanent link">&para;</a></h3>
<p>A tokamak has:
- Central temperature $T_0(t=0) = 5$ keV
- Heating power $P = 10$ MW
- Central volume $V_c \approx 1$ m¬≥
- Particle density $n = 10^{20}$ m$^{-3}$</p>
<p>Assume central temperature rises linearly until $q(0) = 0.95$ triggers a sawtooth crash.</p>
<p><strong>(a)</strong> Estimate the heating rate $dT_0/dt = P/(3nV_c k_B)$.</p>
<p><strong>(b)</strong> If sawtooth crashes when $T_0 = 6$ keV, compute the time to crash.</p>
<p><strong>(c)</strong> After crash, $T_0$ drops to 4 keV. What is the sawtooth period?</p>
<p><strong>(d)</strong> How much energy is redistributed per crash?</p>
<p><strong>(e)</strong> Compare the crash timescale (~ Alfv√©n time $\tau_A \sim$ 1 Œºs) to the ramp timescale.</p>
<h3 id="problem-3-tearing-mode">Problem 3: Tearing Mode Œî'<a class="header-link" href="#problem-3-tearing-mode" title="Permanent link">&para;</a></h3>
<p>For a cylindrical plasma with current density:</p>
<p>$$
J_z(r) = J_0\left(1 - \frac{r^2}{a^2}\right)
$$</p>
<p>The safety factor is:</p>
<p>$$
q(r) = q_0\frac{1 + (r/a)^2}{1 - (r^2/a^2)} \quad (q_0 = q(0))
$$</p>
<p><strong>(a)</strong> Find the location $r_s$ where $q(r_s) = 2$ (assume $q_0 = 1$).</p>
<p><strong>(b)</strong> Compute $q'(r_s)$ and $q''(r_s)$ numerically or analytically.</p>
<p><strong>(c)</strong> Estimate $\Delta' \approx \frac{2}{r_s} + \frac{q''}{q'}$ at $r_s$.</p>
<p><strong>(d)</strong> Is the $m=2, n=1$ mode stable or unstable?</p>
<p><strong>(e)</strong> If $\eta = 10^{-7}$ Œ©¬∑m and $a = 0.5$ m, estimate the growth rate.</p>
<h3 id="problem-4-magnetic-island-width">Problem 4: Magnetic Island Width<a class="header-link" href="#problem-4-magnetic-island-width" title="Permanent link">&para;</a></h3>
<p>A tearing mode has reconnected flux $\delta\psi = 10^{-3}$ Wb at resonant surface $r_s = 0.3$ m.</p>
<p>The equilibrium poloidal field at $r_s$ is $B_\theta(r_s) = 0.4$ T, and mode number $m=2$.</p>
<p><strong>(a)</strong> Compute the island width:
$$
w = 4\sqrt{\frac{\delta\psi r_s}{m B_\theta(r_s)}}
$$</p>
<p><strong>(b)</strong> If the island grows to $w = 5$ cm, what is the new $\delta\psi$?</p>
<p><strong>(c)</strong> Estimate the flattened region in the pressure profile (approximately $\pm w/2$ around $r_s$).</p>
<p><strong>(d)</strong> If $dp/dr = -10^6$ Pa/m, how much pressure gradient is lost due to flattening?</p>
<p><strong>(e)</strong> Discuss the impact on bootstrap current and NTM drive.</p>
<h3 id="problem-5-resistive-wall-mode">Problem 5: Resistive Wall Mode<a class="header-link" href="#problem-5-resistive-wall-mode" title="Permanent link">&para;</a></h3>
<p>A tokamak has:
- Plasma minor radius $a = 1$ m
- Resistive wall at $r_w = 1.2$ m
- Wall thickness $d = 5$ cm
- Wall conductivity $\sigma = 5\times 10^7$ S/m (copper)</p>
<p><strong>(a)</strong> Compute the wall time constant $\tau_w = \mu_0\sigma d r_w$.</p>
<p><strong>(b)</strong> Estimate the RWM growth rate:
$$
\gamma_{RWM} \approx \frac{1}{\tau_w}\frac{r_w - a}{r_w}
$$</p>
<p><strong>(c)</strong> If feedback control has response time $\tau_{fb} = 10$ ms, can it stabilize the RWM?</p>
<p><strong>(d)</strong> What is the required bandwidth for the feedback system?</p>
<p><strong>(e)</strong> If the wall were ideal (perfect conductor), what would happen to the external kink?</p>
<hr />
<p><strong>Previous</strong>: <a href="./03_Pressure_Driven_Instabilities.md">Pressure-Driven Instabilities</a> | <strong>Next</strong>: <a href="./05_Reconnection_Theory.md">Reconnection Theory</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/MHD/03_Pressure_Driven_Instabilities.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">3. Pressure-Driven Instabilities</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/MHD/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/MHD/05_Reconnection_Theory.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">5. Magnetic Reconnection Theory</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}