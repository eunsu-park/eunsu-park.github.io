{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16. Relativistic MHD - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/MHD/">MHD</a>
    <span class="separator">/</span>
    <span class="current">16. Relativistic MHD</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>16. Relativistic MHD</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/MHD/15_2D_MHD_Solver.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">15. 2D MHD Solver</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/MHD/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/MHD/17_Spectral_Methods.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">17. Spectral and Advanced Methods</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-introduction-to-relativistic-mhd">1. Introduction to Relativistic MHD</a><ul>
<li><a href="#11-when-is-relativistic-mhd-necessary">1.1 When is Relativistic MHD Necessary?</a></li>
<li><a href="#12-key-differences-from-non-relativistic-mhd">1.2 Key Differences from Non-Relativistic MHD</a></li>
</ul>
</li>
<li><a href="#2-special-relativistic-mhd-srmhd">2. Special Relativistic MHD (SRMHD)</a><ul>
<li><a href="#21-covariant-formulation">2.1 Covariant Formulation</a></li>
<li><a href="#22-maxwell-equations-in-covariant-form">2.2 Maxwell Equations in Covariant Form</a></li>
<li><a href="#23-stress-energy-tensor">2.3 Stress-Energy Tensor</a></li>
<li><a href="#24-conservation-laws">2.4 Conservation Laws</a></li>
</ul>
</li>
<li><a href="#3-ideal-srmhd">3. Ideal SRMHD</a><ul>
<li><a href="#31-ideal-condition">3.1 Ideal Condition</a></li>
<li><a href="#32-31-decomposition">3.2 3+1 Decomposition</a></li>
<li><a href="#33-primitive-variable-recovery">3.3 Primitive Variable Recovery</a></li>
</ul>
</li>
<li><a href="#4-wave-structure-in-srmhd">4. Wave Structure in SRMHD</a><ul>
<li><a href="#41-eigenstructure">4.1 Eigenstructure</a></li>
<li><a href="#42-relativistic-riemann-problem">4.2 Relativistic Riemann Problem</a></li>
</ul>
</li>
<li><a href="#5-applications-of-srmhd">5. Applications of SRMHD</a><ul>
<li><a href="#51-relativistic-jets">5.1 Relativistic Jets</a></li>
<li><a href="#52-pulsar-magnetospheres">5.2 Pulsar Magnetospheres</a></li>
<li><a href="#53-black-hole-accretion">5.3 Black Hole Accretion</a></li>
</ul>
</li>
<li><a href="#6-general-relativistic-mhd-grmhd">6. General Relativistic MHD (GRMHD)</a><ul>
<li><a href="#61-curved-spacetime-formulation">6.1 Curved Spacetime Formulation</a></li>
<li><a href="#62-harm-code-formulation">6.2 HARM Code Formulation</a></li>
<li><a href="#63-horizon-boundary-conditions">6.3 Horizon Boundary Conditions</a></li>
</ul>
</li>
<li><a href="#7-numerical-methods-for-srmhd">7. Numerical Methods for SRMHD</a><ul>
<li><a href="#71-godunov-type-schemes">7.1 Godunov-Type Schemes</a></li>
<li><a href="#72-adaptive-timestep">7.2 Adaptive Timestep</a></li>
<li><a href="#73-floors-and-ceilings">7.3 Floors and Ceilings</a></li>
</ul>
</li>
<li><a href="#8-python-implementation-1d-srmhd-shock-tube">8. Python Implementation: 1D SRMHD Shock Tube</a><ul>
<li><a href="#81-problem-setup">8.1 Problem Setup</a></li>
<li><a href="#82-code-structure">8.2 Code Structure</a></li>
<li><a href="#83-expected-output">8.3 Expected Output</a></li>
</ul>
</li>
<li><a href="#9-relativistic-alfven-speed">9. Relativistic Alfv√©n Speed</a><ul>
<li><a href="#91-comparison-non-relativistic-vs-relativistic">9.1 Comparison: Non-Relativistic vs Relativistic</a></li>
</ul>
</li>
<li><a href="#10-light-cylinder-visualization">10. Light Cylinder Visualization</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#practice-problems">Practice Problems</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="16-relativistic-mhd">16. Relativistic MHD<a class="header-link" href="#16-relativistic-mhd" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this lesson, you will be able to:</p>
<ul>
<li>Formulate the equations of special relativistic MHD (SRMHD) using covariant notation</li>
<li>Understand the stress-energy tensor and electromagnetic field tensor in SRMHD</li>
<li>Derive the 3+1 decomposition of SRMHD equations for numerical implementation</li>
<li>Solve the relativistic primitive variable recovery problem</li>
<li>Analyze the wave structure of relativistic MHD (fast, slow, Alfv√©n)</li>
<li>Apply SRMHD to relativistic jets, pulsar magnetospheres, and black hole accretion</li>
<li>Implement a 1D SRMHD shock tube solver in Python</li>
<li>Understand the basics of general relativistic MHD (GRMHD) and its applications</li>
</ul>
<hr />
<h2 id="1-introduction-to-relativistic-mhd">1. Introduction to Relativistic MHD<a class="header-link" href="#1-introduction-to-relativistic-mhd" title="Permanent link">&para;</a></h2>
<h3 id="11-when-is-relativistic-mhd-necessary">1.1 When is Relativistic MHD Necessary?<a class="header-link" href="#11-when-is-relativistic-mhd-necessary" title="Permanent link">&para;</a></h3>
<p>Non-relativistic MHD assumes $v \ll c$ and neglects:
- Lorentz contraction of the electromagnetic field
- Displacement current in Maxwell equations
- Relativistic mass-energy equivalence</p>
<p>Relativistic MHD (RMHD) is essential when:</p>
<div class="highlight"><pre><span></span><code><span class="err">‚Ä¢</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="n">velocities</span><span class="w"> </span><span class="n">approach</span><span class="w"> </span><span class="nl">c:</span><span class="w"> </span><span class="n">v</span><span class="o">/</span><span class="n">c</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mf">0.1</span><span class="o">-</span><span class="mh">1</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Relativistic</span><span class="w"> </span><span class="nl">jets:</span><span class="w"> </span><span class="n">AGN</span><span class="p">,</span><span class="w"> </span><span class="n">GRBs</span><span class="w"> </span><span class="p">(</span><span class="err">Œì</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mh">10</span><span class="o">-</span><span class="mh">100</span><span class="p">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Pulsar</span><span class="w"> </span><span class="n">winds</span><span class="w"> </span><span class="p">(</span><span class="err">Œì</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mh">10</span><span class="err">‚Å¥</span><span class="o">-</span><span class="mh">10</span><span class="err">‚Å∂</span><span class="p">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Accretion</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="n">regions</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mf">0.3</span><span class="n">c</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">ISCO</span><span class="p">)</span>

<span class="err">‚Ä¢</span><span class="w"> </span><span class="n">Magnetic</span><span class="w"> </span><span class="n">pressure</span><span class="w"> </span><span class="nl">dominates:</span><span class="w"> </span><span class="err">œÉ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B¬≤</span><span class="o">/</span><span class="p">(</span><span class="mh">4</span><span class="err">œÄœÅ</span><span class="n">c¬≤</span><span class="p">)</span><span class="w"> </span><span class="err">‚â´</span><span class="w"> </span><span class="mh">1</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Magnetar</span><span class="w"> </span><span class="nl">magnetospheres:</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mh">10</span><span class="err">¬π‚Åµ</span><span class="w"> </span><span class="n">G</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Pulsar</span><span class="w"> </span><span class="n">polar</span><span class="w"> </span><span class="n">caps</span>

<span class="err">‚Ä¢</span><span class="w"> </span><span class="n">Strong</span><span class="w"> </span><span class="n">gravitational</span><span class="w"> </span><span class="nl">fields:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Black</span><span class="w"> </span><span class="n">hole</span><span class="w"> </span><span class="n">accretion</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mh">2</span><span class="o">-</span><span class="mh">10</span><span class="w"> </span><span class="n">GM</span><span class="o">/</span><span class="n">c¬≤</span><span class="p">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Neutron</span><span class="w"> </span><span class="n">star</span><span class="w"> </span><span class="n">mergers</span>
</code></pre></div>

<h3 id="12-key-differences-from-non-relativistic-mhd">1.2 Key Differences from Non-Relativistic MHD<a class="header-link" href="#12-key-differences-from-non-relativistic-mhd" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Non-Relativistic</th>
<th>Relativistic</th>
</tr>
</thead>
<tbody>
<tr>
<td>Electric field</td>
<td>$\mathbf{E} = -\mathbf{v} \times \mathbf{B}/c$</td>
<td>$\mathbf{E}$ is independent dynamical variable</td>
</tr>
<tr>
<td>Displacement current</td>
<td>Neglected</td>
<td>$\partial \mathbf{E}/\partial t$ included</td>
</tr>
<tr>
<td>Conservation laws</td>
<td>Mass, momentum, energy separate</td>
<td>Unified in $\partial_\mu T^{\mu\nu} = 0$</td>
</tr>
<tr>
<td>Wave speeds</td>
<td>Independent of $v$</td>
<td>Modified by Lorentz factor $W$</td>
</tr>
<tr>
<td>Primitive recovery</td>
<td>Algebraic</td>
<td>Implicit rootfinding required</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-special-relativistic-mhd-srmhd">2. Special Relativistic MHD (SRMHD)<a class="header-link" href="#2-special-relativistic-mhd-srmhd" title="Permanent link">&para;</a></h2>
<h3 id="21-covariant-formulation">2.1 Covariant Formulation<a class="header-link" href="#21-covariant-formulation" title="Permanent link">&para;</a></h3>
<p><strong>Metric and 4-vectors:</strong></p>
<p>Minkowski metric (signature $-,+,+,+$):
$$
\eta_{\mu\nu} = \text{diag}(-1, 1, 1, 1)
$$</p>
<p>4-velocity:
$$
u^\mu = W(c, \mathbf{v}), \quad u^\mu u_\mu = -c^2
$$
where $W = 1/\sqrt{1 - v^2/c^2}$ is the Lorentz factor.</p>
<p><strong>Electromagnetic field tensor:</strong>
$$
F^{\mu\nu} = \begin{pmatrix}
0 & -E_x/c & -E_y/c & -E_z/c \\
E_x/c & 0 & -B_z & B_y \\
E_y/c & B_z & 0 & -B_x \\
E_z/c & -B_y & B_x & 0
\end{pmatrix}
$$</p>
<p>Dual tensor:
$$
F^{*\mu\nu} = \frac{1}{2} \epsilon^{\mu\nu\alpha\beta} F_{\alpha\beta}
$$
where $\epsilon^{\mu\nu\alpha\beta}$ is the Levi-Civita tensor.</p>
<h3 id="22-maxwell-equations-in-covariant-form">2.2 Maxwell Equations in Covariant Form<a class="header-link" href="#22-maxwell-equations-in-covariant-form" title="Permanent link">&para;</a></h3>
<p><strong>Source-free Maxwell equations:</strong>
$$
\partial_\mu F^{*\mu\nu} = 0 \quad \Rightarrow \quad \nabla \cdot \mathbf{B} = 0, \quad \nabla \times \mathbf{E} + \frac{\partial \mathbf{B}}{\partial t} = 0
$$</p>
<p><strong>With currents (for resistive RMHD):</strong>
$$
\partial_\mu F^{\mu\nu} = \frac{4\pi}{c} J^\nu
$$
where $J^\mu = (c\rho_e, \mathbf{J})$ is the 4-current.</p>
<h3 id="23-stress-energy-tensor">2.3 Stress-Energy Tensor<a class="header-link" href="#23-stress-energy-tensor" title="Permanent link">&para;</a></h3>
<p><strong>Total stress-energy tensor:</strong>
$$
T^{\mu\nu} = T^{\mu\nu}_{\text{fluid}} + T^{\mu\nu}_{\text{EM}}
$$</p>
<p><strong>Fluid contribution:</strong>
$$
T^{\mu\nu}_{\text{fluid}} = (\rho h + u_m) u^\mu u^\nu + (p + p_m) \eta^{\mu\nu}
$$
where:
- $\rho$ = rest mass density
- $h = 1 + \epsilon + p/(\rho c^2)$ = specific enthalpy
- $\epsilon$ = specific internal energy
- $u_m = b^2/(8\pi)$ = magnetic energy density in comoving frame
- $p_m = b^2/(8\pi)$ = magnetic pressure (isotropic part)</p>
<p><strong>Electromagnetic contribution:</strong>
$$
T^{\mu\nu}_{\text{EM}} = \frac{1}{4\pi} \left( F^{\mu\alpha} F^\nu_{\ \alpha} - \frac{1}{4} \eta^{\mu\nu} F^{\alpha\beta} F_{\alpha\beta} \right)
$$</p>
<p><strong>4-magnetic field (comoving frame):</strong>
$$
b^\mu = \frac{1}{c} F^{*\mu\nu} u_\nu = W(\mathbf{v} \cdot \mathbf{B}/c, \mathbf{B}/W + W(\mathbf{v} \cdot \mathbf{B})\mathbf{v}/c^2)
$$</p>
<p>Satisfies $b^\mu u_\mu = 0$ (orthogonality) and $b^2 = b^\mu b_\mu = (B^2 + (v \times B)^2/c^2)/W^2$.</p>
<h3 id="24-conservation-laws">2.4 Conservation Laws<a class="header-link" href="#24-conservation-laws" title="Permanent link">&para;</a></h3>
<p><strong>Energy-momentum conservation:</strong>
$$
\partial_\mu T^{\mu\nu} = 0
$$</p>
<p>Expands to:
- $\nu = 0$: energy conservation
- $\nu = i$: momentum conservation</p>
<p><strong>Mass conservation:</strong>
$$
\partial_\mu (\rho u^\mu) = 0
$$</p>
<hr />
<h2 id="3-ideal-srmhd">3. Ideal SRMHD<a class="header-link" href="#3-ideal-srmhd" title="Permanent link">&para;</a></h2>
<h3 id="31-ideal-condition">3.1 Ideal Condition<a class="header-link" href="#31-ideal-condition" title="Permanent link">&para;</a></h3>
<p>In ideal SRMHD, the electric field vanishes in the comoving frame:
$$
F^{\mu\nu} u_\nu = 0
$$</p>
<p>This gives:
$$
\mathbf{E} = -\frac{\mathbf{v} \times \mathbf{B}}{c} \frac{1}{1 - v^2/c^2}
$$</p>
<p>The magnetic field is <strong>frozen into the plasma</strong> (relativistic version).</p>
<h3 id="32-31-decomposition">3.2 3+1 Decomposition<a class="header-link" href="#32-31-decomposition" title="Permanent link">&para;</a></h3>
<p>For numerical implementation, we decompose into lab-frame (3+1) variables.</p>
<p><strong>Conserved variables:</strong>
$$
\mathbf{U} = \begin{pmatrix} D \\ \mathbf{S} \\ \tau \\ \mathbf{B} \end{pmatrix}
$$
where:
- $D = \rho W$ (conserved density)
- $\mathbf{S} = (\rho h + b^2) W^2 \mathbf{v} - (\mathbf{v} \cdot \mathbf{B})\mathbf{B}/(4\pi)$ (momentum density)
- $\tau = (\rho h + b^2) W^2 - p - b^2/2 - D c^2$ (energy density)
- $\mathbf{B}$ (magnetic field)</p>
<p><strong>Flux functions:</strong>
$$
\mathbf{F}(\mathbf{U}) = \begin{pmatrix}
D v_x \\
S_x v_x + p_{\text{tot}} - B_x^2/(4\pi) \\
S_y v_x - B_x B_y/(4\pi) \\
S_z v_x - B_x B_z/(4\pi) \\
\tau v_x + p_{\text{tot}} v_x - (\mathbf{v} \cdot \mathbf{B}) B_x/(4\pi) \\
0 \\
B_y v_x - B_x v_y \\
B_z v_x - B_x v_z
\end{pmatrix}
$$
where $p_{\text{tot}} = p + B^2/(8\pi)$.</p>
<p><strong>Conservation form:</strong>
$$
\frac{\partial \mathbf{U}}{\partial t} + \nabla \cdot \mathbf{F}(\mathbf{U}) = 0
$$</p>
<h3 id="33-primitive-variable-recovery">3.3 Primitive Variable Recovery<a class="header-link" href="#33-primitive-variable-recovery" title="Permanent link">&para;</a></h3>
<p><strong>The challenge:</strong> Given conserved variables $(\mathbf{U})$, recover primitive variables $(\rho, \mathbf{v}, p, \mathbf{B})$.</p>
<p><strong>Algebraic constraints:</strong>
$$
\begin{aligned}
D &= \rho W \\
\mathbf{B} &= \text{(known)} \\
\mathbf{S} &= (\rho h + b^2) W^2 \mathbf{v} - (\mathbf{v} \cdot \mathbf{B})\mathbf{B}/(4\pi) \\
\tau &= (\rho h + b^2) W^2 - p - b^2/2 - D c^2
\end{aligned}
$$</p>
<p><strong>Problem:</strong> Nonlinear system coupling $W$, $p$, $\rho$, $\mathbf{v}$.</p>
<p><strong>Standard approach (2D Newton-Raphson):</strong></p>
<ol>
<li>Choose unknowns: $z = W$ and $w = p$</li>
<li>Invert:
   $$
   v^2 = 1 - \frac{1}{z^2}
   $$</li>
<li>From $\mathbf{S}$ and momentum equation, solve for $\rho$, $h$</li>
<li>Use EOS: $p = p(\rho, \epsilon)$</li>
<li>Iterate until convergence</li>
</ol>
<p><strong>Alternative (1D rootfinding):</strong></p>
<p>Use pressure $p$ as independent variable, solve:
$$
f(p) = \tau + p - \frac{(\mathbf{S} \cdot \mathbf{B})^2}{(\tau + p + D c^2 + B^2/(4\pi))^2 - (\mathbf{S}^2 + (\mathbf{S} \cdot \mathbf{B})^2/(B^2))} - D c^2 = 0
$$</p>
<p><strong>Challenges:</strong>
- Multiple roots possible
- Numerical stiffness for $W \gg 1$
- Breakdown near vacuum ($\rho \to 0$)</p>
<p><strong>Best practices:</strong>
- Use robust rootfinder (Brent's method)
- Good initial guess (from previous timestep)
- Floor values for $\rho$, $p$</p>
<hr />
<h2 id="4-wave-structure-in-srmhd">4. Wave Structure in SRMHD<a class="header-link" href="#4-wave-structure-in-srmhd" title="Permanent link">&para;</a></h2>
<h3 id="41-eigenstructure">4.1 Eigenstructure<a class="header-link" href="#41-eigenstructure" title="Permanent link">&para;</a></h3>
<p>The SRMHD system has <strong>7 waves</strong> (1D):
$$
\lambda_{1,7} = \alpha_{\pm}^{\text{fast}}, \quad \lambda_{2,6} = \alpha_{\pm}^{\text{slow}}, \quad \lambda_{3,5} = \alpha_{\pm}^{\text{Alf}}, \quad \lambda_4 = v_x
$$</p>
<p><strong>Relativistic wave speeds:</strong></p>
<p>Define:
$$
c_s^2 = \frac{\partial p}{\partial \rho h} \quad \text{(relativistic sound speed)}
$$
$$
v_A^2 = \frac{B^2/(4\pi)}{\rho h + B^2/(4\pi)} \quad \text{(relativistic Alfv√©n speed)}
$$</p>
<p>Fast magnetosonic speed:
$$
\alpha_{\pm}^{\text{fast}} = \frac{v_x \pm c_{\text{fast}}}{1 \pm v_x c_{\text{fast}}/c^2}
$$
where:
$$
c_{\text{fast}}^2 = \frac{c_s^2 + v_A^2 - c_s^2 v_A^2}{1 - c_s^2 v_A^2}
$$</p>
<p>Slow magnetosonic and Alfv√©n speeds defined similarly with modified dispersion relation.</p>
<p><strong>Key differences from non-relativistic:</strong>
- All wave speeds &lt; $c$ (causality)
- Lorentz factor $W$ enters dispersion relations
- For $v \to c$, waves cannot outrun flow (bunching)</p>
<h3 id="42-relativistic-riemann-problem">4.2 Relativistic Riemann Problem<a class="header-link" href="#42-relativistic-riemann-problem" title="Permanent link">&para;</a></h3>
<p><strong>HLLC solver for SRMHD:</strong></p>
<p>Estimate wave speeds:
$$
\lambda_L = \min(\lambda_L^{\text{fast}}, \lambda_R^{\text{fast}}), \quad \lambda_R = \max(\lambda_L^{\text{fast}}, \lambda_R^{\text{fast}})
$$</p>
<p>Contact wave speed $\lambda_*$ from momentum jump conditions.</p>
<p><strong>HLLD solver:</strong></p>
<p>Includes all 5 waves (fast, Alfv√©n, contact). More accurate but complex.</p>
<p><strong>Relativistic Brio-Wu shock tube:</strong></p>
<p>Initial conditions:
$$
(\rho, v_x, v_y, v_z, p, B_y) = \begin{cases}
(1, 0, 0, 0, 1, 1) & x < 0.5 \\
(0.125, 0, 0, 0, 0.1, -1) & x > 0.5
\end{cases}
$$
with $B_x = 0.5$ constant.</p>
<p>Expected structure: left fast ‚Üí compound ‚Üí contact ‚Üí slow ‚Üí right fast.</p>
<hr />
<h2 id="5-applications-of-srmhd">5. Applications of SRMHD<a class="header-link" href="#5-applications-of-srmhd" title="Permanent link">&para;</a></h2>
<h3 id="51-relativistic-jets">5.1 Relativistic Jets<a class="header-link" href="#51-relativistic-jets" title="Permanent link">&para;</a></h3>
<p><strong>Astrophysical context:</strong>
- Active Galactic Nuclei (AGN): jets from supermassive black holes (Lorentz factors $\Gamma \sim 10-30$)
- Gamma-Ray Bursts (GRBs): jets from stellar-mass black holes ($\Gamma \sim 100-1000$)
- Microquasars: jets from X-ray binaries ($\Gamma \sim 2-10$)</p>
<p><strong>Physics:</strong>
- <strong>Acceleration:</strong> magnetic pressure converts to kinetic energy ($\sigma \to 0$)
- <strong>Collimation:</strong> magnetic hoop stress confines jet
- <strong>Instabilities:</strong> Kelvin-Helmholtz (jet-ambient interface), current-driven kink</p>
<p><strong>Light cylinder:</strong></p>
<p>For rotating magnetosphere with angular velocity $\Omega$:
$$
R_L = \frac{c}{\Omega}
$$</p>
<p>Inside $R_L$: corotation possible. Outside: magnetic field opens, wind launched.</p>
<p><strong>Numerical challenges:</strong>
- Large Lorentz factors: $W \sim 100$ ‚Üí stiff primitive recovery
- Magnetization parameter $\sigma = B^2/(4\pi \rho h W^2)$ ranges over decades
- Grid-scale instabilities if $\sigma \gg 1$</p>
<h3 id="52-pulsar-magnetospheres">5.2 Pulsar Magnetospheres<a class="header-link" href="#52-pulsar-magnetospheres" title="Permanent link">&para;</a></h3>
<p><strong>Oblique rotator:</strong>
- Rotating magnetic dipole: $\mathbf{m}$ inclined at angle $\alpha$ to $\boldsymbol{\Omega}$
- Open field lines: $\theta < \theta_{\text{pc}}$ (polar cap angle)
- Closed field lines: corotating plasma</p>
<p><strong>Force-free electrodynamics (FFE):</strong></p>
<p>When $\sigma \gg 1$, plasma inertia negligible:
$$
\rho_e \mathbf{E} + \frac{\mathbf{J} \times \mathbf{B}}{c} = 0, \quad \mathbf{E} \cdot \mathbf{B} = 0
$$</p>
<p>Solve for $\mathbf{E}$, $\mathbf{B}$ given boundary conditions (neutron star surface, infinity).</p>
<p><strong>Pulsar wind:</strong>
- Particles accelerated along open field lines
- Magnetization $\sigma \sim 10^4$ at light cylinder
- Dissipation at termination shock (pulsar wind nebula)</p>
<p><strong>SRMHD vs FFE:</strong>
- FFE: valid for $\sigma \gg 1$, no dissipation
- SRMHD: includes inertia, reconnection, particle heating</p>
<h3 id="53-black-hole-accretion">5.3 Black Hole Accretion<a class="header-link" href="#53-black-hole-accretion" title="Permanent link">&para;</a></h3>
<p><strong>Innermost Stable Circular Orbit (ISCO):</strong>
- Schwarzschild: $r_{\text{ISCO}} = 6 GM/c^2$
- Kerr (extreme): $r_{\text{ISCO}} = GM/c^2$ (prograde)</p>
<p>Orbital velocity at ISCO:
$$
v_{\text{ISCO}} \sim 0.5c \quad \text{(Schwarzschild)} \quad \text{to} \quad 0.7c \quad \text{(Kerr, prograde)}
$$</p>
<p><strong>Jet launching:</strong></p>
<p>Blandford-Znajek mechanism (for spinning black hole):
- Magnetic field threads horizon
- Frame dragging: $\Omega_H$ (horizon angular velocity)
- Poynting flux extracted: $L_{\text{BZ}} \sim \Omega_H^2 B_H^2 r_H^4 / c$</p>
<p>Requires <strong>general relativistic MHD</strong> (GRMHD).</p>
<p><strong>Magnetically Arrested Disk (MAD):</strong></p>
<p>When magnetic flux accumulates:
$$
\phi \sim \sqrt{\dot{M} r_g c} \quad \Rightarrow \quad \text{magnetically dominated}
$$</p>
<p>Leads to:
- Suppressed accretion (flux barrier)
- Enhanced jet power
- Time-variable flow</p>
<hr />
<h2 id="6-general-relativistic-mhd-grmhd">6. General Relativistic MHD (GRMHD)<a class="header-link" href="#6-general-relativistic-mhd-grmhd" title="Permanent link">&para;</a></h2>
<h3 id="61-curved-spacetime-formulation">6.1 Curved Spacetime Formulation<a class="header-link" href="#61-curved-spacetime-formulation" title="Permanent link">&para;</a></h3>
<p><strong>Kerr metric (Boyer-Lindquist coordinates):</strong>
$$
ds^2 = -\alpha^2 dt^2 + \gamma_{ij} (dx^i + \beta^i dt)(dx^j + \beta^j dt)
$$
where:
- $\alpha$ = lapse function
- $\beta^i$ = shift vector
- $\gamma_{ij}$ = spatial metric</p>
<p><strong>Stress-energy tensor:</strong>
$$
\nabla_\mu T^{\mu\nu} = 0
$$
where $\nabla_\mu$ is the covariant derivative (includes Christoffel symbols).</p>
<p><strong>3+1 ADM form:</strong></p>
<p>$$
\frac{\partial \mathbf{U}}{\partial t} + \frac{\partial \mathbf{F}^i}{\partial x^i} = \mathbf{S}
$$</p>
<p>where $\mathbf{S}$ includes metric source terms (spacetime curvature).</p>
<h3 id="62-harm-code-formulation">6.2 HARM Code Formulation<a class="header-link" href="#62-harm-code-formulation" title="Permanent link">&para;</a></h3>
<p>The <strong>HARM</strong> (High Accuracy Relativistic Magnetohydrodynamics) code uses:</p>
<ul>
<li>Conservative variables: $\sqrt{-g} (\rho u^t, T^t_{\ i}, \sqrt{-g} B^i)$</li>
<li>Flux-conservative scheme</li>
<li>Flux-CT for divergence-free $\mathbf{B}$</li>
<li>Primitive recovery in curved spacetime</li>
</ul>
<p><strong>Metric:</strong>
Modified Kerr-Schild coordinates (horizon-penetrating).</p>
<p><strong>Applications:</strong>
- Black hole accretion disks (Sgr A*, M87)
- Neutron star mergers
- Jet launching simulations</p>
<h3 id="63-horizon-boundary-conditions">6.3 Horizon Boundary Conditions<a class="header-link" href="#63-horizon-boundary-conditions" title="Permanent link">&para;</a></h3>
<p><strong>Excision:</strong>
- Remove points inside horizon (causally disconnected)
- Outflow boundary condition</p>
<p><strong>Inflow equilibrium:</strong>
- Force matter to fall inward at inflow rate
- Maintain stationary disk profile</p>
<hr />
<h2 id="7-numerical-methods-for-srmhd">7. Numerical Methods for SRMHD<a class="header-link" href="#7-numerical-methods-for-srmhd" title="Permanent link">&para;</a></h2>
<h3 id="71-godunov-type-schemes">7.1 Godunov-Type Schemes<a class="header-link" href="#71-godunov-type-schemes" title="Permanent link">&para;</a></h3>
<p><strong>HLLC flux:</strong></p>
<p>$$
\mathbf{F}_{\text{HLLC}} = \begin{cases}
\mathbf{F}_L & \lambda_L \geq 0 \\
\mathbf{F}_L^* & \lambda_L < 0 \leq \lambda_* \\
\mathbf{F}_R^* & \lambda_* < 0 \leq \lambda_R \\
\mathbf{F}_R & \lambda_R < 0
\end{cases}
$$</p>
<p>Star states $\mathbf{U}_L^*$, $\mathbf{U}_R^*$ from Rankine-Hugoniot jump conditions.</p>
<p><strong>Time stepping:</strong></p>
<ul>
<li>RK2 or RK3 (TVD)</li>
<li>CFL condition:
$$
\Delta t \leq C \min_i \frac{\Delta x_i}{c_{\text{fast}, i} + |v_i|}
$$
where $C \sim 0.4-0.5$ (more restrictive than non-relativistic).</li>
</ul>
<h3 id="72-adaptive-timestep">7.2 Adaptive Timestep<a class="header-link" href="#72-adaptive-timestep" title="Permanent link">&para;</a></h3>
<p>For high Lorentz factors ($W \gg 1$), local timestep can be tiny. Use:</p>
<ul>
<li>Hierarchical timestepping (AMR codes)</li>
<li>Implicit-explicit (IMEX) schemes (stiff terms implicit)</li>
</ul>
<h3 id="73-floors-and-ceilings">7.3 Floors and Ceilings<a class="header-link" href="#73-floors-and-ceilings" title="Permanent link">&para;</a></h3>
<p><strong>Density floor:</strong>
$$
\rho \geq \rho_{\min} = 10^{-6} \rho_{\text{max}}
$$</p>
<p><strong>Temperature ceiling:</strong>
$$
T \leq T_{\max} = 10^{13} \, \text{K} \quad \text{(avoid pair production)}
$$</p>
<p><strong>Magnetization ceiling:</strong>
$$
\sigma \leq \sigma_{\max} \sim 100 \quad \text{(avoid numerical instability)}
$$</p>
<hr />
<h2 id="8-python-implementation-1d-srmhd-shock-tube">8. Python Implementation: 1D SRMHD Shock Tube<a class="header-link" href="#8-python-implementation-1d-srmhd-shock-tube" title="Permanent link">&para;</a></h2>
<h3 id="81-problem-setup">8.1 Problem Setup<a class="header-link" href="#81-problem-setup" title="Permanent link">&para;</a></h3>
<p>Relativistic Brio-Wu test:
$$
(\rho, v_x, p, B_y) = \begin{cases}
(1.0, 0.0, 1.0, 1.0) & x < 0.5 \\
(0.125, 0.0, 0.1, -1.0) & x \geq 0.5
\end{cases}
$$
with $B_x = 0.5$ (constant), $\Gamma = 5/3$ (ideal gas).</p>
<p>Domain: $x \in [0, 1]$, $t \in [0, 0.4]$.</p>
<h3 id="82-code-structure">8.2 Code Structure<a class="header-link" href="#82-code-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Constants</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Speed of light</span>
<span class="n">GAMMA</span> <span class="o">=</span> <span class="mf">5.0</span><span class="o">/</span><span class="mf">3.0</span>  <span class="c1"># Adiabatic index</span>

<span class="c1"># Grid</span>
<span class="n">NX</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">XL</span><span class="p">,</span> <span class="n">XR</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span>
<span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">XR</span> <span class="o">-</span> <span class="n">XL</span><span class="p">)</span> <span class="o">/</span> <span class="n">NX</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">XL</span> <span class="o">+</span> <span class="n">dx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">XR</span> <span class="o">-</span> <span class="n">dx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">NX</span><span class="p">)</span>

<span class="c1"># Primitive variables: [rho, vx, vy, vz, p, Bx, By, Bz]</span>
<span class="k">def</span><span class="w"> </span><span class="nf">initial_conditions</span><span class="p">():</span>
    <span class="n">prim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NX</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">Bx_const</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">prim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">Bx_const</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">Bx_const</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">prim</span>

<span class="c1"># Lorentz factor</span>
<span class="k">def</span><span class="w"> </span><span class="nf">lorentz_factor</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">):</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vz</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Primitive to conserved</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prim2cons</span><span class="p">(</span><span class="n">prim</span><span class="p">):</span>
    <span class="n">rho</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">prim</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="n">prim</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>

    <span class="n">W</span> <span class="o">=</span> <span class="n">lorentz_factor</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vz</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">B2</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">By</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Bz</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">vdotB</span> <span class="o">=</span> <span class="n">vx</span><span class="o">*</span><span class="n">Bx</span> <span class="o">+</span> <span class="n">vy</span><span class="o">*</span><span class="n">By</span> <span class="o">+</span> <span class="n">vz</span><span class="o">*</span><span class="n">Bz</span>

    <span class="c1"># Specific enthalpy</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">/</span><span class="n">rho</span>

    <span class="c1"># Comoving magnetic field</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="n">vdotB</span> <span class="o">/</span> <span class="n">C</span>
    <span class="n">bx</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">/</span><span class="n">W</span> <span class="o">+</span> <span class="n">W</span><span class="o">*</span><span class="n">vx</span><span class="o">*</span><span class="n">vdotB</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">By</span><span class="o">/</span><span class="n">W</span> <span class="o">+</span> <span class="n">W</span><span class="o">*</span><span class="n">vy</span><span class="o">*</span><span class="n">vdotB</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">bz</span> <span class="o">=</span> <span class="n">Bz</span><span class="o">/</span><span class="n">W</span> <span class="o">+</span> <span class="n">W</span><span class="o">*</span><span class="n">vz</span><span class="o">*</span><span class="n">vdotB</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="p">(</span><span class="n">B2</span> <span class="o">+</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">W</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Conserved variables</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">W</span>
    <span class="n">Sx</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vx</span> <span class="o">-</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">*</span><span class="n">Bx</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">Sy</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vy</span> <span class="o">-</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">*</span><span class="n">By</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">Sz</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vz</span> <span class="o">-</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">*</span><span class="n">Bz</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="n">b2</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">D</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">D</span><span class="p">,</span> <span class="n">Sx</span><span class="p">,</span> <span class="n">Sy</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span><span class="p">])</span>

<span class="c1"># Conserved to primitive (simplified 1D Newton-Raphson)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cons2prim</span><span class="p">(</span><span class="n">cons</span><span class="p">,</span> <span class="n">prim_guess</span><span class="p">):</span>
    <span class="n">D</span><span class="p">,</span> <span class="n">Sx</span><span class="p">,</span> <span class="n">Sy</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">cons</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="n">cons</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>

    <span class="c1"># Initial guess</span>
    <span class="n">rho</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">prim_guess</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>

    <span class="c1"># Newton-Raphson iteration (simplified)</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-10</span>

    <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">lorentz_factor</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">/</span><span class="n">rho</span>

        <span class="n">vdotB</span> <span class="o">=</span> <span class="n">vx</span><span class="o">*</span><span class="n">Bx</span> <span class="o">+</span> <span class="n">vy</span><span class="o">*</span><span class="n">By</span> <span class="o">+</span> <span class="n">vz</span><span class="o">*</span><span class="n">Bz</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Bx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">By</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Bz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">W</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># Residuals</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">D</span> <span class="o">-</span> <span class="n">rho</span><span class="o">*</span><span class="n">W</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">Sx</span> <span class="o">-</span> <span class="p">((</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vx</span> <span class="o">-</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">*</span><span class="n">Bx</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">-</span> <span class="p">((</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="n">b2</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">D</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># Simple update (damped)</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">D</span> <span class="o">/</span> <span class="n">W</span>
        <span class="n">p_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">tau</span> <span class="o">+</span> <span class="n">D</span><span class="o">*</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">b2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">-</span> <span class="n">b2</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">)</span>

        <span class="c1"># Update velocity (simplified)</span>
        <span class="n">S2</span> <span class="o">=</span> <span class="n">Sx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Sy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Sz</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">S</span> <span class="o">&gt;</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="n">vx</span> <span class="o">=</span> <span class="n">Sx</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">vy</span> <span class="o">=</span> <span class="n">Sy</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">vz</span> <span class="o">=</span> <span class="n">Sz</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Limit velocity</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">C</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="n">C</span> <span class="o">/</span> <span class="n">v</span>
            <span class="n">vx</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="n">vy</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="n">vz</span> <span class="o">*=</span> <span class="n">scale</span>

    <span class="c1"># Apply floors</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span><span class="p">])</span>

<span class="c1"># Flux function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">flux</span><span class="p">(</span><span class="n">prim</span><span class="p">):</span>
    <span class="n">rho</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">prim</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="n">prim</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>

    <span class="n">W</span> <span class="o">=</span> <span class="n">lorentz_factor</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">)</span>
    <span class="n">vdotB</span> <span class="o">=</span> <span class="n">vx</span><span class="o">*</span><span class="n">Bx</span> <span class="o">+</span> <span class="n">vy</span><span class="o">*</span><span class="n">By</span> <span class="o">+</span> <span class="n">vz</span><span class="o">*</span><span class="n">Bz</span>
    <span class="n">B2</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">By</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Bz</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="p">(</span><span class="n">B2</span> <span class="o">+</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">W</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">/</span><span class="n">rho</span>

    <span class="n">ptot</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">B2</span><span class="o">/</span><span class="p">(</span><span class="mf">8.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">W</span> <span class="o">*</span> <span class="n">vx</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vx</span><span class="o">*</span><span class="n">vx</span> <span class="o">+</span> <span class="n">ptot</span> <span class="o">-</span> <span class="n">Bx</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">*</span><span class="n">Bx</span><span class="o">*</span><span class="n">vx</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vx</span><span class="o">*</span><span class="n">vy</span> <span class="o">-</span> <span class="n">Bx</span><span class="o">*</span><span class="n">By</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">*</span><span class="n">Bx</span><span class="o">*</span><span class="n">vy</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vx</span><span class="o">*</span><span class="n">vz</span> <span class="o">-</span> <span class="n">Bx</span><span class="o">*</span><span class="n">Bz</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">*</span><span class="n">Bx</span><span class="o">*</span><span class="n">vz</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="n">b2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">vx</span> <span class="o">+</span> <span class="n">ptot</span><span class="o">*</span><span class="n">vx</span> <span class="o">-</span> <span class="p">(</span><span class="n">vdotB</span><span class="p">)</span><span class="o">*</span><span class="n">Bx</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Bx constant</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">By</span><span class="o">*</span><span class="n">vx</span> <span class="o">-</span> <span class="n">Bx</span><span class="o">*</span><span class="n">vy</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">Bz</span><span class="o">*</span><span class="n">vx</span> <span class="o">-</span> <span class="n">Bx</span><span class="o">*</span><span class="n">vz</span>

    <span class="k">return</span> <span class="n">F</span>

<span class="c1"># HLLC Riemann solver (simplified HLL for SRMHD)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hll_flux</span><span class="p">(</span><span class="n">pL</span><span class="p">,</span> <span class="n">pR</span><span class="p">):</span>
    <span class="c1"># Estimate wave speeds (very simplified)</span>
    <span class="n">rhoL</span><span class="p">,</span> <span class="n">vxL</span><span class="p">,</span> <span class="n">pL_val</span> <span class="o">=</span> <span class="n">pL</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pL</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pL</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">rhoR</span><span class="p">,</span> <span class="n">vxR</span><span class="p">,</span> <span class="n">pR_val</span> <span class="o">=</span> <span class="n">pR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pR</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

    <span class="c1"># Sound speed</span>
    <span class="n">csL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GAMMA</span> <span class="o">*</span> <span class="n">pL_val</span> <span class="o">/</span> <span class="p">(</span><span class="n">rhoL</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">pL_val</span><span class="o">/</span><span class="n">rhoL</span><span class="p">)))</span>
    <span class="n">csR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GAMMA</span> <span class="o">*</span> <span class="n">pR_val</span> <span class="o">/</span> <span class="p">(</span><span class="n">rhoR</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">pR_val</span><span class="o">/</span><span class="n">rhoR</span><span class="p">)))</span>

    <span class="n">WL</span> <span class="o">=</span> <span class="n">lorentz_factor</span><span class="p">(</span><span class="n">pL</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pL</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pL</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">WR</span> <span class="o">=</span> <span class="n">lorentz_factor</span><span class="p">(</span><span class="n">pR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pR</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pR</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="c1"># Fast magnetosonic speed estimate (crude)</span>
    <span class="n">BxL</span><span class="p">,</span> <span class="n">ByL</span><span class="p">,</span> <span class="n">BzL</span> <span class="o">=</span> <span class="n">pL</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
    <span class="n">BxR</span><span class="p">,</span> <span class="n">ByR</span><span class="p">,</span> <span class="n">BzR</span> <span class="o">=</span> <span class="n">pR</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
    <span class="n">B2L</span> <span class="o">=</span> <span class="n">BxL</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ByL</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">BzL</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">B2R</span> <span class="o">=</span> <span class="n">BxR</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ByR</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">BzR</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">hL</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">pL_val</span><span class="o">/</span><span class="n">rhoL</span>
    <span class="n">hR</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">pR_val</span><span class="o">/</span><span class="n">rhoR</span>

    <span class="n">vAL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B2L</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">rhoL</span><span class="o">*</span><span class="n">hL</span> <span class="o">+</span> <span class="n">B2L</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span>
    <span class="n">vAR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B2R</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">rhoR</span><span class="o">*</span><span class="n">hR</span> <span class="o">+</span> <span class="n">B2R</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span>

    <span class="n">cfL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">csL</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vAL</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">csL</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vAL</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">csL</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vAL</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">cfR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">csR</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vAR</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">csR</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vAR</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">csR</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vAR</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Wave speeds (relativistic addition)</span>
    <span class="n">lamL</span> <span class="o">=</span> <span class="p">(</span><span class="n">vxL</span> <span class="o">-</span> <span class="n">cfL</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">vxL</span><span class="o">*</span><span class="n">cfL</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">lamR</span> <span class="o">=</span> <span class="p">(</span><span class="n">vxR</span> <span class="o">+</span> <span class="n">cfR</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">vxR</span><span class="o">*</span><span class="n">cfR</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># HLL flux</span>
    <span class="n">consL</span> <span class="o">=</span> <span class="n">prim2cons</span><span class="p">(</span><span class="n">pL</span><span class="p">)</span>
    <span class="n">consR</span> <span class="o">=</span> <span class="n">prim2cons</span><span class="p">(</span><span class="n">pR</span><span class="p">)</span>
    <span class="n">FL</span> <span class="o">=</span> <span class="n">flux</span><span class="p">(</span><span class="n">pL</span><span class="p">)</span>
    <span class="n">FR</span> <span class="o">=</span> <span class="n">flux</span><span class="p">(</span><span class="n">pR</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lamL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FL</span>
    <span class="k">elif</span> <span class="n">lamR</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F_hll</span> <span class="o">=</span> <span class="p">(</span><span class="n">lamR</span><span class="o">*</span><span class="n">FL</span> <span class="o">-</span> <span class="n">lamL</span><span class="o">*</span><span class="n">FR</span> <span class="o">+</span> <span class="n">lamL</span><span class="o">*</span><span class="n">lamR</span><span class="o">*</span><span class="p">(</span><span class="n">consR</span> <span class="o">-</span> <span class="n">consL</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">lamR</span> <span class="o">-</span> <span class="n">lamL</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F_hll</span>

<span class="c1"># Main evolution</span>
<span class="k">def</span><span class="w"> </span><span class="nf">evolve_srmhd</span><span class="p">():</span>
    <span class="n">prim</span> <span class="o">=</span> <span class="n">initial_conditions</span><span class="p">()</span>
    <span class="n">cons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">prim2cons</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prim</span><span class="p">])</span>

    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">CFL</span> <span class="o">=</span> <span class="mf">0.4</span>

    <span class="n">snapshots</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">:</span>
        <span class="c1"># Compute dt</span>
        <span class="n">v_max</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="p">):</span>
            <span class="n">rho</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">prim</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bz</span> <span class="o">=</span> <span class="n">prim</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">:]</span>

            <span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GAMMA</span> <span class="o">*</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">/</span><span class="n">rho</span><span class="p">)))</span>
            <span class="n">B2</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">By</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Bz</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">/</span><span class="n">rho</span>
            <span class="n">vA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B2</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">B2</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vA</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">cs</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">vA</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

            <span class="n">W</span> <span class="o">=</span> <span class="n">lorentz_factor</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">)</span>
            <span class="n">v_signal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">vx</span> <span class="o">+</span> <span class="n">cf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">vx</span><span class="o">*</span><span class="n">cf</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span>
                          <span class="nb">abs</span><span class="p">((</span><span class="n">vx</span> <span class="o">-</span> <span class="n">cf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">vx</span><span class="o">*</span><span class="n">cf</span><span class="o">/</span><span class="n">C</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
            <span class="n">v_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">v_max</span><span class="p">,</span> <span class="n">v_signal</span><span class="p">)</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">CFL</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">v_max</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="n">t_end</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">t_end</span> <span class="o">-</span> <span class="n">t</span>

        <span class="c1"># RK2 time integration</span>
        <span class="c1"># Stage 1</span>
        <span class="n">flux_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NX</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux</span><span class="p">(</span><span class="n">prim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">NX</span><span class="p">:</span>
                <span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux</span><span class="p">(</span><span class="n">prim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hll_flux</span><span class="p">(</span><span class="n">prim</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">prim</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">cons_1</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="p">):</span>
            <span class="n">cons_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># Recover primitives</span>
        <span class="n">prim_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cons2prim</span><span class="p">(</span><span class="n">cons_1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">prim</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="p">)])</span>

        <span class="c1"># Stage 2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux</span><span class="p">(</span><span class="n">prim_1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">NX</span><span class="p">:</span>
                <span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux</span><span class="p">(</span><span class="n">prim_1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hll_flux</span><span class="p">(</span><span class="n">prim_1</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">prim_1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">cons_2</span> <span class="o">=</span> <span class="n">cons_1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="p">):</span>
            <span class="n">cons_2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">flux_arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">cons</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">cons</span> <span class="o">+</span> <span class="n">cons_2</span><span class="p">)</span>
        <span class="n">prim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cons2prim</span><span class="p">(</span><span class="n">cons</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">prim_1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="p">)])</span>

        <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">snapshots</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">snapshots</span><span class="p">)</span> <span class="o">*</span> <span class="n">t_end</span> <span class="o">/</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">prim</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">prim</span><span class="p">,</span> <span class="n">snapshots</span>

<span class="c1"># Run simulation</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running SRMHD shock tube...&quot;</span><span class="p">)</span>
<span class="n">prim_final</span><span class="p">,</span> <span class="n">snapshots</span> <span class="o">=</span> <span class="n">evolve_srmhd</span><span class="p">()</span>

<span class="c1"># Plot results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">vars_to_plot</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Velocity vx&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Pressure&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;By&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Lorentz Factor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Energy Density&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vars_to_plot</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">var_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prim_final</span><span class="p">[:,</span> <span class="n">var_idx</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;t=0.4&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;Lorentz&#39;</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lorentz_factor</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prim_final</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;Energy&#39;</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">prim_final</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">GAMMA</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s1"> at t=0.4&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;srmhd_shock_tube.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plot saved: srmhd_shock_tube.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Plot wave structure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">prim_snap</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snapshots</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prim_snap</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t=</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SRMHD Shock Tube: Density Evolution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;srmhd_evolution.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plot saved: srmhd_evolution.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="83-expected-output">8.3 Expected Output<a class="header-link" href="#83-expected-output" title="Permanent link">&para;</a></h3>
<p>The code produces:
- Density jump at shock
- Rarefaction fan
- Contact discontinuity
- Magnetic field reversal
- Lorentz factor peaks in jet-like features</p>
<p><strong>Challenges:</strong>
- Primitive recovery can fail if initial guess poor
- Damping needed in Newton iteration
- Floors prevent unphysical states</p>
<hr />
<h2 id="9-relativistic-alfven-speed">9. Relativistic Alfv√©n Speed<a class="header-link" href="#9-relativistic-alfven-speed" title="Permanent link">&para;</a></h2>
<h3 id="91-comparison-non-relativistic-vs-relativistic">9.1 Comparison: Non-Relativistic vs Relativistic<a class="header-link" href="#91-comparison-non-relativistic-vs-relativistic" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Parameters</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">B_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">GAMMA</span> <span class="o">=</span> <span class="mf">5.0</span><span class="o">/</span><span class="mf">3.0</span>

<span class="c1"># Non-relativistic Alfven speed</span>
<span class="n">vA_nr</span> <span class="o">=</span> <span class="n">B_range</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)</span>

<span class="c1"># Relativistic Alfven speed</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">/</span><span class="n">rho</span>
<span class="n">vA_r</span> <span class="o">=</span> <span class="n">B_range</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">h</span> <span class="o">+</span> <span class="n">B_range</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">B_range</span><span class="p">,</span> <span class="n">vA_nr</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Non-relativistic&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">B_range</span><span class="p">,</span> <span class="n">vA_r</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Relativistic&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Speed of light c=1&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Magnetic Field B&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Alfv√©n Speed $v_A$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Alfv√©n Speed: Non-Relativistic vs Relativistic&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;alfven_speed_comparison.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plot saved: alfven_speed_comparison.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p><strong>Key observation:</strong>
- Non-relativistic $v_A$ can exceed $c$ for large $B$ (unphysical)
- Relativistic $v_A < c$ always (saturates as $B \to \infty$)</p>
<hr />
<h2 id="10-light-cylinder-visualization">10. Light Cylinder Visualization<a class="header-link" href="#10-light-cylinder-visualization" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Pulsar parameters</span>
<span class="n">R_NS</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Neutron star radius</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Angular velocity</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">R_L</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="n">Omega</span>  <span class="c1"># Light cylinder radius</span>

<span class="c1"># Grid</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">R_NS</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">R_L</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">R</span><span class="p">,</span> <span class="n">Theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

<span class="c1"># Corotation velocity</span>
<span class="n">v_corot</span> <span class="o">=</span> <span class="n">Omega</span> <span class="o">*</span> <span class="n">R</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;polar&#39;</span><span class="p">},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Velocity field (normalized)</span>
<span class="n">v_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">v_corot</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Theta</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">v_norm</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu_r&#39;</span><span class="p">)</span>

<span class="c1"># Light cylinder</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">R_L</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Light Cylinder&#39;</span><span class="p">)</span>

<span class="c1"># Neutron star</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">R_NS</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neutron Star&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">R_L</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pulsar Magnetosphere: Corotation Velocity</span><span class="se">\n</span><span class="s1">(Dashed = Light Cylinder)&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$v_</span><span class="si">{corot}</span><span class="s1">/c$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;light_cylinder.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plot saved: light_cylinder.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p>Inside $R_L$: corotation possible ($v < c$).
Outside $R_L$: field lines open, particles escape (pulsar wind).</p>
<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<p>Relativistic MHD extends classical MHD to regimes where $v \sim c$:</p>
<ol>
<li><strong>SRMHD formulation:</strong> Covariant 4-tensor approach, stress-energy tensor, frozen-in condition</li>
<li><strong>3+1 decomposition:</strong> Lab-frame conserved variables for numerical implementation</li>
<li><strong>Primitive recovery:</strong> Nonlinear implicit solve (major numerical challenge)</li>
<li><strong>Wave structure:</strong> 7 waves, relativistic dispersion (all speeds &lt; $c$)</li>
<li><strong>Applications:</strong> Relativistic jets, pulsar magnetospheres, black hole accretion</li>
<li><strong>GRMHD:</strong> Curved spacetime, Kerr metric, horizon-penetrating coordinates</li>
<li><strong>Numerical methods:</strong> HLLC/HLLD Riemann solvers, adaptive timestepping, floors</li>
</ol>
<p><strong>Key challenges:</strong>
- Primitive recovery robustness
- Handling high Lorentz factors ($W \gg 1$)
- Magnetization parameter $\sigma$ spanning many decades
- Coupling to radiation, pair production (beyond ideal MHD)</p>
<p>Relativistic MHD is essential for understanding the most energetic phenomena in the universe: jets, pulsars, black holes, and neutron star mergers.</p>
<hr />
<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Lorentz Transformations:</strong>
   Given $\mathbf{E} = (1, 0, 0)$ and $\mathbf{B} = (0, 1, 0)$ in the lab frame, compute $\mathbf{E}'$ and $\mathbf{B}'$ in a frame moving with $\mathbf{v} = (0.5c, 0, 0)$. Verify $\mathbf{E}' \cdot \mathbf{B}' = \mathbf{E} \cdot \mathbf{B}$ (Lorentz invariant).</p>
</li>
<li>
<p><strong>Primitive Recovery:</strong>
   Implement a 1D Newton-Raphson primitive recovery routine. Test on: $D = 2.0$, $S_x = 1.0$, $\tau = 3.0$, $B_x = 0.5$, $B_y = 1.0$. Initial guess: $\rho = 1.0$, $v_x = 0.3$, $p = 1.0$. Does it converge? How many iterations?</p>
</li>
<li>
<p><strong>Relativistic Brio-Wu:</strong>
   Modify the shock tube code to use $B_x = 0$ (purely transverse field). Compare wave speeds and structure to the $B_x = 0.5$ case. Why does the solution differ?</p>
</li>
<li>
<p><strong>Magnetization Parameter:</strong>
   For a pulsar with $B = 10^{12}$ G, $\rho = 10^7$ g/cm¬≥, $\Gamma = 10$, compute $\sigma = B^2/(4\pi \rho h W^2 c^2)$. Assume $h \approx 1$. Is this force-free ($\sigma \gg 1$) or fluid-dominated?</p>
</li>
<li>
<p><strong>Light Cylinder:</strong>
   For the Crab pulsar ($P = 33$ ms), compute $R_L$. At what radius does the corotation velocity equal $c$? Compare to the pulsar radius $R_{NS} \sim 10$ km.</p>
</li>
<li>
<p><strong>ISCO Velocity:</strong>
   For a Schwarzschild black hole, compute the orbital velocity at the ISCO ($r = 6GM/c^2$). What is the Lorentz factor $W$? Repeat for a Kerr black hole with $a = 0.998$ (nearly extremal) at the prograde ISCO.</p>
</li>
<li>
<p><strong>Alfv√©n Speed Saturation:</strong>
   Plot the relativistic Alfv√©n speed $v_A = B/\sqrt{4\pi(\rho h + B^2/(4\pi))}$ vs $B$ for fixed $\rho = 1$, $p = 0.1$, $\Gamma = 4/3$. Show that $v_A \to c$ as $B \to \infty$ but never exceeds $c$.</p>
</li>
<li>
<p><strong>HARM Timestep:</strong>
   In GRMHD near a black hole horizon, the lapse function $\alpha \to 0$. Why does this require smaller timesteps? Estimate the CFL timestep near $r = 2.01 GM/c^2$ for a radial grid with $\Delta r = 0.01 GM/c^2$.</p>
</li>
</ol>
<hr />
<p><strong>Previous:</strong> <a href="./15_2D_MHD_Solver.md">2D MHD Solver</a> | <strong>Next:</strong> <a href="./17_Spectral_Methods.md">Spectral and Advanced Methods</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/MHD/15_2D_MHD_Solver.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">15. 2D MHD Solver</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/MHD/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/MHD/17_Spectral_Methods.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">17. Spectral and Advanced Methods</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}