{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCP Protocol - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Networking/">Networking</a>
    <span class="separator">/</span>
    <span class="current">TCP Protocol</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>TCP Protocol</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Networking/09_Routing_Protocols.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Routing Protocols</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Networking/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Networking/11_UDP_and_Ports.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">UDP and Ports</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-tcp-characteristics">1. TCP Characteristics</a><ul>
<li><a href="#11-basic-tcp-features">1.1 Basic TCP Features</a></li>
<li><a href="#12-tcp-vs-udp-brief-comparison">1.2 TCP vs UDP Brief Comparison</a></li>
<li><a href="#13-tcp-segment">1.3 TCP Segment</a></li>
</ul>
</li>
<li><a href="#2-tcp-header-structure">2. TCP Header Structure</a><ul>
<li><a href="#21-tcp-header-format">2.1 TCP Header Format</a></li>
<li><a href="#22-header-field-descriptions">2.2 Header Field Descriptions</a></li>
<li><a href="#23-tcp-flags">2.3 TCP Flags</a></li>
<li><a href="#24-key-tcp-options">2.4 Key TCP Options</a></li>
</ul>
</li>
<li><a href="#3-3-way-handshake">3. 3-Way Handshake</a><ul>
<li><a href="#31-connection-establishment-process">3.1 Connection Establishment Process</a></li>
<li><a href="#32-detailed-steps">3.2 Detailed Steps</a></li>
<li><a href="#33-isn-initial-sequence-number">3.3 ISN (Initial Sequence Number)</a></li>
<li><a href="#34-tcp-state-transition-connection-establishment">3.4 TCP State Transition (Connection Establishment)</a></li>
</ul>
</li>
<li><a href="#4-4-way-handshake">4. 4-Way Handshake</a><ul>
<li><a href="#41-connection-termination-process">4.1 Connection Termination Process</a></li>
<li><a href="#42-detailed-steps">4.2 Detailed Steps</a></li>
<li><a href="#43-half-close">4.3 Half-Close</a></li>
<li><a href="#44-time_wait-state">4.4 TIME_WAIT State</a></li>
<li><a href="#45-tcp-state-diagram">4.5 TCP State Diagram</a></li>
</ul>
</li>
<li><a href="#5-sequence-numbers-and-ack">5. Sequence Numbers and ACK</a><ul>
<li><a href="#51-role-of-sequence-numbers">5.1 Role of Sequence Numbers</a></li>
<li><a href="#52-cumulative-ack">5.2 Cumulative ACK</a></li>
<li><a href="#53-sack-selective-acknowledgment">5.3 SACK (Selective Acknowledgment)</a></li>
<li><a href="#54-retransmission-timer-rto">5.4 Retransmission Timer (RTO)</a></li>
</ul>
</li>
<li><a href="#6-flow-control">6. Flow Control</a><ul>
<li><a href="#61-sliding-window">6.1 Sliding Window</a></li>
<li><a href="#62-window-size-adjustment">6.2 Window Size Adjustment</a></li>
<li><a href="#63-window-scale-option">6.3 Window Scale Option</a></li>
<li><a href="#64-silly-window-syndrome-prevention">6.4 Silly Window Syndrome Prevention</a></li>
</ul>
</li>
<li><a href="#7-congestion-control">7. Congestion Control</a><ul>
<li><a href="#71-congestion-control-overview">7.1 Congestion Control Overview</a></li>
<li><a href="#72-slow-start">7.2 Slow Start</a></li>
<li><a href="#73-congestion-avoidance">7.3 Congestion Avoidance</a></li>
<li><a href="#74-congestion-detection-and-response">7.4 Congestion Detection and Response</a></li>
<li><a href="#75-fast-retransmit-and-fast-recovery">7.5 Fast Retransmit and Fast Recovery</a></li>
<li><a href="#76-modern-congestion-control-algorithms">7.6 Modern Congestion Control Algorithms</a></li>
</ul>
</li>
<li><a href="#8-practice-problems">8. Practice Problems</a><ul>
<li><a href="#problem-1-3-way-handshake-analysis">Problem 1: 3-Way Handshake Analysis</a></li>
<li><a href="#problem-2-sequence-number-calculation">Problem 2: Sequence Number Calculation</a></li>
<li><a href="#problem-3-flow-control">Problem 3: Flow Control</a></li>
<li><a href="#problem-4-congestion-control">Problem 4: Congestion Control</a></li>
</ul>
</li>
<li><a href="#answers">Answers</a><ul>
<li><a href="#problem-1-answers">Problem 1 Answers</a></li>
<li><a href="#problem-2-answers">Problem 2 Answers</a></li>
<li><a href="#problem-3-answers">Problem 3 Answers</a></li>
<li><a href="#problem-4-answers">Problem 4 Answers</a></li>
</ul>
</li>
<li><a href="#9-next-steps">9. Next Steps</a><ul>
<li><a href="#next-lesson">Next Lesson</a></li>
<li><a href="#related-lessons">Related Lessons</a></li>
<li><a href="#recommended-practice">Recommended Practice</a></li>
</ul>
</li>
<li><a href="#10-references">10. References</a><ul>
<li><a href="#rfc-documents">RFC Documents</a></li>
<li><a href="#command-reference">Command Reference</a></li>
<li><a href="#learning-resources">Learning Resources</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="tcp-protocol">TCP Protocol<a class="header-link" href="#tcp-protocol" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>This document covers the core concepts of TCP (Transmission Control Protocol). You'll learn the operating principles of TCP, which ensures connection-oriented and reliable data transmission, including header structure, flow control, and congestion control mechanisms.</p>
<p><strong>Difficulty</strong>: â­â­â­
<strong>Estimated Learning Time</strong>: 3-4 hours
<strong>Prerequisites</strong>: <a href="./09_Routing_Protocols.md">09_Routing_Protocols.md</a></p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-tcp-characteristics">TCP Characteristics</a></li>
<li><a href="#2-tcp-header-structure">TCP Header Structure</a></li>
<li><a href="#3-3-way-handshake">3-Way Handshake</a></li>
<li><a href="#4-4-way-handshake">4-Way Handshake</a></li>
<li><a href="#5-sequence-numbers-and-ack">Sequence Numbers and ACK</a></li>
<li><a href="#6-flow-control">Flow Control</a></li>
<li><a href="#7-congestion-control">Congestion Control</a></li>
<li><a href="#8-practice-problems">Practice Problems</a></li>
<li><a href="#9-next-steps">Next Steps</a></li>
<li><a href="#10-references">References</a></li>
</ol>
<hr />
<h2 id="1-tcp-characteristics">1. TCP Characteristics<a class="header-link" href="#1-tcp-characteristics" title="Permanent link">&para;</a></h2>
<h3 id="11-basic-tcp-features">1.1 Basic TCP Features<a class="header-link" href="#11-basic-tcp-features" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TCP Features                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. Connection-Oriented                                         â”‚
â”‚     - Requires connection establishment before data transfer    â”‚
â”‚       (3-way handshake)                                         â”‚
â”‚     - Connection termination after transmission (4-way handshake)â”‚
â”‚                                                                  â”‚
â”‚  2. Reliability                                                 â”‚
â”‚     - Guaranteed data delivery                                  â”‚
â”‚     - Order preservation                                        â”‚
â”‚     - Error detection and retransmission                        â”‚
â”‚                                                                  â”‚
â”‚  3. Flow Control                                                â”‚
â”‚     - Transmission rate matched to receiver&#39;s processing speed  â”‚
â”‚     - Uses sliding window                                       â”‚
â”‚                                                                  â”‚
â”‚  4. Congestion Control                                          â”‚
â”‚     - Responds to network congestion                            â”‚
â”‚     - Slow Start, Congestion Avoidance, etc.                   â”‚
â”‚                                                                  â”‚
â”‚  5. Full-Duplex Communication                                   â”‚
â”‚     - Simultaneous bidirectional data transmission              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-tcp-vs-udp-brief-comparison">1.2 TCP vs UDP Brief Comparison<a class="header-link" href="#12-tcp-vs-udp-brief-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>TCP</th>
<th>UDP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Connection</td>
<td>Connection-oriented</td>
<td>Connectionless</td>
</tr>
<tr>
<td>Reliability</td>
<td>Reliable</td>
<td>Unreliable</td>
</tr>
<tr>
<td>Ordering</td>
<td>Ordered</td>
<td>Unordered</td>
</tr>
<tr>
<td>Speed</td>
<td>Relatively slow</td>
<td>Fast</td>
</tr>
<tr>
<td>Header Size</td>
<td>20-60 bytes</td>
<td>8 bytes</td>
</tr>
<tr>
<td>Use Cases</td>
<td>Web, email, file transfer</td>
<td>Streaming, DNS, gaming</td>
</tr>
</tbody>
</table>
<h3 id="13-tcp-segment">1.3 TCP Segment<a class="header-link" href="#13-tcp-segment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>TCP Data Encapsulation

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Application Layer                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                         Data                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Transport Layer (TCP)                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  TCP Header  â”‚                    Data                       â”‚ â”‚
â”‚ â”‚   (20-60B)   â”‚                (Segment)                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      TCP Segment                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Network Layer (IP)                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  IP Header   â”‚              TCP Segment                      â”‚ â”‚
â”‚ â”‚   (20-60B)   â”‚                                               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       IP Packet                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-tcp-header-structure">2. TCP Header Structure<a class="header-link" href="#2-tcp-header-structure" title="Permanent link">&para;</a></h2>
<h3 id="21-tcp-header-format">2.1 TCP Header Format<a class="header-link" href="#21-tcp-header-format" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"> 0                   1                   2                   3</span>
<span class="c"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|          Source Port          |       Destination Port        |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|                        Sequence Number                        |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|                    Acknowledgment Number                      |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|  Data |       |C|E|U|A|P|R|S|F|                               |</span>
<span class="c">| Offset| Rsrvd |W|C|R|C|S|S|Y|I|            Window             |</span>
<span class="c">|       |       |R|E|G|K|H|T|N|N|                               |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|           Checksum            |         Urgent Pointer        |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|                    Options (if any)                           |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="c">|                             Data                              |</span>
<span class="nb">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</code></pre></div>

<h3 id="22-header-field-descriptions">2.2 Header Field Descriptions<a class="header-link" href="#22-header-field-descriptions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Size</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source Port</td>
<td>16 bits</td>
<td>Source port number (0-65535)</td>
</tr>
<tr>
<td>Destination Port</td>
<td>16 bits</td>
<td>Destination port number (0-65535)</td>
</tr>
<tr>
<td>Sequence Number</td>
<td>32 bits</td>
<td>Byte number of first byte in segment data</td>
</tr>
<tr>
<td>Acknowledgment Number</td>
<td>32 bits</td>
<td>Next expected byte number</td>
</tr>
<tr>
<td>Data Offset</td>
<td>4 bits</td>
<td>TCP header length (in 4-byte units)</td>
</tr>
<tr>
<td>Reserved</td>
<td>4 bits</td>
<td>Reserved (set to 0)</td>
</tr>
<tr>
<td>Flags</td>
<td>8 bits</td>
<td>Control flags (CWR, ECE, URG, ACK, PSH, RST, SYN, FIN)</td>
</tr>
<tr>
<td>Window</td>
<td>16 bits</td>
<td>Receive window size (flow control)</td>
</tr>
<tr>
<td>Checksum</td>
<td>16 bits</td>
<td>Error detection checksum</td>
</tr>
<tr>
<td>Urgent Pointer</td>
<td>16 bits</td>
<td>Urgent data location (when URG flag set)</td>
</tr>
<tr>
<td>Options</td>
<td>0-40 bytes</td>
<td>Additional options (MSS, Window Scale, etc.)</td>
</tr>
</tbody>
</table>
<h3 id="23-tcp-flags">2.3 TCP Flags<a class="header-link" href="#23-tcp-flags" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TCP Flags                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CWR     â”‚ Congestion Window Reduced - congestion window reduced â”‚
â”‚ ECE     â”‚ ECN-Echo - explicit congestion notification           â”‚
â”‚ URG     â”‚ Urgent - urgent data present                          â”‚
â”‚ ACK     â”‚ Acknowledgment - acknowledgment valid                 â”‚
â”‚ PSH     â”‚ Push - deliver immediately without buffering          â”‚
â”‚ RST     â”‚ Reset - force connection termination                  â”‚
â”‚ SYN     â”‚ Synchronize - connection request (seq number sync)    â”‚
â”‚ FIN     â”‚ Finish - connection termination request               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="24-key-tcp-options">2.4 Key TCP Options<a class="header-link" href="#24-key-tcp-options" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Option</th>
<th>Kind</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MSS</td>
<td>2</td>
<td>Maximum Segment Size (typically 1460 bytes)</td>
</tr>
<tr>
<td>Window Scale</td>
<td>3</td>
<td>Window size expansion (up to 1GB)</td>
</tr>
<tr>
<td>SACK Permitted</td>
<td>4</td>
<td>Selective ACK support</td>
</tr>
<tr>
<td>SACK</td>
<td>5</td>
<td>Received segment ranges</td>
</tr>
<tr>
<td>Timestamps</td>
<td>8</td>
<td>RTT measurement and PAWS</td>
</tr>
<tr>
<td>NOP</td>
<td>1</td>
<td>Padding (No Operation)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-3-way-handshake">3. 3-Way Handshake<a class="header-link" href="#3-3-way-handshake" title="Permanent link">&para;</a></h2>
<h3 id="31-connection-establishment-process">3.1 Connection Establishment Process<a class="header-link" href="#31-connection-establishment-process" title="Permanent link">&para;</a></h3>
<p>TCP connections are established through a 3-way handshake.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    3-Way Handshake                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚     Client                               Server                 â”‚
â”‚         â”‚                                  â”‚                    â”‚
â”‚         â”‚  Step 1: SYN                     â”‚                    â”‚
â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚                    â”‚
â”‚         â”‚  SYN=1, Seq=100                  â”‚                    â”‚
â”‚  CLOSED â”‚                                  â”‚ LISTEN             â”‚
â”‚    â†“    â”‚                                  â”‚    â†“               â”‚
â”‚ SYN_SENTâ”‚  Step 2: SYN-ACK                 â”‚ SYN_RECEIVED       â”‚
â”‚         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚
â”‚         â”‚  SYN=1, ACK=1, Seq=300, Ack=101  â”‚                    â”‚
â”‚    â†“    â”‚                                  â”‚                    â”‚
â”‚ ESTABLISHED Step 3: ACK                    â”‚                    â”‚
â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚                    â”‚
â”‚         â”‚  ACK=1, Seq=101, Ack=301         â”‚                    â”‚
â”‚         â”‚                                  â”‚ ESTABLISHED        â”‚
â”‚         â”‚                                  â”‚                    â”‚
â”‚         â”‚        Connection Established    â”‚                    â”‚
â”‚         â”‚  â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º â”‚                    â”‚
â”‚         â”‚         Data Transfer            â”‚                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="32-detailed-steps">3.2 Detailed Steps<a class="header-link" href="#32-detailed-steps" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: SYN (Synchronize)</strong></p>
<div class="highlight"><pre><span></span><code><span class="nv">Client</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Server</span>

<span class="nv">TCP</span><span class="w"> </span><span class="nv">Header</span>:
<span class="w">  </span><span class="nv">Source</span><span class="w"> </span><span class="nv">Port</span>:<span class="w"> </span><span class="mi">50000</span><span class="w"> </span><span class="ss">(</span><span class="nv">ephemeral</span><span class="ss">)</span>
<span class="w">  </span><span class="nv">Destination</span><span class="w"> </span><span class="nv">Port</span>:<span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="ss">(</span><span class="nv">HTTP</span><span class="ss">)</span>
<span class="w">  </span><span class="nv">Sequence</span><span class="w"> </span><span class="nv">Number</span>:<span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="ss">(</span><span class="nv">ISN</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Initial</span><span class="w"> </span><span class="nv">Sequence</span><span class="w"> </span><span class="nv">Number</span><span class="ss">)</span>
<span class="w">  </span><span class="nv">Acknowledgment</span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="nv">Flags</span>:<span class="w"> </span><span class="nv">SYN</span><span class="o">=</span><span class="mi">1</span>
<span class="w">  </span><span class="nv">Window</span>:<span class="w"> </span><span class="mi">65535</span>
<span class="w">  </span><span class="nv">Options</span>:<span class="w"> </span><span class="nv">MSS</span><span class="o">=</span><span class="mi">1460</span>,<span class="w"> </span><span class="nv">Window</span><span class="w"> </span><span class="nv">Scale</span><span class="o">=</span><span class="mi">7</span>

<span class="nv">Meaning</span>:<span class="w"> </span><span class="s2">&quot;I want to connect. My sequence number starts at 100.&quot;</span>
</code></pre></div>

<p><strong>Step 2: SYN-ACK</strong></p>
<div class="highlight"><pre><span></span><code>Server â†’ Client

TCP Header:
  Source Port: 80
  Destination Port: 50000
  Sequence Number: 300 (Server&#39;s ISN)
  Acknowledgment: 101 (Client Seq + 1)
  Flags: SYN=1, ACK=1
  Window: 65535
  Options: MSS=1460, Window Scale=7

Meaning: &quot;Connection request received. Expecting byte 101.
         My sequence number starts at 300.&quot;
</code></pre></div>

<p><strong>Step 3: ACK</strong></p>
<div class="highlight"><pre><span></span><code>Client â†’ Server

TCP Header:
  Source Port: 50000
  Destination Port: 80
  Sequence Number: 101
  Acknowledgment: 301 (Server Seq + 1)
  Flags: ACK=1
  Window: 65535

Meaning: &quot;Received server&#39;s response. Expecting byte 301.
         Now we can exchange data.&quot;
</code></pre></div>

<h3 id="33-isn-initial-sequence-number">3.3 ISN (Initial Sequence Number)<a class="header-link" href="#33-isn-initial-sequence-number" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Why ISN is Random:

1. Security
   <span class="k">-</span> Predictable ISN vulnerable to TCP session hijacking
   <span class="k">-</span> Random ISN increases attack difficulty

2. Distinguish from Previous Connections
   <span class="k">-</span> Prevents confusion with packets from previous connection
     on same socket (IP:Port pair)
   <span class="k">-</span> Related to TIME_WAIT state

ISN Generation Example:
  Modern OS: Uses secure random number generator (CSPRNG)
  Legacy: Time-based counter (increment by 1 every 4 microseconds)
</code></pre></div>

<h3 id="34-tcp-state-transition-connection-establishment">3.4 TCP State Transition (Connection Establishment)<a class="header-link" href="#34-tcp-state-transition-connection-establishment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Client state transition:
CLOSED â†’ SYN_SENT â†’ ESTABLISHED

Server state transition:
CLOSED â†’ LISTEN â†’ SYN_RECEIVED â†’ ESTABLISHED
</code></pre></div>

<hr />
<h2 id="4-4-way-handshake">4. 4-Way Handshake<a class="header-link" href="#4-4-way-handshake" title="Permanent link">&para;</a></h2>
<h3 id="41-connection-termination-process">4.1 Connection Termination Process<a class="header-link" href="#41-connection-termination-process" title="Permanent link">&para;</a></h3>
<p>TCP connections are gracefully terminated through a 4-way handshake.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    4-Way Handshake                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Client (Active Close)                Server (Passive Close)   â”‚
â”‚         â”‚                                  â”‚                    â”‚
â”‚ ESTABLISHED                          ESTABLISHED               â”‚
â”‚         â”‚                                  â”‚                    â”‚
â”‚         â”‚  Step 1: FIN                     â”‚                    â”‚
â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚                    â”‚
â”‚         â”‚  FIN=1, Seq=100                  â”‚                    â”‚
â”‚ FIN_WAIT_1                                 â”‚                    â”‚
â”‚         â”‚                                  â”‚ CLOSE_WAIT         â”‚
â”‚         â”‚  Step 2: ACK                     â”‚                    â”‚
â”‚         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚
â”‚         â”‚  ACK=1, Ack=101                  â”‚                    â”‚
â”‚ FIN_WAIT_2                                 â”‚                    â”‚
â”‚         â”‚                                  â”‚ (Send remaining data)â”‚
â”‚         â”‚                                  â”‚                    â”‚
â”‚         â”‚  Step 3: FIN                     â”‚                    â”‚
â”‚         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚
â”‚         â”‚  FIN=1, Seq=300                  â”‚ LAST_ACK           â”‚
â”‚ TIME_WAIT                                  â”‚                    â”‚
â”‚         â”‚  Step 4: ACK                     â”‚                    â”‚
â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚                    â”‚
â”‚         â”‚  ACK=1, Ack=301                  â”‚                    â”‚
â”‚         â”‚                                  â”‚ CLOSED             â”‚
â”‚  (Wait 2MSL)                               â”‚                    â”‚
â”‚ CLOSED                                                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="42-detailed-steps">4.2 Detailed Steps<a class="header-link" href="#42-detailed-steps" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Step</th>
<th>Sender</th>
<th>Flags</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Client</td>
<td>FIN</td>
<td>"No more data to send. Request connection termination"</td>
</tr>
<tr>
<td>2</td>
<td>Server</td>
<td>ACK</td>
<td>"FIN acknowledged. May still have data to send"</td>
</tr>
<tr>
<td>3</td>
<td>Server</td>
<td>FIN</td>
<td>"I'm done sending too. Agree to terminate"</td>
</tr>
<tr>
<td>4</td>
<td>Client</td>
<td>ACK</td>
<td>"FIN acknowledged. Connection terminated"</td>
</tr>
</tbody>
</table>
<h3 id="43-half-close">4.3 Half-Close<a class="header-link" href="#43-half-close" title="Permanent link">&para;</a></h3>
<p>TCP supports half-close. Even after one side sends FIN, the other can continue sending data.</p>
<div class="highlight"><pre><span></span><code><span class="nv">Half</span><span class="o">-</span><span class="nv">Close</span><span class="w"> </span><span class="nv">Scenario</span>

<span class="nv">Client</span><span class="w">              </span><span class="nv">Server</span>
<span class="w">    </span>â”‚<span class="w">                  </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">FIN</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚<span class="w">  </span><span class="nv">Client</span>:<span class="w"> </span><span class="s2">&quot;No more data to send&quot;</span>
<span class="w">    </span>â”‚<span class="w">                  </span>â”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">  </span><span class="nv">Server</span>:<span class="w"> </span><span class="s2">&quot;OK&quot;</span>
<span class="w">    </span>â”‚<span class="w">                  </span>â”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€<span class="w"> </span><span class="nv">Data</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”‚<span class="w">  </span><span class="nv">Server</span>:<span class="w"> </span><span class="k">Continue</span><span class="w"> </span><span class="nv">sending</span><span class="w"> </span><span class="nv">remaining</span><span class="w"> </span><span class="nv">data</span>
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€<span class="w"> </span><span class="nv">Data</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”‚
<span class="w">    </span>â”‚<span class="w">                  </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
<span class="w">    </span>â”‚<span class="w">                  </span>â”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€<span class="w"> </span><span class="nv">FIN</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">  </span><span class="nv">Server</span>:<span class="w"> </span><span class="s2">&quot;I&#39;m done too&quot;</span>
<span class="w">    </span>â”‚<span class="w">                  </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚<span class="w">  </span><span class="nv">Connection</span><span class="w"> </span><span class="nv">closed</span>
<span class="w">    </span>â”‚<span class="w">                  </span>â”‚
</code></pre></div>

<h3 id="44-time_wait-state">4.4 TIME_WAIT State<a class="header-link" href="#44-time_wait-state" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Purpose of TIME_WAIT:

1. Handle Delayed Packets
   <span class="k">-</span> Wait for old connection packets in network to expire
   <span class="k">-</span> Prevent confusion with new connection

2. Handle Lost Final ACK
   <span class="k">-</span> If server doesn&#39;t receive final ACK, it will resend FIN
   <span class="k">-</span> Client in TIME_WAIT can respond again

TIME_WAIT Duration: 2 Ã— MSL (Maximum Segment Lifetime)
  <span class="k">-</span> MSL: Typically 30 seconds or 2 minutes
  <span class="k">-</span> TIME_WAIT: 1 minute ~ 4 minutes

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TIME_WAIT Problem                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - Can cause port exhaustion with many short-lived connections  â”‚
â”‚  - Solutions:                                                   â”‚
â”‚    1. Use SO_REUSEADDR socket option                            â”‚
â”‚    2. tcp_tw_reuse kernel parameter (Linux)                     â”‚
â”‚    3. Use connection pooling                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="45-tcp-state-diagram">4.5 TCP State Diagram<a class="header-link" href="#45-tcp-state-diagram" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                 </span><span class="nx">TCP</span><span class="w"> </span><span class="nx">State</span><span class="w"> </span><span class="nx">Diagram</span><span class="w"> </span><span class="p">(</span><span class="nx">Simplified</span><span class="p">)</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="w">                              </span><span class="nx">CLOSED</span>
<span class="w">                                </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Active</span><span class="w"> </span><span class="nx">open</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Passive</span><span class="w"> </span><span class="nx">open</span><span class="w">    </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â–¼</span><span class="w">                 </span><span class="err">â–¼</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="w">          </span><span class="nx">SYN_SENT</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â–º</span><span class="w"> </span><span class="nx">LISTEN</span><span class="w">                </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Receive</span><span class="w"> </span><span class="nx">SYN</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Receive</span><span class="w"> </span><span class="nx">SYN</span><span class="w">     </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â–¼</span><span class="w">                 </span><span class="err">â–¼</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="w">          </span><span class="err">â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="nx">SYN_RCVD</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><span class="w">      </span><span class="err">â”‚</span>
<span class="w">                              </span><span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="w">                    </span><span class="nx">Receive</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="w">                    </span><span class="nx">ACK</span><span class="w">       </span><span class="err">â–¼</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="w">                        </span><span class="nx">ESTABLISHED</span><span class="w">               </span><span class="err">â”‚</span>
<span class="w">                              </span><span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Active</span><span class="w"> </span><span class="nx">close</span><span class="w">   </span><span class="nx">Passive</span><span class="w"> </span><span class="nx">close</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â–¼</span><span class="w">                               </span><span class="err">â–¼</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">          </span><span class="nx">FIN_WAIT_1</span><span class="w">                    </span><span class="nx">CLOSE_WAIT</span><span class="w"> </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â–¼</span><span class="w">                               </span><span class="err">â–¼</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">          </span><span class="nx">FIN_WAIT_2</span><span class="w">                     </span><span class="nx">LAST_ACK</span><span class="w"> </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â–¼</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">          </span><span class="nx">TIME_WAIT</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â”‚</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="w">              </span><span class="err">â””â”€â”€â”€</span><span class="w"> </span><span class="mi">2</span><span class="nx">MSL</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">                              </span><span class="err">â”‚</span>
<span class="w">                              </span><span class="err">â–¼</span>
<span class="w">                           </span><span class="nx">CLOSED</span>
</code></pre></div>

<hr />
<h2 id="5-sequence-numbers-and-ack">5. Sequence Numbers and ACK<a class="header-link" href="#5-sequence-numbers-and-ack" title="Permanent link">&para;</a></h2>
<h3 id="51-role-of-sequence-numbers">5.1 Role of Sequence Numbers<a class="header-link" href="#51-role-of-sequence-numbers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">Sequence</span><span class="w"> </span><span class="nv">Number</span><span class="w"> </span><span class="nv">Operation</span>

<span class="nv">Client</span><span class="w">                               </span><span class="nv">Server</span>
<span class="w">    </span>â”‚<span class="w">                                      </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Seq</span><span class="o">=</span><span class="mi">1000</span>,<span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
<span class="w">    </span>â”‚<span class="w">       </span><span class="ss">(</span><span class="mi">1000</span><span class="o">-</span><span class="mi">1999</span><span class="ss">)</span><span class="w">                    </span>â”‚
<span class="w">    </span>â”‚<span class="w">                                      </span>â”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="o">=</span><span class="mi">2000</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”‚
<span class="w">    </span>â”‚<span class="w">   </span><span class="s2">&quot;Please send from byte 2000&quot;</span><span class="w">       </span>â”‚
<span class="w">    </span>â”‚<span class="w">                                      </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Seq</span><span class="o">=</span><span class="mi">2000</span>,<span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
<span class="w">    </span>â”‚<span class="w">       </span><span class="ss">(</span><span class="mi">2000</span><span class="o">-</span><span class="mi">2999</span><span class="ss">)</span><span class="w">                    </span>â”‚
<span class="w">    </span>â”‚<span class="w">                                      </span>â”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="o">=</span><span class="mi">3000</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”‚
<span class="w">    </span>â”‚<span class="w">                                      </span>â”‚

<span class="nv">Sequence</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Byte</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">byte</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">segment</span>
<span class="nv">ACK</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Next</span><span class="w"> </span><span class="nv">expected</span><span class="w"> </span><span class="nv">byte</span><span class="w"> </span><span class="nv">number</span>
</code></pre></div>

<h3 id="52-cumulative-ack">5.2 Cumulative ACK<a class="header-link" href="#52-cumulative-ack" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Cumulative ACK Operation

Sender                                   Receiver
    â”‚                                      â”‚
    â”‚â”€â”€ Seq=1000, 500 bytes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚â”€â”€ Seq=1500, 500 bytes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚â”€â”€ Seq=2000, 500 bytes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                                      â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=2500 â”€â”€â”€â”€â”‚
    â”‚                                      â”‚
    â”‚  Single ACK acknowledges all 3 segments â”‚
    â”‚                                      â”‚

Advantage:
- Reduces ACK packet count
- Improves network efficiency

Disadvantage:
- Lost middle packet requires retransmission of subsequent packets
  (Solved by SACK)
</code></pre></div>

<h3 id="53-sack-selective-acknowledgment">5.3 SACK (Selective Acknowledgment)<a class="header-link" href="#53-sack-selective-acknowledgment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SACK Operation

Sender                                   Receiver
    â”‚                                      â”‚
    â”‚â”€â”€ Seq=1000, 500B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ âœ“
    â”‚â”€â”€ Seq=1500, 500B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€X     â”‚ (lost)
    â”‚â”€â”€ Seq=2000, 500B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ âœ“
    â”‚â”€â”€ Seq=2500, 500B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ âœ“
    â”‚                                      â”‚
    â”‚â—„â”€â”€â”€â”€ ACK=1500, SACK=2000-3000 â”€â”€â”€â”€â”€â”‚
    â”‚      &quot;1500 missing, but received 2000-3000&quot;
    â”‚                                      â”‚
    â”‚â”€â”€ Seq=1500, 500B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (retransmit)
    â”‚                                      â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=3000 â”€â”€â”€â”€â”‚
    â”‚                                      â”‚

SACK Advantages:
- Selective retransmission of lost segments only
- Prevents unnecessary retransmissions
- Efficient on high-speed networks
</code></pre></div>

<h3 id="54-retransmission-timer-rto">5.4 Retransmission Timer (RTO)<a class="header-link" href="#54-retransmission-timer-rto" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>RTO (Retransmission Timeout) Calculation

1. Measure RTT (Round Trip Time)
   - Time from segment transmission to ACK reception

2. Calculate SRTT (Smoothed RTT)
   SRTT = (1 - Î±) Ã— SRTT + Î± Ã— RTT
   (Î± = 1/8, typically)

3. Calculate RTTVAR (RTT Variance)
   RTTVAR = (1 - Î²) Ã— RTTVAR + Î² Ã— |SRTT - RTT|
   (Î² = 1/4, typically)

4. Calculate RTO
   RTO = SRTT + max(G, 4 Ã— RTTVAR)
   (G = clock granularity)

Example:
  Measured RTT: 100ms, 120ms, 90ms, 110ms
  SRTT â‰ˆ 105ms
  RTTVAR â‰ˆ 10ms
  RTO = 105 + 4 Ã— 10 = 145ms
</code></pre></div>

<hr />
<h2 id="6-flow-control">6. Flow Control<a class="header-link" href="#6-flow-control" title="Permanent link">&para;</a></h2>
<h3 id="61-sliding-window">6.1 Sliding Window<a class="header-link" href="#61-sliding-window" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">Sliding</span><span class="w"> </span><span class="nv">Window</span><span class="w"> </span><span class="nv">Concept</span>

<span class="k">Send</span><span class="w"> </span><span class="nv">Buffer</span>:
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚<span class="w"> </span><span class="mi">1</span><span class="w"> </span>â”‚<span class="w"> </span><span class="mi">2</span><span class="w"> </span>â”‚<span class="w"> </span><span class="mi">3</span><span class="w"> </span>â”‚<span class="w"> </span><span class="mi">4</span><span class="w"> </span>â”‚<span class="w"> </span><span class="mi">5</span><span class="w"> </span>â”‚<span class="w"> </span><span class="mi">6</span><span class="w"> </span>â”‚<span class="w"> </span><span class="mi">7</span><span class="w"> </span>â”‚<span class="w"> </span><span class="mi">8</span><span class="w"> </span>â”‚<span class="w"> </span><span class="mi">9</span><span class="w"> </span>â”‚<span class="mi">10</span><span class="w"> </span>â”‚<span class="mi">11</span><span class="w"> </span>â”‚<span class="mi">12</span><span class="w"> </span>â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
â”‚<span class="nv">ACKed</span>â”‚<span class="w">    </span><span class="nv">Window</span><span class="w"> </span><span class="ss">(</span><span class="nv">can</span><span class="w"> </span><span class="k">send</span><span class="ss">)</span><span class="w">      </span>â”‚<span class="w">   </span><span class="nv">Cannot</span><span class="w"> </span><span class="k">send</span><span class="w"> </span><span class="nv">yet</span>â”‚
â”‚<span class="w">     </span>â”‚â—„â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">Window</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚<span class="w">                    </span>â”‚

<span class="nv">Control</span><span class="w"> </span><span class="nv">transmission</span><span class="w"> </span><span class="nv">volume</span><span class="w"> </span><span class="nv">based</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">receive</span><span class="w"> </span><span class="nv">window</span><span class="w"> </span><span class="nv">size</span>:

<span class="nv">Window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5000</span>:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">     </span><span class="nv">Can</span><span class="w"> </span><span class="k">send</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="nv">without</span><span class="w"> </span><span class="nv">ACK</span><span class="w">        </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ss">(</span><span class="nv">Zero</span><span class="w"> </span><span class="nv">Window</span><span class="ss">)</span>:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">     </span><span class="nv">Stop</span><span class="w"> </span><span class="nv">transmission</span><span class="o">!</span><span class="w"> </span><span class="nv">Receiver</span><span class="w"> </span><span class="nv">buffer</span><span class="w"> </span><span class="nv">full</span><span class="w">      </span>â”‚
â”‚<span class="w">     </span><span class="nv">Periodic</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">Window</span><span class="w"> </span><span class="nv">Probe</span><span class="w">            </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62-window-size-adjustment">6.2 Window Size Adjustment<a class="header-link" href="#62-window-size-adjustment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Window Size Changes

Sender                               Receiver
    â”‚                                  â”‚ rcvbuf=4000
    â”‚â”€â”€ 1000B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Window=3000
    â”‚â”€â”€ 1000B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Window=2000
    â”‚â”€â”€ 1000B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Window=1000
    â”‚                                  â”‚
    â”‚â—„â”€â”€â”€ ACK, Window=0 (buffer full) â”€â”‚
    â”‚                                  â”‚
    â”‚     (Application reads data)      â”‚
    â”‚                                  â”‚
    â”‚â—„â”€â”€â”€ ACK, Window=4000 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                                  â”‚
    â”‚â”€â”€ 1000B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚â”€â”€ 1000B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
</code></pre></div>

<h3 id="63-window-scale-option">6.3 Window Scale Option<a class="header-link" href="#63-window-scale-option" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">Default</span><span class="w"> </span><span class="nv">window</span><span class="w"> </span><span class="nv">size</span>:<span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">max</span><span class="w"> </span><span class="mi">65</span>,<span class="mi">535</span><span class="w"> </span><span class="nv">bytes</span>

<span class="nv">Insufficient</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">high</span><span class="o">-</span><span class="nv">speed</span><span class="w"> </span><span class="nv">networks</span>:
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="nv">Mbps</span>,<span class="w"> </span><span class="nv">RTT</span><span class="w"> </span><span class="mi">100</span><span class="nv">ms</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">BDP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span>Ã—<span class="w"> </span><span class="mi">0</span>.<span class="mi">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>.<span class="mi">25</span><span class="nv">MB</span><span class="w"> </span><span class="nv">needed</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="nv">Gbps</span>,<span class="w"> </span><span class="nv">RTT</span><span class="w"> </span><span class="mi">100</span><span class="nv">ms</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">BDP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span>.<span class="mi">5</span><span class="nv">MB</span><span class="w"> </span><span class="nv">needed</span>

<span class="nv">Window</span><span class="w"> </span><span class="nv">Scale</span><span class="w"> </span><span class="nv">Option</span>:
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Negotiated</span><span class="w"> </span><span class="nv">during</span><span class="w"> </span><span class="mi">3</span><span class="o">-</span><span class="nv">way</span><span class="w"> </span><span class="nv">handshake</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Left</span><span class="o">-</span><span class="nv">shifts</span><span class="w"> </span><span class="nv">window</span><span class="w"> </span><span class="nv">value</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Maximum</span><span class="w"> </span><span class="nv">scale</span>:<span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="ss">(</span><span class="nv">window</span><span class="w"> </span><span class="nv">max</span><span class="w"> </span><span class="o">~</span><span class="mi">1</span><span class="nv">GB</span><span class="ss">)</span>

<span class="nv">Example</span>:
<span class="w">  </span><span class="nv">Window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65535</span>,<span class="w"> </span><span class="nv">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="w">  </span><span class="nv">Actual</span><span class="w"> </span><span class="nv">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65535</span><span class="w"> </span>Ã—<span class="w"> </span><span class="mi">2</span><span class="o">^</span><span class="mi">7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65535</span><span class="w"> </span>Ã—<span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span>,<span class="mi">388</span>,<span class="mi">480</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="ss">(</span><span class="o">~</span><span class="mi">8</span><span class="nv">MB</span><span class="ss">)</span>
</code></pre></div>

<h3 id="64-silly-window-syndrome-prevention">6.4 Silly Window Syndrome Prevention<a class="header-link" href="#64-silly-window-syndrome-prevention" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Problem</span><span class="o">:</span><span class="w"> </span><span class="n">Transmitting</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">segments</span><span class="w"> </span><span class="o">(</span><span class="n">inefficient</span><span class="o">)</span>

<span class="n">Sender</span><span class="w"> </span><span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Nagle</span><span class="s1">&#39;s Algorithm</span>
<span class="s1">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="s1">â”‚  When there&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">data</span><span class="o">:</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">outstanding</span><span class="w"> </span><span class="n">data</span><span class="o">,</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">immediately</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">outstanding</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">exists</span><span class="o">,</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">MSS</span><span class="w"> </span><span class="n">accumulated</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">or</span><span class="w"> </span><span class="n">ACK</span><span class="w"> </span><span class="n">received</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="n">Receiver</span><span class="w"> </span><span class="n">Solution</span><span class="o">:</span><span class="w"> </span><span class="n">Delayed</span><span class="w"> </span><span class="n">ACK</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Clark</span><span class="s1">&#39;s Solution</span>
<span class="s1">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="s1">â”‚  1. Don&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">ACK</span><span class="w"> </span><span class="n">immediately</span><span class="o">,</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="mi">200</span><span class="n">ms</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="n">Window</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">MSS</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="mi">50</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="n">available</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="7-congestion-control">7. Congestion Control<a class="header-link" href="#7-congestion-control" title="Permanent link">&para;</a></h2>
<h3 id="71-congestion-control-overview">7.1 Congestion Control Overview<a class="header-link" href="#71-congestion-control-overview" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TCP Congestion Control                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Purpose: Detect network congestion and adjust transmission rateâ”‚
â”‚                                                                  â”‚
â”‚  Key Variables:                                                 â”‚
â”‚  - cwnd (Congestion Window): Sender-determined window           â”‚
â”‚  - rwnd (Receive Window): Receiver-advertised window            â”‚
â”‚  - Actual transmission = min(cwnd, rwnd)                        â”‚
â”‚                                                                  â”‚
â”‚  ssthresh (Slow Start Threshold):                               â”‚
â”‚  - Boundary between Slow Start and Congestion Avoidance         â”‚
â”‚  - Adjusted on congestion                                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="72-slow-start">7.2 Slow Start<a class="header-link" href="#72-slow-start" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Slow</span><span class="w"> </span><span class="nx">Start</span><span class="w"> </span><span class="nx">Operation</span>

<span class="w">                </span><span class="nx">cwnd</span><span class="w"> </span><span class="nx">Change</span>
<span class="w">               </span><span class="err">â”‚</span>
<span class="w">       </span><span class="mi">64</span><span class="w"> </span><span class="nx">MSS</span><span class="w">  </span><span class="err">â”¤</span><span class="w">                              </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">congestion</span><span class="p">)</span>
<span class="w">               </span><span class="err">â”‚</span><span class="w">                            </span><span class="o">*</span>
<span class="w">       </span><span class="mi">32</span><span class="w"> </span><span class="nx">MSS</span><span class="w">  </span><span class="err">â”¤</span><span class="w">                          </span><span class="o">*</span>
<span class="w">               </span><span class="err">â”‚</span><span class="w">                        </span><span class="o">*</span>
<span class="w">       </span><span class="mi">16</span><span class="w"> </span><span class="nx">MSS</span><span class="w">  </span><span class="err">â”¤</span><span class="w">                      </span><span class="o">*</span>
<span class="w">               </span><span class="err">â”‚</span><span class="w">                    </span><span class="o">*</span>
<span class="w">        </span><span class="mi">8</span><span class="w"> </span><span class="nx">MSS</span><span class="w">  </span><span class="err">â”¤</span><span class="w">                  </span><span class="o">*</span>
<span class="w">               </span><span class="err">â”‚</span><span class="w">                </span><span class="o">*</span>
<span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="nx">MSS</span><span class="w">  </span><span class="err">â”¤</span><span class="w">              </span><span class="o">*</span>
<span class="w">               </span><span class="err">â”‚</span><span class="w">            </span><span class="o">*</span>
<span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="nx">MSS</span><span class="w">  </span><span class="err">â”¤</span><span class="w">          </span><span class="o">*</span>
<span class="w">               </span><span class="err">â”‚</span><span class="w">        </span><span class="o">*</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="nx">MSS</span><span class="w">  </span><span class="err">â”¤</span><span class="w">      </span><span class="o">*</span>
<span class="w">               </span><span class="err">â”‚</span>
<span class="w">               </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="nx">RTT</span>
<span class="w">                    </span><span class="mi">1</span><span class="w">   </span><span class="mi">2</span><span class="w">   </span><span class="mi">3</span><span class="w">   </span><span class="mi">4</span><span class="w">   </span><span class="mi">5</span><span class="w">   </span><span class="mi">6</span>

<span class="nx">Rules</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="nx">Initial</span><span class="w"> </span><span class="nx">cwnd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nx">MSS</span><span class="w"> </span><span class="p">(</span><span class="k">or</span><span class="w"> </span><span class="nx">IW</span><span class="p">=</span><span class="mi">10</span><span class="w"> </span><span class="nx">MSS</span><span class="p">,</span><span class="w"> </span><span class="nx">modern</span><span class="w"> </span><span class="nx">implementations</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="nx">For</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">ACK</span><span class="p">,</span><span class="w"> </span><span class="nx">cwnd</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nx">MSS</span>
<span class="o">-</span><span class="w"> </span><span class="nx">Result</span><span class="p">:</span><span class="w"> </span><span class="nx">cwnd</span><span class="w"> </span><span class="nx">doubles</span><span class="w"> </span><span class="nx">every</span><span class="w"> </span><span class="nx">RTT</span><span class="w"> </span><span class="p">(</span><span class="nx">exponential</span><span class="w"> </span><span class="nx">growth</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="nx">Switch</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Congestion</span><span class="w"> </span><span class="nx">Avoidance</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">ssthresh</span><span class="w"> </span><span class="nx">reached</span>
</code></pre></div>

<h3 id="73-congestion-avoidance">7.3 Congestion Avoidance<a class="header-link" href="#73-congestion-avoidance" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Congestion Avoidance Operation

                cwnd Change
               â”‚
               â”‚  ssthresh                    <span class="gs">* (congestion)</span>
<span class="gs">        16 MSS â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*</span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*â”€â”€*
               â”‚           <span class="gs">*   *</span>       <span class="gs">*</span>
<span class="gs">               â”‚         *</span>      <span class="gs">*    *</span>
               â”‚       <span class="gs">*          *</span>
               â”‚     <span class="gs">*       Linear increase (AIMD)</span>
<span class="gs">               â”‚   *</span>
               â”‚ <span class="gs">*  Slow Start (exponential)</span>
<span class="gs">               â”‚*</span>
               â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RTT

Rules:
<span class="k">-</span> Operates when cwnd &gt;= ssthresh
<span class="k">-</span> For each RTT, cwnd += 1 MSS (or cwnd += MSS/cwnd per ACK)
<span class="k">-</span> Linear increase (Additive Increase)
</code></pre></div>

<h3 id="74-congestion-detection-and-response">7.4 Congestion Detection and Response<a class="header-link" href="#74-congestion-detection-and-response" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Congestion Detection Methods:

1. Timeout (RTO expiration)
   - Judged as severe congestion
   - ssthresh = cwnd / 2
   - cwnd = 1 MSS
   - Restart Slow Start

2. 3 Duplicate ACKs (Fast Retransmit)
   - Judged as mild congestion
   - ssthresh = cwnd / 2
   - cwnd = ssthresh + 3 MSS
   - Enter Fast Recovery

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Congestion Control State Transition          â”‚
â”‚                                                                  â”‚
â”‚  Slow Start â”€â”€(cwnd &gt;= ssthresh)â”€â”€â–º Congestion Avoidance        â”‚
â”‚      â”‚                                        â”‚                  â”‚
â”‚      â”‚                                        â”‚                  â”‚
â”‚   (timeout)                              (3 dup ACKs)            â”‚
â”‚      â”‚                                        â”‚                  â”‚
â”‚      â–¼                                        â–¼                  â”‚
â”‚  Slow Start â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Fast Recovery             â”‚
â”‚                    (recovery complete)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="75-fast-retransmit-and-fast-recovery">7.5 Fast Retransmit and Fast Recovery<a class="header-link" href="#75-fast-retransmit-and-fast-recovery" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">Fast</span><span class="w"> </span><span class="nv">Retransmit</span><span class="w"> </span><span class="nv">Scenario</span>

<span class="nv">Sender</span><span class="w">                               </span><span class="nv">Receiver</span>
<span class="w">    </span>â”‚<span class="w">                                  </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Seq</span><span class="o">=</span><span class="mi">1000</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Seq</span><span class="o">=</span><span class="mi">2000</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€<span class="nv">X</span><span class="w">              </span>â”‚<span class="w"> </span><span class="ss">(</span><span class="nv">lost</span><span class="ss">)</span>
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Seq</span><span class="o">=</span><span class="mi">3000</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
<span class="w">    </span>â”‚<span class="w">                                  </span>â”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="o">=</span><span class="mi">2000</span><span class="w"> </span><span class="ss">(</span><span class="nv">dup1</span><span class="ss">)</span>â”‚
<span class="w">    </span>â”‚<span class="w">                                  </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Seq</span><span class="o">=</span><span class="mi">4000</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="o">=</span><span class="mi">2000</span><span class="w"> </span><span class="ss">(</span><span class="nv">dup2</span><span class="ss">)</span>â”‚
<span class="w">    </span>â”‚<span class="w">                                  </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Seq</span><span class="o">=</span><span class="mi">5000</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="o">=</span><span class="mi">2000</span><span class="w"> </span><span class="ss">(</span><span class="nv">dup3</span><span class="ss">)</span>â”‚
<span class="w">    </span>â”‚<span class="w">                                  </span>â”‚
<span class="w">    </span>â”‚<span class="w">  </span><span class="nv">Received</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">duplicate</span><span class="w"> </span><span class="nv">ACKs</span><span class="o">!</span><span class="w">      </span>â”‚
<span class="w">    </span>â”‚<span class="w">  </span>â†’<span class="w"> </span><span class="nv">Retransmit</span><span class="w"> </span><span class="nv">immediately</span><span class="w">        </span>â”‚
<span class="w">    </span>â”‚<span class="w">    </span><span class="nv">without</span><span class="w"> </span><span class="nv">waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">RTO</span><span class="w">       </span>â”‚
<span class="w">    </span>â”‚<span class="w">                                  </span>â”‚
<span class="w">    </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Seq</span><span class="o">=</span><span class="mi">2000</span><span class="w"> </span><span class="ss">(</span><span class="nv">retransmit</span><span class="ss">)</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
<span class="w">    </span>â”‚<span class="w">                                  </span>â”‚
<span class="w">    </span>â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="o">=</span><span class="mi">6000</span><span class="w"> </span>â”‚

<span class="nv">Fast</span><span class="w"> </span><span class="nv">Recovery</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">After</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">dup</span><span class="w"> </span><span class="nv">ACKs</span>,<span class="w"> </span><span class="nv">ssthresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cwnd</span><span class="o">/</span><span class="mi">2</span>
<span class="o">-</span><span class="w"> </span><span class="nv">cwnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ssthresh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ss">(</span><span class="nv">account</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">received</span><span class="w"> </span><span class="nv">segments</span><span class="ss">)</span>
<span class="o">-</span><span class="w"> </span><span class="nv">On</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ACK</span>,<span class="w"> </span><span class="nv">cwnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ssthresh</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Switch</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">Congestion</span><span class="w"> </span><span class="nv">Avoidance</span>
</code></pre></div>

<h3 id="76-modern-congestion-control-algorithms">7.6 Modern Congestion Control Algorithms<a class="header-link" href="#76-modern-congestion-control-algorithms" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Features</th>
<th>Environment</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reno</td>
<td>Basic AIMD, Fast Recovery</td>
<td>Standard</td>
</tr>
<tr>
<td>NewReno</td>
<td>Improved partial ACK handling</td>
<td>Reno improvement</td>
</tr>
<tr>
<td>CUBIC</td>
<td>BIC improvement, Linux default</td>
<td>High-speed networks</td>
</tr>
<tr>
<td>BBR</td>
<td>Bandwidth/RTT based</td>
<td>Google, high latency networks</td>
</tr>
<tr>
<td>Vegas</td>
<td>RTT change based</td>
<td>Low latency environments</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code>CUBIC cwnd Growth

cwnd
  â”‚
  â”‚                              <span class="gs">*</span>
<span class="gs">  â”‚                           *</span>     <span class="gs">*</span>
<span class="gs">  â”‚                        *</span>           <span class="gs">*</span>
<span class="gs">  â”‚                     *</span>                 <span class="gs">*</span>
<span class="gs">  â”‚                  *</span>                       <span class="gs">*</span>
<span class="gs">  â”‚               *</span>                             <span class="gs">*</span>
<span class="gs">  â”‚            *</span>          cubic function          <span class="gs">*</span>
<span class="gs">  â”‚         *</span>                                        <span class="gs">*</span>
<span class="gs">  â”‚      *</span>
  â”‚   <span class="gs">*</span>
<span class="gs">  â”‚ *</span>
  â”‚*
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ time

Features:
<span class="k">-</span> Remembers W_max (window at last congestion)
<span class="k">-</span> Fast approach to W_max, then slow growth
<span class="k">-</span> Excellent fairness and scalability
</code></pre></div>

<hr />
<h2 id="8-practice-problems">8. Practice Problems<a class="header-link" href="#8-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-3-way-handshake-analysis">Problem 1: 3-Way Handshake Analysis<a class="header-link" href="#problem-1-3-way-handshake-analysis" title="Permanent link">&para;</a></h3>
<p>Analyze the following packet capture.</p>
<div class="highlight"><pre><span></span><code>Packet 1: 192.168.1.10:50000 â†’ 10.0.0.5:443
          SYN, Seq=1000000000

Packet 2: 10.0.0.5:443 â†’ 192.168.1.10:50000
          SYN, ACK, Seq=2000000000, Ack=?

Packet 3: 192.168.1.10:50000 â†’ 10.0.0.5:443
          ACK, Seq=?, Ack=?
</code></pre></div>

<p>a) What is the Ack value in Packet 2?
b) What is the Seq value in Packet 3?
c) What is the Ack value in Packet 3?</p>
<h3 id="problem-2-sequence-number-calculation">Problem 2: Sequence Number Calculation<a class="header-link" href="#problem-2-sequence-number-calculation" title="Permanent link">&para;</a></h3>
<p>Client sends 5000 bytes to server. MSS=1000 bytes.</p>
<p>Calculate Seq number and expected ACK for each segment when initial sequence number is 10000.</p>
<table>
<thead>
<tr>
<th>Segment</th>
<th>Data Size</th>
<th>Seq</th>
<th>Expected ACK</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>1000</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="problem-3-flow-control">Problem 3: Flow Control<a class="header-link" href="#problem-3-flow-control" title="Permanent link">&para;</a></h3>
<p>Receiver's receive buffer is 10000 bytes. Currently 2000 bytes in buffer.</p>
<p>a) What is the advertised window size?
b) If sender transmits 4000 bytes, what's the new window size?
c) If application reads 3000 bytes, what's the new window size?</p>
<h3 id="problem-4-congestion-control">Problem 4: Congestion Control<a class="header-link" href="#problem-4-congestion-control" title="Permanent link">&para;</a></h3>
<p>Starting with ssthresh = 16 MSS, cwnd = 1 MSS.</p>
<p>a) What is cwnd size after 4 RTTs? (no loss)
b) When cwnd = 32 MSS, timeout occurs. What are new ssthresh and cwnd?
c) When cwnd = 24 MSS, 3 duplicate ACKs occur. What are new ssthresh and cwnd?</p>
<hr />
<h2 id="answers">Answers<a class="header-link" href="#answers" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-answers">Problem 1 Answers<a class="header-link" href="#problem-1-answers" title="Permanent link">&para;</a></h3>
<p>a) Packet 2 Ack = <strong>1000000001</strong> (Client Seq + 1)
b) Packet 3 Seq = <strong>1000000001</strong> (SYN counts as 1 byte)
c) Packet 3 Ack = <strong>2000000001</strong> (Server Seq + 1)</p>
<h3 id="problem-2-answers">Problem 2 Answers<a class="header-link" href="#problem-2-answers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Segment</th>
<th>Data Size</th>
<th>Seq</th>
<th>Expected ACK</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1000</td>
<td>10000</td>
<td>11000</td>
</tr>
<tr>
<td>2</td>
<td>1000</td>
<td>11000</td>
<td>12000</td>
</tr>
<tr>
<td>3</td>
<td>1000</td>
<td>12000</td>
<td>13000</td>
</tr>
<tr>
<td>4</td>
<td>1000</td>
<td>13000</td>
<td>14000</td>
</tr>
<tr>
<td>5</td>
<td>1000</td>
<td>14000</td>
<td>15000</td>
</tr>
</tbody>
</table>
<h3 id="problem-3-answers">Problem 3 Answers<a class="header-link" href="#problem-3-answers" title="Permanent link">&para;</a></h3>
<p>a) Advertised window = 10000 - 2000 = <strong>8000 bytes</strong>
b) New window = 10000 - 2000 - 4000 = <strong>4000 bytes</strong>
c) New window = 10000 - (2000 + 4000 - 3000) = <strong>7000 bytes</strong></p>
<h3 id="problem-4-answers">Problem 4 Answers<a class="header-link" href="#problem-4-answers" title="Permanent link">&para;</a></h3>
<p>a) Slow Start phase (cwnd &lt; ssthresh)
   - RTT 1: cwnd = 2 MSS
   - RTT 2: cwnd = 4 MSS
   - RTT 3: cwnd = 8 MSS
   - RTT 4: cwnd = <strong>16 MSS</strong></p>
<p>b) Timeout occurs:
   - New ssthresh = 32 / 2 = <strong>16 MSS</strong>
   - New cwnd = <strong>1 MSS</strong></p>
<p>c) 3 dup ACKs (Fast Retransmit):
   - New ssthresh = 24 / 2 = <strong>12 MSS</strong>
   - New cwnd = 12 + 3 = <strong>15 MSS</strong> (Fast Recovery)</p>
<hr />
<h2 id="9-next-steps">9. Next Steps<a class="header-link" href="#9-next-steps" title="Permanent link">&para;</a></h2>
<p>Once you understand TCP core concepts, learn about UDP and ports.</p>
<h3 id="next-lesson">Next Lesson<a class="header-link" href="#next-lesson" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="./11_UDP_and_Ports.md">11_UDP_and_Ports.md</a> - UDP features, port numbers</li>
</ul>
<h3 id="related-lessons">Related Lessons<a class="header-link" href="#related-lessons" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="./09_Routing_Protocols.md">09_Routing_Protocols.md</a> - Network layer</li>
<li><a href="./12_DNS.md">12_DNS.md</a> - DNS operation principles</li>
</ul>
<h3 id="recommended-practice">Recommended Practice<a class="header-link" href="#recommended-practice" title="Permanent link">&para;</a></h3>
<ol>
<li>Capture TCP 3-way handshake with Wireshark</li>
<li>Check TCP statistics with <code>ss -i</code> or <code>netstat -s</code></li>
<li>Analyze TCP flags with <code>tcpdump</code></li>
</ol>
<hr />
<h2 id="10-references">10. References<a class="header-link" href="#10-references" title="Permanent link">&para;</a></h2>
<h3 id="rfc-documents">RFC Documents<a class="header-link" href="#rfc-documents" title="Permanent link">&para;</a></h3>
<ul>
<li>RFC 793 - TCP Basic Specification</li>
<li>RFC 5681 - TCP Congestion Control</li>
<li>RFC 7323 - TCP Extensions (Window Scaling, Timestamps)</li>
<li>RFC 2018 - TCP Selective Acknowledgment Options</li>
</ul>
<h3 id="command-reference">Command Reference<a class="header-link" href="#command-reference" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check TCP connections (Linux)</span>
ss<span class="w"> </span>-tan
netstat<span class="w"> </span>-an<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>tcp

<span class="c1"># TCP statistics</span>
netstat<span class="w"> </span>-s<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>tcp
cat<span class="w"> </span>/proc/net/snmp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Tcp

<span class="c1"># Check TCP tuning parameters</span>
sysctl<span class="w"> </span>net.ipv4.tcp_congestion_control
sysctl<span class="w"> </span>net.core.rmem_max
sysctl<span class="w"> </span>net.ipv4.tcp_window_scaling

<span class="c1"># Wireshark filters</span>
tcp.flags.syn<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.flags.ack<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="c1"># SYN packets</span>
tcp.analysis.retransmission<span class="w">               </span><span class="c1"># Retransmissions</span>
tcp.analysis.duplicate_ack<span class="w">                </span><span class="c1"># Duplicate ACKs</span>
</code></pre></div>

<h3 id="learning-resources">Learning Resources<a class="header-link" href="#learning-resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://www.amazon.com/TCP-Illustrated-Vol-Addison-Wesley-Professional/dp/0201633469">TCP/IP Illustrated, Vol. 1 - W. Richard Stevens</a></li>
<li><a href="https://hpbn.co/">High Performance Browser Networking</a></li>
<li><a href="https://blog.cloudflare.com/tag/tcp/">Cloudflare Blog - TCP</a></li>
</ul>
<hr />
<p><strong>Document Information</strong>
- Last Updated: 2024
- Difficulty: â­â­â­
- Estimated Learning Time: 3-4 hours</p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Networking/09_Routing_Protocols.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Routing Protocols</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Networking/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Networking/11_UDP_and_Ports.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">UDP and Ports</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}