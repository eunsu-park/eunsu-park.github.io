{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Container Networking - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Networking/">Networking</a>
    <span class="separator">/</span>
    <span class="current">Container Networking</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Container Networking</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Networking/18_IPv6.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">IPv6</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Networking/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-container-networking-fundamentals">1. Container Networking Fundamentals</a><ul>
<li><a href="#network-namespaces">Network Namespaces</a></li>
<li><a href="#virtual-ethernet-veth-pairs">Virtual Ethernet (veth) Pairs</a></li>
<li><a href="#linux-bridge">Linux Bridge</a></li>
<li><a href="#container-networking-architecture">Container Networking Architecture</a></li>
</ul>
</li>
<li><a href="#2-docker-networking-model">2. Docker Networking Model</a><ul>
<li><a href="#container-network-model-cnm">Container Network Model (CNM)</a></li>
<li><a href="#libnetwork">libnetwork</a></li>
<li><a href="#docker-network-commands">Docker Network Commands</a></li>
<li><a href="#default-docker-networks">Default Docker Networks</a></li>
</ul>
</li>
<li><a href="#3-docker-network-drivers">3. Docker Network Drivers</a><ul>
<li><a href="#bridge-network">Bridge Network</a></li>
<li><a href="#host-network">Host Network</a></li>
<li><a href="#overlay-network">Overlay Network</a></li>
<li><a href="#macvlan-network">Macvlan Network</a></li>
<li><a href="#network-driver-comparison">Network Driver Comparison</a></li>
</ul>
</li>
<li><a href="#4-kubernetes-networking-model">4. Kubernetes Networking Model</a><ul>
<li><a href="#kubernetes-network-requirements">Kubernetes Network Requirements</a></li>
<li><a href="#pod-networking">Pod Networking</a></li>
<li><a href="#container-network-interface-cni">Container Network Interface (CNI)</a></li>
</ul>
</li>
<li><a href="#5-cni-plugins-comparison">5. CNI Plugins Comparison</a><ul>
<li><a href="#calico">Calico</a></li>
<li><a href="#cilium">Cilium</a></li>
<li><a href="#flannel">Flannel</a></li>
<li><a href="#weave">Weave</a></li>
<li><a href="#cni-plugin-comparison">CNI Plugin Comparison</a></li>
</ul>
</li>
<li><a href="#6-service-discovery-and-load-balancing">6. Service Discovery and Load Balancing</a><ul>
<li><a href="#kubernetes-services">Kubernetes Services</a></li>
<li><a href="#kube-proxy">kube-proxy</a></li>
<li><a href="#iptables-mode">iptables Mode</a></li>
<li><a href="#ipvs-mode">IPVS Mode</a></li>
<li><a href="#coredns">CoreDNS</a></li>
</ul>
</li>
<li><a href="#7-network-policies">7. Network Policies</a><ul>
<li><a href="#kubernetes-networkpolicy">Kubernetes NetworkPolicy</a></li>
<li><a href="#ingress-and-egress-rules">Ingress and Egress Rules</a></li>
<li><a href="#namespace-isolation">Namespace Isolation</a></li>
<li><a href="#calico-networkpolicy">Calico NetworkPolicy</a></li>
</ul>
</li>
<li><a href="#8-service-mesh">8. Service Mesh</a><ul>
<li><a href="#service-mesh-architecture">Service Mesh Architecture</a></li>
<li><a href="#istio-sidecar-pattern">Istio Sidecar Pattern</a></li>
<li><a href="#mutual-tls-mtls">Mutual TLS (mTLS)</a></li>
<li><a href="#traffic-management">Traffic Management</a></li>
<li><a href="#service-mesh-comparison">Service Mesh Comparison</a></li>
</ul>
</li>
<li><a href="#9-ingress-and-load-balancing">9. Ingress and Load Balancing</a><ul>
<li><a href="#ingress-controller">Ingress Controller</a></li>
<li><a href="#gateway-api">Gateway API</a></li>
<li><a href="#external-load-balancer">External Load Balancer</a></li>
</ul>
</li>
<li><a href="#10-troubleshooting-container-networks">10. Troubleshooting Container Networks</a><ul>
<li><a href="#docker-networking-troubleshooting">Docker Networking Troubleshooting</a></li>
<li><a href="#kubernetes-networking-troubleshooting">Kubernetes Networking Troubleshooting</a></li>
<li><a href="#network-diagnostic-tools">Network Diagnostic Tools</a></li>
</ul>
</li>
<li><a href="#11-practice-problems">11. Practice Problems</a><ul>
<li><a href="#problem-1-docker-custom-network">Problem 1: Docker Custom Network</a></li>
<li><a href="#problem-2-kubernetes-service">Problem 2: Kubernetes Service</a></li>
<li><a href="#problem-3-networkpolicy">Problem 3: NetworkPolicy</a></li>
<li><a href="#problem-4-debugging-network-issue">Problem 4: Debugging Network Issue</a></li>
<li><a href="#problem-5-service-mesh-traffic-splitting">Problem 5: Service Mesh Traffic Splitting</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="container-networking">Container Networking<a class="header-link" href="#container-networking" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand Linux network namespaces and virtual networking</li>
<li>Master Docker networking architecture and network drivers</li>
<li>Learn Kubernetes networking model and CNI plugins</li>
<li>Understand service discovery and load balancing in containers</li>
<li>Implement network policies for security</li>
<li>Learn service mesh concepts and implementations</li>
<li>Configure ingress and external load balancing</li>
<li>Troubleshoot container networking issues</li>
</ul>
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-container-networking-fundamentals">Container Networking Fundamentals</a></li>
<li><a href="#2-docker-networking-model">Docker Networking Model</a></li>
<li><a href="#3-docker-network-drivers">Docker Network Drivers</a></li>
<li><a href="#4-kubernetes-networking-model">Kubernetes Networking Model</a></li>
<li><a href="#5-cni-plugins-comparison">CNI Plugins Comparison</a></li>
<li><a href="#6-service-discovery-and-load-balancing">Service Discovery and Load Balancing</a></li>
<li><a href="#7-network-policies">Network Policies</a></li>
<li><a href="#8-service-mesh">Service Mesh</a></li>
<li><a href="#9-ingress-and-load-balancing">Ingress and Load Balancing</a></li>
<li><a href="#10-troubleshooting-container-networks">Troubleshooting Container Networks</a></li>
<li><a href="#11-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-container-networking-fundamentals">1. Container Networking Fundamentals<a class="header-link" href="#1-container-networking-fundamentals" title="Permanent link">&para;</a></h2>
<h3 id="network-namespaces">Network Namespaces<a class="header-link" href="#network-namespaces" title="Permanent link">&para;</a></h3>
<p>Network namespaces provide network isolation in Linux:</p>
<div class="highlight"><pre><span></span><code>Default Namespace                  Container Namespace
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  eth0: 10.0.1.10   â”‚            â”‚  eth0: 172.17.0.2  â”‚
â”‚                    â”‚            â”‚  (inside container)â”‚
â”‚  Routing Table     â”‚            â”‚  Routing Table     â”‚
â”‚  Firewall Rules    â”‚            â”‚  Firewall Rules    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Creating a network namespace:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create namespace</span>
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span>add<span class="w"> </span>my_namespace

<span class="c1"># List namespaces</span>
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span>list

<span class="c1"># Execute command in namespace</span>
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>my_namespace<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>show

<span class="c1"># Enter namespace shell</span>
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>my_namespace<span class="w"> </span>bash
</code></pre></div>

<h3 id="virtual-ethernet-veth-pairs">Virtual Ethernet (veth) Pairs<a class="header-link" href="#virtual-ethernet-veth-pairs" title="Permanent link">&para;</a></h3>
<p>veth pairs are virtual cable connections:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Namespace A   â”‚               â”‚   Namespace B   â”‚
â”‚                 â”‚               â”‚                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    veth0 â†â”€â”€â”€â”¼â”€â”€â”€â†’ veth1       â”‚
â”‚   â”‚  veth0   â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚10.0.0.1  â”‚  â”‚               â”‚   â”‚10.0.0.2â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Creating veth pair:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create veth pair</span>
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span>add<span class="w"> </span>veth0<span class="w"> </span><span class="nb">type</span><span class="w"> </span>veth<span class="w"> </span>peer<span class="w"> </span>name<span class="w"> </span>veth1

<span class="c1"># Move veth1 to namespace</span>
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>veth1<span class="w"> </span>netns<span class="w"> </span>my_namespace

<span class="c1"># Configure veth0 (host side)</span>
sudo<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">10</span>.0.0.1/24<span class="w"> </span>dev<span class="w"> </span>veth0
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>veth0<span class="w"> </span>up

<span class="c1"># Configure veth1 (namespace side)</span>
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>my_namespace<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">10</span>.0.0.2/24<span class="w"> </span>dev<span class="w"> </span>veth1
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>my_namespace<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>veth1<span class="w"> </span>up
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>my_namespace<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>lo<span class="w"> </span>up

<span class="c1"># Test connectivity</span>
ping<span class="w"> </span><span class="m">10</span>.0.0.2
</code></pre></div>

<h3 id="linux-bridge">Linux Bridge<a class="header-link" href="#linux-bridge" title="Permanent link">&para;</a></h3>
<p>Bridge connects multiple network interfaces:</p>
<div class="highlight"><pre><span></span><code>                   Linux Bridge (br0)
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚              â”‚              â”‚
      veth0          veth2          veth4          eth0 (host)
         â”‚              â”‚              â”‚              â”‚
         â”‚              â”‚              â”‚              â”‚
    Container 1    Container 2    Container 3     Physical Net
  172.17.0.2/16  172.17.0.3/16  172.17.0.4/16
</code></pre></div>

<p><strong>Creating a bridge:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create bridge</span>
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span>add<span class="w"> </span>br0<span class="w"> </span><span class="nb">type</span><span class="w"> </span>bridge
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>br0<span class="w"> </span>up
sudo<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">172</span>.17.0.1/16<span class="w"> </span>dev<span class="w"> </span>br0

<span class="c1"># Create container namespace and veth pair</span>
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span>add<span class="w"> </span>container1
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span>add<span class="w"> </span>veth0<span class="w"> </span><span class="nb">type</span><span class="w"> </span>veth<span class="w"> </span>peer<span class="w"> </span>name<span class="w"> </span>veth1

<span class="c1"># Connect veth1 to container</span>
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>veth1<span class="w"> </span>netns<span class="w"> </span>container1

<span class="c1"># Connect veth0 to bridge</span>
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>veth0<span class="w"> </span>master<span class="w"> </span>br0
sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>veth0<span class="w"> </span>up

<span class="c1"># Configure container interface</span>
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container1<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">172</span>.17.0.2/16<span class="w"> </span>dev<span class="w"> </span>veth1
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container1<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>veth1<span class="w"> </span>up
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container1<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>lo<span class="w"> </span>up
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container1<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span>default<span class="w"> </span>via<span class="w"> </span><span class="m">172</span>.17.0.1

<span class="c1"># Enable NAT for internet access</span>
sudo<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-s<span class="w"> </span><span class="m">172</span>.17.0.0/16<span class="w"> </span>!<span class="w"> </span>-o<span class="w"> </span>br0<span class="w"> </span>-j<span class="w"> </span>MASQUERADE
</code></pre></div>

<h3 id="container-networking-architecture">Container Networking Architecture<a class="header-link" href="#container-networking-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Host OS                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Docker Bridge (docker0)                  â”‚ â”‚
â”‚  â”‚                  172.17.0.1/16                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚        â”‚              â”‚              â”‚              â”‚      â”‚
â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚
â”‚   â”‚  veth0  â”‚    â”‚  veth2  â”‚   â”‚  veth4  â”‚   â”‚  veth6  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚        â”‚              â”‚              â”‚              â”‚      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚  â”‚ Container1 â”‚ â”‚ Container2 â”‚ â”‚ Container3 â”‚ â”‚Container4â”‚
â”‚  â”‚ 172.17.0.2 â”‚ â”‚ 172.17.0.3 â”‚ â”‚ 172.17.0.4 â”‚ â”‚172.17.0.5â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-docker-networking-model">2. Docker Networking Model<a class="header-link" href="#2-docker-networking-model" title="Permanent link">&para;</a></h2>
<h3 id="container-network-model-cnm">Container Network Model (CNM)<a class="header-link" href="#container-network-model-cnm" title="Permanent link">&para;</a></h3>
<p>Docker uses CNM with three components:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Docker Engine                        â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Sandbox  â”‚   â”‚ Endpoint â”‚   â”‚ Network  â”‚          â”‚
â”‚  â”‚          â”‚   â”‚          â”‚   â”‚          â”‚          â”‚
â”‚  â”‚ (netns)  â”‚â”€â”€â–¶â”‚  (veth)  â”‚â”€â”€â–¶â”‚ (bridge) â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

- Sandbox: Container&#39;s network stack (namespace)
- Endpoint: Virtual network interface (veth)
- Network: Virtual switch (bridge, overlay, etc.)
</code></pre></div>

<h3 id="libnetwork">libnetwork<a class="header-link" href="#libnetwork" title="Permanent link">&para;</a></h3>
<p>Docker's networking library:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Docker Engine                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              libnetwork                             â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Bridge  â”‚  â”‚  Overlay â”‚  â”‚  Macvlan â”‚  ...    â”‚
â”‚  â”‚  Driver  â”‚  â”‚  Driver  â”‚  â”‚  Driver  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="docker-network-commands">Docker Network Commands<a class="header-link" href="#docker-network-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># List networks</span>
docker<span class="w"> </span>network<span class="w"> </span>ls

<span class="c1"># Inspect network</span>
docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>bridge

<span class="c1"># Create network</span>
docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>my_network

<span class="c1"># Connect container to network</span>
docker<span class="w"> </span>network<span class="w"> </span>connect<span class="w"> </span>my_network<span class="w"> </span>my_container

<span class="c1"># Disconnect container</span>
docker<span class="w"> </span>network<span class="w"> </span>disconnect<span class="w"> </span>my_network<span class="w"> </span>my_container

<span class="c1"># Remove network</span>
docker<span class="w"> </span>network<span class="w"> </span>rm<span class="w"> </span>my_network

<span class="c1"># Run container on specific network</span>
docker<span class="w"> </span>run<span class="w"> </span>--network<span class="w"> </span>my_network<span class="w"> </span>nginx
</code></pre></div>

<h3 id="default-docker-networks">Default Docker Networks<a class="header-link" href="#default-docker-networks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># List default networks</span>
docker<span class="w"> </span>network<span class="w"> </span>ls

NETWORK<span class="w"> </span>ID<span class="w">     </span>NAME<span class="w">      </span>DRIVER<span class="w">    </span>SCOPE
abcdef123456<span class="w">   </span>bridge<span class="w">    </span>bridge<span class="w">    </span><span class="nb">local</span>
1234567890ab<span class="w">   </span>host<span class="w">      </span>host<span class="w">      </span><span class="nb">local</span>
fedcba098765<span class="w">   </span>none<span class="w">      </span>null<span class="w">      </span><span class="nb">local</span>
</code></pre></div>

<hr />
<h2 id="3-docker-network-drivers">3. Docker Network Drivers<a class="header-link" href="#3-docker-network-drivers" title="Permanent link">&para;</a></h2>
<h3 id="bridge-network">Bridge Network<a class="header-link" href="#bridge-network" title="Permanent link">&para;</a></h3>
<p>Default network driver:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Host                              â”‚
â”‚                                                      â”‚
â”‚  eth0 (10.0.1.10)                                    â”‚
â”‚       â”‚                                              â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚       â””â”€â”€â”‚   docker0 (172.17.0.1/16)          â”‚     â”‚
â”‚          â”‚   (Linux Bridge)                   â”‚     â”‚
â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜     â”‚
â”‚               â”‚              â”‚             â”‚        â”‚
â”‚          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”‚
â”‚          â”‚ nginx   â”‚    â”‚  redis  â”‚  â”‚  mysql  â”‚   â”‚
â”‚          â”‚.17.0.2  â”‚    â”‚ .17.0.3 â”‚  â”‚ .17.0.4 â”‚   â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Creating a custom bridge:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create custom bridge network</span>
docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--driver<span class="w"> </span>bridge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--subnet<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--gateway<span class="w"> </span><span class="m">192</span>.168.1.1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>my_bridge

<span class="c1"># Run containers</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>--network<span class="w"> </span>my_bridge<span class="w"> </span>nginx
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>db<span class="w"> </span>--network<span class="w"> </span>my_bridge<span class="w"> </span>mysql

<span class="c1"># Containers can communicate by name</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ping<span class="w"> </span>db
</code></pre></div>

<p><strong>Port publishing:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Publish port 80 to host port 8080</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx

<span class="c1"># iptables NAT rule created:</span>
<span class="c1"># DNAT: Host:8080 â†’ Container:80</span>
</code></pre></div>

<h3 id="host-network">Host Network<a class="header-link" href="#host-network" title="Permanent link">&para;</a></h3>
<p>Container shares host's network stack:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Host                              â”‚
â”‚                                                      â”‚
â”‚  eth0 (10.0.1.10)                                    â”‚
â”‚       â”‚                                              â”‚
â”‚       â”‚  (Same network namespace)                    â”‚
â”‚       â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Container (--network host)           â”‚          â”‚
â”‚  â”‚  Listens on 10.0.1.10:80              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Usage:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run with host network</span>
docker<span class="w"> </span>run<span class="w"> </span>--network<span class="w"> </span>host<span class="w"> </span>nginx

<span class="c1"># No port publishing needed</span>
<span class="c1"># Container binds directly to host&#39;s ports</span>
</code></pre></div>

<p><strong>Pros:</strong>
- Best performance (no NAT)
- Simple configuration</p>
<p><strong>Cons:</strong>
- No network isolation
- Port conflicts possible</p>
<h3 id="overlay-network">Overlay Network<a class="header-link" href="#overlay-network" title="Permanent link">&para;</a></h3>
<p>Multi-host networking:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Host 1 (10.0.1.10)   â”‚      â”‚       Host 2 (10.0.1.11)   â”‚
â”‚                            â”‚      â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Container A          â”‚  â”‚      â”‚  â”‚ Container B          â”‚  â”‚
â”‚  â”‚ 10.0.9.2 (overlay)   â”‚  â”‚      â”‚  â”‚ 10.0.9.3 (overlay)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚ VXLAN        â”‚      â”‚             â”‚ VXLAN        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ br0 (overlay bridge) â”‚  â”‚      â”‚  â”‚ br0 (overlay bridge) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚              â”‚      â”‚             â”‚              â”‚
â”‚          eth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ eth0            â”‚
â”‚        10.0.1.10           â”‚      â”‚        10.0.1.11           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         Encapsulated traffic (VXLAN over UDP 4789)
</code></pre></div>

<p><strong>Creating overlay network (Docker Swarm):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Initialize swarm</span>
docker<span class="w"> </span>swarm<span class="w"> </span>init

<span class="c1"># Create overlay network</span>
docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--driver<span class="w"> </span>overlay<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--subnet<span class="w"> </span><span class="m">10</span>.0.9.0/24<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>my_overlay

<span class="c1"># Deploy service on overlay</span>
docker<span class="w"> </span>service<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>web<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--network<span class="w"> </span>my_overlay<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--replicas<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>nginx
</code></pre></div>

<h3 id="macvlan-network">Macvlan Network<a class="header-link" href="#macvlan-network" title="Permanent link">&para;</a></h3>
<p>Assign MAC addresses to containers:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Host                              â”‚
â”‚                                                      â”‚
â”‚  eth0 (10.0.1.10) â”€â”€â”€ Physical Network              â”‚
â”‚       â”‚                                              â”‚
â”‚       â”‚  (Macvlan in bridge mode)                    â”‚
â”‚       â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    â”‚              â”‚             â”‚              â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚ â”‚nginx  â”‚    â”‚  redis  â”‚  â”‚  mysql  â”‚         â”‚ â”‚
â”‚  â”‚ â”‚.0.1.20â”‚    â”‚ .0.1.21 â”‚  â”‚ .0.1.22 â”‚         â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â”‚ (Appears on physical network with own MAC)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Creating macvlan network:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create macvlan network</span>
docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>macvlan<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--subnet<span class="o">=</span><span class="m">10</span>.0.1.0/24<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--gateway<span class="o">=</span><span class="m">10</span>.0.1.1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-o<span class="w"> </span><span class="nv">parent</span><span class="o">=</span>eth0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>my_macvlan

<span class="c1"># Run container</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--network<span class="w"> </span>my_macvlan<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ip<span class="w"> </span><span class="m">10</span>.0.1.20<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>nginx
</code></pre></div>

<p><strong>Use cases:</strong>
- Legacy applications requiring L2 connectivity
- Container monitoring physical network
- Direct network access without NAT</p>
<h3 id="network-driver-comparison">Network Driver Comparison<a class="header-link" href="#network-driver-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Driver</th>
<th>Isolation</th>
<th>Multi-host</th>
<th>Performance</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Bridge</strong></td>
<td>Yes</td>
<td>No</td>
<td>Good</td>
<td>Single host, development</td>
</tr>
<tr>
<td><strong>Host</strong></td>
<td>No</td>
<td>No</td>
<td>Excellent</td>
<td>Performance-critical</td>
</tr>
<tr>
<td><strong>Overlay</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Good</td>
<td>Multi-host, Swarm/K8s</td>
</tr>
<tr>
<td><strong>Macvlan</strong></td>
<td>Yes</td>
<td>No</td>
<td>Excellent</td>
<td>L2 connectivity needed</td>
</tr>
<tr>
<td><strong>None</strong></td>
<td>Complete</td>
<td>N/A</td>
<td>N/A</td>
<td>No networking required</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4-kubernetes-networking-model">4. Kubernetes Networking Model<a class="header-link" href="#4-kubernetes-networking-model" title="Permanent link">&para;</a></h2>
<h3 id="kubernetes-network-requirements">Kubernetes Network Requirements<a class="header-link" href="#kubernetes-network-requirements" title="Permanent link">&para;</a></h3>
<p>Kubernetes imposes these requirements:</p>
<ol>
<li><strong>All pods can communicate with each other</strong> without NAT</li>
<li><strong>All nodes can communicate with all pods</strong> without NAT</li>
<li><strong>Pod sees its own IP</strong> as others see it (no NAT)</li>
</ol>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Cluster Network                       â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Node 1        â”‚              â”‚    Node 2        â”‚   â”‚
â”‚  â”‚  IP: 10.0.1.10   â”‚              â”‚  IP: 10.0.1.11   â”‚   â”‚
â”‚  â”‚                  â”‚              â”‚                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Pod A     â”‚  â”‚              â”‚  â”‚  Pod C     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ 10.244.1.2 â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚ 10.244.2.2 â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                  â”‚              â”‚                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Pod B     â”‚  â”‚              â”‚  â”‚  Pod D     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ 10.244.1.3 â”‚  â”‚              â”‚  â”‚ 10.244.2.3 â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                            â”‚
â”‚  Pod A can directly communicate with Pod C (10.244.2.2)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="pod-networking">Pod Networking<a class="header-link" href="#pod-networking" title="Permanent link">&para;</a></h3>
<p>Each pod gets its own IP:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Pod (10.244.1.5)                 â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Container A  â”‚  â”‚ Container B  â”‚            â”‚
â”‚  â”‚ localhost:80 â”‚  â”‚localhost:3306â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                 â”‚                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                  â”‚                             â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚          â”‚  Network NS    â”‚                    â”‚
â”‚          â”‚  eth0          â”‚                    â”‚
â”‚          â”‚  10.244.1.5    â”‚                    â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="container-network-interface-cni">Container Network Interface (CNI)<a class="header-link" href="#container-network-interface-cni" title="Permanent link">&para;</a></h3>
<p>CNI is the standard interface for network plugins:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes (kubelet)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ CNI Specification
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                CNI Plugin                        â”‚
â”‚  (Calico, Cilium, Flannel, Weave, etc.)         â”‚
â”‚                                                  â”‚
â”‚  Responsibilities:                               â”‚
â”‚  - Allocate IP to pod                            â”‚
â”‚  - Setup network interface                       â”‚
â”‚  - Configure routing                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>CNI configuration example:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;cniVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;k8s-pod-network&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;calico&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;log_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;datastore_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kubernetes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ipam&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;calico-ipam&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;policy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;k8s&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;kubernetes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;kubeconfig&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/etc/cni/net.d/calico-kubeconfig&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="5-cni-plugins-comparison">5. CNI Plugins Comparison<a class="header-link" href="#5-cni-plugins-comparison" title="Permanent link">&para;</a></h2>
<h3 id="calico">Calico<a class="header-link" href="#calico" title="Permanent link">&para;</a></h3>
<p><strong>Architecture:</strong></p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Calico Components                     â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Felix      â”‚   â”‚    BIRD      â”‚             â”‚
â”‚  â”‚ (Agent)      â”‚   â”‚ (BGP daemon) â”‚             â”‚
â”‚  â”‚ - Routes     â”‚   â”‚ - Route      â”‚             â”‚
â”‚  â”‚ - ACLs       â”‚   â”‚   exchange   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚       etcd / Kubernetes API      â”‚             â”‚
â”‚  â”‚       (Datastore)                â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Features:</strong>
- Pure L3 networking (no overlay)
- BGP route distribution
- Scalable (tested with 1000+ nodes)
- Rich network policy</p>
<p><strong>Network modes:</strong>
- IP-in-IP (encapsulation)
- VXLAN
- Direct/Native (no encapsulation)</p>
<h3 id="cilium">Cilium<a class="header-link" href="#cilium" title="Permanent link">&para;</a></h3>
<p><strong>Architecture:</strong></p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cilium Components                     â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚     eBPF Programs (kernel)       â”‚             â”‚
â”‚  â”‚  - Packet filtering              â”‚             â”‚
â”‚  â”‚  - Load balancing                â”‚             â”‚
â”‚  â”‚  - Network policy                â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚               â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚      Cilium Agent                â”‚             â”‚
â”‚  â”‚  - Identity management           â”‚             â”‚
â”‚  â”‚  - Policy enforcement            â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Features:</strong>
- eBPF-based (Linux kernel technology)
- L7 protocol visibility (HTTP, gRPC, Kafka)
- Identity-based security
- Hubble observability</p>
<p><strong>Use cases:</strong>
- Advanced security policies
- Service mesh without sidecars
- API-aware filtering</p>
<h3 id="flannel">Flannel<a class="header-link" href="#flannel" title="Permanent link">&para;</a></h3>
<p><strong>Architecture:</strong></p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Flannel Components                    â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚     flanneld (agent)             â”‚             â”‚
â”‚  â”‚  - Allocate subnet               â”‚             â”‚
â”‚  â”‚  - Configure VXLAN/host-gw       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚               â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚      etcd / Kubernetes API       â”‚             â”‚
â”‚  â”‚      (Subnet allocation)         â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Features:</strong>
- Simple overlay network
- Multiple backends (VXLAN, host-gw, UDP)
- Easy to deploy
- No network policy support</p>
<p><strong>Backend comparison:</strong>
- VXLAN: Works across L3, some overhead
- host-gw: L2 required, better performance
- UDP: Legacy, poor performance</p>
<h3 id="weave">Weave<a class="header-link" href="#weave" title="Permanent link">&para;</a></h3>
<p><strong>Architecture:</strong></p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Weave Components                      â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚     Weave Router (per node)      â”‚             â”‚
â”‚  â”‚  - Overlay network               â”‚             â”‚
â”‚  â”‚  - Mesh topology                 â”‚             â”‚
â”‚  â”‚  - Encryption (optional)         â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                    â”‚
â”‚  Automatic mesh formation between nodes            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Features:</strong>
- Mesh network topology
- Built-in encryption
- Multicast support
- Network policy support</p>
<h3 id="cni-plugin-comparison">CNI Plugin Comparison<a class="header-link" href="#cni-plugin-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Plugin</th>
<th>Technology</th>
<th>Performance</th>
<th>Features</th>
<th>Complexity</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Calico</strong></td>
<td>BGP/eBPF</td>
<td>Excellent</td>
<td>Rich policy, scalable</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Cilium</strong></td>
<td>eBPF</td>
<td>Excellent</td>
<td>L7 policy, observability</td>
<td>High</td>
</tr>
<tr>
<td><strong>Flannel</strong></td>
<td>VXLAN/host-gw</td>
<td>Good</td>
<td>Simple, reliable</td>
<td>Low</td>
</tr>
<tr>
<td><strong>Weave</strong></td>
<td>Mesh/VXLAN</td>
<td>Good</td>
<td>Encryption, multicast</td>
<td>Medium</td>
</tr>
</tbody>
</table>
<p><strong>Selection criteria:</strong>
- <strong>Simple overlay</strong>: Flannel
- <strong>Network policy + scale</strong>: Calico
- <strong>L7 visibility</strong>: Cilium
- <strong>Encryption</strong>: Weave
- <strong>On-premises, L2</strong>: Calico (BGP)</p>
<hr />
<h2 id="6-service-discovery-and-load-balancing">6. Service Discovery and Load Balancing<a class="header-link" href="#6-service-discovery-and-load-balancing" title="Permanent link">&para;</a></h2>
<h3 id="kubernetes-services">Kubernetes Services<a class="header-link" href="#kubernetes-services" title="Permanent link">&para;</a></h3>
<p>Services provide stable endpoints for pods:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Service (ClusterIP)                   â”‚
â”‚              my-service: 10.96.0.10:80             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ (Load balances to endpoints)
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  Pod A  â”‚  â”‚  Pod B  â”‚  â”‚  Pod C  â”‚
    â”‚10.244.1.2â”‚ â”‚10.244.1.3â”‚ â”‚10.244.2.2â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Service types:</strong></p>
<ol>
<li><strong>ClusterIP (default)</strong>: Internal cluster IP</li>
<li><strong>NodePort</strong>: Exposes on each node's IP at static port</li>
<li><strong>LoadBalancer</strong>: External load balancer (cloud provider)</li>
<li><strong>ExternalName</strong>: CNAME to external service</li>
</ol>
<p><strong>Service definition:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w">        </span><span class="c1"># Service port</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w">  </span><span class="c1"># Container port</span>
</code></pre></div>

<h3 id="kube-proxy">kube-proxy<a class="header-link" href="#kube-proxy" title="Permanent link">&para;</a></h3>
<p>kube-proxy implements service load balancing:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Node                              â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚        kube-proxy                â”‚              â”‚
â”‚  â”‚  Watches Service/Endpoint API   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚               â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Packet forwarding rules       â”‚              â”‚
â”‚  â”‚   (iptables / IPVS / eBPF)      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="iptables-mode">iptables Mode<a class="header-link" href="#iptables-mode" title="Permanent link">&para;</a></h3>
<p>Default mode using iptables NAT:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example iptables rules for service 10.96.0.10:80</span>
<span class="c1"># (Load balance to 3 backends)</span>

<span class="c1"># KUBE-SERVICES chain</span>
-A<span class="w"> </span>KUBE-SERVICES<span class="w"> </span>-d<span class="w"> </span><span class="m">10</span>.96.0.10/32<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-j<span class="w"> </span>KUBE-SVC-XYZ

<span class="c1"># Service chain (probabilistic load balancing)</span>
-A<span class="w"> </span>KUBE-SVC-XYZ<span class="w"> </span>-m<span class="w"> </span>statistic<span class="w"> </span>--mode<span class="w"> </span>random<span class="w"> </span>--probability<span class="w"> </span><span class="m">0</span>.33333<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-j<span class="w"> </span>KUBE-SEP-AAA
-A<span class="w"> </span>KUBE-SVC-XYZ<span class="w"> </span>-m<span class="w"> </span>statistic<span class="w"> </span>--mode<span class="w"> </span>random<span class="w"> </span>--probability<span class="w"> </span><span class="m">0</span>.50000<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-j<span class="w"> </span>KUBE-SEP-BBB
-A<span class="w"> </span>KUBE-SVC-XYZ<span class="w"> </span>-j<span class="w"> </span>KUBE-SEP-CCC

<span class="c1"># Endpoint chains (DNAT to pod IPs)</span>
-A<span class="w"> </span>KUBE-SEP-AAA<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-j<span class="w"> </span>DNAT<span class="w"> </span>--to-destination<span class="w"> </span><span class="m">10</span>.244.1.2:80
-A<span class="w"> </span>KUBE-SEP-BBB<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-j<span class="w"> </span>DNAT<span class="w"> </span>--to-destination<span class="w"> </span><span class="m">10</span>.244.1.3:80
-A<span class="w"> </span>KUBE-SEP-CCC<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-j<span class="w"> </span>DNAT<span class="w"> </span>--to-destination<span class="w"> </span><span class="m">10</span>.244.2.2:80
</code></pre></div>

<p><strong>Pros:</strong>
- Mature, well-tested
- Kernel-level performance</p>
<p><strong>Cons:</strong>
- O(n) rule processing
- Poor performance with 1000+ services</p>
<h3 id="ipvs-mode">IPVS Mode<a class="header-link" href="#ipvs-mode" title="Permanent link">&para;</a></h3>
<p>IP Virtual Server for better performance:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              IPVS Virtual Server                   â”‚
â”‚        10.96.0.10:80 (rr scheduling)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚            â”‚
    10.244.1.2    10.244.1.3   10.244.2.2
    (weight 1)    (weight 1)   (weight 1)
</code></pre></div>

<p><strong>Advantages:</strong>
- O(1) lookup complexity
- Better performance at scale
- Multiple scheduling algorithms (rr, lc, dh, sh, etc.)</p>
<p><strong>Enable IPVS mode:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># kube-proxy config</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubeproxy.config.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KubeProxyConfiguration</span>
<span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ipvs&quot;</span>
<span class="nt">ipvs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scheduler</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rr&quot;</span><span class="w">  </span><span class="c1"># round-robin</span>
</code></pre></div>

<h3 id="coredns">CoreDNS<a class="header-link" href="#coredns" title="Permanent link">&para;</a></h3>
<p>DNS-based service discovery:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CoreDNS                               â”‚
â”‚  Watches Services, creates DNS records             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DNS Records:
- my-service.default.svc.cluster.local â†’ 10.96.0.10
- my-service.default.svc               â†’ 10.96.0.10
- my-service.default                   â†’ 10.96.0.10
- my-service                           â†’ 10.96.0.10
  (from default namespace)

# From pod:
nslookup my-service
# Returns: 10.96.0.10
</code></pre></div>

<p><strong>CoreDNS configuration:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Corefile</span>
<span class="o">.</span><span class="p">:</span><span class="mi">53</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">errors</span>
<span class="w">    </span><span class="n">health</span>
<span class="w">    </span><span class="n">kubernetes</span><span class="w"> </span><span class="n">cluster</span><span class="o">.</span><span class="n">local</span><span class="w"> </span><span class="ow">in</span><span class="o">-</span><span class="n">addr</span><span class="o">.</span><span class="n">arpa</span><span class="w"> </span><span class="n">ip6</span><span class="o">.</span><span class="n">arpa</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">pods</span><span class="w"> </span><span class="n">insecure</span>
<span class="w">      </span><span class="n">fallthrough</span><span class="w"> </span><span class="ow">in</span><span class="o">-</span><span class="n">addr</span><span class="o">.</span><span class="n">arpa</span><span class="w"> </span><span class="n">ip6</span><span class="o">.</span><span class="n">arpa</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">prometheus</span><span class="w"> </span><span class="p">:</span><span class="mi">9153</span>
<span class="w">    </span><span class="n">forward</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">resolv</span><span class="o">.</span><span class="n">conf</span>
<span class="w">    </span><span class="n">cache</span><span class="w"> </span><span class="mi">30</span>
<span class="w">    </span><span class="n">loop</span>
<span class="w">    </span><span class="n">reload</span>
<span class="w">    </span><span class="n">loadbalance</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="7-network-policies">7. Network Policies<a class="header-link" href="#7-network-policies" title="Permanent link">&para;</a></h2>
<h3 id="kubernetes-networkpolicy">Kubernetes NetworkPolicy<a class="header-link" href="#kubernetes-networkpolicy" title="Permanent link">&para;</a></h3>
<p>Control traffic between pods:</p>
<div class="highlight"><pre><span></span><code><span class="n">Default</span><span class="o">:</span><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">allowed</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Pod</span><span class="w"> </span><span class="n">A</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â–¶â”‚</span><span class="w">  </span><span class="n">Pod</span><span class="w"> </span><span class="n">B</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â–¶â”‚</span><span class="w">  </span><span class="n">Pod</span><span class="w"> </span><span class="n">C</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="n">With</span><span class="w"> </span><span class="n">NetworkPolicy</span><span class="o">:</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Pod</span><span class="w"> </span><span class="n">A</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">âœ“</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Pod</span><span class="w"> </span><span class="n">B</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">âœ—</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Pod</span><span class="w"> </span><span class="n">C</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â–¶â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="err">â–¶â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<p><strong>Basic NetworkPolicy:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-from-frontend</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>

<p><strong>Effect:</strong>
- Only pods with label <code>app=frontend</code> can access backend on port 8080
- All other traffic to backend is denied</p>
<h3 id="ingress-and-egress-rules">Ingress and Egress Rules<a class="header-link" href="#ingress-and-egress-rules" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db-network-policy</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Allow from backend pods on port 3306</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Allow DNS</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
<span class="w">    </span><span class="c1"># Allow external backup server</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
<span class="w">            </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.5.0/24</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22</span>
</code></pre></div>

<h3 id="namespace-isolation">Namespace Isolation<a class="header-link" href="#namespace-isolation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Deny all traffic to pods in namespace</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-deny-all</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<span class="c1"># No ingress/egress rules = deny all</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Allow only from same namespace</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow-same-namespace</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w">  </span><span class="c1"># Same namespace</span>
</code></pre></div>

<h3 id="calico-networkpolicy">Calico NetworkPolicy<a class="header-link" href="#calico-networkpolicy" title="Permanent link">&para;</a></h3>
<p>More advanced than Kubernetes NetworkPolicy:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">projectcalico.org/v3</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GlobalNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny-egress-to-metadata-server</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all()</span>
<span class="w">  </span><span class="nt">types</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Deny access to cloud metadata service</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deny</span>
<span class="w">      </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nets</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">169.254.169.254/32</span>
<span class="w">    </span><span class="c1"># Allow all other egress</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
</code></pre></div>

<p><strong>Calico features:</strong>
- Global policies
- Policy ordering
- Layer 7 rules (with Istio)
- Logging/monitoring</p>
<hr />
<h2 id="8-service-mesh">8. Service Mesh<a class="header-link" href="#8-service-mesh" title="Permanent link">&para;</a></h2>
<h3 id="service-mesh-architecture">Service Mesh Architecture<a class="header-link" href="#service-mesh-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Control Plane                         â”‚
â”‚  (Istio Pilot, Citadel, Galley, Telemetry)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Configuration
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         â”‚         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Envoy   â”‚ â”‚ Envoy  â”‚ â”‚ Envoy    â”‚
    â”‚ Proxy   â”‚ â”‚ Proxy  â”‚ â”‚ Proxy    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ App A   â”‚ â”‚ App B  â”‚ â”‚ App C    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="istio-sidecar-pattern">Istio Sidecar Pattern<a class="header-link" href="#istio-sidecar-pattern" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Pod                               â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Application     â”‚   â”‚  Envoy Proxy     â”‚     â”‚
â”‚  â”‚  Container       â”‚â—€â”€â–¶â”‚  (Sidecar)       â”‚     â”‚
â”‚  â”‚  localhost:8080  â”‚   â”‚  - mTLS          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  - Metrics       â”‚     â”‚
â”‚                         â”‚  - Tracing       â”‚     â”‚
â”‚                         â”‚  - Retries       â”‚     â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                              Encrypted traffic
</code></pre></div>

<h3 id="mutual-tls-mtls">Mutual TLS (mTLS)<a class="header-link" href="#mutual-tls-mtls" title="Permanent link">&para;</a></h3>
<p>Service-to-service encryption:</p>
<div class="highlight"><pre><span></span><code>Service A                          Service B
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App        â”‚                   â”‚  App        â”‚
â”‚  â”‚          â”‚                   â”‚  â”‚          â”‚
â”‚  â–¼          â”‚                   â”‚  â–¼          â”‚
â”‚ Envoy       â”‚    mTLS tunnel    â”‚ Envoy       â”‚
â”‚  â”‚          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  â”‚          â”‚
â”‚  â”‚          â”‚  (cert exchange)  â”‚  â”‚          â”‚
â””â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     Encrypted, authenticated traffic
</code></pre></div>

<p><strong>Istio PeerAuthentication:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security.istio.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PeerAuthentication</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mtls</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">STRICT</span><span class="w">  </span><span class="c1"># STRICT, PERMISSIVE, or DISABLE</span>
</code></pre></div>

<h3 id="traffic-management">Traffic Management<a class="header-link" href="#traffic-management" title="Permanent link">&para;</a></h3>
<p><strong>Virtual Service (routing rules):</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.istio.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviews</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviews</span>
<span class="w">  </span><span class="nt">http</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># 90% to v1, 10% to v2 (canary deployment)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">            </span><span class="nt">end-user</span><span class="p">:</span>
<span class="w">              </span><span class="nt">exact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jason</span>
<span class="w">      </span><span class="nt">route</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">            </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviews</span>
<span class="w">            </span><span class="nt">subset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">route</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">            </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviews</span>
<span class="w">            </span><span class="nt">subset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">            </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviews</span>
<span class="w">            </span><span class="nt">subset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</code></pre></div>

<p><strong>Destination Rule (load balancing, circuit breaking):</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.istio.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DestinationRule</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviews</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reviews</span>
<span class="w">  </span><span class="nt">trafficPolicy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">loadBalancer</span><span class="p">:</span>
<span class="w">      </span><span class="nt">simple</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LEAST_REQUEST</span>
<span class="w">    </span><span class="nt">connectionPool</span><span class="p">:</span>
<span class="w">      </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">        </span><span class="nt">maxConnections</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">http1MaxPendingRequests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">        </span><span class="nt">maxRequestsPerConnection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">outlierDetection</span><span class="p">:</span>
<span class="w">      </span><span class="nt">consecutiveErrors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">      </span><span class="nt">baseEjectionTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">  </span><span class="nt">subsets</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
</code></pre></div>

<h3 id="service-mesh-comparison">Service Mesh Comparison<a class="header-link" href="#service-mesh-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Istio</th>
<th>Linkerd</th>
<th>Envoy</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Language</strong></td>
<td>Go/C++</td>
<td>Rust</td>
<td>C++</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td>High</td>
<td>Low</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Resource usage</strong></td>
<td>Heavy</td>
<td>Light</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Features</strong></td>
<td>Extensive</td>
<td>Moderate</td>
<td>Proxy only</td>
</tr>
<tr>
<td><strong>mTLS</strong></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Observability</strong></td>
<td>Extensive</td>
<td>Good</td>
<td>Basic</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9-ingress-and-load-balancing">9. Ingress and Load Balancing<a class="header-link" href="#9-ingress-and-load-balancing" title="Permanent link">&para;</a></h2>
<h3 id="ingress-controller">Ingress Controller<a class="header-link" href="#ingress-controller" title="Permanent link">&para;</a></h3>
<p>HTTP/HTTPS routing to services:</p>
<div class="highlight"><pre><span></span><code>                    Internet
                       â”‚
                 â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                 â”‚  LoadBalancer â”‚
                 â”‚  (Cloud LB)   â”‚
                 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Ingress Controller      â”‚
         â”‚   (nginx/traefik/haproxy) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚Service Aâ”‚   â”‚Service Bâ”‚  â”‚Service Câ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Ingress resource:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-ingress</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/rewrite-target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app1</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1-service</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app2</span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app2-service</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret</span>
</code></pre></div>

<h3 id="gateway-api">Gateway API<a class="header-link" href="#gateway-api" title="Permanent link">&para;</a></h3>
<p>Next-generation Ingress:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gateway</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-gateway</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gatewayClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">listeners</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">      </span><span class="nt">tls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">certificateRefs</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-cert</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.networking.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPRoute</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-route</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">parentRefs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-gateway</span>
<span class="w">  </span><span class="nt">hostnames</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matches</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PathPrefix</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app1</span>
<span class="w">      </span><span class="nt">backendRefs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app1-service</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>

<h3 id="external-load-balancer">External Load Balancer<a class="header-link" href="#external-load-balancer" title="Permanent link">&para;</a></h3>
<p>Cloud provider integration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="c1"># Cloud-specific annotations</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">service.beta.kubernetes.io/aws-load-balancer-type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nlb&quot;</span>
</code></pre></div>

<p><strong>Result:</strong>
- Cloud provider provisions load balancer
- External IP assigned to service
- Traffic routed to NodePorts</p>
<hr />
<h2 id="10-troubleshooting-container-networks">10. Troubleshooting Container Networks<a class="header-link" href="#10-troubleshooting-container-networks" title="Permanent link">&para;</a></h2>
<h3 id="docker-networking-troubleshooting">Docker Networking Troubleshooting<a class="header-link" href="#docker-networking-troubleshooting" title="Permanent link">&para;</a></h3>
<p><strong>Check container network:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Inspect container network</span>
docker<span class="w"> </span>inspect<span class="w"> </span>&lt;container&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.[0].NetworkSettings&#39;</span>

<span class="c1"># Check IP address</span>
docker<span class="w"> </span>inspect<span class="w"> </span>-f<span class="w"> </span><span class="s1">&#39;{{.NetworkSettings.IPAddress}}&#39;</span><span class="w"> </span>&lt;container&gt;

<span class="c1"># List connected networks</span>
docker<span class="w"> </span>inspect<span class="w"> </span>-f<span class="w"> </span><span class="s1">&#39;{{range $net, $conf := .NetworkSettings.Networks}}{{$net}} {{end}}&#39;</span><span class="w"> </span>&lt;container&gt;

<span class="c1"># Enter container network namespace</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;container&gt;<span class="w"> </span>bash
ip<span class="w"> </span>addr<span class="w"> </span>show
ip<span class="w"> </span>route<span class="w"> </span>show
</code></pre></div>

<p><strong>Test connectivity:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Ping from one container to another</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container1<span class="w"> </span>ping<span class="w"> </span>container2

<span class="c1"># Check DNS resolution</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container1<span class="w"> </span>nslookup<span class="w"> </span>container2

<span class="c1"># Check port connectivity</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container1<span class="w"> </span>nc<span class="w"> </span>-zv<span class="w"> </span>container2<span class="w"> </span><span class="m">80</span>
</code></pre></div>

<p><strong>Common issues:</strong></p>
<ol>
<li><strong>Containers can't reach each other:</strong></li>
<li>Check if on same network</li>
<li>Check firewall rules</li>
<li>
<p>Verify DNS resolution</p>
</li>
<li>
<p><strong>Container can't reach internet:</strong></p>
</li>
<li>Check NAT/masquerade rules</li>
<li>Verify default route</li>
<li>
<p>Check DNS configuration</p>
</li>
<li>
<p><strong>Port publishing not working:</strong></p>
</li>
<li>Verify iptables DNAT rules</li>
<li>Check host firewall</li>
<li>Confirm port not already in use</li>
</ol>
<h3 id="kubernetes-networking-troubleshooting">Kubernetes Networking Troubleshooting<a class="header-link" href="#kubernetes-networking-troubleshooting" title="Permanent link">&para;</a></h3>
<p><strong>Pod connectivity:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check pod IP and network</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>&lt;pod&gt;<span class="w"> </span>-o<span class="w"> </span>wide

<span class="c1"># Describe pod (check events)</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>&lt;pod&gt;

<span class="c1"># Check pod network interfaces</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>show

<span class="c1"># Test pod-to-pod connectivity</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod1&gt;<span class="w"> </span>--<span class="w"> </span>ping<span class="w"> </span>&lt;pod2-ip&gt;

<span class="c1"># Test service connectivity</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>curl<span class="w"> </span>http://my-service
</code></pre></div>

<p><strong>Service troubleshooting:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check service endpoints</span>
kubectl<span class="w"> </span>get<span class="w"> </span>endpoints<span class="w"> </span>my-service

<span class="c1"># Verify service DNS</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>nslookup<span class="w"> </span>my-service

<span class="c1"># Check kube-proxy logs</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>-l<span class="w"> </span>k8s-app<span class="o">=</span>kube-proxy

<span class="c1"># Check iptables rules (iptables mode)</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>&lt;kube-proxy-pod&gt;<span class="w"> </span>--<span class="w"> </span>iptables-save<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>&lt;service-name&gt;
</code></pre></div>

<p><strong>CNI troubleshooting:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check CNI plugin pods</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>calico
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>cilium

<span class="c1"># Check CNI logs</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>&lt;cni-pod&gt;

<span class="c1"># Verify CNI configuration</span>
cat<span class="w"> </span>/etc/cni/net.d/*.conf
</code></pre></div>

<p><strong>NetworkPolicy debugging:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check if policy applied</span>
kubectl<span class="w"> </span>get<span class="w"> </span>networkpolicy

<span class="c1"># Describe policy</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>networkpolicy<span class="w"> </span>&lt;policy&gt;

<span class="c1"># Test connectivity before/after policy</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>curl<span class="w"> </span>&lt;target&gt;

<span class="c1"># Check CNI plugin logs (policy enforcement)</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>&lt;calico-node-pod&gt;
</code></pre></div>

<h3 id="network-diagnostic-tools">Network Diagnostic Tools<a class="header-link" href="#network-diagnostic-tools" title="Permanent link">&para;</a></h3>
<p><strong>Container debugging image:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run debug container with network tools</span>
kubectl<span class="w"> </span>run<span class="w"> </span>debug<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>--image<span class="o">=</span>nicolaka/netshoot<span class="w"> </span>--<span class="w"> </span>bash

<span class="c1"># Tools included:</span>
<span class="c1"># - tcpdump, wireshark</span>
<span class="c1"># - curl, wget, httpie</span>
<span class="c1"># - nslookup, dig, host</span>
<span class="c1"># - netcat, socat</span>
<span class="c1"># - iperf3, mtr, traceroute</span>
</code></pre></div>

<p><strong>Ephemeral debug container (K8s 1.23+):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Attach debug container to existing pod</span>
kubectl<span class="w"> </span>debug<span class="w"> </span>-it<span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--image<span class="o">=</span>nicolaka/netshoot<span class="w"> </span>--target<span class="o">=</span>&lt;container&gt;
</code></pre></div>

<p><strong>Packet capture:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Capture traffic on pod interface</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>-w<span class="w"> </span>/tmp/capture.pcap

<span class="c1"># Copy to local machine</span>
kubectl<span class="w"> </span>cp<span class="w"> </span>&lt;pod&gt;:/tmp/capture.pcap<span class="w"> </span>./capture.pcap

<span class="c1"># Analyze with Wireshark</span>
wireshark<span class="w"> </span>capture.pcap
</code></pre></div>

<hr />
<h2 id="11-practice-problems">11. Practice Problems<a class="header-link" href="#11-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-docker-custom-network">Problem 1: Docker Custom Network<a class="header-link" href="#problem-1-docker-custom-network" title="Permanent link">&para;</a></h3>
<p>Create a custom Docker network with:
- Subnet: 172.20.0.0/16
- Gateway: 172.20.0.1
- Run 3 containers: web, api, db
- web should connect to api, api to db
- Test connectivity</p>
<p><strong>Solution:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create network</span>
docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--driver<span class="w"> </span>bridge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--subnet<span class="w"> </span><span class="m">172</span>.20.0.0/16<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--gateway<span class="w"> </span><span class="m">172</span>.20.0.1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>mynetwork

<span class="c1"># Run containers</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>db<span class="w"> </span>--network<span class="w"> </span>mynetwork<span class="w"> </span>postgres
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>api<span class="w"> </span>--network<span class="w"> </span>mynetwork<span class="w"> </span>my-api
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>--network<span class="w"> </span>mynetwork<span class="w"> </span>nginx

<span class="c1"># Test connectivity</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ping<span class="w"> </span>api
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>ping<span class="w"> </span>db
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>curl<span class="w"> </span>http://api:8080/health
</code></pre></div>

<h3 id="problem-2-kubernetes-service">Problem 2: Kubernetes Service<a class="header-link" href="#problem-2-kubernetes-service" title="Permanent link">&para;</a></h3>
<p>Deploy a web application with:
- 3 nginx pods
- ClusterIP service
- Verify load balancing</p>
<p><strong>Solution:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># deployment.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nn">---</span>
<span class="c1"># service.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Apply</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deployment.yaml

<span class="c1"># Check endpoints</span>
kubectl<span class="w"> </span>get<span class="w"> </span>endpoints<span class="w"> </span>web-service

<span class="c1"># Test load balancing</span>
kubectl<span class="w"> </span>run<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>--image<span class="o">=</span>busybox<span class="w"> </span>--<span class="w"> </span>sh
<span class="c1"># In pod:</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">10</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>wget<span class="w"> </span>-qO-<span class="w"> </span>http://web-service<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;Server:&#39;</span>
<span class="k">done</span>
<span class="c1"># Should see different pod IPs</span>
</code></pre></div>

<h3 id="problem-3-networkpolicy">Problem 3: NetworkPolicy<a class="header-link" href="#problem-3-networkpolicy" title="Permanent link">&para;</a></h3>
<p>Implement security policy:
- Allow frontend to access backend on port 8080
- Allow backend to access database on port 5432
- Deny all other traffic</p>
<p><strong>Solution:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># backend-policy.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend-policy</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Allow DNS</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaceSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
<span class="w">    </span><span class="c1"># Allow database</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="nn">---</span>
<span class="c1"># database-policy.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database-policy</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
<span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">            </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</code></pre></div>

<h3 id="problem-4-debugging-network-issue">Problem 4: Debugging Network Issue<a class="header-link" href="#problem-4-debugging-network-issue" title="Permanent link">&para;</a></h3>
<p>Scenario: Pod can't reach external service (example.com)</p>
<p><strong>Troubleshooting steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. Check pod IP and interface</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>show
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>show

<span class="c1"># 2. Check DNS resolution</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>nslookup<span class="w"> </span>example.com
<span class="c1"># If fails, check DNS pods</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>-l<span class="w"> </span>k8s-app<span class="o">=</span>kube-dns

<span class="c1"># 3. Test external connectivity</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>ping<span class="w"> </span><span class="m">8</span>.8.8.8
<span class="c1"># If fails, check network policy</span>
kubectl<span class="w"> </span>get<span class="w"> </span>networkpolicy

<span class="c1"># 4. Check egress policy</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>networkpolicy<span class="w"> </span>&lt;policy&gt;
<span class="c1"># Ensure egress to 0.0.0.0/0 is allowed</span>

<span class="c1"># 5. Check NAT/masquerade</span>
<span class="c1"># On node:</span>
sudo<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-L<span class="w"> </span>POSTROUTING<span class="w"> </span>-n<span class="w"> </span>-v
<span class="c1"># Should see MASQUERADE rule for pod CIDR</span>

<span class="c1"># 6. Verify CNI configuration</span>
cat<span class="w"> </span>/etc/cni/net.d/*.conf
<span class="c1"># Check if CNI supports egress</span>

<span class="c1"># 7. Check node routing</span>
ip<span class="w"> </span>route<span class="w"> </span>show
<span class="c1"># Should have route for pod CIDR</span>
</code></pre></div>

<h3 id="problem-5-service-mesh-traffic-splitting">Problem 5: Service Mesh Traffic Splitting<a class="header-link" href="#problem-5-service-mesh-traffic-splitting" title="Permanent link">&para;</a></h3>
<p>Implement canary deployment:
- 90% traffic to v1
- 10% traffic to v2
- Use Istio</p>
<p><strong>Solution:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># virtual-service.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.istio.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualService</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">http</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">route</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">            </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">            </span><span class="nt">subset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">            </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">            </span><span class="nt">subset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<span class="w">          </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nn">---</span>
<span class="c1"># destination-rule.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.istio.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DestinationRule</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">subsets</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Apply configuration</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>virtual-service.yaml

<span class="c1"># Generate traffic and observe distribution</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">100</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>curl<span class="w"> </span>http://my-app/version
<span class="k">done</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c
<span class="c1"># Should see approximately 90 v1, 10 v2 responses</span>
</code></pre></div>

<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<p>Container networking is complex but follows consistent principles:</p>
<p><strong>Key concepts:</strong>
1. <strong>Network namespaces</strong> provide isolation
2. <strong>veth pairs and bridges</strong> connect containers
3. <strong>Docker CNM</strong> defines standardized networking
4. <strong>Kubernetes networking model</strong> requires flat network
5. <strong>CNI plugins</strong> implement different approaches (overlay, BGP, eBPF)
6. <strong>Services</strong> provide stable endpoints and load balancing
7. <strong>NetworkPolicies</strong> control traffic flow
8. <strong>Service meshes</strong> add L7 features (mTLS, observability)
9. <strong>Ingress</strong> provides HTTP/HTTPS routing</p>
<p><strong>Best practices:</strong>
- Choose CNI based on requirements (policy, performance, scale)
- Use NetworkPolicies for security
- Monitor network performance
- Implement service mesh for complex microservices
- Plan IP address allocation carefully</p>
<p>Container networking continues to evolve with technologies like eBPF (Cilium) and Gateway API, making it more powerful and easier to manage.</p>
<hr />
<p><strong>Difficulty:</strong> â­â­â­â­</p>
<p><strong>Further Reading:</strong>
- Kubernetes Network Model: https://kubernetes.io/docs/concepts/cluster-administration/networking/
- CNI Specification: https://github.com/containernetworking/cni
- Istio Documentation: https://istio.io/latest/docs/
- Calico Documentation: https://docs.projectcalico.org/</p>
<hr />
<p><a href="./18_IPv6.md">Previous: 18_IPv6</a> | <a href="./00_Overview.md">Next: 00_Overview</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Networking/18_IPv6.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">IPv6</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Networking/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}