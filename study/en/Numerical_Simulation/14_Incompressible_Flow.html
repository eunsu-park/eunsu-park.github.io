{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14. Incompressible Flow - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Numerical_Simulation/">Numerical Simulation</a>
    <span class="separator">/</span>
    <span class="current">14. Incompressible Flow</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>14. Incompressible Flow</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Numerical_Simulation/13_CFD_Basics.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">13. CFD Basics (Computational Fluid Dynamics Basics)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Numerical_Simulation/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Numerical_Simulation/15_Electromagnetics_Numerical.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">15. Computational Electromagnetics</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-incompressible-navier-stokes-equations">1. Incompressible Navier-Stokes Equations</a><ul>
<li><a href="#11-primitive-variable-formulation">1.1 Primitive Variable Formulation</a></li>
<li><a href="#12-pressure-poisson-equation">1.2 Pressure Poisson Equation</a></li>
</ul>
</li>
<li><a href="#2-stream-function-vorticity-formulation">2. Stream Function-Vorticity Formulation</a><ul>
<li><a href="#21-definition">2.1 Definition</a></li>
</ul>
</li>
<li><a href="#3-lid-driven-cavity-problem">3. Lid-Driven Cavity Problem</a><ul>
<li><a href="#31-problem-definition">3.1 Problem Definition</a></li>
<li><a href="#32-reynolds-number-effects">3.2 Reynolds Number Effects</a></li>
</ul>
</li>
<li><a href="#4-staggered-grid">4. Staggered Grid</a><ul>
<li><a href="#41-problems-with-collocated-grid">4.1 Problems with Collocated Grid</a></li>
<li><a href="#42-staggered-grid-structure">4.2 Staggered Grid Structure</a></li>
</ul>
</li>
<li><a href="#5-simple-algorithm">5. SIMPLE Algorithm</a><ul>
<li><a href="#51-concept">5.1 Concept</a></li>
<li><a href="#52-simple-algorithm-implementation">5.2 SIMPLE Algorithm Implementation</a></li>
</ul>
</li>
<li><a href="#6-simple-variant-algorithms">6. SIMPLE Variant Algorithms</a><ul>
<li><a href="#61-simpler-simplec-piso">6.1 SIMPLER, SIMPLEC, PISO</a></li>
</ul>
</li>
<li><a href="#7-practice-problems">7. Practice Problems</a><ul>
<li><a href="#exercise-1-stream-function-vorticity">Exercise 1: Stream Function-Vorticity</a></li>
<li><a href="#exercise-2-lid-driven-cavity">Exercise 2: Lid-Driven Cavity</a></li>
<li><a href="#exercise-3-simple-under-relaxation">Exercise 3: SIMPLE Under-relaxation</a></li>
<li><a href="#exercise-4-grid-convergence">Exercise 4: Grid Convergence</a></li>
</ul>
</li>
<li><a href="#8-references">8. References</a><ul>
<li><a href="#key-papers">Key Papers</a></li>
<li><a href="#textbooks">Textbooks</a></li>
<li><a href="#cfd-codes">CFD Codes</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="14-incompressible-flow">14. Incompressible Flow<a class="header-link" href="#14-incompressible-flow" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand stream function-vorticity formulation</li>
<li>Implement the Lid-Driven Cavity problem</li>
<li>Understand pressure-velocity coupling problem</li>
<li>Learn SIMPLE algorithm basics</li>
<li>Grasp the concept of staggered grid</li>
</ul>
<hr />
<h2 id="1-incompressible-navier-stokes-equations">1. Incompressible Navier-Stokes Equations<a class="header-link" href="#1-incompressible-navier-stokes-equations" title="Permanent link">&para;</a></h2>
<h3 id="11-primitive-variable-formulation">1.1 Primitive Variable Formulation<a class="header-link" href="#11-primitive-variable-formulation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Incompressible</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="n">equations</span><span class="w"> </span><span class="p">(</span><span class="n">primitive</span><span class="w"> </span><span class="n">variables</span><span class="p">:</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">):</span>

<span class="n">Continuity</span><span class="w"> </span><span class="n">equation</span><span class="p">:</span>
<span class="err">‚àÇ</span><span class="n">u</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">‚àÇ</span><span class="n">v</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="n">Momentum</span><span class="w"> </span><span class="n">equations</span><span class="p">:</span>
<span class="err">‚àÇ</span><span class="n">u</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="err">‚àÇ</span><span class="n">u</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="err">‚àÇ</span><span class="n">u</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="err">œÅ</span><span class="w"> </span><span class="err">‚àÇ</span><span class="n">p</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">ŒΩ</span><span class="p">(</span><span class="err">‚àÇ¬≤</span><span class="n">u</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x¬≤</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">‚àÇ¬≤</span><span class="n">u</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y¬≤</span><span class="p">)</span>
<span class="err">‚àÇ</span><span class="n">v</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="err">‚àÇ</span><span class="n">v</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="err">‚àÇ</span><span class="n">v</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="err">œÅ</span><span class="w"> </span><span class="err">‚àÇ</span><span class="n">p</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">ŒΩ</span><span class="p">(</span><span class="err">‚àÇ¬≤</span><span class="n">v</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x¬≤</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">‚àÇ¬≤</span><span class="n">v</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y¬≤</span><span class="p">)</span>

<span class="n">Problem</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">equations</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">unknowns</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">independent</span><span class="w"> </span><span class="n">equation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pressure</span>
<span class="o">-</span><span class="w"> </span><span class="n">Pressure</span><span class="o">-</span><span class="n">velocity</span><span class="w"> </span><span class="n">coupling</span><span class="w"> </span><span class="n">problem</span>
</code></pre></div>

<h3 id="12-pressure-poisson-equation">1.2 Pressure Poisson Equation<a class="header-link" href="#12-pressure-poisson-equation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">Normalize</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Taking the divergence of the continuity equation:</span>
<span class="sd">‚àá¬≤p = -œÅ‚àá¬∑(u¬∑‚àáu)</span>

<span class="sd">For steady state:</span>
<span class="sd">‚àá¬≤p = œÅ[(‚àÇu/‚àÇx)¬≤ + 2(‚àÇu/‚àÇy)(‚àÇv/‚àÇx) + (‚àÇv/‚àÇy)¬≤]</span>

<span class="sd">This equation can be used to determine pressure</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pressure_poisson_concept</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualization of pressure Poisson equation concept&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pressure-Velocity Coupling Problem&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="n">explanation</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Key problem in incompressible flow:</span>

<span class="s2">    1. Role of pressure:</span>
<span class="s2">       - Pressure adjusts to satisfy continuity equation (‚àá¬∑u = 0)</span>
<span class="s2">       - Pressure waves propagate infinitely fast (incompressible)</span>
<span class="s2">       - No independent governing equation for pressure</span>

<span class="s2">    2. Solution methods:</span>
<span class="s2">       a) Stream function-vorticity formulation:</span>
<span class="s2">          - Automatically satisfies continuity equation</span>
<span class="s2">          - Applicable to 2D flows only</span>

<span class="s2">       b) Pressure Poisson equation:</span>
<span class="s2">          - Derive pressure equation from continuity</span>
<span class="s2">          - Projection/Fractional Step Method</span>

<span class="s2">       c) SIMPLE family algorithms:</span>
<span class="s2">          - Iterative pressure-velocity correction</span>
<span class="s2">          - Industry standard</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">explanation</span><span class="p">)</span>

<span class="n">pressure_poisson_concept</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="2-stream-function-vorticity-formulation">2. Stream Function-Vorticity Formulation<a class="header-link" href="#2-stream-function-vorticity-formulation" title="Permanent link">&para;</a></h2>
<h3 id="21-definition">2.1 Definition<a class="header-link" href="#21-definition" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="mf">2</span><span class="n">D</span><span class="w"> </span><span class="n">incompressible</span><span class="w"> </span><span class="n">flow</span><span class="p">:</span>

<span class="n">Stream</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">œà</span><span class="p">:</span>
<span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">‚àÇ</span><span class="n">œà</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y</span><span class="p">,</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="err">‚àÇ</span><span class="n">œà</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x</span>
<span class="err">‚Üí</span><span class="w"> </span><span class="n">Automatically</span><span class="w"> </span><span class="n">satisfies</span><span class="w"> </span><span class="kr">cont</span><span class="n">inuity</span><span class="p">:</span><span class="w"> </span><span class="err">‚àÇ</span><span class="n">u</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">‚àÇ</span><span class="n">v</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>

<span class="n">Vorticity</span><span class="w"> </span><span class="n">œâ</span><span class="p">:</span>
<span class="n">œâ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">‚àÇ</span><span class="n">v</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="err">‚àÇ</span><span class="n">u</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="err">‚àá</span><span class="n">¬≤œà</span>

<span class="n">Vorticity</span><span class="w"> </span><span class="n">transport</span><span class="w"> </span><span class="n">equation</span><span class="p">:</span>
<span class="err">‚àÇ</span><span class="n">œâ</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="err">‚àÇ</span><span class="n">œâ</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="err">‚àÇ</span><span class="n">œâ</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ŒΩ</span><span class="err">‚àá</span><span class="n">¬≤œâ</span>

<span class="n">Poisson</span><span class="w"> </span><span class="n">equation</span><span class="p">:</span>
<span class="err">‚àá</span><span class="n">¬≤œà</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">œâ</span>

<span class="n">Advantages</span><span class="p">:</span><span class="w"> </span><span class="n">Eliminates</span><span class="w"> </span><span class="n">pressure</span><span class="w"> </span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">satisfies</span><span class="w"> </span><span class="kr">cont</span><span class="n">inuity</span>
<span class="n">Disadvantages</span><span class="p">:</span><span class="w"> </span><span class="kr">On</span><span class="n">ly</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="mf">2</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">complex</span><span class="w"> </span><span class="n">boundary</span><span class="w"> </span><span class="n">conditions</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stream_function_vorticity_derivation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Derivation of stream function-vorticity formulation&quot;&quot;&quot;</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># (1) Stream function concept</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Streamlines (iso-œà lines)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Example: uniform flow + doublet</span>
    <span class="n">U_inf</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># doublet strength</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.01</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">U_inf</span> <span class="o">*</span> <span class="n">Y</span> <span class="o">-</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">Y</span> <span class="o">/</span> <span class="n">r2</span>

    <span class="c1"># Velocity field</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">U_inf</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">r2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span>
    <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">X</span> <span class="o">*</span> <span class="n">Y</span> <span class="o">/</span> <span class="n">r2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span>

    <span class="c1"># Simplified velocity field</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Stream function œà (iso-œà lines = streamlines)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># (2) Vorticity concept</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Vortex example</span>
    <span class="n">Gamma</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># circulation</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

    <span class="c1"># Rankine vortex (core radius = 0.5)</span>
    <span class="n">r_core</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">r_core</span><span class="p">,</span>
                    <span class="n">Gamma</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r_core</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>  <span class="c1"># solid body rotation</span>
                    <span class="mi">0</span><span class="p">)</span>  <span class="c1"># potential flow</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\omega$ [1/s]&#39;</span><span class="p">)</span>

    <span class="c1"># Velocity field (tangential)</span>
    <span class="n">u_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">r_core</span><span class="p">,</span>
                      <span class="n">Gamma</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r_core</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                      <span class="n">Gamma</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span>
    <span class="n">u_vortex</span> <span class="o">=</span> <span class="o">-</span><span class="n">u_theta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">v_vortex</span> <span class="o">=</span> <span class="n">u_theta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

    <span class="n">skip</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span> <span class="n">Y</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span>
              <span class="n">u_vortex</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span> <span class="n">v_vortex</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span>
              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Vorticity œâ (Rankine vortex)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;stream_vorticity.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># stream_function_vorticity_derivation()</span>
</code></pre></div>

<hr />
<h2 id="3-lid-driven-cavity-problem">3. Lid-Driven Cavity Problem<a class="header-link" href="#3-lid-driven-cavity-problem" title="Permanent link">&para;</a></h2>
<h3 id="31-problem-definition">3.1 Problem Definition<a class="header-link" href="#31-problem-definition" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Lid</span><span class="o">-</span><span class="n">Driven</span><span class="w"> </span><span class="n">Cavity</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Square</span><span class="w"> </span><span class="n">cavity</span>
<span class="o">-</span><span class="w"> </span><span class="n">Top</span><span class="w"> </span><span class="n">wall</span><span class="w"> </span><span class="n">moves</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">velocity</span>
<span class="o">-</span><span class="w"> </span><span class="n">Other</span><span class="w"> </span><span class="n">walls</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">stationary</span>

<span class="n">Boundary</span><span class="w"> </span><span class="n">conditions</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Top</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">H</span><span class="p">):</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U_lid</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="o">-</span><span class="w"> </span><span class="n">Bottom</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="o">-</span><span class="w"> </span><span class="n">Left</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="o">-</span><span class="w"> </span><span class="n">Right</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">L</span><span class="p">):</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="n">Characteristics</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Reynolds</span><span class="w"> </span><span class="n">number</span>
<span class="o">-</span><span class="w"> </span><span class="n">Low</span><span class="w"> </span><span class="n">Re</span><span class="p">:</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">primary</span><span class="w"> </span><span class="n">vortex</span>
<span class="o">-</span><span class="w"> </span><span class="n">High</span><span class="w"> </span><span class="n">Re</span><span class="p">:</span><span class="w"> </span><span class="n">corner</span><span class="w"> </span><span class="n">vortices</span><span class="w"> </span><span class="n">appear</span>
<span class="o">-</span><span class="w"> </span><span class="n">Standard</span><span class="w"> </span><span class="n">problem</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CFD</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">verification</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">lid_driven_cavity_stream_vorticity</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lid-Driven Cavity simulation</span>
<span class="sd">    Stream function-vorticity formulation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Grid setup</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">41</span>  <span class="c1"># number of grid points (odd number)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># cavity size</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Properties and settings</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Reynolds number</span>
    <span class="n">U_lid</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">U_lid</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="n">Re</span>

    <span class="c1"># Time settings</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">n_steps</span> <span class="o">=</span> <span class="mi">10000</span>

    <span class="c1"># Initialize</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>  <span class="c1"># stream function</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>  <span class="c1"># vorticity</span>

    <span class="c1"># Check CFL</span>
    <span class="n">CFL</span> <span class="o">=</span> <span class="n">U_lid</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">h</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Re = </span><span class="si">{</span><span class="n">Re</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">, h = </span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dt = </span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">, CFL = </span><span class="si">{</span><span class="n">CFL</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_bc_psi</span><span class="p">(</span><span class="n">psi</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stream function boundary condition: œà = 0 on walls&quot;&quot;&quot;</span>
        <span class="n">psi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># bottom</span>
        <span class="n">psi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># top</span>
        <span class="n">psi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># left</span>
        <span class="n">psi</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># right</span>
        <span class="k">return</span> <span class="n">psi</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_bc_omega</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">U_lid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vorticity boundary condition (Thom&#39;s formula):</span>
<span class="sd">        At wall: œâ = -2(œà_neighbor - œà_wall)/h¬≤</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Bottom (no-slip)</span>
        <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># Top (moving lid)</span>
        <span class="n">omega</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">U_lid</span> <span class="o">/</span> <span class="n">h</span>

        <span class="c1"># Left</span>
        <span class="n">omega</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>

        <span class="c1"># Right</span>
        <span class="n">omega</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">return</span> <span class="n">omega</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_poisson</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solve Poisson equation: ‚àá¬≤œà = -œâ</span>
<span class="sd">        Gauss-Seidel iteration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
            <span class="n">psi_old</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span>
                                       <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                       <span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

            <span class="c1"># Boundary conditions</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">apply_bc_psi</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>

            <span class="c1"># Check convergence</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">psi</span> <span class="o">-</span> <span class="n">psi_old</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">psi</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_velocity</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute velocity from stream function&quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>

        <span class="c1"># Interior points (central difference)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
                <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">advect_diffuse_omega</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time advance for vorticity transport equation&quot;&quot;&quot;</span>
        <span class="n">omega_new</span> <span class="o">=</span> <span class="n">omega</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Convection term (upwind)</span>
                <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">domega_dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">domega_dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span>

                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">domega_dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">domega_dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span>

                <span class="n">convection</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">domega_dx</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">domega_dy</span>

                <span class="c1"># Diffusion term (central difference)</span>
                <span class="n">diffusion</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="p">((</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                                 <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                <span class="n">omega_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">convection</span> <span class="o">+</span> <span class="n">diffusion</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">omega_new</span>

    <span class="c1"># Time integration</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Starting simulation...&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
        <span class="c1"># 1. Solve Poisson equation</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">solve_poisson</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="c1"># 2. Compute velocity</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">compute_velocity</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="c1"># 3. Vorticity boundary conditions</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="n">apply_bc_omega</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">U_lid</span><span class="p">)</span>

        <span class="c1"># 4. Transport vorticity</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="n">advect_diffuse_omega</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

        <span class="c1"># Progress report</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: max|œâ| = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;max|œà| = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">psi</span><span class="p">))</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation complete!&quot;</span><span class="p">)</span>

    <span class="c1"># Final velocity field</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">compute_velocity</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

    <span class="c1"># Visualize results</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="c1"># (1) Streamlines</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">psi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">psi</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Streamlines, Re = </span><span class="si">{</span><span class="n">Re</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># (2) Vorticity distribution</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.8</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\omega$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Vorticity distribution&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># (3) Velocity vectors</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">skip</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span> <span class="n">Y</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span>
              <span class="n">u</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span> <span class="n">v</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span>
              <span class="n">speed</span><span class="p">[::</span><span class="n">skip</span><span class="p">,</span> <span class="p">::</span><span class="n">skip</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Velocity vector field&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># (4) Centerline velocity profile</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># u distribution on vertical centerline (x = 0.5)</span>
    <span class="n">j_center</span> <span class="o">=</span> <span class="n">N</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">u_centerline</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:,</span> <span class="n">j_center</span><span class="p">]</span>

    <span class="c1"># Ghia et al. (1982) reference values (Re=100)</span>
    <span class="n">y_ghia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0000</span><span class="p">,</span> <span class="mf">0.0547</span><span class="p">,</span> <span class="mf">0.0625</span><span class="p">,</span> <span class="mf">0.0703</span><span class="p">,</span> <span class="mf">0.1016</span><span class="p">,</span> <span class="mf">0.1719</span><span class="p">,</span>
                      <span class="mf">0.2813</span><span class="p">,</span> <span class="mf">0.4531</span><span class="p">,</span> <span class="mf">0.5000</span><span class="p">,</span> <span class="mf">0.6172</span><span class="p">,</span> <span class="mf">0.7344</span><span class="p">,</span> <span class="mf">0.8516</span><span class="p">,</span> <span class="mf">0.9531</span><span class="p">,</span> <span class="mf">1.0000</span><span class="p">])</span>
    <span class="n">u_ghia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0372</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0419</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0477</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0643</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1015</span><span class="p">,</span>
                      <span class="o">-</span><span class="mf">0.1566</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2109</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2058</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1364</span><span class="p">,</span> <span class="mf">0.0033</span><span class="p">,</span> <span class="mf">0.2315</span><span class="p">,</span> <span class="mf">0.6872</span><span class="p">,</span> <span class="mf">1.0000</span><span class="p">])</span>

    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u_centerline</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Present&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u_ghia</span><span class="p">,</span> <span class="n">y_ghia</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ghia et al. (1982)&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Vertical centerline velocity profile (x = 0.5)&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;lid_driven_cavity.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">psi</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>

<span class="c1"># psi, omega, u, v, X, Y = lid_driven_cavity_stream_vorticity()</span>
</code></pre></div>

<h3 id="32-reynolds-number-effects">3.2 Reynolds Number Effects<a class="header-link" href="#32-reynolds-number-effects" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reynolds_effect_cavity</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare Lid-Driven Cavity at various Reynolds numbers&quot;&quot;&quot;</span>

    <span class="n">reynolds_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">51</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">Re</span> <span class="ow">in</span> <span class="n">reynolds_numbers</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Re = </span><span class="si">{</span><span class="n">Re</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>

        <span class="c1"># Settings</span>
        <span class="n">U_lid</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">U_lid</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="n">Re</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">nu</span><span class="p">)</span>  <span class="c1"># diffusion stability</span>
        <span class="n">n_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">20</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1"># sufficient time</span>

        <span class="c1"># Initialize</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>

        <span class="c1"># Simplified simulation (fast execution)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)):</span>
            <span class="c1"># Poisson</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
                <span class="n">psi_old</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">psi</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                         <span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">+</span> <span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
                                         <span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">psi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Velocity</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
            <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">psi</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>

            <span class="c1"># Vorticity boundary conditions</span>
            <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">omega</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">U_lid</span> <span class="o">/</span> <span class="n">h</span>
            <span class="n">omega</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">omega</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">psi</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>

            <span class="c1"># Vorticity advance (FTCS + upwind)</span>
            <span class="n">omega_new</span> <span class="o">=</span> <span class="n">omega</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">conv_x</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">h</span> <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">h</span>
                    <span class="n">conv_y</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">h</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">h</span>
                    <span class="n">diff</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="p">((</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span>
                                <span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">omega_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">conv_x</span> <span class="o">-</span> <span class="n">conv_y</span> <span class="o">+</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">omega_new</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Re</span><span class="p">,</span> <span class="n">psi</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">omega</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Complete: max|œà| = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">psi</span><span class="p">))</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Comparison visualization</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
        <span class="c1"># Streamlines</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">psi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">psi</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Re = </span><span class="si">{</span><span class="n">Re</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="c1"># Vorticity</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">omega</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                     <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Streamlines&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Vorticity&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Lid-Driven Cavity Flow Patterns vs Reynolds Number&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;cavity_reynolds_comparison.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># reynolds_effect_cavity()</span>
</code></pre></div>

<hr />
<h2 id="4-staggered-grid">4. Staggered Grid<a class="header-link" href="#4-staggered-grid" title="Permanent link">&para;</a></h2>
<h3 id="41-problems-with-collocated-grid">4.1 Problems with Collocated Grid<a class="header-link" href="#41-problems-with-collocated-grid" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Collocated</span><span class="w"> </span><span class="n">Grid</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">location</span>
<span class="o">-</span><span class="w"> </span><span class="n">Central</span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">pressure</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">p_</span><span class="p">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p_</span><span class="p">{</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">})</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="err">Œî</span><span class="n">x</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Problem</span><span class="p">:</span><span class="w"> </span><span class="n">checkerboard</span><span class="w"> </span><span class="n">instability</span>

<span class="n">Checkerboard</span><span class="w"> </span><span class="n">phenomenon</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Pressure</span><span class="w"> </span><span class="n">oscillations</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">effect</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">numerical</span><span class="w"> </span><span class="n">solution</span>
<span class="o">-</span><span class="w"> </span><span class="n">Oscillations</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">Œµ</span>
<span class="o">-</span><span class="w"> </span><span class="n">Oscillations</span><span class="w"> </span><span class="n">cancel</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">central</span><span class="w"> </span><span class="n">differencing</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">checkerboard_problem</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualization of checkerboard instability&quot;&quot;&quot;</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># (1) Collocated grid</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;u,v,p&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Collocated Grid&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># (2) Checkerboard pressure</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">Y</span><span class="p">)</span>  <span class="c1"># checkerboard pattern</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Y</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Checkerboard Pressure Distribution&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>

    <span class="c1"># Pressure gradient (central difference = 0!)</span>
    <span class="n">dpdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">dpdx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># always 0!</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central difference ‚àÇp/‚àÇx = 0 (incorrect!)&#39;</span><span class="p">)</span>

    <span class="c1"># (3) Staggered grid</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="c1"># Pressure points (cell center)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;p&#39;</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># u-velocity points (vertical faces)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;b&gt;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;u&#39;</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># v-velocity points (horizontal faces)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;g^&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;v&#39;</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Grid lines</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Staggered Grid&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;staggered_grid.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># checkerboard_problem()</span>
</code></pre></div>

<h3 id="42-staggered-grid-structure">4.2 Staggered Grid Structure<a class="header-link" href="#42-staggered-grid-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Staggered Grid (MAC Grid):

     v(i,j+1)
        ‚îÇ
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  ‚îÇ     ‚îÇ     ‚îÇ
  ‚îÇ  p(i,j)   ‚îÇ
u(i,j)‚îÄ‚îº‚îÄ‚îÄu(i+1,j)
  ‚îÇ     ‚îÇ     ‚îÇ
  ‚îÇ     ‚îÇ     ‚îÇ
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     v(i,j)

Storage locations:
- p: cell center (i, j)
- u: cell east face (i+1/2, j)
- v: cell north face (i, j+1/2)

Advantages:
- Prevents checkerboard
- Accurate mass conservation
- Natural pressure-velocity coupling
</code></pre></div>

<hr />
<h2 id="5-simple-algorithm">5. SIMPLE Algorithm<a class="header-link" href="#5-simple-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="51-concept">5.1 Concept<a class="header-link" href="#51-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SIMPLE (Semi-Implicit Method for Pressure-Linked Equations):

Basic idea:
1. Use guessed pressure field p*
2. Compute guessed velocity field u*, v* (momentum equations)
3. Compute pressure correction p&#39; (continuity equation)
4. Update pressure/velocity: p = p* + p&#39;, u = u* + u&#39;
5. Iterate until convergence

Key equation:
‚àá¬≤p&#39; = œÅ/Œît ¬∑ ‚àá¬∑u*

where p&#39; = p - p* (pressure correction)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simple_algorithm_concept</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Explanation of SIMPLE algorithm concept&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SIMPLE Algorithm Flowchart&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="n">flowchart</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="s2">    ‚îÇ      Initial guess: p*, u*, v*           ‚îÇ</span>
<span class="s2">    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="s2">                        ‚îÇ</span>
<span class="s2">                        ‚ñº</span>
<span class="s2">    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="s2">    ‚îÇ  Step 1: Solve momentum equations        ‚îÇ</span>
<span class="s2">    ‚îÇ  ‚Üí Compute guessed velocity u*, v*       ‚îÇ</span>
<span class="s2">    ‚îÇ  (using pressure p*)                     ‚îÇ</span>
<span class="s2">    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="s2">                        ‚îÇ</span>
<span class="s2">                        ‚ñº</span>
<span class="s2">    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="s2">    ‚îÇ  Step 2: Solve pressure correction eq.   ‚îÇ</span>
<span class="s2">    ‚îÇ  ‚àá¬≤p&#39; = (œÅ/Œît) ‚àá¬∑u*                      ‚îÇ</span>
<span class="s2">    ‚îÇ  (divergence of u* = mass imbalance)     ‚îÇ</span>
<span class="s2">    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="s2">                        ‚îÇ</span>
<span class="s2">                        ‚ñº</span>
<span class="s2">    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="s2">    ‚îÇ  Step 3: Correct pressure/velocity       ‚îÇ</span>
<span class="s2">    ‚îÇ  p = p* + Œ±p¬∑p&#39;                          ‚îÇ</span>
<span class="s2">    ‚îÇ  u = u* - (Œît/œÅ)¬∑‚àÇp&#39;/‚àÇx                  ‚îÇ</span>
<span class="s2">    ‚îÇ  v = v* - (Œît/œÅ)¬∑‚àÇp&#39;/‚àÇy                  ‚îÇ</span>
<span class="s2">    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="s2">                        ‚îÇ</span>
<span class="s2">                        ‚ñº</span>
<span class="s2">    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="s2">    ‚îÇ  Check convergence: |‚àá¬∑u| &lt; Œµ ?          ‚îÇ</span>
<span class="s2">    ‚îÇ                                          ‚îÇ</span>
<span class="s2">    ‚îÇ  No ‚Üí p* = p, u* = u, v* = v (repeat)    ‚îÇ</span>
<span class="s2">    ‚îÇ  Yes ‚Üí Exit                              ‚îÇ</span>
<span class="s2">    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>

<span class="s2">    Under-relaxation factors:</span>
<span class="s2">    - Œ±p ~ 0.3 (pressure)</span>
<span class="s2">    - Œ±u ~ 0.7 (velocity)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">flowchart</span><span class="p">)</span>

<span class="n">simple_algorithm_concept</span><span class="p">()</span>
</code></pre></div>

<h3 id="52-simple-algorithm-implementation">5.2 SIMPLE Algorithm Implementation<a class="header-link" href="#52-simple-algorithm-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simple_lid_driven_cavity</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve Lid-Driven Cavity with SIMPLE algorithm</span>
<span class="sd">    Using staggered grid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Grid setup</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># number of cells (x direction)</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># number of cells (y direction)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">Nx</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">Ny</span>

    <span class="c1"># Properties</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="n">mu</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reynolds number: Re = </span><span class="si">{</span><span class="n">Re</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Under-relaxation</span>
    <span class="n">alpha_u</span> <span class="o">=</span> <span class="mf">0.7</span>
    <span class="n">alpha_p</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="c1"># Initialize arrays (staggered grid)</span>
    <span class="c1"># u: (Ny, Nx+1) - vertical faces</span>
    <span class="c1"># v: (Ny+1, Nx) - horizontal faces</span>
    <span class="c1"># p: (Ny, Nx) - cell centers</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ny</span><span class="p">,</span> <span class="n">Nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nx</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ny</span><span class="p">,</span> <span class="n">Nx</span><span class="p">))</span>
    <span class="n">p_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ny</span><span class="p">,</span> <span class="n">Nx</span><span class="p">))</span>

    <span class="c1"># Boundary conditions</span>
    <span class="n">U_lid</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_boundary_conditions</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply boundary conditions&quot;&quot;&quot;</span>
        <span class="k">nonlocal</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>

        <span class="c1"># Top (lid): u = U_lid</span>
        <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">U_lid</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># linear extrapolation (U_lid at wall)</span>

        <span class="c1"># Bottom: u = 0</span>
        <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># linear extrapolation</span>

        <span class="c1"># Left/right: u = 0 (already 0)</span>
        <span class="n">u</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">u</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># v boundary conditions</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># bottom</span>
        <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># top</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>   <span class="c1"># left</span>
        <span class="n">v</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># right</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_momentum</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve momentum equations (guessed velocity)&quot;&quot;&quot;</span>
        <span class="n">u_star</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_star</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># u-momentum</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nx</span><span class="p">):</span>
                <span class="c1"># Convection term (upwind)</span>
                <span class="n">u_face</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">u_face</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dudx</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dudx</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Nx</span> <span class="k">else</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>

                <span class="n">v_face</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span>
                                <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

                <span class="k">if</span> <span class="n">v_face</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dudy</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dudy</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Ny</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span>

                <span class="c1"># Diffusion term</span>
                <span class="n">d2udx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Nx</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">d2udy2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span>

                <span class="c1"># Pressure gradient</span>
                <span class="n">dpdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span> <span class="o">/</span> <span class="n">dx</span>

                <span class="c1"># Time advance</span>
                <span class="n">conv</span> <span class="o">=</span> <span class="n">u_face</span> <span class="o">*</span> <span class="n">dudx</span> <span class="o">+</span> <span class="n">v_face</span> <span class="o">*</span> <span class="n">dudy</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span><span class="n">d2udx2</span> <span class="o">+</span> <span class="n">d2udy2</span><span class="p">)</span>
                <span class="n">u_star</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">conv</span> <span class="o">-</span> <span class="n">dpdx</span> <span class="o">/</span> <span class="n">rho</span> <span class="o">+</span> <span class="n">diff</span><span class="p">)</span>

        <span class="c1"># v-momentum (similarly)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ny</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">u_face</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">Ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">Ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                <span class="n">u</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">u_face</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dvdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dvdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Nx</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>

                <span class="n">v_face</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">v_face</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dvdy</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dvdy</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Ny</span> <span class="k">else</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span>

                <span class="n">d2vdx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">d2vdy2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Ny</span> <span class="k">else</span> <span class="mi">0</span>

                <span class="n">dpdy</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">Ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span>

                <span class="n">conv</span> <span class="o">=</span> <span class="n">u_face</span> <span class="o">*</span> <span class="n">dvdx</span> <span class="o">+</span> <span class="n">v_face</span> <span class="o">*</span> <span class="n">dvdy</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span><span class="n">d2vdx2</span> <span class="o">+</span> <span class="n">d2vdy2</span><span class="p">)</span>
                <span class="n">v_star</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">conv</span> <span class="o">-</span> <span class="n">dpdy</span> <span class="o">/</span> <span class="n">rho</span> <span class="o">+</span> <span class="n">diff</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u_star</span><span class="p">,</span> <span class="n">v_star</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve_pressure_correction</span><span class="p">(</span><span class="n">u_star</span><span class="p">,</span> <span class="n">v_star</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve pressure correction equation&quot;&quot;&quot;</span>
        <span class="n">p_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ny</span><span class="p">,</span> <span class="n">Nx</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
            <span class="n">p_old</span> <span class="o">=</span> <span class="n">p_prime</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
                    <span class="c1"># Mass imbalance (divergence)</span>
                    <span class="n">div</span> <span class="o">=</span> <span class="p">((</span><span class="n">u_star</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_star</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span>
                          <span class="p">(</span><span class="n">v_star</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_star</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span>

                    <span class="c1"># Neighbor pressures</span>
                    <span class="n">p_E</span> <span class="o">=</span> <span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Nx</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">p_W</span> <span class="o">=</span> <span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">p_N</span> <span class="o">=</span> <span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Ny</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">p_S</span> <span class="o">=</span> <span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

                    <span class="c1"># Poisson equation coefficients</span>
                    <span class="n">aE</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Nx</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">aW</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">aN</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Ny</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">aS</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">aP</span> <span class="o">=</span> <span class="n">aE</span> <span class="o">+</span> <span class="n">aW</span> <span class="o">+</span> <span class="n">aN</span> <span class="o">+</span> <span class="n">aS</span>

                    <span class="k">if</span> <span class="n">aP</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">aE</span><span class="o">*</span><span class="n">p_E</span> <span class="o">+</span> <span class="n">aW</span><span class="o">*</span><span class="n">p_W</span> <span class="o">+</span> <span class="n">aN</span><span class="o">*</span><span class="n">p_N</span> <span class="o">+</span> <span class="n">aS</span><span class="o">*</span><span class="n">p_S</span> <span class="o">-</span>
                                        <span class="n">rho</span><span class="o">/</span><span class="n">dt</span> <span class="o">*</span> <span class="n">div</span><span class="p">)</span> <span class="o">/</span> <span class="n">aP</span>

        <span class="k">return</span> <span class="n">p_prime</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">correct_velocity</span><span class="p">(</span><span class="n">u_star</span><span class="p">,</span> <span class="n">v_star</span><span class="p">,</span> <span class="n">p_prime</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Velocity correction&quot;&quot;&quot;</span>
        <span class="n">u_new</span> <span class="o">=</span> <span class="n">u_star</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_new</span> <span class="o">=</span> <span class="n">v_star</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># u correction</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nx</span><span class="p">):</span>
                <span class="n">dpdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>
                <span class="n">u_new</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_star</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">dpdx</span>

        <span class="c1"># v correction</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ny</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
                <span class="n">dpdy</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_prime</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span>
                <span class="n">v_new</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_star</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">dpdy</span>

        <span class="k">return</span> <span class="n">u_new</span><span class="p">,</span> <span class="n">v_new</span>

    <span class="c1"># Simulation</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">n_outer</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Starting SIMPLE algorithm...&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_outer</span><span class="p">):</span>
        <span class="n">apply_boundary_conditions</span><span class="p">()</span>

        <span class="c1"># 1. Momentum equations</span>
        <span class="n">u_star</span><span class="p">,</span> <span class="n">v_star</span> <span class="o">=</span> <span class="n">solve_momentum</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

        <span class="c1"># 2. Pressure correction</span>
        <span class="n">p_prime</span> <span class="o">=</span> <span class="n">solve_pressure_correction</span><span class="p">(</span><span class="n">u_star</span><span class="p">,</span> <span class="n">v_star</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>

        <span class="c1"># 3. Velocity/pressure correction</span>
        <span class="n">u_new</span><span class="p">,</span> <span class="n">v_new</span> <span class="o">=</span> <span class="n">correct_velocity</span><span class="p">(</span><span class="n">u_star</span><span class="p">,</span> <span class="n">v_star</span><span class="p">,</span> <span class="n">p_prime</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
        <span class="n">p_new</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">alpha_p</span> <span class="o">*</span> <span class="n">p_prime</span>

        <span class="c1"># Under-relaxation</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">alpha_u</span> <span class="o">*</span> <span class="n">u_new</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_u</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">alpha_u</span> <span class="o">*</span> <span class="n">v_new</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_u</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p_new</span>

        <span class="c1"># Convergence check</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">div_max</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
                    <span class="n">div</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span>
                             <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span>
                    <span class="n">div_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">div_max</span><span class="p">,</span> <span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: max|div(u)| = </span><span class="si">{</span><span class="n">div_max</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Complete!&quot;</span><span class="p">)</span>

    <span class="c1"># Convert to cell-centered velocity</span>
    <span class="n">u_center</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:])</span>
    <span class="n">v_center</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>

    <span class="c1"># Visualize results</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="n">dx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span> <span class="o">-</span> <span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ny</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Velocity vectors</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_center</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_center</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u_center</span><span class="p">,</span> <span class="n">v_center</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span>
                  <span class="n">density</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Streamlines (SIMPLE), Re = </span><span class="si">{</span><span class="n">Re</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># Pressure distribution</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pressure distribution&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># Centerline velocity</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">j_center</span> <span class="o">=</span> <span class="n">Nx</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u_center</span><span class="p">[:,</span> <span class="n">j_center</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Vertical centerline u-velocity&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;simple_cavity.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span>

<span class="c1"># u, v, p = simple_lid_driven_cavity()</span>
</code></pre></div>

<hr />
<h2 id="6-simple-variant-algorithms">6. SIMPLE Variant Algorithms<a class="header-link" href="#6-simple-variant-algorithms" title="Permanent link">&para;</a></h2>
<h3 id="61-simpler-simplec-piso">6.1 SIMPLER, SIMPLEC, PISO<a class="header-link" href="#61-simpler-simplec-piso" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">SIMPLE</span><span class="w"> </span><span class="n">variants</span><span class="p">:</span>

<span class="mf">1.</span><span class="w"> </span><span class="n">SIMPLER</span><span class="w"> </span><span class="p">(</span><span class="n">SIMPLE</span><span class="w"> </span><span class="n">Revised</span><span class="p">):</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Directly</span><span class="w"> </span><span class="n">calculate</span><span class="w"> </span><span class="n">pressure</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">guessing</span><span class="w"> </span><span class="n">needed</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Faster</span><span class="w"> </span><span class="n">convergence</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Increased</span><span class="w"> </span><span class="n">computational</span><span class="w"> </span><span class="n">cost</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">SIMPLEC</span><span class="w"> </span><span class="p">(</span><span class="n">SIMPLE</span><span class="w"> </span><span class="n">Consistent</span><span class="p">):</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Consider</span><span class="w"> </span><span class="n">neighbor</span><span class="w"> </span><span class="n">velocity</span><span class="w"> </span><span class="n">correction</span><span class="w"> </span><span class="n">terms</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Less</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">under</span><span class="o">-</span><span class="n">relaxation</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Improved</span><span class="w"> </span><span class="n">convergence</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">PISO</span><span class="w"> </span><span class="p">(</span><span class="n">Pressure</span><span class="o">-</span><span class="n">Implicit</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Splitting</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Operators</span><span class="p">):</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Suitable</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">unsteady</span><span class="w"> </span><span class="n">problems</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Additional</span><span class="w"> </span><span class="n">pressure</span><span class="o">/</span><span class="n">velocity</span><span class="w"> </span><span class="n">corrections</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Improved</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">accuracy</span>

<span class="n">Selection</span><span class="w"> </span><span class="n">guide</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Steady</span><span class="w"> </span><span class="n">problems</span><span class="p">:</span><span class="w"> </span><span class="n">SIMPLE</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">SIMPLEC</span>
<span class="o">-</span><span class="w"> </span><span class="n">Unsteady</span><span class="w"> </span><span class="n">problems</span><span class="p">:</span><span class="w"> </span><span class="n">PISO</span>
<span class="o">-</span><span class="w"> </span><span class="n">Fast</span><span class="w"> </span><span class="n">convergence</span><span class="w"> </span><span class="n">needed</span><span class="p">:</span><span class="w"> </span><span class="n">SIMPLER</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">algorithm_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Algorithm comparison concept diagram&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SIMPLE Family Algorithm Comparison&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="n">comparison</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="s2">    ‚îÇ  Algorithm  ‚îÇ   SIMPLE   ‚îÇ  SIMPLEC   ‚îÇ    PISO    ‚îÇ</span>
<span class="s2">    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</span>
<span class="s2">    ‚îÇ Pressure    ‚îÇ     1      ‚îÇ     1      ‚îÇ    2+      ‚îÇ</span>
<span class="s2">    ‚îÇ correction  ‚îÇ            ‚îÇ            ‚îÇ            ‚îÇ</span>
<span class="s2">    ‚îÇ Iter./time  ‚îÇ   Many     ‚îÇ   Few      ‚îÇ   Few      ‚îÇ</span>
<span class="s2">    ‚îÇ Œ±p          ‚îÇ  0.3~0.5   ‚îÇ  0.7~1.0   ‚îÇ    1.0     ‚îÇ</span>
<span class="s2">    ‚îÇ Application ‚îÇ  Steady    ‚îÇ  Steady    ‚îÇ  Unsteady  ‚îÇ</span>
<span class="s2">    ‚îÇ Comp. cost  ‚îÇ   Low      ‚îÇ  Medium    ‚îÇ   High     ‚îÇ</span>
<span class="s2">    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>

<span class="s2">    Key differences of each algorithm:</span>

<span class="s2">    SIMPLE:</span>
<span class="s2">    - Standard method, simple and robust</span>
<span class="s2">    - Under-relaxation essential (Œ±p ~ 0.3)</span>

<span class="s2">    SIMPLEC:</span>
<span class="s2">    - Consider neighbor contributions in velocity correction</span>
<span class="s2">    - Can use Œ±p close to 1</span>

<span class="s2">    PISO:</span>
<span class="s2">    - Predictor-corrector for unsteady problems</span>
<span class="s2">    - 2+ corrections per time step</span>
<span class="s2">    - Requires Courant number ‚â§ 1</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">comparison</span><span class="p">)</span>

<span class="n">algorithm_comparison</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="7-practice-problems">7. Practice Problems<a class="header-link" href="#7-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-stream-function-vorticity">Exercise 1: Stream Function-Vorticity<a class="header-link" href="#exercise-1-stream-function-vorticity" title="Permanent link">&para;</a></h3>
<p>Find the velocity field and vorticity corresponding to stream function œà = xy, and verify that it satisfies the incompressibility condition.</p>
<h3 id="exercise-2-lid-driven-cavity">Exercise 2: Lid-Driven Cavity<a class="header-link" href="#exercise-2-lid-driven-cavity" title="Permanent link">&para;</a></h3>
<p>Perform Lid-Driven Cavity simulation at Re = 400 and compare with Re = 100 results. Observe the development of corner vortices.</p>
<h3 id="exercise-3-simple-under-relaxation">Exercise 3: SIMPLE Under-relaxation<a class="header-link" href="#exercise-3-simple-under-relaxation" title="Permanent link">&para;</a></h3>
<p>Compare convergence speed in SIMPLE algorithm while varying under-relaxation factor Œ±p as 0.1, 0.3, 0.5.</p>
<h3 id="exercise-4-grid-convergence">Exercise 4: Grid Convergence<a class="header-link" href="#exercise-4-grid-convergence" title="Permanent link">&para;</a></h3>
<p>Analyze numerical solution convergence for Lid-Driven Cavity problem while varying grid size as 16x16, 32x32, 64x64.</p>
<hr />
<h2 id="8-references">8. References<a class="header-link" href="#8-references" title="Permanent link">&para;</a></h2>
<h3 id="key-papers">Key Papers<a class="header-link" href="#key-papers" title="Permanent link">&para;</a></h3>
<ul>
<li>Ghia et al. (1982) "High-Re Solutions for Incompressible Flow Using the Navier-Stokes Equations and a Multigrid Method" - Lid-Driven Cavity benchmark</li>
<li>Patankar &amp; Spalding (1972) "A calculation procedure for heat, mass and momentum transfer in three-dimensional parabolic flows" - SIMPLE algorithm</li>
</ul>
<h3 id="textbooks">Textbooks<a class="header-link" href="#textbooks" title="Permanent link">&para;</a></h3>
<ul>
<li>Patankar, "Numerical Heat Transfer and Fluid Flow" (SIMPLE details)</li>
<li>Ferziger &amp; Peric, "Computational Methods for Fluid Dynamics"</li>
<li>Moukalled et al., "The Finite Volume Method in Computational Fluid Dynamics"</li>
</ul>
<h3 id="cfd-codes">CFD Codes<a class="header-link" href="#cfd-codes" title="Permanent link">&para;</a></h3>
<ul>
<li>OpenFOAM: icoFoam (incompressible laminar)</li>
<li>SIMPLE implementation tutorials: CFD-Online, PyFR</li>
</ul>
<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">Incompressible</span><span class="w"> </span><span class="n">flow</span><span class="w"> </span><span class="n">essentials</span><span class="p">:</span>

<span class="mf">1.</span><span class="w"> </span><span class="n">Governing</span><span class="w"> </span><span class="n">equations</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Continuity</span><span class="p">:</span><span class="w"> </span><span class="err">‚àá¬∑</span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Momentum</span><span class="p">:</span><span class="w"> </span><span class="n">Du</span><span class="o">/</span><span class="n">Dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="err">‚àá</span><span class="n">p</span><span class="o">/</span><span class="err">œÅ</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">ŒΩ‚àá¬≤</span><span class="n">u</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Formulation</span><span class="w"> </span><span class="n">methods</span><span class="p">:</span>
<span class="w">   </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="n">Stream</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">vorticity</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="n">D</span><span class="p">):</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="err">‚àá¬≤œà</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="err">œâ</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="err">‚àÇœâ</span><span class="o">/</span><span class="err">‚àÇ</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="err">¬∑‚àá</span><span class="p">)</span><span class="err">œâ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">ŒΩ‚àá¬≤œâ</span>
<span class="w">   </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">Primitive</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SIMPLE</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">Handle</span><span class="w"> </span><span class="n">pressure</span><span class="o">-</span><span class="n">velocity</span><span class="w"> </span><span class="n">coupling</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">Staggered</span><span class="w"> </span><span class="n">grid</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Prevents</span><span class="w"> </span><span class="n">checkerboard</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="n">faces</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="n">center</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">SIMPLE</span><span class="w"> </span><span class="n">algorithm</span><span class="p">:</span>
<span class="w">   </span><span class="err">‚ë†</span><span class="w"> </span><span class="n">Momentum</span><span class="w"> </span><span class="n">equation</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">guessed</span><span class="w"> </span><span class="n">pressure</span>
<span class="w">   </span><span class="err">‚ë°</span><span class="w"> </span><span class="n">Pressure</span><span class="w"> </span><span class="n">correction</span><span class="w"> </span><span class="n">Poisson</span><span class="w"> </span><span class="n">equation</span>
<span class="w">   </span><span class="err">‚ë¢</span><span class="w"> </span><span class="n">Update</span><span class="w"> </span><span class="n">velocity</span><span class="o">/</span><span class="n">pressure</span>
<span class="w">   </span><span class="err">‚ë£</span><span class="w"> </span><span class="n">Iterate</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">convergence</span>

<span class="mf">5.</span><span class="w"> </span><span class="n">Numerical</span><span class="w"> </span><span class="n">considerations</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Under</span><span class="o">-</span><span class="n">relaxation</span><span class="p">:</span><span class="w"> </span><span class="err">Œ±</span><span class="n">p</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="err">Œ±</span><span class="n">u</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="mf">0.7</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Grid</span><span class="w"> </span><span class="n">convergence</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">essential</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Comply</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">CFL</span><span class="w"> </span><span class="n">condition</span>
</code></pre></div>

<hr />
<p>Next lesson covers numerical analysis of electromagnetics and discretization of Maxwell equations.</p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Numerical_Simulation/13_CFD_Basics.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">13. CFD Basics (Computational Fluid Dynamics Basics)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Numerical_Simulation/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Numerical_Simulation/15_Electromagnetics_Numerical.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">15. Computational Electromagnetics</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}