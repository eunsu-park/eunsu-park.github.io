{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finite Element Method (FEM) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Numerical_Simulation/">Numerical Simulation</a>
    <span class="separator">/</span>
    <span class="current">Finite Element Method (FEM)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Finite Element Method (FEM)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Numerical_Simulation/21_Spectral_Methods.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Spectral Methods</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Numerical_Simulation/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-introduction-to-fem">1. Introduction to FEM</a><ul>
<li><a href="#11-what-is-the-finite-element-method">1.1 What is the Finite Element Method?</a></li>
<li><a href="#12-model-problem-1d-poisson-equation">1.2 Model Problem: 1D Poisson Equation</a></li>
</ul>
</li>
<li><a href="#2-weak-form-and-variational-formulation">2. Weak Form and Variational Formulation</a><ul>
<li><a href="#21-deriving-the-weak-form">2.1 Deriving the Weak Form</a></li>
<li><a href="#22-bilinear-form-and-functional">2.2 Bilinear Form and Functional</a></li>
</ul>
</li>
<li><a href="#3-finite-element-spaces">3. Finite Element Spaces</a><ul>
<li><a href="#31-mesh-and-elements">3.1 Mesh and Elements</a></li>
<li><a href="#32-hat-functions-linear-basis">3.2 Hat Functions (Linear Basis)</a></li>
</ul>
</li>
<li><a href="#4-element-stiffness-matrix-and-assembly">4. Element Stiffness Matrix and Assembly</a><ul>
<li><a href="#41-galerkin-discretization">4.1 Galerkin Discretization</a></li>
<li><a href="#42-element-stiffness-matrix">4.2 Element Stiffness Matrix</a></li>
<li><a href="#43-assembly">4.3 Assembly</a></li>
</ul>
</li>
<li><a href="#5-1d-fem-implementation">5. 1D FEM Implementation</a><ul>
<li><a href="#51-complete-fem-solver">5.1 Complete FEM Solver</a></li>
<li><a href="#52-variable-source-term">5.2 Variable Source Term</a></li>
</ul>
</li>
<li><a href="#6-boundary-conditions">6. Boundary Conditions</a><ul>
<li><a href="#61-dirichlet-boundary-conditions">6.1 Dirichlet Boundary Conditions</a></li>
<li><a href="#62-neumann-boundary-conditions">6.2 Neumann Boundary Conditions</a></li>
</ul>
</li>
<li><a href="#7-2d-fem-overview">7. 2D FEM Overview</a><ul>
<li><a href="#71-2d-poisson-equation">7.1 2D Poisson Equation</a></li>
<li><a href="#72-triangular-elements">7.2 Triangular Elements</a></li>
<li><a href="#73-element-stiffness-matrix-2d">7.3 Element Stiffness Matrix (2D)</a></li>
</ul>
</li>
<li><a href="#8-error-analysis-and-convergence">8. Error Analysis and Convergence</a><ul>
<li><a href="#81-convergence-rate">8.1 Convergence Rate</a></li>
<li><a href="#82-convergence-test">8.2 Convergence Test</a></li>
</ul>
</li>
<li><a href="#9-practice-problems">9. Practice Problems</a><ul>
<li><a href="#problem-1-variable-coefficient">Problem 1: Variable Coefficient</a></li>
<li><a href="#problem-2-mixed-boundary-conditions">Problem 2: Mixed Boundary Conditions</a></li>
<li><a href="#problem-3-quadratic-elements">Problem 3: Quadratic Elements</a></li>
<li><a href="#problem-4-2d-poisson-on-unit-square">Problem 4: 2D Poisson on Unit Square</a></li>
<li><a href="#problem-5-higher-order-convergence">Problem 5: Higher-Order Convergence</a></li>
</ul>
</li>
<li><a href="#navigation">Navigation</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="finite-element-method-fem">Finite Element Method (FEM)<a class="header-link" href="#finite-element-method-fem" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand the weak formulation and variational principles</li>
<li>Master finite element spaces and basis functions</li>
<li>Construct element stiffness matrices and perform assembly</li>
<li>Implement 1D FEM for the Poisson equation</li>
<li>Handle Dirichlet and Neumann boundary conditions</li>
<li>Understand error analysis and convergence rates</li>
<li>Gain insight into 2D FEM extensions</li>
</ul>
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-introduction-to-fem">Introduction to FEM</a></li>
<li><a href="#2-weak-form-and-variational-formulation">Weak Form and Variational Formulation</a></li>
<li><a href="#3-finite-element-spaces">Finite Element Spaces</a></li>
<li><a href="#4-element-stiffness-matrix-and-assembly">Element Stiffness Matrix and Assembly</a></li>
<li><a href="#5-1d-fem-implementation">1D FEM Implementation</a></li>
<li><a href="#6-boundary-conditions">Boundary Conditions</a></li>
<li><a href="#7-2d-fem-overview">2D FEM Overview</a></li>
<li><a href="#8-error-analysis-and-convergence">Error Analysis and Convergence</a></li>
<li><a href="#9-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-introduction-to-fem">1. Introduction to FEM<a class="header-link" href="#1-introduction-to-fem" title="Permanent link">&para;</a></h2>
<h3 id="11-what-is-the-finite-element-method">1.1 What is the Finite Element Method?<a class="header-link" href="#11-what-is-the-finite-element-method" title="Permanent link">&para;</a></h3>
<p>The Finite Element Method (FEM) is a powerful numerical technique for solving partial differential equations (PDEs). Unlike finite difference methods that approximate derivatives directly, FEM:</p>
<ol>
<li>Converts the PDE into a <strong>weak (variational) form</strong></li>
<li>Discretizes the domain into <strong>elements</strong> (triangles, tetrahedra, etc.)</li>
<li>Approximates the solution using <strong>piecewise polynomial basis functions</strong></li>
<li>Reduces the problem to solving a linear system</li>
</ol>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FEM Workflow                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Strong Form (PDE)                                          â”‚
â”‚       â†“                                                     â”‚
â”‚  Weak Form (multiply by test function, integrate)          â”‚
â”‚       â†“                                                     â”‚
â”‚  Discretization (mesh + basis functions)                   â”‚
â”‚       â†“                                                     â”‚
â”‚  Matrix System (Au = f)                                     â”‚
â”‚       â†“                                                     â”‚
â”‚  Solve (direct or iterative)                               â”‚
â”‚       â†“                                                     â”‚
â”‚  Approximate Solution                                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Advantages:</strong>
- Handles complex geometries (unstructured meshes)
- Rigorous mathematical foundation (variational calculus)
- Flexible: works for various boundary conditions
- Well-suited for structural mechanics, heat transfer, electromagnetics</p>
<p><strong>Applications:</strong>
- Structural analysis (stress, strain, vibrations)
- Fluid dynamics (Navier-Stokes)
- Heat transfer
- Electromagnetics (Maxwell's equations)</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.sparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">lil_matrix</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.sparse.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">spsolve</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<h3 id="12-model-problem-1d-poisson-equation">1.2 Model Problem: 1D Poisson Equation<a class="header-link" href="#12-model-problem-1d-poisson-equation" title="Permanent link">&para;</a></h3>
<p>We'll focus on the 1D Poisson equation:</p>
<div class="highlight"><pre><span></span><code>-u&#39;&#39;(x) = f(x),  x âˆˆ (0, 1)
u(0) = 0,  u(1) = 0  (Dirichlet boundary conditions)
</code></pre></div>

<p><strong>Example:</strong> If f(x) = 1, the exact solution is u(x) = x(1-x)/2.</p>
<hr />
<h2 id="2-weak-form-and-variational-formulation">2. Weak Form and Variational Formulation<a class="header-link" href="#2-weak-form-and-variational-formulation" title="Permanent link">&para;</a></h2>
<h3 id="21-deriving-the-weak-form">2.1 Deriving the Weak Form<a class="header-link" href="#21-deriving-the-weak-form" title="Permanent link">&para;</a></h3>
<p><strong>Strong form:</strong></p>
<div class="highlight"><pre><span></span><code>-u&#39;&#39;(x) = f(x),  x âˆˆ (0, 1)
u(0) = u(1) = 0
</code></pre></div>

<p><strong>Step 1:</strong> Multiply by a test function v(x) and integrate:</p>
<div class="highlight"><pre><span></span><code>-âˆ«â‚€Â¹ u&#39;&#39;(x) v(x) dx = âˆ«â‚€Â¹ f(x) v(x) dx
</code></pre></div>

<p><strong>Step 2:</strong> Integrate by parts (transfer derivative to v):</p>
<div class="highlight"><pre><span></span><code>âˆ«â‚€Â¹ u&#39;(x) v&#39;(x) dx - [u&#39;(x) v(x)]â‚€Â¹ = âˆ«â‚€Â¹ f(x) v(x) dx
</code></pre></div>

<p>Since v(0) = v(1) = 0 (test functions vanish at boundaries), the boundary term disappears:</p>
<div class="highlight"><pre><span></span><code>âˆ«â‚€Â¹ u&#39;(x) v&#39;(x) dx = âˆ«â‚€Â¹ f(x) v(x) dx
</code></pre></div>

<p>This is the <strong>weak form</strong> (also called <strong>variational form</strong>).</p>
<h3 id="22-bilinear-form-and-functional">2.2 Bilinear Form and Functional<a class="header-link" href="#22-bilinear-form-and-functional" title="Permanent link">&para;</a></h3>
<p>Define:
- Bilinear form: a(u, v) = âˆ«â‚€Â¹ u'(x) v'(x) dx
- Linear functional: L(v) = âˆ«â‚€Â¹ f(x) v(x) dx</p>
<p><strong>Weak formulation:</strong> Find u such that</p>
<div class="highlight"><pre><span></span><code><span class="nv">a</span><span class="ss">(</span><span class="nv">u</span>,<span class="w"> </span><span class="nv">v</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">L</span><span class="ss">(</span><span class="nv">v</span><span class="ss">)</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="nv">functions</span><span class="w"> </span><span class="nv">v</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">weak_form_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conceptual demonstration of weak form.</span>

<span class="sd">    Strong: -u&#39;&#39; = f</span>
<span class="sd">    Weak: âˆ« u&#39; v&#39; dx = âˆ« f v dx</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Strong Form: -u&#39;&#39;(x) = f(x)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Weak Form:   âˆ« u&#39;(x)v&#39;(x) dx = âˆ« f(x)v(x) dx&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Benefits of weak form:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  1. Lower regularity requirement (only u&#39; needed, not u&#39;&#39;)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  2. Natural incorporation of Neumann boundary conditions&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  3. Foundation for Galerkin approximation&quot;</span><span class="p">)</span>

<span class="n">weak_form_example</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="3-finite-element-spaces">3. Finite Element Spaces<a class="header-link" href="#3-finite-element-spaces" title="Permanent link">&para;</a></h2>
<h3 id="31-mesh-and-elements">3.1 Mesh and Elements<a class="header-link" href="#31-mesh-and-elements" title="Permanent link">&para;</a></h3>
<p>Divide [0, 1] into N elements:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              1D Mesh (N=4 elements)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  xâ‚€=0    xâ‚      xâ‚‚      xâ‚ƒ      xâ‚„=1                     â”‚
â”‚   oâ”€â”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€â”€o                       â”‚
â”‚   â”‚ Elem1 â”‚ Elem2 â”‚ Elem3 â”‚ Elem4 â”‚                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p>Each element [xáµ¢, xáµ¢â‚Šâ‚] has length h = 1/N (for uniform mesh).</p>
<h3 id="32-hat-functions-linear-basis">3.2 Hat Functions (Linear Basis)<a class="header-link" href="#32-hat-functions-linear-basis" title="Permanent link">&para;</a></h3>
<p>We approximate u(x) as:</p>
<div class="highlight"><pre><span></span><code>u(x) â‰ˆ uâ‚•(x) = Î£áµ¢â‚Œâ‚€á´º uáµ¢ Ï†áµ¢(x)
</code></pre></div>

<p>where Ï†áµ¢(x) are <strong>hat functions</strong> (piecewise linear, nodal basis):</p>
<div class="highlight"><pre><span></span><code>Ï†áµ¢(x) = { (x - xáµ¢â‚‹â‚)/h,  x âˆˆ [xáµ¢â‚‹â‚, xáµ¢]
        { (xáµ¢â‚Šâ‚ - x)/h,  x âˆˆ [xáµ¢, xáµ¢â‚Šâ‚]
        { 0,              otherwise

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hat Functions                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Ï†â‚€    Ï†â‚    Ï†â‚‚    Ï†â‚ƒ    Ï†â‚„                         â”‚
â”‚          /\    /\    /\    /\    /\                        â”‚
â”‚         /  \  /  \  /  \  /  \  /  \                       â”‚
â”‚        /    \/    \/    \/    \/    \                      â”‚
â”‚       /      \    /\    /\    /      \                     â”‚
â”‚      /        \  /  \  /  \  /        \                    â”‚
â”‚     /          \/    \/    \/          \                   â”‚
â”‚    â”€oâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€oâ”€                 â”‚
â”‚   xâ‚€=0       xâ‚     xâ‚‚     xâ‚ƒ        xâ‚„=1                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>Properties:</strong>
- Ï†áµ¢(xâ±¼) = Î´áµ¢â±¼ (Kronecker delta)
- Local support: Ï†áµ¢(x) â‰  0 only on [xáµ¢â‚‹â‚, xáµ¢â‚Šâ‚]
- uâ‚•(xáµ¢) = uáµ¢ (nodal interpolation)</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hat_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_minus</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">xi_plus</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate hat function centered at xi.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Left slope</span>
    <span class="n">mask1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xi_minus</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xi</span><span class="p">)</span>
    <span class="n">phi</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xi_minus</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="n">xi_minus</span><span class="p">)</span>

    <span class="c1"># Right slope</span>
    <span class="n">mask2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xi_plus</span><span class="p">)</span>
    <span class="n">phi</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_plus</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">mask2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">xi_plus</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">phi</span>

<span class="c1"># Plot hat functions</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">hat_function</span><span class="p">(</span><span class="n">x_fine</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">N</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">hat_function</span><span class="p">(</span><span class="n">x_fine</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">hat_function</span><span class="p">(</span><span class="n">x_fine</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_fine</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Ï†_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ï†áµ¢(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Hat Functions (Linear Finite Elements)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;hat_functions.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="4-element-stiffness-matrix-and-assembly">4. Element Stiffness Matrix and Assembly<a class="header-link" href="#4-element-stiffness-matrix-and-assembly" title="Permanent link">&para;</a></h2>
<h3 id="41-galerkin-discretization">4.1 Galerkin Discretization<a class="header-link" href="#41-galerkin-discretization" title="Permanent link">&para;</a></h3>
<p>Substitute uâ‚• = Î£áµ¢ uáµ¢ Ï†áµ¢ into the weak form:</p>
<div class="highlight"><pre><span></span><code>Î£áµ¢<span class="w"> </span><span class="nv">u</span>áµ¢<span class="w"> </span>âˆ«â‚€Â¹<span class="w"> </span>Ï†áµ¢<span class="s1">&#39; Ï†â±¼&#39;</span><span class="w"> </span><span class="nv">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>âˆ«â‚€Â¹<span class="w"> </span><span class="nv">f</span><span class="w"> </span>Ï†â±¼<span class="w"> </span><span class="nv">dx</span>,<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="nv">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">1</span>,<span class="w"> </span>...,<span class="w"> </span><span class="nv">N</span>
</code></pre></div>

<p>This gives the linear system <strong>Au = f</strong>, where:
- Aáµ¢â±¼ = âˆ«â‚€Â¹ Ï†áµ¢'(x) Ï†â±¼'(x) dx (stiffness matrix)
- fâ±¼ = âˆ«â‚€Â¹ f(x) Ï†â±¼(x) dx (load vector)</p>
<h3 id="42-element-stiffness-matrix">4.2 Element Stiffness Matrix<a class="header-link" href="#42-element-stiffness-matrix" title="Permanent link">&para;</a></h3>
<p>For element e = [xâ‚‘, xâ‚‘â‚Šâ‚], the local stiffness matrix is:</p>
<div class="highlight"><pre><span></span><code>Aâ‚‘ = âˆ«_{xâ‚‘}^{xâ‚‘â‚Šâ‚} Ï†&#39;â‚‘,áµ¢ Ï†&#39;â‚‘,â±¼ dx

For linear elements:
  Ï†â‚‘,â‚(x) = (xâ‚‘â‚Šâ‚ - x)/h,  Ï†&#39;â‚‘,â‚ = -1/h
  Ï†â‚‘,â‚‚(x) = (x - xâ‚‘)/h,    Ï†&#39;â‚‘,â‚‚ = 1/h

  Aâ‚‘ = (1/h) [ 1  -1 ]
             [-1   1 ]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">element_stiffness_1d</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness matrix for 1D linear element.</span>

<span class="sd">    Aâ‚‘ = (1/h) [ 1  -1 ]</span>
<span class="sd">               [-1   1 ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A_elem</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">A_elem</span>

<span class="n">h</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># Element size</span>
<span class="n">A_elem</span> <span class="o">=</span> <span class="n">element_stiffness_1d</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Element stiffness matrix:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A_elem</span><span class="p">)</span>
</code></pre></div>

<h3 id="43-assembly">4.3 Assembly<a class="header-link" href="#43-assembly" title="Permanent link">&para;</a></h3>
<p>Assemble global matrix A by summing contributions from each element:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Assembly Process (N=3 elements)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Element 1: [xâ‚€, xâ‚]  â†’  A[0:2, 0:2] += Aâ‚‘                â”‚
â”‚  Element 2: [xâ‚, xâ‚‚]  â†’  A[1:3, 1:3] += Aâ‚‘                â”‚
â”‚  Element 3: [xâ‚‚, xâ‚ƒ]  â†’  A[2:4, 2:4] += Aâ‚‘                â”‚
â”‚                                                            â”‚
â”‚  Result: Tridiagonal symmetric matrix                     â”‚
â”‚    [ 1  -1   0   0 ]                                      â”‚
â”‚    [-1   2  -1   0 ]  (1/h factor)                        â”‚
â”‚    [ 0  -1   2  -1 ]                                      â”‚
â”‚    [ 0   0  -1   1 ]                                      â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">assemble_stiffness_1d</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assemble global stiffness matrix for 1D problem.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    N : int, number of elements</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    A : (N+1) x (N+1) sparse matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">A_elem</span> <span class="o">=</span> <span class="n">element_stiffness_1d</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c1"># Global node indices for element e</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Add element contribution</span>
        <span class="k">for</span> <span class="n">i_local</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j_local</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">i_global</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i_local</span><span class="p">]</span>
                <span class="n">j_global</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">j_local</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[</span><span class="n">i_global</span><span class="p">,</span> <span class="n">j_global</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A_elem</span><span class="p">[</span><span class="n">i_local</span><span class="p">,</span> <span class="n">j_local</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">A</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">assemble_stiffness_1d</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Global stiffness matrix:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="5-1d-fem-implementation">5. 1D FEM Implementation<a class="header-link" href="#5-1d-fem-implementation" title="Permanent link">&para;</a></h2>
<h3 id="51-complete-fem-solver">5.1 Complete FEM Solver<a class="header-link" href="#51-complete-fem-solver" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fem_1d_poisson</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f_func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve 1D Poisson equation using FEM.</span>

<span class="sd">    -u&#39;&#39;(x) = f(x),  x âˆˆ (0, 1)</span>
<span class="sd">    u(0) = u(1) = 0</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    N : int, number of elements</span>
<span class="sd">    f_func : function, right-hand side f(x)</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    x : array, node coordinates</span>
<span class="sd">    u : array, FEM solution at nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Assemble stiffness matrix</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">assemble_stiffness_1d</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="c1"># Assemble load vector</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">x_left</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
        <span class="n">x_right</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Midpoint rule for integration</span>
        <span class="n">x_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_left</span> <span class="o">+</span> <span class="n">x_right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">f_mid</span> <span class="o">=</span> <span class="n">f_func</span><span class="p">(</span><span class="n">x_mid</span><span class="p">)</span>

        <span class="c1"># Contribution to load vector</span>
        <span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f_mid</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f_mid</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Apply Dirichlet boundary conditions: u(0) = u(N) = 0</span>
    <span class="c1"># Modify first and last row</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">tolil</span><span class="p">()</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">A</span><span class="p">[</span><span class="n">N</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">A</span><span class="p">[</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">f</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>

    <span class="c1"># Solve linear system</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">u</span>

<span class="c1"># Example: f(x) = 1, exact solution u(x) = x(1-x)/2</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">u_exact</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">fem_1d_poisson</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">x_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">u_exact_fine</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">x_fine</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_fine</span><span class="p">,</span> <span class="n">u_exact_fine</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FEM (N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;u(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;1D Poisson Equation: -u</span><span class="se">\&#39;\&#39;</span><span class="s1"> = 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fem_1d_poisson.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Compute error</span>
<span class="n">u_exact_nodes</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">error_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_exact_nodes</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">N</span><span class="p">)))</span>
<span class="n">error_Linf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_exact_nodes</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L2 error:   </span><span class="si">{</span><span class="n">error_L2</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lâˆ error:   </span><span class="si">{</span><span class="n">error_Linf</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="52-variable-source-term">5.2 Variable Source Term<a class="header-link" href="#52-variable-source-term" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Example: f(x) = Ï€Â² sin(Ï€x), exact solution u(x) = sin(Ï€x)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f_sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">u_exact_sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">x</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">fem_1d_poisson</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f_sin</span><span class="p">)</span>

<span class="n">x_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">u_exact_fine</span> <span class="o">=</span> <span class="n">u_exact_sin</span><span class="p">(</span><span class="n">x_fine</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_fine</span><span class="p">,</span> <span class="n">u_exact_fine</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FEM (N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;u(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;1D Poisson: -u</span><span class="se">\&#39;\&#39;</span><span class="s1"> = Ï€Â² sin(Ï€x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fem_1d_poisson_sin.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">u_exact_nodes</span> <span class="o">=</span> <span class="n">u_exact_sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">error_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_exact_nodes</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">N</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L2 error: </span><span class="si">{</span><span class="n">error_L2</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6-boundary-conditions">6. Boundary Conditions<a class="header-link" href="#6-boundary-conditions" title="Permanent link">&para;</a></h2>
<h3 id="61-dirichlet-boundary-conditions">6.1 Dirichlet Boundary Conditions<a class="header-link" href="#61-dirichlet-boundary-conditions" title="Permanent link">&para;</a></h3>
<p>Already implemented above: set u(0) = Î±, u(1) = Î² by modifying rows in the system.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fem_1d_dirichlet</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">u_left</span><span class="p">,</span> <span class="n">u_right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve with Dirichlet BC: u(0) = u_left, u(1) = u_right.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">assemble_stiffness_1d</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">x_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">f_mid</span> <span class="o">=</span> <span class="n">f_func</span><span class="p">(</span><span class="n">x_mid</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f_mid</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f_mid</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Apply BC</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">tolil</span><span class="p">()</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_left</span>

    <span class="n">A</span><span class="p">[</span><span class="n">N</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">A</span><span class="p">[</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">f</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_right</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">u</span>

<span class="c1"># Example: u(0) = 0.5, u(1) = 0.2</span>
<span class="n">x</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">fem_1d_dirichlet</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">f_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">u_left</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">u_right</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;u(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;FEM with Dirichlet BC: u(0)=0.5, u(1)=0.2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fem_dirichlet_bc.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="62-neumann-boundary-conditions">6.2 Neumann Boundary Conditions<a class="header-link" href="#62-neumann-boundary-conditions" title="Permanent link">&para;</a></h3>
<p>For Neumann BC (flux condition), e.g., u'(0) = gâ‚€, u'(1) = gâ‚:</p>
<p>The weak form naturally incorporates Neumann BC through the boundary term:</p>
<div class="highlight"><pre><span></span><code>âˆ«â‚€Â¹ u&#39; v&#39; dx = âˆ«â‚€Â¹ f v dx + [u&#39; v]â‚€Â¹
             = âˆ«â‚€Â¹ f v dx + gâ‚ v(1) - gâ‚€ v(0)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fem_1d_neumann</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_left</span><span class="p">,</span> <span class="n">g_right</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve with Neumann BC: u&#39;(0) = g_left, u&#39;(1) = g_right.</span>

<span class="sd">    Note: Pure Neumann problem has a solution only if âˆ«f dx + g_right - g_left = 0.</span>
<span class="sd">    We fix u(0) = 0 to make the problem well-posed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">assemble_stiffness_1d</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">x_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">f_mid</span> <span class="o">=</span> <span class="n">f_func</span><span class="p">(</span><span class="n">x_mid</span><span class="p">)</span>
        <span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f_mid</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f_mid</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Add Neumann BC contributions</span>
    <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">g_left</span>
    <span class="n">f</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">+=</span> <span class="n">g_right</span>

    <span class="c1"># Fix one value to remove null space (e.g., u(0) = 0)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">tolil</span><span class="p">()</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">u</span>

<span class="c1"># Example: -u&#39;&#39; = 0, u&#39;(0) = 1, u&#39;(1) = 1 â†’ u(x) = x + C, fix C by u(0)=0</span>
<span class="n">x</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">fem_1d_neumann</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">f_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">g_left</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">g_right</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact u(x)=x&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;u(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;FEM with Neumann BC: u</span><span class="se">\&#39;</span><span class="s1">(0)=1, u</span><span class="se">\&#39;</span><span class="s1">(1)=1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fem_neumann_bc.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="7-2d-fem-overview">7. 2D FEM Overview<a class="header-link" href="#7-2d-fem-overview" title="Permanent link">&para;</a></h2>
<h3 id="71-2d-poisson-equation">7.1 2D Poisson Equation<a class="header-link" href="#71-2d-poisson-equation" title="Permanent link">&para;</a></h3>
<p>In 2D, the Poisson equation is:</p>
<div class="highlight"><pre><span></span><code>-Î”u = -âˆ‚Â²u/âˆ‚xÂ² - âˆ‚Â²u/âˆ‚yÂ² = f(x, y),  (x, y) âˆˆ Î©
u = 0 on âˆ‚Î© (boundary)
</code></pre></div>

<p><strong>Weak form:</strong></p>
<div class="highlight"><pre><span></span><code>âˆ«_Î© âˆ‡u Â· âˆ‡v dA = âˆ«_Î© f v dA
</code></pre></div>

<h3 id="72-triangular-elements">7.2 Triangular Elements<a class="header-link" href="#72-triangular-elements" title="Permanent link">&para;</a></h3>
<p>The domain Î© is divided into triangular elements:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              2D Triangular Mesh                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚      oâ”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€o                                       â”‚
â”‚      â”‚\     â”‚\     â”‚                                       â”‚
â”‚      â”‚ \    â”‚ \    â”‚                                       â”‚
â”‚      â”‚  \   â”‚  \   â”‚                                       â”‚
â”‚      â”‚   \  â”‚   \  â”‚                                       â”‚
â”‚      â”‚    \ â”‚    \ â”‚                                       â”‚
â”‚      oâ”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€o                                       â”‚
â”‚      â”‚\     â”‚\     â”‚                                       â”‚
â”‚      â”‚ \    â”‚ \    â”‚                                       â”‚
â”‚      â”‚  \   â”‚  \   â”‚                                       â”‚
â”‚      oâ”€â”€â”€â”€â”€â”€oâ”€â”€â”€â”€â”€â”€o                                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p>Each triangle has 3 vertices (nodes). Linear basis functions Ï†áµ¢(x, y) satisfy:
- Ï†áµ¢(xâ±¼, yâ±¼) = Î´áµ¢â±¼
- Ï†áµ¢ is linear within each triangle
- Ï†áµ¢ = 0 outside triangles containing node i</p>
<h3 id="73-element-stiffness-matrix-2d">7.3 Element Stiffness Matrix (2D)<a class="header-link" href="#73-element-stiffness-matrix-2d" title="Permanent link">&para;</a></h3>
<p>For a triangle with vertices (xâ‚, yâ‚), (xâ‚‚, yâ‚‚), (xâ‚ƒ, yâ‚ƒ):</p>
<div class="highlight"><pre><span></span><code><span class="n">Aáµ¢â±¼</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">âˆ«</span><span class="n">_T</span><span class="w"> </span><span class="err">âˆ‡Ï†áµ¢</span><span class="w"> </span><span class="err">Â·</span><span class="w"> </span><span class="err">âˆ‡Ï†â±¼</span><span class="w"> </span><span class="n">dA</span>

<span class="n">where</span><span class="w"> </span><span class="err">âˆ‡Ï†áµ¢</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">âˆ‚Ï†áµ¢</span><span class="o">/</span><span class="err">âˆ‚</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="err">âˆ‚Ï†áµ¢</span><span class="o">/</span><span class="err">âˆ‚</span><span class="n">y</span><span class="p">]</span><span class="err">áµ€</span><span class="w"> </span><span class="p">(</span><span class="n">constant</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">triangle</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">triangle_area</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute area of triangle with vertices p1, p2, p3.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">((</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">p3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span>
                     <span class="p">(</span><span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">triangle_stiffness_2d</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute element stiffness matrix for 2D linear triangle.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    p1, p2, p3 : tuples (x, y), triangle vertices</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    A_elem : 3x3 array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">p3</span>

    <span class="n">area</span> <span class="o">=</span> <span class="n">triangle_area</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>

    <span class="c1"># Gradient of basis functions (constant in triangle)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">])</span>

    <span class="c1"># Stiffness matrix</span>
    <span class="n">A_elem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">A_elem</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">A_elem</span>

<span class="c1"># Example triangle</span>
<span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">A_elem</span> <span class="o">=</span> <span class="n">triangle_stiffness_2d</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2D triangle stiffness matrix:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A_elem</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="8-error-analysis-and-convergence">8. Error Analysis and Convergence<a class="header-link" href="#8-error-analysis-and-convergence" title="Permanent link">&para;</a></h2>
<h3 id="81-convergence-rate">8.1 Convergence Rate<a class="header-link" href="#81-convergence-rate" title="Permanent link">&para;</a></h3>
<p>For linear finite elements (piecewise linear basis) solving -u'' = f:</p>
<p><strong>Theoretical convergence:</strong>
- LÂ² error: ||u - uâ‚•||<em>{LÂ²} = O(hÂ²)
- HÂ¹ error: ||u - uâ‚•||</em>{HÂ¹} = O(h)  (gradient error)
- Lâˆ error: ||u - uâ‚•||_{Lâˆ} = O(hÂ²)</p>
<p>where h is the element size.</p>
<h3 id="82-convergence-test">8.2 Convergence Test<a class="header-link" href="#82-convergence-test" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convergence_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test FEM convergence by solving -u&#39;&#39; = Ï€Â² sin(Ï€x) with increasing N.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
    <span class="n">errors_L2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">errors_Linf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">h_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">N_values</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">fem_1d_poisson</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">u_exact_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">N</span>
        <span class="n">h_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="n">error_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_exact_nodes</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">error_Linf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_exact_nodes</span><span class="p">))</span>

        <span class="n">errors_L2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_L2</span><span class="p">)</span>
        <span class="n">errors_Linf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_Linf</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N=</span><span class="si">{</span><span class="n">N</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">, h=</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">: L2=</span><span class="si">{</span><span class="n">error_L2</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">, Lâˆ=</span><span class="si">{</span><span class="n">error_Linf</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Plot convergence</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">h_values</span><span class="p">,</span> <span class="n">errors_L2</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LÂ² error&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">h_values</span><span class="p">,</span> <span class="n">errors_Linf</span><span class="p">,</span> <span class="s1">&#39;s-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lâˆ error&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># Reference slopes</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">h_values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">h_values</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;O(hÂ²)&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">h_values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">h_values</span><span class="p">),</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;O(h)&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;h (element size)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;FEM Convergence (Linear Elements)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fem_convergence.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">convergence_test</span><span class="p">()</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="highlight"><pre><span></span><code>N=  5, h=0.2000: L2=3.9464e-03, Lâˆ=4.9299e-03
N= 10, h=0.1000: L2=9.9067e-04, Lâˆ=1.2337e-03
N= 20, h=0.0500: L2=2.4794e-04, Lâˆ=3.0852e-04
N= 40, h=0.0250: L2=6.2007e-05, Lâˆ=7.7139e-05
N= 80, h=0.0125: L2=1.5504e-05, Lâˆ=1.9286e-05
</code></pre></div>

<p>The errors decrease as O(hÂ²), confirming theoretical predictions.</p>
<hr />
<h2 id="9-practice-problems">9. Practice Problems<a class="header-link" href="#9-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-variable-coefficient">Problem 1: Variable Coefficient<a class="header-link" href="#problem-1-variable-coefficient" title="Permanent link">&para;</a></h3>
<p>Solve the variable coefficient problem:</p>
<div class="highlight"><pre><span></span><code>-(a(x) u&#39;(x))&#39; = f(x),  x âˆˆ (0, 1)
u(0) = u(1) = 0
</code></pre></div>

<p>with a(x) = 1 + x and f(x) = 1. Implement FEM and compare with a numerical reference.</p>
<p><strong>Hint:</strong> Weak form is âˆ« a(x) u'(x) v'(x) dx = âˆ« f(x) v(x) dx.</p>
<h3 id="problem-2-mixed-boundary-conditions">Problem 2: Mixed Boundary Conditions<a class="header-link" href="#problem-2-mixed-boundary-conditions" title="Permanent link">&para;</a></h3>
<p>Solve -u'' = 1 with u(0) = 0 (Dirichlet) and u'(1) = -0.5 (Neumann). Compare with exact solution.</p>
<h3 id="problem-3-quadratic-elements">Problem 3: Quadratic Elements<a class="header-link" href="#problem-3-quadratic-elements" title="Permanent link">&para;</a></h3>
<p>Extend the 1D FEM code to use quadratic basis functions (3 nodes per element: two endpoints + midpoint). Compare convergence rate with linear elements.</p>
<h3 id="problem-4-2d-poisson-on-unit-square">Problem 4: 2D Poisson on Unit Square<a class="header-link" href="#problem-4-2d-poisson-on-unit-square" title="Permanent link">&para;</a></h3>
<p>Implement 2D FEM for -Î”u = 1 on the unit square [0,1]Ã—[0,1] with u=0 on boundary. Use a structured triangular mesh and verify the solution.</p>
<h3 id="problem-5-higher-order-convergence">Problem 5: Higher-Order Convergence<a class="header-link" href="#problem-5-higher-order-convergence" title="Permanent link">&para;</a></h3>
<p>Test convergence for the equation -u'' = f(x) where f(x) is chosen such that the exact solution u(x) = x(1-x) sin(Ï€x). Verify that LÂ² error is O(hÂ²) for linear elements.</p>
<hr />
<h2 id="navigation">Navigation<a class="header-link" href="#navigation" title="Permanent link">&para;</a></h2>
<ul>
<li>Previous: <a href="21_Spectral_Methods.md">21. Spectral Methods</a></li>
<li>Next: <a href="00_Overview.md">Overview</a></li>
<li><a href="00_Overview.md">Back to Overview</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Numerical_Simulation/21_Spectral_Methods.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Spectral Methods</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Numerical_Simulation/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}