{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Replacement â­â­â­â­ - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/OS_Theory/">OS Theory</a>
    <span class="separator">/</span>
    <span class="current">Page Replacement â­â­â­â­</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Page Replacement â­â­â­â­</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/OS_Theory/14_Virtual_Memory.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Virtual Memory â­â­â­</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/OS_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/OS_Theory/16_File_System_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">File System Basics â­â­â­</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-need-for-page-replacement">1. Need for Page Replacement</a><ul>
<li><a href="#11-over-allocation">1.1 Over-allocation</a></li>
<li><a href="#12-page-replacement-process">1.2 Page Replacement Process</a></li>
<li><a href="#13-dirty-bit">1.3 Dirty Bit</a></li>
</ul>
</li>
<li><a href="#2-fifo-algorithm">2. FIFO Algorithm</a><ul>
<li><a href="#21-concept">2.1 Concept</a></li>
<li><a href="#22-fifo-implementation">2.2 FIFO Implementation</a></li>
<li><a href="#23-example">2.3 Example</a></li>
</ul>
</li>
<li><a href="#3-optimal-algorithm">3. Optimal Algorithm</a><ul>
<li><a href="#31-concept">3.1 Concept</a></li>
<li><a href="#32-optimal-implementation">3.2 Optimal Implementation</a></li>
<li><a href="#33-example">3.3 Example</a></li>
</ul>
</li>
<li><a href="#4-lru-algorithm">4. LRU Algorithm</a><ul>
<li><a href="#41-concept">4.1 Concept</a></li>
<li><a href="#42-lru-implementation-methods">4.2 LRU Implementation Methods</a></li>
<li><a href="#43-lru-stack-implementation">4.3 LRU Stack Implementation</a></li>
<li><a href="#44-example">4.4 Example</a></li>
</ul>
</li>
<li><a href="#5-lru-approximation-algorithms">5. LRU Approximation Algorithms</a><ul>
<li><a href="#51-second-chance-clock-algorithm">5.1 Second-Chance (Clock) Algorithm</a></li>
<li><a href="#52-enhanced-second-chance">5.2 Enhanced Second-Chance</a></li>
<li><a href="#53-clock-algorithm-implementation">5.3 Clock Algorithm Implementation</a></li>
</ul>
</li>
<li><a href="#6-beladys-anomaly">6. Belady's Anomaly</a><ul>
<li><a href="#61-phenomenon">6.1 Phenomenon</a></li>
<li><a href="#62-stack-algorithms">6.2 Stack Algorithms</a></li>
</ul>
</li>
<li><a href="#7-thrashing-and-working-set">7. Thrashing and Working Set</a><ul>
<li><a href="#71-thrashing">7.1 Thrashing</a></li>
<li><a href="#72-working-set-model">7.2 Working Set Model</a></li>
<li><a href="#73-page-fault-frequency-pff">7.3 Page Fault Frequency (PFF)</a></li>
<li><a href="#74-preventing-thrashing-in-linux">7.4 Preventing Thrashing in Linux</a></li>
</ul>
</li>
<li><a href="#practice-problems">Practice Problems</a><ul>
<li><a href="#problem-1-algorithm-comparison">Problem 1: Algorithm Comparison</a></li>
<li><a href="#problem-2-second-chance">Problem 2: Second-Chance</a></li>
<li><a href="#problem-3-working-set">Problem 3: Working Set</a></li>
<li><a href="#problem-4-beladys-anomaly-proof">Problem 4: Belady's Anomaly Proof</a></li>
<li><a href="#problem-5-thrashing-solution">Problem 5: Thrashing Solution</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="page-replacement">Page Replacement â­â­â­â­<a class="header-link" href="#page-replacement" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Page replacement algorithms determine which page to evict when physical memory is insufficient. Learn about major algorithms including FIFO, Optimal, LRU, Belady's Anomaly, and thrashing.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-need-for-page-replacement">Need for Page Replacement</a></li>
<li><a href="#2-fifo-algorithm">FIFO Algorithm</a></li>
<li><a href="#3-optimal-algorithm">Optimal Algorithm</a></li>
<li><a href="#4-lru-algorithm">LRU Algorithm</a></li>
<li><a href="#5-lru-approximation-algorithms">LRU Approximation Algorithms</a></li>
<li><a href="#6-beladys-anomaly">Belady's Anomaly</a></li>
<li><a href="#7-thrashing-and-working-set">Thrashing and Working Set</a></li>
<li><a href="#practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-need-for-page-replacement">1. Need for Page Replacement<a class="header-link" href="#1-need-for-page-replacement" title="Permanent link">&para;</a></h2>
<h3 id="11-over-allocation">1.1 Over-allocation<a class="header-link" href="#11-over-allocation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                        </span><span class="nx">Memory</span><span class="w"> </span><span class="nx">Over</span><span class="o">-</span><span class="nx">allocation</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Physical</span><span class="w"> </span><span class="nx">Memory</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="nx">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">097</span><span class="p">,</span><span class="mi">152</span><span class="w"> </span><span class="nx">frames</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="mi">4</span><span class="nx">KB</span><span class="p">)</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Process</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="nx">GB</span><span class="w"> </span><span class="kd">virtual</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">space</span><span class="w">                             </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Process</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="nx">GB</span><span class="w"> </span><span class="kd">virtual</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">space</span><span class="w">                             </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Process</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="nx">GB</span><span class="w"> </span><span class="kd">virtual</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">space</span><span class="w">                             </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Process</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="nx">GB</span><span class="w"> </span><span class="kd">virtual</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">space</span><span class="w">                             </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="o">...</span><span class="w">                                                               </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Total</span><span class="w"> </span><span class="kd">virtual</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">space</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="nx">GB</span><span class="w">                                </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="mi">20</span><span class="nx">GB</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">8</span><span class="nx">GB</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Cannot</span><span class="w"> </span><span class="nx">hold</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">pages</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">memory</span><span class="p">!</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Solution</span><span class="p">:</span><span class="w"> </span><span class="nx">Demand</span><span class="w"> </span><span class="nx">paging</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">Page</span><span class="w"> </span><span class="nx">replacement</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Only</span><span class="w"> </span><span class="nx">actively</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="nx">pages</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">memory</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Rest</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">disk</span><span class="w"> </span><span class="nx">swap</span><span class="w"> </span><span class="nx">space</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Replace</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">needed</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="12-page-replacement-process">1.2 Page Replacement Process<a class="header-link" href="#12-page-replacement-process" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                       </span><span class="nv">Page</span><span class="w"> </span><span class="nv">Replacement</span><span class="w"> </span><span class="nv">Process</span><span class="w">                           </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Page</span><span class="w"> </span><span class="nv">fault</span><span class="w"> </span><span class="nv">occurs</span><span class="w"> </span><span class="ss">(</span><span class="nv">needed</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">memory</span><span class="ss">)</span><span class="w">                      </span>â”‚
â”‚<span class="w">      </span>â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">      </span>â–¼<span class="w">                                                                   </span>â”‚
â”‚<span class="w">   </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Find</span><span class="w"> </span><span class="nv">free</span><span class="w"> </span><span class="nv">frame</span><span class="w">                                                    </span>â”‚
â”‚<span class="w">      </span>â”œâ”€â”€<span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">available</span>:<span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">frame</span><span class="w">                                   </span>â”‚
â”‚<span class="w">      </span>â””â”€â”€<span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">not</span>:<span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">replacement</span><span class="w"> </span><span class="nv">needed</span><span class="w">                                </span>â”‚
â”‚<span class="w">          </span>â”‚<span class="w">                                                               </span>â”‚
â”‚<span class="w">          </span>â–¼<span class="w">                                                               </span>â”‚
â”‚<span class="w">   </span><span class="mi">3</span>.<span class="w"> </span><span class="nv">Select</span><span class="w"> </span><span class="nv">victim</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="ss">(</span><span class="nv">using</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">replacement</span><span class="w"> </span><span class="nv">algorithm</span><span class="ss">)</span><span class="w">              </span>â”‚
â”‚<span class="w">      </span>â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">      </span>â–¼<span class="w">                                                                   </span>â”‚
â”‚<span class="w">   </span><span class="mi">4</span>.<span class="w"> </span><span class="nv">Handle</span><span class="w"> </span><span class="nv">victim</span><span class="w"> </span><span class="nv">page</span><span class="w">                                                 </span>â”‚
â”‚<span class="w">      </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Modified</span><span class="w"> </span><span class="ss">(</span><span class="nv">Dirty</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">disk</span><span class="w">                                </span>â”‚
â”‚<span class="w">      </span>â””â”€â”€<span class="w"> </span><span class="nv">Not</span><span class="w"> </span><span class="nv">modified</span>:<span class="w"> </span><span class="nv">discard</span><span class="w">                                          </span>â”‚
â”‚<span class="w">      </span>â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">      </span>â–¼<span class="w">                                                                   </span>â”‚
â”‚<span class="w">   </span><span class="mi">5</span>.<span class="w"> </span><span class="nv">Load</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">page</span><span class="w">                                                      </span>â”‚
â”‚<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nv">Read</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">disk</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">frame</span><span class="w">                                          </span>â”‚
â”‚<span class="w">      </span>â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">      </span>â–¼<span class="w">                                                                   </span>â”‚
â”‚<span class="w">   </span><span class="mi">6</span>.<span class="w"> </span><span class="nv">Update</span><span class="w"> </span><span class="nv">tables</span><span class="w">                                                      </span>â”‚
â”‚<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nv">Victim</span><span class="w"> </span><span class="nv">page</span>:<span class="w"> </span><span class="nv">valid</span><span class="o">=</span><span class="mi">0</span><span class="w">                                             </span>â”‚
â”‚<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">page</span>:<span class="w"> </span><span class="nv">valid</span><span class="o">=</span><span class="mi">1</span>,<span class="w"> </span><span class="nv">record</span><span class="w"> </span><span class="nv">frame</span><span class="w"> </span><span class="nv">number</span><span class="w">                           </span>â”‚
â”‚<span class="w">      </span>â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">      </span>â–¼<span class="w">                                                                   </span>â”‚
â”‚<span class="w">   </span><span class="mi">7</span>.<span class="w"> </span><span class="nv">Restart</span><span class="w"> </span><span class="nv">instruction</span><span class="w">                                                </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="13-dirty-bit">1.3 Dirty Bit<a class="header-link" href="#13-dirty-bit" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Using Dirty Bit in page replacement</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">replace_page</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">victim_frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PageTableEntry</span><span class="o">*</span><span class="w"> </span><span class="n">victim_pte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_pte_for_frame</span><span class="p">(</span><span class="n">victim_frame</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">victim_pte</span><span class="o">-&gt;</span><span class="n">dirty</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Modified page - must write to disk</span>
<span class="w">        </span><span class="n">write_to_swap</span><span class="p">(</span><span class="n">victim_frame</span><span class="p">,</span><span class="w"> </span><span class="n">victim_pte</span><span class="o">-&gt;</span><span class="n">swap_slot</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// 2 I/Os: read + write</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Not modified - disk copy is valid</span>
<span class="w">        </span><span class="c1">// Just discard, no disk write needed</span>
<span class="w">        </span><span class="c1">// 1 I/O: read only</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Load new page</span>
<span class="w">    </span><span class="n">read_from_swap</span><span class="p">(</span><span class="n">victim_frame</span><span class="p">,</span><span class="w"> </span><span class="n">new_page_swap_slot</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="2-fifo-algorithm">2. FIFO Algorithm<a class="header-link" href="#2-fifo-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="21-concept">2.1 Concept<a class="header-link" href="#21-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">FIFO</span><span class="w"> </span><span class="p">(</span><span class="n">First</span><span class="o">-</span><span class="n">In</span><span class="p">,</span><span class="w"> </span><span class="n">First</span><span class="o">-</span><span class="n">Out</span><span class="p">)</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="n">Rule</span><span class="p">:</span><span class="w"> </span><span class="n">Replace</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">oldest</span><span class="w"> </span><span class="n">page</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="n">Implementation</span><span class="p">:</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">queue</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="n">Page</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">order</span><span class="p">:</span><span class="w">  </span><span class="n">A</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">...</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="n">Memory</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="n">frames</span><span class="p">):</span><span class="w">                                            </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”</span><span class="w">                                                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">Oldest</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”¬â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜</span><span class="w">                                                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â–¼</span><span class="w"> </span><span class="n">On</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="n">access</span><span class="w">                                               </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”</span><span class="w">                                                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">replaced</span><span class="w">                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”˜</span><span class="w">                                                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                                                        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â–¼</span><span class="w"> </span><span class="n">On</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">access</span><span class="w">                                           </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”</span><span class="w">                                                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">replaced</span><span class="w"> </span><span class="p">(</span><span class="n">now</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">oldest</span><span class="p">)</span><span class="w">                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜</span><span class="w">                                                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="n">Advantages</span><span class="p">:</span><span class="w"> </span><span class="n">Simple</span><span class="w"> </span><span class="n">implementation</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="n">Disadvantages</span><span class="p">:</span><span class="w"> </span><span class="n">May</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">frequently</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">pages</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="22-fifo-implementation">2.2 FIFO Implementation<a class="header-link" href="#22-fifo-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>

<span class="cp">#define MAX_FRAMES 10</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pages</span><span class="p">[</span><span class="n">MAX_FRAMES</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">front</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">rear</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">FIFOQueue</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">fifo_init</span><span class="p">(</span><span class="n">FIFOQueue</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">capacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">rear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">fifo_contains</span><span class="p">(</span><span class="n">FIFOQueue</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">front</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">capacity</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">fifo_access</span><span class="p">(</span><span class="n">FIFOQueue</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Hit if page already exists</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fifo_contains</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Page %d: hit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// No page fault</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Page fault</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Page %d: fault&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">capacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Free frame available</span>
<span class="w">        </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">[</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">rear</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">        </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">rear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">rear</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">capacity</span><span class="p">;</span>
<span class="w">        </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (using free frame)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Replace oldest page</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">[</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">front</span><span class="p">];</span>
<span class="w">        </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">[</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">front</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">        </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">front</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">capacity</span><span class="p">;</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (replaced page %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">victim</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Page fault</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">fifo_print</span><span class="p">(</span><span class="n">FIFOQueue</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Memory: [&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">front</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">capacity</span><span class="p">;</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;]</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">FIFOQueue</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">    </span><span class="n">fifo_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">reference_string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">reference_string</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">reference_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page_faults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">page_faults</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">fifo_access</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">reference_string</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">        </span><span class="n">fifo_print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Total page faults: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page_faults</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="23-example">2.3 Example<a class="header-link" href="#23-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               FIFO Example (3 frames)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Reference string: 7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2, 1, 2         â”‚
â”‚                                                                          â”‚
â”‚   Access  Frame 0   Frame 1   Frame 2    Fault?                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚    7      7         -          -          fault                         â”‚
â”‚    0      7         0          -          fault                         â”‚
â”‚    1      7         0          1          fault                         â”‚
â”‚    2      2         0          1          fault (replaced 7)            â”‚
â”‚    0      2         0          1          hit                           â”‚
â”‚    3      2         3          1          fault (replaced 0)            â”‚
â”‚    0      2         3          0          fault (replaced 1)            â”‚
â”‚    4      4         3          0          fault (replaced 2)            â”‚
â”‚    2      4         2          0          fault (replaced 3)            â”‚
â”‚    3      4         2          3          fault (replaced 0)            â”‚
â”‚    0      0         2          3          fault (replaced 4)            â”‚
â”‚    3      0         2          3          hit                           â”‚
â”‚    2      0         2          3          hit                           â”‚
â”‚    1      0         1          3          fault (replaced 2)            â”‚
â”‚    2      0         1          2          fault (replaced 3)            â”‚
â”‚                                                                          â”‚
â”‚   Total page faults: 12                                                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="3-optimal-algorithm">3. Optimal Algorithm<a class="header-link" href="#3-optimal-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="31-concept">3.1 Concept<a class="header-link" href="#31-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="nx">Optimal</span><span class="w"> </span><span class="p">(</span><span class="nx">OPT</span><span class="p">)</span><span class="w"> </span><span class="nx">Algorithm</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Rule</span><span class="p">:</span><span class="w"> </span><span class="nx">Replace</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">unused</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">longest</span><span class="w"> </span><span class="nx">time</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="p">(</span><span class="nx">Requires</span><span class="w"> </span><span class="nx">future</span><span class="w"> </span><span class="nx">knowledge</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ideal</span><span class="w"> </span><span class="nx">algorithm</span><span class="p">)</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Example</span><span class="p">:</span><span class="w">                                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Future</span><span class="w"> </span><span class="nx">reference</span><span class="p">:</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="nx">D</span><span class="p">,</span><span class="w"> </span><span class="nx">E</span><span class="p">,</span><span class="w"> </span><span class="nx">F</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">,</span><span class="w"> </span><span class="nx">C</span><span class="p">,</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="o">...</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="err">â†‘</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="nx">Current</span><span class="w"> </span><span class="nx">position</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Memory</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">B</span><span class="p">,</span><span class="w"> </span><span class="nx">C</span><span class="p">]</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="nx">D</span><span class="p">,</span><span class="w"> </span><span class="nx">which</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">replace</span><span class="p">?</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">A</span><span class="p">:</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nx">accesses</span><span class="w"> </span><span class="nx">later</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">B</span><span class="p">:</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="nx">accesses</span><span class="w"> </span><span class="nx">later</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">C</span><span class="p">:</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="nx">accesses</span><span class="w"> </span><span class="nx">later</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="nx">Used</span><span class="w"> </span><span class="nx">latest</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Replacing</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">optimal</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Advantages</span><span class="p">:</span><span class="w"> </span><span class="nx">Guarantees</span><span class="w"> </span><span class="nx">minimum</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="nx">faults</span><span class="w"> </span><span class="p">(</span><span class="nx">comparison</span><span class="w"> </span><span class="nx">baseline</span><span class="p">)</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Disadvantages</span><span class="p">:</span><span class="w"> </span><span class="nx">Cannot</span><span class="w"> </span><span class="nx">predict</span><span class="w"> </span><span class="nx">future</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nx">Impossible</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">implement</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="32-optimal-implementation">3.2 Optimal Implementation<a class="header-link" href="#32-optimal-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>

<span class="cp">#define MAX_FRAMES 10</span>
<span class="cp">#define MAX_REFS 100</span>

<span class="kt">int</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">MAX_FRAMES</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">frame_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">reference_string</span><span class="p">[</span><span class="n">MAX_REFS</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">ref_length</span><span class="p">;</span>

<span class="c1">// Check if page is in memory</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">find_page</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">frame_count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Find page that will be used latest in the future</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">find_victim</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">current_index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">farthest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">frame_count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">next_use</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ref_length</span><span class="p">;</span><span class="w">  </span><span class="c1">// Max value if not used</span>

<span class="w">        </span><span class="c1">// Find when this page is used in future references</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ref_length</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reference_string</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">next_use</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next_use</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">farthest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">farthest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_use</span><span class="p">;</span>
<span class="w">            </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">victim</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">optimal_access</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">current_index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_page</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">idx</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Page %d: hit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Page %d: fault&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame_count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">frames</span><span class="p">[</span><span class="n">frame_count</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (using free frame)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">victim_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_victim</span><span class="p">(</span><span class="n">current_index</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (replaced page %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">victim_idx</span><span class="p">]);</span>
<span class="w">        </span><span class="n">frames</span><span class="p">[</span><span class="n">victim_idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">refs</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span>
<span class="w">    </span><span class="n">ref_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ref_length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">reference_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">refs</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page_faults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ref_length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">page_faults</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">optimal_access</span><span class="p">(</span><span class="n">reference_string</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Total page faults: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page_faults</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="33-example">3.3 Example<a class="header-link" href="#33-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Optimal Example (3 frames)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Reference string: 7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2, 1, 2         â”‚
â”‚                                                                          â”‚
â”‚   Access  Frame 0   Frame 1   Frame 2    Fault?   Reason                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚    7      7         -          -          fault                         â”‚
â”‚    0      7         0          -          fault                         â”‚
â”‚    1      7         0          1          fault                         â”‚
â”‚    2      2         0          1          fault    7: not used          â”‚
â”‚    0      2         0          1          hit                           â”‚
â”‚    3      2         0          3          fault    1: used latest       â”‚
â”‚    0      2         0          3          hit                           â”‚
â”‚    4      2         4          3          fault    0: used latest       â”‚
â”‚    2      2         4          3          hit                           â”‚
â”‚    3      2         4          3          hit                           â”‚
â”‚    0      0         4          3          fault    2: used latest       â”‚
â”‚    3      0         4          3          hit                           â”‚
â”‚    2      0         2          3          fault    4: not used          â”‚
â”‚    1      0         2          1          fault    3: not used          â”‚
â”‚    2      0         2          1          hit                           â”‚
â”‚                                                                          â”‚
â”‚   Total page faults: 9 (3 fewer than FIFO!)                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="4-lru-algorithm">4. LRU Algorithm<a class="header-link" href="#4-lru-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="41-concept">4.1 Concept<a class="header-link" href="#41-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="nx">LRU</span><span class="w"> </span><span class="p">(</span><span class="nx">Least</span><span class="w"> </span><span class="nx">Recently</span><span class="w"> </span><span class="nx">Used</span><span class="p">)</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Rule</span><span class="p">:</span><span class="w"> </span><span class="nx">Replace</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">longest</span><span class="w"> </span><span class="nx">time</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="p">(</span><span class="nx">Recent</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">likely</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">near</span><span class="w"> </span><span class="nx">future</span><span class="p">)</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Comparison</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">Optimal</span><span class="p">:</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Optimal</span><span class="p">:</span><span class="w"> </span><span class="nx">Looks</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">future</span><span class="w"> </span><span class="p">(</span><span class="nx">will</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">unused</span><span class="w"> </span><span class="nx">longest</span><span class="p">)</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">LRU</span><span class="p">:</span><span class="w"> </span><span class="nx">Looks</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">past</span><span class="w"> </span><span class="p">(</span><span class="nx">unused</span><span class="w"> </span><span class="nx">longest</span><span class="w"> </span><span class="nx">so</span><span class="w"> </span><span class="nx">far</span><span class="p">)</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Utilizes</span><span class="w"> </span><span class="nx">Temporal</span><span class="w"> </span><span class="nx">Locality</span><span class="p">:</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="s">&quot;Recently used data is likely to be used again in near future&quot;</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Advantages</span><span class="p">:</span><span class="w">                                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Performance</span><span class="w"> </span><span class="nx">close</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">Optimal</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Actually</span><span class="w"> </span><span class="nx">implementable</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nx">Disadvantages</span><span class="p">:</span><span class="w">                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Complex</span><span class="w"> </span><span class="nx">implementation</span><span class="w"> </span><span class="p">(</span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">track</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="nx">times</span><span class="p">)</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">High</span><span class="w"> </span><span class="nx">overhead</span><span class="w"> </span><span class="nx">without</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">support</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="42-lru-implementation-methods">4.2 LRU Implementation Methods<a class="header-link" href="#42-lru-implementation-methods" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="nt">LRU</span><span class="w"> </span><span class="nt">Implementation</span><span class="w"> </span><span class="nt">Methods</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nt">1</span><span class="o">.</span><span class="w"> </span><span class="nt">Counter-based</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Store</span><span class="w"> </span><span class="nt">timestamp</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">each</span><span class="w"> </span><span class="nt">page</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">On</span><span class="w"> </span><span class="nt">page</span><span class="w"> </span><span class="nt">access</span><span class="o">:</span><span class="w">                                                 </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">page</span><span class="p">.</span><span class="nc">last_used</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="nt">global_counter</span><span class="o">;</span><span class="w">                             </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">On</span><span class="w"> </span><span class="nt">replacement</span><span class="o">:</span><span class="w"> </span><span class="nt">select</span><span class="w"> </span><span class="nt">page</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">smallest</span><span class="w"> </span><span class="nt">counter</span><span class="w"> </span><span class="nt">value</span><span class="w">        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Disadvantage</span><span class="o">:</span><span class="w"> </span><span class="nt">O</span><span class="o">(</span><span class="nt">n</span><span class="o">)</span><span class="w"> </span><span class="nt">table</span><span class="w"> </span><span class="nt">search</span><span class="o">,</span><span class="w"> </span><span class="nt">overflow</span><span class="w"> </span><span class="nt">handling</span><span class="w"> </span><span class="nt">needed</span><span class="w">      </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="nt">2</span><span class="o">.</span><span class="w"> </span><span class="nt">Stack-based</span><span class="w">                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Manage</span><span class="w"> </span><span class="nt">pages</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">doubly</span><span class="w"> </span><span class="nt">linked</span><span class="w"> </span><span class="nt">list</span><span class="w">                           </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">On</span><span class="w"> </span><span class="nt">page</span><span class="w"> </span><span class="nt">access</span><span class="o">:</span><span class="w"> </span><span class="nt">move</span><span class="w"> </span><span class="nt">that</span><span class="w"> </span><span class="nt">page</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">stack</span><span class="w"> </span><span class="nt">top</span><span class="w">                    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">On</span><span class="w"> </span><span class="nt">replacement</span><span class="o">:</span><span class="w"> </span><span class="nt">remove</span><span class="w"> </span><span class="nt">page</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">stack</span><span class="w"> </span><span class="nt">bottom</span><span class="w">                    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="nt">Top</span><span class="w">                                                          </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â†“</span><span class="w">                                                           </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”</span><span class="w">                                                         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nt">A</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="nt">Most</span><span class="w"> </span><span class="nt">recently</span><span class="w"> </span><span class="nt">used</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€â”€â”¤</span><span class="w">                                                         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nt">C</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                                                         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€â”€â”¤</span><span class="w">                                                         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nt">B</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="nt">Least</span><span class="w"> </span><span class="nt">recently</span><span class="w"> </span><span class="nt">used</span><span class="w"> </span><span class="o">(</span><span class="nt">replacement</span><span class="w"> </span><span class="nt">target</span><span class="o">)</span><span class="w">             </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”˜</span><span class="w">                                                         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="nt">Bottom</span><span class="w">                                                        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Advantage</span><span class="o">:</span><span class="w"> </span><span class="nt">O</span><span class="o">(</span><span class="nt">1</span><span class="o">)</span><span class="w"> </span><span class="nt">replacement</span><span class="w">                                    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Disadvantage</span><span class="o">:</span><span class="w"> </span><span class="nt">Pointer</span><span class="w"> </span><span class="nt">updates</span><span class="w"> </span><span class="nt">needed</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="nt">move</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                          </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="43-lru-stack-implementation">4.3 LRU Stack Implementation<a class="header-link" href="#43-lru-stack-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="o">*</span><span class="w"> </span><span class="n">prev</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="o">*</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">Node</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">head</span><span class="p">;</span><span class="w">   </span><span class="c1">// Most recently used</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">tail</span><span class="p">;</span><span class="w">   </span><span class="c1">// Least recently used</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">LRUCache</span><span class="p">;</span>

<span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="nf">lru_create</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">capacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">LRUCache</span><span class="p">));</span>
<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cache</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Find page</span>
<span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="nf">lru_find</span><span class="p">(</span><span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">current</span><span class="p">;</span>
<span class="w">        </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Move node to front</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">move_to_front</span><span class="p">(</span><span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w">  </span><span class="c1">// Already at front</span>

<span class="w">    </span><span class="c1">// Remove from list</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">)</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">)</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Insert at front</span>
<span class="w">    </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">)</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">)</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Insert new node at front</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">insert_front</span><span class="p">(</span><span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Node</span><span class="p">));</span>
<span class="w">    </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">    </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">)</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">)</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>

<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Remove tail node</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">remove_tail</span><span class="p">(</span><span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="n">cache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>

<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">victim</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">;</span>

<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">victim</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">)</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">tail</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">victim</span><span class="p">);</span>
<span class="w">    </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">count</span><span class="o">--</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">lru_access</span><span class="p">(</span><span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lru_find</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Hit: move to front</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Page %d: hit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>
<span class="w">        </span><span class="n">move_to_front</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Fault</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Page %d: fault&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">capacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Replace least recently used page</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">victim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">remove_tail</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (replaced page %d)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">victim</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">insert_front</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">lru_print</span><span class="p">(</span><span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="n">cache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Memory (MRUâ†’LRU): [&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;]</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LRUCache</span><span class="o">*</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lru_create</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">refs</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page_faults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">page_faults</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lru_access</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">refs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">        </span><span class="n">lru_print</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Total page faults: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page_faults</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="44-example">4.4 Example<a class="header-link" href="#44-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               LRU Example (3 frames)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Reference string: 7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2, 1, 2         â”‚
â”‚                                                                          â”‚
â”‚   Access  Stack (MRUâ†’LRU)    Fault?                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
â”‚    7      [7]              fault                                        â”‚
â”‚    0      [0, 7]           fault                                        â”‚
â”‚    1      [1, 0, 7]        fault                                        â”‚
â”‚    2      [2, 1, 0]        fault (replaced 7 - LRU)                     â”‚
â”‚    0      [0, 2, 1]        hit (moved 0 to MRU)                         â”‚
â”‚    3      [3, 0, 2]        fault (replaced 1 - LRU)                     â”‚
â”‚    0      [0, 3, 2]        hit (moved 0 to MRU)                         â”‚
â”‚    4      [4, 0, 3]        fault (replaced 2 - LRU)                     â”‚
â”‚    2      [2, 4, 0]        fault (replaced 3 - LRU)                     â”‚
â”‚    3      [3, 2, 4]        fault (replaced 0 - LRU)                     â”‚
â”‚    0      [0, 3, 2]        fault (replaced 4 - LRU)                     â”‚
â”‚    3      [3, 0, 2]        hit (moved 3 to MRU)                         â”‚
â”‚    2      [2, 3, 0]        hit (moved 2 to MRU)                         â”‚
â”‚    1      [1, 2, 3]        fault (replaced 0 - LRU)                     â”‚
â”‚    2      [2, 1, 3]        hit (moved 2 to MRU)                         â”‚
â”‚                                                                          â”‚
â”‚   Total page faults: 10 (FIFO: 12, OPT: 9)                              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="5-lru-approximation-algorithms">5. LRU Approximation Algorithms<a class="header-link" href="#5-lru-approximation-algorithms" title="Permanent link">&para;</a></h2>
<h3 id="51-second-chance-clock-algorithm">5.1 Second-Chance (Clock) Algorithm<a class="header-link" href="#51-second-chance-clock-algorithm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">Second</span><span class="o">-</span><span class="nv">Chance</span><span class="w"> </span><span class="nv">Algorithm</span><span class="w">                               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Uses</span><span class="w"> </span><span class="nv">reference</span><span class="w"> </span><span class="nv">bit</span>:<span class="w">                                                    </span>â”‚
â”‚<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nv">On</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">access</span>:<span class="w"> </span><span class="nv">reference</span><span class="w"> </span><span class="nv">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">                                   </span>â”‚
â”‚<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nv">On</span><span class="w"> </span><span class="nv">replacement</span>:<span class="w"> </span><span class="nv">select</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">reference</span><span class="w"> </span><span class="nv">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">                  </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Implemented</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">circular</span><span class="w"> </span><span class="nv">queue</span><span class="w"> </span><span class="ss">(</span><span class="nv">clock</span><span class="w"> </span><span class="nv">algorithm</span><span class="ss">)</span>:<span class="w">                       </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">              </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                                      </span>â”‚
â”‚<span class="w">              </span>â”‚<span class="w">                   </span>â”‚<span class="w">                                      </span>â”‚
â”‚<span class="w">              </span>â–¼<span class="w">                   </span>â”‚<span class="w">                                      </span>â”‚
â”‚<span class="w">       </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">  </span>â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                        </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="nv">Page</span><span class="w"> </span><span class="nv">A</span><span class="w">   </span>â”‚â”€â”€â”€â”‚<span class="nv">Page</span><span class="w"> </span><span class="nv">B</span><span class="w">   </span>â”‚â”€â”€â”¼â”€â”€â”‚<span class="nv">Page</span><span class="w"> </span><span class="nv">C</span><span class="w">   </span>â”‚â”€â”€â”€â”€â”€â”<span class="w">                  </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="nv">Ref</span>:<span class="w"> </span><span class="mi">1</span><span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="nv">Ref</span>:<span class="w"> </span><span class="mi">0</span><span class="w">   </span>â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”‚<span class="nv">Ref</span>:<span class="w"> </span><span class="mi">1</span><span class="w">   </span>â”‚<span class="w">     </span>â”‚<span class="w">                  </span>â”‚
â”‚<span class="w">       </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">  </span>â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â”‚<span class="w">                  </span>â”‚
â”‚<span class="w">           </span>â–²<span class="w">                      </span>â”‚<span class="w">                   </span>â”‚<span class="w">                  </span>â”‚
â”‚<span class="w">           </span>â”‚<span class="w">          </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                   </span>â”‚<span class="w">                  </span>â”‚
â”‚<span class="w">           </span>â”‚<span class="w">          </span>â”‚<span class="w">                               </span>â”‚<span class="w">                  </span>â”‚
â”‚<span class="w">           </span>â”‚<span class="w">      </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">              </span>â”‚
â”‚<span class="w">           </span>â””â”€â”€â”€â”€â”€â”€â”‚<span class="nv">Page</span><span class="w"> </span><span class="nv">F</span><span class="w">   </span>â”‚â”€â”€â”€â”‚<span class="nv">Page</span><span class="w"> </span><span class="nv">E</span><span class="w">   </span>â”‚â”€â”€â”€â”‚<span class="nv">Page</span><span class="w"> </span><span class="nv">D</span><span class="w">   </span>â”‚<span class="w">              </span>â”‚
â”‚<span class="w">                  </span>â”‚<span class="nv">Ref</span>:<span class="w"> </span><span class="mi">0</span><span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="nv">Ref</span>:<span class="w"> </span><span class="mi">1</span><span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="nv">Ref</span>:<span class="w"> </span><span class="mi">0</span><span class="w">   </span>â”‚<span class="w">              </span>â”‚
â”‚<span class="w">                  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">              </span>â”‚
â”‚<span class="w">                       </span>â†‘<span class="w">                                                 </span>â”‚
â”‚<span class="w">                    </span><span class="nv">Pointer</span><span class="w">                                              </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Replacement</span><span class="w"> </span><span class="nv">process</span>:<span class="w">                                                   </span>â”‚
â”‚<span class="w">   </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Examine</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">pointed</span><span class="w"> </span><span class="nv">to</span><span class="w">                                            </span>â”‚
â”‚<span class="w">   </span><span class="mi">2</span>.<span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">Ref</span><span class="o">=</span><span class="mi">1</span>:<span class="w"> </span><span class="nv">set</span><span class="w"> </span><span class="nv">Ref</span><span class="o">=</span><span class="mi">0</span>,<span class="w"> </span><span class="nv">move</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="ss">(</span><span class="nv">second</span><span class="w"> </span><span class="nv">chance</span><span class="ss">)</span><span class="w">                 </span>â”‚
â”‚<span class="w">   </span><span class="mi">3</span>.<span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">Ref</span><span class="o">=</span><span class="mi">0</span>:<span class="w"> </span><span class="nv">replace</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">page</span><span class="w">                                        </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="52-enhanced-second-chance">5.2 Enhanced Second-Chance<a class="header-link" href="#52-enhanced-second-chance" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span><span class="nv">Enhanced</span><span class="w"> </span><span class="nv">Second</span><span class="o">-</span><span class="nv">Chance</span><span class="w"> </span><span class="nv">Algorithm</span><span class="w">                            </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Uses</span><span class="w"> </span><span class="nv">reference</span><span class="w"> </span><span class="nv">bit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">modify</span><span class="w"> </span><span class="nv">bit</span><span class="w">                                       </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Priority</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="ss">(</span><span class="nv">Ref</span>,<span class="w"> </span><span class="nv">Mod</span><span class="ss">)</span><span class="w"> </span><span class="nv">combination</span>:<span class="w">                                   </span>â”‚
â”‚<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">  </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">    </span><span class="ss">(</span><span class="nv">Ref</span>,<span class="w"> </span><span class="nv">Mod</span><span class="ss">)</span><span class="w">  </span>â”‚<span class="w">              </span><span class="nv">Description</span><span class="w">           </span>â”‚<span class="w">   </span><span class="nv">Priority</span><span class="w"> </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">   </span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<span class="w">  </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">     </span><span class="ss">(</span><span class="mi">0</span>,<span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Not</span><span class="w"> </span><span class="nv">recently</span><span class="w"> </span><span class="nv">used</span>,<span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">modified</span><span class="w">    </span>â”‚<span class="w">   </span><span class="mi">1</span><span class="w"> </span><span class="ss">(</span><span class="nv">Best</span><span class="ss">)</span><span class="w"> </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">     </span><span class="ss">(</span><span class="mi">0</span>,<span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Not</span><span class="w"> </span><span class="nv">recently</span><span class="w"> </span><span class="nv">used</span>,<span class="w"> </span><span class="nv">modified</span><span class="w">        </span>â”‚<span class="w">   </span><span class="mi">2</span><span class="w">        </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">     </span><span class="ss">(</span><span class="mi">1</span>,<span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Recently</span><span class="w"> </span><span class="nv">used</span>,<span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">modified</span><span class="w">        </span>â”‚<span class="w">   </span><span class="mi">3</span><span class="w">        </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">     </span><span class="ss">(</span><span class="mi">1</span>,<span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Recently</span><span class="w"> </span><span class="nv">used</span>,<span class="w"> </span><span class="nv">modified</span><span class="w">            </span>â”‚<span class="w">   </span><span class="mi">4</span><span class="w"> </span><span class="ss">(</span><span class="nv">Worst</span><span class="ss">)</span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">  </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Replacement</span><span class="w"> </span><span class="nv">algorithm</span>:<span class="w">                                                 </span>â”‚
â”‚<span class="w">   </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Search</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="mi">0</span>,<span class="mi">0</span><span class="ss">)</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">replace</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">found</span><span class="w">                           </span>â”‚
â”‚<span class="w">   </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Search</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="mi">0</span>,<span class="mi">1</span><span class="ss">)</span><span class="w"> </span><span class="nv">page</span>,<span class="w"> </span><span class="nv">set</span><span class="w"> </span><span class="nv">Ref</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">passing</span><span class="w">                     </span>â”‚
â”‚<span class="w">   </span><span class="mi">3</span>.<span class="w"> </span><span class="nv">Start</span><span class="w"> </span><span class="nv">over</span>,<span class="w"> </span><span class="nv">search</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="mi">0</span>,<span class="mi">0</span><span class="ss">)</span><span class="w">                                       </span>â”‚
â”‚<span class="w">   </span><span class="mi">4</span>.<span class="w"> </span><span class="nv">Search</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="mi">0</span>,<span class="mi">1</span><span class="ss">)</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">replace</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">found</span><span class="w">                                </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Advantage</span>:<span class="w"> </span><span class="nv">Minimize</span><span class="w"> </span><span class="nv">dirty</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">replacement</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Reduce</span><span class="w"> </span><span class="nv">I</span><span class="o">/</span><span class="nv">O</span><span class="w">               </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="53-clock-algorithm-implementation">5.3 Clock Algorithm Implementation<a class="header-link" href="#53-clock-algorithm-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span>

<span class="cp">#define MAX_FRAMES 10</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">reference_bit</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">valid</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">Frame</span><span class="p">;</span>

<span class="n">Frame</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">MAX_FRAMES</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">clock_hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">clock_init</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cap</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAX_FRAMES</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">find_page</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">page</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">find_empty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">clock_access</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_page</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">idx</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Hit: set reference bit</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Page %d: hit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>
<span class="w">        </span><span class="n">frames</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">reference_bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Fault</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Page %d: fault&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_empty</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">empty</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Use free frame</span>
<span class="w">        </span><span class="n">frames</span><span class="p">[</span><span class="n">empty</span><span class="p">].</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">        </span><span class="n">frames</span><span class="p">[</span><span class="n">empty</span><span class="p">].</span><span class="n">reference_bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">frames</span><span class="p">[</span><span class="n">empty</span><span class="p">].</span><span class="n">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (using free frame %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Select victim with clock algorithm</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">frames</span><span class="p">[</span><span class="n">clock_hand</span><span class="p">].</span><span class="n">reference_bit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Replace if reference bit is 0</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot; (replaced page %d in frame %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="n">frames</span><span class="p">[</span><span class="n">clock_hand</span><span class="p">].</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">clock_hand</span><span class="p">);</span>

<span class="w">            </span><span class="n">frames</span><span class="p">[</span><span class="n">clock_hand</span><span class="p">].</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span>
<span class="w">            </span><span class="n">frames</span><span class="p">[</span><span class="n">clock_hand</span><span class="p">].</span><span class="n">reference_bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="w">            </span><span class="n">clock_hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">clock_hand</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// If reference bit is 1, set to 0 and move to next</span>
<span class="w">        </span><span class="n">frames</span><span class="p">[</span><span class="n">clock_hand</span><span class="p">].</span><span class="n">reference_bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">clock_hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">clock_hand</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">clock_print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Memory: [&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d(R:%d)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">page</span><span class="p">,</span>
<span class="w">                   </span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reference_bit</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;] Pointer: %d</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">clock_hand</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">clock_init</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">refs</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">};</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">page_faults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">page_faults</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">clock_access</span><span class="p">(</span><span class="n">refs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">        </span><span class="n">clock_print</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Total page faults: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">page_faults</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="6-beladys-anomaly">6. Belady's Anomaly<a class="header-link" href="#6-beladys-anomaly" title="Permanent link">&para;</a></h2>
<h3 id="61-phenomenon">6.1 Phenomenon<a class="header-link" href="#61-phenomenon" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Belady&#39;s Anomaly                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Intuition: More frames should mean fewer page faults.                 â”‚
â”‚   Belady&#39;s Anomaly: With FIFO, increasing frames can increase faults!   â”‚
â”‚                                                                          â”‚
â”‚   Example: Reference string 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5          â”‚
â”‚                                                                          â”‚
â”‚   3 frames:                                                              â”‚
â”‚   1    [1, -, -]        fault                                           â”‚
â”‚   2    [1, 2, -]        fault                                           â”‚
â”‚   3    [1, 2, 3]        fault                                           â”‚
â”‚   4    [4, 2, 3]        fault                                           â”‚
â”‚   1    [4, 1, 3]        fault                                           â”‚
â”‚   2    [4, 1, 2]        fault                                           â”‚
â”‚   5    [5, 1, 2]        fault                                           â”‚
â”‚   1    [5, 1, 2]        hit                                             â”‚
â”‚   2    [5, 1, 2]        hit                                             â”‚
â”‚   3    [3, 1, 2]        fault                                           â”‚
â”‚   4    [3, 4, 2]        fault                                           â”‚
â”‚   5    [3, 4, 5]        fault  â†’ Total 9 faults                         â”‚
â”‚                                                                          â”‚
â”‚   4 frames:                                                              â”‚
â”‚   1    [1, -, -, -]     fault                                           â”‚
â”‚   2    [1, 2, -, -]     fault                                           â”‚
â”‚   3    [1, 2, 3, -]     fault                                           â”‚
â”‚   4    [1, 2, 3, 4]     fault                                           â”‚
â”‚   1    [1, 2, 3, 4]     hit                                             â”‚
â”‚   2    [1, 2, 3, 4]     hit                                             â”‚
â”‚   5    [5, 2, 3, 4]     fault                                           â”‚
â”‚   1    [5, 1, 3, 4]     fault                                           â”‚
â”‚   2    [5, 1, 2, 4]     fault                                           â”‚
â”‚   3    [5, 1, 2, 3]     fault                                           â”‚
â”‚   4    [4, 1, 2, 3]     fault                                           â”‚
â”‚   5    [4, 5, 2, 3]     fault  â†’ Total 10 faults                        â”‚
â”‚                                                                          â”‚
â”‚   3 frames: 9 faults &lt; 4 frames: 10 faults  â† Anomaly!                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62-stack-algorithms">6.2 Stack Algorithms<a class="header-link" href="#62-stack-algorithms" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Stack</span><span class="w"> </span><span class="nv">Algorithm</span><span class="w">                                      </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Definition</span>:<span class="w"> </span><span class="nv">Page</span><span class="w"> </span><span class="nv">set</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">frames</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">always</span><span class="w"> </span><span class="nv">subset</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">n</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="nv">frames</span><span class="w">      </span>â”‚
â”‚<span class="w">        </span><span class="nv">M</span><span class="ss">(</span><span class="nv">n</span><span class="ss">)</span><span class="w"> </span>âŠ†<span class="w"> </span><span class="nv">M</span><span class="ss">(</span><span class="nv">n</span><span class="o">+</span><span class="mi">1</span><span class="ss">)</span><span class="w">                                                    </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Stack</span><span class="w"> </span><span class="nv">Algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">Belady</span><span class="err">&#39;s Anomaly                                 â”‚</span>
<span class="err">â”‚                                                                          â”‚</span>
<span class="err">â”‚   Example: LRU                                                           â”‚</span>
<span class="err">â”‚   3 frames: Memory = {A, B, C}                                          â”‚</span>
<span class="err">â”‚   4 frames: Memory = {A, B, C, D}                                       â”‚</span>
<span class="err">â”‚   â†’ {A, B, C} âŠ‚ {A, B, C, D} always holds                               â”‚</span>
<span class="err">â”‚                                                                          â”‚</span>
<span class="err">â”‚   FIFO is not a stack algorithm:                                        â”‚</span>
<span class="err">â”‚   At time t, 3 frames: {1, 2, 3}                                        â”‚</span>
<span class="err">â”‚   At time t, 4 frames: {2, 3, 4}                                        â”‚</span>
<span class="err">â”‚   â†’ {1, 2, 3} âŠ„ {2, 3, 4} possible                                      â”‚</span>
<span class="err">â”‚                                                                          â”‚</span>
<span class="err">â”‚   Stack algorithm examples: LRU, Optimal, LFU                            â”‚</span>
<span class="err">â”‚   Non-stack algorithm: FIFO                                              â”‚</span>
<span class="err">â”‚                                                                          â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="7-thrashing-and-working-set">7. Thrashing and Working Set<a class="header-link" href="#7-thrashing-and-working-set" title="Permanent link">&para;</a></h2>
<h3 id="71-thrashing">7.1 Thrashing<a class="header-link" href="#71-thrashing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Thrashing                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Definition: Process spends more time on page replacement than executionâ”‚
â”‚                                                                          â”‚
â”‚   CPU Utilization                                                        â”‚
â”‚      â†‘                                                                   â”‚
â”‚      â”‚        â•±â”€â”€â•²                                                      â”‚
â”‚      â”‚       â•±    â•²                                                     â”‚
â”‚      â”‚      â•±      â•²                                                    â”‚
â”‚      â”‚     â•±        â•²                                                   â”‚
â”‚      â”‚    â•±          â•²                                                  â”‚
â”‚      â”‚   â•±            â•²    Thrashing                                    â”‚
â”‚      â”‚  â•±              â•²   threshold                                    â”‚
â”‚      â”‚ â•±                â•²                                               â”‚
â”‚      â”‚â•±                  â•²__________                                    â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Degree of multiprogramming        â”‚
â”‚                                                                          â”‚
â”‚   Thrashing occurrence:                                                  â”‚
â”‚   1. Low CPU utilization â†’ OS runs more processes                       â”‚
â”‚   2. More processes â†’ fewer frames per process                          â”‚
â”‚   3. More page faults â†’ more I/O waiting                                â”‚
â”‚   4. CPU utilization decreases â†’ OS runs more processes... (vicious cycle)â”‚
â”‚                                                                          â”‚
â”‚   Result: System nearly stops working                                    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="72-working-set-model">7.2 Working Set Model<a class="header-link" href="#72-working-set-model" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                      </span><span class="nv">Working</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="nv">Model</span><span class="w">                                   </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Working</span><span class="w"> </span><span class="nv">Set</span>:<span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">pages</span><span class="w"> </span><span class="nv">referenced</span><span class="w"> </span><span class="nv">during</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">window</span><span class="w"> </span><span class="ss">(</span>Î”<span class="ss">)</span><span class="w">           </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Time</span><span class="w"> </span><span class="nv">window</span><span class="w"> </span>Î”<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w">                                                    </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Reference</span><span class="w"> </span><span class="nv">sequence</span>:<span class="w"> </span>...<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="w">     </span>â”‚
â”‚<span class="w">                               </span>â†‘<span class="w"> </span><span class="nv">Current</span><span class="w"> </span><span class="nv">time</span><span class="w">                             </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Working</span><span class="w"> </span><span class="nv">Set</span><span class="ss">(</span>Î”<span class="o">=</span><span class="mi">10</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>{<span class="mi">1</span>,<span class="w"> </span><span class="mi">2</span>,<span class="w"> </span><span class="mi">3</span>,<span class="w"> </span><span class="mi">4</span>,<span class="w"> </span><span class="mi">5</span>}<span class="w">                                   </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Working</span><span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="nv">change</span>:<span class="w">                                               </span>â”‚
â”‚<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">  </span><span class="nv">WSS</span><span class="w">                                                            </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">   </span>â†‘<span class="w">      </span>â•­â”€â”€â•®<span class="w">     </span>â•­â”€â”€â•®<span class="w">                                         </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="w">     </span>â•±<span class="w">    </span>â•²<span class="w">   </span>â•±<span class="w">    </span>â•²<span class="w">     </span><span class="nv">Locality</span><span class="w"> </span><span class="nv">transition</span><span class="w">                </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”‚â”€â”€â”€â”€â•±<span class="w">      </span>â•²â”€â•±<span class="w">      </span>â•²â”€â”€â”€â”€<span class="w">                                   </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">   </span>â”‚<span class="w">   </span><span class="nv">Stable</span><span class="w">   </span><span class="nv">Stable</span><span class="w">   </span><span class="nv">Stable</span><span class="w">                                 </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶<span class="w"> </span><span class="nv">Time</span><span class="w">                     </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                          </span>â”‚
â”‚<span class="w">   </span><span class="nv">Principle</span>:<span class="w">                                                             </span>â”‚
â”‚<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nv">WSS</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Process</span><span class="w"> </span><span class="nv">i</span><span class="err">&#39;s Working Set size                               â”‚</span>
<span class="err">â”‚   - D = Î£ WSS(i) = Total frame demand                                   â”‚</span>
<span class="err">â”‚   - D &gt; Total frames â†’ Thrashing occurs                                 â”‚</span>
<span class="err">â”‚                                                                          â”‚</span>
<span class="err">â”‚   Solution: If D &gt; m, suspend one process                               â”‚</span>
<span class="err">â”‚                                                                          â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="73-page-fault-frequency-pff">7.3 Page Fault Frequency (PFF)<a class="header-link" href="#73-page-fault-frequency-pff" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Page Fault Frequency Method                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   Concept: Adjust frame allocation based on page fault frequency        â”‚
â”‚                                                                          â”‚
â”‚   Page fault rate                                                        â”‚
â”‚      â†‘                                                                   â”‚
â”‚      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Upper threshold                                      â”‚
â”‚      â”‚       â†‘                                                          â”‚
â”‚      â”‚       â”‚ Allocate more frames                                     â”‚
â”‚      â”‚       â”‚                                                          â”‚
â”‚      â”‚   â”€ â”€ â”€ â”€ â”€ â”€  Target range                                     â”‚
â”‚      â”‚       â”‚                                                          â”‚
â”‚      â”‚       â”‚ Reclaim frames                                           â”‚
â”‚      â”‚       â†“                                                          â”‚
â”‚      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Lower threshold                                      â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Allocated frames                       â”‚
â”‚                                                                          â”‚
â”‚   Operation:                                                             â”‚
â”‚   - Fault rate &gt; upper: allocate more frames                            â”‚
â”‚   - Fault rate &lt; lower: reclaim some frames                             â”‚
â”‚   - Insufficient frames: swap out some processes                        â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="74-preventing-thrashing-in-linux">7.4 Preventing Thrashing in Linux<a class="header-link" href="#74-preventing-thrashing-in-linux" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check swap usage</span>
$<span class="w"> </span>free<span class="w"> </span>-h
<span class="w">              </span>total<span class="w">        </span>used<span class="w">        </span>free<span class="w">      </span>shared<span class="w">  </span>buff/cache<span class="w">   </span>available
Mem:<span class="w">           </span>15Gi<span class="w">       </span>10Gi<span class="w">       </span>500Mi<span class="w">       </span>100Mi<span class="w">       </span><span class="m">5</span>.0Gi<span class="w">       </span><span class="m">4</span>.5Gi
Swap:<span class="w">          </span><span class="m">8</span>.0Gi<span class="w">       </span><span class="m">2</span>.0Gi<span class="w">       </span><span class="m">6</span>.0Gi<span class="w">  </span>â†<span class="w"> </span>Swap<span class="w"> </span><span class="k">in</span><span class="w"> </span>use

<span class="c1"># Check swappiness (0-100, higher = more aggressive swap)</span>
$<span class="w"> </span>cat<span class="w"> </span>/proc/sys/vm/swappiness
<span class="m">60</span>

<span class="c1"># Adjust swappiness (lower to prevent thrashing)</span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>vm.swappiness<span class="o">=</span><span class="m">10</span>

<span class="c1"># Check OOM Killer logs</span>
$<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;out of memory&quot;</span>

<span class="c1"># Memory usage by process</span>
$<span class="w"> </span>ps<span class="w"> </span>aux<span class="w"> </span>--sort<span class="o">=</span>-%mem<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10

<span class="c1"># Limit memory with cgroups (containers)</span>
$<span class="w"> </span>cat<span class="w"> </span>/sys/fs/cgroup/memory/memory.limit_in_bytes
</code></pre></div>

<hr />
<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-algorithm-comparison">Problem 1: Algorithm Comparison<a class="header-link" href="#problem-1-algorithm-comparison" title="Permanent link">&para;</a></h3>
<p>Calculate page faults for reference string 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5 with 3 frames using FIFO, LRU, and Optimal.</p>
<details>
<summary>Show Answer</summary>


<div class="highlight"><pre><span></span><code><span class="n">FIFO</span><span class="o">:</span>
<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,-,-]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,-]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">hit</span>
<span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="n">Total</span><span class="o">:</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="n">faults</span>

<span class="n">LRU</span><span class="o">:</span>
<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">        </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">      </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">hit</span><span class="w">      </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">5</span><span class="o">]</span><span class="w"> </span><span class="n">hit</span>
<span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="n">Total</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">faults</span>

<span class="n">Optimal</span><span class="o">:</span>
<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,-,-]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,-]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">hit</span><span class="w">      </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">hit</span>
<span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span><span class="w">    </span><span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="n">fault</span>
<span class="n">Total</span><span class="o">:</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">faults</span>
</code></pre></div>



</details>

<h3 id="problem-2-second-chance">Problem 2: Second-Chance<a class="header-link" href="#problem-2-second-chance" title="Permanent link">&para;</a></h3>
<p>With 4 frames in the following state, which page gets replaced when inserting page E?</p>
<div class="highlight"><pre><span></span><code>Pointer â†’ [A, R=1] â†’ [B, R=0] â†’ [C, R=1] â†’ [D, R=0]
</code></pre></div>

<details>
<summary>Show Answer</summary>


<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Pointer</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">1</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="kr">next</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Pointer</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">0</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="kr">get</span><span class="n">s</span><span class="w"> </span><span class="n">replaced</span><span class="err">!</span>

<span class="n">Result</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">0</span><span class="err">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">[</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">1</span><span class="err">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">[</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">1</span><span class="err">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">[</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">0</span><span class="err">]</span>
<span class="w">                  </span><span class="err">â†‘</span><span class="w"> </span><span class="kr">New</span><span class="w"> </span><span class="n">page</span>

<span class="n">Pointer</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="n">C</span>
</code></pre></div>



</details>

<h3 id="problem-3-working-set">Problem 3: Working Set<a class="header-link" href="#problem-3-working-set" title="Permanent link">&para;</a></h3>
<p>Calculate Working Set at time t=10 with Î” = 5.</p>
<div class="highlight"><pre><span></span><code><span class="n">Time</span><span class="o">:</span><span class="w">   </span><span class="mi">1</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="mi">4</span><span class="w">  </span><span class="mi">5</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">8</span><span class="w">  </span><span class="mi">9</span><span class="w">  </span><span class="mi">10</span>
<span class="n">Page</span><span class="o">:</span><span class="w">   </span><span class="mi">1</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="mi">1</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">1</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="mi">4</span><span class="w">  </span><span class="mi">5</span><span class="w">   </span><span class="mi">2</span>
</code></pre></div>

<details>
<summary>Show Answer</summary>


<div class="highlight"><pre><span></span><code>References within Î”=5 before t=10:
t=6: Page 1
t=7: Page 3
t=8: Page 4
t=9: Page 5
t=10: Page 2

Working Set(t=10, Î”=5) = {1, 2, 3, 4, 5}
WSS = 5

This process needs at least 5 frames
</code></pre></div>



</details>

<h3 id="problem-4-beladys-anomaly-proof">Problem 4: Belady's Anomaly Proof<a class="header-link" href="#problem-4-beladys-anomaly-proof" title="Permanent link">&para;</a></h3>
<p>Calculate page faults for FIFO with 3 frames and 4 frames to verify Belady's Anomaly.</p>
<p>Reference string: 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5</p>
<details>
<summary>Show Answer</summary>


<div class="highlight"><pre><span></span><code><span class="mf">3</span><span class="w"> </span><span class="n">frames</span><span class="w"> </span><span class="p">(</span><span class="n">FIFO</span><span class="p">):</span>
<span class="mf">1</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="o">-</span><span class="p">,</span><span class="o">-</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">1</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">4</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">3</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">3</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">3</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="err">]</span><span class="w"> </span><span class="n">F</span>
<span class="mf">2</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="o">-</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">2</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">4</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">4</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">,</span><span class="mf">2</span><span class="err">]</span><span class="w"> </span><span class="n">F</span>
<span class="mf">3</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">5</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">5</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">5</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">,</span><span class="mf">5</span><span class="err">]</span><span class="w"> </span><span class="n">F</span>
<span class="mf">4</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">4</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">1</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">5</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="err">]</span><span class="w"> </span><span class="n">H</span>
<span class="w">                </span><span class="mf">2</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">5</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="err">]</span><span class="w"> </span><span class="n">H</span>
<span class="kr">To</span><span class="n">tal</span><span class="p">:</span><span class="w"> </span><span class="mf">9</span><span class="w"> </span><span class="n">faults</span>

<span class="mf">4</span><span class="w"> </span><span class="n">frames</span><span class="w"> </span><span class="p">(</span><span class="n">FIFO</span><span class="p">):</span>
<span class="mf">1</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="o">-</span><span class="p">,</span><span class="o">-</span><span class="p">,</span><span class="o">-</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">5</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">5</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">4</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">4</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="err">]</span><span class="w"> </span><span class="n">F</span>
<span class="mf">2</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="o">-</span><span class="p">,</span><span class="o">-</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">1</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">5</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">5</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">4</span><span class="p">,</span><span class="mf">5</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="err">]</span><span class="w"> </span><span class="n">F</span>
<span class="mf">3</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="o">-</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">2</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">5</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">4</span><span class="err">]</span><span class="w"> </span><span class="n">F</span>
<span class="mf">4</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="err">]</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="mf">3</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">5</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="err">]</span><span class="w"> </span><span class="n">F</span>
<span class="mf">1</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="err">]</span><span class="w"> </span><span class="n">H</span>
<span class="mf">2</span><span class="p">:</span><span class="w"> </span><span class="err">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="err">]</span><span class="w"> </span><span class="n">H</span>
<span class="kr">To</span><span class="n">tal</span><span class="p">:</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="n">faults</span>

<span class="n">Belady</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">Anomaly</span><span class="w"> </span><span class="n">confirmed</span><span class="p">:</span>
<span class="mf">3</span><span class="w"> </span><span class="n">frames</span><span class="p">:</span><span class="w"> </span><span class="mf">9</span><span class="w"> </span><span class="n">faults</span>
<span class="mf">4</span><span class="w"> </span><span class="n">frames</span><span class="p">:</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="n">faults</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">More</span><span class="w"> </span><span class="n">frames</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">faults</span><span class="err">!</span>
</code></pre></div>



</details>

<h3 id="problem-5-thrashing-solution">Problem 5: Thrashing Solution<a class="header-link" href="#problem-5-thrashing-solution" title="Permanent link">&para;</a></h3>
<p>The following symptoms are observed in the system. Analyze the cause and propose solutions.</p>
<ul>
<li>CPU utilization: 5%</li>
<li>Disk I/O: 95%</li>
<li>Memory: Nearly full</li>
<li>Many processes waiting</li>
</ul>
<details>
<summary>Show Answer</summary>


<div class="highlight"><pre><span></span><code>Cause Analysis:
<span class="k">-</span> Classic thrashing state
<span class="k">-</span> Too many processes competing for insufficient memory
<span class="k">-</span> Most time spent on page fault handling (disk I/O)

Solutions:

1. Immediate fix:
   <span class="k">-</span> Suspend some processes
   <span class="k">-</span> Swap out to free frames for other processes

2. System configuration:
   <span class="k">-</span> Lower swappiness (vm.swappiness=10)
   <span class="k">-</span> Limit memory overcommit (vm.overcommit_memory=2)

3. Long-term solutions:
   <span class="k">-</span> Add physical memory
   <span class="k">-</span> Implement Working Set-based scheduling
   <span class="k">-</span> Monitor PFF (Page Fault Frequency)
   <span class="k">-</span> Limit per-process memory with cgroups

4. Application level:
   <span class="k">-</span> Check for memory leaks
   <span class="k">-</span> Adjust cache sizes
   <span class="k">-</span> Terminate unnecessary processes

Monitoring commands:
$ vmstat 1   # Check si/so (swap in/out)
$ sar -B 1   # Check pgpgin/pgpgout
</code></pre></div>



</details>

<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Continue to <a href="./16_File_System_Basics.md">16_File_System_Basics.md</a> to learn file system basics!</p>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>Silberschatz, "Operating System Concepts" Chapter 10</li>
<li>Tanenbaum, "Modern Operating Systems" Chapter 3</li>
<li>Linux kernel source: <code>mm/vmscan.c</code>, <code>mm/workingset.c</code></li>
<li>Belady, L.A. "A study of replacement algorithms for virtual-storage computer"</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/OS_Theory/14_Virtual_Memory.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Virtual Memory â­â­â­</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/OS_Theory/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/OS_Theory/16_File_System_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">File System Basics â­â­â­</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}