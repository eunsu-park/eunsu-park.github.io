{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7. Vlasov Equation - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Plasma_Physics/">Plasma Physics</a>
    <span class="separator">/</span>
    <span class="current">7. Vlasov Equation</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>7. Vlasov Equation</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Plasma_Physics/06_Magnetic_Mirrors_Adiabatic_Invariants.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">6. Magnetic Mirrors and Adiabatic Invariants</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Plasma_Physics/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Plasma_Physics/08_Landau_Damping.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">8. Landau Damping</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-phase-space-and-distribution-function">1. Phase Space and Distribution Function</a><ul>
<li><a href="#11-phase-space">1.1 Phase Space</a></li>
<li><a href="#12-distribution-function">1.2 Distribution Function</a></li>
<li><a href="#13-normalization">1.3 Normalization</a></li>
<li><a href="#14-moments-macroscopic-quantities">1.4 Moments: Macroscopic Quantities</a></li>
<li><a href="#15-example-1d-velocity-distribution">1.5 Example: 1D Velocity Distribution</a></li>
</ul>
</li>
<li><a href="#2-vlasov-equation">2. Vlasov Equation</a><ul>
<li><a href="#21-derivation-from-liouvilles-theorem">2.1 Derivation from Liouville's Theorem</a></li>
<li><a href="#22-physical-interpretation">2.2 Physical Interpretation</a></li>
<li><a href="#23-self-consistency-vlasov-maxwell-system">2.3 Self-Consistency: Vlasov-Maxwell System</a></li>
<li><a href="#24-multi-species-plasma">2.4 Multi-Species Plasma</a></li>
</ul>
</li>
<li><a href="#3-conservation-laws">3. Conservation Laws</a><ul>
<li><a href="#31-particle-conservation">3.1 Particle Conservation</a></li>
<li><a href="#32-momentum-conservation">3.2 Momentum Conservation</a></li>
<li><a href="#33-energy-conservation">3.3 Energy Conservation</a></li>
<li><a href="#34-entropy-and-casimir-invariants">3.4 Entropy and Casimir Invariants</a></li>
</ul>
</li>
<li><a href="#4-equilibrium-distribution-functions">4. Equilibrium Distribution Functions</a><ul>
<li><a href="#41-maxwellian-distribution">4.1 Maxwellian Distribution</a></li>
<li><a href="#42-jeans-theorem">4.2 Jeans Theorem</a></li>
<li><a href="#43-bi-maxwellian-distribution">4.3 Bi-Maxwellian Distribution</a></li>
<li><a href="#44-kappa-distribution">4.4 Kappa Distribution</a></li>
<li><a href="#45-drifting-maxwellian-beam">4.5 Drifting Maxwellian (Beam)</a></li>
</ul>
</li>
<li><a href="#5-linearization-and-perturbation-theory">5. Linearization and Perturbation Theory</a><ul>
<li><a href="#51-equilibrium-perturbation">5.1 Equilibrium + Perturbation</a></li>
<li><a href="#52-linearized-vlasov-equation">5.2 Linearized Vlasov Equation</a></li>
<li><a href="#53-bgk-modes">5.3 BGK Modes</a></li>
</ul>
</li>
<li><a href="#6-python-implementations">6. Python Implementations</a><ul>
<li><a href="#61-plotting-distribution-functions">6.1 Plotting Distribution Functions</a></li>
<li><a href="#62-moments-calculation">6.2 Moments Calculation</a></li>
<li><a href="#63-simple-1d-vlasov-solver-operator-splitting">6.3 Simple 1D Vlasov Solver (Operator Splitting)</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
<li><a href="#practice-problems">Practice Problems</a><ul>
<li><a href="#problem-1-moments-of-a-drifting-maxwellian">Problem 1: Moments of a Drifting Maxwellian</a></li>
<li><a href="#problem-2-bi-maxwellian-anisotropy">Problem 2: Bi-Maxwellian Anisotropy</a></li>
<li><a href="#problem-3-kappa-distribution-vs-maxwellian">Problem 3: Kappa Distribution vs Maxwellian</a></li>
<li><a href="#problem-4-conservation-of-entropy">Problem 4: Conservation of Entropy</a></li>
<li><a href="#problem-5-linearized-vlasov-poisson-for-langmuir-waves">Problem 5: Linearized Vlasov-Poisson for Langmuir Waves</a></li>
</ul>
</li>
<li><a href="#navigation">Navigation</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="7-vlasov-equation">7. Vlasov Equation<a class="header-link" href="#7-vlasov-equation" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand phase space and the distribution function $f(\mathbf{x},\mathbf{v},t)$</li>
<li>Derive the Vlasov equation from Liouville's theorem for collisionless plasmas</li>
<li>Compute macroscopic quantities (density, bulk velocity, pressure) as moments of $f$</li>
<li>Explore equilibrium distribution functions (Maxwellian, bi-Maxwellian, kappa)</li>
<li>Analyze conservation laws (particles, momentum, energy, entropy) from the Vlasov equation</li>
<li>Implement numerical solutions of the Vlasov equation using Python</li>
</ul>
<h2 id="1-phase-space-and-distribution-function">1. Phase Space and Distribution Function<a class="header-link" href="#1-phase-space-and-distribution-function" title="Permanent link">&para;</a></h2>
<h3 id="11-phase-space">1.1 Phase Space<a class="header-link" href="#11-phase-space" title="Permanent link">&para;</a></h3>
<p>For a single particle, the <strong>phase space</strong> is the 6-dimensional space of positions and velocities:</p>
<p>$$
(\mathbf{x}, \mathbf{v}) = (x, y, z, v_x, v_y, v_z)
$$</p>
<p>For $N$ particles, the full phase space is $6N$-dimensional. But for large $N$ (plasmas have $\sim 10^{20}$ particles!), tracking individual particles is impractical.</p>
<p>Instead, we use a statistical description via the <strong>distribution function</strong>.</p>
<h3 id="12-distribution-function">1.2 Distribution Function<a class="header-link" href="#12-distribution-function" title="Permanent link">&para;</a></h3>
<p>The distribution function $f(\mathbf{x}, \mathbf{v}, t)$ gives the <strong>number density of particles</strong> in phase space:</p>
<p>$$
dN = f(\mathbf{x}, \mathbf{v}, t) \, d^3x \, d^3v
$$</p>
<p><strong>Interpretation</strong>: $f\,d^3x\,d^3v$ is the number of particles in the infinitesimal volume $d^3x$ around $\mathbf{x}$ with velocities in $d^3v$ around $\mathbf{v}$ at time $t$.</p>
<div class="highlight"><pre><span></span><code>    Phase space (6D)

    v_z ‚Üë
        |       ‚Ä¢ particle
        |     /
        |    /  represented by
        |   /   density f(x,v,t)
        |  /
        | /________________‚Üí v_x
       /
      / v_y
     ‚Üì

    Position space x,y,z (3D)
</code></pre></div>

<h3 id="13-normalization">1.3 Normalization<a class="header-link" href="#13-normalization" title="Permanent link">&para;</a></h3>
<p>The total number of particles in a volume $V$ is:</p>
<p>$$
N(t) = \int_V d^3x \int_{-\infty}^{\infty} f(\mathbf{x}, \mathbf{v}, t) \, d^3v
$$</p>
<p>For the entire plasma:</p>
<p>$$
N_{\text{total}} = \int_{\text{all space}} d^3x \int_{-\infty}^{\infty} f(\mathbf{x}, \mathbf{v}, t) \, d^3v
$$</p>
<h3 id="14-moments-macroscopic-quantities">1.4 Moments: Macroscopic Quantities<a class="header-link" href="#14-moments-macroscopic-quantities" title="Permanent link">&para;</a></h3>
<p>Macroscopic quantities are obtained by integrating $f$ over velocity space (<strong>moments</strong>):</p>
<p><strong>Number density</strong>:
$$
n(\mathbf{x}, t) = \int f(\mathbf{x}, \mathbf{v}, t) \, d^3v
$$</p>
<p><strong>Bulk (fluid) velocity</strong>:
$$
\mathbf{u}(\mathbf{x}, t) = \frac{1}{n(\mathbf{x}, t)} \int \mathbf{v} f(\mathbf{x}, \mathbf{v}, t) \, d^3v
$$</p>
<p><strong>Pressure tensor</strong>:
$$
\mathbf{P}(\mathbf{x}, t) = m \int (\mathbf{v} - \mathbf{u})(\mathbf{v} - \mathbf{u}) f(\mathbf{x}, \mathbf{v}, t) \, d^3v
$$</p>
<p>where the outer product $(\mathbf{v} - \mathbf{u})(\mathbf{v} - \mathbf{u})$ gives a tensor.</p>
<p><strong>Scalar pressure</strong> (for isotropic distribution):
$$
P = \frac{1}{3}\text{Tr}(\mathbf{P}) = \frac{m}{3}\int |\mathbf{v} - \mathbf{u}|^2 f \, d^3v
$$</p>
<p><strong>Temperature</strong> (kinetic definition):
$$
T = \frac{P}{nk_B} = \frac{m}{3nk_B}\int |\mathbf{v} - \mathbf{u}|^2 f \, d^3v
$$</p>
<p><strong>Energy density</strong>:
$$
\mathcal{E} = \frac{m}{2}\int v^2 f \, d^3v = \frac{1}{2}m n u^2 + \frac{3}{2}nk_BT
$$</p>
<p>(kinetic energy = bulk flow + thermal energy)</p>
<h3 id="15-example-1d-velocity-distribution">1.5 Example: 1D Velocity Distribution<a class="header-link" href="#15-example-1d-velocity-distribution" title="Permanent link">&para;</a></h3>
<p>Consider a 1D problem where $f = f(v_x)$ is Gaussian:</p>
<p>$$
f(v_x) = n_0 \sqrt{\frac{m}{2\pi k_B T}} \exp\left(-\frac{m(v_x - u)^2}{2k_BT}\right)
$$</p>
<p>Moments:
- $\int f \, dv_x = n_0$ (density)
- $\int v_x f \, dv_x = n_0 u$ (momentum density)
- $\int (v_x - u)^2 f \, dv_x = n_0 k_BT/m$ (variance)</p>
<h2 id="2-vlasov-equation">2. Vlasov Equation<a class="header-link" href="#2-vlasov-equation" title="Permanent link">&para;</a></h2>
<h3 id="21-derivation-from-liouvilles-theorem">2.1 Derivation from Liouville's Theorem<a class="header-link" href="#21-derivation-from-liouvilles-theorem" title="Permanent link">&para;</a></h3>
<p>In classical mechanics, <strong>Liouville's theorem</strong> states that phase space density is conserved along trajectories:</p>
<p>$$
\frac{df}{dt} = 0
$$</p>
<p>Expanding the total derivative:</p>
<p>$$
\frac{\partial f}{\partial t} + \frac{d\mathbf{x}}{dt}\cdot\frac{\partial f}{\partial \mathbf{x}} + \frac{d\mathbf{v}}{dt}\cdot\frac{\partial f}{\partial \mathbf{v}} = 0
$$</p>
<p>For a charged particle:
- $\frac{d\mathbf{x}}{dt} = \mathbf{v}$
- $\frac{d\mathbf{v}}{dt} = \frac{q}{m}(\mathbf{E} + \mathbf{v}\times\mathbf{B})$</p>
<p>Substituting:</p>
<p>$$
\boxed{\frac{\partial f}{\partial t} + \mathbf{v}\cdot\nabla f + \frac{q}{m}(\mathbf{E} + \mathbf{v}\times\mathbf{B})\cdot\frac{\partial f}{\partial \mathbf{v}} = 0}
$$</p>
<p>This is the <strong>Vlasov equation</strong> (also called <strong>collisionless Boltzmann equation</strong>).</p>
<h3 id="22-physical-interpretation">2.2 Physical Interpretation<a class="header-link" href="#22-physical-interpretation" title="Permanent link">&para;</a></h3>
<p>The Vlasov equation states that the distribution function is <strong>convected</strong> through phase space by the particle trajectories, with no sources or sinks (for collisionless plasma).</p>
<div class="highlight"><pre><span></span><code>    Phase space flow

       f(x,v,t)   ‚Üí   f(x+vŒ¥t, v+aŒ¥t, t+Œ¥t)

    Particles flow along trajectories in (x,v) space
    Distribution function is &quot;painted&quot; on phase space
    and advected by the flow
</code></pre></div>

<p>Each term:
- $\frac{\partial f}{\partial t}$: explicit time dependence
- $\mathbf{v}\cdot\nabla f$: advection in position space
- $\frac{q}{m}(\mathbf{E}+\mathbf{v}\times\mathbf{B})\cdot\frac{\partial f}{\partial \mathbf{v}}$: acceleration in velocity space</p>
<h3 id="23-self-consistency-vlasov-maxwell-system">2.3 Self-Consistency: Vlasov-Maxwell System<a class="header-link" href="#23-self-consistency-vlasov-maxwell-system" title="Permanent link">&para;</a></h3>
<p>The electric and magnetic fields $\mathbf{E}$ and $\mathbf{B}$ are produced by the plasma itself. They must satisfy <strong>Maxwell's equations</strong>:</p>
<p>$$
\nabla\cdot\mathbf{E} = \frac{\rho}{\epsilon_0} = \frac{1}{\epsilon_0}\sum_s q_s \int f_s \, d^3v
$$</p>
<p>$$
\nabla\times\mathbf{E} = -\frac{\partial\mathbf{B}}{\partial t}
$$</p>
<p>$$
\nabla\cdot\mathbf{B} = 0
$$</p>
<p>$$
\nabla\times\mathbf{B} = \mu_0\mathbf{J} + \mu_0\epsilon_0\frac{\partial\mathbf{E}}{\partial t} = \mu_0\sum_s q_s\int\mathbf{v}f_s\,d^3v + \mu_0\epsilon_0\frac{\partial\mathbf{E}}{\partial t}
$$</p>
<p>The coupled system (Vlasov + Maxwell) is the <strong>Vlasov-Maxwell system</strong>, a self-consistent kinetic description of plasmas.</p>
<p>For electrostatic problems (no $\mathbf{B}$ variation), we have the <strong>Vlasov-Poisson system</strong>:</p>
<p>$$
\frac{\partial f}{\partial t} + \mathbf{v}\cdot\nabla f + \frac{q}{m}\mathbf{E}\cdot\frac{\partial f}{\partial \mathbf{v}} = 0
$$</p>
<p>$$
\nabla\cdot\mathbf{E} = \frac{1}{\epsilon_0}\sum_s q_s \int f_s \, d^3v
$$</p>
<h3 id="24-multi-species-plasma">2.4 Multi-Species Plasma<a class="header-link" href="#24-multi-species-plasma" title="Permanent link">&para;</a></h3>
<p>For a plasma with multiple species (electrons, ions, impurities), we have a separate distribution function $f_s$ for each species $s$:</p>
<p>$$
\frac{\partial f_s}{\partial t} + \mathbf{v}\cdot\nabla f_s + \frac{q_s}{m_s}(\mathbf{E} + \mathbf{v}\times\mathbf{B})\cdot\frac{\partial f_s}{\partial \mathbf{v}} = 0
$$</p>
<p>with $\mathbf{E}$ and $\mathbf{B}$ determined by the sum over all species.</p>
<h2 id="3-conservation-laws">3. Conservation Laws<a class="header-link" href="#3-conservation-laws" title="Permanent link">&para;</a></h2>
<h3 id="31-particle-conservation">3.1 Particle Conservation<a class="header-link" href="#31-particle-conservation" title="Permanent link">&para;</a></h3>
<p>Integrate the Vlasov equation over all velocities:</p>
<p>$$
\int \frac{\partial f}{\partial t} d^3v + \int \mathbf{v}\cdot\nabla f \, d^3v + \int \frac{q}{m}(\mathbf{E}+\mathbf{v}\times\mathbf{B})\cdot\frac{\partial f}{\partial \mathbf{v}} d^3v = 0
$$</p>
<p>First term:
$$
\int \frac{\partial f}{\partial t} d^3v = \frac{\partial}{\partial t}\int f \, d^3v = \frac{\partial n}{\partial t}
$$</p>
<p>Second term:
$$
\int \mathbf{v}\cdot\nabla f \, d^3v = \nabla\cdot\int \mathbf{v}f \, d^3v = \nabla\cdot(n\mathbf{u})
$$</p>
<p>Third term (integration by parts, assuming $f\to 0$ as $|\mathbf{v}|\to\infty$):
$$
\int \frac{q}{m}\mathbf{F}\cdot\frac{\partial f}{\partial \mathbf{v}} d^3v = -\frac{q}{m}\int f\nabla_v\cdot\mathbf{F} \, d^3v = 0
$$</p>
<p>because $\nabla_v\cdot(\mathbf{E}+\mathbf{v}\times\mathbf{B}) = \nabla_v\cdot\mathbf{E} + \nabla_v\cdot(\mathbf{v}\times\mathbf{B}) = 0$ (E is independent of v, and the cross product has zero divergence in velocity space).</p>
<p>Result:
$$
\boxed{\frac{\partial n}{\partial t} + \nabla\cdot(n\mathbf{u}) = 0}
$$</p>
<p><strong>Continuity equation</strong>: particle number is conserved.</p>
<h3 id="32-momentum-conservation">3.2 Momentum Conservation<a class="header-link" href="#32-momentum-conservation" title="Permanent link">&para;</a></h3>
<p>Multiply Vlasov equation by $m\mathbf{v}$ and integrate:</p>
<p>$$
\int m\mathbf{v}\frac{\partial f}{\partial t} d^3v + \int m\mathbf{v}(\mathbf{v}\cdot\nabla f) d^3v + \int q\mathbf{v}(\mathbf{E}+\mathbf{v}\times\mathbf{B})\cdot\frac{\partial f}{\partial\mathbf{v}} d^3v = 0
$$</p>
<p>After some algebra (integration by parts, etc.):</p>
<p>$$
\frac{\partial}{\partial t}(mn\mathbf{u}) + \nabla\cdot\mathbf{P} = qn(\mathbf{E} + \mathbf{u}\times\mathbf{B})
$$</p>
<p>where $\mathbf{P}$ is the momentum flux tensor (includes pressure and flow).</p>
<p><strong>Momentum equation</strong>: momentum changes due to electromagnetic force.</p>
<h3 id="33-energy-conservation">3.3 Energy Conservation<a class="header-link" href="#33-energy-conservation" title="Permanent link">&para;</a></h3>
<p>Multiply by $\frac{1}{2}mv^2$ and integrate:</p>
<p>$$
\frac{\partial}{\partial t}\left(\frac{1}{2}mn\langle v^2\rangle\right) + \nabla\cdot\mathbf{Q} = qn\mathbf{u}\cdot\mathbf{E}
$$</p>
<p>where $\mathbf{Q}$ is the energy flux.</p>
<p><strong>Energy equation</strong>: kinetic energy changes due to work done by electric field.</p>
<p>(Magnetic field does no work: $\mathbf{v}\times\mathbf{B}\perp\mathbf{v}$)</p>
<h3 id="34-entropy-and-casimir-invariants">3.4 Entropy and Casimir Invariants<a class="header-link" href="#34-entropy-and-casimir-invariants" title="Permanent link">&para;</a></h3>
<p>Define the <strong>entropy</strong>:</p>
<p>$$
S = -k_B \int f \ln f \, d^3x \, d^3v
$$</p>
<p>From the Vlasov equation, we can show:</p>
<p>$$
\frac{dS}{dt} = 0
$$</p>
<p><strong>Entropy is conserved</strong> in collisionless plasmas (reversible dynamics). This is very different from collisional systems where entropy increases (H-theorem).</p>
<p>More generally, any functional of the form:</p>
<p>$$
C = \int G(f) \, d^3x \, d^3v
$$</p>
<p>where $G$ is an arbitrary function, is conserved if $f$ satisfies the Vlasov equation. These are called <strong>Casimir invariants</strong>.</p>
<h2 id="4-equilibrium-distribution-functions">4. Equilibrium Distribution Functions<a class="header-link" href="#4-equilibrium-distribution-functions" title="Permanent link">&para;</a></h2>
<h3 id="41-maxwellian-distribution">4.1 Maxwellian Distribution<a class="header-link" href="#41-maxwellian-distribution" title="Permanent link">&para;</a></h3>
<p>The most common equilibrium is the <strong>Maxwellian</strong> (thermal equilibrium):</p>
<p>$$
\boxed{f_0(\mathbf{v}) = n_0 \left(\frac{m}{2\pi k_B T}\right)^{3/2} \exp\left(-\frac{m|\mathbf{v} - \mathbf{u}|^2}{2k_BT}\right)}
$$</p>
<p>where:
- $n_0$: equilibrium density
- $\mathbf{u}$: bulk drift velocity
- $T$: temperature</p>
<p><strong>Properties</strong>:
- Isotropic in the frame moving with $\mathbf{u}$
- Maximizes entropy for given density and energy
- Stationary solution of Vlasov equation if $\mathbf{E} = \mathbf{B} = 0$ (or uniform $\mathbf{u} = \mathbf{E}\times\mathbf{B}/B^2$)</p>
<h3 id="42-jeans-theorem">4.2 Jeans Theorem<a class="header-link" href="#42-jeans-theorem" title="Permanent link">&para;</a></h3>
<p><strong>Jeans Theorem</strong>: Any function of constants of motion is a stationary solution of the Vlasov equation.</p>
<p>For a particle in fields $\mathbf{E}$, $\mathbf{B}$, if the energy $H = \frac{1}{2}mv^2 + q\Phi$ is conserved:</p>
<p>$$
f = f(H)
$$</p>
<p>is a stationary solution.</p>
<p>More generally:
$$
f = f(H, \mathbf{P}_{\text{canonical}}, \mu, J, \Phi, \ldots)
$$</p>
<p>where the arguments are any constants of motion (energy, canonical momentum, adiabatic invariants, etc.).</p>
<h3 id="43-bi-maxwellian-distribution">4.3 Bi-Maxwellian Distribution<a class="header-link" href="#43-bi-maxwellian-distribution" title="Permanent link">&para;</a></h3>
<p>In a magnetized plasma, anisotropy can develop. A common model is the <strong>bi-Maxwellian</strong>:</p>
<p>$$
\boxed{f_0(v_\perp, v_\parallel) = n_0 \frac{m}{2\pi k_B} \frac{1}{T_\perp}\frac{1}{\sqrt{2\pi k_B T_\parallel/m}} \exp\left(-\frac{mv_\perp^2}{2k_BT_\perp} - \frac{m v_\parallel^2}{2k_BT_\parallel}\right)}
$$</p>
<p>where $T_\perp$ and $T_\parallel$ are temperatures perpendicular and parallel to $\mathbf{B}$.</p>
<p><strong>Anisotropy parameter</strong>:
$$
A = \frac{T_\perp}{T_\parallel} - 1
$$</p>
<ul>
<li>$A > 0$: perpendicular heating (e.g., cyclotron resonance heating)</li>
<li>$A < 0$: parallel heating (e.g., magnetic compression)</li>
</ul>
<p>Bi-Maxwellian distributions can drive instabilities (e.g., electromagnetic ion cyclotron waves for $A > 0$).</p>
<h3 id="44-kappa-distribution">4.4 Kappa Distribution<a class="header-link" href="#44-kappa-distribution" title="Permanent link">&para;</a></h3>
<p>In space plasmas (solar wind, magnetosphere), observations show <strong>non-thermal tails</strong> ‚Äî more high-energy particles than a Maxwellian predicts. A common model is the <strong>kappa distribution</strong>:</p>
<p>$$
\boxed{f_\kappa(v) = n_0 \frac{1}{(\pi\kappa\theta^2)^{3/2}} \frac{\Gamma(\kappa+1)}{\Gamma(\kappa-1/2)} \left(1 + \frac{v^2}{\kappa\theta^2}\right)^{-(\kappa+1)}}
$$</p>
<p>where:
- $\kappa > 3/2$: spectral index (lower $\kappa$ = fatter tail)
- $\theta^2 = \frac{2k_BT}{m}\frac{\kappa - 3/2}{\kappa}$: thermal speed parameter
- $\Gamma$: Gamma function</p>
<p><strong>Limits</strong>:
- $\kappa \to \infty$: recovers Maxwellian
- $\kappa \to 3/2$: power-law tail $f \propto v^{-2(\kappa+1)} = v^{-5}$</p>
<p>Kappa distributions arise from:
- Intermittent particle acceleration
- Collisionless relaxation to "quasi-equilibrium"
- Turbulent heating</p>
<h3 id="45-drifting-maxwellian-beam">4.5 Drifting Maxwellian (Beam)<a class="header-link" href="#45-drifting-maxwellian-beam" title="Permanent link">&para;</a></h3>
<p>A plasma with a beam has two populations:</p>
<p>$$
f = f_{\text{bulk}} + f_{\text{beam}}
$$</p>
<p>For example:
$$
f(v) = n_b\left(\frac{m}{2\pi k_B T_b}\right)^{3/2}\exp\left(-\frac{m(v - v_b)^2}{2k_BT_b}\right) + n_c\left(\frac{m}{2\pi k_B T_c}\right)^{3/2}\exp\left(-\frac{mv^2}{2k_BT_c}\right)
$$</p>
<p>where subscript $b$ = beam, $c$ = core.</p>
<p><strong>Bump-on-tail</strong> (1D version):</p>
<div class="highlight"><pre><span></span><code>    f(v)
      ‚Üë
      |    Core
      |   /‚Äæ‚Äæ‚Äæ\
      |  /     \___
      | /          \___   Beam (bump)
      |/               \__/‚Äæ‚Äæ\_______
     ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí v
                               v_b

    Positive slope df/dv &gt; 0 at resonance
    ‚Üí Unstable (two-stream instability)
</code></pre></div>

<p>This drives instabilities (two-stream, bump-on-tail), transferring energy from the beam to waves.</p>
<h2 id="5-linearization-and-perturbation-theory">5. Linearization and Perturbation Theory<a class="header-link" href="#5-linearization-and-perturbation-theory" title="Permanent link">&para;</a></h2>
<h3 id="51-equilibrium-perturbation">5.1 Equilibrium + Perturbation<a class="header-link" href="#51-equilibrium-perturbation" title="Permanent link">&para;</a></h3>
<p>For small-amplitude waves, decompose:</p>
<p>$$
f = f_0(\mathbf{v}) + f_1(\mathbf{x}, \mathbf{v}, t)
$$</p>
<p>$$
\mathbf{E} = \mathbf{E}_0 + \mathbf{E}_1(\mathbf{x}, t)
$$</p>
<p>where subscript $0$ = equilibrium, $1$ = perturbation with $|f_1| \ll f_0$.</p>
<h3 id="52-linearized-vlasov-equation">5.2 Linearized Vlasov Equation<a class="header-link" href="#52-linearized-vlasov-equation" title="Permanent link">&para;</a></h3>
<p>Substitute into Vlasov and keep only first-order terms:</p>
<p>$$
\frac{\partial f_1}{\partial t} + \mathbf{v}\cdot\nabla f_1 + \frac{q}{m}(\mathbf{E}_0 + \mathbf{v}\times\mathbf{B}_0)\cdot\frac{\partial f_1}{\partial\mathbf{v}} = -\frac{q}{m}\mathbf{E}_1\cdot\frac{\partial f_0}{\partial\mathbf{v}}
$$</p>
<p>Coupled with linearized Poisson:</p>
<p>$$
\nabla\cdot\mathbf{E}_1 = \frac{1}{\epsilon_0}\sum_s q_s \int f_1^{(s)} \, d^3v
$$</p>
<p>This is the basis for <strong>linear kinetic theory</strong> of plasma waves and instabilities (we'll solve this in Lesson 8 for Landau damping).</p>
<h3 id="53-bgk-modes">5.3 BGK Modes<a class="header-link" href="#53-bgk-modes" title="Permanent link">&para;</a></h3>
<p><strong>BGK (Bernstein-Greene-Kruskal) modes</strong> are exact nonlinear solutions of the Vlasov-Poisson system, representing electrostatic wave packets with trapped particles.</p>
<p>For 1D:
$$
f(x, v, t) = f(v - u(x))
$$</p>
<p>where particles are trapped in the potential well of the wave. These are traveling wave solutions with phase velocity $v_{\text{ph}}$ and amplitude determined by the trapping width.</p>
<p>BGK modes represent a balance between:
- Particle trapping (nonlinear effect)
- Wave propagation</p>
<p>They are relevant for:
- Nonlinear Landau damping
- Electron and ion holes
- Double layers</p>
<h2 id="6-python-implementations">6. Python Implementations<a class="header-link" href="#6-python-implementations" title="Permanent link">&para;</a></h2>
<h3 id="61-plotting-distribution-functions">6.1 Plotting Distribution Functions<a class="header-link" href="#61-plotting-distribution-functions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">gamma</span>

<span class="c1"># Constants</span>
<span class="n">k_B</span> <span class="o">=</span> <span class="mf">1.380649e-23</span>  <span class="c1"># J/K</span>
<span class="n">m_p</span> <span class="o">=</span> <span class="mf">1.67e-27</span>      <span class="c1"># kg</span>
<span class="n">m_e</span> <span class="o">=</span> <span class="mf">9.11e-31</span>      <span class="c1"># kg</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">1.6e-19</span>         <span class="c1"># C</span>

<span class="k">def</span><span class="w"> </span><span class="nf">maxwellian_1d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1D Maxwellian distribution</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">maxwellian_3d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    3D Maxwellian (isotropic, speed distribution)</span>
<span class="sd">    f(v) dv = 4œÄ v^2 f(v_vec) dv</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span> <span class="o">*</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">kappa_1d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1D kappa distribution</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">theta_sq</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">-</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">kappa</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">theta_sq</span><span class="p">))</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">kappa</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">(</span><span class="n">kappa</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">norm</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">theta_sq</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">kappa</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bi_maxwellian_vperp</span><span class="p">(</span><span class="n">v_perp</span><span class="p">,</span> <span class="n">v_para</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">T_perp</span><span class="p">,</span> <span class="n">T_para</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bi-Maxwellian: f(v_perp, v_para)</span>
<span class="sd">    Here we fix v_para and plot vs v_perp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T_perp</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T_para</span><span class="p">))</span> <span class="o">*</span> \
           <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span> <span class="o">*</span> <span class="n">v_perp</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T_perp</span><span class="p">)</span> <span class="o">-</span> <span class="n">m</span> <span class="o">*</span> <span class="n">v_para</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T_para</span><span class="p">))</span>

<span class="c1"># Parameters</span>
<span class="n">n0</span> <span class="o">=</span> <span class="mf">1e19</span>  <span class="c1"># m^-3</span>
<span class="n">T_eV</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># eV</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">T_eV</span> <span class="o">*</span> <span class="n">e</span> <span class="o">/</span> <span class="n">k_B</span>  <span class="c1"># Kelvin</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">m_p</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5e5</span><span class="p">,</span> <span class="mf">5e5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># m/s</span>

<span class="c1"># Plot 1D distributions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Maxwellian</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">f_max</span> <span class="o">=</span> <span class="n">maxwellian_1d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">f_max</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maxwellian&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;v (km/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(v) (s/m‚Å¥)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1D Maxwellian Distribution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Drifting Maxwellian (beam)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">f_core</span> <span class="o">=</span> <span class="n">maxwellian_1d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n0</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f_beam</span> <span class="o">=</span> <span class="n">maxwellian_1d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n0</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">T</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mf">2e5</span><span class="p">)</span>
<span class="n">f_total</span> <span class="o">=</span> <span class="n">f_core</span> <span class="o">+</span> <span class="n">f_beam</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">f_core</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Core&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">f_beam</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Beam&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">f_total</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;v (km/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(v) (s/m‚Å¥)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bump-on-Tail Distribution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Kappa distribution comparison</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">kappa_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">kappa_values</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">f_kappa</span> <span class="o">=</span> <span class="n">kappa_1d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Œ∫ = </span><span class="si">{</span><span class="n">kappa_val</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="k">else</span> <span class="s1">&#39;Œ∫ ‚Üí ‚àû (Maxwellian)&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">f_kappa</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;v (km/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(v) (s/m‚Å¥)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Kappa Distributions (Non-thermal Tails)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># 3D speed distribution</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">v_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6e5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">f_3d</span> <span class="o">=</span> <span class="n">maxwellian_3d</span><span class="p">(</span><span class="n">v_speed</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="n">v_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">T</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v_speed</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">f_3d</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">v_th</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
          <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;v_th = </span><span class="si">{</span><span class="n">v_th</span><span class="o">/</span><span class="mf">1e3</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> km/s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Speed v (km/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(v) (s/m‚Å¥)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;3D Maxwellian Speed Distribution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;distribution_functions.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved: distribution_functions.png&quot;</span><span class="p">)</span>

<span class="c1"># Bi-Maxwellian</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">v_perp_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5e5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">T_perp_eV</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">T_para_eV</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">T_perp</span> <span class="o">=</span> <span class="n">T_perp_eV</span> <span class="o">*</span> <span class="n">e</span> <span class="o">/</span> <span class="n">k_B</span>
<span class="n">T_para</span> <span class="o">=</span> <span class="n">T_para_eV</span> <span class="o">*</span> <span class="n">e</span> <span class="o">/</span> <span class="n">k_B</span>

<span class="c1"># Different v_para slices</span>
<span class="n">v_para_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mf">2e5</span><span class="p">,</span> <span class="mf">3e5</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">v_para</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v_para_values</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">f_bi</span> <span class="o">=</span> <span class="n">bi_maxwellian_vperp</span><span class="p">(</span><span class="n">v_perp_array</span><span class="p">,</span> <span class="n">v_para</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">T_perp</span><span class="p">,</span> <span class="n">T_para</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v_perp_array</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">f_bi</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;v_para = </span><span class="si">{</span><span class="n">v_para</span><span class="o">/</span><span class="mf">1e3</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> km/s&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;v_perp (km/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(v_perp, v_para) (s/m‚Å¥)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bi-Maxwellian: T_perp = </span><span class="si">{</span><span class="n">T_perp_eV</span><span class="si">}</span><span class="s1"> eV, T_para = </span><span class="si">{</span><span class="n">T_para_eV</span><span class="si">}</span><span class="s1"> eV&#39;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;bi_maxwellian.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved: bi_maxwellian.png&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="62-moments-calculation">6.2 Moments Calculation<a class="header-link" href="#62-moments-calculation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">simps</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_moments</span><span class="p">(</span><span class="n">v_array</span><span class="p">,</span> <span class="n">f_array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute moments of 1D distribution function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Density</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">simps</span><span class="p">(</span><span class="n">f_array</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span>

    <span class="c1"># Mean velocity</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">simps</span><span class="p">(</span><span class="n">v_array</span> <span class="o">*</span> <span class="n">f_array</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>

    <span class="c1"># Variance (temperature measure)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">simps</span><span class="p">((</span><span class="n">v_array</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f_array</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>

    <span class="c1"># Thermal velocity</span>
    <span class="n">v_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v_th</span><span class="p">,</span> <span class="n">var</span>

<span class="c1"># Test with Maxwellian</span>
<span class="n">v_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1e6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">n_test</span> <span class="o">=</span> <span class="mf">1e19</span>
<span class="n">T_test</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">e</span> <span class="o">/</span> <span class="n">k_B</span>
<span class="n">u_test</span> <span class="o">=</span> <span class="mf">1e5</span>  <span class="c1"># drifting</span>

<span class="n">f_test</span> <span class="o">=</span> <span class="n">maxwellian_1d</span><span class="p">(</span><span class="n">v_test</span><span class="p">,</span> <span class="n">n_test</span><span class="p">,</span> <span class="n">T_test</span><span class="p">,</span> <span class="n">m_p</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_test</span><span class="p">)</span>

<span class="n">n_calc</span><span class="p">,</span> <span class="n">u_calc</span><span class="p">,</span> <span class="n">v_th_calc</span><span class="p">,</span> <span class="n">var_calc</span> <span class="o">=</span> <span class="n">compute_moments</span><span class="p">(</span><span class="n">v_test</span><span class="p">,</span> <span class="n">f_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Moment Calculation ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  n = </span><span class="si">{</span><span class="n">n_test</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  u = </span><span class="si">{</span><span class="n">u_test</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  T = </span><span class="si">{</span><span class="n">T_test</span><span class="o">*</span><span class="n">k_B</span><span class="o">/</span><span class="n">e</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  v_th (expected) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k_B</span><span class="o">*</span><span class="n">T_test</span><span class="o">/</span><span class="n">m_p</span><span class="p">)</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Calculated from distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  n = </span><span class="si">{</span><span class="n">n_calc</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m^-3&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  u = </span><span class="si">{</span><span class="n">u_calc</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  v_th = </span><span class="si">{</span><span class="n">v_th_calc</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  T = </span><span class="si">{</span><span class="n">m_p</span><span class="o">*</span><span class="n">var_calc</span><span class="o">/</span><span class="n">k_B</span><span class="o">/</span><span class="mi">2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> K = </span><span class="si">{</span><span class="n">m_p</span><span class="o">*</span><span class="n">var_calc</span><span class="o">/</span><span class="n">e</span><span class="o">/</span><span class="mi">2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> eV&quot;</span><span class="p">)</span>

<span class="n">errors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">abs</span><span class="p">(</span><span class="n">n_calc</span> <span class="o">-</span> <span class="n">n_test</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_test</span><span class="p">,</span>
    <span class="nb">abs</span><span class="p">(</span><span class="n">u_calc</span> <span class="o">-</span> <span class="n">u_test</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">u_test</span><span class="p">),</span>
    <span class="nb">abs</span><span class="p">(</span><span class="n">v_th_calc</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k_B</span><span class="o">*</span><span class="n">T_test</span><span class="o">/</span><span class="n">m_p</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k_B</span><span class="o">*</span><span class="n">T_test</span><span class="o">/</span><span class="n">m_p</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Relative errors: </span><span class="si">{</span><span class="n">errors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="63-simple-1d-vlasov-solver-operator-splitting">6.3 Simple 1D Vlasov Solver (Operator Splitting)<a class="header-link" href="#63-simple-1d-vlasov-solver-operator-splitting" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">vlasov_1d_solver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">E_func</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple 1D Vlasov solver using operator splitting</span>

<span class="sd">    x: position grid</span>
<span class="sd">    v: velocity grid</span>
<span class="sd">    f0: initial distribution f(x,v,t=0)</span>
<span class="sd">    E_func: function E(x,t) giving electric field</span>
<span class="sd">    dt: timestep</span>
<span class="sd">    num_steps: number of steps</span>
<span class="sd">    q, m: charge and mass</span>

<span class="sd">    Returns: f(x,v,t) at final time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dv</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Nx</span><span class="p">,</span> <span class="n">Nv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="c1"># Storage for snapshots</span>
    <span class="n">snapshots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">snapshot_times</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">dt</span>

        <span class="c1"># Step 1: Advection in x (‚àÇf/‚àÇt + v ‚àÇf/‚àÇx = 0)</span>
        <span class="c1"># Use upwind scheme</span>
        <span class="n">f_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nv</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">i_up</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Nx</span>  <span class="c1"># periodic BC</span>
                    <span class="n">f_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i_up</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i_up</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Nx</span>
                    <span class="n">f_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i_up</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">f_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Step 2: Acceleration in v (‚àÇf/‚àÇt + (q/m)E ‚àÇf/‚àÇv = 0)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">E_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">f_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">E</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">m</span>  <span class="c1"># acceleration</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nv</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">j_up</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">f_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dv</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j_up</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">j_up</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nv</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">f_new</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">dv</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j_up</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">f_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Save snapshots</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_steps</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">snapshots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="n">snapshot_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">snapshots</span><span class="p">,</span> <span class="n">snapshot_times</span>

<span class="c1"># Setup 1D problem</span>
<span class="n">Nx</span><span class="p">,</span> <span class="n">Nv</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span>
<span class="n">Lx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">0.5</span>  <span class="c1"># wavelength</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Lx</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3e5</span><span class="p">,</span> <span class="mf">3e5</span><span class="p">,</span> <span class="n">Nv</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

<span class="c1"># Initial condition: perturbed Maxwellian</span>
<span class="n">n0</span> <span class="o">=</span> <span class="mf">1e19</span>
<span class="n">T0</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">e</span> <span class="o">/</span> <span class="n">k_B</span>
<span class="n">k_wave</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># wavenumber (1/m)</span>
<span class="n">amplitude</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">f0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Nv</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
    <span class="n">n_pert</span> <span class="o">=</span> <span class="n">n0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k_wave</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">f0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">maxwellian_1d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n_pert</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">m_e</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Electric field (for this demo, use a static wave)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">E_field</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">E0</span> <span class="o">=</span> <span class="mf">1e2</span>  <span class="c1"># V/m</span>
    <span class="k">return</span> <span class="n">E0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k_wave</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">1e5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>

<span class="c1"># Solve</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Solving 1D Vlasov equation...&quot;</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-8</span>  <span class="c1"># s</span>
<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">f_final</span><span class="p">,</span> <span class="n">snapshots</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">vlasov_1d_solver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">E_field</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">,</span> <span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="n">m_e</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed </span><span class="si">{</span><span class="n">num_steps</span><span class="si">}</span><span class="s2"> steps, final time = </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>

<span class="c1"># Plot phase space evolution</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">f0</span><span class="p">]</span> <span class="o">+</span> <span class="n">snapshots</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">times</span><span class="p">[:</span><span class="mi">5</span><span class="p">])):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">snap</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;v (km/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;t = </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> s&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;f(x,v)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;vlasov_1d_evolution.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved: vlasov_1d_evolution.png&quot;</span><span class="p">)</span>

<span class="c1"># Density evolution</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">f0</span><span class="p">]</span> <span class="o">+</span> <span class="n">snapshots</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">times</span><span class="p">[::</span><span class="mi">2</span><span class="p">])):</span>
    <span class="n">n_x</span> <span class="o">=</span> <span class="n">simps</span><span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_x</span><span class="o">/</span><span class="n">n0</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t = </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.1e</span><span class="si">}</span><span class="s1"> s&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;n(x,t) / n0&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Density Oscillation (1D Vlasov)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;vlasov_density.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved: vlasov_density.png&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this lesson, we developed the kinetic theory of plasmas using the Vlasov equation:</p>
<ol>
<li>
<p><strong>Phase space and distribution function</strong>: $f(\mathbf{x}, \mathbf{v}, t)$ describes the statistical state of the plasma in 6D phase space.</p>
</li>
<li>
<p><strong>Moments</strong>: Macroscopic quantities (density, velocity, pressure, temperature) are obtained by integrating $f$ over velocity space.</p>
</li>
<li>
<p><strong>Vlasov equation</strong>:
   $$
   \frac{\partial f}{\partial t} + \mathbf{v}\cdot\nabla f + \frac{q}{m}(\mathbf{E}+\mathbf{v}\times\mathbf{B})\cdot\frac{\partial f}{\partial\mathbf{v}} = 0
   $$
   describes collisionless evolution of $f$, derived from Liouville's theorem.</p>
</li>
<li>
<p><strong>Self-consistency</strong>: Vlasov equation coupled with Maxwell's equations forms the Vlasov-Maxwell system.</p>
</li>
<li>
<p><strong>Conservation laws</strong>: Vlasov equation conserves particles, momentum, energy, and entropy (Casimir invariants).</p>
</li>
<li>
<p><strong>Equilibrium distributions</strong>:</p>
</li>
<li><strong>Maxwellian</strong>: thermal equilibrium</li>
<li><strong>Bi-Maxwellian</strong>: anisotropic magnetized plasma</li>
<li><strong>Kappa</strong>: non-thermal tails (space plasmas)</li>
<li>
<p><strong>Beam</strong>: bump-on-tail (unstable)</p>
</li>
<li>
<p><strong>Linearization</strong>: Perturbation theory for small-amplitude waves leads to linear kinetic theory (next lesson: Landau damping).</p>
</li>
</ol>
<p>The Vlasov equation is the foundation of kinetic plasma physics, capturing phenomena that fluid models miss:
- Landau damping (collisionless wave damping)
- Kinetic instabilities
- Wave-particle resonances</p>
<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-moments-of-a-drifting-maxwellian">Problem 1: Moments of a Drifting Maxwellian<a class="header-link" href="#problem-1-moments-of-a-drifting-maxwellian" title="Permanent link">&para;</a></h3>
<p>Consider a 1D Maxwellian distribution:</p>
<p>$$
f(v) = n_0\sqrt{\frac{m}{2\pi k_B T}}\exp\left(-\frac{m(v-u_0)^2}{2k_BT}\right)
$$</p>
<p>(a) Compute the zeroth moment (density): $n = \int f(v) \, dv$.</p>
<p>(b) Compute the first moment (mean velocity): $\langle v\rangle = \frac{1}{n}\int v f(v) \, dv$.</p>
<p>(c) Compute the second moment (temperature): $T = \frac{m}{k_B}\int (v - \langle v\rangle)^2 f(v) \, dv$.</p>
<p>(d) Verify your results numerically using the Python code provided.</p>
<hr />
<h3 id="problem-2-bi-maxwellian-anisotropy">Problem 2: Bi-Maxwellian Anisotropy<a class="header-link" href="#problem-2-bi-maxwellian-anisotropy" title="Permanent link">&para;</a></h3>
<p>A magnetized plasma has a bi-Maxwellian distribution with $T_\perp = 200$ eV and $T_\parallel = 50$ eV.</p>
<p>(a) Calculate the anisotropy parameter $A = T_\perp/T_\parallel - 1$.</p>
<p>(b) Compute the pressure tensor components $P_\perp = nk_BT_\perp$ and $P_\parallel = nk_BT_\parallel$ for $n = 10^{19}$ m$^{-3}$.</p>
<p>(c) Is this distribution isotropic? Stable? (Hint: Large $A > 0$ can drive cyclotron instabilities.)</p>
<p>(d) Estimate the free energy available in the anisotropy: $\Delta W = \frac{3}{2}nk_B(T_\perp - T_\parallel)$.</p>
<hr />
<h3 id="problem-3-kappa-distribution-vs-maxwellian">Problem 3: Kappa Distribution vs Maxwellian<a class="header-link" href="#problem-3-kappa-distribution-vs-maxwellian" title="Permanent link">&para;</a></h3>
<p>For a kappa distribution with $\kappa = 3$, compute the ratio of the number of particles with $v > 3v_{\text{th}}$ (suprathermal particles) compared to a Maxwellian with the same density and temperature.</p>
<p>(a) For a Maxwellian, the fraction of particles with $v > 3v_{\text{th}}$ is approximately $\exp(-9/2) \approx 0.011$ (1.1%). Calculate this numerically.</p>
<p>(b) For the kappa distribution, compute the same fraction numerically by integrating:
   $$
   f_{\text{super}} = \frac{\int_{3v_{th}}^\infty f_\kappa(v) \, dv}{\int_0^\infty f_\kappa(v) \, dv}
   $$</p>
<p>(c) What is the enhancement factor (kappa/Maxwellian)?</p>
<p>(d) Explain why kappa distributions are observed in the solar wind and magnetosphere.</p>
<hr />
<h3 id="problem-4-conservation-of-entropy">Problem 4: Conservation of Entropy<a class="header-link" href="#problem-4-conservation-of-entropy" title="Permanent link">&para;</a></h3>
<p>Show analytically that the entropy $S = -k_B\int f\ln f \, d^3x\,d^3v$ is conserved by the Vlasov equation.</p>
<p>(a) Start with $\frac{dS}{dt} = -k_B\int\frac{\partial}{\partial t}(f\ln f) \, d^3x\,d^3v$.</p>
<p>(b) Use $\frac{\partial}{\partial t}(f\ln f) = (1 + \ln f)\frac{\partial f}{\partial t}$ and substitute the Vlasov equation.</p>
<p>(c) Integrate by parts and use $\nabla_x\cdot\mathbf{v} = 0$ and $\nabla_v\cdot\mathbf{a} = 0$ for Lorentz acceleration.</p>
<p>(d) Show that all terms vanish, hence $\frac{dS}{dt} = 0$.</p>
<hr />
<h3 id="problem-5-linearized-vlasov-poisson-for-langmuir-waves">Problem 5: Linearized Vlasov-Poisson for Langmuir Waves<a class="header-link" href="#problem-5-linearized-vlasov-poisson-for-langmuir-waves" title="Permanent link">&para;</a></h3>
<p>Consider a 1D electrostatic perturbation in an unmagnetized plasma:</p>
<p>$$
f = f_0(v) + f_1(x, v, t)
$$</p>
<p>$$
E = E_1(x, t)
$$</p>
<p>where $f_0$ is a Maxwellian at rest.</p>
<p>(a) Write the linearized Vlasov equation for $f_1$.</p>
<p>(b) Write the linearized Poisson equation for $E_1$ in terms of $f_1$.</p>
<p>(c) Assume plane wave solutions: $f_1 \propto e^{i(kx - \omega t)}$, $E_1 \propto e^{i(kx - \omega t)}$. Derive the dispersion relation (you should get the Bohm-Gross relation for real $\omega$; we'll treat Landau damping in Lesson 8).</p>
<p>(d) For $k\lambda_D \ll 1$, show that $\omega^2 \approx \omega_{pe}^2(1 + 3k^2\lambda_D^2)$ where $\lambda_D = \sqrt{\epsilon_0 k_BT/(ne^2)}$.</p>
<p><strong>Hint</strong>: This problem previews Lesson 8. The full solution requires handling the pole at $v = \omega/k$ (Landau prescription).</p>
<hr />
<h2 id="navigation">Navigation<a class="header-link" href="#navigation" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Previous</strong>: <a href="./06_Magnetic_Mirrors_Adiabatic_Invariants.md">Magnetic Mirrors and Adiabatic Invariants</a></li>
<li><strong>Next</strong>: <a href="./08_Landau_Damping.md">Landau Damping</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Plasma_Physics/06_Magnetic_Mirrors_Adiabatic_Invariants.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">6. Magnetic Mirrors and Adiabatic Invariants</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Plasma_Physics/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Plasma_Physics/08_Landau_Damping.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">8. Landau Damping</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}