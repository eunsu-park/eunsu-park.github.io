{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>07. OWASP Top 10 (2021) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">07. OWASP Top 10 (2021)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>07. OWASP Top 10 (2021)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/06_Authorization.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">06. Authorization and Access Control</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Security/08_Injection_Attacks.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">08. Injection Attacks and Prevention</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-overview-the-2021-top-10">1. Overview: The 2021 Top 10</a></li>
<li><a href="#2-a01-broken-access-control">2. A01: Broken Access Control</a><ul>
<li><a href="#21-description">2.1 Description</a></li>
<li><a href="#22-vulnerable-code">2.2 Vulnerable Code</a></li>
<li><a href="#23-fixed-code">2.3 Fixed Code</a></li>
<li><a href="#24-prevention">2.4 Prevention</a></li>
</ul>
</li>
<li><a href="#3-a02-cryptographic-failures">3. A02: Cryptographic Failures</a><ul>
<li><a href="#31-description">3.1 Description</a></li>
<li><a href="#32-vulnerable-code">3.2 Vulnerable Code</a></li>
<li><a href="#33-fixed-code">3.3 Fixed Code</a></li>
<li><a href="#34-prevention">3.4 Prevention</a></li>
</ul>
</li>
<li><a href="#4-a03-injection">4. A03: Injection</a><ul>
<li><a href="#41-description">4.1 Description</a></li>
<li><a href="#42-vulnerable-vs-fixed-code">4.2 Vulnerable vs Fixed Code</a></li>
<li><a href="#43-prevention">4.3 Prevention</a></li>
</ul>
</li>
<li><a href="#5-a04-insecure-design">5. A04: Insecure Design</a><ul>
<li><a href="#51-description">5.1 Description</a></li>
<li><a href="#52-real-world-example-cinema-booking">5.2 Real-World Example: Cinema Booking</a></li>
<li><a href="#53-prevention">5.3 Prevention</a></li>
</ul>
</li>
<li><a href="#6-a05-security-misconfiguration">6. A05: Security Misconfiguration</a><ul>
<li><a href="#61-description">6.1 Description</a></li>
<li><a href="#62-vulnerable-configuration">6.2 Vulnerable Configuration</a></li>
<li><a href="#63-fixed-configuration">6.3 Fixed Configuration</a></li>
<li><a href="#64-prevention">6.4 Prevention</a></li>
</ul>
</li>
<li><a href="#7-a06-vulnerable-and-outdated-components">7. A06: Vulnerable and Outdated Components</a><ul>
<li><a href="#71-description">7.1 Description</a></li>
<li><a href="#72-dependency-auditing">7.2 Dependency Auditing</a></li>
<li><a href="#73-prevention">7.3 Prevention</a></li>
</ul>
</li>
<li><a href="#8-a07-identification-and-authentication-failures">8. A07: Identification and Authentication Failures</a><ul>
<li><a href="#81-description">8.1 Description</a></li>
<li><a href="#82-vulnerable-vs-fixed-code">8.2 Vulnerable vs Fixed Code</a></li>
<li><a href="#83-prevention">8.3 Prevention</a></li>
</ul>
</li>
<li><a href="#9-a08-software-and-data-integrity-failures">9. A08: Software and Data Integrity Failures</a><ul>
<li><a href="#91-description">9.1 Description</a></li>
<li><a href="#92-vulnerable-code-insecure-deserialization">9.2 Vulnerable Code: Insecure Deserialization</a></li>
<li><a href="#93-prevention">9.3 Prevention</a></li>
</ul>
</li>
<li><a href="#10-a09-security-logging-and-monitoring-failures">10. A09: Security Logging and Monitoring Failures</a><ul>
<li><a href="#101-description">10.1 Description</a></li>
<li><a href="#102-security-logging-implementation">10.2 Security Logging Implementation</a></li>
<li><a href="#103-what-to-log">10.3 What to Log</a></li>
<li><a href="#104-prevention">10.4 Prevention</a></li>
</ul>
</li>
<li><a href="#11-a10-server-side-request-forgery-ssrf">11. A10: Server-Side Request Forgery (SSRF)</a><ul>
<li><a href="#111-description">11.1 Description</a></li>
<li><a href="#112-vulnerable-code">11.2 Vulnerable Code</a></li>
<li><a href="#113-fixed-code">11.3 Fixed Code</a></li>
<li><a href="#114-prevention">11.4 Prevention</a></li>
</ul>
</li>
<li><a href="#12-prevention-checklist">12. Prevention Checklist</a></li>
<li><a href="#13-exercises">13. Exercises</a><ul>
<li><a href="#exercise-1-vulnerability-identification">Exercise 1: Vulnerability Identification</a></li>
<li><a href="#exercise-2-secure-application-design">Exercise 2: Secure Application Design</a></li>
<li><a href="#exercise-3-security-audit-report">Exercise 3: Security Audit Report</a></li>
<li><a href="#exercise-4-fix-the-vulnerable-application">Exercise 4: Fix the Vulnerable Application</a></li>
<li><a href="#exercise-5-owasp-top-10-mapping">Exercise 5: OWASP Top 10 Mapping</a></li>
</ul>
</li>
<li><a href="#14-summary">14. Summary</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="07-owasp-top-10-2021">07. OWASP Top 10 (2021)<a class="header-link" href="#07-owasp-top-10-2021" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="06_Authorization.md">06. Authorization and Access Control</a> | <strong>Next</strong>: <a href="08_Injection_Attacks.md">08. Injection Attacks and Prevention</a></p>
<hr />
<p>The OWASP (Open Worldwide Application Security Project) Top 10 is the most widely recognized document for web application security risks. Updated periodically based on real-world vulnerability data, it serves as a standard awareness document for developers and security professionals. The 2021 edition reflects significant shifts in the threat landscape, with three new categories and major reshuffling. This lesson covers each of the ten categories with descriptions, real-world examples, vulnerable code, fixed code, and prevention strategies.</p>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand all ten OWASP Top 10 (2021) categories</li>
<li>Identify vulnerable code patterns for each category</li>
<li>Write secure code that prevents each vulnerability class</li>
<li>Apply the OWASP Top 10 as a security checklist during development and code review</li>
<li>Recognize real-world impacts of each vulnerability</li>
</ul>
<hr />
<h2 id="1-overview-the-2021-top-10">1. Overview: The 2021 Top 10<a class="header-link" href="#1-overview-the-2021-top-10" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  OWASP Top 10 - 2021                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  #   Category                              Change from 2017     â”‚
â”‚  â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  A01  Broken Access Control                 â†‘ from #5           â”‚
â”‚  A02  Cryptographic Failures                â†‘ from #3 (renamed) â”‚
â”‚  A03  Injection                             â†“ from #1           â”‚
â”‚  A04  Insecure Design                       â˜… NEW               â”‚
â”‚  A05  Security Misconfiguration             â†‘ from #6           â”‚
â”‚  A06  Vulnerable/Outdated Components        â†‘ from #9 (renamed) â”‚
â”‚  A07  Identification &amp; Auth Failures        â†“ from #2 (renamed) â”‚
â”‚  A08  Software &amp; Data Integrity Failures    â˜… NEW               â”‚
â”‚  A09  Security Logging &amp; Monitoring Failuresâ†‘ from #10 (renamed)â”‚
â”‚  A10  Server-Side Request Forgery (SSRF)    â˜… NEW               â”‚
â”‚                                                                  â”‚
â”‚  Key Trends:                                                     â”‚
â”‚  - Broken Access Control is now #1 (94% of apps tested)         â”‚
â”‚  - Injection dropped from #1 to #3 (frameworks help)            â”‚
â”‚  - Three new categories reflect modern threats                   â”‚
â”‚  - Supply chain and integrity concerns are rising               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-a01-broken-access-control">2. A01: Broken Access Control<a class="header-link" href="#2-a01-broken-access-control" title="Permanent link">&para;</a></h2>
<h3 id="21-description">2.1 Description<a class="header-link" href="#21-description" title="Permanent link">&para;</a></h3>
<p>Access control enforces policy so that users cannot act outside their intended permissions. Broken access control is the <strong>most common</strong> web application vulnerability, found in 94% of applications tested.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span><span class="nv">A01</span>:<span class="w"> </span><span class="nv">Broken</span><span class="w"> </span><span class="nv">Access</span><span class="w"> </span><span class="nv">Control</span><span class="w">                           </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span><span class="nv">Common</span><span class="w"> </span><span class="nv">Weaknesses</span>:<span class="w">                                              </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Bypassing</span><span class="w"> </span><span class="nv">access</span><span class="w"> </span><span class="nv">control</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">modifying</span><span class="w"> </span><span class="nv">URL</span><span class="o">/</span><span class="nv">parameters</span><span class="o">/</span><span class="nv">API</span><span class="w">     </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Viewing</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">editing</span><span class="w"> </span><span class="nv">someone</span><span class="w"> </span><span class="k">else</span><span class="err">&#39;s account (IDOR)             â”‚</span>
<span class="err">â”‚  - Accessing API with missing access controls (POST/PUT/DELETE) â”‚</span>
<span class="err">â”‚  - Elevation of privilege (acting as admin without login)        â”‚</span>
<span class="err">â”‚  - Metadata manipulation (replay JWT, tamper cookies)            â”‚</span>
<span class="err">â”‚  - CORS misconfiguration allowing unauthorized API access       â”‚</span>
<span class="err">â”‚  - Force browsing to unauthenticated/admin pages                â”‚</span>
<span class="err">â”‚                                                                  â”‚</span>
<span class="err">â”‚  Impact: Data theft, unauthorized data modification,            â”‚</span>
<span class="err">â”‚          account takeover, full system compromise                â”‚</span>
<span class="err">â”‚                                                                  â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="22-vulnerable-code">2.2 Vulnerable Code<a class="header-link" href="#22-vulnerable-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># VULNERABLE: No access control on admin endpoint</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/admin/users/&lt;int:user_id&gt;/delete&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="c1"># Anyone who knows this URL can delete users!</span>
    <span class="n">db</span><span class="o">.</span><span class="n">delete_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;deleted&quot;</span><span class="p">})</span>


<span class="c1"># VULNERABLE: IDOR - No ownership check</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/orders/&lt;int:order_id&gt;&#39;</span><span class="p">)</span>
<span class="nd">@require_auth</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">):</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># User A can see User B&#39;s orders</span>
</code></pre></div>

<h3 id="23-fixed-code">2.3 Fixed Code<a class="header-link" href="#23-fixed-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># FIXED: Proper authorization check</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/admin/users/&lt;int:user_id&gt;/delete&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@require_role</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span>  <span class="c1"># Only admins can access</span>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">delete_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;deleted&quot;</span><span class="p">})</span>


<span class="c1"># FIXED: Ownership verification</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/orders/&lt;int:order_id&gt;&#39;</span><span class="p">)</span>
<span class="nd">@require_auth</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">):</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">order</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Not found&quot;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="c1"># Verify the order belongs to the authenticated user</span>
    <span class="k">if</span> <span class="n">order</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">g</span><span class="o">.</span><span class="n">current_user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Not found&quot;</span><span class="p">}),</span> <span class="mi">404</span>  <span class="c1"># 404, not 403</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</code></pre></div>

<h3 id="24-prevention">2.4 Prevention<a class="header-link" href="#24-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Deny by default (except for public resources)</li>
<li>Implement access control mechanisms once, reuse them everywhere</li>
<li>Enforce record ownership (don't just rely on user-supplied IDs)</li>
<li>Disable web server directory listing</li>
<li>Log access control failures and alert administrators</li>
<li>Rate-limit API access to minimize automated scanning damage</li>
<li>Invalidate JWT tokens on logout (server-side token blocklist)</li>
</ul>
<hr />
<h2 id="3-a02-cryptographic-failures">3. A02: Cryptographic Failures<a class="header-link" href="#3-a02-cryptographic-failures" title="Permanent link">&para;</a></h2>
<h3 id="31-description">3.1 Description<a class="header-link" href="#31-description" title="Permanent link">&para;</a></h3>
<p>Previously called "Sensitive Data Exposure," this category focuses on failures related to cryptography that often lead to exposure of sensitive data. It covers both the failure to encrypt data that should be protected and the use of weak or obsolete cryptographic algorithms.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="nl">A02:</span><span class="w"> </span><span class="n">Cryptographic</span><span class="w"> </span><span class="n">Failures</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Ask</span><span class="w"> </span><span class="nl">yourself:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">Is</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">transmitted</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">cleartext</span><span class="o">?</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">Are</span><span class="w"> </span><span class="n">old</span><span class="o">/</span><span class="n">weak</span><span class="w"> </span><span class="n">cryptographic</span><span class="w"> </span><span class="n">algorithms</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">protocols</span><span class="w"> </span><span class="n">used</span><span class="o">?</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Are</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">crypto</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">rotated</span><span class="o">?</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="n">Is</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">enforced</span><span class="w"> </span><span class="p">(</span><span class="n">missing</span><span class="w"> </span><span class="n">HTTPS</span><span class="w"> </span><span class="n">redirect</span><span class="p">)</span><span class="o">?</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">5.</span><span class="w"> </span><span class="n">Are</span><span class="w"> </span><span class="n">proper</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">missing</span><span class="o">?</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">6.</span><span class="w"> </span><span class="n">Is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="n">validated</span><span class="w"> </span><span class="n">correctly</span><span class="o">?</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">7.</span><span class="w"> </span><span class="n">Is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">hashing</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">passwords</span><span class="w"> </span><span class="p">(</span><span class="n">MD5</span><span class="p">,</span><span class="w"> </span><span class="n">SHA1</span><span class="p">)</span><span class="o">?</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Sensitive</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="nl">Categories:</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Passwords</span><span class="p">,</span><span class="w"> </span><span class="n">credit</span><span class="w"> </span><span class="n">card</span><span class="w"> </span><span class="n">numbers</span><span class="p">,</span><span class="w"> </span><span class="n">health</span><span class="w"> </span><span class="n">records</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Personal</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">business</span><span class="w"> </span><span class="n">secrets</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">protected</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">privacy</span><span class="w"> </span><span class="n">regulations</span><span class="w"> </span><span class="p">(</span><span class="n">GDPR</span><span class="p">,</span><span class="w"> </span><span class="n">HIPAA</span><span class="p">,</span><span class="w"> </span><span class="n">PCI</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="32-vulnerable-code">3.2 Vulnerable Code<a class="header-link" href="#32-vulnerable-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># VULNERABLE: Storing passwords with MD5</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="k">def</span><span class="w"> </span><span class="nf">store_password</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
    <span class="c1"># MD5 is broken for password hashing!</span>
    <span class="n">hash_value</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">hash_value</span><span class="p">)</span>

<span class="c1"># VULNERABLE: Hardcoded encryption key</span>
<span class="n">ENCRYPTION_KEY</span> <span class="o">=</span> <span class="s2">&quot;my-secret-key-123&quot;</span>  <span class="c1"># Committed to source control!</span>

<span class="c1"># VULNERABLE: Using ECB mode (reveals patterns)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_ECB</span><span class="p">)</span>  <span class="c1"># ECB mode is insecure!</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># VULNERABLE: HTTP for sensitive data</span>
<span class="c1"># No redirect from HTTP to HTTPS</span>
<span class="c1"># No HSTS header</span>
</code></pre></div>

<h3 id="33-fixed-code">3.3 Fixed Code<a class="header-link" href="#33-fixed-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># FIXED: Use Argon2 for passwords</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">argon2</span><span class="w"> </span><span class="kn">import</span> <span class="n">PasswordHasher</span>
<span class="n">ph</span> <span class="o">=</span> <span class="n">PasswordHasher</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">store_password</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
    <span class="n">hash_value</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>  <span class="c1"># Argon2id with automatic salting</span>
    <span class="n">db</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">hash_value</span><span class="p">)</span>

<span class="c1"># FIXED: Key from environment, not source code</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">ENCRYPTION_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ENCRYPTION_KEY&#39;</span><span class="p">]</span>  <span class="c1"># 256-bit key</span>

<span class="c1"># FIXED: Use GCM mode (authenticated encryption)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.ciphers.aead</span><span class="w"> </span><span class="kn">import</span> <span class="n">AESGCM</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">AESGCM</span><span class="o">.</span><span class="n">generate_key</span><span class="p">(</span><span class="n">bit_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<span class="n">aesgcm</span> <span class="o">=</span> <span class="n">AESGCM</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">nonce</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>  <span class="c1"># NEVER reuse nonces</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">aesgcm</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">nonce</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">associated_data</span><span class="p">)</span>

<span class="c1"># FIXED: Enforce HTTPS and add security headers</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_security_headers</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="p">]</span> <span class="o">=</span> \
        <span class="s1">&#39;max-age=31536000; includeSubDomains&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Content-Type-Options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;nosniff&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Frame-Options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DENY&#39;</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<h3 id="34-prevention">3.4 Prevention<a class="header-link" href="#34-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Classify data according to sensitivity; apply controls per classification</li>
<li>Do not store sensitive data unnecessarily; discard it as soon as possible</li>
<li>Encrypt all sensitive data at rest and in transit (TLS 1.2+)</li>
<li>Use strong, standard algorithms (AES-256-GCM, RSA-2048+, Ed25519)</li>
<li>Use authenticated encryption (GCM, ChaCha20-Poly1305), never ECB</li>
<li>Store passwords using Argon2id, bcrypt, or scrypt</li>
<li>Generate keys using cryptographically secure random number generators</li>
<li>Disable caching for pages containing sensitive data</li>
</ul>
<hr />
<h2 id="4-a03-injection">4. A03: Injection<a class="header-link" href="#4-a03-injection" title="Permanent link">&para;</a></h2>
<h3 id="41-description">4.1 Description<a class="header-link" href="#41-description" title="Permanent link">&para;</a></h3>
<p>Injection flaws occur when untrusted data is sent to an interpreter as part of a command or query. The attacker's hostile data can trick the interpreter into executing unintended commands or accessing data without authorization. SQL injection, NoSQL injection, OS command injection, and LDAP injection are all forms of this vulnerability.</p>
<blockquote>
<p><strong>Note</strong>: Injection is covered in much greater depth in Lesson 08. This section provides a summary.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              A03: Injection                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Injection Types:                                                â”‚
â”‚  â”œâ”€â”€ SQL Injection          (most common)                        â”‚
â”‚  â”œâ”€â”€ NoSQL Injection        (MongoDB, etc.)                      â”‚
â”‚  â”œâ”€â”€ Command Injection      (os.system, subprocess)              â”‚
â”‚  â”œâ”€â”€ LDAP Injection         (directory services)                 â”‚
â”‚  â”œâ”€â”€ XPath Injection        (XML queries)                        â”‚
â”‚  â”œâ”€â”€ Template Injection     (Jinja2, Twig SSTI)                 â”‚
â”‚  â””â”€â”€ Expression Language    (Spring EL, OGNL)                    â”‚
â”‚                                                                  â”‚
â”‚  Root Cause:                                                     â”‚
â”‚  User input is concatenated into queries/commands                â”‚
â”‚  instead of being parameterized or properly escaped              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="42-vulnerable-vs-fixed-code">4.2 Vulnerable vs Fixed Code<a class="header-link" href="#42-vulnerable-vs-fixed-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># VULNERABLE: SQL Injection</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/search&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
    <span class="c1"># String concatenation = SQL injection!</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM products WHERE name LIKE &#39;%</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">%&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c1"># Attack: /search?q=&#39; OR &#39;1&#39;=&#39;1&#39; --</span>


<span class="c1"># FIXED: Parameterized query</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/search&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM products WHERE name LIKE :query&quot;</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">}</span>  <span class="c1"># Parameter binding</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>

<h3 id="43-prevention">4.3 Prevention<a class="header-link" href="#43-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Use parameterized queries / prepared statements (always)</li>
<li>Use ORM frameworks (SQLAlchemy, Django ORM) which handle parameterization</li>
<li>Validate and sanitize all input (whitelist validation)</li>
<li>Escape special characters for the specific interpreter</li>
<li>Use LIMIT in queries to prevent mass disclosure on injection</li>
</ul>
<hr />
<h2 id="5-a04-insecure-design">5. A04: Insecure Design<a class="header-link" href="#5-a04-insecure-design" title="Permanent link">&para;</a></h2>
<h3 id="51-description">5.1 Description<a class="header-link" href="#51-description" title="Permanent link">&para;</a></h3>
<p>This is a <strong>new category</strong> in 2021 that focuses on risks related to design and architectural flaws. It calls for more use of threat modeling, secure design patterns, and reference architectures. Insecure design cannot be fixed by a perfect implementation - a flawed design is inherently vulnerable.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="nx">A04</span><span class="p">:</span><span class="w"> </span><span class="nx">Insecure</span><span class="w"> </span><span class="nx">Design</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Insecure</span><span class="w"> </span><span class="nx">Design</span><span class="w"> </span><span class="err">â‰ </span><span class="w"> </span><span class="nx">Insecure</span><span class="w"> </span><span class="nx">Implementation</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Insecure</span><span class="w"> </span><span class="nx">Design</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Insecure</span><span class="w"> </span><span class="nx">Impl</span><span class="p">.</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">blueprint</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">blueprint</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">flawed</span><span class="p">.</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">code</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">good</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="nx">the</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">fix</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">help</span><span class="p">.</span><span class="w">    </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">bugs</span><span class="p">.</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Example</span><span class="p">:</span><span class="w">         </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Example</span><span class="p">:</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Password</span><span class="w"> </span><span class="nx">reset</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">SQL</span><span class="w"> </span><span class="nx">injection</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">sends</span><span class="w"> </span><span class="nx">password</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">login</span><span class="w"> </span><span class="nx">form</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">plaintext</span><span class="w">     </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">design</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Examples</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">Insecure</span><span class="w"> </span><span class="nx">Design</span><span class="p">:</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">rate</span><span class="w"> </span><span class="nx">limiting</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">authentication</span><span class="w"> </span><span class="p">(</span><span class="nx">brute</span><span class="w"> </span><span class="nx">force</span><span class="w"> </span><span class="nx">possible</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Security</span><span class="w"> </span><span class="nx">questions</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">sole</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="nx">recovery</span><span class="w"> </span><span class="nx">method</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="nx">validation</span><span class="w"> </span><span class="nx">architecture</span><span class="w"> </span><span class="p">(</span><span class="nx">each</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">implements</span><span class="w"> </span><span class="nx">own</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Storing</span><span class="w"> </span><span class="nx">secrets</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">design</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">separation</span><span class="w"> </span><span class="nx">between</span><span class="w"> </span><span class="nx">tenant</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">multi</span><span class="o">-</span><span class="nx">tenant</span><span class="w"> </span><span class="nx">system</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Missing</span><span class="w"> </span><span class="nx">abuse</span><span class="w"> </span><span class="nx">cases</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">requirements</span><span class="w"> </span><span class="p">(</span><span class="nx">only</span><span class="w"> </span><span class="nx">happy</span><span class="w"> </span><span class="nx">paths</span><span class="p">)</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="52-real-world-example-cinema-booking">5.2 Real-World Example: Cinema Booking<a class="header-link" href="#52-real-world-example-cinema-booking" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># INSECURE DESIGN: Movie ticket booking without rate limiting</span>
<span class="c1"># The design allows a bot to book ALL tickets for popular movies</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/book&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@require_auth</span>
<span class="k">def</span><span class="w"> </span><span class="nf">book_ticket</span><span class="p">():</span>
    <span class="n">movie_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;movie_id&#39;</span><span class="p">]</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;seats&#39;</span><span class="p">]</span>  <span class="c1"># No limit on number of seats!</span>

    <span class="c1"># No rate limiting per user</span>
    <span class="c1"># No maximum seats per transaction</span>
    <span class="c1"># No CAPTCHA for high-demand events</span>
    <span class="c1"># No fraud detection</span>

    <span class="n">booking</span> <span class="o">=</span> <span class="n">create_booking</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">movie_id</span><span class="p">,</span> <span class="n">seats</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">booking</span><span class="p">)</span>


<span class="c1"># SECURE DESIGN: With proper safeguards</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/book&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@require_auth</span>
<span class="nd">@rate_limit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">per_minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Rate limiting</span>
<span class="k">def</span><span class="w"> </span><span class="nf">book_ticket</span><span class="p">():</span>
    <span class="n">movie_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;movie_id&#39;</span><span class="p">]</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;seats&#39;</span><span class="p">]</span>

    <span class="c1"># Design-level controls</span>
    <span class="n">MAX_SEATS_PER_BOOKING</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_SEATS_PER_BOOKING</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Maximum </span><span class="si">{</span><span class="n">MAX_SEATS_PER_BOOKING</span><span class="si">}</span><span class="s2"> seats per booking&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># Check user hasn&#39;t already booked too many seats for this showing</span>
    <span class="n">existing</span> <span class="o">=</span> <span class="n">get_user_bookings</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">movie_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Max 2 bookings per user per movie</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum bookings reached for this movie&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># For high-demand events, require additional verification</span>
    <span class="n">movie</span> <span class="o">=</span> <span class="n">get_movie</span><span class="p">(</span><span class="n">movie_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">movie</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;high_demand&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verify_captcha</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;captcha_token&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;CAPTCHA verification required&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="n">booking</span> <span class="o">=</span> <span class="n">create_booking</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">movie_id</span><span class="p">,</span> <span class="n">seats</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">booking</span><span class="p">)</span>
</code></pre></div>

<h3 id="53-prevention">5.3 Prevention<a class="header-link" href="#53-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Use threat modeling for critical authentication, access control, and business logic</li>
<li>Integrate security language and controls into user stories</li>
<li>Write unit and integration tests to validate that all critical flows are resistant to abuse</li>
<li>Design for failure: limit resource consumption per user/session</li>
<li>Tier your application layers to separate trust boundaries</li>
<li>Use secure design patterns (e.g., stateless session management, input validation frameworks)</li>
</ul>
<hr />
<h2 id="6-a05-security-misconfiguration">6. A05: Security Misconfiguration<a class="header-link" href="#6-a05-security-misconfiguration" title="Permanent link">&para;</a></h2>
<h3 id="61-description">6.1 Description<a class="header-link" href="#61-description" title="Permanent link">&para;</a></h3>
<p>Security misconfiguration is the most commonly seen issue in practice. It includes improperly configured permissions, unnecessary features enabled, default accounts/passwords unchanged, overly informative error messages, and missing security hardening.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              A05: Security Misconfiguration                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Common Misconfigurations:                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Issue                    â”‚ Risk                   â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ Debug mode in production â”‚ Stack traces exposed   â”‚           â”‚
â”‚  â”‚ Default admin:admin      â”‚ Immediate compromise   â”‚           â”‚
â”‚  â”‚ Directory listing ON     â”‚ Source/config exposure  â”‚           â”‚
â”‚  â”‚ Unnecessary services     â”‚ Increased attack surfaceâ”‚          â”‚
â”‚  â”‚ Verbose error messages   â”‚ Information disclosure  â”‚           â”‚
â”‚  â”‚ Missing security headers â”‚ XSS, clickjacking      â”‚           â”‚
â”‚  â”‚ CORS: Access-Control-    â”‚ Cross-origin attacks    â”‚           â”‚
â”‚  â”‚   Allow-Origin: *        â”‚                         â”‚           â”‚
â”‚  â”‚ Outdated software        â”‚ Known vulnerabilities   â”‚           â”‚
â”‚  â”‚ S3 bucket public         â”‚ Data breach             â”‚           â”‚
â”‚  â”‚ .git folder exposed      â”‚ Source code leak        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62-vulnerable-configuration">6.2 Vulnerable Configuration<a class="header-link" href="#62-vulnerable-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># VULNERABLE: Flask in debug mode in production</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Exposes interactive debugger!</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dev&#39;</span>  <span class="c1"># Weak/default secret key</span>

<span class="c1"># VULNERABLE: Overly permissive CORS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask_cors</span><span class="w"> </span><span class="kn">import</span> <span class="n">CORS</span>
<span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">origins</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>  <span class="c1"># Any website can make requests!</span>

<span class="c1"># VULNERABLE: Detailed error messages</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">),</span>
        <span class="s2">&quot;traceback&quot;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>  <span class="c1"># Leaks internals!</span>
        <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE_URI&#39;</span><span class="p">],</span>  <span class="c1"># Leaks credentials!</span>
    <span class="p">}),</span> <span class="mi">500</span>
</code></pre></div>

<h3 id="63-fixed-configuration">6.3 Fixed Configuration<a class="header-link" href="#63-fixed-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># FIXED: Environment-based configuration</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;TESTING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span>  <span class="c1"># Strong, random</span>

<span class="c1"># FIXED: Restrictive CORS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask_cors</span><span class="w"> </span><span class="kn">import</span> <span class="n">CORS</span>
<span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">origins</span><span class="o">=</span><span class="p">[</span>
    <span class="s2">&quot;https://myapp.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://www.myapp.com&quot;</span><span class="p">,</span>
<span class="p">])</span>

<span class="c1"># FIXED: Generic error messages in production</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="c1"># Log the full error internally</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Internal error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Return generic message to user</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;An internal error occurred&quot;</span><span class="p">,</span>
        <span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="n">generate_error_reference_id</span><span class="p">(),</span>  <span class="c1"># For support tickets</span>
    <span class="p">}),</span> <span class="mi">500</span>

<span class="c1"># FIXED: Security headers</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_security_headers</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Content-Type-Options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;nosniff&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Frame-Options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DENY&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-XSS-Protection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>  <span class="c1"># Disable legacy XSS filter</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Referrer-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;strict-origin-when-cross-origin&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>
        <span class="s2">&quot;script-src &#39;self&#39;; &quot;</span>
        <span class="s2">&quot;style-src &#39;self&#39; &#39;unsafe-inline&#39;; &quot;</span>
        <span class="s2">&quot;img-src &#39;self&#39; data:; &quot;</span>
        <span class="s2">&quot;font-src &#39;self&#39;; &quot;</span>
        <span class="s2">&quot;frame-ancestors &#39;none&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Permissions-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;camera=(), microphone=(), geolocation=()&#39;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_secure</span><span class="p">:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;max-age=31536000; includeSubDomains; preload&#39;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<h3 id="64-prevention">6.4 Prevention<a class="header-link" href="#64-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Implement a repeatable hardening process for all environments</li>
<li>Remove or do not install unnecessary features, frameworks, and components</li>
<li>Review and update configurations as part of the patch management process</li>
<li>Use infrastructure as code for consistent, auditable deployments</li>
<li>Implement automated security configuration verification in CI/CD</li>
<li>Separate environments (dev, staging, production) with different credentials</li>
</ul>
<hr />
<h2 id="7-a06-vulnerable-and-outdated-components">7. A06: Vulnerable and Outdated Components<a class="header-link" href="#7-a06-vulnerable-and-outdated-components" title="Permanent link">&para;</a></h2>
<h3 id="71-description">7.1 Description<a class="header-link" href="#71-description" title="Permanent link">&para;</a></h3>
<p>Applications that use components (libraries, frameworks, OS) with known vulnerabilities may be exploited. This is a supply chain risk that is increasingly important.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">          </span><span class="nx">A06</span><span class="p">:</span><span class="w"> </span><span class="nx">Vulnerable</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">Outdated</span><span class="w"> </span><span class="nx">Components</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">You</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">vulnerable</span><span class="w"> </span><span class="k">if</span><span class="p">:</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">You</span><span class="w"> </span><span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">know</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">versions</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">components</span><span class="w"> </span><span class="nx">used</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">software</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">out</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">support</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">unpatched</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">You</span><span class="w"> </span><span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">scan</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">vulnerabilities</span><span class="w"> </span><span class="nx">regularly</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">You</span><span class="w"> </span><span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">fix</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">upgrade</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">timely</span><span class="w"> </span><span class="nx">fashion</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Developers</span><span class="w"> </span><span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">compatibility</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">updated</span><span class="w"> </span><span class="nx">libraries</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Component</span><span class="w"> </span><span class="nx">configurations</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">secured</span><span class="w"> </span><span class="p">(</span><span class="nx">see</span><span class="w"> </span><span class="nx">A05</span><span class="p">)</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Real</span><span class="o">-</span><span class="nx">World</span><span class="w"> </span><span class="nx">Impact</span><span class="p">:</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Log4Shell</span><span class="w"> </span><span class="p">(</span><span class="nx">CVE</span><span class="o">-</span><span class="mi">2021</span><span class="o">-</span><span class="mi">44228</span><span class="p">):</span><span class="w"> </span><span class="nx">Critical</span><span class="w"> </span><span class="nx">RCE</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">Log4j</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Equifax</span><span class="w"> </span><span class="nx">breach</span><span class="w"> </span><span class="p">(</span><span class="mi">2017</span><span class="p">):</span><span class="w"> </span><span class="nx">Unpatched</span><span class="w"> </span><span class="nx">Apache</span><span class="w"> </span><span class="nx">Struts</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Event</span><span class="o">-</span><span class="nx">Stream</span><span class="w"> </span><span class="p">(</span><span class="mi">2018</span><span class="p">):</span><span class="w"> </span><span class="nx">Malicious</span><span class="w"> </span><span class="nx">npm</span><span class="w"> </span><span class="kn">package</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">ua</span><span class="o">-</span><span class="nx">parser</span><span class="o">-</span><span class="nx">js</span><span class="w"> </span><span class="p">(</span><span class="mi">2021</span><span class="p">):</span><span class="w"> </span><span class="nx">Supply</span><span class="w"> </span><span class="nx">chain</span><span class="w"> </span><span class="nx">attack</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">npm</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="72-dependency-auditing">7.2 Dependency Auditing<a class="header-link" href="#72-dependency-auditing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Python: Check for known vulnerabilities</span>
pip<span class="w"> </span>install<span class="w"> </span>pip-audit
pip-audit<span class="w">                        </span><span class="c1"># Scan installed packages</span>
pip-audit<span class="w"> </span>-r<span class="w"> </span>requirements.txt<span class="w">    </span><span class="c1"># Scan requirements file</span>

<span class="c1"># Python: Alternative with safety</span>
pip<span class="w"> </span>install<span class="w"> </span>safety
safety<span class="w"> </span>check<span class="w">                     </span><span class="c1"># Check installed packages</span>

<span class="c1"># Node.js: Built-in audit</span>
npm<span class="w"> </span>audit
npm<span class="w"> </span>audit<span class="w"> </span>fix<span class="w">                    </span><span class="c1"># Auto-fix where possible</span>

<span class="c1"># General: OWASP Dependency-Check</span>
<span class="c1"># Scans multiple languages (Java, .NET, Python, JS, etc.)</span>
<span class="c1"># https://owasp.org/www-project-dependency-check/</span>

<span class="c1"># GitHub: Dependabot (automatic PR for vulnerable deps)</span>
<span class="c1"># GitLab: Dependency Scanning in CI/CD pipeline</span>

<span class="c1"># Pin dependencies with hash verification (Python)</span>
pip<span class="w"> </span>install<span class="w"> </span>--require-hashes<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># requirements.txt with pinned versions and hashes</span>
<span class="c1"># Generate with: pip-compile --generate-hashes requirements.in</span>
<span class="n">flask</span><span class="o">==</span><span class="mf">3.0.0</span> \
    <span class="o">--</span><span class="nb">hash</span><span class="o">=</span><span class="n">sha256</span><span class="p">:</span><span class="mi">21128</span><span class="n">f47e</span><span class="o">...</span>
<span class="n">werkzeug</span><span class="o">==</span><span class="mf">3.0.1</span> \
    <span class="o">--</span><span class="nb">hash</span><span class="o">=</span><span class="n">sha256</span><span class="p">:</span><span class="mi">5</span><span class="n">a7b12abc</span><span class="o">...</span>
</code></pre></div>

<h3 id="73-prevention">7.3 Prevention<a class="header-link" href="#73-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Remove unused dependencies, features, components, files, and documentation</li>
<li>Continuously inventory component versions using tools (pip-audit, npm audit, OWASP Dependency-Check)</li>
<li>Monitor sources like CVE and NVD for vulnerability alerts</li>
<li>Only obtain components from official sources over secure links</li>
<li>Monitor for unmaintained libraries (no security patches)</li>
<li>Have a patching plan: test and deploy updates promptly</li>
</ul>
<hr />
<h2 id="8-a07-identification-and-authentication-failures">8. A07: Identification and Authentication Failures<a class="header-link" href="#8-a07-identification-and-authentication-failures" title="Permanent link">&para;</a></h2>
<h3 id="81-description">8.1 Description<a class="header-link" href="#81-description" title="Permanent link">&para;</a></h3>
<p>Confirmation of the user's identity, authentication, and session management is critical to protect against authentication-related attacks. This was previously called "Broken Authentication."</p>
<blockquote>
<p><strong>Note</strong>: See Lesson 05 for comprehensive authentication coverage.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          A07: Identification and Authentication Failures          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Weaknesses:                                                     â”‚
â”‚  - Permits brute force or credential stuffing                   â”‚
â”‚  - Allows weak or well-known passwords                          â”‚
â”‚  - Uses weak credential recovery (&quot;What&#39;s your pet&#39;s name?&quot;)   â”‚
â”‚  - Uses plain text or weakly hashed passwords                   â”‚
â”‚  - Missing or ineffective multi-factor authentication           â”‚
â”‚  - Exposes session ID in URL                                    â”‚
â”‚  - Does not rotate session ID after login                       â”‚
â”‚  - Does not properly invalidate sessions on logout              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="82-vulnerable-vs-fixed-code">8.2 Vulnerable vs Fixed Code<a class="header-link" href="#82-vulnerable-vs-fixed-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># VULNERABLE: No brute force protection</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login_vulnerable</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">check_password</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">password_hash</span><span class="p">):</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>  <span class="c1"># No session regeneration!</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}),</span> <span class="mi">401</span>


<span class="c1"># FIXED: With rate limiting, lockout, and session management</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask_limiter</span><span class="w"> </span><span class="kn">import</span> <span class="n">Limiter</span>

<span class="n">limiter</span> <span class="o">=</span> <span class="n">Limiter</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">default_limits</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;200 per day&quot;</span><span class="p">])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@limiter</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="s2">&quot;5 per minute&quot;</span><span class="p">)</span>  <span class="c1"># Rate limit login attempts</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login_secure</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>

    <span class="c1"># Check account lockout</span>
    <span class="k">if</span> <span class="n">is_account_locked</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Account temporarily locked&quot;</span><span class="p">}),</span> <span class="mi">429</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">check_password</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">password_hash</span><span class="p">):</span>
        <span class="c1"># Reset failed attempts</span>
        <span class="n">reset_failed_attempts</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>

        <span class="c1"># Regenerate session (prevent session fixation)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">session</span><span class="o">.</span><span class="n">permanent</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>

    <span class="c1"># Increment failed attempts</span>
    <span class="n">record_failed_attempt</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>

    <span class="c1"># Generic error (don&#39;t reveal if username exists)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}),</span> <span class="mi">401</span>
</code></pre></div>

<h3 id="83-prevention">8.3 Prevention<a class="header-link" href="#83-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Implement multi-factor authentication (TOTP or FIDO2)</li>
<li>Use rate limiting and account lockout for login endpoints</li>
<li>Check passwords against breached password databases</li>
<li>Use secure password storage (Argon2id, bcrypt)</li>
<li>Regenerate session IDs after login</li>
<li>Implement proper session timeout and invalidation</li>
</ul>
<hr />
<h2 id="9-a08-software-and-data-integrity-failures">9. A08: Software and Data Integrity Failures<a class="header-link" href="#9-a08-software-and-data-integrity-failures" title="Permanent link">&para;</a></h2>
<h3 id="91-description">9.1 Description<a class="header-link" href="#91-description" title="Permanent link">&para;</a></h3>
<p>This <strong>new category</strong> focuses on making assumptions about software updates, critical data, and CI/CD pipelines without verifying integrity. It includes the former "Insecure Deserialization" category.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">          </span><span class="n">A08</span><span class="p">:</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">Integrity</span><span class="w"> </span><span class="n">Failures</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Attack</span><span class="w"> </span><span class="n">Vectors</span><span class="p">:</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">CI</span><span class="o">/</span><span class="n">CD</span><span class="w"> </span><span class="n">Pipeline</span><span class="w"> </span><span class="n">Compromise</span><span class="p">:</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">Attacker</span><span class="w"> </span><span class="n">modifies</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">inject</span><span class="w"> </span><span class="n">malicious</span><span class="w"> </span><span class="n">code</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="err">â”‚â”€â”€â”€â–¶â”‚</span><span class="n">Build</span><span class="w"> </span><span class="err">â”‚â”€â”€â”€â–¶â”‚</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="err">â”‚â”€â”€â”€â–¶â”‚</span><span class="n">Deploy</span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”¬â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="err">â–¼</span><span class="w"> </span><span class="n">Attacker</span><span class="w"> </span><span class="n">injects</span><span class="w"> </span><span class="n">backdoor</span><span class="w"> </span><span class="n">here</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">Auto</span><span class="o">-</span><span class="n">Update</span><span class="w"> </span><span class="n">Without</span><span class="w"> </span><span class="n">Verification</span><span class="p">:</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">App</span><span class="w"> </span><span class="n">downloads</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">verifying</span><span class="w"> </span><span class="n">digital</span><span class="w"> </span><span class="n">signature</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">Attacker</span><span class="w"> </span><span class="n">performs</span><span class="w"> </span><span class="n">MITM</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="n">malicious</span><span class="w"> </span><span class="n">update</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Insecure</span><span class="w"> </span><span class="n">Deserialization</span><span class="p">:</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">App</span><span class="w"> </span><span class="n">deserializes</span><span class="w"> </span><span class="n">untrusted</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">leading</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">RCE</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">Remote</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">execution</span><span class="o">!</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="n">Dependency</span><span class="w"> </span><span class="n">Confusion</span><span class="p">:</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">Attacker</span><span class="w"> </span><span class="n">publishes</span><span class="w"> </span><span class="n">malicious</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">internal</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">registry</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="92-vulnerable-code-insecure-deserialization">9.2 Vulnerable Code: Insecure Deserialization<a class="header-link" href="#92-vulnerable-code-insecure-deserialization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>

<span class="c1"># VULNERABLE: Deserializing untrusted data with pickle</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/import&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">import_data_vulnerable</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># RCE! Attacker can execute arbitrary code</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;imported&quot;</span><span class="p">})</span>

<span class="c1"># Attack payload:</span>
<span class="c1"># import pickle, os</span>
<span class="c1"># class Exploit:</span>
<span class="c1">#     def __reduce__(self):</span>
<span class="c1">#         return (os.system, (&#39;rm -rf /&#39;,))</span>
<span class="c1"># pickle.dumps(Exploit())</span>


<span class="c1"># VULNERABLE: YAML load (allows arbitrary Python objects)</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/config&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_config_vulnerable</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Unsafe! Can execute code</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>


<span class="c1"># FIXED: Use safe alternatives</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/import&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">import_data_secure</span><span class="p">():</span>
    <span class="c1"># Use JSON instead of pickle for data exchange</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_schema</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>  <span class="c1"># Validate structure</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid data format&quot;</span><span class="p">}),</span> <span class="mi">400</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;imported&quot;</span><span class="p">})</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/config&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_config_secure</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># safe_load blocks code execution</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

<h3 id="93-prevention">9.3 Prevention<a class="header-link" href="#93-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Use digital signatures or similar to verify software/data integrity</li>
<li>Ensure libraries and dependencies consume trusted repositories</li>
<li>Use a software supply chain security tool (SLSA, Sigstore)</li>
<li>Review CI/CD pipeline for unauthorized access or modifications</li>
<li>Do not send unsigned or unencrypted serialized data to untrusted clients</li>
<li>Never use <code>pickle</code>, <code>marshal</code>, or <code>yaml.load()</code> on untrusted data</li>
</ul>
<hr />
<h2 id="10-a09-security-logging-and-monitoring-failures">10. A09: Security Logging and Monitoring Failures<a class="header-link" href="#10-a09-security-logging-and-monitoring-failures" title="Permanent link">&para;</a></h2>
<h3 id="101-description">10.1 Description<a class="header-link" href="#101-description" title="Permanent link">&para;</a></h3>
<p>Without sufficient logging and monitoring, breaches cannot be detected in time. Most successful attacks start with vulnerability probing, and allowing this probing to continue unchecked can increase the likelihood of a successful exploit.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">      </span><span class="nv">A09</span>:<span class="w"> </span><span class="nv">Security</span><span class="w"> </span><span class="nv">Logging</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">Monitoring</span><span class="w"> </span><span class="nv">Failures</span><span class="w">               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span><span class="nv">Problems</span>:<span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Login</span><span class="w"> </span><span class="nv">failures</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">logged</span><span class="w">                                    </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Warnings</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">errors</span><span class="w"> </span><span class="nv">generate</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">unclear</span><span class="w"> </span><span class="nv">log</span><span class="w"> </span><span class="nv">messages</span><span class="w">      </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Logs</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">stored</span><span class="w"> </span><span class="nv">locally</span><span class="w"> </span><span class="ss">(</span><span class="nv">lost</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">server</span><span class="w"> </span><span class="nv">compromised</span><span class="ss">)</span><span class="w">    </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">alerting</span><span class="w"> </span><span class="nv">thresholds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">effective</span><span class="w"> </span><span class="nv">escalation</span><span class="w">               </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Penetration</span><span class="w"> </span><span class="nv">testing</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">DAST</span><span class="w"> </span><span class="nv">scans</span><span class="w"> </span><span class="nv">don</span><span class="err">&#39;t trigger alerts      â”‚</span>
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Application</span><span class="w"> </span><span class="nv">can</span><span class="err">&#39;t detect, escalate, or alert for attacks     â”‚</span>
<span class="err">â”‚  - Log injection: attacker writes fake log entries              â”‚</span>
<span class="err">â”‚                                                                  â”‚</span>
<span class="err">â”‚  Average time to detect a breach: 287 days (IBM 2021)           â”‚</span>
<span class="err">â”‚  Cost of breach detected in &lt;200 days: $3.6M                   â”‚</span>
<span class="err">â”‚  Cost of breach detected in &gt;200 days: $4.9M                   â”‚</span>
<span class="err">â”‚                                                                  â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="102-security-logging-implementation">10.2 Security Logging Implementation<a class="header-link" href="#102-security-logging-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">security_logging.py - Comprehensive security event logging</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">g</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># ==============================================================</span>
<span class="c1"># Security Event Logger</span>
<span class="c1"># ==============================================================</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SecurityLogger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured security event logging.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;security.</span><span class="si">{</span><span class="n">app_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

        <span class="c1"># JSON formatter for structured logging</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_log_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log a structured security event.&quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">event_type</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">severity</span><span class="p">,</span>
            <span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span> <span class="k">if</span> <span class="n">request</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;user_agent&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">request</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;current_user&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">login_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="s2">&quot;auth.login.success&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">login_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="s2">&quot;auth.login.failure&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span>
                       <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sanitize</span><span class="p">(</span><span class="n">username</span><span class="p">),</span>
                       <span class="n">reason</span><span class="o">=</span><span class="n">reason</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">access_denied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="s2">&quot;authz.denied&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span>
                       <span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">suspicious_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">details</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="s2">&quot;security.suspicious&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                       <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="o">**</span><span class="n">details</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">data_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="s2">&quot;data.access&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
                       <span class="n">resource_type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span>
                       <span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sanitize log input to prevent log injection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># Remove newlines and control characters</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">r&#39;</span><span class="p">)</span>


<span class="n">sec_log</span> <span class="o">=</span> <span class="n">SecurityLogger</span><span class="p">(</span><span class="s2">&quot;myapp&quot;</span><span class="p">)</span>


<span class="c1"># Usage in routes</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="n">sec_log</span><span class="o">.</span><span class="n">login_success</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sec_log</span><span class="o">.</span><span class="n">login_failure</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="s2">&quot;invalid_credentials&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid credentials&quot;</span><span class="p">}),</span> <span class="mi">401</span>


<span class="c1"># Monitor for brute force</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">before_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">detect_brute_force</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect and alert on potential brute force attempts.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/login&#39;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
        <span class="n">recent_failures</span> <span class="o">=</span> <span class="n">get_recent_login_failures</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">recent_failures</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">sec_log</span><span class="o">.</span><span class="n">suspicious_activity</span><span class="p">(</span>
                <span class="s2">&quot;Possible brute force attack&quot;</span><span class="p">,</span>
                <span class="n">ip_address</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">failure_count</span><span class="o">=</span><span class="n">recent_failures</span><span class="p">,</span>
                <span class="n">timeframe_minutes</span><span class="o">=</span><span class="mi">5</span>
            <span class="p">)</span>
            <span class="c1"># Optionally: block IP, require CAPTCHA, alert SOC</span>
</code></pre></div>

<h3 id="103-what-to-log">10.3 What to Log<a class="header-link" href="#103-what-to-log" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Event</th>
<th>Severity</th>
<th>Details to Include</th>
</tr>
</thead>
<tbody>
<tr>
<td>Login success/failure</td>
<td>INFO/WARNING</td>
<td>Username, IP, timestamp, user agent</td>
</tr>
<tr>
<td>Authorization failures</td>
<td>WARNING</td>
<td>User, resource, action attempted</td>
</tr>
<tr>
<td>Input validation failures</td>
<td>WARNING</td>
<td>Endpoint, invalid input type</td>
</tr>
<tr>
<td>Admin actions</td>
<td>INFO</td>
<td>Admin user, action, target</td>
</tr>
<tr>
<td>Password changes</td>
<td>INFO</td>
<td>User ID (never the password)</td>
</tr>
<tr>
<td>Account lockout</td>
<td>WARNING</td>
<td>Username, failure count</td>
</tr>
<tr>
<td>Data export/download</td>
<td>INFO</td>
<td>User, data type, volume</td>
</tr>
<tr>
<td>API rate limiting triggered</td>
<td>WARNING</td>
<td>Client, endpoint, rate</td>
</tr>
<tr>
<td>System errors</td>
<td>ERROR</td>
<td>Error type, stack trace (not to client)</td>
</tr>
</tbody>
</table>
<h3 id="104-prevention">10.4 Prevention<a class="header-link" href="#104-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Log all login, access control, and server-side input validation failures</li>
<li>Ensure logs have sufficient context for forensic analysis</li>
<li>Use structured logging (JSON) for machine parsability</li>
<li>Implement centralized log management (ELK, Splunk, CloudWatch)</li>
<li>Establish effective monitoring and alerting with escalation</li>
<li>Create an incident response plan and practice it</li>
<li>Protect logs from tampering (write-once storage, integrity checks)</li>
</ul>
<hr />
<h2 id="11-a10-server-side-request-forgery-ssrf">11. A10: Server-Side Request Forgery (SSRF)<a class="header-link" href="#11-a10-server-side-request-forgery-ssrf" title="Permanent link">&para;</a></h2>
<h3 id="111-description">11.1 Description<a class="header-link" href="#111-description" title="Permanent link">&para;</a></h3>
<p>SSRF flaws occur when a web application fetches a remote resource without validating the user-supplied URL. This allows an attacker to coerce the application to send a crafted request to an unexpected destination, even when protected by a firewall, VPN, or network ACL. This is a <strong>new category</strong> in 2021.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              A10: Server-Side Request Forgery (SSRF)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Normal:                                                         â”‚
â”‚  User â”€â”€â–¶ Server â”€â”€â–¶ https://api.external.com/data              â”‚
â”‚                                                                  â”‚
â”‚  SSRF Attack:                                                    â”‚
â”‚  User â”€â”€â–¶ Server â”€â”€â–¶ http://169.254.169.254/metadata            â”‚
â”‚                       (AWS instance metadata!)                   â”‚
â”‚                                                                  â”‚
â”‚  User â”€â”€â–¶ Server â”€â”€â–¶ http://localhost:6379/                     â”‚
â”‚                       (Internal Redis server!)                   â”‚
â”‚                                                                  â”‚
â”‚  User â”€â”€â–¶ Server â”€â”€â–¶ http://10.0.0.5:8080/admin                â”‚
â”‚                       (Internal admin panel!)                    â”‚
â”‚                                                                  â”‚
â”‚  User â”€â”€â–¶ Server â”€â”€â–¶ file:///etc/passwd                         â”‚
â”‚                       (Local file read!)                         â”‚
â”‚                                                                  â”‚
â”‚  Impact:                                                         â”‚
â”‚  - Access cloud instance metadata (steal credentials)           â”‚
â”‚  - Scan internal network                                         â”‚
â”‚  - Access internal services (Redis, databases, admin panels)    â”‚
â”‚  - Read local files                                              â”‚
â”‚  - Capital One breach (2019): SSRF â†’ metadata â†’ S3 access      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="112-vulnerable-code">11.2 Vulnerable Code<a class="header-link" href="#112-vulnerable-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>

<span class="c1"># VULNERABLE: Fetching arbitrary URLs</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/fetch-url&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_url_vulnerable</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
    <span class="c1"># No validation! User can access internal services</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">})</span>

<span class="c1"># Attack examples:</span>
<span class="c1"># {&quot;url&quot;: &quot;http://169.254.169.254/latest/meta-data/iam/security-credentials/&quot;}</span>
<span class="c1"># {&quot;url&quot;: &quot;http://localhost:6379/CONFIG SET dir /tmp&quot;}</span>
<span class="c1"># {&quot;url&quot;: &quot;file:///etc/passwd&quot;}</span>


<span class="c1"># VULNERABLE: Image proxy with no validation</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/proxy-image&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proxy_image_vulnerable</span><span class="p">():</span>
    <span class="n">image_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">)}</span>
</code></pre></div>

<h3 id="113-fixed-code">11.3 Fixed Code<a class="header-link" href="#113-fixed-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ipaddress</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="c1"># Allowlist of permitted domains</span>
<span class="n">ALLOWED_DOMAINS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;api.example.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;images.example.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cdn.trusted-partner.com&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Blocked IP ranges (internal networks)</span>
<span class="n">BLOCKED_IP_RANGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;10.0.0.0/8&quot;</span><span class="p">),</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;172.16.0.0/12&quot;</span><span class="p">),</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;192.168.0.0/16&quot;</span><span class="p">),</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;127.0.0.0/8&quot;</span><span class="p">),</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;169.254.0.0/16&quot;</span><span class="p">),</span>     <span class="c1"># Link-local (AWS metadata)</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;0.0.0.0/8&quot;</span><span class="p">),</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;100.64.0.0/10&quot;</span><span class="p">),</span>       <span class="c1"># Carrier-grade NAT</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;fd00::/8&quot;</span><span class="p">),</span>             <span class="c1"># IPv6 private</span>
    <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s2">&quot;::1/128&quot;</span><span class="p">),</span>              <span class="c1"># IPv6 loopback</span>
<span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">is_safe_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that a URL is safe to fetch.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># Only allow HTTP(S) schemes</span>
        <span class="k">if</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">hostname</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">hostname</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hostname</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Option A: Allowlist approach (strongest)</span>
        <span class="k">if</span> <span class="n">hostname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DOMAINS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Option B: Blocklist approach (if allowlist not feasible)</span>
        <span class="c1"># Resolve hostname to IP and check against blocked ranges</span>
        <span class="n">resolved_ips</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">family</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sockaddr</span> <span class="ow">in</span> <span class="n">resolved_ips</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">sockaddr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">blocked_range</span> <span class="ow">in</span> <span class="n">BLOCKED_IP_RANGES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">blocked_range</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="c1"># FIXED: URL validation before fetching</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/fetch-url&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_url_secure</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_safe_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;URL not allowed&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Prevent redirect to internal services</span>
        <span class="p">)</span>

        <span class="c1"># If there&#39;s a redirect, validate the destination too</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">is_redirect</span><span class="p">:</span>
            <span class="n">redirect_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_safe_url</span><span class="p">(</span><span class="n">redirect_url</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Redirect to blocked URL&quot;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">10000</span><span class="p">]})</span>  <span class="c1"># Limit response size</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to fetch URL&quot;</span><span class="p">}),</span> <span class="mi">400</span>
</code></pre></div>

<h3 id="114-prevention">11.4 Prevention<a class="header-link" href="#114-prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Sanitize and validate all client-supplied input URLs</li>
<li>Enforce URL schema, port, and destination with a positive allow list</li>
<li>Do not send raw responses to clients</li>
<li>Disable HTTP redirections</li>
<li>Use network-level segmentation (firewall rules preventing server-to-internal traffic)</li>
<li>For cloud environments: use IMDSv2 (requires token) instead of IMDSv1 for instance metadata</li>
</ul>
<hr />
<h2 id="12-prevention-checklist">12. Prevention Checklist<a class="header-link" href="#12-prevention-checklist" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">          </span><span class="n">OWASP</span><span class="w"> </span><span class="n">Top</span><span class="w"> </span><span class="mh">10</span><span class="w"> </span><span class="n">Prevention</span><span class="w"> </span><span class="n">Checklist</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A01</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Broken</span><span class="w"> </span><span class="n">Access</span><span class="w"> </span><span class="nl">Control:</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Default</span><span class="o">-</span><span class="n">deny</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">control</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="n">ownership</span><span class="w"> </span><span class="n">validation</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Rate</span><span class="w"> </span><span class="n">limiting</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">sensitive</span><span class="w"> </span><span class="n">endpoints</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">CORS</span><span class="w"> </span><span class="n">properly</span><span class="w"> </span><span class="n">configured</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A02</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Cryptographic</span><span class="w"> </span><span class="nl">Failures:</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">classified</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">sensitivity</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="mf">1.2</span><span class="o">+</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">transit</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">AES</span><span class="o">-</span><span class="mh">256</span><span class="o">-</span><span class="n">GCM</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">ChaCha20</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">rest</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Argon2id</span><span class="o">/</span><span class="n">bcrypt</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">passwords</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A03</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nl">Injection:</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Parameterized</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">everywhere</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">ORM</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">access</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Input</span><span class="w"> </span><span class="n">validation</span><span class="w"> </span><span class="p">(</span><span class="n">whitelist</span><span class="w"> </span><span class="n">approach</span><span class="p">)</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Output</span><span class="w"> </span><span class="n">encoding</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">context</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A04</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Insecure</span><span class="w"> </span><span class="nl">Design:</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Threat</span><span class="w"> </span><span class="n">modeling</span><span class="w"> </span><span class="n">performed</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Abuse</span><span class="w"> </span><span class="n">cases</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">requirements</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Rate</span><span class="w"> </span><span class="n">limiting</span><span class="p">,</span><span class="w"> </span><span class="n">CAPTCHA</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sensitive</span><span class="w"> </span><span class="n">flows</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="n">reviews</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A05</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="nl">Misconfiguration:</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Hardening</span><span class="w"> </span><span class="n">checklist</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">environment</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Debug</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">OFF</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">production</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">configured</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">credentials</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A06</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vulnerable</span><span class="w"> </span><span class="nl">Components:</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Dependency</span><span class="w"> </span><span class="n">scanning</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">CI</span><span class="o">/</span><span class="n">CD</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Regular</span><span class="w"> </span><span class="n">updates</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">patching</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Components</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">trusted</span><span class="w"> </span><span class="n">sources</span><span class="w"> </span><span class="n">only</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">SBOMs</span><span class="w"> </span><span class="p">(</span><span class="n">Software</span><span class="w"> </span><span class="n">Bill</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Materials</span><span class="p">)</span><span class="w"> </span><span class="n">maintained</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A07</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Authentication</span><span class="w"> </span><span class="nl">Failures:</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">MFA</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="p">(</span><span class="n">especially</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">admin</span><span class="w"> </span><span class="n">accounts</span><span class="p">)</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Account</span><span class="w"> </span><span class="n">lockout</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">attempts</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Session</span><span class="w"> </span><span class="n">regeneration</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">login</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Breached</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">checking</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A08</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Integrity</span><span class="w"> </span><span class="nl">Failures:</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Digital</span><span class="w"> </span><span class="n">signatures</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">updates</span><span class="o">/</span><span class="n">deployments</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">CI</span><span class="o">/</span><span class="n">CD</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="n">secured</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">controls</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">deserialization</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">untrusted</span><span class="w"> </span><span class="n">data</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">SRI</span><span class="w"> </span><span class="p">(</span><span class="n">Subresource</span><span class="w"> </span><span class="n">Integrity</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">scripts</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A09</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Logging</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nl">Monitoring:</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">logged</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">sufficient</span><span class="w"> </span><span class="n">context</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Centralized</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">management</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Alerting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">suspicious</span><span class="w"> </span><span class="n">patterns</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Incident</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="n">plan</span><span class="w"> </span><span class="n">tested</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A10</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nl">SSRF:</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="n">validation</span><span class="w"> </span><span class="p">(</span><span class="n">allowlist</span><span class="w"> </span><span class="n">preferred</span><span class="p">)</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">segmentation</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Disabled</span><span class="w"> </span><span class="n">unnecessary</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="n">schemes</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">IMDSv2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">cloud</span><span class="w"> </span><span class="n">metadata</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="13-exercises">13. Exercises<a class="header-link" href="#13-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-vulnerability-identification">Exercise 1: Vulnerability Identification<a class="header-link" href="#exercise-1-vulnerability-identification" title="Permanent link">&para;</a></h3>
<p>Review the following Flask application and identify which OWASP Top 10 categories apply to each vulnerability:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Exercise: Identify the OWASP Top 10 category for each numbered issue.</span>
<span class="sd">Some lines may have multiple issues.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">send_file</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>                        <span class="c1"># Issue 1: ???</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;development&#39;</span>          <span class="c1"># Issue 2: ???</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/search&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">():</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;app.db&#39;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;SELECT * FROM products WHERE name LIKE &#39;%</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">%&#39;&quot;</span>  <span class="c1"># Issue 3: ???</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/user/&lt;int:user_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>                            <span class="c1"># Issue 4: ???</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/import&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">import_data</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>             <span class="c1"># Issue 5: ???</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;imported&quot;</span><span class="p">})</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/fetch&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>                      <span class="c1"># Issue 6: ???</span>
    <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/config&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>              <span class="c1"># Issue 7: ???</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">password</span><span class="p">:</span>         <span class="c1"># Issue 8: ???</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> not found or wrong password&quot;</span><span class="p">}),</span>  <span class="mi">401</span>  <span class="c1"># Issue 9: ???</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
        <span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>           <span class="c1"># Issue 10: ???</span>
    <span class="p">}),</span> <span class="mi">500</span>
</code></pre></div>

<h3 id="exercise-2-secure-application-design">Exercise 2: Secure Application Design<a class="header-link" href="#exercise-2-secure-application-design" title="Permanent link">&para;</a></h3>
<p>Design and implement security controls for a file-sharing application:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Exercise: Implement security controls for each OWASP Top 10 category.</span>
<span class="sd">The application allows users to upload, share, and download files.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SecureFileSharing</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">upload_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
                    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Secure file upload.</span>
<span class="sd">        Consider: A03 (injection via filename), A04 (file size limits),</span>
<span class="sd">                  A05 (file type validation), A08 (integrity check)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">share_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">target_user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">permissions</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Share a file with another user.</span>
<span class="sd">        Consider: A01 (access control), A04 (sharing limits)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download a file.</span>
<span class="sd">        Consider: A01 (access control), A09 (logging),</span>
<span class="sd">                  A10 (if file references external URL)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_external_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a file from an external URL.</span>
<span class="sd">        Consider: A10 (SSRF), A06 (validate URL library)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div>

<h3 id="exercise-3-security-audit-report">Exercise 3: Security Audit Report<a class="header-link" href="#exercise-3-security-audit-report" title="Permanent link">&para;</a></h3>
<p>Perform a simulated security audit:</p>
<div class="highlight"><pre><span></span><code><span class="n">Exercise</span><span class="p">:</span><span class="w"> </span><span class="n">Given</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">web</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">characteristics</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Python</span><span class="o">/</span><span class="n">Flask</span><span class="w"> </span><span class="n">backend</span>
<span class="o">-</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w"> </span><span class="n">database</span>
<span class="o">-</span><span class="w"> </span><span class="n">JWT</span><span class="w"> </span><span class="n">authentication</span>
<span class="o">-</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">upload</span><span class="w"> </span><span class="n">feature</span>
<span class="o">-</span><span class="w"> </span><span class="n">Webhook</span><span class="w"> </span><span class="n">integration</span><span class="w"> </span><span class="p">(</span><span class="n">fetches</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">URLs</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Uses</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="n">dependencies</span><span class="w"> </span><span class="p">(</span><span class="ow">not</span><span class="w"> </span><span class="n">audited</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">months</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">only</span>
<span class="o">-</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="n">limiting</span>
<span class="o">-</span><span class="w"> </span><span class="n">Running</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">AWS</span><span class="w"> </span><span class="n">EC2</span>

<span class="n">For</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">OWASP</span><span class="w"> </span><span class="n">Top</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">category</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Identify</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">risks</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">application</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Rate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">risk</span><span class="w"> </span><span class="p">(</span><span class="n">Critical</span><span class="o">/</span><span class="n">High</span><span class="o">/</span><span class="n">Medium</span><span class="o">/</span><span class="n">Low</span><span class="p">)</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Propose</span><span class="w"> </span><span class="n">concrete</span><span class="w"> </span><span class="n">remediation</span><span class="w"> </span><span class="n">steps</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Estimate</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">effort</span>

<span class="n">Write</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">findings</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">structured</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">audit</span><span class="w"> </span><span class="n">report</span><span class="o">.</span>
</code></pre></div>

<h3 id="exercise-4-fix-the-vulnerable-application">Exercise 4: Fix the Vulnerable Application<a class="header-link" href="#exercise-4-fix-the-vulnerable-application" title="Permanent link">&para;</a></h3>
<p>Take the code from Exercise 1 and rewrite it with all vulnerabilities fixed. Your fixed version should address every OWASP Top 10 category.</p>
<h3 id="exercise-5-owasp-top-10-mapping">Exercise 5: OWASP Top 10 Mapping<a class="header-link" href="#exercise-5-owasp-top-10-mapping" title="Permanent link">&para;</a></h3>
<p>Map the following real-world breaches to OWASP Top 10 categories:</p>
<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Equifax</span><span class="w"> </span><span class="p">(</span><span class="mf">2017</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Unpatched</span><span class="w"> </span><span class="n">Apache</span><span class="w"> </span><span class="n">Struts</span><span class="w"> </span><span class="n">vulnerability</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">A0</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">___</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Capital</span><span class="w"> </span><span class="kr">On</span><span class="n">e</span><span class="w"> </span><span class="p">(</span><span class="mf">2019</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SSRF</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">AWS</span><span class="w"> </span><span class="n">metadata</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">A0</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">___</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">SolarWinds</span><span class="w"> </span><span class="p">(</span><span class="mf">2020</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Compromised</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">pipeline</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">A0</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">___</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">Facebook</span><span class="w"> </span><span class="p">(</span><span class="mf">2019</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">540</span><span class="n">M</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">unprotected</span><span class="w"> </span><span class="n">S3</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">A0</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">___</span>

<span class="mf">5.</span><span class="w"> </span><span class="n">Uber</span><span class="w"> </span><span class="p">(</span><span class="mf">2016</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Hardcoded</span><span class="w"> </span><span class="n">AWS</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">GitHub</span><span class="w"> </span><span class="n">repo</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">A0</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">___</span>

<span class="mf">6.</span><span class="w"> </span><span class="n">British</span><span class="w"> </span><span class="n">Airways</span><span class="w"> </span><span class="p">(</span><span class="mf">2018</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Magecart</span><span class="w"> </span><span class="n">XSS</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">payment</span><span class="w"> </span><span class="n">page</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">A0</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">___</span>

<span class="mf">7.</span><span class="w"> </span><span class="n">Marriott</span><span class="w"> </span><span class="p">(</span><span class="mf">2018</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Breach</span><span class="w"> </span><span class="n">undetected</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="n">years</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">A0</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">___</span>

<span class="mf">8.</span><span class="w"> </span><span class="n">Yahoo</span><span class="w"> </span><span class="p">(</span><span class="mf">2013</span><span class="o">-</span><span class="mf">2014</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Weak</span><span class="o">/</span><span class="n">no</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="kr">on</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="kd">data</span>
<span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="n">A0</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">___</span>
</code></pre></div>

<hr />
<h2 id="14-summary">14. Summary<a class="header-link" href="#14-summary" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                </span><span class="nv">OWASP</span><span class="w"> </span><span class="nv">Top</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="ss">(</span><span class="mi">2021</span><span class="ss">)</span><span class="w"> </span><span class="nv">Summary</span><span class="w">                       </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span><span class="nv">A01</span>:<span class="w"> </span><span class="nv">Broken</span><span class="w"> </span><span class="nv">Access</span><span class="w"> </span><span class="nv">Control</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">#1</span><span class="w"> </span><span class="nv">threat</span>.<span class="w"> </span><span class="nv">Default</span><span class="o">-</span><span class="nv">deny</span>.<span class="w">          </span>â”‚
â”‚<span class="w">  </span><span class="nv">A02</span>:<span class="w"> </span><span class="nv">Cryptographic</span><span class="w"> </span><span class="nv">Failures</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Encrypt</span><span class="w"> </span><span class="nv">everything</span><span class="w"> </span><span class="nv">sensitive</span>.<span class="w">    </span>â”‚
â”‚<span class="w">  </span><span class="nv">A03</span>:<span class="w"> </span><span class="nv">Injection</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Parameterize</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">queries</span>.<span class="w">                     </span>â”‚
â”‚<span class="w">  </span><span class="nv">A04</span>:<span class="w"> </span><span class="nv">Insecure</span><span class="w"> </span><span class="nv">Design</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Security</span><span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">design</span>,<span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">code</span>.<span class="w">   </span>â”‚
â”‚<span class="w">  </span><span class="nv">A05</span>:<span class="w"> </span><span class="nv">Security</span><span class="w"> </span><span class="nv">Misconfiguration</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Harden</span><span class="w"> </span><span class="nv">everything</span>.<span class="w">            </span>â”‚
â”‚<span class="w">  </span><span class="nv">A06</span>:<span class="w"> </span><span class="nv">Vulnerable</span><span class="w"> </span><span class="nv">Components</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Know</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">deps</span>.<span class="w">        </span>â”‚
â”‚<span class="w">  </span><span class="nv">A07</span>:<span class="w"> </span><span class="nv">Auth</span><span class="w"> </span><span class="nv">Failures</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">MFA</span>,<span class="w"> </span><span class="nv">rate</span><span class="w"> </span><span class="nv">limiting</span>,<span class="w"> </span><span class="nv">strong</span><span class="w"> </span><span class="nv">passwords</span>.<span class="w">     </span>â”‚
â”‚<span class="w">  </span><span class="nv">A08</span>:<span class="w"> </span><span class="nv">Integrity</span><span class="w"> </span><span class="nv">Failures</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Sign</span><span class="w"> </span><span class="nv">everything</span>,<span class="w"> </span><span class="nv">don</span><span class="err">&#39;t pickle.       â”‚</span>
<span class="err">â”‚  A09: Logging Failures - Log security events, alert, respond.   â”‚</span>
<span class="err">â”‚  A10: SSRF - Validate all URLs, segment networks.               â”‚</span>
<span class="err">â”‚                                                                  â”‚</span>
<span class="err">â”‚  The OWASP Top 10 is a starting point, not an exhaustive list.  â”‚</span>
<span class="err">â”‚  Use it as a minimum baseline for application security.          â”‚</span>
<span class="err">â”‚                                                                  â”‚</span>
<span class="err">â”‚  Resources:                                                      â”‚</span>
<span class="err">â”‚  - https://owasp.org/Top10/                                     â”‚</span>
<span class="err">â”‚  - OWASP Application Security Verification Standard (ASVS)     â”‚</span>
<span class="err">â”‚  - OWASP Testing Guide                                          â”‚</span>
<span class="err">â”‚  - OWASP Cheat Sheet Series                                     â”‚</span>
<span class="err">â”‚                                                                  â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<p><strong>Previous</strong>: <a href="06_Authorization.md">06. Authorization and Access Control</a> | <strong>Next</strong>: <a href="08_Injection_Attacks.md">08. Injection Attacks and Prevention</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/06_Authorization.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">06. Authorization and Access Control</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Security/08_Injection_Attacks.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">08. Injection Attacks and Prevention</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}