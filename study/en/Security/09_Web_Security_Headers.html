{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Security Headers and CSP - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">Web Security Headers and CSP</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Web Security Headers and CSP</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/08_Injection_Attacks.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">08. Injection Attacks and Prevention</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Security/10_API_Security.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">API Security</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-security-headers-overview">1. Security Headers Overview</a><ul>
<li><a href="#11-why-security-headers-matter">1.1 Why Security Headers Matter</a></li>
<li><a href="#12-defense-in-depth">1.2 Defense in Depth</a></li>
<li><a href="#13-quick-reference-table">1.3 Quick Reference Table</a></li>
</ul>
</li>
<li><a href="#2-content-security-policy-csp">2. Content-Security-Policy (CSP)</a><ul>
<li><a href="#21-what-is-csp">2.1 What is CSP?</a></li>
<li><a href="#22-csp-directives">2.2 CSP Directives</a></li>
<li><a href="#23-source-values">2.3 Source Values</a></li>
<li><a href="#24-building-a-csp-policy-step-by-step">2.4 Building a CSP Policy Step by Step</a></li>
<li><a href="#25-csp-reporting">2.5 CSP Reporting</a></li>
<li><a href="#26-common-csp-mistakes">2.6 Common CSP Mistakes</a></li>
</ul>
</li>
<li><a href="#3-strict-transport-security-hsts">3. Strict-Transport-Security (HSTS)</a><ul>
<li><a href="#31-how-hsts-works">3.1 How HSTS Works</a></li>
<li><a href="#32-hsts-directives">3.2 HSTS Directives</a></li>
</ul>
</li>
<li><a href="#4-x-content-type-options">4. X-Content-Type-Options</a><ul>
<li><a href="#41-mime-sniffing-attack">4.1 MIME Sniffing Attack</a></li>
<li><a href="#42-configuration">4.2 Configuration</a></li>
</ul>
</li>
<li><a href="#5-x-frame-options-and-frame-ancestors">5. X-Frame-Options and frame-ancestors</a><ul>
<li><a href="#51-clickjacking-prevention">5.1 Clickjacking Prevention</a></li>
<li><a href="#52-x-frame-options-values">5.2 X-Frame-Options Values</a></li>
<li><a href="#53-csp-frame-ancestors-modern-replacement">5.3 CSP frame-ancestors (Modern Replacement)</a></li>
</ul>
</li>
<li><a href="#6-referrer-policy">6. Referrer-Policy</a><ul>
<li><a href="#61-referrer-information-leakage">6.1 Referrer Information Leakage</a></li>
<li><a href="#62-policy-values">6.2 Policy Values</a></li>
</ul>
</li>
<li><a href="#7-permissions-policy">7. Permissions-Policy</a><ul>
<li><a href="#71-restricting-browser-features">7.1 Restricting Browser Features</a></li>
<li><a href="#72-configuration-examples">7.2 Configuration Examples</a></li>
</ul>
</li>
<li><a href="#8-cross-origin-policies-corp-coep-coop">8. Cross-Origin Policies (CORP, COEP, COOP)</a><ul>
<li><a href="#81-overview">8.1 Overview</a></li>
<li><a href="#82-cross-origin-resource-policy-corp">8.2 Cross-Origin-Resource-Policy (CORP)</a></li>
<li><a href="#83-cross-origin-embedder-policy-coep">8.3 Cross-Origin-Embedder-Policy (COEP)</a></li>
<li><a href="#84-cross-origin-opener-policy-coop">8.4 Cross-Origin-Opener-Policy (COOP)</a></li>
</ul>
</li>
<li><a href="#9-subresource-integrity-sri">9. Subresource Integrity (SRI)</a><ul>
<li><a href="#91-how-sri-works">9.1 How SRI Works</a></li>
<li><a href="#92-generating-sri-hashes">9.2 Generating SRI Hashes</a></li>
</ul>
</li>
<li><a href="#10-flask-security-headers-configuration">10. Flask Security Headers Configuration</a><ul>
<li><a href="#101-manual-header-setting">10.1 Manual Header Setting</a></li>
<li><a href="#102-per-route-header-overrides">10.2 Per-Route Header Overrides</a></li>
</ul>
</li>
<li><a href="#11-django-security-headers-configuration">11. Django Security Headers Configuration</a><ul>
<li><a href="#111-django-settings">11.1 Django Settings</a></li>
<li><a href="#112-django-csp-with-django-csp">11.2 Django CSP with django-csp</a></li>
</ul>
</li>
<li><a href="#12-testing-security-headers">12. Testing Security Headers</a><ul>
<li><a href="#121-testing-with-curl">12.1 Testing with curl</a></li>
<li><a href="#122-python-security-header-scanner">12.2 Python Security Header Scanner</a></li>
<li><a href="#123-online-scanners">12.3 Online Scanners</a></li>
</ul>
</li>
<li><a href="#13-complete-security-headers-template">13. Complete Security Headers Template</a><ul>
<li><a href="#131-nginx-configuration">13.1 Nginx Configuration</a></li>
<li><a href="#132-apache-configuration">13.2 Apache Configuration</a></li>
</ul>
</li>
<li><a href="#14-exercises">14. Exercises</a><ul>
<li><a href="#exercise-1-csp-policy-analysis">Exercise 1: CSP Policy Analysis</a></li>
<li><a href="#exercise-2-flask-security-headers-middleware">Exercise 2: Flask Security Headers Middleware</a></li>
<li><a href="#exercise-3-header-scanner-enhancement">Exercise 3: Header Scanner Enhancement</a></li>
<li><a href="#exercise-4-sri-hash-generator">Exercise 4: SRI Hash Generator</a></li>
<li><a href="#exercise-5-hsts-preload-readiness-check">Exercise 5: HSTS Preload Readiness Check</a></li>
<li><a href="#exercise-6-cross-origin-isolation-audit">Exercise 6: Cross-Origin Isolation Audit</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a><ul>
<li><a href="#key-takeaways">Key Takeaways</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="web-security-headers-and-csp">Web Security Headers and CSP<a class="header-link" href="#web-security-headers-and-csp" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./08_Injection_Attacks.md">08. Injection Attacks and Prevention</a> | <strong>Next</strong>: <a href="./10_API_Security.md">10_API_Security.md</a></p>
<hr />
<p>HTTP security headers are the first line of defense for web applications. They instruct browsers to enforce security policies that mitigate entire classes of attacks â€” from cross-site scripting and clickjacking to protocol downgrade attacks and data exfiltration. A single missing header can leave an otherwise well-coded application vulnerable. This lesson provides a comprehensive guide to every major security header, with practical configuration examples for Flask and Django.</p>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand the purpose and directives of Content-Security-Policy (CSP)</li>
<li>Configure HSTS to enforce HTTPS connections</li>
<li>Apply X-Content-Type-Options, X-Frame-Options, and Referrer-Policy headers</li>
<li>Implement Permissions-Policy to restrict browser features</li>
<li>Configure Cross-Origin policies (CORP, COEP, COOP)</li>
<li>Use Subresource Integrity (SRI) to verify external resources</li>
<li>Set up security headers in Flask and Django applications</li>
<li>Test and audit headers using command-line tools and scanners</li>
</ul>
<hr />
<h2 id="1-security-headers-overview">1. Security Headers Overview<a class="header-link" href="#1-security-headers-overview" title="Permanent link">&para;</a></h2>
<h3 id="11-why-security-headers-matter">1.1 Why Security Headers Matter<a class="header-link" href="#11-why-security-headers-matter" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="nx">HTTP</span><span class="w"> </span><span class="nx">Response</span><span class="w"> </span><span class="nx">Security</span><span class="w"> </span><span class="nx">Headers</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Server</span><span class="w"> </span><span class="err">â”€â”€â”€â”€</span><span class="w"> </span><span class="nx">HTTP</span><span class="w"> </span><span class="nx">Response</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â–¶</span><span class="w"> </span><span class="nx">Browser</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">Content</span><span class="o">-</span><span class="nx">Security</span><span class="o">-</span><span class="nx">Policy</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">Strict</span><span class="o">-</span><span class="nx">Transport</span><span class="o">-</span><span class="nx">Security</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">X</span><span class="o">-</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">-</span><span class="nx">Options</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">X</span><span class="o">-</span><span class="nx">Frame</span><span class="o">-</span><span class="nx">Options</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">Referrer</span><span class="o">-</span><span class="nx">Policy</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">Permissions</span><span class="o">-</span><span class="nx">Policy</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">Cross</span><span class="o">-</span><span class="nx">Origin</span><span class="o">-</span><span class="nx">Resource</span><span class="o">-</span><span class="nx">Policy</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="nx">Cross</span><span class="o">-</span><span class="nx">Origin</span><span class="o">-</span><span class="nx">Embedder</span><span class="o">-</span><span class="nx">Policy</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="nx">Cross</span><span class="o">-</span><span class="nx">Origin</span><span class="o">-</span><span class="nx">Opener</span><span class="o">-</span><span class="nx">Policy</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">These</span><span class="w"> </span><span class="nx">headers</span><span class="w"> </span><span class="nx">instruct</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="nx">to</span><span class="p">:</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">Block</span><span class="w"> </span><span class="nx">inline</span><span class="w"> </span><span class="nx">scripts</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">unauthorized</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">(</span><span class="nx">CSP</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">Always</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">HTTPS</span><span class="w"> </span><span class="p">(</span><span class="nx">HSTS</span><span class="p">)</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">Prevent</span><span class="w"> </span><span class="nx">MIME</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">sniffing</span><span class="w"> </span><span class="p">(</span><span class="nx">X</span><span class="o">-</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">-</span><span class="nx">Options</span><span class="p">)</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">Block</span><span class="w"> </span><span class="nx">framing</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">clickjacking</span><span class="w"> </span><span class="p">(</span><span class="nx">X</span><span class="o">-</span><span class="nx">Frame</span><span class="o">-</span><span class="nx">Options</span><span class="p">)</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">Control</span><span class="w"> </span><span class="nx">referrer</span><span class="w"> </span><span class="nx">information</span><span class="w"> </span><span class="nx">leakage</span><span class="w"> </span><span class="p">(</span><span class="nx">Referrer</span><span class="o">-</span><span class="nx">Policy</span><span class="p">)</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">Restrict</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">browser</span><span class="w"> </span><span class="nx">APIs</span><span class="w"> </span><span class="p">(</span><span class="nx">Permissions</span><span class="o">-</span><span class="nx">Policy</span><span class="p">)</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â€¢</span><span class="w"> </span><span class="nx">Isolate</span><span class="w"> </span><span class="nx">cross</span><span class="o">-</span><span class="nx">origin</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">(</span><span class="nx">CORP</span><span class="o">/</span><span class="nx">COEP</span><span class="o">/</span><span class="nx">COOP</span><span class="p">)</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="12-defense-in-depth">1.2 Defense in Depth<a class="header-link" href="#12-defense-in-depth" title="Permanent link">&para;</a></h3>
<p>Security headers are not a replacement for secure coding practices â€” they are an additional layer. Even with a perfectly coded application, security headers provide protection against:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Defense in Depth Layers                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Layer 5:  Security Headers          (browser-enforced policies)     â”‚
â”‚  Layer 4:  Application Logic         (input validation, auth)        â”‚
â”‚  Layer 3:  Framework Protections     (CSRF tokens, ORM)              â”‚
â”‚  Layer 2:  Network Security          (TLS, firewalls, WAF)           â”‚
â”‚  Layer 1:  Infrastructure            (OS hardening, patching)        â”‚
â”‚                                                                      â”‚
â”‚  Each layer catches what the layer below might miss.                 â”‚
â”‚  Security headers catch what application code might miss.            â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="13-quick-reference-table">1.3 Quick Reference Table<a class="header-link" href="#13-quick-reference-table" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Header</th>
<th>Mitigates</th>
<th>Typical Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Security-Policy</td>
<td>XSS, data injection</td>
<td><code>default-src 'self'</code></td>
</tr>
<tr>
<td>Strict-Transport-Security</td>
<td>Protocol downgrade, cookie hijacking</td>
<td><code>max-age=31536000; includeSubDomains</code></td>
</tr>
<tr>
<td>X-Content-Type-Options</td>
<td>MIME-type confusion</td>
<td><code>nosniff</code></td>
</tr>
<tr>
<td>X-Frame-Options</td>
<td>Clickjacking</td>
<td><code>DENY</code></td>
</tr>
<tr>
<td>Referrer-Policy</td>
<td>Information leakage</td>
<td><code>strict-origin-when-cross-origin</code></td>
</tr>
<tr>
<td>Permissions-Policy</td>
<td>Unauthorized API access</td>
<td><code>camera=(), microphone=()</code></td>
</tr>
<tr>
<td>Cross-Origin-Resource-Policy</td>
<td>Cross-origin data leaks</td>
<td><code>same-origin</code></td>
</tr>
<tr>
<td>Cross-Origin-Embedder-Policy</td>
<td>Spectre-style attacks</td>
<td><code>require-corp</code></td>
</tr>
<tr>
<td>Cross-Origin-Opener-Policy</td>
<td>Cross-window attacks</td>
<td><code>same-origin</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-content-security-policy-csp">2. Content-Security-Policy (CSP)<a class="header-link" href="#2-content-security-policy-csp" title="Permanent link">&para;</a></h2>
<h3 id="21-what-is-csp">2.1 What is CSP?<a class="header-link" href="#21-what-is-csp" title="Permanent link">&para;</a></h3>
<p>Content-Security-Policy is arguably the most powerful security header. It defines an allowlist of content sources that the browser should trust, effectively preventing XSS attacks by blocking unauthorized script execution.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span>CSP<span class="w"> </span>Enforcement<span class="w"> </span>Model<span class="w">                             </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                      </span>â”‚
â”‚<span class="w">  </span>Browser<span class="w"> </span>receives<span class="w"> </span>CSP<span class="w"> </span>header:<span class="w">                                        </span>â”‚
â”‚<span class="w">    </span>Content-Security-Policy:<span class="w"> </span>default-src<span class="w"> </span>&#39;self&#39;;<span class="w"> </span>script-src<span class="w"> </span>&#39;self&#39;<span class="w">    </span>â”‚
â”‚<span class="w">                                                                      </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="w">      </span><span class="s">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="err">&lt;script</span><span class="nt">&gt;</span><span class="w">          </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>&quot;/app.js&quot;&gt;<span class="w">       </span>â”‚<span class="w">     </span>â”‚<span class="w">  </span>alert(&#39;XSS&#39;)<span class="w">     </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                   </span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nt">&lt;/script&gt;</span><span class="w">          </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>Source:<span class="w"> </span>self<span class="w">      </span>â”‚<span class="w">     </span>â”‚<span class="w">  </span>Source:<span class="w"> </span>inline<span class="w">    </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>âœ“<span class="w"> </span>ALLOWED<span class="w">        </span>â”‚<span class="w">     </span>â”‚<span class="w">  </span>âœ—<span class="w"> </span>BLOCKED<span class="w">         </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                       </span>â”‚
â”‚<span class="w">                                                                      </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="w">      </span><span class="s">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="err">&lt;img</span><span class="w"> </span><span class="na">src=</span><span class="w">          </span><span class="s">â”‚</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">&quot;https://cdn</span><span class="w">     </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="err">&quot;/logo.png&quot;</span><span class="nt">&gt;</span><span class="w">      </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>.example.com<span class="w">     </span>â”‚<span class="w">     </span>â”‚<span class="w">                    </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>/lib.js&quot;&gt;<span class="w">        </span>â”‚<span class="w">     </span>â”‚<span class="w">  </span>Source:<span class="w"> </span>self<span class="w">       </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>Source:<span class="w"> </span>cdn<span class="w">       </span>â”‚<span class="w">     </span>â”‚<span class="w">  </span>âœ“<span class="w"> </span>ALLOWED<span class="w">         </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>âœ—<span class="w"> </span>BLOCKED<span class="w">        </span>â”‚<span class="w">     </span>â”‚<span class="w">                    </span>â”‚<span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                       </span>â”‚
â”‚<span class="w">                                                                      </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="22-csp-directives">2.2 CSP Directives<a class="header-link" href="#22-csp-directives" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">CSP</span><span class="w"> </span><span class="n">Directive</span><span class="w"> </span><span class="n">Categories</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Fetch</span><span class="w"> </span><span class="n">Directives</span><span class="w"> </span><span class="p">(</span><span class="n">control</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">resources</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">from</span><span class="p">):</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">default</span><span class="o">-</span><span class="n">src</span><span class="w">     </span><span class="n">Fallback</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">fetch</span><span class="w"> </span><span class="n">directives</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">script</span><span class="o">-</span><span class="n">src</span><span class="w">      </span><span class="n">JavaScript</span><span class="w"> </span><span class="n">sources</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">style</span><span class="o">-</span><span class="n">src</span><span class="w">       </span><span class="n">CSS</span><span class="w"> </span><span class="n">sources</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">img</span><span class="o">-</span><span class="n">src</span><span class="w">         </span><span class="n">Image</span><span class="w"> </span><span class="n">sources</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">font</span><span class="o">-</span><span class="n">src</span><span class="w">        </span><span class="n">Web</span><span class="w"> </span><span class="n">font</span><span class="w"> </span><span class="n">sources</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">connect</span><span class="o">-</span><span class="n">src</span><span class="w">     </span><span class="n">XHR</span><span class="p">,</span><span class="w"> </span><span class="n">fetch</span><span class="p">,</span><span class="w"> </span><span class="n">WebSocket</span><span class="p">,</span><span class="w"> </span><span class="n">EventSource</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">media</span><span class="o">-</span><span class="n">src</span><span class="w">       </span><span class="n">Audio</span><span class="o">/</span><span class="n">video</span><span class="w"> </span><span class="n">sources</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">object</span><span class="o">-</span><span class="n">src</span><span class="w">      </span><span class="o">&lt;</span><span class="n">object</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">embed</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">applet</span><span class="o">&gt;</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">child</span><span class="o">-</span><span class="n">src</span><span class="w">       </span><span class="n">Web</span><span class="w"> </span><span class="n">workers</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">nested</span><span class="w"> </span><span class="n">contexts</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">worker</span><span class="o">-</span><span class="n">src</span><span class="w">      </span><span class="n">Worker</span><span class="p">,</span><span class="w"> </span><span class="n">SharedWorker</span><span class="p">,</span><span class="w"> </span><span class="n">ServiceWorker</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">manifest</span><span class="o">-</span><span class="n">src</span><span class="w">    </span><span class="n">App</span><span class="w"> </span><span class="n">manifest</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Document</span><span class="w"> </span><span class="n">Directives</span><span class="p">:</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">base</span><span class="o">-</span><span class="n">uri</span><span class="w">        </span><span class="n">Restrict</span><span class="w"> </span><span class="o">&lt;</span><span class="n">base</span><span class="o">&gt;</span><span class="w"> </span><span class="n">element</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">sandbox</span><span class="w">         </span><span class="n">Apply</span><span class="w"> </span><span class="n">sandbox</span><span class="w"> </span><span class="n">restrictions</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">plugin</span><span class="o">-</span><span class="n">types</span><span class="w">    </span><span class="n">Restrict</span><span class="w"> </span><span class="n">plugin</span><span class="w"> </span><span class="n">MIME</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="p">(</span><span class="n">deprecated</span><span class="p">)</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Navigation</span><span class="w"> </span><span class="n">Directives</span><span class="p">:</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">form</span><span class="o">-</span><span class="n">action</span><span class="w">     </span><span class="n">Restrict</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">submission</span><span class="w"> </span><span class="n">targets</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">frame</span><span class="o">-</span><span class="n">ancestors</span><span class="w"> </span><span class="n">Restrict</span><span class="w"> </span><span class="n">who</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">embed</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">page</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">navigate</span><span class="o">-</span><span class="n">to</span><span class="w">     </span><span class="n">Restrict</span><span class="w"> </span><span class="n">navigation</span><span class="w"> </span><span class="n">targets</span><span class="w"> </span><span class="p">(</span><span class="n">limited</span><span class="w"> </span><span class="n">support</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Reporting</span><span class="w"> </span><span class="n">Directives</span><span class="p">:</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">report</span><span class="o">-</span><span class="n">uri</span><span class="w">      </span><span class="n">Send</span><span class="w"> </span><span class="n">violation</span><span class="w"> </span><span class="n">reports</span><span class="w"> </span><span class="p">(</span><span class="n">deprecated</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">report</span><span class="o">-</span><span class="n">to</span><span class="w">       </span><span class="n">Send</span><span class="w"> </span><span class="n">violation</span><span class="w"> </span><span class="n">reports</span><span class="w"> </span><span class="p">(</span><span class="n">modern</span><span class="p">)</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="23-source-values">2.3 Source Values<a class="header-link" href="#23-source-values" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Source</th>
<th>Meaning</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'self'</code></td>
<td>Same origin (scheme + host + port)</td>
<td><code>script-src 'self'</code></td>
</tr>
<tr>
<td><code>'none'</code></td>
<td>Block all sources</td>
<td><code>object-src 'none'</code></td>
</tr>
<tr>
<td><code>'unsafe-inline'</code></td>
<td>Allow inline scripts/styles</td>
<td><code>style-src 'unsafe-inline'</code></td>
</tr>
<tr>
<td><code>'unsafe-eval'</code></td>
<td>Allow eval(), Function(), etc.</td>
<td><code>script-src 'unsafe-eval'</code></td>
</tr>
<tr>
<td><code>'strict-dynamic'</code></td>
<td>Trust scripts loaded by trusted scripts</td>
<td><code>script-src 'strict-dynamic'</code></td>
</tr>
<tr>
<td><code>'nonce-&lt;base64&gt;'</code></td>
<td>Allow specific inline by nonce</td>
<td><code>script-src 'nonce-abc123'</code></td>
</tr>
<tr>
<td><code>'sha256-&lt;hash&gt;'</code></td>
<td>Allow specific inline by hash</td>
<td><code>script-src 'sha256-...'</code></td>
</tr>
<tr>
<td><code>https:</code></td>
<td>Any HTTPS source</td>
<td><code>img-src https:</code></td>
</tr>
<tr>
<td><code>data:</code></td>
<td>Data URIs</td>
<td><code>img-src data:</code></td>
</tr>
<tr>
<td><code>blob:</code></td>
<td>Blob URIs</td>
<td><code>worker-src blob:</code></td>
</tr>
<tr>
<td><code>*.example.com</code></td>
<td>Wildcard subdomain</td>
<td><code>script-src *.cdn.com</code></td>
</tr>
</tbody>
</table>
<h3 id="24-building-a-csp-policy-step-by-step">2.4 Building a CSP Policy Step by Step<a class="header-link" href="#24-building-a-csp-policy-step-by-step" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Building CSP policies progressively â€” from permissive to strict.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ Level 1: Basic CSP (blocks obvious XSS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Start with default-src &#39;self&#39; and loosen as needed</span>
<span class="n">csp_level1</span> <span class="o">=</span> <span class="s2">&quot;default-src &#39;self&#39;&quot;</span>

<span class="c1"># â”€â”€ Level 2: Allow specific external resources â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">csp_level2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>
    <span class="s2">&quot;script-src &#39;self&#39; https://cdn.jsdelivr.net; &quot;</span>
    <span class="s2">&quot;style-src &#39;self&#39; https://fonts.googleapis.com; &quot;</span>
    <span class="s2">&quot;font-src &#39;self&#39; https://fonts.gstatic.com; &quot;</span>
    <span class="s2">&quot;img-src &#39;self&#39; data: https:; &quot;</span>
    <span class="s2">&quot;connect-src &#39;self&#39; https://api.example.com; &quot;</span>
    <span class="s2">&quot;object-src &#39;none&#39;; &quot;</span>
    <span class="s2">&quot;base-uri &#39;self&#39;; &quot;</span>
    <span class="s2">&quot;form-action &#39;self&#39;&quot;</span>
<span class="p">)</span>

<span class="c1"># â”€â”€ Level 3: Nonce-based CSP (recommended for modern apps) â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Server generates a random nonce per request</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_csp_with_nonce</span><span class="p">():</span>
    <span class="n">nonce</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">csp</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;script-src &#39;self&#39; &#39;nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;style-src &#39;self&#39; &#39;nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;img-src &#39;self&#39; data:; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;font-src &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;connect-src &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;object-src &#39;none&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;base-uri &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;form-action &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;frame-ancestors &#39;none&#39;&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">csp</span><span class="p">,</span> <span class="n">nonce</span>

<span class="n">csp_header</span><span class="p">,</span> <span class="n">nonce</span> <span class="o">=</span> <span class="n">generate_csp_with_nonce</span><span class="p">()</span>
<span class="c1"># In HTML: &lt;script nonce=&quot;&lt;nonce&gt;&quot;&gt;...&lt;/script&gt;</span>

<span class="c1"># â”€â”€ Level 4: Hash-based CSP (for static inline scripts) â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_csp_hash</span><span class="p">(</span><span class="n">script_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute SHA-256 hash for CSP inline script allowlisting.&quot;&quot;&quot;</span>
    <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">script_content</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="n">b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&#39;sha256-</span><span class="si">{</span><span class="n">b64</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

<span class="n">inline_script</span> <span class="o">=</span> <span class="s2">&quot;console.log(&#39;Hello, World!&#39;);&quot;</span>
<span class="n">script_hash</span> <span class="o">=</span> <span class="n">compute_csp_hash</span><span class="p">(</span><span class="n">inline_script</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CSP hash: </span><span class="si">{</span><span class="n">script_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Output: CSP hash: &#39;sha256-TWupyvVdPa1DyFqLnQMqRpuUWdS3nKPnz70IcS/1o3Q=&#39;</span>

<span class="n">csp_level4</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;script-src &#39;self&#39; </span><span class="si">{</span><span class="n">script_hash</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># â”€â”€ Level 5: strict-dynamic (for apps that load scripts dynamically)</span>
<span class="n">csp_level5</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;script-src &#39;strict-dynamic&#39; &#39;nonce-</span><span class="si">{nonce}</span><span class="s2">&#39;; &quot;</span>
    <span class="s2">&quot;object-src &#39;none&#39;; &quot;</span>
    <span class="s2">&quot;base-uri &#39;self&#39;&quot;</span>
<span class="p">)</span>
<span class="c1"># With strict-dynamic, scripts loaded by a nonced script</span>
<span class="c1"># are automatically trusted, regardless of their origin.</span>
</code></pre></div>

<h3 id="25-csp-reporting">2.5 CSP Reporting<a class="header-link" href="#25-csp-reporting" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CSP violation reporting â€” detect policy violations without blocking.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ Report-Only mode (monitor without enforcement) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Use Content-Security-Policy-Report-Only header first</span>
<span class="n">csp_report_only</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>
    <span class="s2">&quot;script-src &#39;self&#39;; &quot;</span>
    <span class="s2">&quot;report-uri /csp-report; &quot;</span>
    <span class="s2">&quot;report-to csp-endpoint&quot;</span>
<span class="p">)</span>

<span class="c1"># The Report-To header (companion for report-to directive)</span>
<span class="n">report_to</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;csp-endpoint&quot;</span><span class="p">,</span>
    <span class="s2">&quot;max_age&quot;</span><span class="p">:</span> <span class="mi">86400</span><span class="p">,</span>
    <span class="s2">&quot;endpoints&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com/csp-report&quot;</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># â”€â”€ Flask endpoint to receive CSP violation reports â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;csp_reports&#39;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/csp-report&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">csp_report</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Receive and log CSP violation reports.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># CSP reports come as application/csp-report</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">violation</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;csp-report&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;CSP Violation: blocked_uri=</span><span class="si">%s</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;violated_directive=</span><span class="si">%s</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;document_uri=</span><span class="si">%s</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;source_file=</span><span class="si">%s</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;line_number=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">violation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blocked-uri&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">),</span>
            <span class="n">violation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;violated-directive&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">),</span>
            <span class="n">violation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;document-uri&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">),</span>
            <span class="n">violation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source-file&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">),</span>
            <span class="n">violation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line-number&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;received&quot;</span><span class="p">}),</span> <span class="mi">204</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing CSP report: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;invalid report&quot;</span><span class="p">}),</span> <span class="mi">400</span>

<span class="c1"># â”€â”€ Example CSP violation report JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">example_report</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;csp-report&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;document-uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com/page&quot;</span><span class="p">,</span>
        <span class="s2">&quot;referrer&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;violated-directive&quot;</span><span class="p">:</span> <span class="s2">&quot;script-src &#39;self&#39;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;effective-directive&quot;</span><span class="p">:</span> <span class="s2">&quot;script-src&quot;</span><span class="p">,</span>
        <span class="s2">&quot;original-policy&quot;</span><span class="p">:</span> <span class="s2">&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blocked-uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://evil.com/malicious.js&quot;</span><span class="p">,</span>
        <span class="s2">&quot;status-code&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;source-file&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com/page&quot;</span><span class="p">,</span>
        <span class="s2">&quot;line-number&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="s2">&quot;column-number&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="26-common-csp-mistakes">2.6 Common CSP Mistakes<a class="header-link" href="#26-common-csp-mistakes" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Common CSP mistakes and how to fix them.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ MISTAKE 1: Using &#39;unsafe-inline&#39; with script-src â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># This defeats the purpose of CSP for XSS prevention</span>
<span class="n">bad_csp</span> <span class="o">=</span> <span class="s2">&quot;script-src &#39;self&#39; &#39;unsafe-inline&#39;&quot;</span>
<span class="c1"># FIX: Use nonces or hashes instead</span>
<span class="n">good_csp</span> <span class="o">=</span> <span class="s2">&quot;script-src &#39;self&#39; &#39;nonce-</span><span class="si">{random}</span><span class="s2">&#39;&quot;</span>

<span class="c1"># â”€â”€ MISTAKE 2: Wildcard in script-src â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Allows loading scripts from any subdomain</span>
<span class="n">bad_csp</span> <span class="o">=</span> <span class="s2">&quot;script-src &#39;self&#39; *.googleapis.com&quot;</span>
<span class="c1"># FIX: Use specific hostnames</span>
<span class="n">good_csp</span> <span class="o">=</span> <span class="s2">&quot;script-src &#39;self&#39; https://ajax.googleapis.com&quot;</span>

<span class="c1"># â”€â”€ MISTAKE 3: Missing default-src â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Without default-src, unlisted directives default to allow-all</span>
<span class="n">bad_csp</span> <span class="o">=</span> <span class="s2">&quot;script-src &#39;self&#39;&quot;</span>
<span class="c1"># FIX: Always include default-src as fallback</span>
<span class="n">good_csp</span> <span class="o">=</span> <span class="s2">&quot;default-src &#39;none&#39;; script-src &#39;self&#39;; style-src &#39;self&#39;; img-src &#39;self&#39;&quot;</span>

<span class="c1"># â”€â”€ MISTAKE 4: Allowing data: in script-src â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># data: URIs can contain executable JavaScript</span>
<span class="n">bad_csp</span> <span class="o">=</span> <span class="s2">&quot;script-src &#39;self&#39; data:&quot;</span>
<span class="c1"># FIX: Only use data: for images/fonts where needed</span>
<span class="n">good_csp</span> <span class="o">=</span> <span class="s2">&quot;script-src &#39;self&#39;; img-src &#39;self&#39; data:&quot;</span>

<span class="c1"># â”€â”€ MISTAKE 5: Forgetting object-src â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Flash and Java applets can execute scripts</span>
<span class="n">bad_csp</span> <span class="o">=</span> <span class="s2">&quot;default-src &#39;self&#39;&quot;</span>  <span class="c1"># object-src falls back to &#39;self&#39;</span>
<span class="c1"># FIX: Explicitly block object-src</span>
<span class="n">good_csp</span> <span class="o">=</span> <span class="s2">&quot;default-src &#39;self&#39;; object-src &#39;none&#39;&quot;</span>

<span class="c1"># â”€â”€ MISTAKE 6: Overly permissive connect-src â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Allows data exfiltration to any HTTPS endpoint</span>
<span class="n">bad_csp</span> <span class="o">=</span> <span class="s2">&quot;connect-src https:&quot;</span>
<span class="c1"># FIX: List specific API endpoints</span>
<span class="n">good_csp</span> <span class="o">=</span> <span class="s2">&quot;connect-src &#39;self&#39; https://api.example.com&quot;</span>
</code></pre></div>

<hr />
<h2 id="3-strict-transport-security-hsts">3. Strict-Transport-Security (HSTS)<a class="header-link" href="#3-strict-transport-security-hsts" title="Permanent link">&para;</a></h2>
<h3 id="31-how-hsts-works">3.1 How HSTS Works<a class="header-link" href="#31-how-hsts-works" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">HSTS</span><span class="w"> </span><span class="nv">Protection</span><span class="w"> </span><span class="nv">Flow</span><span class="w">                               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                      </span>â”‚
â”‚<span class="w">  </span><span class="nv">WITHOUT</span><span class="w"> </span><span class="nv">HSTS</span>:<span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span><span class="nv">User</span><span class="w"> </span>â”€â”€<span class="nv">http</span>:<span class="o">//</span>â”€â”€â–¶<span class="w"> </span><span class="nv">Server</span><span class="w"> </span>â”€â”€<span class="mi">301</span><span class="w"> </span><span class="nv">Redirect</span>â”€â”€â–¶<span class="w"> </span><span class="nv">https</span>:<span class="o">//</span><span class="w">                </span>â”‚
â”‚<span class="w">        </span>â†‘<span class="w">                                                             </span>â”‚
â”‚<span class="w">        </span>â””â”€â”€<span class="w"> </span><span class="nv">MITM</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">intercept</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">plain</span><span class="w"> </span><span class="nv">HTTP</span><span class="w"> </span><span class="nv">request</span><span class="w">                </span>â”‚
â”‚<span class="w">                                                                      </span>â”‚
â”‚<span class="w">  </span><span class="nv">WITH</span><span class="w"> </span><span class="nv">HSTS</span>:<span class="w">                                                          </span>â”‚
â”‚<span class="w">  </span><span class="nv">User</span><span class="w"> </span>â”€â”€<span class="nv">http</span>:<span class="o">//</span>â”€â”€â–¶<span class="w"> </span><span class="nv">Browser</span><span class="w"> </span><span class="nv">intercepts</span><span class="w"> </span><span class="ss">(</span><span class="mi">307</span><span class="w"> </span><span class="nv">Internal</span><span class="w"> </span><span class="nv">Redirect</span><span class="ss">)</span><span class="w">        </span>â”‚
â”‚<span class="w">                    </span><span class="nv">Browser</span><span class="w"> </span>â”€â”€<span class="nv">https</span>:<span class="o">//</span>â”€â”€â–¶<span class="w"> </span><span class="nv">Server</span><span class="w">                      </span>â”‚
â”‚<span class="w">                    </span><span class="ss">(</span><span class="nv">no</span><span class="w"> </span><span class="nv">network</span><span class="w"> </span><span class="nv">request</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">HTTP</span><span class="ss">)</span><span class="w">                       </span>â”‚
â”‚<span class="w">                                                                      </span>â”‚
â”‚<span class="w">  </span><span class="nv">First</span><span class="w"> </span><span class="nv">visit</span>:<span class="w">                                                        </span>â”‚
â”‚<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Browser</span><span class="w"> </span><span class="nv">connects</span><span class="w"> </span><span class="nv">via</span><span class="w"> </span><span class="nv">HTTP</span><span class="w">                                        </span>â”‚
â”‚<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Server</span><span class="w"> </span><span class="nv">responds</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="mi">301</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">HSTS</span><span class="w"> </span><span class="nv">header</span><span class="w">                           </span>â”‚
â”‚<span class="w">  </span><span class="mi">3</span>.<span class="w"> </span><span class="nv">Browser</span><span class="w"> </span><span class="nv">stores</span><span class="w"> </span><span class="nv">HSTS</span><span class="w"> </span><span class="nv">policy</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">domain</span><span class="w">                            </span>â”‚
â”‚<span class="w">                                                                      </span>â”‚
â”‚<span class="w">  </span><span class="nv">Subsequent</span><span class="w"> </span><span class="nv">visits</span>:<span class="w">                                                   </span>â”‚
â”‚<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Browser</span><span class="w"> </span><span class="nv">automatically</span><span class="w"> </span><span class="nv">upgrades</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">HTTPS</span><span class="w">                          </span>â”‚
â”‚<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">HTTP</span><span class="w"> </span><span class="nv">request</span><span class="w"> </span><span class="nv">ever</span><span class="w"> </span><span class="nv">leaves</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">browser</span><span class="w">                          </span>â”‚
â”‚<span class="w">  </span><span class="mi">3</span>.<span class="w"> </span><span class="nv">Invalid</span><span class="w"> </span><span class="nv">certificates</span><span class="w"> </span><span class="nv">cause</span><span class="w"> </span><span class="nv">hard</span><span class="w"> </span><span class="nv">failure</span><span class="w"> </span><span class="ss">(</span><span class="nv">no</span><span class="w"> </span><span class="nv">bypass</span><span class="ss">)</span><span class="w">              </span>â”‚
â”‚<span class="w">                                                                      </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="32-hsts-directives">3.2 HSTS Directives<a class="header-link" href="#32-hsts-directives" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Strict</span><span class="o">-</span><span class="n">Transport</span><span class="o">-</span><span class="n">Security</span><span class="p">:</span><span class="w"> </span><span class="nb">max</span><span class="o">-</span><span class="n">age</span><span class="o">=</span><span class="mi">31536000</span><span class="p">;</span><span class="w"> </span><span class="n">includeSubDomains</span><span class="p">;</span><span class="w"> </span><span class="nb">preload</span>
</code></pre></div>

<table>
<thead>
<tr>
<th>Directive</th>
<th>Purpose</th>
<th>Recommended Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>max-age</code></td>
<td>Duration (seconds) to remember HSTS</td>
<td><code>31536000</code> (1 year)</td>
</tr>
<tr>
<td><code>includeSubDomains</code></td>
<td>Apply to all subdomains</td>
<td>Include for full protection</td>
</tr>
<tr>
<td><code>preload</code></td>
<td>Request inclusion in browser preload list</td>
<td>Include after testing</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">HSTS configuration considerations.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ Deployment strategy: gradual rollout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Start with a short max-age and increase over time</span>

<span class="c1"># Step 1: Test with 5 minutes</span>
<span class="n">hsts_test</span> <span class="o">=</span> <span class="s2">&quot;max-age=300&quot;</span>

<span class="c1"># Step 2: Increase to 1 week</span>
<span class="n">hsts_week</span> <span class="o">=</span> <span class="s2">&quot;max-age=604800&quot;</span>

<span class="c1"># Step 3: Increase to 1 month with subdomains</span>
<span class="n">hsts_month</span> <span class="o">=</span> <span class="s2">&quot;max-age=2592000; includeSubDomains&quot;</span>

<span class="c1"># Step 4: Full deployment (1 year + preload)</span>
<span class="n">hsts_full</span> <span class="o">=</span> <span class="s2">&quot;max-age=31536000; includeSubDomains; preload&quot;</span>

<span class="c1"># WARNING: Setting a long max-age before ensuring all</span>
<span class="c1"># subdomains support HTTPS can lock users out.</span>
<span class="c1"># includeSubDomains means ALL subdomains MUST have valid TLS.</span>

<span class="c1"># â”€â”€ HSTS Preload List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># The HSTS preload list is baked into browsers.</span>
<span class="c1"># Domains on this list ALWAYS use HTTPS, even on first visit.</span>
<span class="c1"># Submit at: https://hstspreload.org/</span>
<span class="c1">#</span>
<span class="c1"># Requirements for preload:</span>
<span class="c1"># 1. Valid certificate</span>
<span class="c1"># 2. Redirect all HTTP to HTTPS on same host</span>
<span class="c1"># 3. HSTS header with:</span>
<span class="c1">#    - max-age &gt;= 31536000 (1 year)</span>
<span class="c1">#    - includeSubDomains</span>
<span class="c1">#    - preload</span>
<span class="c1"># 4. HTTPS redirect must also include HSTS header</span>
</code></pre></div>

<hr />
<h2 id="4-x-content-type-options">4. X-Content-Type-Options<a class="header-link" href="#4-x-content-type-options" title="Permanent link">&para;</a></h2>
<h3 id="41-mime-sniffing-attack">4.1 MIME Sniffing Attack<a class="header-link" href="#41-mime-sniffing-attack" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">MIME</span><span class="w"> </span><span class="n">Sniffing</span><span class="w"> </span><span class="n">Attack</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Attacker</span><span class="w"> </span><span class="n">uploads</span><span class="p">:</span><span class="w"> </span><span class="n">malicious</span><span class="o">.</span><span class="n">jpg</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">actually</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">JavaScript</span><span class="p">,</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Server</span><span class="w"> </span><span class="n">serves</span><span class="p">:</span><span class="w"> </span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span><span class="w"> </span><span class="n">image</span><span class="o">/</span><span class="n">jpeg</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">WITHOUT</span><span class="w"> </span><span class="n">nosniff</span><span class="p">:</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Browser</span><span class="w"> </span><span class="n">sniffs</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="s2">&quot;This looks like JavaScript&quot;</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Browser</span><span class="w"> </span><span class="n">executes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">JavaScript</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="n">XSS</span><span class="o">!</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">WITH</span><span class="w"> </span><span class="n">nosniff</span><span class="p">:</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Browser</span><span class="w"> </span><span class="n">trusts</span><span class="w"> </span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="s2">&quot;This is image/jpeg&quot;</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Browser</span><span class="w"> </span><span class="n">renders</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="p">(</span><span class="n">fails</span><span class="p">)</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">execution</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="42-configuration">4.2 Configuration<a class="header-link" href="#42-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>X-Content-Type-Options: nosniff
</code></pre></div>

<p>This is the simplest security header â€” it has exactly one valid value: <code>nosniff</code>. There is no reason not to include it on every response. It prevents:</p>
<ul>
<li>Scripts being loaded from files with non-script MIME types</li>
<li>Stylesheets being loaded from files with non-CSS MIME types</li>
<li>MIME-type confusion attacks when serving user-uploaded content</li>
</ul>
<hr />
<h2 id="5-x-frame-options-and-frame-ancestors">5. X-Frame-Options and frame-ancestors<a class="header-link" href="#5-x-frame-options-and-frame-ancestors" title="Permanent link">&para;</a></h2>
<h3 id="51-clickjacking-prevention">5.1 Clickjacking Prevention<a class="header-link" href="#51-clickjacking-prevention" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Clickjacking Attack                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Attacker&#39;s page:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚  &quot;Click here to win a prize!&quot;           â”‚                         â”‚
â”‚  â”‚                                          â”‚                        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                        â”‚
â”‚  â”‚  â”‚  Invisible iframe (opacity: 0)  â”‚     â”‚                        â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚                        â”‚
â”‚  â”‚  â”‚  â”‚ Your Banking App       â”‚     â”‚     â”‚                        â”‚
â”‚  â”‚  â”‚  â”‚                        â”‚     â”‚     â”‚                        â”‚
â”‚  â”‚  â”‚  â”‚  [Transfer $1000] â—„â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€ User clicks here       â”‚
â”‚  â”‚  â”‚  â”‚                        â”‚     â”‚     â”‚                        â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚                        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                      â”‚
â”‚  The user thinks they are clicking on the prize button,              â”‚
â”‚  but they are actually clicking the &quot;Transfer&quot; button                â”‚
â”‚  in the invisible iframe containing their bank&#39;s website.            â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="52-x-frame-options-values">5.2 X-Frame-Options Values<a class="header-link" href="#52-x-frame-options-values" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code># Deny all framing
X-Frame-Options: DENY

# Allow only same origin
X-Frame-Options: SAMEORIGIN

# Allow specific origin (deprecated, not recommended)
X-Frame-Options: ALLOW-FROM https://trusted.example.com
</code></pre></div>

<h3 id="53-csp-frame-ancestors-modern-replacement">5.3 CSP frame-ancestors (Modern Replacement)<a class="header-link" href="#53-csp-frame-ancestors-modern-replacement" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">frame-ancestors is the CSP replacement for X-Frame-Options.</span>
<span class="sd">It provides more granular control and supports multiple origins.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ Block all framing (equivalent to X-Frame-Options: DENY) â”€â”€â”€â”€â”€</span>
<span class="n">csp_no_frame</span> <span class="o">=</span> <span class="s2">&quot;frame-ancestors &#39;none&#39;&quot;</span>

<span class="c1"># â”€â”€ Allow same-origin only â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">csp_same_origin</span> <span class="o">=</span> <span class="s2">&quot;frame-ancestors &#39;self&#39;&quot;</span>

<span class="c1"># â”€â”€ Allow specific origins â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">csp_specific</span> <span class="o">=</span> <span class="s2">&quot;frame-ancestors &#39;self&#39; https://trusted.example.com https://partner.example.com&quot;</span>

<span class="c1"># â”€â”€ Key differences from X-Frame-Options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1">#</span>
<span class="c1"># | Feature              | X-Frame-Options      | frame-ancestors        |</span>
<span class="c1"># |---------------------|----------------------|------------------------|</span>
<span class="c1"># | Multiple origins    | No                   | Yes                    |</span>
<span class="c1"># | Wildcard subdomains | No                   | Yes (*.example.com)    |</span>
<span class="c1"># | scheme restriction  | No                   | Yes (https:)           |</span>
<span class="c1"># | CSP integration     | Separate header      | Part of CSP            |</span>
<span class="c1"># | Browser support     | Universal            | Modern browsers        |</span>
<span class="c1">#</span>
<span class="c1"># Recommendation: Set BOTH for maximum compatibility</span>
<span class="c1"># X-Frame-Options: DENY</span>
<span class="c1"># Content-Security-Policy: frame-ancestors &#39;none&#39;</span>
</code></pre></div>

<hr />
<h2 id="6-referrer-policy">6. Referrer-Policy<a class="header-link" href="#6-referrer-policy" title="Permanent link">&para;</a></h2>
<h3 id="61-referrer-information-leakage">6.1 Referrer Information Leakage<a class="header-link" href="#61-referrer-information-leakage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Referrer Leakage Scenarios                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  User is on: https://bank.com/accounts/12345/transfer?amount=500     â”‚
â”‚                                                                      â”‚
â”‚  They click a link to: https://analytics.example.com                 â”‚
â”‚                                                                      â”‚
â”‚  WITHOUT Referrer-Policy:                                            â”‚
â”‚  Referer: https://bank.com/accounts/12345/transfer?amount=500        â”‚
â”‚  â†‘ Full URL including path and query params leaked!                  â”‚
â”‚                                                                      â”‚
â”‚  WITH Referrer-Policy: strict-origin-when-cross-origin               â”‚
â”‚  Referer: https://bank.com                                           â”‚
â”‚  â†‘ Only origin sent, no sensitive path or params                     â”‚
â”‚                                                                      â”‚
â”‚  WITH Referrer-Policy: no-referrer                                   â”‚
â”‚  Referer: (empty)                                                    â”‚
â”‚  â†‘ No referrer information sent at all                               â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62-policy-values">6.2 Policy Values<a class="header-link" href="#62-policy-values" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Policy</th>
<th>Same-Origin</th>
<th>Cross-Origin (HTTPSâ†’HTTPS)</th>
<th>Downgrade (HTTPSâ†’HTTP)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>no-referrer</code></td>
<td>Nothing</td>
<td>Nothing</td>
<td>Nothing</td>
</tr>
<tr>
<td><code>no-referrer-when-downgrade</code></td>
<td>Full URL</td>
<td>Full URL</td>
<td>Nothing</td>
</tr>
<tr>
<td><code>origin</code></td>
<td>Origin only</td>
<td>Origin only</td>
<td>Origin only</td>
</tr>
<tr>
<td><code>origin-when-cross-origin</code></td>
<td>Full URL</td>
<td>Origin only</td>
<td>Origin only</td>
</tr>
<tr>
<td><code>same-origin</code></td>
<td>Full URL</td>
<td>Nothing</td>
<td>Nothing</td>
</tr>
<tr>
<td><code>strict-origin</code></td>
<td>Origin only</td>
<td>Origin only</td>
<td>Nothing</td>
</tr>
<tr>
<td><code>strict-origin-when-cross-origin</code></td>
<td>Full URL</td>
<td>Origin only</td>
<td>Nothing</td>
</tr>
<tr>
<td><code>unsafe-url</code></td>
<td>Full URL</td>
<td>Full URL</td>
<td>Full URL</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Recommended Referrer-Policy configurations.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ Default recommendation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># strict-origin-when-cross-origin is the browser default in modern browsers</span>
<span class="c1"># and a good balance of functionality and privacy</span>
<span class="n">referrer_policy</span> <span class="o">=</span> <span class="s2">&quot;strict-origin-when-cross-origin&quot;</span>

<span class="c1"># â”€â”€ Maximum privacy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># no-referrer strips all referrer information</span>
<span class="c1"># Downside: breaks analytics and some CSRF protections</span>
<span class="n">referrer_max_privacy</span> <span class="o">=</span> <span class="s2">&quot;no-referrer&quot;</span>

<span class="c1"># â”€â”€ For sites with sensitive URLs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># same-origin sends full referrer only within the same site</span>
<span class="n">referrer_sensitive</span> <span class="o">=</span> <span class="s2">&quot;same-origin&quot;</span>

<span class="c1"># â”€â”€ Per-element override â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># You can also set referrer policy on individual elements:</span>
<span class="c1"># &lt;a href=&quot;...&quot; referrerpolicy=&quot;no-referrer&quot;&gt;External Link&lt;/a&gt;</span>
<span class="c1"># &lt;img src=&quot;...&quot; referrerpolicy=&quot;no-referrer&quot;&gt;</span>
<span class="c1"># &lt;script src=&quot;...&quot; referrerpolicy=&quot;no-referrer&quot;&gt;</span>
</code></pre></div>

<hr />
<h2 id="7-permissions-policy">7. Permissions-Policy<a class="header-link" href="#7-permissions-policy" title="Permanent link">&para;</a></h2>
<h3 id="71-restricting-browser-features">7.1 Restricting Browser Features<a class="header-link" href="#71-restricting-browser-features" title="Permanent link">&para;</a></h3>
<p>Permissions-Policy (formerly Feature-Policy) controls which browser features and APIs can be used by the page and its embedded content.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">Permissions</span><span class="o">-</span><span class="n">Policy</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Controls</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">browser</span><span class="w"> </span><span class="n">APIs</span><span class="err">:</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Camera</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Microphone</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Geolocation</span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Payment</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nb">camera</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">microphone</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">geolocation</span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">payment</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Fullscreen</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Autoplay</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">USB</span><span class="w">       </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Bluetooth</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">fullscreen</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">autoplay</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">usb</span><span class="w">       </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">bluetooth</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Syntax</span><span class="err">:</span><span class="w">                                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Permissions</span><span class="o">-</span><span class="n">Policy</span><span class="err">:</span><span class="w"> </span><span class="n">feature</span><span class="o">=</span><span class="p">(</span><span class="n">allowlist</span><span class="p">)</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Allowlist</span><span class="w"> </span><span class="n">values</span><span class="err">:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">*</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="n">Allow</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="n">origins</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">self</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">Allow</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="n">only</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">empty</span><span class="p">)</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">entirely</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="s2">&quot;origin&quot;</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">Allow</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">origin</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="72-configuration-examples">7.2 Configuration Examples<a class="header-link" href="#72-configuration-examples" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Permissions-Policy header configuration.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ Restrictive policy (recommended for most sites) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">permissions_policy</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;camera=(), &quot;</span>                              <span class="c1"># Block camera</span>
    <span class="s2">&quot;microphone=(), &quot;</span>                          <span class="c1"># Block microphone</span>
    <span class="s2">&quot;geolocation=(), &quot;</span>                         <span class="c1"># Block geolocation</span>
    <span class="s2">&quot;payment=(), &quot;</span>                             <span class="c1"># Block Payment API</span>
    <span class="s2">&quot;usb=(), &quot;</span>                                 <span class="c1"># Block WebUSB</span>
    <span class="s2">&quot;bluetooth=(), &quot;</span>                           <span class="c1"># Block Web Bluetooth</span>
    <span class="s2">&quot;magnetometer=(), &quot;</span>                        <span class="c1"># Block magnetometer</span>
    <span class="s2">&quot;gyroscope=(), &quot;</span>                           <span class="c1"># Block gyroscope</span>
    <span class="s2">&quot;accelerometer=(), &quot;</span>                       <span class="c1"># Block accelerometer</span>
    <span class="s1">&#39;autoplay=(self), &#39;</span>                        <span class="c1"># Allow autoplay same-origin only</span>
    <span class="s1">&#39;fullscreen=(self), &#39;</span>                      <span class="c1"># Allow fullscreen same-origin only</span>
    <span class="s1">&#39;picture-in-picture=(self)&#39;</span>                <span class="c1"># Allow PiP same-origin only</span>
<span class="p">)</span>

<span class="c1"># â”€â”€ Policy for a video conferencing app â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">permissions_video_app</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;camera=(self &quot;https://meet.example.com&quot;), &#39;</span>
    <span class="s1">&#39;microphone=(self &quot;https://meet.example.com&quot;), &#39;</span>
    <span class="s2">&quot;geolocation=(), &quot;</span>
    <span class="s1">&#39;fullscreen=(self), &#39;</span>
    <span class="s1">&#39;display-capture=(self)&#39;</span>
<span class="p">)</span>

<span class="c1"># â”€â”€ Policy for an e-commerce site â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">permissions_ecommerce</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;camera=(), &quot;</span>
    <span class="s2">&quot;microphone=(), &quot;</span>
    <span class="s1">&#39;geolocation=(self), &#39;</span>                     <span class="c1"># For store locator</span>
    <span class="s1">&#39;payment=(self), &#39;</span>                         <span class="c1"># For Payment Request API</span>
    <span class="s2">&quot;usb=(), &quot;</span>
    <span class="s2">&quot;bluetooth=()&quot;</span>
<span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="8-cross-origin-policies-corp-coep-coop">8. Cross-Origin Policies (CORP, COEP, COOP)<a class="header-link" href="#8-cross-origin-policies-corp-coep-coop" title="Permanent link">&para;</a></h2>
<h3 id="81-overview">8.1 Overview<a class="header-link" href="#81-overview" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">Cross</span><span class="o">-</span><span class="n">Origin</span><span class="w"> </span><span class="n">Isolation</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Three</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">together</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">cross</span><span class="o">-</span><span class="n">origin</span><span class="w"> </span><span class="n">isolation</span><span class="p">:</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">CORP</span><span class="w"> </span><span class="p">(</span><span class="n">Cross</span><span class="o">-</span><span class="n">Origin</span><span class="o">-</span><span class="n">Resource</span><span class="o">-</span><span class="n">Policy</span><span class="p">)</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">RESOURCES</span><span class="w"> </span><span class="p">(</span><span class="n">images</span><span class="p">,</span><span class="w"> </span><span class="n">scripts</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span><span class="p">)</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Controls</span><span class="w"> </span><span class="n">who</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">resource</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Values</span><span class="p">:</span><span class="w"> </span><span class="n">same</span><span class="o">-</span><span class="n">site</span><span class="p">,</span><span class="w"> </span><span class="n">same</span><span class="o">-</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">cross</span><span class="o">-</span><span class="n">origin</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">COEP</span><span class="w"> </span><span class="p">(</span><span class="n">Cross</span><span class="o">-</span><span class="n">Origin</span><span class="o">-</span><span class="n">Embedder</span><span class="o">-</span><span class="n">Policy</span><span class="p">)</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DOCUMENT</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">embeds</span><span class="w"> </span><span class="n">resources</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Requires</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">resources</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">opt</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="n">via</span><span class="w"> </span><span class="n">CORP</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">CORS</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Values</span><span class="p">:</span><span class="w"> </span><span class="n">unsafe</span><span class="o">-</span><span class="n">none</span><span class="p">,</span><span class="w"> </span><span class="n">require</span><span class="o">-</span><span class="n">corp</span><span class="p">,</span><span class="w"> </span><span class="n">credentialless</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">COOP</span><span class="w"> </span><span class="p">(</span><span class="n">Cross</span><span class="o">-</span><span class="n">Origin</span><span class="o">-</span><span class="n">Opener</span><span class="o">-</span><span class="n">Policy</span><span class="p">)</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DOCUMENT</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Controls</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">opener</span><span class="w"> </span><span class="n">relationships</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Values</span><span class="p">:</span><span class="w"> </span><span class="n">unsafe</span><span class="o">-</span><span class="n">none</span><span class="p">,</span><span class="w"> </span><span class="n">same</span><span class="o">-</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">same</span><span class="o">-</span><span class="n">origin</span><span class="o">-</span><span class="n">allow</span><span class="o">-</span><span class="n">popups</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">When</span><span class="w"> </span><span class="n">COEP</span><span class="p">:</span><span class="w"> </span><span class="n">require</span><span class="o">-</span><span class="n">corp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">COOP</span><span class="p">:</span><span class="w"> </span><span class="n">same</span><span class="o">-</span><span class="n">origin</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">set</span><span class="p">:</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="n">Page</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s2">&quot;cross-origin isolated&quot;</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="n">Enables</span><span class="w"> </span><span class="n">SharedArrayBuffer</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="o">-</span><span class="n">resolution</span><span class="w"> </span><span class="n">timers</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="n">Protects</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">Spectre</span><span class="o">-</span><span class="n">style</span><span class="w"> </span><span class="n">side</span><span class="o">-</span><span class="n">channel</span><span class="w"> </span><span class="n">attacks</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="82-cross-origin-resource-policy-corp">8.2 Cross-Origin-Resource-Policy (CORP)<a class="header-link" href="#82-cross-origin-resource-policy-corp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CORP controls which origins can load a resource.</span>
<span class="sd">Set this on your API responses, images, scripts, etc.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ Values â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># same-origin:  Only requests from the same origin</span>
<span class="c1"># same-site:    Requests from the same site (includes subdomains)</span>
<span class="c1"># cross-origin: Any origin can load this resource</span>

<span class="c1"># For private API endpoints</span>
<span class="n">corp_api</span> <span class="o">=</span> <span class="s2">&quot;same-origin&quot;</span>

<span class="c1"># For public CDN resources</span>
<span class="n">corp_cdn</span> <span class="o">=</span> <span class="s2">&quot;cross-origin&quot;</span>

<span class="c1"># For resources shared across subdomains</span>
<span class="n">corp_shared</span> <span class="o">=</span> <span class="s2">&quot;same-site&quot;</span>
</code></pre></div>

<h3 id="83-cross-origin-embedder-policy-coep">8.3 Cross-Origin-Embedder-Policy (COEP)<a class="header-link" href="#83-cross-origin-embedder-policy-coep" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">COEP ensures that all resources loaded by a page have</span>
<span class="sd">explicitly opted in to being loaded cross-origin.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ require-corp: strictest mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># All cross-origin resources must either:</span>
<span class="c1"># 1. Be served with CORP: cross-origin header</span>
<span class="c1"># 2. Be loaded with crossorigin attribute (CORS)</span>
<span class="n">coep_strict</span> <span class="o">=</span> <span class="s2">&quot;require-corp&quot;</span>

<span class="c1"># In HTML, resources need crossorigin attribute:</span>
<span class="c1"># &lt;img src=&quot;https://cdn.example.com/image.jpg&quot; crossorigin&gt;</span>
<span class="c1"># &lt;script src=&quot;https://cdn.example.com/lib.js&quot; crossorigin&gt;</span>

<span class="c1"># â”€â”€ credentialless: more practical â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Cross-origin requests are made without credentials (cookies)</span>
<span class="c1"># Resources don&#39;t need CORP header</span>
<span class="n">coep_credentialless</span> <span class="o">=</span> <span class="s2">&quot;credentialless&quot;</span>

<span class="c1"># â”€â”€ unsafe-none: no restriction (default) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">coep_none</span> <span class="o">=</span> <span class="s2">&quot;unsafe-none&quot;</span>
</code></pre></div>

<h3 id="84-cross-origin-opener-policy-coop">8.4 Cross-Origin-Opener-Policy (COOP)<a class="header-link" href="#84-cross-origin-opener-policy-coop" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">COOP controls the relationship between a page and its opener</span>
<span class="sd">(the page that opened it via window.open or a link).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ same-origin: full isolation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Breaks window.opener references to cross-origin pages</span>
<span class="c1"># Prevents cross-origin pages from accessing this window</span>
<span class="n">coop_strict</span> <span class="o">=</span> <span class="s2">&quot;same-origin&quot;</span>

<span class="c1"># â”€â”€ same-origin-allow-popups â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Same as same-origin, but popups opened by this page</span>
<span class="c1"># can retain their opener reference</span>
<span class="n">coop_popups</span> <span class="o">=</span> <span class="s2">&quot;same-origin-allow-popups&quot;</span>

<span class="c1"># â”€â”€ unsafe-none: no restriction (default) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">coop_none</span> <span class="o">=</span> <span class="s2">&quot;unsafe-none&quot;</span>

<span class="c1"># â”€â”€ Achieving cross-origin isolation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># Both headers required:</span>
<span class="c1"># Cross-Origin-Embedder-Policy: require-corp</span>
<span class="c1"># Cross-Origin-Opener-Policy: same-origin</span>
<span class="c1">#</span>
<span class="c1"># Verify in JavaScript:</span>
<span class="c1"># if (crossOriginIsolated) {</span>
<span class="c1">#   // SharedArrayBuffer is available</span>
<span class="c1">#   // Performance.now() has full precision</span>
<span class="c1"># }</span>
</code></pre></div>

<hr />
<h2 id="9-subresource-integrity-sri">9. Subresource Integrity (SRI)<a class="header-link" href="#9-subresource-integrity-sri" title="Permanent link">&para;</a></h2>
<h3 id="91-how-sri-works">9.1 How SRI Works<a class="header-link" href="#91-how-sri-works" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">Subresource</span><span class="w"> </span><span class="n">Integrity</span><span class="w"> </span><span class="p">(</span><span class="n">SRI</span><span class="p">)</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Problem</span><span class="p">:</span><span class="w"> </span><span class="n">CDN</span><span class="w"> </span><span class="n">compromise</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Your</span><span class="w"> </span><span class="n">App</span><span class="w"> </span><span class="err">â”‚â”€â”€â”€â–¶â”‚</span><span class="w">   </span><span class="n">CDN</span><span class="w">    </span><span class="err">â”‚â”€â”€â”€â–¶â”‚</span><span class="w"> </span><span class="n">Browser</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                       </span><span class="err">â†‘</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="n">Attacker</span><span class="w"> </span><span class="n">modifies</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="n">jquery</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">js</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CDN</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Solution</span><span class="p">:</span><span class="w"> </span><span class="n">SRI</span><span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="n">verification</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">&lt;</span><span class="n">script</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://cdn/jquery.js&quot;</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="n">integrity</span><span class="o">=</span><span class="s2">&quot;sha384-abc123...&quot;</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="n">crossorigin</span><span class="o">=</span><span class="s2">&quot;anonymous&quot;</span><span class="o">&gt;</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span><span class="w">                                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Browser</span><span class="w"> </span><span class="n">downloads</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="n">Computes</span><span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="n">Compares</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">integrity</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Match</span><span class="err">?</span><span class="w">    </span><span class="err">âœ“</span><span class="w"> </span><span class="n">Execute</span><span class="w">     </span><span class="err">âœ—</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="n">error</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                      </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="92-generating-sri-hashes">9.2 Generating SRI Hashes<a class="header-link" href="#92-generating-sri-hashes" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Generate SRI hash from a local file</span>
cat<span class="w"> </span>jquery-3.7.1.min.js<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>dgst<span class="w"> </span>-sha384<span class="w"> </span>-binary<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>base64<span class="w"> </span>-A
<span class="c1"># Output: oQVuAfEn...</span>

<span class="c1"># Generate SRI hash using shasum</span>
shasum<span class="w"> </span>-b<span class="w"> </span>-a<span class="w"> </span><span class="m">384</span><span class="w"> </span>jquery-3.7.1.min.js<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ print $1 }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xxd<span class="w"> </span>-r<span class="w"> </span>-p<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64

<span class="c1"># Using curl to generate hash from remote file</span>
curl<span class="w"> </span>-s<span class="w"> </span>https://code.jquery.com/jquery-3.7.1.min.js<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>openssl<span class="w"> </span>dgst<span class="w"> </span>-sha384<span class="w"> </span>-binary<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>base64<span class="w"> </span>-A
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generating and verifying SRI hashes in Python.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_sri_hash</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sha384&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate an SRI hash for the given content.&quot;&quot;&quot;</span>
    <span class="n">hash_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hashlib</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">)</span>
    <span class="n">digest</span> <span class="o">=</span> <span class="n">hash_func</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="n">b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">algorithm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">b64</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_sri_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a resource and generate its SRI hash.&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">generate_sri_hash</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

<span class="c1"># Example usage</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot;</span>
<span class="n">sri_hash</span> <span class="o">=</span> <span class="n">generate_sri_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;integrity=&quot;</span><span class="si">{</span><span class="n">sri_hash</span><span class="si">}</span><span class="s1">&quot; crossorigin=&quot;anonymous&quot;&gt;&#39;</span><span class="p">)</span>

<span class="c1"># â”€â”€ SRI in HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># For scripts:</span>
<span class="c1"># &lt;script src=&quot;https://cdn.example.com/lib.js&quot;</span>
<span class="c1">#         integrity=&quot;sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC&quot;</span>
<span class="c1">#         crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c1">#</span>
<span class="c1"># For stylesheets:</span>
<span class="c1"># &lt;link rel=&quot;stylesheet&quot;</span>
<span class="c1">#       href=&quot;https://cdn.example.com/style.css&quot;</span>
<span class="c1">#       integrity=&quot;sha384-abc123...&quot;</span>
<span class="c1">#       crossorigin=&quot;anonymous&quot;&gt;</span>
<span class="c1">#</span>
<span class="c1"># Multiple hashes (for migration):</span>
<span class="c1"># &lt;script src=&quot;https://cdn.example.com/lib.js&quot;</span>
<span class="c1">#         integrity=&quot;sha384-oldHash... sha384-newHash...&quot;</span>
<span class="c1">#         crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c1"># Browser accepts if ANY hash matches</span>

<span class="c1"># â”€â”€ Important notes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># 1. crossorigin=&quot;anonymous&quot; is REQUIRED for cross-origin SRI</span>
<span class="c1"># 2. SRI only works with &lt;script&gt; and &lt;link rel=&quot;stylesheet&quot;&gt;</span>
<span class="c1"># 3. Hash must match byte-for-byte (whitespace matters)</span>
<span class="c1"># 4. If CDN updates the file, the hash breaks (this is by design)</span>
</code></pre></div>

<hr />
<h2 id="10-flask-security-headers-configuration">10. Flask Security Headers Configuration<a class="header-link" href="#10-flask-security-headers-configuration" title="Permanent link">&para;</a></h2>
<h3 id="101-manual-header-setting">10.1 Manual Header Setting<a class="header-link" href="#101-manual-header-setting" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Setting security headers in Flask applications.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">g</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># â”€â”€ Method 1: after_request decorator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_security_headers</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add security headers to every response.&quot;&quot;&quot;</span>

    <span class="c1"># Generate nonce for CSP</span>
    <span class="n">nonce</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;csp_nonce&#39;</span><span class="p">,</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>

    <span class="c1"># Content-Security-Policy</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;script-src &#39;self&#39; &#39;nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;style-src &#39;self&#39; &#39;nonce-</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&#39; https://fonts.googleapis.com; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;font-src &#39;self&#39; https://fonts.gstatic.com; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;img-src &#39;self&#39; data:; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;connect-src &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;object-src &#39;none&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;base-uri &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;form-action &#39;self&#39;; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;frame-ancestors &#39;none&#39;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># HSTS (only set over HTTPS in production)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;max-age=31536000; includeSubDomains; preload&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Prevent MIME sniffing</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Content-Type-Options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;nosniff&#39;</span>

    <span class="c1"># Clickjacking protection</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Frame-Options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DENY&#39;</span>

    <span class="c1"># Referrer control</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Referrer-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;strict-origin-when-cross-origin&#39;</span>

    <span class="c1"># Permissions policy</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Permissions-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;camera=(), microphone=(), geolocation=(), payment=()&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Cross-origin policies</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Cross-Origin-Opener-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;same-origin&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Cross-Origin-Resource-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;same-origin&#39;</span>

    <span class="c1"># Remove server identification</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">before_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_nonce</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a CSP nonce for each request.&quot;&quot;&quot;</span>
    <span class="n">g</span><span class="o">.</span><span class="n">csp_nonce</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>


<span class="c1"># â”€â”€ Method 2: Using Flask-Talisman â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># pip install flask-talisman</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask_talisman</span><span class="w"> </span><span class="kn">import</span> <span class="n">Talisman</span>

<span class="n">app2</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">csp</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default-src&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;script-src&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;style-src&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;self&#39; https://fonts.googleapis.com&quot;</span><span class="p">,</span>
    <span class="s1">&#39;font-src&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;self&#39; https://fonts.gstatic.com&quot;</span><span class="p">,</span>
    <span class="s1">&#39;img-src&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;self&#39; data:&quot;</span><span class="p">,</span>
    <span class="s1">&#39;object-src&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">talisman</span> <span class="o">=</span> <span class="n">Talisman</span><span class="p">(</span>
    <span class="n">app2</span><span class="p">,</span>
    <span class="n">content_security_policy</span><span class="o">=</span><span class="n">csp</span><span class="p">,</span>
    <span class="n">content_security_policy_nonce_in</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;script-src&#39;</span><span class="p">,</span> <span class="s1">&#39;style-src&#39;</span><span class="p">],</span>
    <span class="n">force_https</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">strict_transport_security</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">strict_transport_security_max_age</span><span class="o">=</span><span class="mi">31536000</span><span class="p">,</span>
    <span class="n">strict_transport_security_include_subdomains</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">strict_transport_security_preload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">frame_options</span><span class="o">=</span><span class="s1">&#39;DENY&#39;</span><span class="p">,</span>
    <span class="n">referrer_policy</span><span class="o">=</span><span class="s1">&#39;strict-origin-when-cross-origin&#39;</span><span class="p">,</span>
    <span class="n">permissions_policy</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;camera&#39;</span><span class="p">:</span> <span class="s1">&#39;()&#39;</span><span class="p">,</span>
        <span class="s1">&#39;microphone&#39;</span><span class="p">:</span> <span class="s1">&#39;()&#39;</span><span class="p">,</span>
        <span class="s1">&#39;geolocation&#39;</span><span class="p">:</span> <span class="s1">&#39;()&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">session_cookie_secure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">session_cookie_http_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># In Jinja2 templates, use the nonce:</span>
<span class="c1"># &lt;script nonce=&quot;{{ csp_nonce() }}&quot;&gt;</span>
<span class="c1">#     // Inline JavaScript here</span>
<span class="c1"># &lt;/script&gt;</span>
</code></pre></div>

<h3 id="102-per-route-header-overrides">10.2 Per-Route Header Overrides<a class="header-link" href="#102-per-route-header-overrides" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Different security headers for different routes.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_csp</span><span class="p">(</span><span class="n">csp_string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to override CSP for specific routes.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csp_string</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">return</span> <span class="n">decorated_function</span>
    <span class="k">return</span> <span class="n">decorator</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/admin&#39;</span><span class="p">)</span>
<span class="nd">@custom_csp</span><span class="p">(</span><span class="s2">&quot;default-src &#39;self&#39;; script-src &#39;self&#39;; frame-ancestors &#39;none&#39;&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">admin_panel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Admin panel with strict CSP.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;Admin Panel&quot;</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/embed-widget&#39;</span><span class="p">)</span>
<span class="nd">@custom_csp</span><span class="p">(</span>
    <span class="s2">&quot;default-src &#39;self&#39;; &quot;</span>
    <span class="s2">&quot;frame-ancestors &#39;self&#39; https://partner.example.com&quot;</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">embeddable_widget</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Widget that can be embedded by specific partners.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;Widget&quot;</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/public-api&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">public_api</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;API endpoint with relaxed CORP for cross-origin access.&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Cross-Origin-Resource-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cross-origin&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div>

<hr />
<h2 id="11-django-security-headers-configuration">11. Django Security Headers Configuration<a class="header-link" href="#11-django-security-headers-configuration" title="Permanent link">&para;</a></h2>
<h3 id="111-django-settings">11.1 Django Settings<a class="header-link" href="#111-django-settings" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Django security header configuration in settings.py.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€ Built-in Django security settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="c1"># HSTS</span>
<span class="n">SECURE_HSTS_SECONDS</span> <span class="o">=</span> <span class="mi">31536000</span>           <span class="c1"># 1 year</span>
<span class="n">SECURE_HSTS_INCLUDE_SUBDOMAINS</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">SECURE_HSTS_PRELOAD</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># HTTPS redirect</span>
<span class="n">SECURE_SSL_REDIRECT</span> <span class="o">=</span> <span class="kc">True</span>               <span class="c1"># Redirect HTTP to HTTPS</span>
<span class="n">SECURE_REDIRECT_EXEMPT</span> <span class="o">=</span> <span class="p">[]</span>              <span class="c1"># Paths exempt from redirect</span>

<span class="c1"># Content-Type sniffing</span>
<span class="n">SECURE_CONTENT_TYPE_NOSNIFF</span> <span class="o">=</span> <span class="kc">True</span>       <span class="c1"># X-Content-Type-Options: nosniff</span>

<span class="c1"># Clickjacking protection</span>
<span class="n">X_FRAME_OPTIONS</span> <span class="o">=</span> <span class="s1">&#39;DENY&#39;</span>                 <span class="c1"># Built-in middleware</span>

<span class="c1"># Referrer policy</span>
<span class="n">SECURE_REFERRER_POLICY</span> <span class="o">=</span> <span class="s1">&#39;strict-origin-when-cross-origin&#39;</span>

<span class="c1"># Cross-origin opener policy</span>
<span class="n">SECURE_CROSS_ORIGIN_OPENER_POLICY</span> <span class="o">=</span> <span class="s1">&#39;same-origin&#39;</span>

<span class="c1"># Cookie security</span>
<span class="n">SESSION_COOKIE_SECURE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">SESSION_COOKIE_HTTPONLY</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">SESSION_COOKIE_SAMESITE</span> <span class="o">=</span> <span class="s1">&#39;Lax&#39;</span>
<span class="n">CSRF_COOKIE_SECURE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">CSRF_COOKIE_HTTPONLY</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># â”€â”€ Required middleware â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>       <span class="c1"># MUST be first</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
    <span class="c1"># ... other middleware</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="112-django-csp-with-django-csp">11.2 Django CSP with django-csp<a class="header-link" href="#112-django-csp-with-django-csp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CSP configuration using django-csp package.</span>
<span class="sd">pip install django-csp</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># settings.py</span>
<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;csp.middleware.CSPMiddleware&#39;</span><span class="p">,</span>
    <span class="c1"># ... other middleware</span>
<span class="p">]</span>

<span class="c1"># CSP directives</span>
<span class="n">CSP_DEFAULT_SRC</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,)</span>
<span class="n">CSP_SCRIPT_SRC</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,)</span>
<span class="n">CSP_STYLE_SRC</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;https://fonts.googleapis.com&quot;</span><span class="p">)</span>
<span class="n">CSP_FONT_SRC</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;https://fonts.gstatic.com&quot;</span><span class="p">)</span>
<span class="n">CSP_IMG_SRC</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;data:&quot;</span><span class="p">)</span>
<span class="n">CSP_CONNECT_SRC</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,)</span>
<span class="n">CSP_OBJECT_SRC</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">,)</span>
<span class="n">CSP_BASE_URI</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,)</span>
<span class="n">CSP_FORM_ACTION</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;self&#39;&quot;</span><span class="p">,)</span>
<span class="n">CSP_FRAME_ANCESTORS</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">,)</span>

<span class="c1"># Enable nonce for script-src and style-src</span>
<span class="n">CSP_INCLUDE_NONCE_IN</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;script-src&#39;</span><span class="p">,</span> <span class="s1">&#39;style-src&#39;</span><span class="p">]</span>

<span class="c1"># Report violations</span>
<span class="n">CSP_REPORT_URI</span> <span class="o">=</span> <span class="s1">&#39;/csp-report/&#39;</span>

<span class="c1"># Report-only mode (for testing)</span>
<span class="c1"># CSP_REPORT_ONLY = True</span>


<span class="c1"># â”€â”€ In Django templates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># {% load csp %}</span>
<span class="c1">#</span>
<span class="c1"># &lt;script nonce=&quot;{% csp_nonce %}&quot;&gt;</span>
<span class="c1">#     // This inline script will be allowed by the nonce</span>
<span class="c1">#     console.log(&#39;Hello from a nonced script&#39;);</span>
<span class="c1"># &lt;/script&gt;</span>
<span class="c1">#</span>
<span class="c1"># â”€â”€ Per-view CSP override â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="c1"># from csp.decorators import csp_update, csp_replace, csp_exempt</span>
<span class="c1">#</span>
<span class="c1"># @csp_update(SCRIPT_SRC=(&quot;&#39;self&#39;&quot;, &quot;https://cdn.example.com&quot;))</span>
<span class="c1"># def my_view(request):</span>
<span class="c1">#     ...</span>
<span class="c1">#</span>
<span class="c1"># @csp_exempt  # Disables CSP entirely for this view</span>
<span class="c1"># def legacy_view(request):</span>
<span class="c1">#     ...</span>
</code></pre></div>

<hr />
<h2 id="12-testing-security-headers">12. Testing Security Headers<a class="header-link" href="#12-testing-security-headers" title="Permanent link">&para;</a></h2>
<h3 id="121-testing-with-curl">12.1 Testing with curl<a class="header-link" href="#121-testing-with-curl" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># â”€â”€ View all response headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
curl<span class="w"> </span>-I<span class="w"> </span>https://example.com

<span class="c1"># â”€â”€ Check specific security headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
curl<span class="w"> </span>-sI<span class="w"> </span>https://example.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-iE<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s1">&#39;(content-security|strict-transport|x-content-type|x-frame|referrer-policy|permissions-policy|cross-origin)&#39;</span>

<span class="c1"># â”€â”€ Verbose output to see TLS details too â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
curl<span class="w"> </span>-vI<span class="w"> </span>https://example.com<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-40

<span class="c1"># â”€â”€ Test HSTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
curl<span class="w"> </span>-sI<span class="w"> </span>https://example.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>strict-transport

<span class="c1"># â”€â”€ Test CSP in report-only mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
curl<span class="w"> </span>-sI<span class="w"> </span>https://example.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>content-security-policy

<span class="c1"># â”€â”€ Check for missing headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nv">HEADERS_TO_CHECK</span><span class="o">=(</span>
<span class="w">    </span><span class="s2">&quot;Content-Security-Policy&quot;</span>
<span class="w">    </span><span class="s2">&quot;Strict-Transport-Security&quot;</span>
<span class="w">    </span><span class="s2">&quot;X-Content-Type-Options&quot;</span>
<span class="w">    </span><span class="s2">&quot;X-Frame-Options&quot;</span>
<span class="w">    </span><span class="s2">&quot;Referrer-Policy&quot;</span>
<span class="w">    </span><span class="s2">&quot;Permissions-Policy&quot;</span>
<span class="o">)</span>

<span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://example.com&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Checking security headers for </span><span class="nv">$URL</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;==================================&quot;</span>

<span class="k">for</span><span class="w"> </span>header<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HEADERS_TO_CHECK</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">result</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-sI<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;^</span><span class="nv">$header</span><span class="s2">:&quot;</span><span class="k">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$result</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[PASS] </span><span class="nv">$result</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[FAIL] Missing: </span><span class="nv">$header</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">done</span>
</code></pre></div>

<h3 id="122-python-security-header-scanner">12.2 Python Security Header Scanner<a class="header-link" href="#122-python-security-header-scanner" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A simple security header scanner.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HeaderCheck</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">present</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># &#39;critical&#39;, &#39;high&#39;, &#39;medium&#39;, &#39;low&#39;</span>
    <span class="n">recommendation</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span><span class="w"> </span><span class="nf">scan_security_headers</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">HeaderCheck</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan a URL for security headers and return findings.&quot;&quot;&quot;</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># â”€â”€ Content-Security-Policy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="n">csp</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HeaderCheck</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">,</span>
        <span class="n">present</span><span class="o">=</span><span class="n">csp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">csp</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span>
        <span class="n">recommendation</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Add CSP header. Start with: &quot;</span>
            <span class="s2">&quot;Content-Security-Policy: default-src &#39;self&#39;; &quot;</span>
            <span class="s2">&quot;object-src &#39;none&#39;; base-uri &#39;self&#39;&quot;</span>
        <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">csp</span> <span class="k">else</span> <span class="n">_analyze_csp</span><span class="p">(</span><span class="n">csp</span><span class="p">)</span>
    <span class="p">))</span>

    <span class="c1"># â”€â”€ Strict-Transport-Security â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="n">hsts</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HeaderCheck</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="p">,</span>
        <span class="n">present</span><span class="o">=</span><span class="n">hsts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">hsts</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span>
        <span class="n">recommendation</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Add HSTS header: &quot;</span>
            <span class="s2">&quot;Strict-Transport-Security: max-age=31536000; &quot;</span>
            <span class="s2">&quot;includeSubDomains; preload&quot;</span>
        <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">hsts</span> <span class="k">else</span> <span class="n">_analyze_hsts</span><span class="p">(</span><span class="n">hsts</span><span class="p">)</span>
    <span class="p">))</span>

    <span class="c1"># â”€â”€ X-Content-Type-Options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="n">xcto</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Content-Type-Options&#39;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HeaderCheck</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X-Content-Type-Options&#39;</span><span class="p">,</span>
        <span class="n">present</span><span class="o">=</span><span class="n">xcto</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">xcto</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
        <span class="n">recommendation</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Add header: X-Content-Type-Options: nosniff&quot;</span>
        <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">xcto</span> <span class="k">else</span> <span class="s2">&quot;OK&quot;</span>
    <span class="p">))</span>

    <span class="c1"># â”€â”€ X-Frame-Options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="n">xfo</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Frame-Options&#39;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HeaderCheck</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X-Frame-Options&#39;</span><span class="p">,</span>
        <span class="n">present</span><span class="o">=</span><span class="n">xfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">xfo</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
        <span class="n">recommendation</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Add header: X-Frame-Options: DENY &quot;</span>
            <span class="s2">&quot;(or SAMEORIGIN if framing is needed)&quot;</span>
        <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">xfo</span> <span class="k">else</span> <span class="s2">&quot;OK&quot;</span>
    <span class="p">))</span>

    <span class="c1"># â”€â”€ Referrer-Policy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="n">rp</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Referrer-Policy&#39;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HeaderCheck</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Referrer-Policy&#39;</span><span class="p">,</span>
        <span class="n">present</span><span class="o">=</span><span class="n">rp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">rp</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
        <span class="n">recommendation</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Add header: Referrer-Policy: &quot;</span>
            <span class="s2">&quot;strict-origin-when-cross-origin&quot;</span>
        <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">rp</span> <span class="k">else</span> <span class="s2">&quot;OK&quot;</span>
    <span class="p">))</span>

    <span class="c1"># â”€â”€ Permissions-Policy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Permissions-Policy&#39;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HeaderCheck</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Permissions-Policy&#39;</span><span class="p">,</span>
        <span class="n">present</span><span class="o">=</span><span class="n">pp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">pp</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
        <span class="n">recommendation</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Add header: Permissions-Policy: &quot;</span>
            <span class="s2">&quot;camera=(), microphone=(), geolocation=()&quot;</span>
        <span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pp</span> <span class="k">else</span> <span class="s2">&quot;OK&quot;</span>
    <span class="p">))</span>

    <span class="c1"># â”€â”€ Check for dangerous headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HeaderCheck</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Server&#39;</span><span class="p">,</span>
            <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">server</span><span class="p">,</span>
            <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">,</span>
            <span class="n">recommendation</span><span class="o">=</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Server header reveals: &#39;</span><span class="si">{</span><span class="n">server</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="s2">&quot;Consider removing or obfuscating.&quot;</span>
            <span class="p">)</span>
        <span class="p">))</span>

    <span class="n">x_powered</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Powered-By&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_powered</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HeaderCheck</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X-Powered-By&#39;</span><span class="p">,</span>
            <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">x_powered</span><span class="p">,</span>
            <span class="n">severity</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
            <span class="n">recommendation</span><span class="o">=</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;X-Powered-By reveals: &#39;</span><span class="si">{</span><span class="n">x_powered</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="s2">&quot;Remove this header to avoid information disclosure.&quot;</span>
            <span class="p">)</span>
        <span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_analyze_csp</span><span class="p">(</span><span class="n">csp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze a CSP policy for common weaknesses.&quot;&quot;&quot;</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s2">&quot;&#39;unsafe-inline&#39;&quot;</span> <span class="ow">in</span> <span class="n">csp</span> <span class="ow">and</span> <span class="s1">&#39;script-src&#39;</span> <span class="ow">in</span> <span class="n">csp</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;script-src allows &#39;unsafe-inline&#39; (weakens XSS protection)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;&#39;unsafe-eval&#39;&quot;</span> <span class="ow">in</span> <span class="n">csp</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Policy allows &#39;unsafe-eval&#39; (enables eval()-based attacks)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;default-src&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">csp</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing default-src fallback directive&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;object-src&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">csp</span> <span class="ow">and</span> <span class="s2">&quot;default-src &#39;none&#39;&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">csp</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing object-src directive (Flash/plugin risks)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;base-uri&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">csp</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing base-uri (can enable dangling markup injection)&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span> <span class="k">if</span> <span class="n">issues</span> <span class="k">else</span> <span class="s2">&quot;OK&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_analyze_hsts</span><span class="p">(</span><span class="n">hsts</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze HSTS header for weaknesses.&quot;&quot;&quot;</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hsts_lower</span> <span class="o">=</span> <span class="n">hsts</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;max-age=&#39;</span> <span class="ow">in</span> <span class="n">hsts_lower</span><span class="p">:</span>
        <span class="c1"># Extract max-age value</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;max-age=(\d+)&#39;</span><span class="p">,</span> <span class="n">hsts_lower</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">max_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">max_age</span> <span class="o">&lt;</span> <span class="mi">31536000</span><span class="p">:</span>
                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;max-age=</span><span class="si">{</span><span class="n">max_age</span><span class="si">}</span><span class="s2"> is less than 1 year (31536000)&quot;</span>
                <span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;includesubdomains&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hsts_lower</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing includeSubDomains&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;preload&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hsts_lower</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing preload (not eligible for browser preload list)&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span> <span class="k">if</span> <span class="n">issues</span> <span class="k">else</span> <span class="s2">&quot;OK&quot;</span>


<span class="c1"># â”€â”€ Usage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;https://example.com&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Scanning: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">scan_security_headers</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;PASS&quot;</span> <span class="k">if</span> <span class="n">check</span><span class="o">.</span><span class="n">present</span> <span class="ow">and</span> <span class="n">check</span><span class="o">.</span><span class="n">recommendation</span> <span class="o">==</span> <span class="s2">&quot;OK&quot;</span> <span class="k">else</span> <span class="s2">&quot;FAIL&quot;</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;[+]&quot;</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;PASS&quot;</span> <span class="k">else</span> <span class="s2">&quot;[-]&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">icon</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">check</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">check</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Value: </span><span class="si">{</span><span class="n">check</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;(not set)&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check</span><span class="o">.</span><span class="n">recommendation</span> <span class="o">!=</span> <span class="s2">&quot;OK&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Recommendation: </span><span class="si">{</span><span class="n">check</span><span class="o">.</span><span class="n">recommendation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="123-online-scanners">12.3 Online Scanners<a class="header-link" href="#123-online-scanners" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Header Scanners                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. SecurityHeaders.com                                              â”‚
â”‚     URL: https://securityheaders.com                                 â”‚
â”‚     Grades: A+ to F                                                  â”‚
â”‚     Checks all major security headers                                â”‚
â”‚                                                                      â”‚
â”‚  2. Mozilla Observatory                                              â”‚
â”‚     URL: https://observatory.mozilla.org                             â”‚
â”‚     Comprehensive scan including CSP analysis                        â”‚
â”‚     Provides remediation advice                                      â”‚
â”‚                                                                      â”‚
â”‚  3. CSP Evaluator (Google)                                           â”‚
â”‚     URL: https://csp-evaluator.withgoogle.com                        â”‚
â”‚     Specialized CSP analysis                                         â”‚
â”‚     Identifies bypasses and weaknesses                               â”‚
â”‚                                                                      â”‚
â”‚  4. Hardenize                                                        â”‚
â”‚     URL: https://www.hardenize.com                                   â”‚
â”‚     Tests headers + TLS + DNS + email security                       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="13-complete-security-headers-template">13. Complete Security Headers Template<a class="header-link" href="#13-complete-security-headers-template" title="Permanent link">&para;</a></h2>
<h3 id="131-nginx-configuration">13.1 Nginx Configuration<a class="header-link" href="#131-nginx-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/nginx/conf.d/security-headers.conf</span>
<span class="c1"># Include this in your server block</span>

<span class="c1"># Content-Security-Policy</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">Content-Security-Policy</span>
<span class="w">    </span><span class="s">&quot;default-src</span><span class="w"> </span><span class="s">&#39;self&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">script-src</span><span class="w"> </span><span class="s">&#39;self&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">style-src</span><span class="w"> </span><span class="s">&#39;self&#39;</span><span class="w"> </span><span class="s">&#39;unsafe-inline&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">img-src</span><span class="w"> </span><span class="s">&#39;self&#39;</span><span class="w"> </span><span class="s">data:</span><span class="p">;</span><span class="w"> </span><span class="k">font-src</span><span class="w"> </span><span class="s">&#39;self&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">connect-src</span><span class="w"> </span><span class="s">&#39;self&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">object-src</span><span class="w"> </span><span class="s">&#39;none&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">base-uri</span><span class="w"> </span><span class="s">&#39;self&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">form-action</span><span class="w"> </span><span class="s">&#39;self&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">frame-ancestors</span><span class="w"> </span><span class="s">&#39;none&#39;&quot;</span>
<span class="w">    </span><span class="s">always</span><span class="p">;</span>

<span class="c1"># HSTS (only enable when you are sure HTTPS works everywhere)</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">Strict-Transport-Security</span>
<span class="w">    </span><span class="s">&quot;max-age=31536000</span><span class="p">;</span><span class="w"> </span><span class="k">includeSubDomains</span><span class="p">;</span><span class="w"> </span><span class="k">preload&quot;</span>
<span class="w">    </span><span class="s">always</span><span class="p">;</span>

<span class="c1"># Prevent MIME sniffing</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">X-Content-Type-Options</span><span class="w"> </span><span class="s">&quot;nosniff&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>

<span class="c1"># Clickjacking protection</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">X-Frame-Options</span><span class="w"> </span><span class="s">&quot;DENY&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>

<span class="c1"># Referrer policy</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">Referrer-Policy</span><span class="w"> </span><span class="s">&quot;strict-origin-when-cross-origin&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>

<span class="c1"># Permissions policy</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">Permissions-Policy</span>
<span class="w">    </span><span class="s">&quot;camera=(),</span><span class="w"> </span><span class="s">microphone=(),</span><span class="w"> </span><span class="s">geolocation=(),</span><span class="w"> </span><span class="s">payment=()&quot;</span>
<span class="w">    </span><span class="s">always</span><span class="p">;</span>

<span class="c1"># Cross-origin policies</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">Cross-Origin-Opener-Policy</span><span class="w"> </span><span class="s">&quot;same-origin&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">Cross-Origin-Resource-Policy</span><span class="w"> </span><span class="s">&quot;same-origin&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>
<span class="k">add_header</span><span class="w"> </span><span class="s">Cross-Origin-Embedder-Policy</span><span class="w"> </span><span class="s">&quot;require-corp&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>

<span class="c1"># Remove server version info</span>
<span class="k">server_tokens</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>

<span class="c1"># Remove X-Powered-By (if set by upstream app)</span>
<span class="k">proxy_hide_header</span><span class="w"> </span><span class="s">X-Powered-By</span><span class="p">;</span>
</code></pre></div>

<h3 id="132-apache-configuration">13.2 Apache Configuration<a class="header-link" href="#132-apache-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># .htaccess or httpd.conf</span>

<span class="c"># Content-Security-Policy</span>
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Content-Security-Policy<span class="w"> </span><span class="s2">&quot;\</span>
<span class="s2">default-src &#39;self&#39;; \</span>
<span class="s2">script-src &#39;self&#39;; \</span>
<span class="s2">style-src &#39;self&#39; &#39;unsafe-inline&#39;; \</span>
<span class="s2">img-src &#39;self&#39; data:; \</span>
<span class="s2">font-src &#39;self&#39;; \</span>
<span class="s2">connect-src &#39;self&#39;; \</span>
<span class="s2">object-src &#39;none&#39;; \</span>
<span class="s2">base-uri &#39;self&#39;; \</span>
<span class="s2">form-action &#39;self&#39;; \</span>
<span class="s2">frame-ancestors &#39;none&#39;&quot;</span>

<span class="c"># HSTS</span>
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Strict-Transport-Security<span class="w"> </span>\
<span class="w">    </span><span class="s2">&quot;max-age=31536000; includeSubDomains; preload&quot;</span>

<span class="c"># Other security headers</span>
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>X-Content-Type-Options<span class="w"> </span><span class="s2">&quot;nosniff&quot;</span>
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>X-Frame-Options<span class="w"> </span><span class="s2">&quot;DENY&quot;</span>
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Referrer-Policy<span class="w"> </span><span class="s2">&quot;strict-origin-when-cross-origin&quot;</span>
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Permissions-Policy<span class="w"> </span>\
<span class="w">    </span><span class="s2">&quot;camera=(), microphone=(), geolocation=(), payment=()&quot;</span>
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Cross-Origin-Opener-Policy<span class="w"> </span><span class="s2">&quot;same-origin&quot;</span>
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>set<span class="w"> </span>Cross-Origin-Resource-Policy<span class="w"> </span><span class="s2">&quot;same-origin&quot;</span>

<span class="c"># Remove server information</span>
<span class="nb">ServerTokens</span><span class="w"> </span>Prod
<span class="nb">Header</span><span class="w"> </span>always<span class="w"> </span>unset<span class="w"> </span>X-Powered-By
</code></pre></div>

<hr />
<h2 id="14-exercises">14. Exercises<a class="header-link" href="#14-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-csp-policy-analysis">Exercise 1: CSP Policy Analysis<a class="header-link" href="#exercise-1-csp-policy-analysis" title="Permanent link">&para;</a></h3>
<p>Analyze the following CSP policy and identify all security weaknesses:</p>
<div class="highlight"><pre><span></span><code><span class="nt">Content-Security-Policy</span><span class="o">:</span>
<span class="w">    </span><span class="nt">default-src</span><span class="w"> </span><span class="o">*;</span>
<span class="w">    </span><span class="nt">script-src</span><span class="w"> </span><span class="s1">&#39;self&#39;</span><span class="w"> </span><span class="s1">&#39;unsafe-inline&#39;</span><span class="w"> </span><span class="s1">&#39;unsafe-eval&#39;</span><span class="w"> </span><span class="nt">https</span><span class="o">:;</span>
<span class="w">    </span><span class="nt">style-src</span><span class="w"> </span><span class="s1">&#39;self&#39;</span><span class="w"> </span><span class="s1">&#39;unsafe-inline&#39;</span><span class="o">;</span>
<span class="w">    </span><span class="nt">img-src</span><span class="w"> </span><span class="o">*;</span>
<span class="w">    </span><span class="nt">connect-src</span><span class="w"> </span><span class="o">*;</span>
<span class="w">    </span><span class="nt">font-src</span><span class="w"> </span><span class="o">*</span>
</code></pre></div>

<p>Questions:
1. How many distinct security issues can you identify?
2. For each issue, explain the attack vector it enables.
3. Rewrite the policy to be secure while allowing Google Fonts and a single CDN (<code>cdn.example.com</code>).</p>
<h3 id="exercise-2-flask-security-headers-middleware">Exercise 2: Flask Security Headers Middleware<a class="header-link" href="#exercise-2-flask-security-headers-middleware" title="Permanent link">&para;</a></h3>
<p>Build a Flask middleware class that:</p>
<ol>
<li>Sets all recommended security headers</li>
<li>Generates a unique CSP nonce per request</li>
<li>Makes the nonce available to Jinja2 templates</li>
<li>Allows per-route CSP overrides via a decorator</li>
<li>Supports a "report-only" mode for CSP testing</li>
<li>Logs any header configuration errors</li>
</ol>
<h3 id="exercise-3-header-scanner-enhancement">Exercise 3: Header Scanner Enhancement<a class="header-link" href="#exercise-3-header-scanner-enhancement" title="Permanent link">&para;</a></h3>
<p>Extend the Python security header scanner from section 12.2 to:</p>
<ol>
<li>Check for <code>Cross-Origin-Embedder-Policy</code> and <code>Cross-Origin-Opener-Policy</code></li>
<li>Verify that HSTS max-age is at least 1 year</li>
<li>Detect if <code>X-Powered-By</code> or <code>Server</code> headers reveal version information</li>
<li>Parse and analyze CSP for <code>unsafe-inline</code> and <code>unsafe-eval</code> usage</li>
<li>Generate a grade (A+ to F) based on the scan results</li>
<li>Output results in both text and JSON format</li>
</ol>
<h3 id="exercise-4-sri-hash-generator">Exercise 4: SRI Hash Generator<a class="header-link" href="#exercise-4-sri-hash-generator" title="Permanent link">&para;</a></h3>
<p>Write a Python script that:</p>
<ol>
<li>Takes a list of CDN URLs as input</li>
<li>Downloads each resource</li>
<li>Computes SHA-384 integrity hashes</li>
<li>Generates the complete HTML <code>&lt;script&gt;</code> or <code>&lt;link&gt;</code> tags with integrity attributes</li>
<li>Optionally writes an HTML file with all the tags</li>
<li>Handles errors gracefully (network failures, 404s, etc.)</li>
</ol>
<h3 id="exercise-5-hsts-preload-readiness-check">Exercise 5: HSTS Preload Readiness Check<a class="header-link" href="#exercise-5-hsts-preload-readiness-check" title="Permanent link">&para;</a></h3>
<p>Write a tool that checks whether a domain is ready for HSTS preload submission:</p>
<ol>
<li>Verify the domain has a valid TLS certificate</li>
<li>Check that HTTP redirects to HTTPS</li>
<li>Verify the HSTS header includes <code>max-age &gt;= 31536000</code></li>
<li>Check for <code>includeSubDomains</code> and <code>preload</code> directives</li>
<li>Test common subdomains (www, mail, api) for HTTPS support</li>
<li>Generate a readiness report</li>
</ol>
<h3 id="exercise-6-cross-origin-isolation-audit">Exercise 6: Cross-Origin Isolation Audit<a class="header-link" href="#exercise-6-cross-origin-isolation-audit" title="Permanent link">&para;</a></h3>
<p>For a given web application URL:</p>
<ol>
<li>Check if <code>Cross-Origin-Embedder-Policy</code> is set</li>
<li>Check if <code>Cross-Origin-Opener-Policy</code> is set</li>
<li>Identify all cross-origin resources loaded by the page</li>
<li>For each cross-origin resource, check if it has <code>Cross-Origin-Resource-Policy</code> set</li>
<li>Report which resources would break if COEP: require-corp were enabled</li>
</ol>
<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Header</th>
<th>Attack Prevented</th>
<th>Must Have?</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Security-Policy</td>
<td>XSS, injection</td>
<td>Yes</td>
</tr>
<tr>
<td>Strict-Transport-Security</td>
<td>Protocol downgrade</td>
<td>Yes (HTTPS sites)</td>
</tr>
<tr>
<td>X-Content-Type-Options</td>
<td>MIME confusion</td>
<td>Yes</td>
</tr>
<tr>
<td>X-Frame-Options</td>
<td>Clickjacking</td>
<td>Yes</td>
</tr>
<tr>
<td>Referrer-Policy</td>
<td>Information leak</td>
<td>Yes</td>
</tr>
<tr>
<td>Permissions-Policy</td>
<td>Feature abuse</td>
<td>Recommended</td>
</tr>
<tr>
<td>CORP/COEP/COOP</td>
<td>Spectre, cross-origin</td>
<td>Recommended</td>
</tr>
</tbody>
</table>
<h3 id="key-takeaways">Key Takeaways<a class="header-link" href="#key-takeaways" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Start with report-only mode</strong> â€” deploy CSP in report-only first, fix violations, then enforce</li>
<li><strong>Use nonces over unsafe-inline</strong> â€” nonces provide per-request authorization for inline scripts</li>
<li><strong>HSTS needs gradual rollout</strong> â€” start with short max-age, increase after verifying all subdomains support HTTPS</li>
<li><strong>Defense in depth</strong> â€” security headers complement, not replace, secure coding practices</li>
<li><strong>Test regularly</strong> â€” use automated scanners in CI/CD to catch header regressions</li>
</ol>
<hr />
<p><strong>Previous</strong>: <a href="./08_Injection_Attacks.md">08. Injection Attacks and Prevention</a> | <strong>Next</strong>: <a href="./10_API_Security.md">10_API_Security.md</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/08_Injection_Attacks.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">08. Injection Attacks and Prevention</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Security/10_API_Security.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">API Security</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}