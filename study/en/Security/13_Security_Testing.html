{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Testing - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">Security Testing</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Security Testing</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/12_Container_Security.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Container and Cloud Security</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Security/14_Incident_Response.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Incident Response and Forensics</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-security-testing-overview">1. Security Testing Overview</a><ul>
<li><a href="#11-the-security-testing-pyramid">1.1 The Security Testing Pyramid</a></li>
<li><a href="#12-when-to-apply-each-testing-type">1.2 When to Apply Each Testing Type</a></li>
<li><a href="#13-comparison-of-testing-approaches">1.3 Comparison of Testing Approaches</a></li>
</ul>
</li>
<li><a href="#2-static-application-security-testing-sast">2. Static Application Security Testing (SAST)</a><ul>
<li><a href="#21-how-sast-works">2.1 How SAST Works</a></li>
<li><a href="#22-bandit-python-security-linter">2.2 Bandit: Python Security Linter</a><ul>
<li><a href="#installation-and-basic-usage">Installation and Basic Usage</a></li>
<li><a href="#bandit-test-categories">Bandit Test Categories</a></li>
<li><a href="#bandit-configuration-file">Bandit Configuration File</a></li>
<li><a href="#interpreting-bandit-output">Interpreting Bandit Output</a></li>
<li><a href="#suppressing-false-positives">Suppressing False Positives</a></li>
</ul>
</li>
<li><a href="#23-semgrep-multi-language-static-analysis">2.3 Semgrep: Multi-Language Static Analysis</a><ul>
<li><a href="#installation-and-basic-usage_1">Installation and Basic Usage</a></li>
<li><a href="#writing-custom-semgrep-rules">Writing Custom Semgrep Rules</a></li>
<li><a href="#running-custom-rules">Running Custom Rules</a></li>
<li><a href="#advanced-semgrep-patterns">Advanced Semgrep Patterns</a></li>
</ul>
</li>
<li><a href="#24-sonarqube-overview">2.4 SonarQube Overview</a></li>
</ul>
</li>
<li><a href="#3-dynamic-application-security-testing-dast">3. Dynamic Application Security Testing (DAST)</a><ul>
<li><a href="#31-how-dast-works">3.1 How DAST Works</a></li>
<li><a href="#32-owasp-zap">3.2 OWASP ZAP</a><ul>
<li><a href="#zap-python-api">ZAP Python API</a></li>
</ul>
</li>
<li><a href="#33-burp-suite-concepts">3.3 Burp Suite Concepts</a></li>
</ul>
</li>
<li><a href="#4-software-composition-analysis-sca">4. Software Composition Analysis (SCA)</a><ul>
<li><a href="#41-why-sca-matters">4.1 Why SCA Matters</a></li>
<li><a href="#42-pip-audit">4.2 pip-audit</a><ul>
<li><a href="#example-pip-audit-output">Example pip-audit Output</a></li>
</ul>
</li>
<li><a href="#43-safety">4.3 Safety</a></li>
<li><a href="#44-python-script-dependency-vulnerability-scanner">4.4 Python Script: Dependency Vulnerability Scanner</a></li>
<li><a href="#45-dependabot-configuration-github">4.5 Dependabot Configuration (GitHub)</a></li>
</ul>
</li>
<li><a href="#5-fuzzing">5. Fuzzing</a><ul>
<li><a href="#51-what-is-fuzzing">5.1 What is Fuzzing?</a></li>
<li><a href="#52-afl-american-fuzzy-lop">5.2 AFL (American Fuzzy Lop)</a><ul>
<li><a href="#afl-output-directory-structure">AFL Output Directory Structure</a></li>
</ul>
</li>
<li><a href="#53-hypothesis-property-based-testing-for-python">5.3 Hypothesis: Property-Based Testing for Python</a></li>
<li><a href="#54-fuzzing-network-protocols">5.4 Fuzzing Network Protocols</a></li>
</ul>
</li>
<li><a href="#6-penetration-testing-methodology">6. Penetration Testing Methodology</a><ul>
<li><a href="#61-the-penetration-testing-process">6.1 The Penetration Testing Process</a></li>
<li><a href="#62-web-application-penetration-testing-checklist">6.2 Web Application Penetration Testing Checklist</a></li>
<li><a href="#63-python-penetration-testing-helpers">6.3 Python Penetration Testing Helpers</a></li>
</ul>
</li>
<li><a href="#7-security-code-review-checklist">7. Security Code Review Checklist</a><ul>
<li><a href="#71-code-review-process">7.1 Code Review Process</a></li>
<li><a href="#72-python-specific-security-review-checklist">7.2 Python-Specific Security Review Checklist</a></li>
</ul>
</li>
<li><a href="#8-cicd-security-pipeline-integration">8. CI/CD Security Pipeline Integration</a><ul>
<li><a href="#81-github-actions-security-pipeline">8.1 GitHub Actions Security Pipeline</a></li>
<li><a href="#82-pre-commit-hooks-for-security">8.2 Pre-commit Hooks for Security</a></li>
<li><a href="#83-gitlab-ci-security-pipeline">8.3 GitLab CI Security Pipeline</a></li>
</ul>
</li>
<li><a href="#9-comprehensive-security-scanning-script">9. Comprehensive Security Scanning Script</a></li>
<li><a href="#10-exercises">10. Exercises</a><ul>
<li><a href="#exercise-1-bandit-scan-analysis">Exercise 1: Bandit Scan Analysis</a></li>
<li><a href="#exercise-2-write-custom-semgrep-rules">Exercise 2: Write Custom Semgrep Rules</a></li>
<li><a href="#exercise-3-dependency-audit">Exercise 3: Dependency Audit</a></li>
<li><a href="#exercise-4-property-based-testing">Exercise 4: Property-Based Testing</a></li>
<li><a href="#exercise-5-cicd-security-pipeline">Exercise 5: CI/CD Security Pipeline</a></li>
<li><a href="#exercise-6-security-code-review">Exercise 6: Security Code Review</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="security-testing">Security Testing<a class="header-link" href="#security-testing" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./12_Container_Security.md">12. Container and Cloud Security</a> | <strong>Next</strong>: <a href="14_Incident_Response.md">14. Incident Response and Forensics</a></p>
<hr />
<p>Security testing is the systematic process of finding vulnerabilities in software before attackers do. This lesson covers the major categories of security testing -- Static Application Security Testing (SAST), Dynamic Application Security Testing (DAST), Software Composition Analysis (SCA), and fuzzing -- along with penetration testing methodology and CI/CD integration. By the end, you will be able to build a comprehensive security testing pipeline for your projects.</p>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand the differences between SAST, DAST, SCA, and fuzzing</li>
<li>Use Bandit and Semgrep to find vulnerabilities in Python code</li>
<li>Write custom Semgrep rules for project-specific patterns</li>
<li>Integrate security scanning into CI/CD pipelines</li>
<li>Apply penetration testing methodology</li>
<li>Conduct effective security code reviews</li>
</ul>
<hr />
<h2 id="1-security-testing-overview">1. Security Testing Overview<a class="header-link" href="#1-security-testing-overview" title="Permanent link">&para;</a></h2>
<h3 id="11-the-security-testing-pyramid">1.1 The Security Testing Pyramid<a class="header-link" href="#11-the-security-testing-pyramid" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Security Testing Pyramid                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚                         /\                                       â”‚
â”‚                        /  \        Manual Penetration Testing    â”‚
â”‚                       / PT \       (Most expensive, most         â”‚
â”‚                      /      \       thorough for logic flaws)    â”‚
â”‚                     /--------\                                   â”‚
â”‚                    /   DAST   \     Dynamic testing against      â”‚
â”‚                   /            \    running application           â”‚
â”‚                  /--------------\                                 â”‚
â”‚                 /    Fuzzing     \   Automated input mutation    â”‚
â”‚                /                  \  for crash discovery          â”‚
â”‚               /--------------------\                             â”‚
â”‚              /        SCA           \  Dependency vulnerability  â”‚
â”‚             /                        \ scanning                  â”‚
â”‚            /--------------------------\                          â”‚
â”‚           /           SAST             \ Static code analysis   â”‚
â”‚          /                              \ (Cheapest, fastest,   â”‚
â”‚         /________________________________\ most automatable)    â”‚
â”‚                                                                  â”‚
â”‚  â—„â”€â”€ Cost/Effort increases going up                             â”‚
â”‚  â—„â”€â”€ Automation decreases going up                              â”‚
â”‚  â—„â”€â”€ Each layer catches different vulnerability classes          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-when-to-apply-each-testing-type">1.2 When to Apply Each Testing Type<a class="header-link" href="#12-when-to-apply-each-testing-type" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SDLC Security Testing Map                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Code Write â”€â”€â–º Commit â”€â”€â–º Build â”€â”€â–º Deploy â”€â”€â–º Production       â”‚
â”‚      â”‚            â”‚          â”‚         â”‚            â”‚              â”‚
â”‚      â–¼            â–¼          â–¼         â–¼            â–¼              â”‚
â”‚    IDE         Pre-commit   CI/CD    Staging     Continuous       â”‚
â”‚  Linting       Hooks       Pipeline  Testing     Monitoring       â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ SAST â”‚   â”‚SAST + SCAâ”‚  â”‚ All  â”‚  â”‚ DAST â”‚  â”‚ Runtime  â”‚     â”‚
â”‚  â”‚(IDE) â”‚   â”‚(pre-push)â”‚  â”‚Types â”‚  â”‚  PT  â”‚  â”‚ Scanning â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="13-comparison-of-testing-approaches">1.3 Comparison of Testing Approaches<a class="header-link" href="#13-comparison-of-testing-approaches" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>SAST</th>
<th>DAST</th>
<th>SCA</th>
<th>Fuzzing</th>
<th>PT</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Requires running app</strong></td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Sometimes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Language-specific</strong></td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Varies</td>
<td>No</td>
</tr>
<tr>
<td><strong>False positive rate</strong></td>
<td>High</td>
<td>Medium</td>
<td>Low</td>
<td>Low</td>
<td>Very Low</td>
</tr>
<tr>
<td><strong>Finds logic flaws</strong></td>
<td>Rarely</td>
<td>Sometimes</td>
<td>No</td>
<td>Rarely</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Automation level</strong></td>
<td>Full</td>
<td>Full</td>
<td>Full</td>
<td>Full</td>
<td>Partial</td>
</tr>
<tr>
<td><strong>Speed</strong></td>
<td>Fast</td>
<td>Slow</td>
<td>Fast</td>
<td>Medium</td>
<td>Very Slow</td>
</tr>
<tr>
<td><strong>Coverage</strong></td>
<td>Code paths</td>
<td>Attack surface</td>
<td>Dependencies</td>
<td>Input space</td>
<td>Targeted</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-static-application-security-testing-sast">2. Static Application Security Testing (SAST)<a class="header-link" href="#2-static-application-security-testing-sast" title="Permanent link">&para;</a></h2>
<h3 id="21-how-sast-works">2.1 How SAST Works<a class="header-link" href="#21-how-sast-works" title="Permanent link">&para;</a></h3>
<p>SAST tools analyze source code (or bytecode) without executing it. They build an abstract syntax tree (AST) or control/data flow graph and match patterns that indicate potential vulnerabilities.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SAST Analysis Pipeline                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Source Code                                                     â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚  Parser   â”‚ â”€â”€â–º Abstract Syntax Tree (AST)                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  Control Flow     â”‚ â”€â”€â–º CFG: execution paths                 â”‚
â”‚  â”‚  Analysis         â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  Data Flow        â”‚ â”€â”€â–º Taint tracking: source â†’ sink        â”‚
â”‚  â”‚  Analysis         â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  Pattern Matching â”‚ â”€â”€â–º Known vulnerability patterns         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚      â”‚                                                           â”‚
â”‚      â–¼                                                           â”‚
â”‚  Vulnerability Report                                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="22-bandit-python-security-linter">2.2 Bandit: Python Security Linter<a class="header-link" href="#22-bandit-python-security-linter" title="Permanent link">&para;</a></h3>
<p>Bandit is the most popular SAST tool for Python. It checks for common security issues like hardcoded passwords, use of <code>eval()</code>, insecure hash functions, and SQL injection patterns.</p>
<h4 id="installation-and-basic-usage">Installation and Basic Usage<a class="header-link" href="#installation-and-basic-usage" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Install Bandit</span>
pip<span class="w"> </span>install<span class="w"> </span>bandit

<span class="c1"># Scan a single file</span>
bandit<span class="w"> </span>target_file.py

<span class="c1"># Scan an entire directory</span>
bandit<span class="w"> </span>-r<span class="w"> </span>./myproject/

<span class="c1"># Scan with specific severity level</span>
bandit<span class="w"> </span>-r<span class="w"> </span>./myproject/<span class="w"> </span>-ll<span class="w">  </span><span class="c1"># Medium and above</span>
bandit<span class="w"> </span>-r<span class="w"> </span>./myproject/<span class="w"> </span>-lll<span class="w">  </span><span class="c1"># High severity only</span>

<span class="c1"># Output formats</span>
bandit<span class="w"> </span>-r<span class="w"> </span>./myproject/<span class="w"> </span>-f<span class="w"> </span>json<span class="w"> </span>-o<span class="w"> </span>bandit_report.json
bandit<span class="w"> </span>-r<span class="w"> </span>./myproject/<span class="w"> </span>-f<span class="w"> </span>html<span class="w"> </span>-o<span class="w"> </span>bandit_report.html
bandit<span class="w"> </span>-r<span class="w"> </span>./myproject/<span class="w"> </span>-f<span class="w"> </span>csv<span class="w"> </span>-o<span class="w"> </span>bandit_report.csv

<span class="c1"># Exclude specific tests</span>
bandit<span class="w"> </span>-r<span class="w"> </span>./myproject/<span class="w"> </span>--skip<span class="w"> </span>B101,B601

<span class="c1"># Include only specific tests</span>
bandit<span class="w"> </span>-r<span class="w"> </span>./myproject/<span class="w"> </span>--tests<span class="w"> </span>B301,B302,B303
</code></pre></div>

<h4 id="bandit-test-categories">Bandit Test Categories<a class="header-link" href="#bandit-test-categories" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Bandit test categories and what they detect.</span>
<span class="sd">Each test has an ID like B101, B102, etc.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€â”€ B1xx: General security issues â”€â”€â”€</span>

<span class="c1"># B101: assert_used - asserts are removed with -O flag</span>
<span class="k">assert</span> <span class="n">user</span><span class="o">.</span><span class="n">is_admin</span>  <span class="c1"># WARNING: B101</span>

<span class="c1"># B102: exec_used</span>
<span class="n">exec</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>  <span class="c1"># WARNING: B102</span>

<span class="c1"># B103: set_bad_file_permissions</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="s1">&#39;/etc/shadow&#39;</span><span class="p">,</span> <span class="mo">0o777</span><span class="p">)</span>  <span class="c1"># WARNING: B103</span>

<span class="c1"># B104: hardcoded_bind_all_interfaces</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>  <span class="c1"># WARNING: B104</span>

<span class="c1"># B105-B107: hardcoded passwords</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;SuperSecret123&quot;</span>  <span class="c1"># WARNING: B105</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;admin123&quot;</span><span class="p">}</span>  <span class="c1"># WARNING: B106</span>


<span class="c1"># â”€â”€â”€ B2xx: Cryptographic issues â”€â”€â”€</span>

<span class="c1"># B301: pickle usage (deserialization attack)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>  <span class="c1"># WARNING: B301</span>

<span class="c1"># B303: insecure hash function</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>  <span class="c1"># WARNING: B303</span>

<span class="c1"># B304-B305: insecure cipher</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">DES</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">DES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">DES</span><span class="o">.</span><span class="n">MODE_ECB</span><span class="p">)</span>  <span class="c1"># WARNING: B304</span>


<span class="c1"># â”€â”€â”€ B3xx: Injection issues â”€â”€â”€</span>

<span class="c1"># B601: paramiko shell injection</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">paramiko</span>
<span class="n">client</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>  <span class="c1"># WARNING: B601</span>

<span class="c1"># B602: subprocess with shell=True</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">user_input</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># WARNING: B602</span>

<span class="c1"># B608: SQL injection via string formatting</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE id = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">user_id</span>  <span class="c1"># WARNING: B608</span>


<span class="c1"># â”€â”€â”€ B5xx: Cryptographic and SSL issues â”€â”€â”€</span>

<span class="c1"># B501: request with verify=False</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># WARNING: B501</span>

<span class="c1"># B502: ssl with no version check</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span><span class="p">()</span>  <span class="c1"># WARNING: B502</span>


<span class="c1"># â”€â”€â”€ B6xx: Injection issues (continued) â”€â”€â”€</span>

<span class="c1"># B610-B611: Django SQL injection</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="p">[</span><span class="n">user_input</span><span class="p">])</span>  <span class="c1"># WARNING: B610</span>

<span class="c1"># B701: Jinja2 autoescape disabled</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jinja2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">autoescape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># WARNING: B701</span>
</code></pre></div>

<h4 id="bandit-configuration-file">Bandit Configuration File<a class="header-link" href="#bandit-configuration-file" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># .bandit.yaml (or setup.cfg [bandit] section)</span>

<span class="c1"># Tests to skip</span>
<span class="nt">skips</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B101</span><span class="w">  </span><span class="c1"># assert_used (acceptable in test files)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B601</span><span class="w">  </span><span class="c1"># paramiko (we sanitize inputs)</span>

<span class="c1"># Paths to exclude</span>
<span class="nt">exclude_dirs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tests</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">venv</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.tox</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">migrations</span>

<span class="c1"># Set severity threshold</span>
<span class="c1"># Only report issues of this severity or higher</span>
<span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOW</span>

<span class="c1"># Set confidence threshold</span>
<span class="nt">confidence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOW</span>
</code></pre></div>

<h4 id="interpreting-bandit-output">Interpreting Bandit Output<a class="header-link" href="#interpreting-bandit-output" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Run bandit on a sample vulnerable file</span>
$<span class="w"> </span>bandit<span class="w"> </span>-r<span class="w"> </span>vulnerable_app.py

Run<span class="w"> </span>started:2025-01-15<span class="w"> </span><span class="m">10</span>:30:00

Test<span class="w"> </span>results:
&gt;&gt;<span class="w"> </span>Issue:<span class="w"> </span><span class="o">[</span>B608:hardcoded_sql_expressions<span class="o">]</span><span class="w"> </span>Possible<span class="w"> </span>SQL<span class="w"> </span>injection<span class="w"> </span>vector
<span class="w">   </span>through<span class="w"> </span>string-based<span class="w"> </span>query<span class="w"> </span>construction.
<span class="w">   </span>Severity:<span class="w"> </span>Medium<span class="w">   </span>Confidence:<span class="w"> </span>Low
<span class="w">   </span>CWE:<span class="w"> </span>CWE-89<span class="w"> </span><span class="o">(</span>https://cwe.mitre.org/data/definitions/89.html<span class="o">)</span>
<span class="w">   </span>Location:<span class="w"> </span>vulnerable_app.py:42:0
<span class="w">   </span>More<span class="w"> </span>Info:<span class="w"> </span>https://bandit.readthedocs.io/en/latest/plugins/b608...
<span class="m">41</span><span class="w">      </span><span class="nv">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>request.args.get<span class="o">(</span><span class="s1">&#39;id&#39;</span><span class="o">)</span>
<span class="m">42</span><span class="w">      </span><span class="nv">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">&quot;SELECT * FROM users WHERE id = &#39;{user_id}&#39;&quot;</span>
<span class="m">43</span><span class="w">      </span>cursor.execute<span class="o">(</span>query<span class="o">)</span>

&gt;&gt;<span class="w"> </span>Issue:<span class="w"> </span><span class="o">[</span>B105:hardcoded_password_string<span class="o">]</span><span class="w"> </span>Possible<span class="w"> </span>hardcoded<span class="w"> </span>password
<span class="w">   </span>Severity:<span class="w"> </span>Low<span class="w">   </span>Confidence:<span class="w"> </span>Medium
<span class="w">   </span>CWE:<span class="w"> </span>CWE-259<span class="w"> </span><span class="o">(</span>https://cwe.mitre.org/data/definitions/259.html<span class="o">)</span>
<span class="w">   </span>Location:<span class="w"> </span>vulnerable_app.py:15:0
<span class="m">14</span>
<span class="m">15</span><span class="w">      </span><span class="nv">DATABASE_PASSWORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;admin123&quot;</span>
<span class="m">16</span>

--------------------------------------------------
Code<span class="w"> </span>scanned:
<span class="w">    </span>Total<span class="w"> </span>lines<span class="w"> </span>of<span class="w"> </span>code:<span class="w"> </span><span class="m">156</span>
<span class="w">    </span>Total<span class="w"> </span>lines<span class="w"> </span>skipped<span class="w"> </span><span class="o">(</span><span class="c1">#nosec): 0</span>

Run<span class="w"> </span>metrics:
<span class="w">    </span>Total<span class="w"> </span>issues<span class="w"> </span><span class="o">(</span>by<span class="w"> </span>severity<span class="o">)</span>:
<span class="w">        </span>Undefined:<span class="w"> </span><span class="m">0</span>
<span class="w">        </span>Low:<span class="w"> </span><span class="m">1</span>
<span class="w">        </span>Medium:<span class="w"> </span><span class="m">1</span>
<span class="w">        </span>High:<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>Total<span class="w"> </span>issues<span class="w"> </span><span class="o">(</span>by<span class="w"> </span>confidence<span class="o">)</span>:
<span class="w">        </span>Undefined:<span class="w"> </span><span class="m">0</span>
<span class="w">        </span>Low:<span class="w"> </span><span class="m">1</span>
<span class="w">        </span>Medium:<span class="w"> </span><span class="m">1</span>
<span class="w">        </span>High:<span class="w"> </span><span class="m">0</span>
Files<span class="w"> </span>skipped<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span>:
</code></pre></div>

<h4 id="suppressing-false-positives">Suppressing False Positives<a class="header-link" href="#suppressing-false-positives" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Method 1: Inline suppression with #nosec</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="c1"># This MD5 is for non-security checksum, not password hashing</span>
<span class="n">checksum</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>  <span class="c1"># nosec B303</span>

<span class="c1"># Method 2: Inline with specific test ID</span>
<span class="n">password_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">salt</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span>  <span class="c1"># nosec B303</span>

<span class="c1"># Method 3: Using a baseline file</span>
<span class="c1"># Generate baseline (captures current issues)</span>
<span class="c1"># bandit -r ./myproject/ -f json -o baseline.json</span>
<span class="c1"># Run against baseline (only shows NEW issues)</span>
<span class="c1"># bandit -r ./myproject/ -b baseline.json</span>
</code></pre></div>

<h3 id="23-semgrep-multi-language-static-analysis">2.3 Semgrep: Multi-Language Static Analysis<a class="header-link" href="#23-semgrep-multi-language-static-analysis" title="Permanent link">&para;</a></h3>
<p>Semgrep is a fast, open-source SAST tool that supports 30+ languages and uses a pattern-matching approach that is easy to understand and extend.</p>
<h4 id="installation-and-basic-usage_1">Installation and Basic Usage<a class="header-link" href="#installation-and-basic-usage_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Install Semgrep</span>
pip<span class="w"> </span>install<span class="w"> </span>semgrep

<span class="c1"># Run with default rules</span>
semgrep<span class="w"> </span>--config<span class="w"> </span>auto<span class="w"> </span>.

<span class="c1"># Run with specific rulesets</span>
semgrep<span class="w"> </span>--config<span class="w"> </span>p/python<span class="w"> </span>.
semgrep<span class="w"> </span>--config<span class="w"> </span>p/flask<span class="w"> </span>.
semgrep<span class="w"> </span>--config<span class="w"> </span>p/django<span class="w"> </span>.
semgrep<span class="w"> </span>--config<span class="w"> </span>p/owasp-top-ten<span class="w"> </span>.
semgrep<span class="w"> </span>--config<span class="w"> </span>p/security-audit<span class="w"> </span>.

<span class="c1"># Run with a local rule file</span>
semgrep<span class="w"> </span>--config<span class="w"> </span>my_rules.yaml<span class="w"> </span>.

<span class="c1"># Output formats</span>
semgrep<span class="w"> </span>--config<span class="w"> </span>auto<span class="w"> </span>.<span class="w"> </span>--json<span class="w"> </span>&gt;<span class="w"> </span>report.json
semgrep<span class="w"> </span>--config<span class="w"> </span>auto<span class="w"> </span>.<span class="w"> </span>--sarif<span class="w"> </span>&gt;<span class="w"> </span>report.sarif
</code></pre></div>

<h4 id="writing-custom-semgrep-rules">Writing Custom Semgrep Rules<a class="header-link" href="#writing-custom-semgrep-rules" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># custom_rules.yaml</span>

<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Rule 1: Detect SQL injection via f-strings</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql-injection-fstring</span>
<span class="w">    </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">$CURSOR.execute(f&quot;...{$VAR}...&quot;)</span>
<span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">Potential SQL injection via f-string interpolation.</span>
<span class="w">      </span><span class="no">Use parameterized queries instead:</span>
<span class="w">      </span><span class="no">cursor.execute(&quot;SELECT * FROM users WHERE id = %s&quot;, (user_id,))</span>
<span class="w">    </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ERROR</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cwe</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CWE-89</span>
<span class="w">      </span><span class="nt">owasp</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A03:2021 Injection</span>
<span class="w">      </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">      </span><span class="nt">technology</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>

<span class="w">  </span><span class="c1"># Rule 2: Detect hardcoded JWT secrets</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hardcoded-jwt-secret</span>
<span class="w">    </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">jwt.encode($PAYLOAD, &quot;...&quot;, ...)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern-not</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">jwt.encode($PAYLOAD, $CONFIG, ...)</span>
<span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">JWT token is signed with a hardcoded secret.</span>
<span class="w">      </span><span class="no">Use environment variable or secret management service.</span>
<span class="w">    </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ERROR</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cwe</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CWE-798</span>

<span class="w">  </span><span class="c1"># Rule 3: Detect missing rate limiting on login</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login-no-rate-limit</span>
<span class="w">    </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">@$APP.route(&quot;/login&quot;, ...)</span>
<span class="w">          </span><span class="no">def $FUNC(...):</span>
<span class="w">              </span><span class="no">...</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern-not-inside</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">@limiter.limit(...)</span>
<span class="w">          </span><span class="no">@$APP.route(&quot;/login&quot;, ...)</span>
<span class="w">          </span><span class="no">def $FUNC(...):</span>
<span class="w">              </span><span class="no">...</span>
<span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">Login endpoint without rate limiting. Add @limiter.limit()</span>
<span class="w">      </span><span class="no">to prevent brute force attacks.</span>
<span class="w">    </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WARNING</span>

<span class="w">  </span><span class="c1"># Rule 4: Detect eval/exec with user input</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dangerous-eval-user-input</span>
<span class="w">    </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern-either</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval(request.$METHOD.get(...))</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exec(request.$METHOD.get(...))</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">$X = request.$METHOD.get(...)</span>
<span class="w">              </span><span class="no">...</span>
<span class="w">              </span><span class="no">eval($X)</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">$X = request.$METHOD.get(...)</span>
<span class="w">              </span><span class="no">...</span>
<span class="w">              </span><span class="no">exec($X)</span>
<span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">User input is passed to eval()/exec(). This allows</span>
<span class="w">      </span><span class="no">arbitrary code execution. Never use eval/exec with</span>
<span class="w">      </span><span class="no">untrusted input.</span>
<span class="w">    </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ERROR</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cwe</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CWE-95</span>

<span class="w">  </span><span class="c1"># Rule 5: Detect missing CSRF protection in Flask forms</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flask-form-no-csrf</span>
<span class="w">    </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">@$APP.route(&quot;...&quot;, methods=[..., &quot;POST&quot;, ...])</span>
<span class="w">          </span><span class="no">def $FUNC(...):</span>
<span class="w">              </span><span class="no">...</span>
<span class="w">              </span><span class="no">$X = request.form[...]</span>
<span class="w">              </span><span class="no">...</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern-not-inside</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">@csrf.exempt</span>
<span class="w">          </span><span class="no">...</span>
<span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">POST endpoint processes form data. Ensure CSRF protection</span>
<span class="w">      </span><span class="no">is enabled via Flask-WTF or manual token validation.</span>
<span class="w">    </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WARNING</span>
</code></pre></div>

<h4 id="running-custom-rules">Running Custom Rules<a class="header-link" href="#running-custom-rules" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Test a custom rule</span>
semgrep<span class="w"> </span>--config<span class="w"> </span>custom_rules.yaml<span class="w"> </span>./myproject/

<span class="c1"># Combine custom rules with standard rulesets</span>
semgrep<span class="w"> </span>--config<span class="w"> </span>custom_rules.yaml<span class="w"> </span>--config<span class="w"> </span>p/python<span class="w"> </span>./myproject/

<span class="c1"># Test rule against a specific file</span>
semgrep<span class="w"> </span>--config<span class="w"> </span>custom_rules.yaml<span class="w"> </span>target_file.py

<span class="c1"># Validate rule syntax</span>
semgrep<span class="w"> </span>--validate<span class="w"> </span>--config<span class="w"> </span>custom_rules.yaml
</code></pre></div>

<h4 id="advanced-semgrep-patterns">Advanced Semgrep Patterns<a class="header-link" href="#advanced-semgrep-patterns" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Taint tracking: trace data from source to sink</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flask-ssrf</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">taint</span>
<span class="w">    </span><span class="nt">pattern-sources</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request.$METHOD.get(...)</span>
<span class="w">    </span><span class="nt">pattern-sinks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">requests.get($URL, ...)</span>
<span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">      </span><span class="no">User input flows into an HTTP request, possible SSRF.</span>
<span class="w">    </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ERROR</span>

<span class="w">  </span><span class="c1"># Metavariable comparison</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">weak-rsa-key</span>
<span class="w">    </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rsa.generate_private_key(public_exponent=65537, key_size=$SIZE)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metavariable-comparison</span><span class="p">:</span>
<span class="w">          </span><span class="nt">metavariable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$SIZE</span>
<span class="w">          </span><span class="nt">comparison</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$SIZE &lt; 2048</span>
<span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RSA key size $SIZE is too small. Use at least 2048 bits.</span>
<span class="w">    </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ERROR</span>

<span class="w">  </span><span class="c1"># Pattern with focus on specific metavariable</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unvalidated-redirect</span>
<span class="w">    </span><span class="nt">patterns</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redirect($URL)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern-not</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redirect(url_for(...))</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">focus-metavariable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$URL</span>
<span class="w">    </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Potential open redirect. Use url_for() for safe redirects.</span>
<span class="w">    </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">python</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WARNING</span>
</code></pre></div>

<h3 id="24-sonarqube-overview">2.4 SonarQube Overview<a class="header-link" href="#24-sonarqube-overview" title="Permanent link">&para;</a></h3>
<p>SonarQube is an enterprise-grade platform for continuous code quality and security inspection.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SonarQube Architecture                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Developer Machine              SonarQube Server                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Source Code  â”‚    scan     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
â”‚  â”‚      +        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚  â”‚   Analyzer   â”‚  â”‚             â”‚
â”‚  â”‚ sonar-scanner â”‚             â”‚  â”‚   Engine     â”‚  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚                                â”‚         â”‚         â”‚             â”‚
â”‚  CI/CD Pipeline                â”‚         â–¼         â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
â”‚  â”‚  Build Step   â”‚   report   â”‚  â”‚   Database   â”‚  â”‚             â”‚
â”‚  â”‚  + Scanner    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚  â”‚ (PostgreSQL) â”‚  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚                                â”‚         â”‚         â”‚             â”‚
â”‚                                â”‚         â–¼         â”‚             â”‚
â”‚  Web Browser                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚  Web UI /    â”‚  â”‚             â”‚
â”‚  â”‚  Dashboard    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  Dashboard   â”‚  â”‚             â”‚
â”‚  â”‚  &amp; Reports    â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Running SonarQube with Docker</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>sonarqube<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="m">9000</span>:9000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>sonarqube:community

<span class="c1"># Configure project: sonar-project.properties</span>
<span class="c1"># sonar.projectKey=my-python-project</span>
<span class="c1"># sonar.sources=src</span>
<span class="c1"># sonar.python.version=3.11</span>
<span class="c1"># sonar.exclusions=**/tests/**,**/migrations/**</span>

<span class="c1"># Run scanner</span>
sonar-scanner<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-Dsonar.projectKey<span class="o">=</span>my-python-project<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-Dsonar.sources<span class="o">=</span>.<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-Dsonar.host.url<span class="o">=</span>http://localhost:9000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-Dsonar.token<span class="o">=</span>your_token_here
</code></pre></div>

<hr />
<h2 id="3-dynamic-application-security-testing-dast">3. Dynamic Application Security Testing (DAST)<a class="header-link" href="#3-dynamic-application-security-testing-dast" title="Permanent link">&para;</a></h2>
<h3 id="31-how-dast-works">3.1 How DAST Works<a class="header-link" href="#31-how-dast-works" title="Permanent link">&para;</a></h3>
<p>DAST tools test a running application by sending crafted requests and analyzing responses for vulnerabilities. They act like an automated attacker.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="n">DAST</span><span class="w"> </span><span class="n">Testing</span><span class="w"> </span><span class="n">Flow</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="n">Crawl</span><span class="w">      </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="n">DAST</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><span class="w"> </span><span class="err">â”‚</span><span class="w">   </span><span class="n">Running</span><span class="w">      </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="n">Tool</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">   </span><span class="n">Application</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="err">â”‚</span><span class="w">   </span><span class="p">(</span><span class="n">Target</span><span class="p">)</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">    </span><span class="n">Responses</span><span class="w">   </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Phase</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Spider</span><span class="o">/</span><span class="n">crawl</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">discover</span><span class="w"> </span><span class="n">endpoints</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Discover</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Find</span><span class="w"> </span><span class="n">forms</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="n">endpoints</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Phase</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Send</span><span class="w"> </span><span class="n">malicious</span><span class="w"> </span><span class="n">payloads</span><span class="p">:</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Attack</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">injection</span><span class="w"> </span><span class="n">strings</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">XSS</span><span class="w"> </span><span class="n">payloads</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="n">traversal</span><span class="w"> </span><span class="n">attempts</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="n">injection</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Phase</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Analyze</span><span class="w"> </span><span class="n">responses</span><span class="w"> </span><span class="k">for</span><span class="p">:</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Analyze</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">revealing</span><span class="w"> </span><span class="n">info</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Reflected</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="p">(</span><span class="n">XSS</span><span class="p">)</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Unexpected</span><span class="w"> </span><span class="n">behavior</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="32-owasp-zap">3.2 OWASP ZAP<a class="header-link" href="#32-owasp-zap" title="Permanent link">&para;</a></h3>
<p>OWASP ZAP (Zed Attack Proxy) is the most widely used free DAST tool.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run ZAP in Docker</span>
docker<span class="w"> </span>run<span class="w"> </span>-t<span class="w"> </span>owasp/zap2docker-stable<span class="w"> </span>zap-baseline.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-t<span class="w"> </span>http://target-app:8080

<span class="c1"># Full scan (more thorough, slower)</span>
docker<span class="w"> </span>run<span class="w"> </span>-t<span class="w"> </span>owasp/zap2docker-stable<span class="w"> </span>zap-full-scan.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-t<span class="w"> </span>http://target-app:8080

<span class="c1"># API scan (for REST APIs)</span>
docker<span class="w"> </span>run<span class="w"> </span>-t<span class="w"> </span>owasp/zap2docker-stable<span class="w"> </span>zap-api-scan.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-t<span class="w"> </span>http://target-app:8080/openapi.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-f<span class="w"> </span>openapi

<span class="c1"># Generate HTML report</span>
docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/zap/wrk/:rw<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-t<span class="w"> </span>owasp/zap2docker-stable<span class="w"> </span>zap-baseline.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-t<span class="w"> </span>http://target-app:8080<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-r<span class="w"> </span>report.html
</code></pre></div>

<h4 id="zap-python-api">ZAP Python API<a class="header-link" href="#zap-python-api" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Using OWASP ZAP&#39;s Python API for automated scanning.</span>
<span class="sd">Requires: pip install python-owasp-zap-v2.4</span>
<span class="sd">ZAP must be running as a daemon.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">zapv2</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZAPv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># Connect to ZAP</span>
<span class="n">zap</span> <span class="o">=</span> <span class="n">ZAPv2</span><span class="p">(</span>
    <span class="n">apikey</span><span class="o">=</span><span class="s1">&#39;your-api-key&#39;</span><span class="p">,</span>
    <span class="n">proxies</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:8080&#39;</span><span class="p">,</span>
        <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:8080&#39;</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;http://target-app:5000&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_zap_scan</span><span class="p">(</span><span class="n">target_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run a ZAP scan against target and return results.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Spidering target: </span><span class="si">{</span><span class="n">target_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">scan_id</span> <span class="o">=</span> <span class="n">zap</span><span class="o">.</span><span class="n">spider</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">target_url</span><span class="p">)</span>

    <span class="c1"># Wait for spider to complete</span>
    <span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">spider</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">scan_id</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Spider progress: </span><span class="si">{</span><span class="n">zap</span><span class="o">.</span><span class="n">spider</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">scan_id</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Spider found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">spider</span><span class="o">.</span><span class="n">results</span><span class="p">(</span><span class="n">scan_id</span><span class="p">))</span><span class="si">}</span><span class="s2"> URLs&quot;</span><span class="p">)</span>

    <span class="c1"># Run active scan</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Starting active scan...&quot;</span><span class="p">)</span>
    <span class="n">scan_id</span> <span class="o">=</span> <span class="n">zap</span><span class="o">.</span><span class="n">ascan</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">target_url</span><span class="p">)</span>

    <span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">ascan</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">scan_id</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Active scan progress: </span><span class="si">{</span><span class="n">zap</span><span class="o">.</span><span class="n">ascan</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">scan_id</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Get alerts</span>
    <span class="n">alerts</span> <span class="o">=</span> <span class="n">zap</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">alerts</span><span class="p">(</span><span class="n">baseurl</span><span class="o">=</span><span class="n">target_url</span><span class="p">)</span>

    <span class="c1"># Categorize by risk level</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;High&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;Medium&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;Low&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;Informational&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">alerts</span><span class="p">:</span>
        <span class="n">risk</span> <span class="o">=</span> <span class="n">alert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;risk&#39;</span><span class="p">,</span> <span class="s1">&#39;Informational&#39;</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="n">risk</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">alert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
            <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">alert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">alert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">),</span>
            <span class="s1">&#39;solution&#39;</span><span class="p">:</span> <span class="n">alert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;solution&#39;</span><span class="p">),</span>
            <span class="s1">&#39;cweid&#39;</span><span class="p">:</span> <span class="n">alert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cweid&#39;</span><span class="p">),</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span><span class="w"> </span><span class="nf">print_results</span><span class="p">(</span><span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print scan results in a readable format.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">risk_level</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Informational&#39;</span><span class="p">]:</span>
        <span class="n">alerts</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">risk_level</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">alerts</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">risk_level</span><span class="si">}</span><span class="s2"> Risk Alerts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">alerts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">alerts</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [</span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="s1">&#39;cweid&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  URL: </span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Solution: </span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="s1">&#39;solution&#39;</span><span class="p">][:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">run_zap_scan</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">print_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>

<h3 id="33-burp-suite-concepts">3.3 Burp Suite Concepts<a class="header-link" href="#33-burp-suite-concepts" title="Permanent link">&para;</a></h3>
<p>Burp Suite is a commercial (with free Community edition) web security testing platform.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="n">Burp</span><span class="w"> </span><span class="n">Suite</span><span class="w"> </span><span class="n">Architecture</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Browser</span><span class="w"> </span><span class="err">â—„â”€â”€â”€â”€â”€â”€â–º</span><span class="w"> </span><span class="n">Burp</span><span class="w"> </span><span class="n">Proxy</span><span class="w"> </span><span class="err">â—„â”€â”€â”€â”€â”€â”€â–º</span><span class="w"> </span><span class="n">Target</span><span class="w"> </span><span class="n">Server</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="err">â”‚</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">           </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">           </span><span class="err">â–¼</span><span class="w">          </span><span class="err">â–¼</span><span class="w">                  </span><span class="err">â–¼</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Spider</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="n">Repeater</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Scanner</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="n">Crawl</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="n">Manual</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="p">(</span><span class="n">Automated</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="n">test</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">           </span><span class="err">â–¼</span><span class="w">          </span><span class="err">â–¼</span><span class="w">                  </span><span class="err">â–¼</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="n">Sequencer</span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="n">Intruder</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Decoder</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="n">Token</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="p">(</span><span class="n">Payload</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="p">(</span><span class="n">Encode</span><span class="o">/</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">  </span><span class="n">test</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="n">fuzzer</span><span class="p">)</span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Decode</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">      </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Key</span><span class="w"> </span><span class="n">Capabilities</span><span class="p">:</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Intercept</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="n">HTTPS</span><span class="w"> </span><span class="n">traffic</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Automated</span><span class="w"> </span><span class="n">vulnerability</span><span class="w"> </span><span class="n">scanning</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Manual</span><span class="w"> </span><span class="n">testing</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Repeater</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Intruder</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Session</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Sequencer</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Extensible</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">BApp</span><span class="w"> </span><span class="n">Store</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="4-software-composition-analysis-sca">4. Software Composition Analysis (SCA)<a class="header-link" href="#4-software-composition-analysis-sca" title="Permanent link">&para;</a></h2>
<h3 id="41-why-sca-matters">4.1 Why SCA Matters<a class="header-link" href="#41-why-sca-matters" title="Permanent link">&para;</a></h3>
<p>Most modern applications consist of 70-90% third-party code. SCA tools scan your dependencies for known vulnerabilities.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                <span class="n">Your</span> <span class="n">Application&#39;s</span> <span class="nb">Code</span> <span class="n">Composition</span>                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ <span class="n">Third-party</span> <span class="n">libraries</span> â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   (<span class="mi">70</span><span class="o">-</span><span class="mi">90</span>% <span class="nb">of</span> <span class="nb">code</span>)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚
â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚   â”‚
â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘ <span class="n">Your</span> <span class="nb">code</span> (<span class="mi">10</span><span class="o">-</span><span class="mi">30</span>%) â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚   â”‚
â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  <span class="n">Each</span> <span class="n">third-party</span> <span class="n">library</span> <span class="n">may</span> <span class="n">have</span> <span class="n">its</span> <span class="n">OWN</span> <span class="n">dependencies</span>         â”‚
â”‚  (<span class="n">transitive</span> <span class="n">dependencies</span>), <span class="n">creating</span> <span class="n">a</span> <span class="n">deep</span> <span class="n">dependency</span> <span class="nb">tree</span>.    â”‚
â”‚  <span class="n">A</span> <span class="n">vulnerability</span> <span class="n">anywhere</span> <span class="nb">in</span> <span class="n">this</span> <span class="nb">tree</span> <span class="n">affects</span> <span class="n">YOUR</span> <span class="n">app</span>.        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="42-pip-audit">4.2 pip-audit<a class="header-link" href="#42-pip-audit" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Install pip-audit</span>
pip<span class="w"> </span>install<span class="w"> </span>pip-audit

<span class="c1"># Scan current environment</span>
pip-audit

<span class="c1"># Scan a requirements file</span>
pip-audit<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c1"># Output in JSON format</span>
pip-audit<span class="w"> </span>-f<span class="w"> </span>json<span class="w"> </span>-o<span class="w"> </span>audit_report.json

<span class="c1"># Auto-fix vulnerabilities (upgrade packages)</span>
pip-audit<span class="w"> </span>--fix

<span class="c1"># Scan with specific vulnerability database</span>
pip-audit<span class="w"> </span>--vulnerability-service<span class="w"> </span>osv<span class="w">  </span><span class="c1"># Google OSV (default)</span>
pip-audit<span class="w"> </span>--vulnerability-service<span class="w"> </span>pypi<span class="w">  </span><span class="c1"># PyPI Advisory DB</span>

<span class="c1"># Strict mode: exit with error if any vulnerabilities found</span>
pip-audit<span class="w"> </span>--strict
</code></pre></div>

<h4 id="example-pip-audit-output">Example pip-audit Output<a class="header-link" href="#example-pip-audit-output" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip-audit<span class="w"> </span>-r<span class="w"> </span>requirements.txt

Found<span class="w"> </span><span class="m">3</span><span class="w"> </span>known<span class="w"> </span>vulnerabilities<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>packages

Name<span class="w">       </span>Version<span class="w">  </span>ID<span class="w">                  </span>Fix<span class="w"> </span>Versions
----------<span class="w"> </span>--------<span class="w"> </span>-------------------<span class="w"> </span>---------------
flask<span class="w">      </span><span class="m">2</span>.0.1<span class="w">    </span>PYSEC-2023-62<span class="w">       </span><span class="m">2</span>.3.2
requests<span class="w">   </span><span class="m">2</span>.25.1<span class="w">   </span>PYSEC-2023-74<span class="w">       </span><span class="m">2</span>.31.0
requests<span class="w">   </span><span class="m">2</span>.25.1<span class="w">   </span>GHSA-j8r2-6x86-q33q<span class="w"> </span><span class="m">2</span>.32.0
</code></pre></div>

<h3 id="43-safety">4.3 Safety<a class="header-link" href="#43-safety" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Install safety</span>
pip<span class="w"> </span>install<span class="w"> </span>safety

<span class="c1"># Check current environment</span>
safety<span class="w"> </span>check

<span class="c1"># Check a requirements file</span>
safety<span class="w"> </span>check<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="c1"># Output in JSON format</span>
safety<span class="w"> </span>check<span class="w"> </span>--output<span class="w"> </span>json

<span class="c1"># Use in CI (exit code 1 if vulnerabilities found)</span>
safety<span class="w"> </span>check<span class="w"> </span>--full-report
</code></pre></div>

<h3 id="44-python-script-dependency-vulnerability-scanner">4.4 Python Script: Dependency Vulnerability Scanner<a class="header-link" href="#44-python-script-dependency-vulnerability-scanner" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">dependency_scanner.py - A comprehensive dependency vulnerability scanner.</span>
<span class="sd">Combines pip-audit results with additional checks.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Vulnerability</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a single vulnerability in a dependency.&quot;&quot;&quot;</span>
    <span class="n">package</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">vuln_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">fix_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ScanResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Results from a dependency scan.&quot;&quot;&quot;</span>
    <span class="n">vulnerabilities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Vulnerability</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">scanned_packages</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">scan_tool</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">run_pip_audit</span><span class="p">(</span><span class="n">requirements_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScanResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run pip-audit and parse results.&quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pip-audit&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;--desc&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">requirements_file</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="n">requirements_file</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">ScanResult</span><span class="p">(</span><span class="n">scan_tool</span><span class="o">=</span><span class="s2">&quot;pip-audit&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">cmd</span><span class="p">,</span>
            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">120</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

        <span class="c1"># Parse dependencies</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependencies&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">scanned_packages</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">vuln</span> <span class="ow">in</span> <span class="n">dep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vulns&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">Vulnerability</span><span class="p">(</span>
                    <span class="n">package</span><span class="o">=</span><span class="n">dep</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">version</span><span class="o">=</span><span class="n">dep</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">],</span>
                    <span class="n">vuln_id</span><span class="o">=</span><span class="n">vuln</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">vuln</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">fix_version</span><span class="o">=</span><span class="n">vuln</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fix_versions&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">vuln</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fix_versions&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">aliases</span><span class="o">=</span><span class="n">vuln</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;aliases&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">vulnerabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pip-audit not installed. Run: pip install pip-audit&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pip-audit timed out after 120 seconds&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse pip-audit output: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">check_requirements_pinning</span><span class="p">(</span><span class="n">requirements_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if dependencies are properly pinned with exact versions.</span>
<span class="sd">    Unpinned dependencies are a security risk because they can</span>
<span class="sd">    silently pull in vulnerable versions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">req_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">requirements_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">req_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Requirements file not found: </span><span class="si">{</span><span class="n">requirements_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">req_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># Check for unpinned dependencies</span>
        <span class="k">if</span> <span class="s2">&quot;==&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;&gt;=&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#39; uses &gt;= (unpinned upper bound). &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Use == for exact pinning.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&#39; has no version pin. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Use == to pin exact version.&quot;</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">warnings</span>


<span class="k">def</span><span class="w"> </span><span class="nf">check_known_malicious_packages</span><span class="p">(</span><span class="n">requirements_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check for known typosquatting / malicious package names.</span>
<span class="sd">    This is a simplified check - real scanners use larger databases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Known typosquatting examples (simplified list)</span>
    <span class="n">SUSPICIOUS_PATTERNS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;python-dateutil&quot;</span><span class="p">:</span> <span class="s2">&quot;dateutil&quot;</span><span class="p">,</span>       <span class="c1"># common confusion</span>
        <span class="s2">&quot;beautifulsoup4&quot;</span><span class="p">:</span> <span class="s2">&quot;beautifulsoup&quot;</span><span class="p">,</span>   <span class="c1"># old version</span>
        <span class="c1"># These are examples of KNOWN malicious packages (now removed from PyPI)</span>
        <span class="s2">&quot;colourama&quot;</span><span class="p">:</span> <span class="s2">&quot;colorama&quot;</span><span class="p">,</span>
        <span class="s2">&quot;python3-dateutil&quot;</span><span class="p">:</span> <span class="s2">&quot;python-dateutil&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jeIlyfish&quot;</span><span class="p">:</span> <span class="s2">&quot;jellyfish&quot;</span><span class="p">,</span>            <span class="c1"># capital I vs lowercase l</span>
    <span class="p">}</span>

    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">req_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">requirements_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">req_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">req_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">pkg_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;==&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pkg_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">SUSPICIOUS_PATTERNS</span><span class="p">]:</span>
            <span class="n">correct</span> <span class="o">=</span> <span class="n">SUSPICIOUS_PATTERNS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pkg_name</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: &#39;</span><span class="si">{</span><span class="n">pkg_name</span><span class="si">}</span><span class="s2">&#39; may be a typosquat of &#39;</span><span class="si">{</span><span class="n">correct</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Verify the package name is correct.&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">warnings</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="n">scan_result</span><span class="p">:</span> <span class="n">ScanResult</span><span class="p">,</span> <span class="n">pinning_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                    <span class="n">typosquat_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a formatted security report.&quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  Dependency Security Scan Report&quot;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tool: </span><span class="si">{</span><span class="n">scan_result</span><span class="o">.</span><span class="n">scan_tool</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Packages scanned: </span><span class="si">{</span><span class="n">scan_result</span><span class="o">.</span><span class="n">scanned_packages</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vulnerabilities found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">scan_result</span><span class="o">.</span><span class="n">vulnerabilities</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">scan_result</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Errors:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">scan_result</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [!] </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">scan_result</span><span class="o">.</span><span class="n">vulnerabilities</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  Vulnerabilities&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vuln</span> <span class="ow">in</span> <span class="n">scan_result</span><span class="o">.</span><span class="n">vulnerabilities</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Package: </span><span class="si">{</span><span class="n">vuln</span><span class="o">.</span><span class="n">package</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">vuln</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ID:      </span><span class="si">{</span><span class="n">vuln</span><span class="o">.</span><span class="n">vuln_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vuln</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Aliases: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vuln</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vuln</span><span class="o">.</span><span class="n">fix_version</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Fix:     Upgrade to </span><span class="si">{</span><span class="n">vuln</span><span class="o">.</span><span class="n">fix_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vuln</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">vuln</span><span class="o">.</span><span class="n">description</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Detail:  </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pinning_warnings</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  Version Pinning Warnings&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">pinning_warnings</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [!] </span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">typosquat_warnings</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  Typosquatting Warnings&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">typosquat_warnings</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [!] </span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Determine exit recommendation</span>
    <span class="k">if</span> <span class="n">scan_result</span><span class="o">.</span><span class="n">vulnerabilities</span> <span class="ow">or</span> <span class="n">typosquat_warnings</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  RESULT: FAIL - Issues found that require attention&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pinning_warnings</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  RESULT: WARN - Consider fixing pinning issues&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  RESULT: PASS - No issues found&quot;</span><span class="p">)</span>

    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">req_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;requirements.txt&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning dependencies from: </span><span class="si">{</span><span class="n">req_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Run all checks</span>
    <span class="n">scan_result</span> <span class="o">=</span> <span class="n">run_pip_audit</span><span class="p">(</span><span class="n">req_file</span><span class="p">)</span>
    <span class="n">pinning_warnings</span> <span class="o">=</span> <span class="n">check_requirements_pinning</span><span class="p">(</span><span class="n">req_file</span><span class="p">)</span>
    <span class="n">typosquat_warnings</span> <span class="o">=</span> <span class="n">check_known_malicious_packages</span><span class="p">(</span><span class="n">req_file</span><span class="p">)</span>

    <span class="c1"># Generate and print report</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">generate_report</span><span class="p">(</span><span class="n">scan_result</span><span class="p">,</span> <span class="n">pinning_warnings</span><span class="p">,</span> <span class="n">typosquat_warnings</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

    <span class="c1"># Exit with appropriate code for CI</span>
    <span class="k">if</span> <span class="n">scan_result</span><span class="o">.</span><span class="n">vulnerabilities</span> <span class="ow">or</span> <span class="n">typosquat_warnings</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">scan_result</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="45-dependabot-configuration-github">4.5 Dependabot Configuration (GitHub)<a class="header-link" href="#45-dependabot-configuration-github" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .github/dependabot.yml</span>

<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">updates</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Python pip dependencies</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pip&quot;</span>
<span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
<span class="w">      </span><span class="nt">day</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;monday&quot;</span>
<span class="w">      </span><span class="nt">time</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;09:00&quot;</span>
<span class="w">      </span><span class="nt">timezone</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;America/New_York&quot;</span>
<span class="w">    </span><span class="nt">open-pull-requests-limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">reviewers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;security-team&quot;</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;dependencies&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;security&quot;</span>
<span class="w">    </span><span class="c1"># Group minor/patch updates together</span>
<span class="w">    </span><span class="nt">groups</span><span class="p">:</span>
<span class="w">      </span><span class="nt">minor-and-patch</span><span class="p">:</span>
<span class="w">        </span><span class="nt">update-types</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;minor&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;patch&quot;</span>
<span class="w">    </span><span class="c1"># Ignore specific packages</span>
<span class="w">    </span><span class="nt">ignore</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dependency-name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;boto3&quot;</span>
<span class="w">        </span><span class="nt">update-types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;version-update:semver-patch&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="c1"># Security updates only (no version updates)</span>
<span class="w">    </span><span class="c1"># Uncomment below and remove schedule for security-only</span>
<span class="w">    </span><span class="c1"># open-pull-requests-limit: 0</span>

<span class="w">  </span><span class="c1"># Docker base images</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker&quot;</span>
<span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>

<span class="w">  </span><span class="c1"># GitHub Actions</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;github-actions&quot;</span>
<span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
</code></pre></div>

<hr />
<h2 id="5-fuzzing">5. Fuzzing<a class="header-link" href="#5-fuzzing" title="Permanent link">&para;</a></h2>
<h3 id="51-what-is-fuzzing">5.1 What is Fuzzing?<a class="header-link" href="#51-what-is-fuzzing" title="Permanent link">&para;</a></h3>
<p>Fuzzing is an automated testing technique that feeds random, malformed, or unexpected input to a program to find crashes, hangs, or security vulnerabilities.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                      </span><span class="nv">Fuzzing</span><span class="w"> </span><span class="nv">Feedback</span><span class="w"> </span><span class="k">Loop</span><span class="w">                       </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                  </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">Seed</span><span class="w">     </span>â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">Mutation</span><span class="w">  </span>â”‚<span class="w">     </span>â”‚<span class="w">    </span><span class="nv">Target</span><span class="w">      </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">Corpus</span><span class="w">   </span>â”‚â”€â”€â”€â”€â–ºâ”‚<span class="w">  </span><span class="nv">Engine</span><span class="w">    </span>â”‚â”€â”€â”€â”€â–ºâ”‚<span class="w">   </span><span class="nv">Program</span><span class="w">      </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">initial</span><span class="w">  </span>â”‚<span class="w">     </span>â”‚<span class="w">            </span>â”‚<span class="w">     </span>â”‚<span class="w">                </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">inputs</span><span class="ss">)</span><span class="w">  </span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">bit</span><span class="w"> </span><span class="nv">flip</span><span class="w"> </span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Parse</span><span class="w"> </span><span class="nv">input</span><span class="w">    </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â”‚<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">insert</span><span class="w">   </span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Process</span><span class="w"> </span><span class="nv">data</span><span class="w">   </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">       </span>â–²<span class="w">             </span>â”‚<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">delete</span><span class="w">   </span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="k">Return</span><span class="w"> </span><span class="nb">result</span><span class="w">  </span>â”‚<span class="w">       </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">             </span>â”‚<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">replace</span><span class="w">  </span>â”‚<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">       </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">             </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">             </span>â”‚<span class="w">                </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                                        </span>â”‚<span class="w">                </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">         </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">               </span>â”‚<span class="w">                </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">         </span>â”‚<span class="w">  </span><span class="nv">Coverage</span><span class="w">    </span>â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                </span>â”‚
â”‚<span class="w">       </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">  </span><span class="nv">Monitor</span><span class="w">    </span>â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">code</span><span class="w"> </span><span class="nv">coverage</span><span class="w"> </span><span class="nv">feedback</span><span class="ss">)</span><span class="w">      </span>â”‚
â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">save</span><span class="w"> </span><span class="nv">inputs</span><span class="w">   </span>â”‚<span class="w">             </span>â”‚<span class="w">                                 </span>â”‚
â”‚<span class="w">   </span><span class="nv">that</span><span class="w"> </span><span class="nv">find</span><span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                                </span>â”‚
â”‚<span class="w">   </span><span class="nv">new</span><span class="w"> </span><span class="nv">paths</span><span class="ss">)</span><span class="w">          </span>â”‚<span class="w">                                         </span>â”‚
â”‚<span class="w">                       </span>â–¼<span class="w">                                         </span>â”‚
â”‚<span class="w">                </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                                  </span>â”‚
â”‚<span class="w">                </span>â”‚<span class="w">  </span><span class="nv">Crash</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">Bug</span><span class="w"> </span>â”‚<span class="w">                                  </span>â”‚
â”‚<span class="w">                </span>â”‚<span class="w">  </span><span class="nv">Detection</span><span class="w">   </span>â”‚<span class="w">                                  </span>â”‚
â”‚<span class="w">                </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                                  </span>â”‚
â”‚<span class="w">                                                                  </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="52-afl-american-fuzzy-lop">5.2 AFL (American Fuzzy Lop)<a class="header-link" href="#52-afl-american-fuzzy-lop" title="Permanent link">&para;</a></h3>
<p>AFL is the most influential coverage-guided fuzzer for C/C++ programs.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install AFL++</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>afl++<span class="w">  </span><span class="c1"># Debian/Ubuntu</span>

<span class="c1"># Compile target with AFL instrumentation</span>
afl-cc<span class="w"> </span>-o<span class="w"> </span>target_program<span class="w"> </span>target_program.c

<span class="c1"># Create seed corpus directory</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>seeds
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;valid input&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>seeds/seed1.txt

<span class="c1"># Run AFL</span>
afl-fuzz<span class="w"> </span>-i<span class="w"> </span>seeds<span class="w"> </span>-o<span class="w"> </span>findings<span class="w"> </span>./target_program<span class="w"> </span>@@

<span class="c1"># @@ is replaced by the input file path</span>
<span class="c1"># -i: seed directory</span>
<span class="c1"># -o: output directory (crashes, hangs, queue)</span>

<span class="c1"># Monitor AFL status</span>
afl-whatsup<span class="w"> </span>findings/
</code></pre></div>

<h4 id="afl-output-directory-structure">AFL Output Directory Structure<a class="header-link" href="#afl-output-directory-structure" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>findings/
â”œâ”€â”€ crashes/         # Inputs that caused crashes
â”‚   â”œâ”€â”€ id:000000,...  # Crash-triggering inputs
â”‚   â””â”€â”€ README.txt
â”œâ”€â”€ hangs/           # Inputs that caused hangs/timeouts
â”œâ”€â”€ queue/           # Interesting inputs (new coverage)
â””â”€â”€ fuzzer_stats     # Current fuzzing statistics
</code></pre></div>

<h3 id="53-hypothesis-property-based-testing-for-python">5.3 Hypothesis: Property-Based Testing for Python<a class="header-link" href="#53-hypothesis-property-based-testing-for-python" title="Permanent link">&para;</a></h3>
<p>Hypothesis is a Python library for property-based testing. While not a traditional fuzzer, it automatically generates test inputs to find edge cases.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Property-based testing with Hypothesis.</span>
<span class="sd">Install: pip install hypothesis</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">assume</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">HealthCheck</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>


<span class="c1"># â”€â”€â”€ Basic Example: Testing a function with generated inputs â”€â”€â”€</span>

<span class="k">def</span><span class="w"> </span><span class="nf">encode_decode_round_trip</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encoding then decoding should return original data.&quot;&quot;&quot;</span>
    <span class="n">encoded</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">decoded</span> <span class="o">=</span> <span class="n">encoded</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decoded</span> <span class="o">==</span> <span class="n">data</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_encode_decode_roundtrip</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that UTF-8 encode/decode is a perfect round trip.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">encode_decode_round_trip</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="c1"># â”€â”€â”€ Testing JSON parsing robustness â”€â”€â”€</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_json_loads_doesnt_crash</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    json.loads should either parse successfully or raise</span>
<span class="sd">    ValueError/JSONDecodeError - never crash or hang.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">pass</span>  <span class="c1"># Expected for invalid JSON</span>


<span class="c1"># â”€â”€â”€ Testing input validation functions â”€â”€â”€</span>

<span class="k">def</span><span class="w"> </span><span class="nf">validate_email</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple email validation (intentionally buggy for demo).&quot;&quot;&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$&#39;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">email</span><span class="p">))</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">emails</span><span class="p">())</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_emails_pass_validation</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;All valid emails should pass our validator.&quot;&quot;&quot;</span>
    <span class="c1"># This will likely FAIL, exposing gaps in our regex</span>
    <span class="k">assert</span> <span class="n">validate_email</span><span class="p">(</span><span class="n">email</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Valid email rejected: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="c1"># â”€â”€â”€ Testing with structured data â”€â”€â”€</span>

<span class="c1"># Strategy for generating user registration data</span>
<span class="n">user_strategy</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">fixed_dictionaries</span><span class="p">({</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">alphabet</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">characters</span><span class="p">(</span><span class="n">whitelist_categories</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">)),</span>
        <span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">max_size</span><span class="o">=</span><span class="mi">50</span>
    <span class="p">),</span>
    <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">emails</span><span class="p">(),</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">128</span><span class="p">),</span>
    <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span>
<span class="p">})</span>


<span class="k">def</span><span class="w"> </span><span class="nf">process_registration</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process user registration. Should handle any valid input.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username too short&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password too short&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">13</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must be at least 13 years old&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;registered&#39;</span>
    <span class="p">}</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">user_strategy</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_registration_never_crashes</span><span class="p">(</span><span class="n">user_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Registration should either succeed or raise ValueError.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">process_registration</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="s1">&#39;email&#39;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Expected for invalid data</span>


<span class="c1"># â”€â”€â”€ Fuzzing a URL parser â”€â”€â”€</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">urlunparse</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">from_regex</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;https?://[a-z0-9.-]{1,50}(:[0-9]{1,5})?(/[a-z0-9._-]{0,20}){0,5}(\?[a-z0-9=&amp;]{0,50})?&#39;</span><span class="p">,</span>
    <span class="n">fullmatch</span><span class="o">=</span><span class="kc">True</span>
<span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_url_parse_roundtrip</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;URL parse then unparse should preserve the URL.&quot;&quot;&quot;</span>
    <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">reconstructed</span> <span class="o">=</span> <span class="n">urlunparse</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
    <span class="c1"># Re-parse both to compare components (normalization may differ)</span>
    <span class="k">assert</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">reconstructed</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span> <span class="o">==</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span>


<span class="c1"># â”€â”€â”€ Testing security-sensitive functions â”€â”€â”€</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sanitize_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove dangerous characters from a filename.&quot;&quot;&quot;</span>
    <span class="c1"># Remove path separators and null bytes</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="n">sanitized</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="n">sanitized</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># Remove leading dots (hidden files)</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="n">sanitized</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sanitized</span> <span class="ow">or</span> <span class="s1">&#39;unnamed&#39;</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">255</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_sanitized_filename_is_safe</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sanitized filenames should never contain path traversal.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sanitize_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s1">&#39;/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Path separator in: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Backslash in: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Null byte in: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Hidden file: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="s1">&#39;..&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Path traversal in: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Empty filename after sanitization&quot;</span>


<span class="c1"># â”€â”€â”€ Advanced: Stateful testing â”€â”€â”€</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis.stateful</span><span class="w"> </span><span class="kn">import</span> <span class="n">RuleBasedStateMachine</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">initialize</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ShoppingCartStateMachine</span><span class="p">(</span><span class="n">RuleBasedStateMachine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stateful testing for a shopping cart.</span>
<span class="sd">    Hypothesis will generate sequences of operations</span>
<span class="sd">    and check invariants after each step.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cart</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nd">@initialize</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">init_cart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cart</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nd">@rule</span><span class="p">(</span>
        <span class="n">item</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
        <span class="n">price</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">quantity</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">quantity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an item to the cart.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cart</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cart</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cart</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="n">quantity</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recalculate_total</span><span class="p">()</span>

    <span class="nd">@rule</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove an item from the cart.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cart</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cart</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recalculate_total</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_recalculate_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">v</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cart</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Invariant: total should never be negative.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Negative total: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cart</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>


<span class="c1"># Create a test from the state machine</span>
<span class="n">TestShoppingCart</span> <span class="o">=</span> <span class="n">ShoppingCartStateMachine</span><span class="o">.</span><span class="n">TestCase</span>


<span class="c1"># â”€â”€â”€ Running Hypothesis with settings â”€â”€â”€</span>

<span class="nd">@settings</span><span class="p">(</span>
    <span class="n">max_examples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>        <span class="c1"># Number of test cases to generate</span>
    <span class="n">deadline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>            <span class="c1"># No time limit per test</span>
    <span class="n">suppress_health_check</span><span class="o">=</span><span class="p">[</span>   <span class="c1"># Suppress specific health checks</span>
        <span class="n">HealthCheck</span><span class="o">.</span><span class="n">too_slow</span><span class="p">,</span>
        <span class="n">HealthCheck</span><span class="o">.</span><span class="n">filter_too_much</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">binary</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_binary_processing</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that our binary processor handles any input.&quot;&quot;&quot;</span>
    <span class="c1"># Your binary processing function here</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Should never reach here with errors=&#39;replace&#39;</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="54-fuzzing-network-protocols">5.4 Fuzzing Network Protocols<a class="header-link" href="#54-fuzzing-network-protocols" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Simple protocol fuzzer for educational purposes.</span>
<span class="sd">Generates malformed inputs for protocol testing.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Generator</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mutate_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">num_mutations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply random mutations to a byte string.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_mutations</span><span class="p">):</span>
        <span class="n">mutation_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span>
            <span class="s1">&#39;bit_flip&#39;</span><span class="p">,</span> <span class="s1">&#39;byte_replace&#39;</span><span class="p">,</span> <span class="s1">&#39;insert&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span>
            <span class="s1">&#39;duplicate&#39;</span><span class="p">,</span> <span class="s1">&#39;overflow&#39;</span>
        <span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mutation_type</span> <span class="o">==</span> <span class="s1">&#39;bit_flip&#39;</span><span class="p">:</span>
            <span class="n">bit</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mutation_type</span> <span class="o">==</span> <span class="s1">&#39;byte_replace&#39;</span><span class="p">:</span>
            <span class="c1"># Replace with interesting values</span>
            <span class="n">interesting</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">interesting</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mutation_type</span> <span class="o">==</span> <span class="s1">&#39;insert&#39;</span><span class="p">:</span>
            <span class="n">insert_data</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">insert_data</span>

        <span class="k">elif</span> <span class="n">mutation_type</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span><span class="p">:</span>
            <span class="n">del_len</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">pos</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="n">del_len</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">mutation_type</span> <span class="o">==</span> <span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span>

        <span class="k">elif</span> <span class="n">mutation_type</span> <span class="o">==</span> <span class="s1">&#39;overflow&#39;</span><span class="p">:</span>
            <span class="c1"># Insert a very long string</span>
            <span class="n">overflow</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">4096</span><span class="p">,</span> <span class="mi">65536</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">overflow</span>

    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_http_fuzz_requests</span><span class="p">(</span><span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate fuzzed HTTP requests.&quot;&quot;&quot;</span>

    <span class="n">base_requests</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">Host: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="sa">f</span><span class="s2">&quot;POST /login HTTP/1.1</span><span class="se">\r\n</span><span class="s2">Host: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">Content-Length: 10</span><span class="se">\r\n\r\n</span><span class="s2">user=admin&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="sa">f</span><span class="s2">&quot;GET /</span><span class="si">{</span><span class="s1">&#39;A&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5000</span><span class="si">}</span><span class="s2"> HTTP/1.1</span><span class="se">\r\n</span><span class="s2">Host: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
    <span class="p">]</span>

    <span class="c1"># Yield original requests</span>
    <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">base_requests</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">req</span>

    <span class="c1"># Yield mutated versions</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">base_requests</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">mutate_bytes</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

    <span class="c1"># Special cases</span>
    <span class="k">yield</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">1024</span>                        <span class="c1"># Null bytes</span>
    <span class="k">yield</span> <span class="sa">b</span><span class="s2">&quot;GET / HTTP/9.9</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span>             <span class="c1"># Invalid version</span>
    <span class="k">yield</span> <span class="sa">b</span><span class="s2">&quot;XYZZY / HTTP/1.1</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span>           <span class="c1"># Invalid method</span>
    <span class="k">yield</span> <span class="sa">b</span><span class="s2">&quot;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;X: Y</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">10000</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>  <span class="c1"># Header bomb</span>
    <span class="k">yield</span> <span class="sa">b</span><span class="s2">&quot;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">Content-Length: -1</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span>         <span class="c1"># Negative length</span>
    <span class="k">yield</span> <span class="sa">b</span><span class="s2">&quot;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">Content-Length: 999999999</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span>  <span class="c1"># Huge length</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fuzz_target</span><span class="p">(</span><span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send fuzzed requests to a target server.</span>

<span class="sd">    WARNING: Only use against servers you own or have explicit</span>
<span class="sd">    permission to test. Unauthorized testing is illegal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Fuzzing </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">crash_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_sent</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">payload</span> <span class="ow">in</span> <span class="n">generate_http_fuzz_requests</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
                <span class="n">total_sent</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [!] Timeout on payload #</span><span class="si">{</span><span class="n">total_sent</span><span class="si">}</span><span class="s2"> &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;(length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">total_sent</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">except</span> <span class="ne">ConnectionRefusedError</span><span class="p">:</span>
            <span class="n">crash_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [!!!] Connection refused after payload #</span><span class="si">{</span><span class="n">total_sent</span><span class="si">}</span><span class="s2">. &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;Server may have crashed!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;       Payload (first 100 bytes): </span><span class="si">{</span><span class="n">payload</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Save crash-triggering payload</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;crash_</span><span class="si">{</span><span class="n">crash_count</span><span class="si">}</span><span class="s2">.bin&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [!] Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[*] Fuzzing complete. Sent </span><span class="si">{</span><span class="n">total_sent</span><span class="si">}</span><span class="s2"> payloads. &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;Crashes detected: </span><span class="si">{</span><span class="n">crash_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6-penetration-testing-methodology">6. Penetration Testing Methodology<a class="header-link" href="#6-penetration-testing-methodology" title="Permanent link">&para;</a></h2>
<h3 id="61-the-penetration-testing-process">6.1 The Penetration Testing Process<a class="header-link" href="#61-the-penetration-testing-process" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="n">Penetration</span><span class="w"> </span><span class="n">Testing</span><span class="w"> </span><span class="n">Methodology</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="p">(</span><span class="n">Based</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">PTES</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">OWASP</span><span class="p">)</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">Planning</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Scope</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Define</span><span class="w"> </span><span class="n">targets</span><span class="p">,</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">engagement</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="p">(</span><span class="n">Pre</span><span class="o">-</span><span class="n">engagement</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Legal</span><span class="w"> </span><span class="n">authorization</span><span class="p">,</span><span class="w"> </span><span class="n">boundaries</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â–¼</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">Reconnaissance</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Passive</span><span class="p">:</span><span class="w"> </span><span class="n">OSINT</span><span class="p">,</span><span class="w"> </span><span class="n">DNS</span><span class="p">,</span><span class="w"> </span><span class="n">WHOIS</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="p">(</span><span class="n">Information</span><span class="w">       </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Active</span><span class="p">:</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">scan</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="k">enum</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">     </span><span class="n">Gathering</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â–¼</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">Vulnerability</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Automated</span><span class="w"> </span><span class="n">scanning</span><span class="w"> </span><span class="p">(</span><span class="n">Nessus</span><span class="p">,</span><span class="w"> </span><span class="n">ZAP</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="n">Assessment</span><span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Manual</span><span class="w"> </span><span class="n">testing</span><span class="p">,</span><span class="w"> </span><span class="n">misconfigurations</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â–¼</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="n">Exploitation</span><span class="w">      </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Attempt</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">exploit</span><span class="w"> </span><span class="n">vulnerabilities</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                       </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Gain</span><span class="w"> </span><span class="n">access</span><span class="p">,</span><span class="w"> </span><span class="n">escalate</span><span class="w"> </span><span class="n">privileges</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â–¼</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="n">Post</span><span class="o">-</span><span class="n">Exploitation</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Lateral</span><span class="w"> </span><span class="n">movement</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">exfil</span><span class="w"> </span><span class="n">test</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                       </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Persistence</span><span class="w"> </span><span class="n">mechanisms</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â–¼</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="mf">6.</span><span class="w"> </span><span class="n">Reporting</span><span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Executive</span><span class="w"> </span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">technical</span><span class="w"> </span><span class="n">detail</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                       </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Remediation</span><span class="w"> </span><span class="n">recommendations</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="62-web-application-penetration-testing-checklist">6.2 Web Application Penetration Testing Checklist<a class="header-link" href="#62-web-application-penetration-testing-checklist" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="n">Web</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="n">Pentest</span><span class="w"> </span><span class="n">Checklist</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Authentication:</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Brute</span><span class="w"> </span><span class="k">force</span><span class="w"> </span><span class="n">protection</span><span class="w"> </span><span class="p">(</span><span class="n">account</span><span class="w"> </span><span class="n">lockout</span><span class="p">,</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="n">limiting</span><span class="p">)</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Password</span><span class="w"> </span><span class="n">complexity</span><span class="w"> </span><span class="n">enforcement</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Multi</span><span class="o">-</span><span class="n">factor</span><span class="w"> </span><span class="n">authentication</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Session</span><span class="w"> </span><span class="n">management</span><span class="w"> </span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span><span class="w"> </span><span class="n">rotation</span><span class="p">,</span><span class="w"> </span><span class="n">secure</span><span class="w"> </span><span class="n">flags</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Password</span><span class="w"> </span><span class="n">reset</span><span class="w"> </span><span class="n">mechanism</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Default</span><span class="w"> </span><span class="n">credentials</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Authorization:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Horizontal</span><span class="w"> </span><span class="n">privilege</span><span class="w"> </span><span class="n">escalation</span><span class="w"> </span><span class="p">(</span><span class="n">access</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">users</span><span class="p">&#39;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Vertical</span><span class="w"> </span><span class="n">privilege</span><span class="w"> </span><span class="n">escalation</span><span class="w"> </span><span class="p">(</span><span class="n">admin</span><span class="w"> </span><span class="n">functions</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">IDOR</span><span class="w"> </span><span class="p">(</span><span class="n">Insecure</span><span class="w"> </span><span class="n">Direct</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">Reference</span><span class="p">)</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Missing</span><span class="w"> </span><span class="k">function</span><span class="o">-</span><span class="n">level</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">control</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Input</span><span class="w"> </span><span class="nl">Validation:</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">Injection</span><span class="w"> </span><span class="p">(</span><span class="n">all</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">points</span><span class="p">)</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">XSS</span><span class="w"> </span><span class="p">(</span><span class="n">Reflected</span><span class="p">,</span><span class="w"> </span><span class="n">Stored</span><span class="p">,</span><span class="w"> </span><span class="n">DOM</span><span class="o">-</span><span class="n">based</span><span class="p">)</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="n">Injection</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="n">Traversal</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">LFI</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RFI</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">XML</span><span class="w"> </span><span class="n">External</span><span class="w"> </span><span class="n">Entity</span><span class="w"> </span><span class="p">(</span><span class="n">XXE</span><span class="p">)</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Server</span><span class="o">-</span><span class="n">Side</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="n">Forgery</span><span class="w"> </span><span class="p">(</span><span class="n">SSRF</span><span class="p">)</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Template</span><span class="w"> </span><span class="n">Injection</span><span class="w"> </span><span class="p">(</span><span class="n">SSTI</span><span class="p">)</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Configuration:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">HTTPS</span><span class="w"> </span><span class="n">enforcement</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="p">(</span><span class="n">CSP</span><span class="p">,</span><span class="w"> </span><span class="n">HSTS</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Frame</span><span class="o">-</span><span class="n">Options</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">.)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">CORS</span><span class="w"> </span><span class="n">policy</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">traces</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">production</span><span class="p">)</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Directory</span><span class="w"> </span><span class="n">listing</span><span class="w"> </span><span class="n">disabled</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Unnecessary</span><span class="w"> </span><span class="n">features</span><span class="o">/</span><span class="n">pages</span><span class="w"> </span><span class="n">removed</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Business</span><span class="w"> </span><span class="nl">Logic:</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Race</span><span class="w"> </span><span class="n">conditions</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="n">manipulation</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Workflow</span><span class="w"> </span><span class="n">bypass</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Mass</span><span class="w"> </span><span class="n">assignment</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">API</span><span class="o">-</span><span class="nl">Specific:</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">exposure</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Rate</span><span class="w"> </span><span class="n">limiting</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Excessive</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">exposure</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Lack</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">limits</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="63-python-penetration-testing-helpers">6.3 Python Penetration Testing Helpers<a class="header-link" href="#63-python-penetration-testing-helpers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Penetration testing helper functions.</span>
<span class="sd">For authorized testing only.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="c1"># â”€â”€â”€ SQL Injection Testing â”€â”€â”€</span>

<span class="n">SQL_INJECTION_PAYLOADS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;&#39; OR &#39;1&#39;=&#39;1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39; OR &#39;1&#39;=&#39;1&#39; --&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39; OR &#39;1&#39;=&#39;1&#39; /*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1; DROP TABLE users --&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39; UNION SELECT NULL,NULL,NULL --&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39; AND 1=1 --&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39; AND 1=2 --&quot;</span><span class="p">,</span>
    <span class="s2">&quot;admin&#39;--&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1&#39; ORDER BY 1 --&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1&#39; ORDER BY 100 --&quot;</span><span class="p">,</span>
    <span class="s2">&quot;-1 OR 1=1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39; OR &#39;&#39;=&#39;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;; WAITFOR DELAY &#39;0:0:5&#39; --&quot;</span><span class="p">,</span>  <span class="c1"># Time-based blind SQLi (MSSQL)</span>
    <span class="s2">&quot;&#39; OR SLEEP(5) --&quot;</span><span class="p">,</span>              <span class="c1"># Time-based blind SQLi (MySQL)</span>
<span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_sql_injection</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GET&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test a URL parameter for SQL injection vulnerabilities.</span>
<span class="sd">    Returns list of potentially vulnerable payloads.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># First, get a baseline response</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="n">param_name</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">param_name</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">baseline_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">baseline_time</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">payload</span> <span class="ow">in</span> <span class="n">SQL_INJECTION_PAYLOADS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="n">param_name</span><span class="p">:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">param_name</span><span class="p">:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span>
                <span class="p">)</span>

            <span class="c1"># Check for signs of SQL injection</span>
            <span class="n">indicators</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Error-based: SQL error messages in response</span>
            <span class="n">sql_errors</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;sql syntax&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql&quot;</span><span class="p">,</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">,</span> <span class="s2">&quot;postgresql&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ora-&quot;</span><span class="p">,</span> <span class="s2">&quot;unclosed quotation&quot;</span><span class="p">,</span> <span class="s2">&quot;unterminated string&quot;</span><span class="p">,</span>
                <span class="s2">&quot;syntax error&quot;</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">sql_errors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SQL error message: &#39;</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="c1"># Boolean-based: significant length difference</span>
            <span class="n">length_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">-</span> <span class="n">baseline_length</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">length_diff</span> <span class="o">&gt;</span> <span class="n">baseline_length</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">:</span>
                <span class="n">indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Response length changed: </span><span class="si">{</span><span class="n">baseline_length</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Time-based: response took significantly longer</span>
            <span class="n">time_diff</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">-</span> <span class="n">baseline_time</span>
            <span class="k">if</span> <span class="n">time_diff</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">:</span>
                <span class="n">indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Response delayed: </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(baseline: </span><span class="si">{</span><span class="n">baseline_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s)&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">indicators</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="s1">&#39;indicators&#39;</span><span class="p">:</span> <span class="n">indicators</span><span class="p">,</span>
                    <span class="s1">&#39;response_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">),</span>
                    <span class="s1">&#39;response_time&#39;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                <span class="p">})</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;indicators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Request timed out (possible time-based SQLi)&#39;</span><span class="p">],</span>
                <span class="s1">&#39;response_length&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;response_time&#39;</span><span class="p">:</span> <span class="mf">15.0</span>
            <span class="p">})</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Connection error, skip</span>

    <span class="k">return</span> <span class="n">results</span>


<span class="c1"># â”€â”€â”€ XSS Testing â”€â”€â”€</span>

<span class="n">XSS_PAYLOADS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;&lt;script&gt;alert(1)&lt;/script&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;&lt;img src=x onerror=alert(1)&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;&lt;svg onload=alert(1)&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;&#39;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;-alert(1)-&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;&lt;body onload=alert(1)&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;{{7*7}}&#39;</span><span class="p">,</span>  <span class="c1"># Template injection test</span>
    <span class="s1">&#39;${7*7}&#39;</span><span class="p">,</span>   <span class="c1"># Template injection test</span>
    <span class="s1">&#39;javascript:alert(1)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;&#39;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_reflected_xss</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test for reflected XSS by checking if payloads appear</span>
<span class="sd">    unescaped in the response.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">payload</span> <span class="ow">in</span> <span class="n">XSS_PAYLOADS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="n">param_name</span><span class="p">:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>

            <span class="c1"># Check if payload is reflected without encoding</span>
            <span class="k">if</span> <span class="n">payload</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;reflected&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="c1"># Check for HTML-encoded version (partial protection)</span>
            <span class="n">encoded</span> <span class="o">=</span> <span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">)</span>
                              <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">)</span>
                              <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;quot;&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">encoded</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">payload</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;reflected&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;encoded&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                <span class="p">})</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">results</span>


<span class="c1"># â”€â”€â”€ Security Header Checker â”€â”€â”€</span>

<span class="n">SECURITY_HEADERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;HSTS - Forces HTTPS&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recommended&#39;</span><span class="p">:</span> <span class="s1">&#39;max-age=31536000; includeSubDomains&#39;</span><span class="p">,</span>
        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;CSP - Prevents XSS and injection&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recommended&#39;</span><span class="p">:</span> <span class="s2">&quot;default-src &#39;self&#39;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;X-Content-Type-Options&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Prevents MIME sniffing&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recommended&#39;</span><span class="p">:</span> <span class="s1">&#39;nosniff&#39;</span><span class="p">,</span>
        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;X-Frame-Options&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Prevents clickjacking&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recommended&#39;</span><span class="p">:</span> <span class="s1">&#39;DENY&#39;</span><span class="p">,</span>
        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;X-XSS-Protection&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Legacy XSS filter&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recommended&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>  <span class="c1"># Modern guidance: disable, use CSP</span>
        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;LOW&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;Referrer-Policy&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Controls referrer information&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recommended&#39;</span><span class="p">:</span> <span class="s1">&#39;strict-origin-when-cross-origin&#39;</span><span class="p">,</span>
        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;LOW&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;Permissions-Policy&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Controls browser features&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recommended&#39;</span><span class="p">:</span> <span class="s1">&#39;camera=(), microphone=(), geolocation=()&#39;</span><span class="p">,</span>
        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">check_security_headers</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check security headers of a URL.&quot;&quot;&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
        <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
        <span class="s1">&#39;headers_present&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;headers_missing&#39;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">SECURITY_HEADERS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;headers_present&#39;</span><span class="p">][</span><span class="n">header</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;headers_missing&#39;</span><span class="p">][</span><span class="n">header</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;recommended&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;recommended&#39;</span><span class="p">],</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;severity&#39;</span><span class="p">],</span>
            <span class="p">}</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>

<hr />
<h2 id="7-security-code-review-checklist">7. Security Code Review Checklist<a class="header-link" href="#7-security-code-review-checklist" title="Permanent link">&para;</a></h2>
<h3 id="71-code-review-process">7.1 Code Review Process<a class="header-link" href="#71-code-review-process" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span><span class="nv">Security</span><span class="w"> </span><span class="nv">Code</span><span class="w"> </span><span class="nv">Review</span><span class="w"> </span><span class="nv">Process</span><span class="w">                         </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Step</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">Understand</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">Change</span><span class="w">                                   </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">What</span><span class="w"> </span><span class="nv">does</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="k">do</span>?<span class="w">                                     </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">What</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">does</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">process</span>?<span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">What</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">trust</span><span class="w"> </span><span class="nv">boundaries</span>?<span class="w">                              </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Step</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">Check</span><span class="w"> </span><span class="nv">Input</span><span class="o">/</span><span class="nv">Output</span><span class="w">                                      </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">All</span><span class="w"> </span><span class="nv">external</span><span class="w"> </span><span class="nv">input</span><span class="w"> </span><span class="nv">validated</span>?<span class="w">                               </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Output</span><span class="w"> </span><span class="nv">properly</span><span class="w"> </span><span class="nv">encoded</span>?<span class="w">                                    </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">File</span><span class="w"> </span><span class="nv">operations</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">safe</span><span class="w"> </span><span class="nv">paths</span>?<span class="w">                             </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Step</span><span class="w"> </span><span class="mi">3</span>:<span class="w"> </span><span class="nv">Authentication</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nv">Authorization</span><span class="w">                          </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Auth</span><span class="w"> </span><span class="nv">checks</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">protected</span><span class="w"> </span><span class="nv">endpoints</span>?<span class="w">                     </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Proper</span><span class="w"> </span><span class="nv">session</span><span class="w"> </span><span class="nv">management</span>?<span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Least</span><span class="w"> </span><span class="nv">privilege</span><span class="w"> </span><span class="nv">applied</span>?<span class="w">                                    </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Step</span><span class="w"> </span><span class="mi">4</span>:<span class="w"> </span><span class="nv">Data</span><span class="w"> </span><span class="nv">Protection</span><span class="w">                                         </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Sensitive</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">encrypted</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">rest</span>?<span class="w">                           </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Sensitive</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">encrypted</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">transit</span>?<span class="w">                        </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">secrets</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nv">code</span>?<span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">PII</span><span class="w"> </span><span class="nv">handled</span><span class="w"> </span><span class="nv">correctly</span>?<span class="w">                                      </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Step</span><span class="w"> </span><span class="mi">5</span>:<span class="w"> </span><span class="nv">Error</span><span class="w"> </span><span class="nv">Handling</span><span class="w">                                          </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Errors</span><span class="w"> </span><span class="nv">don</span><span class="err">&#39;t leak information?                              â”‚</span>
<span class="err">â”‚  â”œâ”€â”€ Proper exception handling?                                  â”‚</span>
<span class="err">â”‚  â””â”€â”€ Fail securely (deny by default)?                           â”‚</span>
<span class="err">â”‚                                                                   â”‚</span>
<span class="err">â”‚  Step 6: Dependencies                                            â”‚</span>
<span class="err">â”‚  â”œâ”€â”€ New dependencies reviewed?                                  â”‚</span>
<span class="err">â”‚  â”œâ”€â”€ Versions pinned?                                            â”‚</span>
<span class="err">â”‚  â””â”€â”€ Known vulnerabilities checked?                              â”‚</span>
<span class="err">â”‚                                                                   â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="72-python-specific-security-review-checklist">7.2 Python-Specific Security Review Checklist<a class="header-link" href="#72-python-specific-security-review-checklist" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Python Security Code Review Checklist with Examples.</span>
<span class="sd">Each section shows a VULNERABLE and SECURE version.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># â”€â”€â”€ 1. Input Validation â”€â”€â”€</span>

<span class="c1"># VULNERABLE: No validation</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_bad</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM users WHERE id = </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="c1"># SECURE: Parameterized query + type validation</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_good</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">user_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid user ID&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,))</span>


<span class="c1"># â”€â”€â”€ 2. Authentication â”€â”€â”€</span>

<span class="c1"># VULNERABLE: Timing attack on password comparison</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_password_bad</span><span class="p">(</span><span class="n">stored</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provided</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">stored</span> <span class="o">==</span> <span class="n">provided</span>  <span class="c1"># String comparison short-circuits</span>

<span class="c1"># SECURE: Constant-time comparison</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hmac</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_password_good</span><span class="p">(</span><span class="n">stored</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provided</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">stored</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">provided</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>


<span class="c1"># â”€â”€â”€ 3. Serialization â”€â”€â”€</span>

<span class="c1"># VULNERABLE: pickle with untrusted data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_data_bad</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Arbitrary code execution!</span>

<span class="c1"># SECURE: Use JSON or validated schemas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_data_good</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">parsed</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># Validate schema</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected JSON object&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parsed</span>


<span class="c1"># â”€â”€â”€ 4. File Operations â”€â”€â”€</span>

<span class="c1"># VULNERABLE: Path traversal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="k">def</span><span class="w"> </span><span class="nf">read_file_bad</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/uploads/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># SECURE: Resolve and validate path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="n">UPLOAD_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/uploads&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">read_file_good</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">UPLOAD_DIR</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_relative_to</span><span class="p">(</span><span class="n">UPLOAD_DIR</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Path traversal detected&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;File not found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">file_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>


<span class="c1"># â”€â”€â”€ 5. Cryptography â”€â”€â”€</span>

<span class="c1"># VULNERABLE: Weak hashing</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hash_password_bad</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="c1"># SECURE: Proper password hashing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">argon2</span><span class="w"> </span><span class="kn">import</span> <span class="n">PasswordHasher</span>
<span class="n">ph</span> <span class="o">=</span> <span class="n">PasswordHasher</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">hash_password_good</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">ph</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">verify_password_good</span><span class="p">(</span><span class="nb">hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ph</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="nb">hash</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="c1"># â”€â”€â”€ 6. Subprocess â”€â”€â”€</span>

<span class="c1"># VULNERABLE: Shell injection</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_command_bad</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cat </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># SECURE: No shell, use list</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_command_good</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># Validate filename first</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>  <span class="c1"># No path separators</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid filename&quot;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span> <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># â”€â”€â”€ 7. Logging â”€â”€â”€</span>

<span class="c1"># VULNERABLE: Logging sensitive data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">login_bad</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Login attempt: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Logs password!</span>

<span class="c1"># SECURE: Never log secrets</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login_good</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Login attempt: user=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Use placeholders for sensitive fields</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Login attempt: user=</span><span class="si">%s</span><span class="s2"> password=&lt;REDACTED&gt;&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>


<span class="c1"># â”€â”€â”€ 8. Regular Expressions â”€â”€â”€</span>

<span class="c1"># VULNERABLE: ReDoS (Regular expression Denial of Service)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_email_bad</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># This pattern is vulnerable to catastrophic backtracking</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^([a-zA-Z0-9]+)*@[a-zA-Z0-9]+\.[a-zA-Z]+$&#39;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">))</span>

<span class="c1"># SECURE: Use a well-tested library or simple pattern</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_email_good</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># Simple, non-backtracking pattern</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">254</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^[^@\s]+@[^@\s]+\.[^@\s]+$&#39;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">email</span><span class="p">))</span>
</code></pre></div>

<hr />
<h2 id="8-cicd-security-pipeline-integration">8. CI/CD Security Pipeline Integration<a class="header-link" href="#8-cicd-security-pipeline-integration" title="Permanent link">&para;</a></h2>
<h3 id="81-github-actions-security-pipeline">8.1 GitHub Actions Security Pipeline<a class="header-link" href="#81-github-actions-security-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .github/workflows/security.yml</span>

<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Security Scanning Pipeline</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Run weekly on Monday at 9 AM UTC</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cron</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0</span><span class="nv"> </span><span class="s">9</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">1&#39;</span>

<span class="nt">permissions</span><span class="p">:</span>
<span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">security-events</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span><span class="w">  </span><span class="c1"># For SARIF upload</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># â”€â”€â”€ Stage 1: SAST â”€â”€â”€</span>
<span class="w">  </span><span class="nt">sast-bandit</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SAST:</span><span class="nv"> </span><span class="s">Bandit&quot;</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.12&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Bandit</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install bandit[toml]</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Bandit</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">bandit -r src/ \</span>
<span class="w">            </span><span class="no">-f sarif \</span>
<span class="w">            </span><span class="no">-o bandit-results.sarif \</span>
<span class="w">            </span><span class="no">--severity-level medium \</span>
<span class="w">            </span><span class="no">--confidence-level medium \</span>
<span class="w">            </span><span class="no">--exclude tests/</span>
<span class="w">        </span><span class="nt">continue-on-error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload SARIF</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/upload-sarif@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">sarif_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bandit-results.sarif</span>

<span class="w">  </span><span class="nt">sast-semgrep</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SAST:</span><span class="nv"> </span><span class="s">Semgrep&quot;</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Semgrep</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semgrep/semgrep-action@v1</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
<span class="w">            </span><span class="no">p/python</span>
<span class="w">            </span><span class="no">p/flask</span>
<span class="w">            </span><span class="no">p/owasp-top-ten</span>
<span class="w">            </span><span class="no">.semgrep/custom_rules.yaml</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">SEMGREP_APP_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SEMGREP_APP_TOKEN }}</span>

<span class="w">  </span><span class="c1"># â”€â”€â”€ Stage 2: SCA â”€â”€â”€</span>
<span class="w">  </span><span class="nt">sca-dependencies</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SCA:</span><span class="nv"> </span><span class="s">Dependency</span><span class="nv"> </span><span class="s">Check&quot;</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v5</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.12&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install -r requirements.txt</span>
<span class="w">          </span><span class="no">pip install pip-audit safety</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run pip-audit</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip-audit \</span>
<span class="w">            </span><span class="no">-r requirements.txt \</span>
<span class="w">            </span><span class="no">-f json \</span>
<span class="w">            </span><span class="no">-o pip-audit-results.json \</span>
<span class="w">            </span><span class="no">--desc</span>
<span class="w">        </span><span class="nt">continue-on-error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Safety</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">safety check \</span>
<span class="w">            </span><span class="no">-r requirements.txt \</span>
<span class="w">            </span><span class="no">--full-report \</span>
<span class="w">            </span><span class="no">--output json &gt; safety-results.json</span>
<span class="w">        </span><span class="nt">continue-on-error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check for critical vulnerabilities</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">python -c &quot;</span>
<span class="w">          </span><span class="no">import json, sys</span>
<span class="w">          </span><span class="no">with open(&#39;pip-audit-results.json&#39;) as f:</span>
<span class="w">              </span><span class="no">data = json.load(f)</span>
<span class="w">          </span><span class="no">vulns = []</span>
<span class="w">          </span><span class="no">for dep in data.get(&#39;dependencies&#39;, []):</span>
<span class="w">              </span><span class="no">vulns.extend(dep.get(&#39;vulns&#39;, []))</span>
<span class="w">          </span><span class="no">if vulns:</span>
<span class="w">              </span><span class="no">print(f&#39;Found {len(vulns)} vulnerabilities!&#39;)</span>
<span class="w">              </span><span class="no">for v in vulns:</span>
<span class="w">                  </span><span class="no">print(f&#39;  - {v[\&quot;id\&quot;]}: {v.get(\&quot;description\&quot;, \&quot;\&quot;)[:80]}&#39;)</span>
<span class="w">              </span><span class="no">sys.exit(1)</span>
<span class="w">          </span><span class="no">print(&#39;No vulnerabilities found.&#39;)</span>
<span class="w">          </span><span class="no">&quot;</span>

<span class="w">  </span><span class="c1"># â”€â”€â”€ Stage 3: Secret Scanning â”€â”€â”€</span>
<span class="w">  </span><span class="nt">secret-scanning</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Secret</span><span class="nv"> </span><span class="s">Scanning&quot;</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fetch-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">  </span><span class="c1"># Full history for secret scanning</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Gitleaks</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitleaks/gitleaks-action@v2</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">GITHUB_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run TruffleHog</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trufflesecurity/trufflehog@main</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">extra_args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--only-verified</span>

<span class="w">  </span><span class="c1"># â”€â”€â”€ Stage 4: Container Scanning â”€â”€â”€</span>
<span class="w">  </span><span class="nt">container-scan</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Container</span><span class="nv"> </span><span class="s">Scan&quot;</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;push&#39;</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build Docker image</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker build -t myapp:${{ github.sha }} .</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Trivy</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aquasecurity/trivy-action@master</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">image-ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:${{ github.sha }}</span>
<span class="w">          </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;sarif&#39;</span>
<span class="w">          </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;trivy-results.sarif&#39;</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;CRITICAL,HIGH&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload Trivy SARIF</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/upload-sarif@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">sarif_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trivy-results.sarif</span>

<span class="w">  </span><span class="c1"># â”€â”€â”€ Stage 5: DAST (on staging) â”€â”€â”€</span>
<span class="w">  </span><span class="nt">dast-zap</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DAST:</span><span class="nv"> </span><span class="s">ZAP</span><span class="nv"> </span><span class="s">Baseline&quot;</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">sast-bandit</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sast-semgrep</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sca-dependencies</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/main&#39;</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start application</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">docker-compose up -d</span>
<span class="w">          </span><span class="no">sleep 10  # Wait for app to start</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run ZAP Baseline Scan</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">zaproxy/action-baseline@v0.12.0</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;http://localhost:8080&#39;</span>
<span class="w">          </span><span class="nt">rules_file_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;.zap/rules.tsv&#39;</span>
<span class="w">          </span><span class="nt">cmd_options</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;-a&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Stop application</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker-compose down</span>

<span class="w">  </span><span class="c1"># â”€â”€â”€ Security Gate â”€â”€â”€</span>
<span class="w">  </span><span class="nt">security-gate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Security</span><span class="nv"> </span><span class="s">Gate&quot;</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">sast-bandit</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sast-semgrep</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sca-dependencies</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">secret-scanning</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check results</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">echo &quot;All security checks passed!&quot;</span>
<span class="w">          </span><span class="no">echo &quot;Review the Security tab for detailed findings.&quot;</span>
</code></pre></div>

<h3 id="82-pre-commit-hooks-for-security">8.2 Pre-commit Hooks for Security<a class="header-link" href="#82-pre-commit-hooks-for-security" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .pre-commit-config.yaml</span>

<span class="nt">repos</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Bandit - Python security linter</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/PyCQA/bandit</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.7.7&#39;</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bandit</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-c&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;pyproject.toml&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;-ll&#39;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">additional_dependencies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;bandit[toml]&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="c1"># Detect secrets</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/Yelp/detect-secrets</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.4.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">detect-secrets</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;--baseline&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;.secrets.baseline&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="c1"># Check for private keys</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/pre-commit/pre-commit-hooks</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v4.5.0</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">detect-private-key</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">check-added-large-files</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;--maxkb=500&#39;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="c1"># Gitleaks</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/gitleaks/gitleaks</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v8.18.1</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitleaks</span>
</code></pre></div>

<h3 id="83-gitlab-ci-security-pipeline">8.3 GitLab CI Security Pipeline<a class="header-link" href="#83-gitlab-ci-security-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .gitlab-ci.yml</span>

<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>

<span class="nt">variables</span><span class="p">:</span>
<span class="w">  </span><span class="nt">PIP_CACHE_DIR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$CI_PROJECT_DIR/.cache/pip&quot;</span>

<span class="c1"># â”€â”€â”€ SAST Stage â”€â”€â”€</span>
<span class="nt">bandit-sast</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:3.12-slim</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install bandit</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bandit -r src/ -f json -o gl-sast-report.json --severity-level medium || true</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gl-sast-report.json</span>

<span class="nt">semgrep-sast</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semgrep/semgrep:latest</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semgrep --config auto --sarif -o semgrep-results.sarif .</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semgrep-results.sarif</span>

<span class="c1"># â”€â”€â”€ Dependency Scanning â”€â”€â”€</span>
<span class="nt">dependency-check</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:3.12-slim</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install pip-audit</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip-audit -r requirements.txt --strict</span>
<span class="w">  </span><span class="nt">allow_failure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1"># â”€â”€â”€ Secret Detection â”€â”€â”€</span>
<span class="nt">secret-detection</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">zricethezav/gitleaks:latest</span>
<span class="w">    </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitleaks detect --source . --report-path gitleaks-report.json</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">secret_detection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitleaks-report.json</span>
</code></pre></div>

<hr />
<h2 id="9-comprehensive-security-scanning-script">9. Comprehensive Security Scanning Script<a class="header-link" href="#9-comprehensive-security-scanning-script" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">security_scanner.py - Unified security scanning orchestrator.</span>
<span class="sd">Runs multiple security tools and generates a combined report.</span>

<span class="sd">Usage:</span>
<span class="sd">    python security_scanner.py --project-dir ./myproject</span>
<span class="sd">    python security_scanner.py --project-dir ./myproject --output report.json</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">asdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Finding</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A single security finding from any tool.&quot;&quot;&quot;</span>
    <span class="n">tool</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># CRITICAL, HIGH, MEDIUM, LOW, INFO</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># SAST, SCA, SECRET, CONFIG</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">line</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cwe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ScanReport</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combined report from all scanners.&quot;&quot;&quot;</span>
    <span class="n">project</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">scan_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">scan_duration_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">findings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">tools_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">tools_failed</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">summary</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_date</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SecurityScanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrates multiple security scanning tools.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">=</span> <span class="n">ScanReport</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScanReport</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all available security scanners.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Starting security scan of: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scan started at: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">scan_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_run_bandit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_pip_audit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_secret_check</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_security_configs</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">scan_duration_seconds</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_summary</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_bandit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run Bandit SAST scanner.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Running Bandit (SAST)...&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;bandit&quot;</span><span class="p">,</span> <span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span><span class="p">),</span>
                    <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;--severity-level&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="s2">&quot;tests,venv,.tox&quot;</span>
                <span class="p">],</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">120</span>
            <span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                    <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;bandit&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">issue</span><span class="p">[</span><span class="s2">&quot;issue_severity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="n">category</span><span class="o">=</span><span class="s2">&quot;SAST&quot;</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">issue</span><span class="p">[</span><span class="s1">&#39;test_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">issue</span><span class="p">[</span><span class="s1">&#39;test_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">issue</span><span class="p">[</span><span class="s2">&quot;issue_text&quot;</span><span class="p">],</span>
                    <span class="n">file</span><span class="o">=</span><span class="n">issue</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span>
                    <span class="n">line</span><span class="o">=</span><span class="n">issue</span><span class="p">[</span><span class="s2">&quot;line_number&quot;</span><span class="p">],</span>
                    <span class="n">cwe</span><span class="o">=</span><span class="n">issue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;issue_cwe&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
                <span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_run</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bandit&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[]))</span><span class="si">}</span><span class="s2"> issues&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    [!] Bandit not installed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_failed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bandit&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] Bandit failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_failed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bandit&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_pip_audit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run pip-audit SCA scanner.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Running pip-audit (SCA)...&quot;</span><span class="p">)</span>

        <span class="n">req_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;requirements.txt&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">req_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    [!] No requirements.txt found, skipping&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;pip-audit&quot;</span><span class="p">,</span> <span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">req_file</span><span class="p">),</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;--desc&quot;</span><span class="p">],</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">120</span>
            <span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="n">vuln_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependencies&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">for</span> <span class="n">vuln</span> <span class="ow">in</span> <span class="n">dep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vulns&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">vuln_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">fix_versions</span> <span class="o">=</span> <span class="n">vuln</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fix_versions&quot;</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;pip-audit&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                        <span class="n">category</span><span class="o">=</span><span class="s2">&quot;SCA&quot;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dep</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dep</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">vuln</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="n">vuln</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                        <span class="n">fix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Upgrade to </span><span class="si">{</span><span class="n">fix_versions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="k">if</span> <span class="n">fix_versions</span> <span class="k">else</span> <span class="s2">&quot;No fix available&quot;</span><span class="p">,</span>
                    <span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_run</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pip-audit&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Found </span><span class="si">{</span><span class="n">vuln_count</span><span class="si">}</span><span class="s2"> vulnerable dependencies&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    [!] pip-audit not installed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_failed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pip-audit&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] pip-audit failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_failed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pip-audit&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_secret_check</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for hardcoded secrets in source files.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Checking for hardcoded secrets...&quot;</span><span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

        <span class="n">secret_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)(api[_-]?key|apikey)\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">][a-zA-Z0-9]{20,}[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">,</span>
             <span class="s2">&quot;Possible API key&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)(password|passwd|pwd)\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">][^&quot;</span><span class="se">\&#39;</span><span class="s1">]{6,}[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">,</span>
             <span class="s2">&quot;Possible hardcoded password&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)(secret|token)\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">][a-zA-Z0-9+/=]{20,}[&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">,</span>
             <span class="s2">&quot;Possible hardcoded secret/token&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-----BEGIN (?:RSA |DSA |EC )?PRIVATE KEY-----&#39;</span><span class="p">,</span>
             <span class="s2">&quot;Private key detected&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)aws[_-]?(?:access[_-]?key[_-]?id|secret[_-]?access[_-]?key)\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?[A-Z0-9]{16,}&#39;</span><span class="p">,</span>
             <span class="s2">&quot;Possible AWS credential&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">findings_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="c1"># Skip virtual environments and test fixtures</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">py_file</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">part</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span>
                   <span class="p">[</span><span class="s1">&#39;venv&#39;</span><span class="p">,</span> <span class="s1">&#39;.tox&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules&#39;</span><span class="p">,</span> <span class="s1">&#39;__pycache__&#39;</span><span class="p">]):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">py_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># Skip comments with nosec</span>
                    <span class="k">if</span> <span class="s1">&#39;# nosec&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s1">&#39;# noqa&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">secret_patterns</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                            <span class="n">findings_count</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                                <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;secret-scanner&quot;</span><span class="p">,</span>
                                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                                <span class="n">category</span><span class="o">=</span><span class="s2">&quot;SECRET&quot;</span><span class="p">,</span>
                                <span class="n">title</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Potential secret found in source code&quot;</span><span class="p">,</span>
                                <span class="n">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">),</span>
                                <span class="n">line</span><span class="o">=</span><span class="n">line_num</span><span class="p">,</span>
                                <span class="n">cwe</span><span class="o">=</span><span class="s2">&quot;CWE-798&quot;</span><span class="p">,</span>
                                <span class="n">fix</span><span class="o">=</span><span class="s2">&quot;Move secrets to environment variables or &quot;</span>
                                    <span class="s2">&quot;a secret management service&quot;</span><span class="p">,</span>
                            <span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_run</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;secret-scanner&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Found </span><span class="si">{</span><span class="n">findings_count</span><span class="si">}</span><span class="s2"> potential secrets&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_security_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for security-related configuration issues.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Checking security configurations...&quot;</span><span class="p">)</span>

        <span class="n">findings_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Check for DEBUG mode in Flask/Django settings</span>
        <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">py_file</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">part</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;venv&#39;</span><span class="p">,</span> <span class="s1">&#39;.tox&#39;</span><span class="p">]):</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">py_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

                <span class="c1"># Flask DEBUG</span>
                <span class="k">if</span> <span class="s1">&#39;app.run(debug=True)&#39;</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                    <span class="n">findings_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;config-checker&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span>
                        <span class="n">category</span><span class="o">=</span><span class="s2">&quot;CONFIG&quot;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Flask debug mode enabled&quot;</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Debug mode should not be enabled in production&quot;</span><span class="p">,</span>
                        <span class="n">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">),</span>
                        <span class="n">fix</span><span class="o">=</span><span class="s2">&quot;Use environment variable: &quot;</span>
                            <span class="s2">&quot;app.run(debug=os.getenv(&#39;FLASK_DEBUG&#39;, False))&quot;</span><span class="p">,</span>
                    <span class="p">))</span>

                <span class="c1"># Django DEBUG</span>
                <span class="k">if</span> <span class="s1">&#39;DEBUG = True&#39;</span> <span class="ow">in</span> <span class="n">content</span> <span class="ow">and</span> <span class="s1">&#39;settings&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">):</span>
                    <span class="n">findings_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                        <span class="n">tool</span><span class="o">=</span><span class="s2">&quot;config-checker&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span>
                        <span class="n">category</span><span class="o">=</span><span class="s2">&quot;CONFIG&quot;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Django DEBUG mode enabled in settings&quot;</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;DEBUG should be False in production&quot;</span><span class="p">,</span>
                        <span class="n">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">),</span>
                        <span class="n">fix</span><span class="o">=</span><span class="s2">&quot;Use: DEBUG = os.getenv(&#39;DJANGO_DEBUG&#39;, &#39;False&#39;) == &#39;True&#39;&quot;</span><span class="p">,</span>
                    <span class="p">))</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_run</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;config-checker&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Found </span><span class="si">{</span><span class="n">findings_count</span><span class="si">}</span><span class="s2"> configuration issues&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate summary statistics.&quot;&quot;&quot;</span>
        <span class="n">severity_counts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;CRITICAL&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;LOW&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="n">category_counts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;SAST&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;SCA&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;SECRET&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;CONFIG&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">findings</span><span class="p">:</span>
            <span class="n">severity_counts</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="p">]</span> <span class="o">=</span> <span class="n">severity_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">category_counts</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">category_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_findings&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">findings</span><span class="p">),</span>
            <span class="s1">&#39;by_severity&#39;</span><span class="p">:</span> <span class="n">severity_counts</span><span class="p">,</span>
            <span class="s1">&#39;by_category&#39;</span><span class="p">:</span> <span class="n">category_counts</span><span class="p">,</span>
            <span class="s1">&#39;tools_run&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_run</span><span class="p">),</span>
            <span class="s1">&#39;tools_failed&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">tools_failed</span><span class="p">),</span>
        <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">print_report</span><span class="p">(</span><span class="n">report</span><span class="p">:</span> <span class="n">ScanReport</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print a formatted text report.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  SECURITY SCAN REPORT&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Project:  </span><span class="si">{</span><span class="n">report</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Date:     </span><span class="si">{</span><span class="n">report</span><span class="o">.</span><span class="n">scan_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Duration: </span><span class="si">{</span><span class="n">report</span><span class="o">.</span><span class="n">scan_duration_seconds</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Tools:    </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">tools_run</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">report</span><span class="o">.</span><span class="n">tools_failed</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failed:   </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">tools_failed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">summary</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Total findings: </span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;total_findings&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  By severity: &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;CRITICAL=</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_severity&#39;</span><span class="p">][</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;HIGH=</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_severity&#39;</span><span class="p">][</span><span class="s1">&#39;HIGH&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;MEDIUM=</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_severity&#39;</span><span class="p">][</span><span class="s1">&#39;MEDIUM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;LOW=</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_severity&#39;</span><span class="p">][</span><span class="s1">&#39;LOW&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  By category: &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;SAST=</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_category&#39;</span><span class="p">][</span><span class="s1">&#39;SAST&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;SCA=</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_category&#39;</span><span class="p">][</span><span class="s1">&#39;SCA&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;SECRET=</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_category&#39;</span><span class="p">][</span><span class="s1">&#39;SECRET&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;CONFIG=</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_category&#39;</span><span class="p">][</span><span class="s1">&#39;CONFIG&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Print findings grouped by severity</span>
    <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span> <span class="s1">&#39;LOW&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">]:</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">report</span><span class="o">.</span><span class="n">findings</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="n">severity</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">findings</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">severity</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2"> findings)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">findings</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">tool</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;    File: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">line</span><span class="p">:</span>
                    <span class="n">loc</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">description</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">fix</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Fix: </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">fix</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_severity&#39;</span><span class="p">][</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;by_severity&#39;</span><span class="p">][</span><span class="s1">&#39;HIGH&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  RESULT: FAIL - Critical/High issues found&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;total_findings&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  RESULT: WARN - Issues found, review recommended&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  RESULT: PASS - No issues found&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unified Security Scanner&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--project-dir&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to project directory&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--output&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output JSON report file&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--fail-on&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Severity level that causes non-zero exit&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">scanner</span> <span class="o">=</span> <span class="n">SecurityScanner</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">project_dir</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">run_all</span><span class="p">()</span>

    <span class="c1"># Print text report</span>
    <span class="n">print_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

    <span class="c1"># Save JSON report</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">asdict</span><span class="p">(</span><span class="n">report</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">JSON report saved to: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Exit code based on findings</span>
    <span class="n">severity_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;critical&#39;</span><span class="p">]</span>
    <span class="n">threshold_idx</span> <span class="o">=</span> <span class="n">severity_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">fail_on</span><span class="p">)</span>
    <span class="n">fail_severities</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">severity_order</span><span class="p">[</span><span class="n">threshold_idx</span><span class="p">:]]</span>

    <span class="k">for</span> <span class="n">finding</span> <span class="ow">in</span> <span class="n">report</span><span class="o">.</span><span class="n">findings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">finding</span><span class="o">.</span><span class="n">severity</span> <span class="ow">in</span> <span class="n">fail_severities</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="10-exercises">10. Exercises<a class="header-link" href="#10-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-bandit-scan-analysis">Exercise 1: Bandit Scan Analysis<a class="header-link" href="#exercise-1-bandit-scan-analysis" title="Permanent link">&para;</a></h3>
<p>Run Bandit on this intentionally vulnerable code and fix all findings:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;vulnerable_app.py - Fix all security issues found by Bandit.&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s2">&quot;my-super-secret-key-12345&quot;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/search&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;app.db&#39;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM products WHERE name LIKE &#39;%</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">%&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_command</span><span class="p">():</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/load&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hash&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hash_password</span><span class="p">():</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pw&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p><strong>Tasks:</strong>
1. Run <code>bandit vulnerable_app.py</code> and document all findings
2. Fix each vulnerability
3. Run Bandit again to verify all issues are resolved</p>
<h3 id="exercise-2-write-custom-semgrep-rules">Exercise 2: Write Custom Semgrep Rules<a class="header-link" href="#exercise-2-write-custom-semgrep-rules" title="Permanent link">&para;</a></h3>
<p>Write Semgrep rules that detect:
1. Use of <code>os.system()</code> with any string concatenation
2. Flask routes that accept POST but do not validate <code>Content-Type</code>
3. Any use of <code>eval()</code> or <code>exec()</code> within a function that handles HTTP requests
4. Hardcoded database connection strings</p>
<h3 id="exercise-3-dependency-audit">Exercise 3: Dependency Audit<a class="header-link" href="#exercise-3-dependency-audit" title="Permanent link">&para;</a></h3>
<p>Create a <code>requirements.txt</code> with intentionally old, vulnerable packages:</p>
<div class="highlight"><pre><span></span><code>flask==2.0.1
requests==2.25.1
django==3.2.0
pyyaml==5.3.1
pillow==8.0.0
</code></pre></div>

<ol>
<li>Run <code>pip-audit -r requirements.txt</code> and document all CVEs found</li>
<li>Determine the minimum safe version for each package</li>
<li>Create a <code>requirements-secure.txt</code> with fixed versions</li>
</ol>
<h3 id="exercise-4-property-based-testing">Exercise 4: Property-Based Testing<a class="header-link" href="#exercise-4-property-based-testing" title="Permanent link">&para;</a></h3>
<p>Write Hypothesis tests for:
1. A password strength validator (must have uppercase, lowercase, digit, special char, min 8 chars)
2. A URL sanitizer that should prevent <code>javascript:</code> and <code>data:</code> schemes
3. An HTML tag stripper that should remove all HTML but preserve text content</p>
<h3 id="exercise-5-cicd-security-pipeline">Exercise 5: CI/CD Security Pipeline<a class="header-link" href="#exercise-5-cicd-security-pipeline" title="Permanent link">&para;</a></h3>
<p>Design and implement a GitHub Actions workflow that:
1. Runs Bandit with SARIF output
2. Runs pip-audit on requirements.txt
3. Checks for secrets using gitleaks
4. Fails the pipeline if any HIGH or CRITICAL findings exist
5. Posts a comment on the PR with a summary of findings</p>
<h3 id="exercise-6-security-code-review">Exercise 6: Security Code Review<a class="header-link" href="#exercise-6-security-code-review" title="Permanent link">&para;</a></h3>
<p>Review this code and identify all security issues:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/users/&lt;user_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;users.db&#39;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;SELECT id, name, email, ssn FROM users WHERE id = </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;ssn&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="p">})</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">}),</span> <span class="mi">404</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;users.db&#39;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;SELECT * FROM users WHERE email = &#39;</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;AND password = &#39;</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="mi">4</span><span class="p">]},</span>
            <span class="s1">&#39;secret123&#39;</span><span class="p">,</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;HS256&#39;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid credentials&#39;</span><span class="p">}),</span> <span class="mi">401</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/redirect&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_redirect</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/upload&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">upload</span><span class="p">():</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/uploads&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded&#39;</span><span class="p">})</span>
</code></pre></div>

<p>Document at least 10 distinct security vulnerabilities and provide fixes for each one.</p>
<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="n">Security</span><span class="w"> </span><span class="n">Testing</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="n">Takeaways</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">Layer</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">defenses</span><span class="p">:</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">SAST</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SCA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DAST</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fuzzing</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">Shift</span><span class="w"> </span><span class="n">left</span><span class="p">:</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">bugs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">early</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">SDLC</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Automate</span><span class="p">:</span><span class="w"> </span><span class="n">Integrate</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">tools</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">CI</span><span class="o">/</span><span class="n">CD</span><span class="w"> </span><span class="n">pipeline</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="n">Custom</span><span class="w"> </span><span class="n">rules</span><span class="p">:</span><span class="w"> </span><span class="n">Write</span><span class="w"> </span><span class="n">project</span><span class="o">-</span><span class="n">specific</span><span class="w"> </span><span class="n">Semgrep</span><span class="w"> </span><span class="n">rules</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">5.</span><span class="w"> </span><span class="n">False</span><span class="w"> </span><span class="n">positives</span><span class="p">:</span><span class="w"> </span><span class="n">Manage</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">baselines</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="c1">#nosec     â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">6.</span><span class="w"> </span><span class="n">Dependencies</span><span class="p">:</span><span class="w"> </span><span class="n">Scan</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">regularly</span><span class="w"> </span><span class="p">(</span><span class="n">Dependabot</span><span class="o">/</span><span class="n">SCA</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">7.</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="n">review</span><span class="p">:</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">human</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">tool</span><span class="w"> </span><span class="n">collaboration</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">8.</span><span class="w"> </span><span class="n">Fuzzing</span><span class="p">:</span><span class="w"> </span><span class="n">Finds</span><span class="w"> </span><span class="n">bugs</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">miss</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">9.</span><span class="w"> </span><span class="n">Penetration</span><span class="w"> </span><span class="n">testing</span><span class="p">:</span><span class="w"> </span><span class="n">Validates</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">findings</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="mf">10.</span><span class="w"> </span><span class="n">Continuous</span><span class="p">:</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">testing</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">ongoing</span><span class="p">,</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">one</span><span class="o">-</span><span class="n">time</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<p><strong>Previous</strong>: <a href="./12_Container_Security.md">12. Container and Cloud Security</a> | <strong>Next</strong>: <a href="14_Incident_Response.md">14. Incident Response and Forensics</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/12_Container_Security.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Container and Cloud Security</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Security/14_Incident_Response.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Incident Response and Forensics</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}