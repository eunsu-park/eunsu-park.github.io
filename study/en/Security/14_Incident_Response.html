{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incident Response and Forensics - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">Incident Response and Forensics</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Incident Response and Forensics</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/13_Security_Testing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Security Testing</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Security/15_Project_Secure_API.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Project: Building a Secure REST API</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-incident-response-overview">1. Incident Response Overview</a><ul>
<li><a href="#11-what-is-a-security-incident">1.1 What is a Security Incident?</a></li>
<li><a href="#12-common-incident-types">1.2 Common Incident Types</a></li>
</ul>
</li>
<li><a href="#2-nist-incident-response-lifecycle">2. NIST Incident Response Lifecycle</a><ul>
<li><a href="#21-the-four-phases">2.1 The Four Phases</a></li>
<li><a href="#22-phase-1-preparation">2.2 Phase 1: Preparation</a><ul>
<li><a href="#ir-team-roles">IR Team Roles</a></li>
</ul>
</li>
<li><a href="#23-phase-2-detection-and-analysis">2.3 Phase 2: Detection and Analysis</a><ul>
<li><a href="#detection-sources">Detection Sources</a></li>
<li><a href="#initial-analysis-questions">Initial Analysis Questions</a></li>
</ul>
</li>
<li><a href="#24-phase-3-containment-eradication-and-recovery">2.4 Phase 3: Containment, Eradication, and Recovery</a></li>
<li><a href="#25-phase-4-post-incident-activity-lessons-learned">2.5 Phase 4: Post-Incident Activity (Lessons Learned)</a></li>
</ul>
</li>
<li><a href="#3-log-analysis-and-siem-concepts">3. Log Analysis and SIEM Concepts</a><ul>
<li><a href="#31-logging-architecture">3.1 Logging Architecture</a></li>
<li><a href="#32-critical-log-sources">3.2 Critical Log Sources</a></li>
<li><a href="#33-siem-correlation-rules">3.3 SIEM Correlation Rules</a></li>
</ul>
</li>
<li><a href="#4-python-log-parsing-and-analysis">4. Python: Log Parsing and Analysis</a><ul>
<li><a href="#41-web-server-log-parser">4.1 Web Server Log Parser</a></li>
<li><a href="#42-ioc-detection-script">4.2 IOC Detection Script</a></li>
</ul>
</li>
<li><a href="#5-digital-forensics-basics">5. Digital Forensics Basics</a><ul>
<li><a href="#51-forensic-principles">5.1 Forensic Principles</a></li>
<li><a href="#52-order-of-volatility">5.2 Order of Volatility</a></li>
<li><a href="#53-chain-of-custody">5.3 Chain of Custody</a></li>
<li><a href="#54-forensic-disk-imaging">5.4 Forensic Disk Imaging</a></li>
</ul>
</li>
<li><a href="#6-memory-forensics-concepts">6. Memory Forensics Concepts</a><ul>
<li><a href="#61-why-memory-forensics">6.1 Why Memory Forensics?</a></li>
<li><a href="#62-memory-acquisition">6.2 Memory Acquisition</a></li>
<li><a href="#63-volatility-framework-overview">6.3 Volatility Framework (Overview)</a></li>
</ul>
</li>
<li><a href="#7-network-forensics">7. Network Forensics</a><ul>
<li><a href="#71-packet-capture-analysis">7.1 Packet Capture Analysis</a></li>
<li><a href="#72-useful-command-line-tools">7.2 Useful Command-Line Tools</a></li>
</ul>
</li>
<li><a href="#8-incident-response-playbooks">8. Incident Response Playbooks</a><ul>
<li><a href="#81-playbook-template">8.1 Playbook Template</a></li>
<li><a href="#82-playbook-ransomware-incident">8.2 Playbook: Ransomware Incident</a></li>
<li><a href="#83-playbook-compromised-credentials">8.3 Playbook: Compromised Credentials</a></li>
</ul>
</li>
<li><a href="#9-post-incident-review-template">9. Post-Incident Review Template</a></li>
<li><a href="#10-exercises">10. Exercises</a><ul>
<li><a href="#exercise-1-log-analysis">Exercise 1: Log Analysis</a></li>
<li><a href="#exercise-2-ioc-database">Exercise 2: IOC Database</a></li>
<li><a href="#exercise-3-incident-response-playbook">Exercise 3: Incident Response Playbook</a></li>
<li><a href="#exercise-4-memory-forensics-analysis">Exercise 4: Memory Forensics Analysis</a></li>
<li><a href="#exercise-5-post-incident-report">Exercise 5: Post-Incident Report</a></li>
<li><a href="#exercise-6-pcap-analysis">Exercise 6: PCAP Analysis</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="incident-response-and-forensics">Incident Response and Forensics<a class="header-link" href="#incident-response-and-forensics" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="13_Security_Testing.md">13. Security Testing</a> | <strong>Next</strong>: <a href="15_Project_Secure_API.md">15. Project: Building a Secure REST API</a></p>
<hr />
<p>Security incidents are inevitable. What separates resilient organizations from vulnerable ones is not whether they get breached, but how effectively they respond. This lesson covers the complete incident response lifecycle based on the NIST framework, digital forensics fundamentals, log analysis techniques, and practical Python scripts for detecting indicators of compromise (IOCs). By the end, you will be able to build incident response playbooks and analyze security events systematically.</p>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand the NIST Incident Response lifecycle phases</li>
<li>Build and maintain an incident response plan</li>
<li>Analyze logs for indicators of compromise</li>
<li>Understand digital forensics fundamentals and chain of custody</li>
<li>Write Python scripts for log parsing and IOC detection</li>
<li>Create incident response playbooks for common scenarios</li>
<li>Conduct effective post-incident reviews</li>
</ul>
<hr />
<h2 id="1-incident-response-overview">1. Incident Response Overview<a class="header-link" href="#1-incident-response-overview" title="Permanent link">&para;</a></h2>
<h3 id="11-what-is-a-security-incident">1.1 What is a Security Incident?<a class="header-link" href="#11-what-is-a-security-incident" title="Permanent link">&para;</a></h3>
<p>A security incident is any event that compromises the confidentiality, integrity, or availability of information or systems. Not every security event is an incident -- triage determines severity.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Security Event â†’ Incident Classification            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Security Events (millions/day)                                  â”‚
â”‚  â”œâ”€â”€ Firewall blocks                                            â”‚
â”‚  â”œâ”€â”€ Failed login attempts                                      â”‚
â”‚  â”œâ”€â”€ Port scans                                                  â”‚
â”‚  â”œâ”€â”€ Malware detections (quarantined)                           â”‚
â”‚  â””â”€â”€ IDS/IPS alerts                                             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼  Triage &amp; Correlation                                    â”‚
â”‚                                                                  â”‚
â”‚  Security Incidents (few/month)                                  â”‚
â”‚  â”œâ”€â”€ Successful unauthorized access                             â”‚
â”‚  â”œâ”€â”€ Data breach / exfiltration                                 â”‚
â”‚  â”œâ”€â”€ Malware infection (active)                                 â”‚
â”‚  â”œâ”€â”€ Denial of service attack                                   â”‚
â”‚  â”œâ”€â”€ Insider threat activity                                    â”‚
â”‚  â””â”€â”€ Ransomware deployment                                      â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼  Severity Classification                                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Severity  â”‚ Description                                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Critical  â”‚ Active data breach, ransomware, system-wide  â”‚   â”‚
â”‚  â”‚ (P1)      â”‚ compromise. Immediate response required.     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ High      â”‚ Confirmed intrusion, single system           â”‚   â”‚
â”‚  â”‚ (P2)      â”‚ compromised, active malware. Hours.          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Medium    â”‚ Suspicious activity, policy violation,       â”‚   â”‚
â”‚  â”‚ (P3)      â”‚ vulnerability actively exploited. Days.      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Low       â”‚ Minor policy violation, unsuccessful         â”‚   â”‚
â”‚  â”‚ (P4)      â”‚ attack attempt, informational. Weeks.        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-common-incident-types">1.2 Common Incident Types<a class="header-link" href="#12-common-incident-types" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Incident Type</th>
<th>Examples</th>
<th>Typical Indicators</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Malware</strong></td>
<td>Ransomware, trojan, worm</td>
<td>Unusual processes, file encryption, C2 traffic</td>
</tr>
<tr>
<td><strong>Unauthorized Access</strong></td>
<td>Compromised credentials, brute force</td>
<td>Failed logins, off-hours access, unusual geolocations</td>
</tr>
<tr>
<td><strong>Data Breach</strong></td>
<td>Exfiltration, accidental exposure</td>
<td>Large data transfers, DB dumps, unusual queries</td>
</tr>
<tr>
<td><strong>DoS/DDoS</strong></td>
<td>Volumetric, application-layer</td>
<td>Traffic spikes, service degradation, CPU exhaustion</td>
</tr>
<tr>
<td><strong>Insider Threat</strong></td>
<td>Data theft, sabotage</td>
<td>Excessive access, large downloads, policy violations</td>
</tr>
<tr>
<td><strong>Web Application</strong></td>
<td>SQLi, XSS, RCE</td>
<td>Suspicious request patterns, WAF alerts, error spikes</td>
</tr>
<tr>
<td><strong>Supply Chain</strong></td>
<td>Compromised dependency, update</td>
<td>Unexpected package changes, suspicious build artifacts</td>
</tr>
<tr>
<td><strong>Phishing</strong></td>
<td>Credential harvesting, BEC</td>
<td>Reported emails, unusual login locations, wire transfer requests</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-nist-incident-response-lifecycle">2. NIST Incident Response Lifecycle<a class="header-link" href="#2-nist-incident-response-lifecycle" title="Permanent link">&para;</a></h2>
<h3 id="21-the-four-phases">2.1 The Four Phases<a class="header-link" href="#21-the-four-phases" title="Permanent link">&para;</a></h3>
<p>The NIST Computer Security Incident Handling Guide (SP 800-61) defines four main phases. In practice, these phases overlap and cycle.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NIST Incident Response Lifecycle                     â”‚
â”‚              (SP 800-61 Rev. 2)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚   â”‚  1. Preparation  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚                   â”‚                               â”‚          â”‚
â”‚   â”‚  - IR plan        â”‚                               â”‚          â”‚
â”‚   â”‚  - Team training  â”‚                               â”‚          â”‚
â”‚   â”‚  - Tools ready    â”‚                               â”‚          â”‚
â”‚   â”‚  - Communication  â”‚                               â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚          â”‚
â”‚            â”‚                                          â”‚          â”‚
â”‚            â–¼                                          â”‚          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚          â”‚
â”‚   â”‚  2. Detection &amp;          â”‚                        â”‚          â”‚
â”‚   â”‚     Analysis             â”‚                        â”‚          â”‚
â”‚   â”‚                          â”‚                        â”‚          â”‚
â”‚   â”‚  - Monitor alerts        â”‚                        â”‚          â”‚
â”‚   â”‚  - Triage events         â”‚                        â”‚          â”‚
â”‚   â”‚  - Determine scope       â”‚                        â”‚          â”‚
â”‚   â”‚  - Classify severity     â”‚                        â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚          â”‚
â”‚            â”‚                                          â”‚          â”‚
â”‚            â–¼                                          â”‚          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚          â”‚
â”‚   â”‚  3. Containment,        â”‚    â—„â”€â”€ May cycle       â”‚          â”‚
â”‚   â”‚     Eradication &amp;       â”‚        between these    â”‚          â”‚
â”‚   â”‚     Recovery            â”‚        sub-phases       â”‚          â”‚
â”‚   â”‚                          â”‚                        â”‚          â”‚
â”‚   â”‚  - Isolate affected     â”‚                        â”‚          â”‚
â”‚   â”‚  - Remove threat        â”‚                        â”‚          â”‚
â”‚   â”‚  - Restore systems      â”‚                        â”‚          â”‚
â”‚   â”‚  - Validate recovery    â”‚                        â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚          â”‚
â”‚            â”‚                                          â”‚          â”‚
â”‚            â–¼                                          â”‚          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚          â”‚
â”‚   â”‚  4. Post-Incident       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚   â”‚     Activity            â”‚    Lessons feed back              â”‚
â”‚   â”‚                          â”‚    into Preparation               â”‚
â”‚   â”‚  - Lessons learned      â”‚                                    â”‚
â”‚   â”‚  - Report writing       â”‚                                    â”‚
â”‚   â”‚  - Process improvement  â”‚                                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="22-phase-1-preparation">2.2 Phase 1: Preparation<a class="header-link" href="#22-phase-1-preparation" title="Permanent link">&para;</a></h3>
<p>Preparation is the most critical phase. Without it, everything else is improvisation under pressure.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">Preparation</span><span class="w"> </span><span class="n">Checklist</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">People</span><span class="p">:</span><span class="w">                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">IR</span><span class="w"> </span><span class="n">team</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">clear</span><span class="w"> </span><span class="n">roles</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Contact</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="w"> </span><span class="n">management</span><span class="p">,</span><span class="w"> </span><span class="n">legal</span><span class="p">,</span><span class="w"> </span><span class="n">PR</span><span class="p">,</span><span class="w"> </span><span class="n">vendors</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="k">On</span><span class="o">-</span><span class="k">call</span><span class="w"> </span><span class="n">rotation</span><span class="w"> </span><span class="n">schedule</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Regular</span><span class="w"> </span><span class="n">training</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">tabletop</span><span class="w"> </span><span class="n">exercises</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="k">External</span><span class="w"> </span><span class="n">IR</span><span class="w"> </span><span class="n">retainer</span><span class="w"> </span><span class="p">(</span><span class="n">optional</span><span class="p">)</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Process</span><span class="p">:</span><span class="w">                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Written</span><span class="w"> </span><span class="n">IR</span><span class="w"> </span><span class="k">plan</span><span class="w"> </span><span class="n">approved</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">management</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Playbooks</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">common</span><span class="w"> </span><span class="n">incident</span><span class="w"> </span><span class="n">types</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Escalation</span><span class="w"> </span><span class="n">procedures</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Communication</span><span class="w"> </span><span class="n">templates</span><span class="w"> </span><span class="p">(</span><span class="n">internal</span><span class="p">,</span><span class="w"> </span><span class="k">external</span><span class="p">,</span><span class="w"> </span><span class="n">legal</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Evidence</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">procedures</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Regulatory</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="n">requirements</span><span class="w"> </span><span class="n">documented</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Technology</span><span class="p">:</span><span class="w">                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Logging</span><span class="w"> </span><span class="n">infrastructure</span><span class="w"> </span><span class="p">(</span><span class="n">centralized</span><span class="p">,</span><span class="w"> </span><span class="n">retained</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">SIEM</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nf">log</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="n">tools</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Forensic</span><span class="w"> </span><span class="n">workstation</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">toolkit</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">IDS</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Endpoint</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="p">(</span><span class="n">EDR</span><span class="p">)</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="k">Backup</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">recovery</span><span class="w"> </span><span class="n">systems</span><span class="w"> </span><span class="n">tested</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Clean</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">golden</span><span class="w"> </span><span class="n">images</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="n">Jump</span><span class="w"> </span><span class="nl">bag</span><span class="p">:</span><span class="w"> </span><span class="n">portable</span><span class="w"> </span><span class="n">forensic</span><span class="w"> </span><span class="n">tools</span><span class="p">,</span><span class="w"> </span><span class="n">cables</span><span class="p">,</span><span class="w"> </span><span class="n">storage</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h4 id="ir-team-roles">IR Team Roles<a class="header-link" href="#ir-team-roles" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Incident Response Team Roles                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚   Incident Manager  â”‚  Overall coordination, decisions,       â”‚
â”‚  â”‚   (Team Lead)       â”‚  communication with management          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚            â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚         â”‚              â”‚                  â”‚                    â”‚
â”‚  â–¼         â–¼              â–¼                  â–¼                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚Securityâ”‚ â”‚  Forensic  â”‚ â”‚  System  â”‚ â”‚ Comms /  â”‚            â”‚
â”‚ â”‚Analyst â”‚ â”‚  Analyst   â”‚ â”‚  Admin   â”‚ â”‚  Legal   â”‚            â”‚
â”‚ â”‚        â”‚ â”‚            â”‚ â”‚          â”‚ â”‚          â”‚            â”‚
â”‚ â”‚Monitor â”‚ â”‚Evidence    â”‚ â”‚Contain &amp; â”‚ â”‚Notify &amp;  â”‚            â”‚
â”‚ â”‚Triage  â”‚ â”‚Collection  â”‚ â”‚Recover   â”‚ â”‚Document  â”‚            â”‚
â”‚ â”‚Analyze â”‚ â”‚Analysis    â”‚ â”‚Patch     â”‚ â”‚Regulate  â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="23-phase-2-detection-and-analysis">2.3 Phase 2: Detection and Analysis<a class="header-link" href="#23-phase-2-detection-and-analysis" title="Permanent link">&para;</a></h3>
<h4 id="detection-sources">Detection Sources<a class="header-link" href="#detection-sources" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">Detection</span><span class="w"> </span><span class="n">Sources</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Automated:</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">SIEM</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="p">(</span><span class="n">correlated</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">events</span><span class="p">)</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">IDS</span><span class="o">/</span><span class="n">IPS</span><span class="w"> </span><span class="p">(</span><span class="n">Snort</span><span class="p">,</span><span class="w"> </span><span class="n">Suricata</span><span class="p">)</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">EDR</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="p">(</span><span class="n">CrowdStrike</span><span class="p">,</span><span class="w"> </span><span class="n">Carbon</span><span class="w"> </span><span class="n">Black</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">.)</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">WAF</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="p">(</span><span class="n">ModSecurity</span><span class="p">,</span><span class="w"> </span><span class="n">AWS</span><span class="w"> </span><span class="n">WAF</span><span class="p">)</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Antivirus</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Anti</span><span class="o">-</span><span class="n">malware</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">integrity</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="p">(</span><span class="n">OSSEC</span><span class="p">,</span><span class="w"> </span><span class="n">Tripwire</span><span class="p">)</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">anomalies</span><span class="w"> </span><span class="p">(</span><span class="n">NetFlow</span><span class="p">,</span><span class="w"> </span><span class="n">Zeek</span><span class="p">)</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Cloud</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="p">(</span><span class="n">GuardDuty</span><span class="p">,</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">Center</span><span class="p">)</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Human:</span><span class="w">                                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">reports</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;something looks wrong&quot;</span><span class="p">)</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Help</span><span class="w"> </span><span class="n">desk</span><span class="w"> </span><span class="n">tickets</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">External</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="p">(</span><span class="n">partner</span><span class="p">,</span><span class="w"> </span><span class="n">vendor</span><span class="p">,</span><span class="w"> </span><span class="n">researcher</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Law</span><span class="w"> </span><span class="n">enforcement</span><span class="w"> </span><span class="n">notification</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Media</span><span class="w"> </span><span class="n">reports</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Threat</span><span class="w"> </span><span class="n">intelligence</span><span class="w"> </span><span class="n">feeds</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Proactive:</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Threat</span><span class="w"> </span><span class="n">hunting</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Penetration</span><span class="w"> </span><span class="n">testing</span><span class="w"> </span><span class="n">results</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Vulnerability</span><span class="w"> </span><span class="n">scanning</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">review</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">audit</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h4 id="initial-analysis-questions">Initial Analysis Questions<a class="header-link" href="#initial-analysis-questions" title="Permanent link">&para;</a></h4>
<p>When an alert fires, systematically answer these questions:</p>
<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">WHAT</span><span class="w"> </span><span class="n">happened</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="kr">sys</span><span class="n">tems</span><span class="o">/</span><span class="kd">data</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">affected</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">incident</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">this</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">evidence</span><span class="err">?</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">WHEN</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">happen</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">indicator</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">detected</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Is</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="kr">ongo</span><span class="n">ing</span><span class="err">?</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">impact</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Which</span><span class="w"> </span><span class="n">hosts</span><span class="o">/</span><span class="n">networks</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Which</span><span class="w"> </span><span class="n">applications</span><span class="o">/</span><span class="n">services</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Which</span><span class="w"> </span><span class="kd">data</span><span class="o">/</span><span class="n">users</span><span class="err">?</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">WHO</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">involved</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Source</span><span class="w"> </span><span class="n">IPs</span><span class="o">/</span><span class="n">accounts</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Targeted</span><span class="w"> </span><span class="n">users</span><span class="o">/</span><span class="kr">sys</span><span class="n">tems</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nb">Int</span><span class="n">ernal</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">actor</span><span class="err">?</span>

<span class="mf">5.</span><span class="w"> </span><span class="n">HOW</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">happen</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Attack</span><span class="w"> </span><span class="n">vector</span><span class="w"> </span><span class="p">(</span><span class="n">phishing</span><span class="p">,</span><span class="w"> </span><span class="nb">exp</span><span class="n">loit</span><span class="p">,</span><span class="w"> </span><span class="n">insider</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="mf">.</span><span class="p">)</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Vulnerability</span><span class="w"> </span><span class="nb">exp</span><span class="n">loited</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="kr">To</span><span class="n">ols</span><span class="o">/</span><span class="n">techniques</span><span class="w"> </span><span class="n">used</span><span class="err">?</span>

<span class="mf">6.</span><span class="w"> </span><span class="n">HOW</span><span class="w"> </span><span class="n">BAD</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">it</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Scope</span><span class="p">:</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="kr">sys</span><span class="n">tems</span><span class="w"> </span><span class="n">affected</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Impact</span><span class="p">:</span><span class="w"> </span><span class="kd">data</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="n">disruption</span><span class="err">?</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Severity</span><span class="w"> </span><span class="n">classification</span><span class="w"> </span><span class="p">(</span><span class="n">P1</span><span class="o">-</span><span class="n">P4</span><span class="p">)</span><span class="err">?</span>
</code></pre></div>

<h3 id="24-phase-3-containment-eradication-and-recovery">2.4 Phase 3: Containment, Eradication, and Recovery<a class="header-link" href="#24-phase-3-containment-eradication-and-recovery" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">          </span><span class="nv">Containment</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Eradication</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Recovery</span><span class="w">                     </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">CONTAINMENT</span><span class="w"> </span><span class="ss">(</span><span class="nv">Stop</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">Bleeding</span><span class="ss">)</span><span class="w">             </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                              </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Short</span><span class="o">-</span><span class="nv">term</span>:<span class="w">                                 </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Isolate</span><span class="w"> </span><span class="nv">affected</span><span class="w"> </span><span class="nv">systems</span><span class="w"> </span><span class="ss">(</span><span class="nv">network</span><span class="ss">)</span><span class="w">     </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Block</span><span class="w"> </span><span class="nv">malicious</span><span class="w"> </span><span class="nv">IPs</span><span class="o">/</span><span class="nv">domains</span><span class="w">            </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Disable</span><span class="w"> </span><span class="nv">compromised</span><span class="w"> </span><span class="nv">accounts</span><span class="w">           </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Redirect</span><span class="w"> </span><span class="nv">DNS</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">needed</span><span class="w">                 </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Preserve</span><span class="w"> </span><span class="nv">evidence</span><span class="w"> </span><span class="nv">before</span><span class="w"> </span><span class="nv">changes</span><span class="w">       </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                              </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Long</span><span class="o">-</span><span class="nv">term</span>:<span class="w">                                  </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Apply</span><span class="w"> </span><span class="nv">temporary</span><span class="w"> </span><span class="nv">patches</span><span class="o">/</span><span class="nv">workarounds</span><span class="w">    </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Increase</span><span class="w"> </span><span class="nv">monitoring</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">affected</span><span class="w"> </span><span class="nv">area</span><span class="w">   </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Implement</span><span class="w"> </span><span class="nv">additional</span><span class="w"> </span><span class="nv">access</span><span class="w"> </span><span class="nv">controls</span><span class="w">   </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Set</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">honeypot</span><span class="o">/</span><span class="nv">canary</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">appropriate</span><span class="w">  </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                 </span>â”‚
â”‚<span class="w">            </span>â”‚<span class="w">                                                      </span>â”‚
â”‚<span class="w">            </span>â–¼<span class="w">                                                      </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">ERADICATION</span><span class="w"> </span><span class="ss">(</span><span class="nv">Remove</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">Threat</span><span class="ss">)</span><span class="w">             </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                              </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Remove</span><span class="w"> </span><span class="nv">malware</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">backdoors</span><span class="w">             </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Close</span><span class="w"> </span><span class="nv">vulnerability</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">was</span><span class="w"> </span><span class="nv">exploited</span><span class="w"> </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Reset</span><span class="w"> </span><span class="nv">compromised</span><span class="w"> </span><span class="nv">credentials</span><span class="w">          </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Rebuild</span><span class="w"> </span><span class="nv">affected</span><span class="w"> </span><span class="nv">systems</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">needed</span><span class="w">     </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Update</span><span class="w"> </span><span class="nv">firewall</span><span class="o">/</span><span class="nv">IDS</span><span class="w"> </span><span class="nv">rules</span><span class="w">              </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Scan</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">persistence</span><span class="w"> </span><span class="nv">mechanisms</span><span class="w">        </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                 </span>â”‚
â”‚<span class="w">            </span>â”‚<span class="w">                                                      </span>â”‚
â”‚<span class="w">            </span>â–¼<span class="w">                                                      </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">RECOVERY</span><span class="w"> </span><span class="ss">(</span><span class="k">Return</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">Normal</span><span class="ss">)</span><span class="w">                 </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                              </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Restore</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">clean</span><span class="w"> </span><span class="nv">backups</span><span class="w">             </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Rebuild</span><span class="w"> </span><span class="nv">systems</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">golden</span><span class="w"> </span><span class="nv">images</span><span class="w">     </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Gradually</span><span class="w"> </span><span class="nv">restore</span><span class="w"> </span><span class="nv">services</span><span class="w">             </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Verify</span><span class="w"> </span><span class="nv">system</span><span class="w"> </span><span class="nv">integrity</span><span class="w">                </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Monitor</span><span class="w"> </span><span class="nv">closely</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">re</span><span class="o">-</span><span class="nv">compromise</span><span class="w">      </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Declare</span><span class="w"> </span><span class="nv">incident</span><span class="w"> </span><span class="nv">resolved</span><span class="w">              </span>â”‚<span class="w">                 </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                 </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">IMPORTANT</span>:<span class="w"> </span><span class="nv">Document</span><span class="w"> </span><span class="nv">every</span><span class="w"> </span><span class="nv">action</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">timestamps</span><span class="o">!</span><span class="w">               </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="25-phase-4-post-incident-activity-lessons-learned">2.5 Phase 4: Post-Incident Activity (Lessons Learned)<a class="header-link" href="#25-phase-4-post-incident-activity-lessons-learned" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Post-Incident Review Meeting Agenda                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Schedule: Within 1-2 weeks of incident closure                  â”‚
â”‚  Attendees: All involved parties (blameless environment)         â”‚
â”‚                                                                   â”‚
â”‚  1. Timeline Review (30 min)                                     â”‚
â”‚     - Walk through the complete timeline                         â”‚
â”‚     - When was first indicator? When detected? When resolved?   â”‚
â”‚                                                                   â”‚
â”‚  2. What Went Well (15 min)                                      â”‚
â”‚     - Effective detection mechanisms                              â”‚
â”‚     - Quick containment actions                                   â”‚
â”‚     - Good communication                                         â”‚
â”‚                                                                   â”‚
â”‚  3. What Could Be Improved (30 min)                              â”‚
â”‚     - Detection gaps                                              â”‚
â”‚     - Response delays                                             â”‚
â”‚     - Communication breakdowns                                    â”‚
â”‚     - Tool/process gaps                                           â”‚
â”‚                                                                   â”‚
â”‚  4. Root Cause Analysis (30 min)                                 â”‚
â”‚     - What was the root cause?                                   â”‚
â”‚     - Why did existing controls fail?                            â”‚
â”‚     - Use &quot;5 Whys&quot; technique                                     â”‚
â”‚                                                                   â”‚
â”‚  5. Action Items (15 min)                                        â”‚
â”‚     - Specific improvements with owners and deadlines            â”‚
â”‚     - Process changes                                             â”‚
â”‚     - Technology changes                                          â”‚
â”‚     - Training needs                                              â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="3-log-analysis-and-siem-concepts">3. Log Analysis and SIEM Concepts<a class="header-link" href="#3-log-analysis-and-siem-concepts" title="Permanent link">&para;</a></h2>
<h3 id="31-logging-architecture">3.1 Logging Architecture<a class="header-link" href="#31-logging-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Centralized Logging Architecture                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Log Sources                    Collection        Storage/Analysisâ”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚ Web      â”‚â”€â”€â”                                                  â”‚
â”‚  â”‚ Servers  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”œâ”€â”€â–º â”‚  Log Shipper  â”‚â”€â”€â–º â”‚                   â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  (Filebeat,   â”‚    â”‚  SIEM / Log       â”‚   â”‚
â”‚  â”‚ App      â”‚â”€â”€â”¤    â”‚   Fluentd,    â”‚    â”‚  Management       â”‚   â”‚
â”‚  â”‚ Servers  â”‚  â”‚    â”‚   rsyslog)    â”‚    â”‚                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  - Elasticsearch  â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚  - Splunk         â”‚   â”‚
â”‚  â”‚ Database â”‚â”€â”€â”¤    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  - Graylog        â”‚   â”‚
â”‚  â”‚ Servers  â”‚  â”œâ”€â”€â–º â”‚  Message      â”‚â”€â”€â–º â”‚  - Wazuh          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  Queue        â”‚    â”‚  - QRadar         â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  (Kafka,      â”‚    â”‚                   â”‚   â”‚
â”‚  â”‚ Firewall â”‚â”€â”€â”¤    â”‚   Redis)      â”‚    â”‚  Features:        â”‚   â”‚
â”‚  â”‚ / IDS    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  - Search         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚  - Correlation    â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚  - Alerting       â”‚   â”‚
â”‚  â”‚ Endpoint â”‚â”€â”€â”˜                         â”‚  - Dashboards     â”‚   â”‚
â”‚  â”‚ Agents   â”‚                            â”‚  - Retention      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="32-critical-log-sources">3.2 Critical Log Sources<a class="header-link" href="#32-critical-log-sources" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Log Source</th>
<th>What to Capture</th>
<th>Security Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Web server</strong> (nginx, Apache)</td>
<td>Access logs, error logs</td>
<td>Attack detection, anomaly detection</td>
</tr>
<tr>
<td><strong>Application</strong></td>
<td>Auth events, errors, API calls</td>
<td>Business logic attacks, abuse</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>Queries, connections, errors</td>
<td>SQL injection, data exfiltration</td>
</tr>
<tr>
<td><strong>OS / System</strong></td>
<td>Auth logs, process exec, file changes</td>
<td>Privilege escalation, persistence</td>
</tr>
<tr>
<td><strong>Firewall</strong></td>
<td>Allow/deny, connections</td>
<td>Network attacks, lateral movement</td>
</tr>
<tr>
<td><strong>DNS</strong></td>
<td>Queries, responses</td>
<td>C2 communication, data exfiltration</td>
</tr>
<tr>
<td><strong>Email</strong></td>
<td>Send/receive, attachments</td>
<td>Phishing, data exfiltration</td>
</tr>
<tr>
<td><strong>Cloud</strong></td>
<td>API calls, config changes</td>
<td>Misconfiguration, unauthorized access</td>
</tr>
</tbody>
</table>
<h3 id="33-siem-correlation-rules">3.3 SIEM Correlation Rules<a class="header-link" href="#33-siem-correlation-rules" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                   </span><span class="nv">Common</span><span class="w"> </span><span class="nv">SIEM</span><span class="w"> </span><span class="nv">Correlation</span><span class="w"> </span><span class="nv">Rules</span><span class="w">                   </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Rule</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">Brute</span><span class="w"> </span><span class="nv">Force</span><span class="w"> </span><span class="nv">Detection</span><span class="w">                                   </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span><span class="o">&gt;</span><span class="mi">10</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="nv">logins</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">IP</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="nv">minutes</span><span class="w">    </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="nv">Alert</span><span class="w"> </span><span class="s2">&quot;Possible brute force attack&quot;</span><span class="w">          </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">SEVERITY</span>:<span class="w"> </span><span class="nv">Medium</span><span class="w">                                    </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">ACTION</span>:<span class="w"> </span><span class="nv">Block</span><span class="w"> </span><span class="nv">IP</span><span class="w"> </span><span class="nv">temporarily</span>,<span class="w"> </span><span class="nv">notify</span><span class="w"> </span><span class="nv">SOC</span><span class="w">            </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">          </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Rule</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">Impossible</span><span class="w"> </span><span class="nv">Travel</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span><span class="nv">Same</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="nv">logs</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">geolocations</span><span class="w">          </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">     </span><span class="nv">that</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">500</span><span class="w"> </span><span class="nv">miles</span><span class="w"> </span><span class="nv">apart</span><span class="w"> </span><span class="nv">within</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="nv">minutes</span><span class="w">    </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="nv">Alert</span><span class="w"> </span><span class="s2">&quot;Impossible travel detected&quot;</span><span class="w">           </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">SEVERITY</span>:<span class="w"> </span><span class="nv">High</span><span class="w">                                      </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">ACTION</span>:<span class="w"> </span><span class="nv">Force</span><span class="w"> </span><span class="nv">re</span><span class="o">-</span><span class="nv">authentication</span>,<span class="w"> </span><span class="nv">notify</span><span class="w"> </span><span class="nv">user</span><span class="w">        </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">          </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Rule</span><span class="w"> </span><span class="mi">3</span>:<span class="w"> </span><span class="nv">Data</span><span class="w"> </span><span class="nv">Exfiltration</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span><span class="o">&gt;</span><span class="mi">100</span><span class="nv">MB</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">transfer</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">external</span><span class="w"> </span><span class="nv">IP</span><span class="w">             </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">     </span><span class="nv">from</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">server</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">normally</span><span class="w"> </span><span class="nv">sends</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1</span><span class="nv">MB</span><span class="o">/</span><span class="nv">hour</span><span class="w">    </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="nv">Alert</span><span class="w"> </span><span class="s2">&quot;Possible data exfiltration&quot;</span><span class="w">           </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">SEVERITY</span>:<span class="w"> </span><span class="nv">Critical</span><span class="w">                                  </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">ACTION</span>:<span class="w"> </span><span class="nv">Block</span><span class="w"> </span><span class="nv">transfer</span>,<span class="w"> </span><span class="nv">isolate</span><span class="w"> </span><span class="nv">host</span>,<span class="w"> </span><span class="nv">alert</span><span class="w"> </span><span class="nv">IR</span><span class="w">      </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">          </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Rule</span><span class="w"> </span><span class="mi">4</span>:<span class="w"> </span><span class="nv">Privilege</span><span class="w"> </span><span class="nv">Escalation</span><span class="w">                                    </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span><span class="nv">User</span><span class="w"> </span><span class="nv">added</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">admin</span><span class="o">/</span><span class="nv">root</span><span class="w"> </span><span class="nv">group</span><span class="w">                  </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">     </span><span class="nv">AND</span><span class="w"> </span><span class="nv">change</span><span class="w"> </span><span class="nv">was</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">approved</span><span class="w"> </span><span class="nv">change</span><span class="w"> </span><span class="nv">system</span><span class="w"> </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="nv">Alert</span><span class="w"> </span><span class="s2">&quot;Unauthorized privilege escalation&quot;</span><span class="w">    </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">SEVERITY</span>:<span class="w"> </span><span class="nv">Critical</span><span class="w">                                  </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">ACTION</span>:<span class="w"> </span><span class="nv">Revert</span><span class="w"> </span><span class="nv">change</span>,<span class="w"> </span><span class="nv">disable</span><span class="w"> </span><span class="nv">account</span>,<span class="w"> </span><span class="nv">alert</span><span class="w"> </span><span class="nv">IR</span><span class="w">    </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">          </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Rule</span><span class="w"> </span><span class="mi">5</span>:<span class="w"> </span><span class="nv">Web</span><span class="w"> </span><span class="nv">Application</span><span class="w"> </span><span class="nv">Attack</span><span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">IF</span>:<span class="w"> </span><span class="o">&gt;</span><span class="mi">5</span><span class="w"> </span><span class="nv">WAF</span><span class="w"> </span><span class="nv">blocks</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">IP</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">minute</span><span class="w">         </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">     </span><span class="nv">AND</span><span class="w"> </span><span class="nv">HTTP</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="nv">errors</span><span class="w"> </span><span class="nv">increase</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">app</span><span class="w">     </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">THEN</span>:<span class="w"> </span><span class="nv">Alert</span><span class="w"> </span><span class="s2">&quot;Active web application attack&quot;</span><span class="w">        </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">SEVERITY</span>:<span class="w"> </span><span class="nv">High</span><span class="w">                                      </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">ACTION</span>:<span class="w"> </span><span class="nv">Block</span><span class="w"> </span><span class="nv">IP</span>,<span class="w"> </span><span class="nv">increase</span><span class="w"> </span><span class="nv">logging</span>,<span class="w"> </span><span class="nv">alert</span><span class="w"> </span><span class="nv">IR</span><span class="w">        </span>â”‚<span class="w">          </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">          </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="4-python-log-parsing-and-analysis">4. Python: Log Parsing and Analysis<a class="header-link" href="#4-python-log-parsing-and-analysis" title="Permanent link">&para;</a></h2>
<h3 id="41-web-server-log-parser">4.1 Web Server Log Parser<a class="header-link" href="#41-web-server-log-parser" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">log_parser.py - Parse and analyze web server access logs.</span>
<span class="sd">Supports Apache/Nginx combined log format.</span>

<span class="sd">Example log line:</span>
<span class="sd">192.168.1.100 - admin [15/Jan/2025:10:30:45 +0000] &quot;GET /admin HTTP/1.1&quot; 200 1234 &quot;http://example.com&quot; &quot;Mozilla/5.0&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Iterator</span>


<span class="c1"># Combined log format regex</span>
<span class="n">LOG_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;ip&gt;\S+)\s+&#39;</span>              <span class="c1"># IP address</span>
    <span class="sa">r</span><span class="s1">&#39;\S+\s+&#39;</span>                       <span class="c1"># ident (usually -)</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;user&gt;\S+)\s+&#39;</span>            <span class="c1"># authenticated user</span>
    <span class="sa">r</span><span class="s1">&#39;\[(?P&lt;time&gt;[^\]]+)\]\s+&#39;</span>     <span class="c1"># timestamp</span>
    <span class="sa">r</span><span class="s1">&#39;&quot;(?P&lt;method&gt;\S+)\s+&#39;</span>         <span class="c1"># HTTP method</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;path&gt;\S+)\s+&#39;</span>            <span class="c1"># request path</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;protocol&gt;\S+)&quot;\s+&#39;</span>       <span class="c1"># HTTP version</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;status&gt;\d+)\s+&#39;</span>          <span class="c1"># status code</span>
    <span class="sa">r</span><span class="s1">&#39;(?P&lt;size&gt;\S+)\s+&#39;</span>            <span class="c1"># response size</span>
    <span class="sa">r</span><span class="s1">&#39;&quot;(?P&lt;referer&gt;[^&quot;]*)&quot;\s+&#39;</span>     <span class="c1"># referer</span>
    <span class="sa">r</span><span class="s1">&#39;&quot;(?P&lt;agent&gt;[^&quot;]*)&quot;&#39;</span>          <span class="c1"># user agent</span>
<span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LogEntry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parsed log entry.&quot;&quot;&quot;</span>
    <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">protocol</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">referer</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">raw</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SecurityAlert</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A security alert generated from log analysis.&quot;&quot;&quot;</span>
    <span class="n">alert_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># CRITICAL, HIGH, MEDIUM, LOW</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_ip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sample_entries</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">severity</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alert_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(IP: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_ip</span><span class="si">}</span><span class="s2">, count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_log_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single log line into a LogEntry.&quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">LOG_PATTERN</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>

    <span class="c1"># Parse timestamp</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%b/%Y:%H:%M:%S %z&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># Parse size (may be &#39;-&#39;)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">LogEntry</span><span class="p">(</span>
        <span class="n">ip</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">],</span>
        <span class="n">user</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">],</span>
        <span class="n">timestamp</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">],</span>
        <span class="n">path</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span>
        <span class="n">protocol</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">],</span>
        <span class="n">status</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]),</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">referer</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;referer&#39;</span><span class="p">],</span>
        <span class="n">user_agent</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;agent&#39;</span><span class="p">],</span>
        <span class="n">raw</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_log_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse all entries from a log file.&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log file not found: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">parse_log_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">entry</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LogAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze parsed log entries for security indicators.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">LogEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SecurityAlert</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load and parse a log file. Returns entry count.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_log_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SecurityAlert</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all analysis rules.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_brute_force</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_directory_traversal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_sql_injection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_scanner_activity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_error_spikes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_suspicious_user_agents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_admin_access</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_brute_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                            <span class="n">window_minutes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect brute force login attempts.&quot;&quot;&quot;</span>
        <span class="c1"># Group 401/403 responses by IP</span>
        <span class="n">failed_logins</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="mi">403</span><span class="p">):</span>
                <span class="n">failed_logins</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">failed_logins</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="c1"># Check if they occur within the time window</span>
                <span class="n">entries</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">-</span> <span class="n">threshold</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">window</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">threshold</span><span class="p">]</span>
                    <span class="n">time_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">-</span>
                                 <span class="n">window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">time_diff</span> <span class="o">&lt;=</span> <span class="n">window_minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                            <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;BRUTE_FORCE&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span><span class="si">}</span><span class="s2"> failed auth attempts from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">+ within </span><span class="si">{</span><span class="n">window_minutes</span><span class="si">}</span><span class="s2"> min)&quot;</span>
                            <span class="p">),</span>
                            <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                            <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
                            <span class="n">sample_entries</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">raw</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[:</span><span class="mi">3</span><span class="p">]],</span>
                        <span class="p">))</span>
                        <span class="k">break</span>  <span class="c1"># One alert per IP</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_directory_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect path traversal attempts.&quot;&quot;&quot;</span>
        <span class="n">traversal_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;../&#39;</span><span class="p">,</span> <span class="s1">&#39;..</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%2e%2e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%252e%252e</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/etc/passwd&#39;</span><span class="p">,</span> <span class="s1">&#39;/etc/shadow&#39;</span><span class="p">,</span> <span class="s1">&#39;/windows/system32&#39;</span><span class="p">,</span>
            <span class="s1">&#39;boot.ini&#39;</span><span class="p">,</span> <span class="s1">&#39;web.config&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">traversal_attempts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="n">path_lower</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">traversal_patterns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">path_lower</span><span class="p">:</span>
                    <span class="n">traversal_attempts</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">traversal_attempts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;DIRECTORY_TRAVERSAL&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Path traversal attempt from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
                <span class="n">sample_entries</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">raw</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[:</span><span class="mi">3</span><span class="p">]],</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_sql_injection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect SQL injection attempts in request paths.&quot;&quot;&quot;</span>
        <span class="n">sqli_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;&#39; or &quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; and &quot;</span><span class="p">,</span> <span class="s2">&quot;union select&quot;</span><span class="p">,</span> <span class="s2">&quot;order by&quot;</span><span class="p">,</span>
            <span class="s2">&quot;1=1&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39; --&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;; drop&quot;</span><span class="p">,</span> <span class="s2">&quot;sleep(&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchmark(&quot;</span><span class="p">,</span> <span class="s2">&quot;waitfor delay&quot;</span><span class="p">,</span> <span class="s2">&quot;pg_sleep&quot;</span><span class="p">,</span>
            <span class="s2">&quot;%27&quot;</span><span class="p">,</span> <span class="s2">&quot;char(&quot;</span><span class="p">,</span> <span class="s2">&quot;concat(&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">sqli_attempts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="n">path_lower</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">sqli_patterns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">path_lower</span><span class="p">:</span>
                    <span class="n">sqli_attempts</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">sqli_attempts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;SQL_INJECTION&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SQL injection attempt from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
                <span class="n">sample_entries</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">raw</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[:</span><span class="mi">3</span><span class="p">]],</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_scanner_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect automated vulnerability scanner activity.&quot;&quot;&quot;</span>
        <span class="n">scanner_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;/.env&#39;</span><span class="p">,</span> <span class="s1">&#39;/wp-admin&#39;</span><span class="p">,</span> <span class="s1">&#39;/wp-login.php&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/phpmyadmin&#39;</span><span class="p">,</span> <span class="s1">&#39;/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;/administrator&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/.git/config&#39;</span><span class="p">,</span> <span class="s1">&#39;/.svn/entries&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/robots.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;/sitemap.xml&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/backup&#39;</span><span class="p">,</span> <span class="s1">&#39;/database&#39;</span><span class="p">,</span> <span class="s1">&#39;/db&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/server-status&#39;</span><span class="p">,</span> <span class="s1">&#39;/server-info&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/.htaccess&#39;</span><span class="p">,</span> <span class="s1">&#39;/web.config&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/xmlrpc.php&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/v1&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">ip_scanner_hits</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">scanner_path</span> <span class="ow">in</span> <span class="n">scanner_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">scanner_path</span><span class="p">):</span>
                    <span class="n">ip_scanner_hits</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">paths</span> <span class="ow">in</span> <span class="n">ip_scanner_hits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># Hit 5+ scanner paths</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                    <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;VULNERABILITY_SCANNER&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Scanner activity from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;probed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> common paths&quot;</span>
                    <span class="p">),</span>
                    <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                    <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">),</span>
                    <span class="n">sample_entries</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">paths</span><span class="p">)[:</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_error_spikes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect unusual spikes in error responses.&quot;&quot;&quot;</span>
        <span class="c1"># Count 5xx errors per IP</span>
        <span class="n">error_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">500</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="o">.</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">:</span>
                <span class="n">error_counts</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">error_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                    <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;ERROR_SPIKE&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;High error rate from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> server errors (5xx)&quot;</span>
                    <span class="p">),</span>
                    <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                    <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
                <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_suspicious_user_agents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect requests with suspicious user agents.&quot;&quot;&quot;</span>
        <span class="n">suspicious_agents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;sqlmap&#39;</span><span class="p">,</span> <span class="s1">&#39;nikto&#39;</span><span class="p">,</span> <span class="s1">&#39;nmap&#39;</span><span class="p">,</span> <span class="s1">&#39;masscan&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dirbuster&#39;</span><span class="p">,</span> <span class="s1">&#39;gobuster&#39;</span><span class="p">,</span> <span class="s1">&#39;wfuzz&#39;</span><span class="p">,</span>
            <span class="s1">&#39;burpsuite&#39;</span><span class="p">,</span> <span class="s1">&#39;acunetix&#39;</span><span class="p">,</span> <span class="s1">&#39;nessus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;python-requests&#39;</span><span class="p">,</span>  <span class="c1"># May be legitimate, but flag</span>
            <span class="s1">&#39;curl/&#39;</span><span class="p">,</span>            <span class="c1"># May be legitimate, but flag</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="n">agent_lower</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">user_agent</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">sus_agent</span> <span class="ow">in</span> <span class="n">suspicious_agents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sus_agent</span> <span class="ow">in</span> <span class="n">agent_lower</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                        <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;SUSPICIOUS_USER_AGENT&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Suspicious user agent from </span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">user_agent</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">),</span>
                        <span class="n">source_ip</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span>
                        <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">))</span>
                    <span class="k">break</span>  <span class="c1"># One alert per entry</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_admin_access</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect access to administrative endpoints.&quot;&quot;&quot;</span>
        <span class="n">admin_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;/dashboard&#39;</span><span class="p">,</span> <span class="s1">&#39;/manage&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/admin&#39;</span><span class="p">]</span>
        <span class="n">admin_access</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">admin_path</span> <span class="ow">in</span> <span class="n">admin_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">admin_path</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="n">admin_access</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">admin_access</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SecurityAlert</span><span class="p">(</span>
                <span class="n">alert_type</span><span class="o">=</span><span class="s2">&quot;ADMIN_ACCESS&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;LOW&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Successful admin access from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="n">source_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a formatted analysis report.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  LOG ANALYSIS SECURITY REPORT&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total entries analyzed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total alerts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">severity_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span> <span class="s1">&#39;LOW&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="n">severity_order</span><span class="p">:</span>
            <span class="n">alerts</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="n">severity</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">alerts</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">severity</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">alerts</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">alerts</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [</span><span class="si">{</span><span class="n">alert</span><span class="o">.</span><span class="n">alert_type</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">alert</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">alert</span><span class="o">.</span><span class="n">sample_entries</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Samples:&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">alert</span><span class="o">.</span><span class="n">sample_entries</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">)[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Summary statistics</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  TOP SOURCE IPs&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ip_alert_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alert</span><span class="o">.</span><span class="n">source_ip</span><span class="p">:</span>
                <span class="n">ip_alert_count</span><span class="p">[</span><span class="n">alert</span><span class="o">.</span><span class="n">source_ip</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ip_alert_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">ip</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> alerts&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: python log_parser.py &lt;access.log&gt;&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">LogAnalyzer</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Loaded </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> log entries&quot;</span><span class="p">)</span>

    <span class="n">alerts</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze_all</span><span class="p">()</span>
    <span class="n">analyzer</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</code></pre></div>

<h3 id="42-ioc-detection-script">4.2 IOC Detection Script<a class="header-link" href="#42-ioc-detection-script" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ioc_detector.py - Indicator of Compromise (IOC) detection.</span>
<span class="sd">Checks files, network connections, and system state for known IOCs.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IOC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Indicator of Compromise.&quot;&quot;&quot;</span>
    <span class="n">ioc_type</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># IP, DOMAIN, HASH_MD5, HASH_SHA256, FILENAME, REGEX</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>    <span class="c1"># Where this IOC came from</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;MEDIUM&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IOCMatch</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A match found during scanning.&quot;&quot;&quot;</span>
    <span class="n">ioc</span><span class="p">:</span> <span class="n">IOC</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># Where the match was found</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>   <span class="c1"># Additional context</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">IOCDatabase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple IOC database.</span>
<span class="sd">    In production, use STIX/TAXII or a proper threat intelligence platform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iocs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IOC</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load IOCs from a JSON file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iocs&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iocs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOC</span><span class="p">(</span>
                <span class="n">ioc_type</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                <span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                <span class="n">description</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="n">source</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;severity&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">),</span>
            <span class="p">))</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iocs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_sample_iocs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load sample IOCs for demonstration.&quot;&quot;&quot;</span>
        <span class="c1"># These are FAKE IOCs for educational purposes</span>
        <span class="n">sample_iocs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;IP&quot;</span><span class="p">,</span> <span class="s2">&quot;198.51.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;Known C2 server&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;IP&quot;</span><span class="p">,</span> <span class="s2">&quot;203.0.113.50&quot;</span><span class="p">,</span> <span class="s2">&quot;Phishing infrastructure&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;DOMAIN&quot;</span><span class="p">,</span> <span class="s2">&quot;evil-malware.example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;Malware C2&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;DOMAIN&quot;</span><span class="p">,</span> <span class="s2">&quot;phish.example.net&quot;</span><span class="p">,</span> <span class="s2">&quot;Phishing domain&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;HASH_SHA256&quot;</span><span class="p">,</span>
                <span class="s2">&quot;e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Known malware hash (empty file SHA256)&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">,</span> <span class="s2">&quot;mimikatz.exe&quot;</span><span class="p">,</span> <span class="s2">&quot;Credential dumping tool&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">,</span> <span class="s2">&quot;nc.exe&quot;</span><span class="p">,</span> <span class="s2">&quot;Netcat - possible backdoor&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
            <span class="n">IOC</span><span class="p">(</span><span class="s2">&quot;REGEX&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;(?:eval|exec)\s*\(\s*base64&quot;</span><span class="p">,</span> <span class="s2">&quot;Obfuscated code execution&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iocs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sample_iocs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioc_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">IOC</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all IOCs of a specific type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ioc</span> <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iocs</span> <span class="k">if</span> <span class="n">ioc</span><span class="o">.</span><span class="n">ioc_type</span> <span class="o">==</span> <span class="n">ioc_type</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">IOCScanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan system for Indicators of Compromise.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioc_db</span><span class="p">:</span> <span class="n">IOCDatabase</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span> <span class="o">=</span> <span class="n">ioc_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IOCMatch</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">IOCMatch</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all IOC scans.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Starting IOC scan...&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scan_file_hashes</span><span class="p">(</span><span class="n">scan_dir</span> <span class="ow">or</span> <span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_file_names</span><span class="p">(</span><span class="n">scan_dir</span> <span class="ow">or</span> <span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_network_connections</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_dns_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_file_contents</span><span class="p">(</span><span class="n">scan_dir</span> <span class="ow">or</span> <span class="s2">&quot;/tmp&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_file_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check file hashes against known malware hashes.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning file hashes in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">hash_iocs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">ioc</span>
            <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;HASH_SHA256&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">md5_iocs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">ioc</span>
            <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;HASH_MD5&quot;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">hash_iocs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">md5_iocs</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scan_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">scan_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="c1"># Skip very large files (&gt;100MB)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
                <span class="n">sha256</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">sha256</span> <span class="ow">in</span> <span class="n">hash_iocs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                        <span class="n">ioc</span><span class="o">=</span><span class="n">hash_iocs</span><span class="p">[</span><span class="n">sha256</span><span class="p">],</span>
                        <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
                        <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SHA256: </span><span class="si">{</span><span class="n">sha256</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">))</span>

                <span class="k">if</span> <span class="n">md5</span> <span class="ow">in</span> <span class="n">md5_iocs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                        <span class="n">ioc</span><span class="o">=</span><span class="n">md5_iocs</span><span class="p">[</span><span class="n">md5</span><span class="p">],</span>
                        <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
                        <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;MD5: </span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">))</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">PermissionError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_file_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for files with known malicious names.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning file names in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">name_iocs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">ioc</span>
            <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name_iocs</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">scan_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">scan_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">name_iocs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                    <span class="n">ioc</span><span class="o">=</span><span class="n">name_iocs</span><span class="p">[</span><span class="n">filepath</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()],</span>
                    <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
                    <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Filename match: </span><span class="si">{</span><span class="n">filepath</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_network_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check active network connections against known bad IPs.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Scanning network connections...&quot;</span><span class="p">)</span>
        <span class="n">ip_iocs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">ioc</span>
            <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;IP&quot;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_iocs</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use netstat or ss to get connections</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;netstat&quot;</span><span class="p">,</span> <span class="s2">&quot;-an&quot;</span><span class="p">],</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">bad_ip</span> <span class="ow">in</span> <span class="n">ip_iocs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">bad_ip</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                            <span class="n">ioc</span><span class="o">=</span><span class="n">ip_iocs</span><span class="p">[</span><span class="n">bad_ip</span><span class="p">],</span>
                            <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Active network connection&quot;</span><span class="p">,</span>
                            <span class="n">context</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                        <span class="p">))</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">):</span>
            <span class="c1"># Try ss as fallback</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;ss&quot;</span><span class="p">,</span> <span class="s2">&quot;-an&quot;</span><span class="p">],</span>
                    <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">bad_ip</span> <span class="ow">in</span> <span class="n">ip_iocs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">bad_ip</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                                <span class="n">ioc</span><span class="o">=</span><span class="n">ip_iocs</span><span class="p">[</span><span class="n">bad_ip</span><span class="p">],</span>
                                <span class="n">location</span><span class="o">=</span><span class="s2">&quot;Active network connection&quot;</span><span class="p">,</span>
                                <span class="n">context</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                            <span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    [!] Could not check network connections&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_dns_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check DNS resolutions for known malicious domains.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Checking known malicious domains...&quot;</span><span class="p">)</span>
        <span class="n">domain_iocs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;DOMAIN&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="n">domain_iocs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try to resolve the domain - if it resolves from cache</span>
                <span class="c1"># the system may have contacted it</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span>
                    <span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span>
                    <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">ip</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                        <span class="n">ioc</span><span class="o">=</span><span class="n">ioc</span><span class="p">,</span>
                        <span class="n">location</span><span class="o">=</span><span class="s2">&quot;DNS resolution&quot;</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> resolves to </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="k">pass</span>  <span class="c1"># Domain doesn&#39;t resolve - good</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_file_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">extensions</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.sh&#39;</span><span class="p">,</span> <span class="s1">&#39;.php&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;.rb&#39;</span><span class="p">,</span> <span class="s1">&#39;.pl&#39;</span><span class="p">,</span> <span class="s1">&#39;.ps1&#39;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scan file contents for IOC patterns (regex).&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning file contents in </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">regex_iocs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">get_by_type</span><span class="p">(</span><span class="s2">&quot;REGEX&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">regex_iocs</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">compiled_patterns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="n">regex_iocs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">compiled_patterns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span> <span class="n">ioc</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] Invalid regex pattern: </span><span class="si">{</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">scan_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">scan_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># Skip &gt;10MB</span>
                    <span class="k">continue</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">ioc</span> <span class="ow">in</span> <span class="n">compiled_patterns</span><span class="p">:</span>
                    <span class="n">matches</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IOCMatch</span><span class="p">(</span>
                            <span class="n">ioc</span><span class="o">=</span><span class="n">ioc</span><span class="p">,</span>
                            <span class="n">location</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
                            <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pattern &#39;</span><span class="si">{</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2"> times&quot;</span><span class="p">,</span>
                        <span class="p">))</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">PermissionError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print IOC scan results.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  IOC SCAN REPORT&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  IOCs in database: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">iocs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Matches found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  No IOC matches found. System appears clean.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span> <span class="s1">&#39;HIGH&#39;</span><span class="p">,</span> <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span> <span class="s1">&#39;LOW&#39;</span><span class="p">]:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="n">severity</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">severity</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2"> matches)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Type: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">ioc_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  IOC:  </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Desc: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Found: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Context: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">context</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  RECOMMENDED ACTIONS:&quot;</span><span class="p">)</span>
        <span class="n">critical</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">ioc</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;CRITICAL&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">critical</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [!] CRITICAL matches found - initiate incident response&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [!] Isolate affected system immediately&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [*] Review matches and determine if they are true positives&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [*] Escalate confirmed matches to security team&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>


<span class="c1"># â”€â”€â”€ Example IOC JSON format â”€â”€â”€</span>
<span class="n">SAMPLE_IOC_JSON</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">{</span>
<span class="s2">  &quot;iocs&quot;: [</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;IP&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;198.51.100.1&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Known C2 server for BotnetX&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;ThreatIntel Feed Alpha&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;HIGH&quot;</span>
<span class="s2">    },</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;DOMAIN&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;evil-malware.example.com&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Malware distribution domain&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;OSINT&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;CRITICAL&quot;</span>
<span class="s2">    },</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;HASH_SHA256&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;a1b2c3d4e5f6...&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Ransomware binary&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;VirusTotal&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;CRITICAL&quot;</span>
<span class="s2">    },</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;FILENAME&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;mimikatz.exe&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Credential dumping tool&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;MITRE ATT&amp;CK&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;CRITICAL&quot;</span>
<span class="s2">    },</span>
<span class="s2">    {</span>
<span class="s2">      &quot;type&quot;: &quot;REGEX&quot;,</span>
<span class="s2">      &quot;value&quot;: &quot;(?:eval|exec)</span><span class="se">\\\\</span><span class="s2">s*</span><span class="se">\\\\</span><span class="s2">(</span><span class="se">\\\\</span><span class="s2">s*base64&quot;,</span>
<span class="s2">      &quot;description&quot;: &quot;Obfuscated code execution pattern&quot;,</span>
<span class="s2">      &quot;source&quot;: &quot;Custom rule&quot;,</span>
<span class="s2">      &quot;severity&quot;: &quot;HIGH&quot;</span>
<span class="s2">    }</span>
<span class="s2">  ]</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

    <span class="c1"># Initialize IOC database</span>
    <span class="n">ioc_db</span> <span class="o">=</span> <span class="n">IOCDatabase</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">ioc_db</span><span class="o">.</span><span class="n">load_from_json</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Loaded </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> IOCs from </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">scan_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="s2">&quot;/tmp&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ioc_db</span><span class="o">.</span><span class="n">load_sample_iocs</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ioc_db</span><span class="o">.</span><span class="n">iocs</span><span class="p">)</span><span class="si">}</span><span class="s2"> sample IOCs&quot;</span><span class="p">)</span>
        <span class="n">scan_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;/tmp&quot;</span>

    <span class="c1"># Run scanner</span>
    <span class="n">scanner</span> <span class="o">=</span> <span class="n">IOCScanner</span><span class="p">(</span><span class="n">ioc_db</span><span class="p">)</span>
    <span class="n">scanner</span><span class="o">.</span><span class="n">scan_all</span><span class="p">(</span><span class="n">scan_dir</span><span class="p">)</span>
    <span class="n">scanner</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="5-digital-forensics-basics">5. Digital Forensics Basics<a class="header-link" href="#5-digital-forensics-basics" title="Permanent link">&para;</a></h2>
<h3 id="51-forensic-principles">5.1 Forensic Principles<a class="header-link" href="#51-forensic-principles" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="n">Digital</span><span class="w"> </span><span class="n">Forensics</span><span class="w"> </span><span class="n">Principles</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">PRESERVE</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">evidence</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Never</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">original</span><span class="w"> </span><span class="n">evidence</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">forensic</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="p">(</span><span class="n">bit</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">copies</span><span class="p">)</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">write</span><span class="o">-</span><span class="n">blockers</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">access</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">everything</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">timestamps</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">DOCUMENT</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">custody</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Who</span><span class="w"> </span><span class="n">collected</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">evidence</span><span class="err">?</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">collected</span><span class="err">?</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">How</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">stored</span><span class="err">?</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Who</span><span class="w"> </span><span class="n">had</span><span class="w"> </span><span class="n">access</span><span class="err">?</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">VERIFY</span><span class="w"> </span><span class="n">integrity</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Hash</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">evidence</span><span class="w"> </span><span class="n">immediately</span><span class="w"> </span><span class="p">(</span><span class="n">SHA</span><span class="o">-</span><span class="mi">256</span><span class="p">)</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">hashes</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">analysis</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Any</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">invalidates</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">evidence</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="n">ANALYZE</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">copies</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Work</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">forensic</span><span class="w"> </span><span class="n">copies</span><span class="p">,</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">originals</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">forensic</span><span class="w"> </span><span class="n">tools</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t modify evidence              â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="n">detailed</span><span class="w"> </span><span class="n">notes</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="n">steps</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">5.</span><span class="w"> </span><span class="n">REPORT</span><span class="w"> </span><span class="n">findings</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Factual</span><span class="p">,</span><span class="w"> </span><span class="n">objective</span><span class="w"> </span><span class="n">reporting</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Reproducible</span><span class="w"> </span><span class="n">methodology</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Clear</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">evidence</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conclusions</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="52-order-of-volatility">5.2 Order of Volatility<a class="header-link" href="#52-order-of-volatility" title="Permanent link">&para;</a></h3>
<p>When collecting evidence, start with the most volatile (shortest-lived) data first.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">               </span><span class="n">Order</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Volatility</span><span class="w"> </span><span class="p">(</span><span class="n">Most</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Least</span><span class="p">)</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Most</span><span class="w"> </span><span class="n">Volatile</span><span class="w"> </span><span class="p">(</span><span class="n">collect</span><span class="w"> </span><span class="n">FIRST</span><span class="p">)</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">registers</span><span class="p">,</span><span class="w"> </span><span class="n">cache</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Lifetime</span><span class="p">:</span><span class="w"> </span><span class="n">nanoseconds</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">Memory</span><span class="w"> </span><span class="p">(</span><span class="n">RAM</span><span class="p">)</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Lifetime</span><span class="p">:</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">cycle</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Contains</span><span class="p">:</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">processes</span><span class="p">,</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">connections</span><span class="p">,</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">decrypted</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">passwords</span><span class="p">,</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">keys</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">state</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Lifetime</span><span class="p">:</span><span class="w"> </span><span class="n">seconds</span><span class="o">-</span><span class="n">minutes</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Contains</span><span class="p">:</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">connections</span><span class="p">,</span><span class="w"> </span><span class="n">routing</span><span class="w"> </span><span class="n">tables</span><span class="p">,</span><span class="w"> </span><span class="n">ARP</span><span class="w"> </span><span class="n">cache</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="n">Running</span><span class="w"> </span><span class="n">processes</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Lifetime</span><span class="p">:</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">ends</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Contains</span><span class="p">:</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="n">libraries</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="n">Disk</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="n">system</span><span class="p">)</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Lifetime</span><span class="p">:</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">overwritten</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Contains</span><span class="p">:</span><span class="w"> </span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">logs</span><span class="p">,</span><span class="w"> </span><span class="n">swap</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">slack</span><span class="w"> </span><span class="n">space</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="mf">6.</span><span class="w"> </span><span class="n">Remote</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">monitoring</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="n">Lifetime</span><span class="p">:</span><span class="w"> </span><span class="n">retention</span><span class="w"> </span><span class="n">policy</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="mf">7.</span><span class="w"> </span><span class="n">Archival</span><span class="w"> </span><span class="n">media</span><span class="w"> </span><span class="p">(</span><span class="n">backups</span><span class="p">,</span><span class="w"> </span><span class="n">tapes</span><span class="p">)</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="n">Lifetime</span><span class="p">:</span><span class="w"> </span><span class="n">years</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Least</span><span class="w"> </span><span class="n">Volatile</span><span class="w"> </span><span class="p">(</span><span class="n">collect</span><span class="w"> </span><span class="n">LAST</span><span class="p">)</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="53-chain-of-custody">5.3 Chain of Custody<a class="header-link" href="#53-chain-of-custody" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">Chain</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">Custody</span><span class="w"> </span><span class="nv">Form</span><span class="w">                           </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Case</span><span class="w"> </span><span class="nv">Number</span>:<span class="w"> </span><span class="nv">IR</span><span class="o">-</span><span class="mi">2025</span><span class="o">-</span><span class="mi">0042</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span><span class="nv">Evidence</span><span class="w"> </span><span class="nv">ID</span>:<span class="w"> </span><span class="nv">EVD</span><span class="o">-</span><span class="mi">001</span><span class="w">                                            </span>â”‚
â”‚<span class="w">  </span><span class="nv">Description</span>:<span class="w"> </span><span class="nv">Dell</span><span class="w"> </span><span class="nv">Latitude</span><span class="w"> </span><span class="mi">7420</span><span class="w"> </span><span class="nv">laptop</span>,<span class="w"> </span><span class="nv">S</span><span class="o">/</span><span class="nv">N</span>:<span class="w"> </span><span class="nv">ABC123DEF</span><span class="w">          </span>â”‚
â”‚<span class="w">  </span><span class="nv">Location</span><span class="w"> </span><span class="nv">Found</span>:<span class="w"> </span><span class="nv">Office</span><span class="w"> </span><span class="mi">302</span>,<span class="w"> </span><span class="nv">Building</span><span class="w"> </span><span class="nv">A</span><span class="w">                          </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Evidence</span><span class="w"> </span><span class="nv">Hash</span><span class="w"> </span><span class="ss">(</span><span class="nv">at</span><span class="w"> </span><span class="nv">collection</span><span class="ss">)</span>:<span class="w">                                  </span>â”‚
â”‚<span class="w">  </span><span class="nv">SHA</span><span class="o">-</span><span class="mi">256</span>:<span class="w"> </span><span class="nv">a1b2c3d4e5f6789</span>...<span class="w">                                    </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">Date</span><span class="w">   </span>â”‚<span class="w">  </span><span class="nv">Released</span><span class="w"> </span><span class="nv">By</span><span class="w">      </span>â”‚<span class="w"> </span><span class="nv">Received</span><span class="w"> </span><span class="nv">By</span>â”‚<span class="w">    </span><span class="nv">Purpose</span><span class="w">     </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="mi">01</span><span class="o">/</span><span class="mi">15</span><span class="o">/</span><span class="mi">25</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Officer</span><span class="w"> </span><span class="nv">Smith</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Analyst</span><span class="w"> </span><span class="nv">Lee</span>â”‚<span class="w"> </span><span class="nv">Initial</span><span class="w">        </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="mi">10</span>:<span class="mi">30</span><span class="w"> </span><span class="nv">AM</span><span class="w"> </span>â”‚<span class="w"> </span><span class="ss">(</span><span class="nv">Badge</span><span class="w"> </span><span class="sc">#1234</span><span class="ss">)</span><span class="w">     </span>â”‚<span class="w"> </span><span class="ss">(</span><span class="nv">IR</span><span class="w"> </span><span class="nv">Team</span><span class="ss">)</span><span class="w">  </span>â”‚<span class="w"> </span><span class="nv">collection</span><span class="w">     </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="mi">01</span><span class="o">/</span><span class="mi">15</span><span class="o">/</span><span class="mi">25</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Analyst</span><span class="w"> </span><span class="nv">Lee</span><span class="w">       </span>â”‚<span class="w"> </span><span class="nv">Evidence</span><span class="w">   </span>â”‚<span class="w"> </span><span class="nv">Secure</span><span class="w">         </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="mi">11</span>:<span class="mi">45</span><span class="w"> </span><span class="nv">AM</span><span class="w"> </span>â”‚<span class="w"> </span><span class="ss">(</span><span class="nv">IR</span><span class="w"> </span><span class="nv">Team</span><span class="ss">)</span><span class="w">         </span>â”‚<span class="w"> </span><span class="nv">Locker</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">storage</span><span class="w">        </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="mi">01</span><span class="o">/</span><span class="mi">16</span><span class="o">/</span><span class="mi">25</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Evidence</span><span class="w"> </span><span class="nv">Locker</span><span class="w">   </span>â”‚<span class="w"> </span><span class="nv">Forensic</span><span class="w">   </span>â”‚<span class="w"> </span><span class="nv">Disk</span><span class="w">           </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="mi">09</span>:<span class="mi">00</span><span class="w"> </span><span class="nv">AM</span><span class="w"> </span>â”‚<span class="w">                   </span>â”‚<span class="w"> </span><span class="nv">Analyst</span><span class="w"> </span><span class="nv">Kim</span>â”‚<span class="w"> </span><span class="nv">imaging</span><span class="w">        </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="mi">01</span><span class="o">/</span><span class="mi">16</span><span class="o">/</span><span class="mi">25</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Forensic</span><span class="w"> </span><span class="nv">Analyst</span><span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Evidence</span><span class="w">   </span>â”‚<span class="w"> </span><span class="k">Return</span><span class="w"> </span><span class="nv">after</span><span class="w">   </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="mi">05</span>:<span class="mi">00</span><span class="w"> </span><span class="nv">PM</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Kim</span><span class="w">               </span>â”‚<span class="w"> </span><span class="nv">Locker</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">imaging</span><span class="w">        </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">  </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">Notes</span>:<span class="w">                                                           </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Laptop</span><span class="w"> </span><span class="nv">was</span><span class="w"> </span><span class="nv">powered</span><span class="w"> </span><span class="nv">off</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">collected</span><span class="w">                         </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Battery</span><span class="w"> </span><span class="nv">was</span><span class="w"> </span><span class="nv">removed</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">prevent</span><span class="w"> </span><span class="nv">accidental</span><span class="w"> </span><span class="nv">boot</span><span class="w">                </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Disk</span><span class="w"> </span><span class="nv">imaged</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="nv">FTK</span><span class="w"> </span><span class="nv">Imager</span>,<span class="w"> </span><span class="nv">hash</span><span class="w"> </span><span class="nv">verified</span><span class="w">                  </span>â”‚
â”‚<span class="w">                                                                   </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="54-forensic-disk-imaging">5.4 Forensic Disk Imaging<a class="header-link" href="#54-forensic-disk-imaging" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a forensic image using dd</span>
<span class="c1"># WARNING: Be VERY careful with dd - wrong parameters can destroy data</span>

<span class="c1"># Step 1: Identify the target disk</span>
lsblk
<span class="c1"># or</span>
fdisk<span class="w"> </span>-l

<span class="c1"># Step 2: Create forensic image (bit-for-bit copy)</span>
<span class="c1"># /dev/sdb = source (evidence drive, via write-blocker)</span>
<span class="c1"># evidence.dd = destination image file</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sdb<span class="w"> </span><span class="nv">of</span><span class="o">=</span>evidence.dd<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">4096</span><span class="w"> </span><span class="nv">conv</span><span class="o">=</span>noerror,sync<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress

<span class="c1"># Step 3: Calculate hash of original and image</span>
sha256sum<span class="w"> </span>/dev/sdb<span class="w"> </span>&gt;<span class="w"> </span>original_hash.txt
sha256sum<span class="w"> </span>evidence.dd<span class="w"> </span>&gt;<span class="w"> </span>image_hash.txt

<span class="c1"># Step 4: Verify hashes match</span>
diff<span class="w"> </span>original_hash.txt<span class="w"> </span>image_hash.txt

<span class="c1"># Better alternative: dc3dd (forensic-focused dd)</span>
sudo<span class="w"> </span>dc3dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sdb<span class="w"> </span><span class="nv">of</span><span class="o">=</span>evidence.dd<span class="w"> </span><span class="nv">hash</span><span class="o">=</span>sha256<span class="w"> </span><span class="nv">log</span><span class="o">=</span>imaging.log

<span class="c1"># Alternative: FTK Imager (cross-platform, GUI)</span>
<span class="c1"># Creates E01 (Expert Witness) format with built-in hashing</span>
</code></pre></div>

<hr />
<h2 id="6-memory-forensics-concepts">6. Memory Forensics Concepts<a class="header-link" href="#6-memory-forensics-concepts" title="Permanent link">&para;</a></h2>
<h3 id="61-why-memory-forensics">6.1 Why Memory Forensics?<a class="header-link" href="#61-why-memory-forensics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                What Lives Only in Memory?                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Things you can ONLY find in RAM:           â”‚                 â”‚
â”‚  â”‚                                              â”‚                 â”‚
â”‚  â”‚  - Running processes (including hidden)     â”‚                 â”‚
â”‚  â”‚  - Network connections                       â”‚                 â”‚
â”‚  â”‚  - Decryption keys                           â”‚                 â”‚
â”‚  â”‚  - Passwords (plaintext in memory)          â”‚                 â”‚
â”‚  â”‚  - Injected code (fileless malware)         â”‚                 â”‚
â”‚  â”‚  - Clipboard contents                        â”‚                 â”‚
â”‚  â”‚  - Chat messages (before saved to disk)     â”‚                 â”‚
â”‚  â”‚  - Encryption keys (full disk encryption)   â”‚                 â”‚
â”‚  â”‚  - Command history                           â”‚                 â”‚
â”‚  â”‚  - Unpacked/decrypted malware               â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                   â”‚
â”‚  Modern malware often operates entirely in memory                â”‚
â”‚  (&quot;fileless malware&quot;) to avoid disk-based detection.             â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62-memory-acquisition">6.2 Memory Acquisition<a class="header-link" href="#62-memory-acquisition" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Linux memory acquisition</span>

<span class="c1"># Method 1: /proc/kcore (requires root)</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/proc/kcore<span class="w"> </span><span class="nv">of</span><span class="o">=</span>memory.raw<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M

<span class="c1"># Method 2: LiME (Linux Memory Extractor) - preferred</span>
<span class="c1"># Load LiME kernel module</span>
sudo<span class="w"> </span>insmod<span class="w"> </span>lime-<span class="k">$(</span>uname<span class="w"> </span>-r<span class="k">)</span>.ko<span class="w"> </span><span class="s2">&quot;path=memory.lime format=lime&quot;</span>

<span class="c1"># Method 3: AVML (Microsoft&#39;s Linux memory acquisition tool)</span>
sudo<span class="w"> </span>./avml<span class="w"> </span>memory.lime

<span class="c1"># Windows memory acquisition</span>
<span class="c1"># - FTK Imager (free, GUI)</span>
<span class="c1"># - WinPmem (command line)</span>
<span class="c1"># - Belkasoft RAM Capturer (free)</span>

<span class="c1"># macOS memory acquisition</span>
<span class="c1"># - osxpmem</span>
sudo<span class="w"> </span>./osxpmem<span class="w"> </span>-o<span class="w"> </span>memory.aff4
</code></pre></div>

<h3 id="63-volatility-framework-overview">6.3 Volatility Framework (Overview)<a class="header-link" href="#63-volatility-framework-overview" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Volatility 3 - Memory forensics framework</span>
<span class="c1"># Install: pip install volatility3</span>

<span class="c1"># Identify the OS profile</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.info

<span class="c1"># List running processes</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.pslist
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.pstree<span class="w">  </span><span class="c1"># Tree view</span>

<span class="c1"># Find hidden processes</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.psscan

<span class="c1"># Network connections</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.netscan

<span class="c1"># Command history</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.cmdline

<span class="c1"># DLL list for a specific process</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.dlllist<span class="w"> </span>--pid<span class="w"> </span><span class="m">1234</span>

<span class="c1"># Dump a specific process</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.memmap<span class="w"> </span>--pid<span class="w"> </span><span class="m">1234</span><span class="w"> </span>--dump

<span class="c1"># Registry analysis</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>windows.registry.hivelist

<span class="c1"># Linux memory analysis</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>linux.pslist
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>linux.bash<span class="w">  </span><span class="c1"># Bash history</span>
vol<span class="w"> </span>-f<span class="w"> </span>memory.raw<span class="w"> </span>linux.netstat
</code></pre></div>

<hr />
<h2 id="7-network-forensics">7. Network Forensics<a class="header-link" href="#7-network-forensics" title="Permanent link">&para;</a></h2>
<h3 id="71-packet-capture-analysis">7.1 Packet Capture Analysis<a class="header-link" href="#71-packet-capture-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">pcap_analyzer.py - Basic network forensics with packet capture analysis.</span>
<span class="sd">Requires: pip install scapy</span>

<span class="sd">WARNING: Only analyze captures from networks you are authorized to monitor.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scapy.all</span><span class="w"> </span><span class="kn">import</span> <span class="n">rdpcap</span><span class="p">,</span> <span class="n">IP</span><span class="p">,</span> <span class="n">TCP</span><span class="p">,</span> <span class="n">UDP</span><span class="p">,</span> <span class="n">DNS</span><span class="p">,</span> <span class="n">Raw</span>
    <span class="n">SCAPY_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">SCAPY_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scapy not installed. Install with: pip install scapy&quot;</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PcapAnalysis</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Results of PCAP file analysis.&quot;&quot;&quot;</span>
    <span class="n">total_packets</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">protocols</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">top_talkers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">dns_queries</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">suspicious_connections</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">http_requests</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">large_transfers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">analyze_pcap</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PcapAnalysis</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze a PCAP file for security-relevant information.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: Path to .pcap or .pcapng file</span>

<span class="sd">    Returns:</span>
<span class="sd">        PcapAnalysis with findings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">SCAPY_AVAILABLE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Scapy is required for PCAP analysis&quot;</span><span class="p">)</span>

    <span class="n">packets</span> <span class="o">=</span> <span class="n">rdpcap</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">analysis</span> <span class="o">=</span> <span class="n">PcapAnalysis</span><span class="p">(</span><span class="n">total_packets</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">packets</span><span class="p">))</span>

    <span class="c1"># Track statistics</span>
    <span class="n">ip_src_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">ip_dst_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">protocol_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">connection_sizes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">dns_queries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">http_requests</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">pkt</span> <span class="ow">in</span> <span class="n">packets</span><span class="p">:</span>
        <span class="c1"># Protocol analysis</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">TCP</span><span class="p">):</span>
            <span class="n">protocol_counter</span><span class="p">[</span><span class="s1">&#39;TCP&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">UDP</span><span class="p">):</span>
            <span class="n">protocol_counter</span><span class="p">[</span><span class="s1">&#39;UDP&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># IP layer analysis</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span>
            <span class="n">ip_src_counter</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ip_dst_counter</span><span class="p">[</span><span class="n">dst</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Track connection data volume</span>
            <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">Raw</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">connection_sizes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkt</span><span class="p">[</span><span class="n">Raw</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>

        <span class="c1"># DNS analysis</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">DNS</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pkt</span><span class="p">[</span><span class="n">DNS</span><span class="p">]</span><span class="o">.</span><span class="n">qr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Query</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">query_name</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">DNS</span><span class="p">]</span><span class="o">.</span><span class="n">qd</span><span class="o">.</span><span class="n">qname</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="n">dns_queries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query_name</span><span class="p">,</span>
                    <span class="s1">&#39;src&#39;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span> <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="n">DNS</span><span class="p">]</span><span class="o">.</span><span class="n">qd</span><span class="o">.</span><span class="n">qtype</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="c1"># HTTP request detection (basic)</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">TCP</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">Raw</span><span class="p">):</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">Raw</span><span class="p">]</span><span class="o">.</span><span class="n">load</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;GET &#39;</span><span class="p">,</span> <span class="s1">&#39;POST &#39;</span><span class="p">,</span> <span class="s1">&#39;PUT &#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE &#39;</span><span class="p">)):</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">http_requests</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;src&#39;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span> <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;dst&#39;</span><span class="p">:</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span> <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
                    <span class="p">})</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="c1"># Compile results</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">protocols</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">protocol_counter</span><span class="p">)</span>

    <span class="c1"># Top talkers (by packet count)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">top_talkers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span> <span class="s1">&#39;packets_sent&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ip_src_counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># DNS queries (deduplicated)</span>
    <span class="n">seen_queries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">dns_queries</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_queries</span><span class="p">:</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">dns_queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="n">seen_queries</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">])</span>

    <span class="c1"># Large data transfers (potential exfiltration)</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">large_transfers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;connection&#39;</span><span class="p">:</span> <span class="n">conn</span><span class="p">,</span> <span class="s1">&#39;bytes&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">conn</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">connection_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">analysis</span><span class="o">.</span><span class="n">http_requests</span> <span class="o">=</span> <span class="n">http_requests</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>

    <span class="c1"># Suspicious pattern detection</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">suspicious_connections</span> <span class="o">=</span> <span class="n">detect_suspicious_patterns</span><span class="p">(</span>
        <span class="n">packets</span><span class="p">,</span> <span class="n">ip_src_counter</span><span class="p">,</span> <span class="n">dns_queries</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">analysis</span>


<span class="k">def</span><span class="w"> </span><span class="nf">detect_suspicious_patterns</span><span class="p">(</span><span class="n">packets</span><span class="p">,</span> <span class="n">ip_counter</span><span class="p">,</span> <span class="n">dns_queries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect suspicious network patterns.&quot;&quot;&quot;</span>
    <span class="n">suspicious</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># 1. Beaconing detection (regular interval connections)</span>
    <span class="c1"># Simplified: check for IPs with very regular packet intervals</span>
    <span class="c1"># (Real beaconing detection requires statistical analysis)</span>

    <span class="c1"># 2. DNS tunneling indicators</span>
    <span class="n">long_queries</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">dns_queries</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">long_queries</span><span class="p">:</span>
        <span class="n">suspicious</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;DNS_TUNNELING_POSSIBLE&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">long_queries</span><span class="p">)</span><span class="si">}</span><span class="s2"> unusually long DNS queries&quot;</span><span class="p">,</span>
            <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][:</span><span class="mi">80</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">long_queries</span><span class="p">[:</span><span class="mi">3</span><span class="p">]],</span>
        <span class="p">})</span>

    <span class="c1"># 3. Port scanning detection</span>
    <span class="n">dst_ports</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pkt</span> <span class="ow">in</span> <span class="n">packets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">TCP</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pkt</span><span class="o">.</span><span class="n">haslayer</span><span class="p">(</span><span class="n">IP</span><span class="p">):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">IP</span><span class="p">]</span><span class="o">.</span><span class="n">src</span>
            <span class="n">dst_port</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">[</span><span class="n">TCP</span><span class="p">]</span><span class="o">.</span><span class="n">dport</span>
            <span class="n">dst_ports</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dst_port</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">ports</span> <span class="ow">in</span> <span class="n">dst_ports</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>  <span class="c1"># Hitting many different ports</span>
            <span class="n">suspicious</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;PORT_SCAN_POSSIBLE&#39;</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> contacted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span><span class="si">}</span><span class="s2"> different ports&quot;</span><span class="p">,</span>
                <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ports</span><span class="p">))[:</span><span class="mi">10</span><span class="p">],</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">suspicious</span>


<span class="k">def</span><span class="w"> </span><span class="nf">print_pcap_report</span><span class="p">(</span><span class="n">analysis</span><span class="p">:</span> <span class="n">PcapAnalysis</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print formatted PCAP analysis report.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  NETWORK FORENSICS REPORT&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">65</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total packets: </span><span class="si">{</span><span class="n">analysis</span><span class="o">.</span><span class="n">total_packets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Protocols: </span><span class="si">{</span><span class="n">analysis</span><span class="o">.</span><span class="n">protocols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  TOP TALKERS (by packets sent)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">top_talkers</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;packets_sent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> packets&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">dns_queries</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  DNS QUERIES (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">dns_queries</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">dns_queries</span><span class="p">[:</span><span class="mi">20</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">large_transfers</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  LARGEST DATA TRANSFERS&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">large_transfers</span><span class="p">:</span>
            <span class="n">size_kb</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;bytes&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1024</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;connection&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">40s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">size_kb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> KB&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">suspicious_connections</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  SUSPICIOUS PATTERNS&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">suspicious_connections</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">65</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="72-useful-command-line-tools">7.2 Useful Command-Line Tools<a class="header-link" href="#72-useful-command-line-tools" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># tcpdump - capture packets</span>
<span class="c1"># Capture all traffic on eth0</span>
sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>-w<span class="w"> </span>capture.pcap

<span class="c1"># Capture only traffic to/from specific IP</span>
sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>host<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span>-w<span class="w"> </span>suspicious.pcap

<span class="c1"># Capture only HTTP traffic</span>
sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>port<span class="w"> </span><span class="m">80</span><span class="w"> </span>-w<span class="w"> </span>http_traffic.pcap

<span class="c1"># Capture DNS traffic</span>
sudo<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0<span class="w"> </span>port<span class="w"> </span><span class="m">53</span><span class="w"> </span>-w<span class="w"> </span>dns_traffic.pcap

<span class="c1"># tshark (command-line Wireshark)</span>
<span class="c1"># Extract HTTP requests</span>
tshark<span class="w"> </span>-r<span class="w"> </span>capture.pcap<span class="w"> </span>-Y<span class="w"> </span><span class="s2">&quot;http.request&quot;</span><span class="w"> </span>-T<span class="w"> </span>fields<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span>ip.src<span class="w"> </span>-e<span class="w"> </span>http.request.method<span class="w"> </span>-e<span class="w"> </span>http.request.uri

<span class="c1"># Extract DNS queries</span>
tshark<span class="w"> </span>-r<span class="w"> </span>capture.pcap<span class="w"> </span>-Y<span class="w"> </span><span class="s2">&quot;dns.qr == 0&quot;</span><span class="w"> </span>-T<span class="w"> </span>fields<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span>ip.src<span class="w"> </span>-e<span class="w"> </span>dns.qry.name

<span class="c1"># Extract file transfers</span>
tshark<span class="w"> </span>-r<span class="w"> </span>capture.pcap<span class="w"> </span>--export-objects<span class="w"> </span>http,exported_files/

<span class="c1"># Show conversation statistics</span>
tshark<span class="w"> </span>-r<span class="w"> </span>capture.pcap<span class="w"> </span>-z<span class="w"> </span>conv,ip<span class="w"> </span>-q
</code></pre></div>

<hr />
<h2 id="8-incident-response-playbooks">8. Incident Response Playbooks<a class="header-link" href="#8-incident-response-playbooks" title="Permanent link">&para;</a></h2>
<h3 id="81-playbook-template">8.1 Playbook Template<a class="header-link" href="#81-playbook-template" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="n">IR</span><span class="w"> </span><span class="n">Playbook</span><span class="w"> </span><span class="n">Template</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">PLAYBOOK</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">Incident</span><span class="w"> </span><span class="n">Type</span><span class="p">]</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">VERSION</span><span class="o">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">LAST</span><span class="w"> </span><span class="n">UPDATED</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">Date</span><span class="p">]</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">OWNER</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">Team</span><span class="o">/</span><span class="n">Person</span><span class="p">]</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">SEVERITY</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">P1</span><span class="o">-</span><span class="n">P4</span><span class="p">]</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">TRIGGER</span><span class="o">:</span><span class="w">                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="n">What</span><span class="w"> </span><span class="n">alerts</span><span class="o">/</span><span class="n">conditions</span><span class="w"> </span><span class="n">activate</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">playbook</span><span class="p">]</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">TRIAGE</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">minutes</span><span class="p">)</span><span class="o">:</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="p">...</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="p">...</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="n">Classify</span><span class="w"> </span><span class="n">severity</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="n">Notify</span><span class="w"> </span><span class="n">incident</span><span class="w"> </span><span class="n">manager</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">CONTAINMENT</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="mi">1-4</span><span class="w"> </span><span class="n">hours</span><span class="p">)</span><span class="o">:</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="p">...</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="p">...</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="n">Preserve</span><span class="w"> </span><span class="n">evidence</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ERADICATION</span><span class="o">:</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="p">...</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="p">...</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">RECOVERY</span><span class="o">:</span><span class="w">                                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="p">...</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">operations</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">COMMUNICATION</span><span class="o">:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Internal</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">who</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">notify</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">when</span><span class="p">]</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">External</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">customers</span><span class="p">,</span><span class="w"> </span><span class="n">regulators</span><span class="p">,</span><span class="w"> </span><span class="n">law</span><span class="w"> </span><span class="n">enforcement</span><span class="p">]</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ESCALATION</span><span class="o">:</span><span class="w">                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Condition</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Action</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="82-playbook-ransomware-incident">8.2 Playbook: Ransomware Incident<a class="header-link" href="#82-playbook-ransomware-incident" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">            </span><span class="n">PLAYBOOK</span><span class="p">:</span><span class="w"> </span><span class="n">Ransomware</span><span class="w"> </span><span class="n">Incident</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">SEVERITY</span><span class="p">:</span><span class="w"> </span><span class="n">P1</span><span class="w"> </span><span class="p">(</span><span class="n">Critical</span><span class="p">)</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">TRIGGER</span><span class="p">:</span><span class="w">                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Ransom</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="n">displayed</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">endpoint</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Mass</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">detected</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">EDR</span><span class="w"> </span><span class="n">alert</span><span class="p">:</span><span class="w"> </span><span class="n">ransomware</span><span class="w"> </span><span class="n">behavior</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">TRIAGE</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">minutes</span><span class="p">):</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">DO</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="n">systems</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">Disconnect</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="n">systems</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">network</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="p">(</span><span class="n">pull</span><span class="w"> </span><span class="n">ethernet</span><span class="p">,</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="n">WiFi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">shut</span><span class="w"> </span><span class="n">down</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">ransom</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="p">(</span><span class="n">photograph</span><span class="o">/</span><span class="n">screenshot</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="n">Identify</span><span class="w"> </span><span class="n">ransomware</span><span class="w"> </span><span class="n">variant</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="n">Determine</span><span class="w"> </span><span class="n">scope</span><span class="p">:</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">systems</span><span class="w"> </span><span class="n">affected</span><span class="err">?</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">6.</span><span class="w"> </span><span class="n">Notify</span><span class="w"> </span><span class="n">incident</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">activate</span><span class="w"> </span><span class="n">IR</span><span class="w"> </span><span class="n">team</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">7.</span><span class="w"> </span><span class="n">Notify</span><span class="w"> </span><span class="n">CISO</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">executive</span><span class="w"> </span><span class="n">management</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">CONTAINMENT</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="w"> </span><span class="n">hours</span><span class="p">):</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">Isolate</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">segments</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="n">ransomware</span><span class="w"> </span><span class="n">C2</span><span class="w"> </span><span class="n">IPs</span><span class="o">/</span><span class="n">domains</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">Disable</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">shares</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">spread</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="n">Reset</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">potentially</span><span class="w"> </span><span class="n">compromised</span><span class="w"> </span><span class="n">credentials</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="n">Capture</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">dumps</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="n">systems</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">6.</span><span class="w"> </span><span class="n">Preserve</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="p">(</span><span class="n">SIEM</span><span class="p">,</span><span class="w"> </span><span class="n">firewall</span><span class="p">,</span><span class="w"> </span><span class="n">endpoint</span><span class="p">)</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">7.</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">backup</span><span class="w"> </span><span class="n">integrity</span><span class="w"> </span><span class="p">(</span><span class="n">are</span><span class="w"> </span><span class="n">backups</span><span class="w"> </span><span class="n">affected</span><span class="err">?</span><span class="p">)</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ERADICATION</span><span class="p">:</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">Identify</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">infection</span><span class="w"> </span><span class="n">vector</span><span class="w"> </span><span class="p">(</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">exploit</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">NoMoreRansom</span><span class="o">.</span><span class="n">org</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">decryption</span><span class="w"> </span><span class="n">tools</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">malware</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="n">systems</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="n">Patch</span><span class="w"> </span><span class="n">vulnerability</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">infection</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="n">Scan</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">systems</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">persistence</span><span class="w"> </span><span class="n">mechanisms</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">RECOVERY</span><span class="p">:</span><span class="w">                                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">Restore</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">clean</span><span class="p">,</span><span class="w"> </span><span class="n">verified</span><span class="w"> </span><span class="n">backups</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">Rebuild</span><span class="w"> </span><span class="n">systems</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">cleaned</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">Restore</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">phases</span><span class="p">,</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">reinfection</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="n">Reset</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">passwords</span><span class="w"> </span><span class="n">organization</span><span class="o">-</span><span class="n">wide</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="n">Enhance</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">days</span><span class="w"> </span><span class="n">post</span><span class="o">-</span><span class="n">recovery</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">COMMUNICATION</span><span class="p">:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Internal</span><span class="p">:</span><span class="w"> </span><span class="n">All</span><span class="o">-</span><span class="n">hands</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">hours</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Legal</span><span class="p">:</span><span class="w"> </span><span class="n">Engage</span><span class="w"> </span><span class="n">legal</span><span class="w"> </span><span class="n">counsel</span><span class="w"> </span><span class="n">immediately</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Insurance</span><span class="p">:</span><span class="w"> </span><span class="n">Notify</span><span class="w"> </span><span class="n">cyber</span><span class="w"> </span><span class="n">insurance</span><span class="w"> </span><span class="n">carrier</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Law</span><span class="w"> </span><span class="n">enforcement</span><span class="p">:</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">FBI</span><span class="w"> </span><span class="n">IC3</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Regulators</span><span class="p">:</span><span class="w"> </span><span class="n">Per</span><span class="w"> </span><span class="n">regulatory</span><span class="w"> </span><span class="n">requirements</span><span class="w"> </span><span class="p">(</span><span class="n">GDPR</span><span class="p">:</span><span class="w"> </span><span class="mi">72</span><span class="w"> </span><span class="n">hours</span><span class="p">)</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Customers</span><span class="p">:</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">breach</span><span class="w"> </span><span class="n">confirmed</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">DO</span><span class="w"> </span><span class="n">NOT</span><span class="p">:</span><span class="w">                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Pay</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ransom</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">consulting</span><span class="w"> </span><span class="n">legal</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">law</span><span class="w"> </span><span class="n">enforcement</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Communicate</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">attackers</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">legal</span><span class="w"> </span><span class="n">guidance</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Destroy</span><span class="w"> </span><span class="n">evidence</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Restore</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">backups</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">ensuring</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">clean</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="83-playbook-compromised-credentials">8.3 Playbook: Compromised Credentials<a class="header-link" href="#83-playbook-compromised-credentials" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">         </span><span class="nx">PLAYBOOK</span><span class="p">:</span><span class="w"> </span><span class="nx">Compromised</span><span class="w"> </span><span class="nx">Credentials</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">SEVERITY</span><span class="p">:</span><span class="w"> </span><span class="nx">P2</span><span class="w"> </span><span class="p">(</span><span class="nx">High</span><span class="p">)</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">TRIGGER</span><span class="p">:</span><span class="w">                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Credential</span><span class="w"> </span><span class="nx">found</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">dark</span><span class="w"> </span><span class="nx">web</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">paste</span><span class="w"> </span><span class="nx">site</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="nx">reports</span><span class="w"> </span><span class="nx">phishing</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">credential</span><span class="w"> </span><span class="nx">theft</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Impossible</span><span class="w"> </span><span class="nx">travel</span><span class="w"> </span><span class="nx">alert</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">MFA</span><span class="w"> </span><span class="nx">bypass</span><span class="w"> </span><span class="nx">detected</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">INITIAL</span><span class="w"> </span><span class="nx">TRIAGE</span><span class="p">:</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Identify</span><span class="w"> </span><span class="nx">affected</span><span class="w"> </span><span class="nx">account</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Determine</span><span class="w"> </span><span class="nx">credential</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">API</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">unauthorized</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">audit</span><span class="w"> </span><span class="nx">logs</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Determine</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">MFA</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">enabled</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">CONTAINMENT</span><span class="p">:</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Force</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">affected</span><span class="w"> </span><span class="nx">account</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Revoke</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">active</span><span class="w"> </span><span class="nx">sessions</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">tokens</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Rotate</span><span class="w"> </span><span class="nx">API</span><span class="w"> </span><span class="nx">keys</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">applicable</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Enable</span><span class="w"> </span><span class="nx">MFA</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">already</span><span class="w"> </span><span class="nx">enabled</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Block</span><span class="w"> </span><span class="nx">suspicious</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="nx">IPs</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">mailbox</span><span class="w"> </span><span class="nx">rules</span><span class="w"> </span><span class="p">(</span><span class="nx">forwarding</span><span class="p">,</span><span class="w"> </span><span class="nx">deletion</span><span class="p">)</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">INVESTIGATION</span><span class="p">:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Review</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">actions</span><span class="w"> </span><span class="nx">taken</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">compromised</span><span class="w"> </span><span class="nx">credential</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">lateral</span><span class="w"> </span><span class="nx">movement</span><span class="w"> </span><span class="p">(</span><span class="nx">access</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="nx">systems</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">exfiltration</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Identify</span><span class="w"> </span><span class="nx">how</span><span class="w"> </span><span class="nx">credential</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">compromised</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">credential</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">reused</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="nx">services</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">RECOVERY</span><span class="p">:</span><span class="w">                                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Verify</span><span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">secured</span><span class="w"> </span><span class="p">(</span><span class="nx">new</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">MFA</span><span class="p">)</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Reverse</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">unauthorized</span><span class="w"> </span><span class="nx">changes</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Notify</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">incident</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">require</span><span class="w"> </span><span class="nx">security</span><span class="w"> </span><span class="nx">training</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Monitor</span><span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="nx">days</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="9-post-incident-review-template">9. Post-Incident Review Template<a class="header-link" href="#9-post-incident-review-template" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">incident_report.py - Generate post-incident review reports.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TimelineEvent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A single event in the incident timeline.&quot;&quot;&quot;</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>        <span class="c1"># Who performed the action</span>
    <span class="n">evidence</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>     <span class="c1"># Supporting evidence</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ActionItem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A follow-up action from the incident review.&quot;&quot;&quot;</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">owner</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">due_date</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;MEDIUM&quot;</span>  <span class="c1"># HIGH, MEDIUM, LOW</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;OPEN&quot;</span>      <span class="c1"># OPEN, IN_PROGRESS, DONE</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IncidentReport</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete post-incident review report.&quot;&quot;&quot;</span>
    <span class="c1"># Metadata</span>
    <span class="n">incident_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CLOSED&quot;</span>
    <span class="n">report_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">report_author</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Timeline</span>
    <span class="n">detected_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">contained_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">eradicated_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">recovered_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">closed_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Details</span>
    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">root_cause</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">impact</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">affected_systems</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">affected_users</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">data_compromised</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Analysis</span>
    <span class="n">attack_vector</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">attacker_info</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">timeline</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TimelineEvent</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Lessons</span>
    <span class="n">what_went_well</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">what_went_wrong</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">action_items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ActionItem</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Metrics</span>
    <span class="n">time_to_detect</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>       <span class="c1"># Time from compromise to detection</span>
    <span class="n">time_to_contain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>      <span class="c1"># Time from detection to containment</span>
    <span class="n">time_to_recover</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>      <span class="c1"># Time from containment to recovery</span>
    <span class="n">total_duration</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>       <span class="c1"># Total incident duration</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_date</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a Markdown report.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Incident Report: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">incident_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**Title**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Severity**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">severity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Status**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Report Date**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">report_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Author**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">report_author</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Executive Summary</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Executive Summary</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>

        <span class="c1"># Impact</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Impact</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">impact</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">affected_systems</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**Affected Systems**: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">affected_systems</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Affected Users**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">affected_users</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_compromised</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Data Compromised**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_compromised</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Timeline</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Timeline</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| Time | Event | Actor |&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|------|-------|-------|&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeline</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">actor</span><span class="si">}</span><span class="s2"> |&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Key Metrics</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Key Metrics</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **Time to Detect**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_to_detect</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **Time to Contain**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_to_contain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **Time to Recover**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_to_recover</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **Total Duration**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_duration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Root Cause</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Root Cause Analysis</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_cause</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**Attack Vector**: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">attack_vector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Lessons Learned</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Lessons Learned</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;### What Went Well</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">what_went_well</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### What Needs Improvement</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">what_went_wrong</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Action Items</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Action Items</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;| # | Action | Owner | Due Date | Priority | Status |&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|---|--------|-------|----------|----------|--------|&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_items</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">owner</span><span class="si">}</span><span class="s2"> | &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">due_date</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> |&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="c1"># â”€â”€â”€ Example Usage â”€â”€â”€</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_sample_report</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">IncidentReport</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a sample incident report for demonstration.&quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">IncidentReport</span><span class="p">(</span>
        <span class="n">incident_id</span><span class="o">=</span><span class="s2">&quot;IR-2025-0042&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Unauthorized Access via Compromised API Key&quot;</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="s2">&quot;P2 - High&quot;</span><span class="p">,</span>
        <span class="n">report_author</span><span class="o">=</span><span class="s2">&quot;Security Team&quot;</span><span class="p">,</span>
        <span class="n">summary</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;On January 15, 2025, an unauthorized party accessed our &quot;</span>
            <span class="s2">&quot;production API using a compromised API key. The key was &quot;</span>
            <span class="s2">&quot;inadvertently committed to a public GitHub repository. &quot;</span>
            <span class="s2">&quot;The attacker accessed customer order data for approximately &quot;</span>
            <span class="s2">&quot;2 hours before detection.&quot;</span>
        <span class="p">),</span>
        <span class="n">root_cause</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A developer committed an API key to a public GitHub &quot;</span>
            <span class="s2">&quot;repository on January 10. The key was scraped by an &quot;</span>
            <span class="s2">&quot;automated bot and used to access the production API &quot;</span>
            <span class="s2">&quot;on January 15. Pre-commit hooks for secret detection &quot;</span>
            <span class="s2">&quot;were not configured on the developer&#39;s machine.&quot;</span>
        <span class="p">),</span>
        <span class="n">impact</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Customer order data (names, addresses, order history) &quot;</span>
            <span class="s2">&quot;for approximately 1,200 customers was potentially accessed. &quot;</span>
            <span class="s2">&quot;No payment card data was exposed (stored separately). &quot;</span>
            <span class="s2">&quot;No evidence of data modification.&quot;</span>
        <span class="p">),</span>
        <span class="n">attack_vector</span><span class="o">=</span><span class="s2">&quot;Compromised API key from public Git repository&quot;</span><span class="p">,</span>
        <span class="n">affected_systems</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;api-prod-01&quot;</span><span class="p">,</span> <span class="s2">&quot;api-prod-02&quot;</span><span class="p">,</span> <span class="s2">&quot;orders-db&quot;</span><span class="p">],</span>
        <span class="n">affected_users</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
        <span class="n">data_compromised</span><span class="o">=</span><span class="s2">&quot;Customer names, addresses, order history&quot;</span><span class="p">,</span>
        <span class="n">detected_at</span><span class="o">=</span><span class="s2">&quot;2025-01-15 14:30 UTC&quot;</span><span class="p">,</span>
        <span class="n">contained_at</span><span class="o">=</span><span class="s2">&quot;2025-01-15 14:45 UTC&quot;</span><span class="p">,</span>
        <span class="n">eradicated_at</span><span class="o">=</span><span class="s2">&quot;2025-01-15 16:00 UTC&quot;</span><span class="p">,</span>
        <span class="n">recovered_at</span><span class="o">=</span><span class="s2">&quot;2025-01-15 18:00 UTC&quot;</span><span class="p">,</span>
        <span class="n">closed_at</span><span class="o">=</span><span class="s2">&quot;2025-01-20 09:00 UTC&quot;</span><span class="p">,</span>
        <span class="n">time_to_detect</span><span class="o">=</span><span class="s2">&quot;5 days (from key commit to detection)&quot;</span><span class="p">,</span>
        <span class="n">time_to_contain</span><span class="o">=</span><span class="s2">&quot;15 minutes&quot;</span><span class="p">,</span>
        <span class="n">time_to_recover</span><span class="o">=</span><span class="s2">&quot;3.5 hours&quot;</span><span class="p">,</span>
        <span class="n">total_duration</span><span class="o">=</span><span class="s2">&quot;5 days&quot;</span><span class="p">,</span>
        <span class="n">timeline</span><span class="o">=</span><span class="p">[</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-10 09:15&quot;</span><span class="p">,</span> <span class="s2">&quot;API key committed to public repo&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Developer A&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 12:30&quot;</span><span class="p">,</span> <span class="s2">&quot;First unauthorized API access&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Unknown attacker&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 14:30&quot;</span><span class="p">,</span> <span class="s2">&quot;Anomalous API usage alert triggered&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SIEM&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 14:35&quot;</span><span class="p">,</span> <span class="s2">&quot;SOC analyst confirms unauthorized access&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Analyst B&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 14:45&quot;</span><span class="p">,</span> <span class="s2">&quot;API key revoked, attacker blocked&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Analyst B&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 15:00&quot;</span><span class="p">,</span> <span class="s2">&quot;Incident manager notified, IR activated&quot;</span><span class="p">,</span>
                <span class="s2">&quot;IR Lead C&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 16:00&quot;</span><span class="p">,</span> <span class="s2">&quot;All exposed API keys rotated&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DevOps Team&quot;</span>
            <span class="p">),</span>
            <span class="n">TimelineEvent</span><span class="p">(</span>
                <span class="s2">&quot;2025-01-15 18:00&quot;</span><span class="p">,</span> <span class="s2">&quot;Monitoring confirms no further access&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SOC Team&quot;</span>
            <span class="p">),</span>
        <span class="p">],</span>
        <span class="n">what_went_well</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;SIEM alert fired quickly once anomalous pattern detected&quot;</span><span class="p">,</span>
            <span class="s2">&quot;API key revocation was fast (15 min from alert to containment)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IR team followed playbook effectively&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Good communication between SOC and development teams&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">what_went_wrong</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;API key was in public repo for 5 days before detection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;No automated secret scanning on GitHub repositories&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Pre-commit hooks not enforced across all developer machines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;API key had overly broad permissions (read all orders)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;No IP-based access restrictions on API keys&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">action_items</span><span class="o">=</span><span class="p">[</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;Deploy Gitleaks on all repositories&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DevOps Team&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-02-01&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;Enforce pre-commit hooks with detect-secrets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Dev Lead&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-02-15&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;Implement API key scope restrictions (least privilege)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;API Team&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-03-01&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;Add IP allowlisting for production API keys&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Infrastructure&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-03-01&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;Conduct developer security training (secrets management)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Security Team&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-02-28&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span>
            <span class="p">),</span>
            <span class="n">ActionItem</span><span class="p">(</span>
                <span class="s2">&quot;Implement automated key rotation (90-day max)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DevOps Team&quot;</span><span class="p">,</span> <span class="s2">&quot;2025-04-01&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">report</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">create_sample_report</span><span class="p">()</span>
    <span class="n">markdown</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">generate_markdown</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>

    <span class="c1"># Save to file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;incident_report_IR-2025-0042.md&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Report saved to: incident_report_IR-2025-0042.md&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="10-exercises">10. Exercises<a class="header-link" href="#10-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-log-analysis">Exercise 1: Log Analysis<a class="header-link" href="#exercise-1-log-analysis" title="Permanent link">&para;</a></h3>
<p>Given the following sample log entries, identify all security incidents:</p>
<div class="highlight"><pre><span></span><code>192.168.1.50<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:00:01<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/login<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>1234
192.168.1.50<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:00:02<span class="w"> </span>+0000]<span class="w"> </span>&quot;POST<span class="w"> </span>/login<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>401<span class="w"> </span>89
192.168.1.50<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:00:03<span class="w"> </span>+0000]<span class="w"> </span>&quot;POST<span class="w"> </span>/login<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>401<span class="w"> </span>89
192.168.1.50<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:00:04<span class="w"> </span>+0000]<span class="w"> </span>&quot;POST<span class="w"> </span>/login<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>401<span class="w"> </span>89
10.0.0.5<span class="w"> </span>-<span class="w"> </span>admin<span class="w"> </span>[15/Jan/2025:10:05:00<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/admin/users<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>5678
10.0.0.5<span class="w"> </span>-<span class="w"> </span>admin<span class="w"> </span>[15/Jan/2025:10:05:01<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/admin/export?table=users<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>890123
10.0.0.5<span class="w"> </span>-<span class="w"> </span>admin<span class="w"> </span>[15/Jan/2025:10:05:02<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/admin/export?table=payments<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>1234567
203.0.113.10<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:10:00<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/../../etc/passwd<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>403<span class="w"> </span>0
203.0.113.10<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:10:01<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/search?q=&#39;<span class="w"> </span>OR<span class="w"> </span>1=1<span class="w"> </span>--<span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>500<span class="w"> </span>0
203.0.113.10<span class="w"> </span>-<span class="w"> </span>-<span class="w"> </span>[15/Jan/2025:10:10:02<span class="w"> </span>+0000]<span class="w"> </span>&quot;GET<span class="w"> </span>/search?q=<span class="nt">&lt;script&gt;</span>alert(1)<span class="nt">&lt;/script&gt;</span><span class="w"> </span>HTTP/1.1&quot;<span class="w"> </span>200<span class="w"> </span>456
</code></pre></div>

<p><strong>Tasks:</strong>
1. Classify each suspicious pattern (brute force, traversal, SQLi, XSS, data exfiltration)
2. Determine the severity of each finding
3. Write a brief incident summary for each</p>
<h3 id="exercise-2-ioc-database">Exercise 2: IOC Database<a class="header-link" href="#exercise-2-ioc-database" title="Permanent link">&para;</a></h3>
<p>Create a JSON file with at least 20 IOCs covering:
- 5 malicious IP addresses
- 5 malicious domains
- 5 malware file hashes
- 5 suspicious filenames</p>
<p>Run the IOC scanner against a test directory you create with some matching items.</p>
<h3 id="exercise-3-incident-response-playbook">Exercise 3: Incident Response Playbook<a class="header-link" href="#exercise-3-incident-response-playbook" title="Permanent link">&para;</a></h3>
<p>Write a complete incident response playbook for a <strong>SQL injection attack</strong> that:
1. Defines trigger conditions (what alerts indicate SQLi)
2. Covers all four NIST phases
3. Includes specific commands/tools to use at each step
4. Defines communication and escalation procedures
5. Includes a post-incident checklist</p>
<h3 id="exercise-4-memory-forensics-analysis">Exercise 4: Memory Forensics Analysis<a class="header-link" href="#exercise-4-memory-forensics-analysis" title="Permanent link">&para;</a></h3>
<p>Research Volatility 3 and write a step-by-step guide for analyzing a memory dump to:
1. List all running processes and identify suspicious ones
2. Find active network connections
3. Extract command line arguments for each process
4. Identify injected DLLs or code
5. Recover encryption keys or passwords from memory</p>
<h3 id="exercise-5-post-incident-report">Exercise 5: Post-Incident Report<a class="header-link" href="#exercise-5-post-incident-report" title="Permanent link">&para;</a></h3>
<p>Using the <code>IncidentReport</code> class from this lesson, create a complete post-incident report for the following scenario:</p>
<blockquote>
<p>Your company's web application was defaced at 3 AM on a Sunday. The attacker exploited a known CVE in an unpatched WordPress plugin. They replaced the homepage with a political message. Your monitoring system detected the change at 3:15 AM. The on-call engineer restored from backup at 4:00 AM. Investigation revealed the attacker also created a backdoor admin account.</p>
</blockquote>
<h3 id="exercise-6-pcap-analysis">Exercise 6: PCAP Analysis<a class="header-link" href="#exercise-6-pcap-analysis" title="Permanent link">&para;</a></h3>
<p>Download a sample PCAP file from a CTF or security training resource (e.g., malware-traffic-analysis.net). Analyze it using the tools from this lesson and write a network forensics report covering:
1. Top talkers (most active IP addresses)
2. DNS queries (especially suspicious ones)
3. HTTP requests (look for malware downloads, C2 communications)
4. Any indicators of data exfiltration</p>
<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">           </span><span class="n">Incident</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="n">Takeaways</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">Preparation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">everything</span><span class="p">:</span><span class="w"> </span><span class="n">Have</span><span class="w"> </span><span class="n">plans</span><span class="p">,</span><span class="w"> </span><span class="n">tools</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">trained</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">people</span><span class="w"> </span><span class="n">BEFORE</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">incident</span><span class="w"> </span><span class="n">occurs</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">Follow</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NIST</span><span class="w"> </span><span class="n">lifecycle</span><span class="p">:</span><span class="w"> </span><span class="n">Preparation</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Detection</span><span class="w"> </span><span class="err">â†’</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">Containment</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Eradication</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Recovery</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">Lessons</span><span class="w"> </span><span class="n">Learned</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Preserve</span><span class="w"> </span><span class="n">evidence</span><span class="p">:</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">everything</span><span class="p">,</span><span class="w"> </span><span class="n">maintain</span><span class="w"> </span><span class="n">chain</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">of</span><span class="w"> </span><span class="n">custody</span><span class="p">,</span><span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">evidence</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">copies</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="n">Centralize</span><span class="w"> </span><span class="n">logging</span><span class="p">:</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">investigate</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">did</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nb">log</span><span class="o">.</span><span class="w"> </span><span class="n">Invest</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">infrastructure</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">5.</span><span class="w"> </span><span class="n">Automate</span><span class="w"> </span><span class="n">detection</span><span class="p">:</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">SIEM</span><span class="w"> </span><span class="n">correlation</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="ow">and</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">IOC</span><span class="w"> </span><span class="n">scanning</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="n">time</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">6.</span><span class="w"> </span><span class="n">Practice</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">playbooks</span><span class="p">:</span><span class="w"> </span><span class="n">Written</span><span class="p">,</span><span class="w"> </span><span class="n">tested</span><span class="w"> </span><span class="n">playbooks</span><span class="w"> </span><span class="n">reduce</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">response</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">ensure</span><span class="w"> </span><span class="n">consistency</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">7.</span><span class="w"> </span><span class="n">Learn</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">incidents</span><span class="p">:</span><span class="w"> </span><span class="n">Post</span><span class="o">-</span><span class="n">incident</span><span class="w"> </span><span class="n">reviews</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">most</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">valuable</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">improvements</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">8.</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">matters</span><span class="p">:</span><span class="w"> </span><span class="n">Minutes</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">incidents</span><span class="o">.</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">Mean</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Detect</span><span class="w"> </span><span class="p">(</span><span class="n">MTTD</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">Mean</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Respond</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="p">(</span><span class="n">MTTR</span><span class="p">)</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">metrics</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<p><strong>Previous</strong>: <a href="13_Security_Testing.md">13. Security Testing</a> | <strong>Next</strong>: <a href="15_Project_Secure_API.md">15. Project: Building a Secure REST API</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/13_Security_Testing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Security Testing</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Security/15_Project_Secure_API.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Project: Building a Secure REST API</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}