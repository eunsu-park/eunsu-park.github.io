{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project: Building a Vulnerability Scanner - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Security/">Security</a>
    <span class="separator">/</span>
    <span class="current">Project: Building a Vulnerability Scanner</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Project: Building a Vulnerability Scanner</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/15_Project_Secure_API.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Project: Building a Secure REST API</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#1-project-overview">1. Project Overview</a><ul>
<li><a href="#11-scanner-architecture">1.1 Scanner Architecture</a></li>
<li><a href="#12-project-structure">1.2 Project Structure</a></li>
<li><a href="#13-dependencies">1.3 Dependencies</a></li>
</ul>
</li>
<li><a href="#2-ethical-considerations-and-legal-boundaries">2. Ethical Considerations and Legal Boundaries</a><ul>
<li><a href="#21-rules-of-engagement">2.1 Rules of Engagement</a></li>
</ul>
</li>
<li><a href="#3-shared-utilities-and-rate-limiter">3. Shared Utilities and Rate Limiter</a><ul>
<li><a href="#31-core-utilities">3.1 Core Utilities</a></li>
</ul>
</li>
<li><a href="#4-port-scanner-module">4. Port Scanner Module</a><ul>
<li><a href="#41-tcp-port-scanner">4.1 TCP Port Scanner</a></li>
</ul>
</li>
<li><a href="#5-banner-grabber-module">5. Banner Grabber Module</a><ul>
<li><a href="#51-service-banner-detection">5.1 Service Banner Detection</a></li>
</ul>
</li>
<li><a href="#6-http-security-header-checker">6. HTTP Security Header Checker</a><ul>
<li><a href="#61-header-analysis">6.1 Header Analysis</a></li>
</ul>
</li>
<li><a href="#7-ssltls-configuration-analyzer">7. SSL/TLS Configuration Analyzer</a><ul>
<li><a href="#71-ssltls-checker">7.1 SSL/TLS Checker</a></li>
</ul>
</li>
<li><a href="#8-directory-scanner-module">8. Directory Scanner Module</a><ul>
<li><a href="#81-path-discovery">8.1 Path Discovery</a></li>
</ul>
</li>
<li><a href="#9-cve-database-lookup">9. CVE Database Lookup</a><ul>
<li><a href="#91-cve-lookup-module">9.1 CVE Lookup Module</a></li>
</ul>
</li>
<li><a href="#10-report-generation">10. Report Generation</a><ul>
<li><a href="#101-report-engine">10.1 Report Engine</a></li>
</ul>
</li>
<li><a href="#11-scan-controller-orchestrator">11. Scan Controller (Orchestrator)</a><ul>
<li><a href="#111-main-controller">11.1 Main Controller</a></li>
</ul>
</li>
<li><a href="#12-cli-entry-point">12. CLI Entry Point</a><ul>
<li><a href="#121-main-script">12.1 Main Script</a></li>
</ul>
</li>
<li><a href="#13-usage-examples">13. Usage Examples</a><ul>
<li><a href="#131-basic-scan">13.1 Basic Scan</a></li>
<li><a href="#132-full-scan">13.2 Full Scan</a></li>
<li><a href="#133-targeted-scans">13.3 Targeted Scans</a></li>
<li><a href="#134-output-formats">13.4 Output Formats</a></li>
</ul>
</li>
<li><a href="#14-exercises">14. Exercises</a><ul>
<li><a href="#exercise-1-run-the-scanner">Exercise 1: Run the Scanner</a></li>
<li><a href="#exercise-2-add-udp-scanning">Exercise 2: Add UDP Scanning</a></li>
<li><a href="#exercise-3-implement-a-web-crawler">Exercise 3: Implement a Web Crawler</a></li>
<li><a href="#exercise-4-add-authentication-support">Exercise 4: Add Authentication Support</a></li>
<li><a href="#exercise-5-custom-cve-database">Exercise 5: Custom CVE Database</a></li>
<li><a href="#exercise-6-parallel-module-execution">Exercise 6: Parallel Module Execution</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="project-building-a-vulnerability-scanner">Project: Building a Vulnerability Scanner<a class="header-link" href="#project-building-a-vulnerability-scanner" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="15_Project_Secure_API.md">15. Project: Building a Secure REST API</a></p>
<hr />
<p>This project lesson walks through building a comprehensive vulnerability scanner in Python. The scanner performs port scanning, service banner grabbing, HTTP security header checking, SSL/TLS configuration analysis, directory brute forcing, and CVE database lookups. We will build a modular, extensible tool with a CLI interface, structured output, and built-in rate limiting to ensure responsible scanning. This project ties together many concepts from the entire Security topic.</p>
<p><strong>IMPORTANT</strong>: Only scan systems you own or have explicit written permission to test. Unauthorized scanning is illegal in most jurisdictions. This tool is for educational purposes and authorized security assessments only.</p>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Build a modular vulnerability scanner with Python</li>
<li>Implement TCP port scanning with service detection</li>
<li>Analyze HTTP security headers and SSL/TLS configurations</li>
<li>Perform directory and path discovery (educational)</li>
<li>Look up known vulnerabilities in CVE databases</li>
<li>Generate structured scan reports</li>
<li>Apply rate limiting and responsible scanning practices</li>
<li>Understand the ethical and legal boundaries of security scanning</li>
<li>Design a CLI tool with argparse</li>
</ul>
<hr />
<h2 id="1-project-overview">1. Project Overview<a class="header-link" href="#1-project-overview" title="Permanent link">&para;</a></h2>
<h3 id="11-scanner-architecture">1.1 Scanner Architecture<a class="header-link" href="#11-scanner-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Vulnerability Scanner Architecture                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  CLI Interface (argparse)                                        â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  Scan Controller  â”‚  Orchestrates all scan modules           â”‚
â”‚  â”‚  (main.py)        â”‚  Manages rate limiting                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Generates reports                       â”‚
â”‚           â”‚                                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚     â”‚     â”‚         â”‚         â”‚          â”‚                       â”‚
â”‚     â–¼     â–¼         â–¼         â–¼          â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚Port â”‚â”‚Bannerâ”‚â”‚  HTTP  â”‚â”‚ SSL  â”‚â”‚Directory â”‚                â”‚
â”‚  â”‚Scan â”‚â”‚Grab  â”‚â”‚Headers â”‚â”‚/TLS  â”‚â”‚Discovery â”‚                â”‚
â”‚  â”‚     â”‚â”‚      â”‚â”‚Check   â”‚â”‚Check â”‚â”‚          â”‚                â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚
â”‚     â”‚      â”‚        â”‚        â”‚         â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â–¼                                           â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚             â”‚  CVE Lookup    â”‚  Match services to known CVEs    â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â–¼                                           â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚             â”‚ Report Engine  â”‚  JSON, text, HTML output         â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-project-structure">1.2 Project Structure<a class="header-link" href="#12-project-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>vuln_scanner/
â”œâ”€â”€ scanner/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ controller.py       # Scan orchestration
â”‚   â”œâ”€â”€ port_scanner.py     # TCP port scanning
â”‚   â”œâ”€â”€ banner_grabber.py   # Service banner detection
â”‚   â”œâ”€â”€ http_checker.py     # HTTP security header analysis
â”‚   â”œâ”€â”€ ssl_checker.py      # SSL/TLS configuration analysis
â”‚   â”œâ”€â”€ dir_scanner.py      # Directory/path discovery
â”‚   â”œâ”€â”€ cve_lookup.py       # CVE database queries
â”‚   â”œâ”€â”€ report.py           # Report generation
â”‚   â””â”€â”€ utils.py            # Shared utilities, rate limiter
â”œâ”€â”€ wordlists/
â”‚   â””â”€â”€ common_paths.txt    # Directory wordlist (small, for demo)
â”œâ”€â”€ main.py                 # CLI entry point
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
</code></pre></div>

<h3 id="13-dependencies">1.3 Dependencies<a class="header-link" href="#13-dependencies" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code># requirements.txt
requests==2.31.0
cryptography==42.0.4
</code></pre></div>

<hr />
<h2 id="2-ethical-considerations-and-legal-boundaries">2. Ethical Considerations and Legal Boundaries<a class="header-link" href="#2-ethical-considerations-and-legal-boundaries" title="Permanent link">&para;</a></h2>
<h3 id="21-rules-of-engagement">2.1 Rules of Engagement<a class="header-link" href="#21-rules-of-engagement" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">          </span><span class="n">ETHICAL</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">LEGAL</span><span class="w"> </span><span class="n">BOUNDARIES</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">YOU</span><span class="w"> </span><span class="n">MUST</span><span class="p">:</span><span class="w">                                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ“</span><span class="w"> </span><span class="n">Only</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">systems</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">OWN</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">WRITTEN</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ“</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="n">explicit</span><span class="p">,</span><span class="w"> </span><span class="n">documented</span><span class="w"> </span><span class="n">authorization</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">scanning</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ“</span><span class="w"> </span><span class="n">Define</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">clearly</span><span class="w"> </span><span class="p">(</span><span class="n">which</span><span class="w"> </span><span class="n">IPs</span><span class="p">,</span><span class="w"> </span><span class="n">ports</span><span class="p">,</span><span class="w"> </span><span class="n">tests</span><span class="p">)</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ“</span><span class="w"> </span><span class="n">Respect</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="n">limits</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">bandwidth</span><span class="w"> </span><span class="n">constraints</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ“</span><span class="w"> </span><span class="n">Report</span><span class="w"> </span><span class="n">findings</span><span class="w"> </span><span class="n">responsibly</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">owner</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ“</span><span class="w"> </span><span class="n">Stop</span><span class="w"> </span><span class="n">immediately</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">discover</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">scanning</span><span class="w"> </span><span class="n">the</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="n">wrong</span><span class="w"> </span><span class="n">target</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ“</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">findings</span><span class="w"> </span><span class="n">confidential</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">YOU</span><span class="w"> </span><span class="n">MUST</span><span class="w"> </span><span class="n">NOT</span><span class="p">:</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ—</span><span class="w"> </span><span class="n">Scan</span><span class="w"> </span><span class="n">systems</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">authorization</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ—</span><span class="w"> </span><span class="n">Exploit</span><span class="w"> </span><span class="n">discovered</span><span class="w"> </span><span class="n">vulnerabilities</span><span class="w"> </span><span class="p">(</span><span class="n">scan</span><span class="p">,</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t attack)      â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ—</span><span class="w"> </span><span class="n">Perform</span><span class="w"> </span><span class="n">denial</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="p">(</span><span class="n">even</span><span class="w"> </span><span class="n">accidentally</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">volume</span><span class="p">)</span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ—</span><span class="w"> </span><span class="n">Access</span><span class="p">,</span><span class="w"> </span><span class="n">modify</span><span class="p">,</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">exfiltrate</span><span class="w"> </span><span class="n">data</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ—</span><span class="w"> </span><span class="n">Share</span><span class="w"> </span><span class="n">findings</span><span class="w"> </span><span class="n">publicly</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">owner</span><span class="s1">&#39;s consent              â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">âœ—</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">tool</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">competitive</span><span class="w"> </span><span class="n">intelligence</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">harassment</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">LEGAL</span><span class="w"> </span><span class="n">NOTES</span><span class="p">:</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Computer</span><span class="w"> </span><span class="n">Fraud</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">Abuse</span><span class="w"> </span><span class="n">Act</span><span class="w"> </span><span class="p">(</span><span class="n">CFAA</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">USA</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Computer</span><span class="w"> </span><span class="n">Misuse</span><span class="w"> </span><span class="n">Act</span><span class="w"> </span><span class="mi">1990</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">UK</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">StGB</span><span class="w"> </span><span class="err">Â§</span><span class="mi">202</span><span class="n">a</span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Germany</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Similar</span><span class="w"> </span><span class="n">laws</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">virtually</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">country</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Unauthorized</span><span class="w"> </span><span class="n">scanning</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">criminal</span><span class="w"> </span><span class="n">charges</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;I was just testing&quot;</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">legal</span><span class="w"> </span><span class="n">defense</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">SAFE</span><span class="w"> </span><span class="n">TARGETS</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">PRACTICE</span><span class="p">:</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Your</span><span class="w"> </span><span class="n">own</span><span class="w"> </span><span class="n">machines</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">VMs</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Intentionally</span><span class="w"> </span><span class="n">vulnerable</span><span class="w"> </span><span class="n">apps</span><span class="p">:</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="n">DVWA</span><span class="w"> </span><span class="p">(</span><span class="n">Damn</span><span class="w"> </span><span class="n">Vulnerable</span><span class="w"> </span><span class="n">Web</span><span class="w"> </span><span class="n">Application</span><span class="p">)</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="n">HackTheBox</span><span class="p">,</span><span class="w"> </span><span class="n">TryHackMe</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">permission</span><span class="p">)</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="n">OWASP</span><span class="w"> </span><span class="n">WebGoat</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="o">*</span><span class="w"> </span><span class="n">Metasploitable</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Bug</span><span class="w"> </span><span class="n">bounty</span><span class="w"> </span><span class="n">programs</span><span class="w"> </span><span class="p">(</span><span class="n">within</span><span class="w"> </span><span class="n">scope</span><span class="p">)</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="3-shared-utilities-and-rate-limiter">3. Shared Utilities and Rate Limiter<a class="header-link" href="#3-shared-utilities-and-rate-limiter" title="Permanent link">&para;</a></h2>
<h3 id="31-core-utilities">3.1 Core Utilities<a class="header-link" href="#31-core-utilities" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/utils.py - Shared utilities, rate limiter, and data models.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Severity</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vulnerability severity levels.&quot;&quot;&quot;</span>
    <span class="n">CRITICAL</span> <span class="o">=</span> <span class="s2">&quot;CRITICAL&quot;</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="s2">&quot;HIGH&quot;</span>
    <span class="n">MEDIUM</span> <span class="o">=</span> <span class="s2">&quot;MEDIUM&quot;</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="s2">&quot;LOW&quot;</span>
    <span class="n">INFO</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Finding</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A single vulnerability or information finding.&quot;&quot;&quot;</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">severity</span><span class="p">:</span> <span class="n">Severity</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">module</span><span class="p">:</span> <span class="nb">str</span>            <span class="c1"># Which scanner module found this</span>
    <span class="n">details</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">remediation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">reference</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>    <span class="c1"># URL or CVE reference</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PortInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Information about a discovered port.&quot;&quot;&quot;</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">str</span>             <span class="c1"># open, closed, filtered</span>
    <span class="n">service</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>      <span class="c1"># Detected service name</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>      <span class="c1"># Service version</span>
    <span class="n">banner</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>       <span class="c1"># Raw banner text</span>
    <span class="n">protocol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tcp&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ScanTarget</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan target specification.&quot;&quot;&quot;</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ports</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve hostname to IP address.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ScanResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete scan result for a target.&quot;&quot;&quot;</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">ScanTarget</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">duration_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">open_ports</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PortInfo</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">findings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RateLimiter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thread-safe rate limiter using token bucket algorithm.</span>
<span class="sd">    Ensures we don&#39;t overwhelm the target with requests.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests_per_second</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            requests_per_second: Maximum requests per second.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">requests_per_second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="n">requests_per_second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span> <span class="o">=</span> <span class="n">requests_per_second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Block until a token is available.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
                <span class="n">elapsed</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">now</span>

                <span class="c1"># Add tokens based on elapsed time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">+</span> <span class="n">elapsed</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">-=</span> <span class="mf">1.0</span>
                    <span class="k">return</span>

            <span class="c1"># No tokens available, wait a bit</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests_per_second</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the rate limit.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">requests_per_second</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_tokens</span> <span class="o">=</span> <span class="n">requests_per_second</span>


<span class="k">def</span><span class="w"> </span><span class="nf">is_valid_target</span><span class="p">(</span><span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that a target is potentially valid and not a</span>
<span class="sd">    reserved/dangerous address.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Block scanning of localhost (unless explicitly intended)</span>
    <span class="n">dangerous_hosts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;::1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">host</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">dangerous_hosts</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Block private IP ranges (comment out for internal scanning)</span>
    <span class="c1"># This is a safety measure for educational use</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">first_octet</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">second_octet</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># 10.0.0.0/8</span>
            <span class="k">if</span> <span class="n">first_octet</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] Warning: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">) is a private address&quot;</span><span class="p">)</span>

            <span class="c1"># 172.16.0.0/12</span>
            <span class="k">if</span> <span class="n">first_octet</span> <span class="o">==</span> <span class="mi">172</span> <span class="ow">and</span> <span class="mi">16</span> <span class="o">&lt;=</span> <span class="n">second_octet</span> <span class="o">&lt;=</span> <span class="mi">31</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] Warning: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">) is a private address&quot;</span><span class="p">)</span>

            <span class="c1"># 192.168.0.0/16</span>
            <span class="k">if</span> <span class="n">first_octet</span> <span class="o">==</span> <span class="mi">192</span> <span class="ow">and</span> <span class="n">second_octet</span> <span class="o">==</span> <span class="mi">168</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] Warning: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">) is a private address&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="kc">True</span>


<span class="c1"># Common port list (top 100 most common)</span>
<span class="n">COMMON_PORTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span>
    <span class="mi">110</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span>
    <span class="mi">161</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">389</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span> <span class="mi">445</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="mi">514</span><span class="p">,</span>
    <span class="mi">515</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">521</span><span class="p">,</span> <span class="mi">587</span><span class="p">,</span> <span class="mi">631</span><span class="p">,</span> <span class="mi">636</span><span class="p">,</span> <span class="mi">873</span><span class="p">,</span> <span class="mi">993</span><span class="p">,</span> <span class="mi">995</span><span class="p">,</span>
    <span class="mi">1080</span><span class="p">,</span> <span class="mi">1194</span><span class="p">,</span> <span class="mi">1433</span><span class="p">,</span> <span class="mi">1434</span><span class="p">,</span> <span class="mi">1521</span><span class="p">,</span> <span class="mi">1723</span><span class="p">,</span> <span class="mi">2049</span><span class="p">,</span> <span class="mi">2082</span><span class="p">,</span>
    <span class="mi">2083</span><span class="p">,</span> <span class="mi">2086</span><span class="p">,</span> <span class="mi">2087</span><span class="p">,</span> <span class="mi">2096</span><span class="p">,</span> <span class="mi">2100</span><span class="p">,</span> <span class="mi">3128</span><span class="p">,</span> <span class="mi">3306</span><span class="p">,</span> <span class="mi">3389</span><span class="p">,</span>
    <span class="mi">5060</span><span class="p">,</span> <span class="mi">5432</span><span class="p">,</span> <span class="mi">5900</span><span class="p">,</span> <span class="mi">5901</span><span class="p">,</span> <span class="mi">6379</span><span class="p">,</span> <span class="mi">6667</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="mi">8008</span><span class="p">,</span>
    <span class="mi">8080</span><span class="p">,</span> <span class="mi">8443</span><span class="p">,</span> <span class="mi">8888</span><span class="p">,</span> <span class="mi">9090</span><span class="p">,</span> <span class="mi">9200</span><span class="p">,</span> <span class="mi">9300</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">11211</span><span class="p">,</span>
    <span class="mi">27017</span><span class="p">,</span> <span class="mi">27018</span><span class="p">,</span> <span class="mi">28017</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Well-known service names</span>
<span class="n">SERVICE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">20</span><span class="p">:</span> <span class="s2">&quot;ftp-data&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">:</span> <span class="s2">&quot;ftp&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">:</span> <span class="s2">&quot;ssh&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">:</span> <span class="s2">&quot;telnet&quot;</span><span class="p">,</span>
    <span class="mi">25</span><span class="p">:</span> <span class="s2">&quot;smtp&quot;</span><span class="p">,</span> <span class="mi">53</span><span class="p">:</span> <span class="s2">&quot;dns&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="mi">110</span><span class="p">:</span> <span class="s2">&quot;pop3&quot;</span><span class="p">,</span>
    <span class="mi">111</span><span class="p">:</span> <span class="s2">&quot;rpcbind&quot;</span><span class="p">,</span> <span class="mi">119</span><span class="p">:</span> <span class="s2">&quot;nntp&quot;</span><span class="p">,</span> <span class="mi">123</span><span class="p">:</span> <span class="s2">&quot;ntp&quot;</span><span class="p">,</span> <span class="mi">135</span><span class="p">:</span> <span class="s2">&quot;msrpc&quot;</span><span class="p">,</span>
    <span class="mi">139</span><span class="p">:</span> <span class="s2">&quot;netbios-ssn&quot;</span><span class="p">,</span> <span class="mi">143</span><span class="p">:</span> <span class="s2">&quot;imap&quot;</span><span class="p">,</span> <span class="mi">161</span><span class="p">:</span> <span class="s2">&quot;snmp&quot;</span><span class="p">,</span> <span class="mi">389</span><span class="p">:</span> <span class="s2">&quot;ldap&quot;</span><span class="p">,</span>
    <span class="mi">443</span><span class="p">:</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="mi">445</span><span class="p">:</span> <span class="s2">&quot;microsoft-ds&quot;</span><span class="p">,</span> <span class="mi">465</span><span class="p">:</span> <span class="s2">&quot;smtps&quot;</span><span class="p">,</span> <span class="mi">514</span><span class="p">:</span> <span class="s2">&quot;syslog&quot;</span><span class="p">,</span>
    <span class="mi">587</span><span class="p">:</span> <span class="s2">&quot;submission&quot;</span><span class="p">,</span> <span class="mi">636</span><span class="p">:</span> <span class="s2">&quot;ldaps&quot;</span><span class="p">,</span> <span class="mi">993</span><span class="p">:</span> <span class="s2">&quot;imaps&quot;</span><span class="p">,</span> <span class="mi">995</span><span class="p">:</span> <span class="s2">&quot;pop3s&quot;</span><span class="p">,</span>
    <span class="mi">1433</span><span class="p">:</span> <span class="s2">&quot;mssql&quot;</span><span class="p">,</span> <span class="mi">1521</span><span class="p">:</span> <span class="s2">&quot;oracle&quot;</span><span class="p">,</span> <span class="mi">3306</span><span class="p">:</span> <span class="s2">&quot;mysql&quot;</span><span class="p">,</span> <span class="mi">3389</span><span class="p">:</span> <span class="s2">&quot;rdp&quot;</span><span class="p">,</span>
    <span class="mi">5432</span><span class="p">:</span> <span class="s2">&quot;postgresql&quot;</span><span class="p">,</span> <span class="mi">5900</span><span class="p">:</span> <span class="s2">&quot;vnc&quot;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">:</span> <span class="s2">&quot;redis&quot;</span><span class="p">,</span>
    <span class="mi">8080</span><span class="p">:</span> <span class="s2">&quot;http-proxy&quot;</span><span class="p">,</span> <span class="mi">8443</span><span class="p">:</span> <span class="s2">&quot;https-alt&quot;</span><span class="p">,</span> <span class="mi">9200</span><span class="p">:</span> <span class="s2">&quot;elasticsearch&quot;</span><span class="p">,</span>
    <span class="mi">11211</span><span class="p">:</span> <span class="s2">&quot;memcached&quot;</span><span class="p">,</span> <span class="mi">27017</span><span class="p">:</span> <span class="s2">&quot;mongodb&quot;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="4-port-scanner-module">4. Port Scanner Module<a class="header-link" href="#4-port-scanner-module" title="Permanent link">&para;</a></h2>
<h3 id="41-tcp-port-scanner">4.1 TCP Port Scanner<a class="header-link" href="#41-tcp-port-scanner" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/port_scanner.py - TCP port scanner module.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">concurrent.futures</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PortInfo</span><span class="p">,</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">ScanTarget</span><span class="p">,</span> <span class="n">Finding</span><span class="p">,</span> <span class="n">Severity</span><span class="p">,</span>
    <span class="n">COMMON_PORTS</span><span class="p">,</span> <span class="n">SERVICE_NAMES</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PortScanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TCP Connect port scanner.</span>

<span class="sd">    This performs a full TCP three-way handshake to determine</span>
<span class="sd">    if a port is open. It is reliable but easily detectable.</span>

<span class="sd">    For educational purposes only. SYN scanning (half-open)</span>
<span class="sd">    requires raw socket privileges and is not implemented here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="n">rate_limiter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RateLimiter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            timeout: Connection timeout in seconds per port.</span>
<span class="sd">            rate_limiter: Rate limiter for responsible scanning.</span>
<span class="sd">            max_workers: Maximum concurrent connection attempts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">rate_limiter</span> <span class="ow">or</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span> <span class="o">=</span> <span class="n">max_workers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PortInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan a single port on the target host.</span>

<span class="sd">        Performs a TCP connect scan (full three-way handshake).</span>

<span class="sd">        Args:</span>
<span class="sd">            host: Target hostname or IP.</span>
<span class="sd">            port: Port number to scan.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PortInfo with the scan result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

        <span class="n">port_info</span> <span class="o">=</span> <span class="n">PortInfo</span><span class="p">(</span>
            <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
            <span class="n">state</span><span class="o">=</span><span class="s2">&quot;closed&quot;</span><span class="p">,</span>
            <span class="n">service</span><span class="o">=</span><span class="n">SERVICE_NAMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">port_info</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span>

                <span class="c1"># Try to get service banner</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Send a generic probe for some services</span>
                    <span class="k">if</span> <span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="mi">8443</span><span class="p">):</span>
                        <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;HEAD / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">Host: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">port</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
                        <span class="k">pass</span>  <span class="c1"># SSH sends banner automatically</span>
                    <span class="k">elif</span> <span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">143</span><span class="p">):</span>
                        <span class="k">pass</span>  <span class="c1"># These services send banners</span>

                    <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">banner</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
                    <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="n">banner</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">port_info</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_version</span><span class="p">(</span><span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">ConnectionResetError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                    <span class="k">pass</span>

            <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
            <span class="n">port_info</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;filtered&quot;</span>
        <span class="k">except</span> <span class="ne">ConnectionRefusedError</span><span class="p">:</span>
            <span class="n">port_info</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;closed&quot;</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">port_info</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span>

        <span class="k">return</span> <span class="n">port_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_ports</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ports</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">PortInfo</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan multiple ports concurrently.</span>

<span class="sd">        Args:</span>
<span class="sd">            host: Target hostname or IP.</span>
<span class="sd">            ports: List of ports to scan. Defaults to common ports.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of PortInfo for open ports.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ports</span> <span class="o">=</span> <span class="n">COMMON_PORTS</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span><span class="si">}</span><span class="s2"> ports on </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="n">open_ports</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># Submit all port scan tasks</span>
            <span class="n">future_to_port</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_port</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span> <span class="n">port</span>
                <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">ports</span>
            <span class="p">}</span>

            <span class="c1"># Collect results</span>
            <span class="n">completed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_port</span><span class="p">):</span>
                <span class="n">completed</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">completed</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Progress: </span><span class="si">{</span><span class="n">completed</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span><span class="si">}</span><span class="s2"> ports scanned&quot;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">port_info</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;open&quot;</span><span class="p">:</span>
                        <span class="n">open_ports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">port_info</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [+] Port </span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2">/tcp  OPEN  &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">service</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="n">future_to_port</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] Error scanning port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">open_ports</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">open_ports</span><span class="p">)</span><span class="si">}</span><span class="s2"> open ports&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">open_ports</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banner</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract service version from banner string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">banner</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Common patterns</span>
        <span class="c1"># SSH: SSH-2.0-OpenSSH_8.9</span>
        <span class="k">if</span> <span class="n">banner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;SSH-&quot;</span><span class="p">):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># HTTP: Server: nginx/1.24.0</span>
        <span class="k">if</span> <span class="s2">&quot;Server:&quot;</span> <span class="ow">in</span> <span class="n">banner</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Server:&quot;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># FTP: 220 vsftpd 3.0.5</span>
        <span class="k">if</span> <span class="n">banner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;220&quot;</span><span class="p">):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>

        <span class="c1"># SMTP: 220 mail.example.com ESMTP Postfix</span>
        <span class="k">if</span> <span class="s2">&quot;ESMTP&quot;</span> <span class="ow">in</span> <span class="n">banner</span> <span class="ow">or</span> <span class="s2">&quot;SMTP&quot;</span> <span class="ow">in</span> <span class="n">banner</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">60</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">banner</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_findings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">open_ports</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PortInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate security findings from open ports.&quot;&quot;&quot;</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Dangerous/insecure services</span>
        <span class="n">dangerous_ports</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">21</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;FTP&quot;</span><span class="p">,</span> <span class="s2">&quot;FTP transmits credentials in plaintext. Use SFTP instead.&quot;</span><span class="p">),</span>
            <span class="mi">23</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Telnet&quot;</span><span class="p">,</span> <span class="s2">&quot;Telnet transmits all data in plaintext. Use SSH instead.&quot;</span><span class="p">),</span>
            <span class="mi">69</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;TFTP&quot;</span><span class="p">,</span> <span class="s2">&quot;TFTP has no authentication. Restrict access.&quot;</span><span class="p">),</span>
            <span class="mi">111</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;RPC&quot;</span><span class="p">,</span> <span class="s2">&quot;RPCbind can leak service information. Restrict to trusted networks.&quot;</span><span class="p">),</span>
            <span class="mi">135</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;MSRPC&quot;</span><span class="p">,</span> <span class="s2">&quot;Microsoft RPC can be exploited for remote code execution.&quot;</span><span class="p">),</span>
            <span class="mi">139</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;NetBIOS&quot;</span><span class="p">,</span> <span class="s2">&quot;NetBIOS can leak system information. Block from external access.&quot;</span><span class="p">),</span>
            <span class="mi">445</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;SMB&quot;</span><span class="p">,</span> <span class="s2">&quot;SMB has been target of major exploits (EternalBlue). Restrict access.&quot;</span><span class="p">),</span>
            <span class="mi">161</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;SNMP&quot;</span><span class="p">,</span> <span class="s2">&quot;SNMP v1/v2c use community strings (plaintext). Use v3 with auth.&quot;</span><span class="p">),</span>
            <span class="mi">1433</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;MSSQL&quot;</span><span class="p">,</span> <span class="s2">&quot;Database port should not be publicly accessible.&quot;</span><span class="p">),</span>
            <span class="mi">3306</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;MySQL&quot;</span><span class="p">,</span> <span class="s2">&quot;Database port should not be publicly accessible.&quot;</span><span class="p">),</span>
            <span class="mi">5432</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;PostgreSQL&quot;</span><span class="p">,</span> <span class="s2">&quot;Database port should not be publicly accessible.&quot;</span><span class="p">),</span>
            <span class="mi">6379</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Redis&quot;</span><span class="p">,</span> <span class="s2">&quot;Redis often has no authentication. Never expose publicly.&quot;</span><span class="p">),</span>
            <span class="mi">11211</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Memcached&quot;</span><span class="p">,</span> <span class="s2">&quot;Memcached has no built-in auth. Used in amplification attacks.&quot;</span><span class="p">),</span>
            <span class="mi">27017</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;MongoDB&quot;</span><span class="p">,</span> <span class="s2">&quot;MongoDB should not be publicly accessible.&quot;</span><span class="p">),</span>
            <span class="mi">5900</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;VNC&quot;</span><span class="p">,</span> <span class="s2">&quot;VNC may use weak authentication. Use VPN for remote access.&quot;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">open_ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span> <span class="ow">in</span> <span class="n">dangerous_ports</span><span class="p">:</span>
                <span class="n">service_name</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="n">dangerous_ports</span><span class="p">[</span><span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="p">]</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Potentially Dangerous Service: </span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span> <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">6379</span><span class="p">,</span> <span class="mi">11211</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
                             <span class="k">else</span> <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;port_scanner&quot;</span><span class="p">,</span>
                    <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                        <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">service</span><span class="p">,</span>
                        <span class="s2">&quot;banner&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span>
                    <span class="p">},</span>
                    <span class="n">remediation</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Restrict port </span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2"> to trusted networks using &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;firewall rules. Consider disabling if not needed.&quot;</span>
                    <span class="p">),</span>
                <span class="p">))</span>

        <span class="c1"># Check for unencrypted HTTP (when HTTPS is also available)</span>
        <span class="n">has_http</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="mi">80</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">open_ports</span><span class="p">)</span>
        <span class="n">has_https</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="mi">443</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">open_ports</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_http</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_https</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;HTTP Without HTTPS&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;HTTP (port 80) is open but HTTPS (port 443) is not detected.&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;port_scanner&quot;</span><span class="p">,</span>
                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Enable HTTPS and redirect HTTP to HTTPS.&quot;</span><span class="p">,</span>
            <span class="p">))</span>
        <span class="k">elif</span> <span class="n">has_http</span> <span class="ow">and</span> <span class="n">has_https</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;HTTP Port Open (Redirect Needed)&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;HTTP (port 80) is open alongside HTTPS. Ensure HTTP redirects to HTTPS.&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;port_scanner&quot;</span><span class="p">,</span>
                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Configure HTTP to HTTPS 301 redirect.&quot;</span><span class="p">,</span>
            <span class="p">))</span>

        <span class="k">return</span> <span class="n">findings</span>
</code></pre></div>

<hr />
<h2 id="5-banner-grabber-module">5. Banner Grabber Module<a class="header-link" href="#5-banner-grabber-module" title="Permanent link">&para;</a></h2>
<h3 id="51-service-banner-detection">5.1 Service Banner Detection<a class="header-link" href="#51-service-banner-detection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/banner_grabber.py - Service banner grabbing and version detection.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">PortInfo</span><span class="p">,</span> <span class="n">Finding</span><span class="p">,</span> <span class="n">Severity</span><span class="p">,</span> <span class="n">RateLimiter</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BannerGrabber</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grabs service banners to identify running software and versions.</span>

<span class="sd">    Service banners often reveal software name, version, and OS,</span>
<span class="sd">    which can be used to identify known vulnerabilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Protocol-specific probes</span>
    <span class="n">PROBES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># HTTP probe</span>
        <span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;HEAD / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">Host: </span><span class="si">{host}</span><span class="se">\r\n</span><span class="s2">User-Agent: SecurityScanner/1.0</span><span class="se">\r\n</span><span class="s2">Accept: */*</span><span class="se">\r\n</span><span class="s2">Connection: close</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="c1"># FTP expects no probe (server sends banner)</span>
        <span class="s2">&quot;ftp&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># SMTP expects no probe</span>
        <span class="s2">&quot;smtp&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># SSH expects no probe</span>
        <span class="s2">&quot;ssh&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># POP3 expects no probe</span>
        <span class="s2">&quot;pop3&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># IMAP expects no probe</span>
        <span class="s2">&quot;imap&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># MySQL probe</span>
        <span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># Redis probe</span>
        <span class="s2">&quot;redis&quot;</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;INFO</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="n">rate_limiter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RateLimiter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">rate_limiter</span> <span class="ow">or</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">grab_banner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port_info</span><span class="p">:</span> <span class="n">PortInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PortInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to grab a service banner from an open port.</span>

<span class="sd">        Updates the port_info with banner and version information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="s2">&quot;open&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">port_info</span>

        <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">:</span>
            <span class="c1"># Already have a banner from port scan</span>
            <span class="k">return</span> <span class="n">port_info</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

        <span class="c1"># Determine the appropriate probe</span>
        <span class="n">service</span> <span class="o">=</span> <span class="n">port_info</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">probe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROBES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Special handling for HTTP</span>
        <span class="k">if</span> <span class="n">service</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;http-proxy&quot;</span><span class="p">):</span>
            <span class="n">probe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROBES</span><span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="si">{host}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Determine if we should use SSL</span>
            <span class="n">use_ssl</span> <span class="o">=</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">443</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="mi">636</span><span class="p">,</span> <span class="mi">993</span><span class="p">,</span> <span class="mi">995</span><span class="p">,</span> <span class="mi">8443</span><span class="p">)</span>

            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">use_ssl</span><span class="p">:</span>
                <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
                <span class="n">context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>
                <span class="n">sock</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_hostname</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>

            <span class="c1"># Send probe if needed</span>
            <span class="k">if</span> <span class="n">probe</span><span class="p">:</span>
                <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">probe</span><span class="p">)</span>

            <span class="c1"># Receive response</span>
            <span class="n">banner</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
            <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="n">banner</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Extract version from banner</span>
            <span class="n">port_info</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_version</span><span class="p">(</span>
                <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">,</span> <span class="n">port_info</span><span class="o">.</span><span class="n">service</span>
            <span class="p">)</span>

            <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">ConnectionRefusedError</span><span class="p">,</span> <span class="ne">ConnectionResetError</span><span class="p">,</span>
                <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">port_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">grab_all_banners</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">open_ports</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PortInfo</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">PortInfo</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Grab banners from all open ports.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Grabbing banners from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">open_ports</span><span class="p">)</span><span class="si">}</span><span class="s2"> open ports...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">open_ports</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grab_banner</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port_info</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">port_info</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="s2">&quot;(no version)&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [+] Port </span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">open_ports</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banner</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse version information from service banner.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">banner</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># SSH</span>
        <span class="k">if</span> <span class="n">service</span> <span class="o">==</span> <span class="s2">&quot;ssh&quot;</span> <span class="ow">or</span> <span class="n">banner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;SSH-&quot;</span><span class="p">):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># HTTP Server header</span>
        <span class="k">if</span> <span class="n">service</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="s2">&quot;http-proxy&quot;</span><span class="p">,</span> <span class="s2">&quot;https-alt&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;server:&quot;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># FTP</span>
        <span class="k">if</span> <span class="n">service</span> <span class="o">==</span> <span class="s2">&quot;ftp&quot;</span> <span class="ow">and</span> <span class="n">banner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;220&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># SMTP</span>
        <span class="k">if</span> <span class="n">service</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;smtp&quot;</span><span class="p">,</span> <span class="s2">&quot;smtps&quot;</span><span class="p">,</span> <span class="s2">&quot;submission&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># MySQL</span>
        <span class="k">if</span> <span class="n">service</span> <span class="o">==</span> <span class="s2">&quot;mysql&quot;</span><span class="p">:</span>
            <span class="c1"># MySQL banner has version in initial handshake packet</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Look for version string pattern (e.g., 8.0.35)</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+\.\d+\.\d+)&#39;</span><span class="p">,</span> <span class="n">banner</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;MySQL </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># Redis</span>
        <span class="k">if</span> <span class="n">service</span> <span class="o">==</span> <span class="s2">&quot;redis&quot;</span> <span class="ow">and</span> <span class="s2">&quot;redis_version:&quot;</span> <span class="ow">in</span> <span class="n">banner</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;redis_version:&quot;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Redis </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Default: first line, truncated</span>
        <span class="k">return</span> <span class="n">banner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">80</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_findings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">open_ports</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PortInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate findings from banner information.&quot;&quot;&quot;</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">open_ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">banner_lower</span> <span class="o">=</span> <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Check for outdated/vulnerable versions</span>
            <span class="n">version_checks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;apache/2.2&quot;</span><span class="p">,</span> <span class="s2">&quot;Apache 2.2 is end-of-life&quot;</span><span class="p">,</span>
                 <span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="s2">&quot;Upgrade to Apache 2.4+&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;apache/2.4.49&quot;</span><span class="p">,</span> <span class="s2">&quot;Apache 2.4.49 has path traversal vulnerability (CVE-2021-41773)&quot;</span><span class="p">,</span>
                 <span class="n">Severity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="s2">&quot;Upgrade to Apache 2.4.51+&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;nginx/1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;Very old nginx version detected&quot;</span><span class="p">,</span>
                 <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="s2">&quot;Upgrade to latest stable nginx&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;openssh_7.&quot;</span><span class="p">,</span> <span class="s2">&quot;OpenSSH 7.x may have known vulnerabilities&quot;</span><span class="p">,</span>
                 <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="s2">&quot;Upgrade to OpenSSH 9.x+&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;openssh_6.&quot;</span><span class="p">,</span> <span class="s2">&quot;OpenSSH 6.x has known vulnerabilities&quot;</span><span class="p">,</span>
                 <span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="s2">&quot;Upgrade to OpenSSH 9.x+&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;mysql 5.5&quot;</span><span class="p">,</span> <span class="s2">&quot;MySQL 5.5 is end-of-life&quot;</span><span class="p">,</span>
                 <span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="s2">&quot;Upgrade to MySQL 8.0+&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;mysql 5.6&quot;</span><span class="p">,</span> <span class="s2">&quot;MySQL 5.6 is end-of-life&quot;</span><span class="p">,</span>
                 <span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="s2">&quot;Upgrade to MySQL 8.0+&quot;</span><span class="p">),</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">severity</span><span class="p">,</span> <span class="n">fix</span> <span class="ow">in</span> <span class="n">version_checks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">banner_lower</span><span class="p">:</span>
                    <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Outdated Software: </span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">version</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">severity</span><span class="o">=</span><span class="n">severity</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                        <span class="n">module</span><span class="o">=</span><span class="s2">&quot;banner_grabber&quot;</span><span class="p">,</span>
                        <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                            <span class="s2">&quot;banner&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span>
                        <span class="p">},</span>
                        <span class="n">remediation</span><span class="o">=</span><span class="n">fix</span><span class="p">,</span>
                    <span class="p">))</span>

            <span class="c1"># Check for verbose banners (information disclosure)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">banner_lower</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span>
                   <span class="p">[</span><span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span> <span class="s1">&#39;red hat&#39;</span><span class="p">,</span> <span class="s1">&#39;windows&#39;</span><span class="p">]):</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;OS Information Disclosure&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Service banner reveals operating system information: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">),</span>
                    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;banner_grabber&quot;</span><span class="p">,</span>
                    <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="s2">&quot;banner&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span><span class="p">[:</span><span class="mi">200</span><span class="p">]},</span>
                    <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Configure service to hide OS details from banner.&quot;</span><span class="p">,</span>
                <span class="p">))</span>

        <span class="k">return</span> <span class="n">findings</span>
</code></pre></div>

<hr />
<h2 id="6-http-security-header-checker">6. HTTP Security Header Checker<a class="header-link" href="#6-http-security-header-checker" title="Permanent link">&para;</a></h2>
<h3 id="61-header-analysis">6.1 Header Analysis<a class="header-link" href="#61-header-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/http_checker.py - HTTP security header analysis.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Finding</span><span class="p">,</span> <span class="n">Severity</span><span class="p">,</span> <span class="n">RateLimiter</span>


<span class="k">class</span><span class="w"> </span><span class="nc">HTTPChecker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks HTTP security headers and common web misconfigurations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Required security headers and their expected values</span>
    <span class="n">SECURITY_HEADERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Strict-Transport-Security&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;HTTP Strict Transport Security (HSTS)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Add: Strict-Transport-Security: max-age=31536000; includeSubDomains&quot;</span><span class="p">,</span>
            <span class="s2">&quot;check_value&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="s2">&quot;max-age=&quot;</span> <span class="ow">in</span> <span class="n">v</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;max-age=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">31536000</span> <span class="k">if</span> <span class="s2">&quot;max-age=&quot;</span> <span class="ow">in</span> <span class="n">v</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Content-Security-Policy&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Content Security Policy (CSP)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Add a Content-Security-Policy header. Start with: default-src &#39;self&#39;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;check_value&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="s2">&quot;default-src&quot;</span> <span class="ow">in</span> <span class="n">v</span> <span class="ow">or</span> <span class="s2">&quot;script-src&quot;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;X-Content-Type-Options&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;MIME type sniffing prevention&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Add: X-Content-Type-Options: nosniff&quot;</span><span class="p">,</span>
            <span class="s2">&quot;check_value&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;nosniff&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;X-Frame-Options&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Clickjacking protection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Add: X-Frame-Options: DENY (or SAMEORIGIN)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;check_value&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DENY&quot;</span><span class="p">,</span> <span class="s2">&quot;SAMEORIGIN&quot;</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">&quot;Referrer-Policy&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Referrer information control&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Add: Referrer-Policy: strict-origin-when-cross-origin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;check_value&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;no-referrer&quot;</span><span class="p">,</span> <span class="s2">&quot;strict-origin&quot;</span><span class="p">,</span>
                <span class="s2">&quot;strict-origin-when-cross-origin&quot;</span><span class="p">,</span> <span class="s2">&quot;same-origin&quot;</span>
            <span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">&quot;Permissions-Policy&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Browser feature restrictions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Add: Permissions-Policy: camera=(), microphone=(), geolocation=()&quot;</span><span class="p">,</span>
            <span class="s2">&quot;check_value&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="c1"># Headers that should NOT be present (information disclosure)</span>
    <span class="n">BAD_HEADERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;X-Powered-By&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Reveals server technology&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Remove X-Powered-By header to reduce information disclosure.&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Server&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;May reveal server software and version&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Configure server to send minimal Server header.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;check_value&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">keyword</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;apache&quot;</span><span class="p">,</span> <span class="s2">&quot;nginx&quot;</span><span class="p">,</span> <span class="s2">&quot;iis&quot;</span><span class="p">,</span> <span class="s2">&quot;tomcat&quot;</span><span class="p">,</span> <span class="s2">&quot;express&quot;</span><span class="p">]</span>
            <span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">&quot;X-AspNet-Version&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Reveals ASP.NET version&quot;</span><span class="p">,</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
            <span class="s2">&quot;recommendation&quot;</span><span class="p">:</span> <span class="s2">&quot;Remove X-AspNet-Version header.&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">rate_limiter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RateLimiter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">rate_limiter</span> <span class="ow">or</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check HTTP security headers for a URL.</span>

<span class="sd">        Args:</span>
<span class="sd">            url: Target URL (http:// or https://).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of findings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Checking HTTP security headers for </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">,</span>
                <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;SecurityScanner/1.0 (Authorized Security Scan)&quot;</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;SSL/TLS Error&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SSL error connecting to </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Fix SSL/TLS configuration. Ensure valid certificate.&quot;</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">findings</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Connection Error&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Could not connect to </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">findings</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Connection Timeout&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Connection to </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> timed out after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">findings</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>

        <span class="c1"># Check for missing security headers</span>
        <span class="k">for</span> <span class="n">header_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SECURITY_HEADERS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">header_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Missing Security Header: </span><span class="si">{</span><span class="n">header_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;severity&quot;</span><span class="p">],</span>
                    <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> header is not set.&quot;</span><span class="p">,</span>
                    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
                    <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="n">header_name</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">},</span>
                    <span class="n">remediation</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;recommendation&quot;</span><span class="p">],</span>
                <span class="p">))</span>
            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_value&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;check_value&quot;</span><span class="p">](</span><span class="n">value</span><span class="p">):</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Weak Security Header: </span><span class="si">{</span><span class="n">header_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header_name</span><span class="si">}</span><span class="s2"> is set but may be insufficiently configured: &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">),</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="n">header_name</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">},</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;recommendation&quot;</span><span class="p">],</span>
                        <span class="p">))</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                    <span class="k">pass</span>

        <span class="c1"># Check for information disclosure headers</span>
        <span class="k">for</span> <span class="n">header_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">BAD_HEADERS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">header_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="c1"># For Server header, only flag if verbose</span>
                <span class="k">if</span> <span class="n">header_name</span> <span class="o">==</span> <span class="s2">&quot;Server&quot;</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_value&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;check_value&quot;</span><span class="p">](</span><span class="n">value</span><span class="p">):</span>
                        <span class="k">continue</span>  <span class="c1"># Minimal server header, OK</span>

                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Information Disclosure: </span><span class="si">{</span><span class="n">header_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;severity&quot;</span><span class="p">],</span>
                    <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
                    <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="n">header_name</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">},</span>
                    <span class="n">remediation</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;recommendation&quot;</span><span class="p">],</span>
                <span class="p">))</span>

        <span class="c1"># Check for HTTPS redirect</span>
        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http://&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">):</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;No HTTP to HTTPS Redirect&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;HTTP requests are not redirected to HTTPS.&quot;</span><span class="p">,</span>
                    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
                    <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Configure server to redirect all HTTP requests to HTTPS.&quot;</span><span class="p">,</span>
                <span class="p">))</span>

        <span class="c1"># Check cookie security</span>
        <span class="k">for</span> <span class="n">cookie_header</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;Set-Cookie&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="s1">&#39;getlist&#39;</span>
        <span class="p">)</span> <span class="k">else</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_cookie_security</span><span class="p">(</span><span class="n">cookie_header</span><span class="p">,</span> <span class="n">findings</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="c1"># Check for cookies in raw headers</span>
        <span class="n">raw_cookies</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Set-Cookie&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">raw_cookies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_cookie_security</span><span class="p">(</span><span class="n">raw_cookies</span><span class="p">,</span> <span class="n">findings</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2"> HTTP security issues&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">findings</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_cookie_security</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cookie_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">findings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">],</span>
                                <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check cookie security attributes.&quot;&quot;&quot;</span>
        <span class="n">cookie_lower</span> <span class="o">=</span> <span class="n">cookie_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;secure&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cookie_lower</span> <span class="ow">and</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">):</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cookie Without Secure Flag&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A cookie is set without the Secure flag over HTTPS.&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cookie&quot;</span><span class="p">:</span> <span class="n">cookie_str</span><span class="p">[:</span><span class="mi">100</span><span class="p">]},</span>
                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Add Secure flag to all cookies on HTTPS sites.&quot;</span><span class="p">,</span>
            <span class="p">))</span>

        <span class="k">if</span> <span class="s2">&quot;httponly&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cookie_lower</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cookie Without HttpOnly Flag&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A cookie is set without the HttpOnly flag (accessible by JavaScript).&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cookie&quot;</span><span class="p">:</span> <span class="n">cookie_str</span><span class="p">[:</span><span class="mi">100</span><span class="p">]},</span>
                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Add HttpOnly flag to cookies not needed by client-side JavaScript.&quot;</span><span class="p">,</span>
            <span class="p">))</span>

        <span class="k">if</span> <span class="s2">&quot;samesite&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cookie_lower</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cookie Without SameSite Attribute&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A cookie is missing the SameSite attribute (CSRF risk).&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;http_checker&quot;</span><span class="p">,</span>
                <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cookie&quot;</span><span class="p">:</span> <span class="n">cookie_str</span><span class="p">[:</span><span class="mi">100</span><span class="p">]},</span>
                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Add SameSite=Lax or SameSite=Strict to cookies.&quot;</span><span class="p">,</span>
            <span class="p">))</span>
</code></pre></div>

<hr />
<h2 id="7-ssltls-configuration-analyzer">7. SSL/TLS Configuration Analyzer<a class="header-link" href="#7-ssltls-configuration-analyzer" title="Permanent link">&para;</a></h2>
<h3 id="71-ssltls-checker">7.1 SSL/TLS Checker<a class="header-link" href="#71-ssltls-checker" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/ssl_checker.py - SSL/TLS configuration analyzer.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Finding</span><span class="p">,</span> <span class="n">Severity</span><span class="p">,</span> <span class="n">RateLimiter</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SSLChecker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes SSL/TLS configuration for security issues.</span>

<span class="sd">    Checks:</span>
<span class="sd">    - Certificate validity and expiration</span>
<span class="sd">    - Protocol version support</span>
<span class="sd">    - Cipher suite strength</span>
<span class="sd">    - Common misconfigurations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Weak protocols</span>
    <span class="n">WEAK_PROTOCOLS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">ssl</span><span class="o">.</span><span class="n">TLSVersion</span><span class="o">.</span><span class="n">SSLv3</span><span class="p">:</span> <span class="s2">&quot;SSLv3 (POODLE vulnerability)&quot;</span><span class="p">,</span>
        <span class="n">ssl</span><span class="o">.</span><span class="n">TLSVersion</span><span class="o">.</span><span class="n">TLSv1</span><span class="p">:</span> <span class="s2">&quot;TLS 1.0 (deprecated, multiple vulnerabilities)&quot;</span><span class="p">,</span>
        <span class="n">ssl</span><span class="o">.</span><span class="n">TLSVersion</span><span class="o">.</span><span class="n">TLSv1_1</span><span class="p">:</span> <span class="s2">&quot;TLS 1.1 (deprecated)&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Weak cipher keywords</span>
    <span class="n">WEAK_CIPHER_KEYWORDS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;RC4&quot;</span><span class="p">,</span> <span class="s2">&quot;DES&quot;</span><span class="p">,</span> <span class="s2">&quot;3DES&quot;</span><span class="p">,</span> <span class="s2">&quot;MD5&quot;</span><span class="p">,</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span> <span class="s2">&quot;EXPORT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;anon&quot;</span><span class="p">,</span> <span class="s2">&quot;RC2&quot;</span><span class="p">,</span> <span class="s2">&quot;SEED&quot;</span><span class="p">,</span> <span class="s2">&quot;IDEA&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">rate_limiter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RateLimiter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">rate_limiter</span> <span class="ow">or</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">443</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check SSL/TLS configuration of a host.</span>

<span class="sd">        Args:</span>
<span class="sd">            host: Target hostname.</span>
<span class="sd">            port: HTTPS port (default 443).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of findings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Checking SSL/TLS configuration for </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="c1"># 1. Check certificate</span>
        <span class="n">cert_findings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_certificate</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cert_findings</span><span class="p">)</span>

        <span class="c1"># 2. Check supported protocols</span>
        <span class="n">protocol_findings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_protocols</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">protocol_findings</span><span class="p">)</span>

        <span class="c1"># 3. Check cipher suites</span>
        <span class="n">cipher_findings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ciphers</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cipher_findings</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2"> SSL/TLS issues&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">findings</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_certificate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check SSL certificate validity.&quot;&quot;&quot;</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span>
                <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_hostname</span><span class="o">=</span><span class="n">host</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssock</span><span class="p">:</span>
                    <span class="n">cert</span> <span class="o">=</span> <span class="n">ssock</span><span class="o">.</span><span class="n">getpeercert</span><span class="p">()</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">cert</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;No SSL Certificate&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No SSL certificate presented by server.&quot;</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Install a valid SSL certificate.&quot;</span><span class="p">,</span>
                        <span class="p">))</span>
                        <span class="k">return</span> <span class="n">findings</span>

                    <span class="c1"># Check expiration</span>
                    <span class="n">not_after</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                        <span class="n">cert</span><span class="p">[</span><span class="s1">&#39;notAfter&#39;</span><span class="p">],</span> <span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1"> %H:%M:%S %Y %Z&#39;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
                    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
                    <span class="n">days_until_expiry</span> <span class="o">=</span> <span class="p">(</span><span class="n">not_after</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

                    <span class="k">if</span> <span class="n">days_until_expiry</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Expired SSL Certificate&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Certificate expired </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">days_until_expiry</span><span class="p">)</span><span class="si">}</span><span class="s2"> days ago.&quot;</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;expiry_date&quot;</span><span class="p">:</span> <span class="n">cert</span><span class="p">[</span><span class="s1">&#39;notAfter&#39;</span><span class="p">],</span>
                                <span class="s2">&quot;days_expired&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">days_until_expiry</span><span class="p">),</span>
                            <span class="p">},</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Renew the SSL certificate immediately.&quot;</span><span class="p">,</span>
                        <span class="p">))</span>
                    <span class="k">elif</span> <span class="n">days_until_expiry</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;SSL Certificate Expiring Soon&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Certificate expires in </span><span class="si">{</span><span class="n">days_until_expiry</span><span class="si">}</span><span class="s2"> days.&quot;</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;expiry_date&quot;</span><span class="p">:</span> <span class="n">cert</span><span class="p">[</span><span class="s1">&#39;notAfter&#39;</span><span class="p">],</span>
                                <span class="s2">&quot;days_remaining&quot;</span><span class="p">:</span> <span class="n">days_until_expiry</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Renew the SSL certificate before expiration.&quot;</span><span class="p">,</span>
                        <span class="p">))</span>
                    <span class="k">elif</span> <span class="n">days_until_expiry</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;SSL Certificate Expiring Within 90 Days&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Certificate expires in </span><span class="si">{</span><span class="n">days_until_expiry</span><span class="si">}</span><span class="s2"> days.&quot;</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;expiry_date&quot;</span><span class="p">:</span> <span class="n">cert</span><span class="p">[</span><span class="s1">&#39;notAfter&#39;</span><span class="p">],</span>
                                <span class="s2">&quot;days_remaining&quot;</span><span class="p">:</span> <span class="n">days_until_expiry</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Plan certificate renewal.&quot;</span><span class="p">,</span>
                        <span class="p">))</span>

                    <span class="c1"># Check subject alternative names</span>
                    <span class="n">sans</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subjectAltName&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="k">if</span> <span class="n">type_name</span> <span class="o">==</span> <span class="s1">&#39;DNS&#39;</span><span class="p">:</span>
                            <span class="n">sans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">host</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sans</span> <span class="ow">and</span> <span class="sa">f</span><span class="s2">&quot;*.</span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">host</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sans</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Certificate Hostname Mismatch&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Certificate SANs </span><span class="si">{</span><span class="n">sans</span><span class="si">}</span><span class="s2"> do not include </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">.&quot;</span>
                            <span class="p">),</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Reissue certificate with correct hostname.&quot;</span><span class="p">,</span>
                        <span class="p">))</span>

                    <span class="c1"># Check issuer (self-signed)</span>
                    <span class="n">issuer</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;issuer&#39;</span><span class="p">,</span> <span class="p">[]))</span>
                    <span class="n">subject</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="p">[]))</span>
                    <span class="k">if</span> <span class="n">issuer</span> <span class="o">==</span> <span class="n">subject</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Self-Signed Certificate&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The certificate is self-signed (not trusted by browsers).&quot;</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;issuer&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">issuer</span><span class="p">)},</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Use a certificate from a trusted CA (e.g., Let&#39;s Encrypt).&quot;</span><span class="p">,</span>
                        <span class="p">))</span>

        <span class="k">except</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLCertVerificationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;SSL Certificate Verification Failed&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Certificate verification error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Fix certificate chain or install valid certificate.&quot;</span><span class="p">,</span>
            <span class="p">))</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">ConnectionRefusedError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;SSL Connection Failed&quot;</span><span class="p">,</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Could not establish SSL connection: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
            <span class="p">))</span>

        <span class="k">return</span> <span class="n">findings</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_protocols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check which TLS protocol versions are supported.&quot;&quot;&quot;</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Test for weak protocols</span>
        <span class="k">for</span> <span class="n">protocol_version</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">WEAK_PROTOCOLS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLS_CLIENT</span><span class="p">)</span>
                <span class="n">context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>
                <span class="n">context</span><span class="o">.</span><span class="n">minimum_version</span> <span class="o">=</span> <span class="n">protocol_version</span>
                <span class="n">context</span><span class="o">.</span><span class="n">maximum_version</span> <span class="o">=</span> <span class="n">protocol_version</span>

                <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssock</span><span class="p">:</span>
                        <span class="c1"># If we get here, the weak protocol is supported</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Weak TLS Protocol Supported&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span> <span class="k">if</span> <span class="s2">&quot;SSLv3&quot;</span> <span class="ow">in</span> <span class="n">description</span>
                                     <span class="ow">or</span> <span class="s2">&quot;TLS 1.0&quot;</span> <span class="ow">in</span> <span class="n">description</span>
                                     <span class="k">else</span> <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Server supports </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">protocol_version</span><span class="p">)},</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Disable </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">. Only allow TLS 1.2+.&quot;</span><span class="p">,</span>
                        <span class="p">))</span>

            <span class="k">except</span> <span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">ConnectionRefusedError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="k">pass</span>  <span class="c1"># Protocol not supported (good)</span>

        <span class="k">return</span> <span class="n">findings</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_ciphers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for weak cipher suites.&quot;&quot;&quot;</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
            <span class="n">context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>

            <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span>
                <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_hostname</span><span class="o">=</span><span class="n">host</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssock</span><span class="p">:</span>
                    <span class="n">cipher</span> <span class="o">=</span> <span class="n">ssock</span><span class="o">.</span><span class="n">cipher</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">cipher</span><span class="p">:</span>
                        <span class="n">cipher_name</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">bits</span> <span class="o">=</span> <span class="n">cipher</span>

                        <span class="c1"># Check for weak ciphers</span>
                        <span class="k">for</span> <span class="n">weak_keyword</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">WEAK_CIPHER_KEYWORDS</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">weak_keyword</span> <span class="ow">in</span> <span class="n">cipher_name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                                    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Weak Cipher Suite: </span><span class="si">{</span><span class="n">cipher_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                    <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                                    <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;Server negotiated weak cipher: </span><span class="si">{</span><span class="n">cipher_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">bits</span><span class="si">}</span><span class="s2"> bits, </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s2">)&quot;</span>
                                    <span class="p">),</span>
                                    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                                    <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s2">&quot;cipher&quot;</span><span class="p">:</span> <span class="n">cipher_name</span><span class="p">,</span>
                                        <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">protocol</span><span class="p">,</span>
                                        <span class="s2">&quot;bits&quot;</span><span class="p">:</span> <span class="n">bits</span><span class="p">,</span>
                                    <span class="p">},</span>
                                    <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Disable weak cipher suites. Use ECDHE-RSA-AES256-GCM-SHA384 or similar.&quot;</span><span class="p">,</span>
                                <span class="p">))</span>
                                <span class="k">break</span>

                        <span class="c1"># Check key length</span>
                        <span class="k">if</span> <span class="n">bits</span> <span class="ow">and</span> <span class="n">bits</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">:</span>
                            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Weak Cipher Key Length: </span><span class="si">{</span><span class="n">bits</span><span class="si">}</span><span class="s2"> bits&quot;</span><span class="p">,</span>
                                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cipher key length is only </span><span class="si">{</span><span class="n">bits</span><span class="si">}</span><span class="s2"> bits.&quot;</span><span class="p">,</span>
                                <span class="n">module</span><span class="o">=</span><span class="s2">&quot;ssl_checker&quot;</span><span class="p">,</span>
                                <span class="n">remediation</span><span class="o">=</span><span class="s2">&quot;Use cipher suites with at least 128-bit keys.&quot;</span><span class="p">,</span>
                            <span class="p">))</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">ConnectionRefusedError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">findings</span>
</code></pre></div>

<hr />
<h2 id="8-directory-scanner-module">8. Directory Scanner Module<a class="header-link" href="#8-directory-scanner-module" title="Permanent link">&para;</a></h2>
<h3 id="81-path-discovery">8.1 Path Discovery<a class="header-link" href="#81-path-discovery" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/dir_scanner.py - Directory and path discovery.</span>

<span class="sd">This module performs dictionary-based path discovery to find</span>
<span class="sd">hidden endpoints, backup files, and sensitive paths.</span>

<span class="sd">For educational purposes only. Never brute force paths without permission.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Finding</span><span class="p">,</span> <span class="n">Severity</span><span class="p">,</span> <span class="n">RateLimiter</span>


<span class="c1"># Built-in small wordlist for common paths</span>
<span class="n">DEFAULT_WORDLIST</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Configuration and environment files</span>
    <span class="s2">&quot;.env&quot;</span><span class="p">,</span> <span class="s2">&quot;.env.backup&quot;</span><span class="p">,</span> <span class="s2">&quot;.env.production&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.git/config&quot;</span><span class="p">,</span> <span class="s2">&quot;.git/HEAD&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.svn/entries&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.htaccess&quot;</span><span class="p">,</span> <span class="s2">&quot;.htpasswd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;web.config&quot;</span><span class="p">,</span>
    <span class="s2">&quot;robots.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;sitemap.xml&quot;</span><span class="p">,</span>

    <span class="c1"># Admin panels</span>
    <span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;admin/login&quot;</span><span class="p">,</span> <span class="s2">&quot;administrator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dashboard&quot;</span><span class="p">,</span> <span class="s2">&quot;manage&quot;</span><span class="p">,</span> <span class="s2">&quot;panel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wp-admin&quot;</span><span class="p">,</span> <span class="s2">&quot;wp-login.php&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phpmyadmin&quot;</span><span class="p">,</span> <span class="s2">&quot;adminer.php&quot;</span><span class="p">,</span>

    <span class="c1"># API documentation</span>
    <span class="s2">&quot;api&quot;</span><span class="p">,</span> <span class="s2">&quot;api/v1&quot;</span><span class="p">,</span> <span class="s2">&quot;api/docs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;swagger.json&quot;</span><span class="p">,</span> <span class="s2">&quot;openapi.json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api-docs&quot;</span><span class="p">,</span> <span class="s2">&quot;graphql&quot;</span><span class="p">,</span>

    <span class="c1"># Backup and debug files</span>
    <span class="s2">&quot;backup&quot;</span><span class="p">,</span> <span class="s2">&quot;backup.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;backup.sql&quot;</span><span class="p">,</span>
    <span class="s2">&quot;database.sql&quot;</span><span class="p">,</span> <span class="s2">&quot;dump.sql&quot;</span><span class="p">,</span>
    <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="s2">&quot;debug.log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;error.log&quot;</span><span class="p">,</span> <span class="s2">&quot;access.log&quot;</span><span class="p">,</span>

    <span class="c1"># Common application paths</span>
    <span class="s2">&quot;server-status&quot;</span><span class="p">,</span> <span class="s2">&quot;server-info&quot;</span><span class="p">,</span>
    <span class="s2">&quot;info.php&quot;</span><span class="p">,</span> <span class="s2">&quot;phpinfo.php&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;test.html&quot;</span><span class="p">,</span> <span class="s2">&quot;test.php&quot;</span><span class="p">,</span>
    <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;health&quot;</span><span class="p">,</span> <span class="s2">&quot;healthcheck&quot;</span><span class="p">,</span>
    <span class="s2">&quot;metrics&quot;</span><span class="p">,</span> <span class="s2">&quot;prometheus&quot;</span><span class="p">,</span>

    <span class="c1"># User-related paths</span>
    <span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;signup&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reset-password&quot;</span><span class="p">,</span> <span class="s2">&quot;forgot-password&quot;</span><span class="p">,</span>
    <span class="s2">&quot;profile&quot;</span><span class="p">,</span> <span class="s2">&quot;account&quot;</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">,</span>

    <span class="c1"># Static/asset paths</span>
    <span class="s2">&quot;static&quot;</span><span class="p">,</span> <span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="s2">&quot;uploads&quot;</span><span class="p">,</span>
    <span class="s2">&quot;media&quot;</span><span class="p">,</span> <span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;documents&quot;</span><span class="p">,</span>
    <span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;css&quot;</span><span class="p">,</span> <span class="s2">&quot;js&quot;</span><span class="p">,</span>

    <span class="c1"># Development artifacts</span>
    <span class="s2">&quot;.DS_Store&quot;</span><span class="p">,</span>
    <span class="s2">&quot;composer.json&quot;</span><span class="p">,</span> <span class="s2">&quot;package.json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Gemfile&quot;</span><span class="p">,</span> <span class="s2">&quot;requirements.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dockerfile&quot;</span><span class="p">,</span> <span class="s2">&quot;docker-compose.yml&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Paths that indicate security issues when accessible</span>
<span class="n">SENSITIVE_PATHS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;.env&quot;</span><span class="p">:</span> <span class="s2">&quot;Environment file may contain secrets (API keys, passwords)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.git/config&quot;</span><span class="p">:</span> <span class="s2">&quot;Git configuration exposed - entire source code may be downloadable&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.git/HEAD&quot;</span><span class="p">:</span> <span class="s2">&quot;Git repository exposed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.svn/entries&quot;</span><span class="p">:</span> <span class="s2">&quot;SVN repository exposed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.htpasswd&quot;</span><span class="p">:</span> <span class="s2">&quot;Apache password file exposed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phpinfo.php&quot;</span><span class="p">:</span> <span class="s2">&quot;PHP info page exposes server configuration details&quot;</span><span class="p">,</span>
    <span class="s2">&quot;info.php&quot;</span><span class="p">:</span> <span class="s2">&quot;PHP info page exposes server configuration details&quot;</span><span class="p">,</span>
    <span class="s2">&quot;backup.sql&quot;</span><span class="p">:</span> <span class="s2">&quot;Database backup file publicly accessible&quot;</span><span class="p">,</span>
    <span class="s2">&quot;database.sql&quot;</span><span class="p">:</span> <span class="s2">&quot;Database dump file publicly accessible&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dump.sql&quot;</span><span class="p">:</span> <span class="s2">&quot;Database dump file publicly accessible&quot;</span><span class="p">,</span>
    <span class="s2">&quot;backup.zip&quot;</span><span class="p">:</span> <span class="s2">&quot;Backup archive publicly accessible&quot;</span><span class="p">,</span>
    <span class="s2">&quot;debug.log&quot;</span><span class="p">:</span> <span class="s2">&quot;Debug log may contain sensitive information&quot;</span><span class="p">,</span>
    <span class="s2">&quot;server-status&quot;</span><span class="p">:</span> <span class="s2">&quot;Apache server-status page exposed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;server-info&quot;</span><span class="p">:</span> <span class="s2">&quot;Apache server-info page exposed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.DS_Store&quot;</span><span class="p">:</span> <span class="s2">&quot;macOS directory metadata may reveal file structure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;web.config&quot;</span><span class="p">:</span> <span class="s2">&quot;IIS configuration file exposed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;composer.json&quot;</span><span class="p">:</span> <span class="s2">&quot;PHP dependency file reveals technology stack&quot;</span><span class="p">,</span>
    <span class="s2">&quot;package.json&quot;</span><span class="p">:</span> <span class="s2">&quot;Node.js dependency file reveals technology stack&quot;</span><span class="p">,</span>
    <span class="s2">&quot;requirements.txt&quot;</span><span class="p">:</span> <span class="s2">&quot;Python dependency file reveals technology stack&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dockerfile&quot;</span><span class="p">:</span> <span class="s2">&quot;Docker configuration may reveal architecture&quot;</span><span class="p">,</span>
    <span class="s2">&quot;swagger.json&quot;</span><span class="p">:</span> <span class="s2">&quot;API specification publicly accessible&quot;</span><span class="p">,</span>
    <span class="s2">&quot;openapi.json&quot;</span><span class="p">:</span> <span class="s2">&quot;API specification publicly accessible&quot;</span><span class="p">,</span>
    <span class="s2">&quot;graphql&quot;</span><span class="p">:</span> <span class="s2">&quot;GraphQL endpoint may allow introspection&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DirectoryScanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dictionary-based directory and path discovery.</span>
<span class="sd">    Uses a wordlist to find accessible endpoints.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">rate_limiter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RateLimiter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wordlist_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">rate_limiter</span> <span class="ow">or</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>

        <span class="c1"># Load wordlist</span>
        <span class="k">if</span> <span class="n">wordlist_file</span> <span class="ow">and</span> <span class="n">Path</span><span class="p">(</span><span class="n">wordlist_file</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wordlist</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">wordlist_file</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wordlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wordlist</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wordlist</span> <span class="o">=</span> <span class="n">DEFAULT_WORDLIST</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan for accessible directories and files.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_url: Target base URL (e.g., https://example.com).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of findings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">discovered</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Clean base URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Scanning </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordlist</span><span class="p">)</span><span class="si">}</span><span class="s2"> paths on </span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordlist</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Progress: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordlist</span><span class="p">)</span><span class="si">}</span><span class="s2"> paths checked, &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">discovered</span><span class="p">)</span><span class="si">}</span><span class="s2"> found&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">url</span><span class="p">,</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
                    <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Don&#39;t follow redirects</span>
                    <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;SecurityScanner/1.0 (Authorized Scan)&quot;</span>
                    <span class="p">},</span>
                <span class="p">)</span>

                <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

                <span class="c1"># 200: directly accessible</span>
                <span class="c1"># 301/302: redirects (may still be interesting)</span>
                <span class="c1"># 403: forbidden (exists but restricted)</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                    <span class="n">discovered</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
                        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                    <span class="p">})</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [+] FOUND: /</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">  (200 OK, </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes)&quot;</span><span class="p">)</span>

                    <span class="c1"># Check if this is a sensitive path</span>
                    <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">SENSITIVE_PATHS</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sensitive Path Accessible: /</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="n">SENSITIVE_PATHS</span><span class="p">[</span><span class="n">path</span><span class="p">],</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;dir_scanner&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                                <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
                                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="n">remediation</span><span class="o">=</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Restrict access to /</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">. &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;Remove from web root or deny in server configuration.&quot;</span>
                            <span class="p">),</span>
                        <span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Discovered Path: /</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Path /</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> is accessible (HTTP 200).&quot;</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;dir_scanner&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                                <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
                                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">))</span>

                <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
                    <span class="c1"># Exists but forbidden - note for manual testing</span>
                    <span class="n">discovered</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
                        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="p">})</span>
                    <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">SENSITIVE_PATHS</span><span class="p">:</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Restricted Path Detected: /</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Path /</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> exists but returns 403 Forbidden. &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;Verify access controls are correct.&quot;</span>
                            <span class="p">),</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;dir_scanner&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">},</span>
                        <span class="p">))</span>

            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># Connection error, skip this path</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Directory scan complete. Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">discovered</span><span class="p">)</span><span class="si">}</span><span class="s2"> paths, &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2"> findings.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">findings</span>
</code></pre></div>

<hr />
<h2 id="9-cve-database-lookup">9. CVE Database Lookup<a class="header-link" href="#9-cve-database-lookup" title="Permanent link">&para;</a></h2>
<h3 id="91-cve-lookup-module">9.1 CVE Lookup Module<a class="header-link" href="#91-cve-lookup-module" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/cve_lookup.py - CVE (Common Vulnerabilities and Exposures) lookup.</span>

<span class="sd">Queries public CVE databases to find known vulnerabilities</span>
<span class="sd">for discovered services and versions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Finding</span><span class="p">,</span> <span class="n">Severity</span><span class="p">,</span> <span class="n">PortInfo</span><span class="p">,</span> <span class="n">RateLimiter</span>


<span class="c1"># Simplified local CVE database for common services</span>
<span class="c1"># In production, query NVD API, VulnDB, or similar</span>
<span class="n">LOCAL_CVE_DB</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;apache&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;2.4.49&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;CVE-2021-41773&quot;</span><span class="p">,</span>
                <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Path traversal and RCE in Apache HTTP Server 2.4.49&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fix&quot;</span><span class="p">:</span> <span class="s2">&quot;Upgrade to Apache 2.4.51+&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
        <span class="s2">&quot;2.4.50&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;CVE-2021-42013&quot;</span><span class="p">,</span>
                <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Path traversal in Apache HTTP Server 2.4.50 (bypass of CVE-2021-41773)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fix&quot;</span><span class="p">:</span> <span class="s2">&quot;Upgrade to Apache 2.4.51+&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;openssh&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;8.5&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;CVE-2021-41617&quot;</span><span class="p">,</span>
                <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Privilege escalation in OpenSSH 6.2-8.7&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fix&quot;</span><span class="p">:</span> <span class="s2">&quot;Upgrade to OpenSSH 8.8+&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;nginx&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;1.20.0&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;CVE-2021-23017&quot;</span><span class="p">,</span>
                <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;DNS resolver vulnerabilities in nginx 0.6.18-1.20.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fix&quot;</span><span class="p">:</span> <span class="s2">&quot;Upgrade to nginx 1.20.1+&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;5.7&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;CVE-2023-21912&quot;</span><span class="p">,</span>
                <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;MySQL Server 5.7 multiple vulnerabilities&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fix&quot;</span><span class="p">:</span> <span class="s2">&quot;Upgrade to MySQL 8.0+&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;redis&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;6.0&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;CVE-2022-24735&quot;</span><span class="p">,</span>
                <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Redis Lua script sandbox escape&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fix&quot;</span><span class="p">:</span> <span class="s2">&quot;Upgrade to Redis 6.2.7+ or 7.0+&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CVELookup</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Look up known CVEs for discovered services.</span>
<span class="sd">    Uses both a local database and optional online API queries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NVD_API_URL</span> <span class="o">=</span> <span class="s2">&quot;https://services.nvd.nist.gov/rest/json/cves/2.0&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">use_online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">rate_limiter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RateLimiter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            use_online: Whether to query online NVD API.</span>
<span class="sd">            rate_limiter: Rate limiter for API calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_online</span> <span class="o">=</span> <span class="n">use_online</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">rate_limiter</span> <span class="ow">or</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># NVD rate limits</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">open_ports</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PortInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Finding</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look up CVEs for all discovered services.</span>

<span class="sd">        Args:</span>
<span class="sd">            open_ports: List of open ports with service information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of CVE findings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] Looking up known CVEs for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">open_ports</span><span class="p">)</span><span class="si">}</span><span class="s2"> services...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">open_ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">port_info</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Parse service name and version</span>
            <span class="n">service_name</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_service_version</span><span class="p">(</span>
                <span class="n">port_info</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">port_info</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">port_info</span><span class="o">.</span><span class="n">banner</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">service_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check local database</span>
            <span class="n">local_cves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_local</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cve</span> <span class="ow">in</span> <span class="n">local_cves</span><span class="p">:</span>
                <span class="n">severity_map</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;CRITICAL&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
                    <span class="s2">&quot;HIGH&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                    <span class="s2">&quot;MEDIUM&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                    <span class="s2">&quot;LOW&quot;</span><span class="p">:</span> <span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Known CVE: </span><span class="si">{</span><span class="n">cve</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">severity_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cve</span><span class="p">[</span><span class="s1">&#39;severity&#39;</span><span class="p">],</span> <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">),</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">cve</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;cve_lookup&quot;</span><span class="p">,</span>
                    <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;cve_id&quot;</span><span class="p">:</span> <span class="n">cve</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
                        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
                        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="n">remediation</span><span class="o">=</span><span class="n">cve</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fix&#39;</span><span class="p">,</span> <span class="s1">&#39;Upgrade to the latest version.&#39;</span><span class="p">),</span>
                    <span class="n">reference</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://nvd.nist.gov/vuln/detail/</span><span class="si">{</span><span class="n">cve</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [!] </span><span class="si">{</span><span class="n">cve</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2"> &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;on port </span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Query online NVD if enabled</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_online</span><span class="p">:</span>
                <span class="n">online_cves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_nvd</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cve</span> <span class="ow">in</span> <span class="n">online_cves</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cve_id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">cve</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">findings</span><span class="p">):</span>
                        <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finding</span><span class="p">(</span>
                            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Known CVE (NVD): </span><span class="si">{</span><span class="n">cve</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>  <span class="c1"># Default, refine from CVSS</span>
                            <span class="n">description</span><span class="o">=</span><span class="n">cve</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">][:</span><span class="mi">200</span><span class="p">],</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;cve_lookup&quot;</span><span class="p">,</span>
                            <span class="n">details</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;cve_id&quot;</span><span class="p">:</span> <span class="n">cve</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service_name</span><span class="p">,</span>
                                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
                                <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                            <span class="p">},</span>
                            <span class="n">reference</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://nvd.nist.gov/vuln/detail/</span><span class="si">{</span><span class="n">cve</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[*] CVE lookup complete. Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2"> known vulnerabilities.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">findings</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_service_version</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">banner</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract standardized service name and version.&quot;&quot;&quot;</span>
        <span class="n">version_lower</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">banner_lower</span> <span class="o">=</span> <span class="n">banner</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Apache</span>
        <span class="k">if</span> <span class="s2">&quot;apache&quot;</span> <span class="ow">in</span> <span class="n">version_lower</span> <span class="ow">or</span> <span class="s2">&quot;apache&quot;</span> <span class="ow">in</span> <span class="n">banner_lower</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;apache[/ ](\d+\.\d+\.\d+)&#39;</span><span class="p">,</span> <span class="n">version_lower</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">banner_lower</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;apache&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># nginx</span>
        <span class="k">if</span> <span class="s2">&quot;nginx&quot;</span> <span class="ow">in</span> <span class="n">version_lower</span> <span class="ow">or</span> <span class="s2">&quot;nginx&quot;</span> <span class="ow">in</span> <span class="n">banner_lower</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;nginx[/ ](\d+\.\d+\.\d+)&#39;</span><span class="p">,</span> <span class="n">version_lower</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">banner_lower</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;nginx&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># OpenSSH</span>
        <span class="k">if</span> <span class="s2">&quot;openssh&quot;</span> <span class="ow">in</span> <span class="n">version_lower</span> <span class="ow">or</span> <span class="s2">&quot;openssh&quot;</span> <span class="ow">in</span> <span class="n">banner_lower</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;openssh[_/ ](\d+\.\d+)&#39;</span><span class="p">,</span> <span class="n">version_lower</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">banner_lower</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;openssh&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># MySQL</span>
        <span class="k">if</span> <span class="s2">&quot;mysql&quot;</span> <span class="ow">in</span> <span class="n">version_lower</span> <span class="ow">or</span> <span class="s2">&quot;mysql&quot;</span> <span class="ow">in</span> <span class="n">banner_lower</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mysql[/ ]*(\d+\.\d+)&#39;</span><span class="p">,</span> <span class="n">version_lower</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">banner_lower</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;mysql&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Redis</span>
        <span class="k">if</span> <span class="s2">&quot;redis&quot;</span> <span class="ow">in</span> <span class="n">version_lower</span> <span class="ow">or</span> <span class="s2">&quot;redis&quot;</span> <span class="ow">in</span> <span class="n">banner_lower</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;redis[/ ]*(\d+\.\d+)&#39;</span><span class="p">,</span> <span class="n">version_lower</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">banner_lower</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;redis&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_lookup_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look up CVEs in local database.&quot;&quot;&quot;</span>
        <span class="n">service_db</span> <span class="o">=</span> <span class="n">LOCAL_CVE_DB</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">{})</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">db_version</span><span class="p">,</span> <span class="n">cves</span> <span class="ow">in</span> <span class="n">service_db</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Check if the detected version matches</span>
            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">db_version</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cves</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_lookup_nvd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query NVD API for CVEs (rate-limited).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NVD_API_URL</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;keywordSearch&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;resultsPerPage&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;SecurityScanner/1.0&quot;</span><span class="p">},</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">vuln</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vulnerabilities&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">cve</span> <span class="o">=</span> <span class="n">vuln</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cve&quot;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">cve</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;descriptions&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lang&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">:</span>
                            <span class="n">desc</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="k">break</span>

                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">cve</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">desc</span><span class="p">,</span>
                    <span class="p">})</span>
                <span class="k">return</span> <span class="n">results</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div>

<hr />
<h2 id="10-report-generation">10. Report Generation<a class="header-link" href="#10-report-generation" title="Permanent link">&para;</a></h2>
<h3 id="101-report-engine">10.1 Report Engine<a class="header-link" href="#101-report-engine" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/report.py - Generate scan reports in multiple formats.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">asdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScanResult</span><span class="p">,</span> <span class="n">Finding</span><span class="p">,</span> <span class="n">Severity</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ReportGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate vulnerability scan reports.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">ScanResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a text report.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  VULNERABILITY SCAN REPORT&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Target:    </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Scan Date: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Duration:  </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">duration_seconds</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

        <span class="c1"># Summary</span>
        <span class="n">severity_counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="p">:</span>
            <span class="n">severity_counts</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">severity_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Open Ports:   </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total Findings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sev</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span> <span class="s2">&quot;LOW&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">]:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">severity_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">sev</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Open Ports</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  OPEN PORTS&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="s1">&#39;Port&#39;</span><span class="si">:</span><span class="s2">&gt;7s</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;State&#39;</span><span class="si">:</span><span class="s2">8s</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;Service&#39;</span><span class="si">:</span><span class="s2">15s</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;Version&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="o">*</span><span class="mi">7</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="o">*</span><span class="mi">8</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="o">*</span><span class="mi">15</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="o">*</span><span class="mi">30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">port</span><span class="si">:</span><span class="s2">&gt;7d</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">state</span><span class="si">:</span><span class="s2">8s</span><span class="si">}</span><span class="s2">  &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">service</span><span class="si">:</span><span class="s2">15s</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Findings by severity</span>
        <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Severity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">Severity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">Severity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                         <span class="n">Severity</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="n">Severity</span><span class="o">.</span><span class="n">INFO</span><span class="p">]:</span>
            <span class="n">findings</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">findings</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="n">severity</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">findings</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> FINDINGS (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">finding</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">findings</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. [</span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">module</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">finding</span><span class="o">.</span><span class="n">remediation</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Fix: </span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">remediation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">finding</span><span class="o">.</span><span class="n">reference</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Ref: </span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">finding</span><span class="o">.</span><span class="n">details</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">finding</span><span class="o">.</span><span class="n">details</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Errors</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  ERRORS&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;â”€&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [!] </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Footer</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">severity_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  OVERALL: CRITICAL vulnerabilities found!&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  Immediate remediation required.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">severity_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HIGH&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  OVERALL: HIGH severity vulnerabilities found.&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  Remediation recommended within 7 days.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">severity_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  OVERALL: MEDIUM severity issues found.&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  Remediation recommended within 30 days.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  OVERALL: No critical vulnerabilities found.&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">ScanResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a JSON report.&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;scan_metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
                <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
                <span class="s2">&quot;duration_seconds&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">duration_seconds</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;open_ports&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">),</span>
                <span class="s2">&quot;total_findings&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="p">),</span>
                <span class="s2">&quot;by_severity&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="p">},</span>
            <span class="s2">&quot;open_ports&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                    <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">service</span><span class="p">,</span>
                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                    <span class="s2">&quot;banner&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">banner</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span>
            <span class="p">],</span>
            <span class="s2">&quot;findings&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                    <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                    <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                    <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">details</span><span class="p">,</span>
                    <span class="s2">&quot;remediation&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">remediation</span><span class="p">,</span>
                    <span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">findings</span>
            <span class="p">],</span>
            <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Add severity counts</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="p">:</span>
            <span class="n">sev</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span>
            <span class="n">report</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">][</span><span class="s2">&quot;by_severity&quot;</span><span class="p">][</span><span class="n">sev</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">report</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">][</span><span class="s2">&quot;by_severity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">ScanResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an HTML report.&quot;&quot;&quot;</span>
        <span class="n">severity_colors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;CRITICAL&quot;</span><span class="p">:</span> <span class="s2">&quot;#dc3545&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HIGH&quot;</span><span class="p">:</span> <span class="s2">&quot;#fd7e14&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MEDIUM&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffc107&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LOW&quot;</span><span class="p">:</span> <span class="s2">&quot;#17a2b8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;INFO&quot;</span><span class="p">:</span> <span class="s2">&quot;#6c757d&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">html</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="s2">&lt;head&gt;</span>
<span class="s2">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="s2">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
<span class="s2">    &lt;title&gt;Vulnerability Scan Report - </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">&lt;/title&gt;</span>
<span class="s2">    &lt;style&gt;</span>
<span class="s2">        body </span><span class="se">{{</span><span class="s2"> font-family: -apple-system, BlinkMacSystemFont, sans-serif;</span>
<span class="s2">               max-width: 900px; margin: 0 auto; padding: 20px;</span>
<span class="s2">               background: #f8f9fa; </span><span class="se">}}</span>
<span class="s2">        h1 </span><span class="se">{{</span><span class="s2"> color: #212529; border-bottom: 2px solid #dee2e6; padding-bottom: 10px; </span><span class="se">}}</span>
<span class="s2">        h2 </span><span class="se">{{</span><span class="s2"> color: #495057; margin-top: 30px; </span><span class="se">}}</span>
<span class="s2">        .summary </span><span class="se">{{</span><span class="s2"> background: #fff; padding: 20px; border-radius: 8px;</span>
<span class="s2">                    box-shadow: 0 1px 3px rgba(0,0,0,0.1); </span><span class="se">}}</span>
<span class="s2">        .finding </span><span class="se">{{</span><span class="s2"> background: #fff; padding: 15px; margin: 10px 0;</span>
<span class="s2">                    border-radius: 8px; border-left: 4px solid #dee2e6;</span>
<span class="s2">                    box-shadow: 0 1px 3px rgba(0,0,0,0.1); </span><span class="se">}}</span>
<span class="s2">        .severity </span><span class="se">{{</span><span class="s2"> display: inline-block; padding: 2px 8px; border-radius: 4px;</span>
<span class="s2">                     color: white; font-size: 0.85em; font-weight: bold; </span><span class="se">}}</span>
<span class="s2">        table </span><span class="se">{{</span><span class="s2"> width: 100%; border-collapse: collapse; background: #fff;</span>
<span class="s2">                border-radius: 8px; overflow: hidden; </span><span class="se">}}</span>
<span class="s2">        th, td </span><span class="se">{{</span><span class="s2"> padding: 10px 15px; text-align: left; border-bottom: 1px solid #dee2e6; </span><span class="se">}}</span>
<span class="s2">        th </span><span class="se">{{</span><span class="s2"> background: #495057; color: white; </span><span class="se">}}</span>
<span class="s2">        .fix </span><span class="se">{{</span><span class="s2"> color: #28a745; font-style: italic; </span><span class="se">}}</span>
<span class="s2">    &lt;/style&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">    &lt;h1&gt;Vulnerability Scan Report&lt;/h1&gt;</span>
<span class="s2">    &lt;div class=&quot;summary&quot;&gt;</span>
<span class="s2">        &lt;p&gt;&lt;strong&gt;Target:&lt;/strong&gt; </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">)&lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;&lt;strong&gt;Date:&lt;/strong&gt; </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;&lt;strong&gt;Duration:&lt;/strong&gt; </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">duration_seconds</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> seconds&lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;&lt;strong&gt;Open Ports:&lt;/strong&gt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">)</span><span class="si">}</span><span class="s2"> |</span>
<span class="s2">           &lt;strong&gt;Findings:&lt;/strong&gt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
<span class="s2">    &lt;/div&gt;</span>

<span class="s2">    &lt;h2&gt;Open Ports&lt;/h2&gt;</span>
<span class="s2">    &lt;table&gt;</span>
<span class="s2">        &lt;tr&gt;&lt;th&gt;Port&lt;/th&gt;&lt;th&gt;State&lt;/th&gt;&lt;th&gt;Service&lt;/th&gt;&lt;th&gt;Version&lt;/th&gt;&lt;/tr&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;        &lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&lt;/td&gt;&quot;</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;td&gt;</span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">service</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/table&gt;</span><span class="se">\n\n</span><span class="s2">    &lt;h2&gt;Findings&lt;/h2&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">severity_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CRITICAL&quot;</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span><span class="p">,</span> <span class="s2">&quot;LOW&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">]:</span>
            <span class="n">findings</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">findings</span>
                        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">severity_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">findings</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">color</span> <span class="o">=</span> <span class="n">severity_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">severity_name</span><span class="p">,</span> <span class="s2">&quot;#6c757d&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">finding</span> <span class="ow">in</span> <span class="n">findings</span><span class="p">:</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;    &lt;div class=&quot;finding&quot; style=&quot;border-left-color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">&quot;&gt;</span>
<span class="s2">        &lt;span class=&quot;severity&quot; style=&quot;background: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="n">severity_name</span><span class="si">}</span><span class="s2">&lt;/span&gt;</span>
<span class="s2">        &lt;strong&gt;</span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/strong&gt;</span>
<span class="s2">        &lt;p&gt;</span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">finding</span><span class="o">.</span><span class="n">remediation</span><span class="p">:</span>
                    <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;        &lt;p class=&quot;fix&quot;&gt;Fix: </span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">remediation</span><span class="si">}</span><span class="s1">&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">finding</span><span class="o">.</span><span class="n">reference</span><span class="p">:</span>
                    <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;        &lt;p&gt;Reference: &lt;a href=&quot;</span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s1">&quot;&gt;</span><span class="si">{</span><span class="n">finding</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s1">&lt;/a&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;    &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;hr&gt;</span>
<span class="s2">    &lt;p style=&quot;color: #6c757d; font-size: 0.85em;&quot;&gt;</span>
<span class="s2">        Generated by Vulnerability Scanner on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span>
<span class="s2">    &lt;/p&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">html</span>
</code></pre></div>

<hr />
<h2 id="11-scan-controller-orchestrator">11. Scan Controller (Orchestrator)<a class="header-link" href="#11-scan-controller-orchestrator" title="Permanent link">&para;</a></h2>
<h3 id="111-main-controller">11.1 Main Controller<a class="header-link" href="#111-main-controller" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">scanner/controller.py - Scan orchestration controller.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScanTarget</span><span class="p">,</span> <span class="n">ScanResult</span><span class="p">,</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">COMMON_PORTS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.port_scanner</span><span class="w"> </span><span class="kn">import</span> <span class="n">PortScanner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.banner_grabber</span><span class="w"> </span><span class="kn">import</span> <span class="n">BannerGrabber</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.http_checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPChecker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.ssl_checker</span><span class="w"> </span><span class="kn">import</span> <span class="n">SSLChecker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.dir_scanner</span><span class="w"> </span><span class="kn">import</span> <span class="n">DirectoryScanner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.cve_lookup</span><span class="w"> </span><span class="kn">import</span> <span class="n">CVELookup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportGenerator</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ScanController</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orchestrates all scan modules and generates reports.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rate_limit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            rate_limit: Maximum requests per second.</span>
<span class="sd">            timeout: Default timeout for connections.</span>
<span class="sd">            max_workers: Maximum concurrent threads for port scanning.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="n">rate_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span> <span class="o">=</span> <span class="n">max_workers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_generator</span> <span class="o">=</span> <span class="n">ReportGenerator</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ports</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scan_http</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">scan_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">scan_dirs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">lookup_cves</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">wordlist</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScanResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a comprehensive vulnerability scan.</span>

<span class="sd">        Args:</span>
<span class="sd">            host: Target hostname or IP.</span>
<span class="sd">            ports: Specific ports to scan (default: common ports).</span>
<span class="sd">            scan_http: Whether to check HTTP security headers.</span>
<span class="sd">            scan_ssl: Whether to check SSL/TLS configuration.</span>
<span class="sd">            scan_dirs: Whether to perform directory scanning.</span>
<span class="sd">            lookup_cves: Whether to look up CVEs for found services.</span>
<span class="sd">            wordlist: Path to custom wordlist for directory scanning.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Complete scan result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize target</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">ScanTarget</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="o">.</span><span class="n">resolve</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[!] Cannot resolve hostname: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ScanResult</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DNS resolution failed for </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  VULNERABILITY SCAN&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Target: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Rate Limit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="o">.</span><span class="n">rate</span><span class="si">}</span><span class="s2"> req/s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">ScanResult</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Phase 1: Port Scanning</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Phase 1/5] Port Scanning&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
        <span class="n">port_scanner</span> <span class="o">=</span> <span class="n">PortScanner</span><span class="p">(</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">rate_limiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">,</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span> <span class="o">=</span> <span class="n">port_scanner</span><span class="o">.</span><span class="n">scan_ports</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">ports</span> <span class="ow">or</span> <span class="n">COMMON_PORTS</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">port_scanner</span><span class="o">.</span><span class="n">generate_findings</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] No open ports found. Scan complete.&quot;</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">duration_seconds</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Phase 2: Banner Grabbing</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Phase 2/5] Banner Grabbing&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
        <span class="n">banner_grabber</span> <span class="o">=</span> <span class="n">BannerGrabber</span><span class="p">(</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">rate_limiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">banner_grabber</span><span class="o">.</span><span class="n">grab_all_banners</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">banner_grabber</span><span class="o">.</span><span class="n">generate_findings</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Phase 3: HTTP Security Headers</span>
        <span class="k">if</span> <span class="n">scan_http</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Phase 3/5] HTTP Security Headers&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">http_checker</span> <span class="o">=</span> <span class="n">HTTPChecker</span><span class="p">(</span>
                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
                <span class="n">rate_limiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Check HTTP and HTTPS</span>
            <span class="n">http_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span>
                          <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)]</span>
            <span class="n">https_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span>
                           <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">443</span><span class="p">,</span> <span class="mi">8443</span><span class="p">)]</span>

            <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">http_ports</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span> <span class="o">!=</span> <span class="mi">80</span> \
                      <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">http_checker</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">https_ports</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span> <span class="o">!=</span> <span class="mi">443</span> \
                      <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">http_checker</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Phase 3/5] HTTP Security Headers (skipped)&quot;</span><span class="p">)</span>

        <span class="c1"># Phase 4: SSL/TLS Check</span>
        <span class="k">if</span> <span class="n">scan_ssl</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Phase 4/5] SSL/TLS Configuration&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">ssl_checker</span> <span class="o">=</span> <span class="n">SSLChecker</span><span class="p">(</span>
                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
                <span class="n">rate_limiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">ssl_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span>
                         <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">443</span><span class="p">,</span> <span class="mi">8443</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="mi">993</span><span class="p">,</span> <span class="mi">995</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">ssl_ports</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">ssl_checker</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Phase 4/5] SSL/TLS Configuration (skipped)&quot;</span><span class="p">)</span>

        <span class="c1"># Phase 5: Directory Scanning (optional)</span>
        <span class="k">if</span> <span class="n">scan_dirs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Phase 5/5] Directory Discovery&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">dir_scanner</span> <span class="o">=</span> <span class="n">DirectoryScanner</span><span class="p">(</span>
                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
                <span class="n">rate_limiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">,</span>
                <span class="n">wordlist_file</span><span class="o">=</span><span class="n">wordlist</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">web_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">open_ports</span>
                         <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="mi">8443</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">web_ports</span><span class="p">:</span>
                <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;https&quot;</span> <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">443</span><span class="p">,</span> <span class="mi">8443</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;http&quot;</span>
                <span class="n">port_suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">port_info</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span> \
                    <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">port</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">443</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">host</span><span class="si">}{</span><span class="n">port_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dir_scanner</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Phase 5/5] Directory Discovery (skipped)&quot;</span><span class="p">)</span>

        <span class="c1"># CVE Lookup</span>
        <span class="k">if</span> <span class="n">lookup_cves</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Bonus] CVE Database Lookup&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">cve_lookup</span> <span class="o">=</span> <span class="n">CVELookup</span><span class="p">(</span><span class="n">use_online</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cve_lookup</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">open_ports</span><span class="p">))</span>

        <span class="c1"># Finalize</span>
        <span class="n">result</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">duration_seconds</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Sort findings by severity</span>
        <span class="n">severity_order</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;CRITICAL&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;MEDIUM&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;LOW&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">:</span> <span class="mi">4</span>
        <span class="p">}</span>
        <span class="n">result</span><span class="o">.</span><span class="n">findings</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">severity_order</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>

<hr />
<h2 id="12-cli-entry-point">12. CLI Entry Point<a class="header-link" href="#12-cli-entry-point" title="Permanent link">&para;</a></h2>
<h3 id="121-main-script">12.1 Main Script<a class="header-link" href="#121-main-script" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">main.py - CLI entry point for the vulnerability scanner.</span>

<span class="sd">Usage:</span>
<span class="sd">    python main.py example.com</span>
<span class="sd">    python main.py example.com --ports 80,443,8080</span>
<span class="sd">    python main.py example.com --full --output report.json</span>
<span class="sd">    python main.py example.com --dirs --wordlist wordlists/common_paths.txt</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.controller</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScanController</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportGenerator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scanner.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_target</span><span class="p">,</span> <span class="n">COMMON_PORTS</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_args</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse command-line arguments.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Vulnerability Scanner - Authorized security scanning tool&quot;</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;IMPORTANT: Only scan targets you own or have explicit written &quot;</span>
            <span class="s2">&quot;permission to test. Unauthorized scanning is illegal.&quot;</span>
        <span class="p">),</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Target</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Target hostname or IP address to scan&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Port options</span>
    <span class="n">port_group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
    <span class="n">port_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--ports&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Comma-separated list of ports to scan (e.g., 80,443,8080)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">port_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--top-ports&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Scan top N most common ports (default: all common ports)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">port_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--all-ports&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Scan all ports (1-65535). VERY SLOW.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Scan options</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--full&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Full scan: ports + HTTP + SSL + dirs + CVEs&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--no-http&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Skip HTTP security header check&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--no-ssl&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Skip SSL/TLS configuration check&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--dirs&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable directory/path discovery&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--no-cve&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Skip CVE database lookup&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--wordlist&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Custom wordlist file for directory scanning&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Performance options</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--rate&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Maximum requests per second (default: 50)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--timeout&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Connection timeout in seconds (default: 3)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--threads&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Maximum concurrent threads for port scanning (default: 50)&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Output options</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output file path (format detected from extension: .json, .html, .txt)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output format (default: text)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Suppress progress output (only show results)&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Confirmation</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--confirm&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Skip authorization confirmation prompt&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_ports</span><span class="p">(</span><span class="n">ports_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a comma-separated port list, supporting ranges.&quot;&quot;&quot;</span>
    <span class="n">ports</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">ports_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">part</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Authorization confirmation</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">confirm</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  VULNERABILITY SCANNER&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Target: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  WARNING: Unauthorized scanning is ILLEGAL.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Only scan targets you own or have written permission&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  to test.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;  Do you have authorization to scan this target? [y/N]: &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Scan cancelled. Get proper authorization first.&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  Scan cancelled.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Validate target</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_target</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[!] Invalid or potentially dangerous target: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Parse ports</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ports</span><span class="p">:</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="n">parse_ports</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">all_ports</span><span class="p">:</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">65536</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">top_ports</span><span class="p">:</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="n">COMMON_PORTS</span><span class="p">[:</span><span class="n">args</span><span class="o">.</span><span class="n">top_ports</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="n">COMMON_PORTS</span>

    <span class="c1"># Determine scan options</span>
    <span class="n">scan_http</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_http</span>
    <span class="n">scan_ssl</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_ssl</span>
    <span class="n">scan_dirs</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dirs</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">full</span>
    <span class="n">lookup_cves</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_cve</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">full</span><span class="p">:</span>
        <span class="n">scan_http</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">scan_ssl</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">scan_dirs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">lookup_cves</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Run scan</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">ScanController</span><span class="p">(</span>
        <span class="n">rate_limit</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">threads</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
            <span class="n">ports</span><span class="o">=</span><span class="n">ports</span><span class="p">,</span>
            <span class="n">scan_http</span><span class="o">=</span><span class="n">scan_http</span><span class="p">,</span>
            <span class="n">scan_ssl</span><span class="o">=</span><span class="n">scan_ssl</span><span class="p">,</span>
            <span class="n">scan_dirs</span><span class="o">=</span><span class="n">scan_dirs</span><span class="p">,</span>
            <span class="n">lookup_cves</span><span class="o">=</span><span class="n">lookup_cves</span><span class="p">,</span>
            <span class="n">wordlist</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">wordlist</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">[!] Scan interrupted by user.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">130</span><span class="p">)</span>

    <span class="c1"># Generate report</span>
    <span class="n">report_gen</span> <span class="o">=</span> <span class="n">ReportGenerator</span><span class="p">()</span>

    <span class="c1"># Determine output format</span>
    <span class="n">output_format</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
            <span class="n">output_format</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.html&#39;</span><span class="p">):</span>
            <span class="n">output_format</span> <span class="o">=</span> <span class="s1">&#39;html&#39;</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">):</span>
            <span class="n">output_format</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>

    <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">report_gen</span><span class="o">.</span><span class="n">generate_json</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">report_gen</span><span class="o">.</span><span class="n">generate_html</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">report_gen</span><span class="o">.</span><span class="n">generate_text</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="c1"># Output</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[*] Report saved to: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">report</span><span class="p">)</span>

    <span class="c1"># Exit code based on findings</span>
    <span class="n">critical</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">findings</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">)</span>
    <span class="n">high</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">findings</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">critical</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">high</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="13-usage-examples">13. Usage Examples<a class="header-link" href="#13-usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="131-basic-scan">13.1 Basic Scan<a class="header-link" href="#131-basic-scan" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Scan common ports on a target</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com

<span class="c1"># Scan specific ports</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span>,443,8080,3306

<span class="c1"># Scan top 20 ports only</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>--top-ports<span class="w"> </span><span class="m">20</span>
</code></pre></div>

<h3 id="132-full-scan">13.2 Full Scan<a class="header-link" href="#132-full-scan" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Full scan with all modules</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>--full

<span class="c1"># Full scan with custom rate limit and output</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>--full<span class="w"> </span>--rate<span class="w"> </span><span class="m">20</span><span class="w"> </span>-o<span class="w"> </span>report.html

<span class="c1"># Full scan with custom wordlist</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>--full<span class="w"> </span>--wordlist<span class="w"> </span>wordlists/large.txt
</code></pre></div>

<h3 id="133-targeted-scans">13.3 Targeted Scans<a class="header-link" href="#133-targeted-scans" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># HTTP headers only (web server ports)</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span>,443<span class="w"> </span>--no-ssl<span class="w"> </span>--no-cve

<span class="c1"># SSL/TLS only</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>-p<span class="w"> </span><span class="m">443</span><span class="w"> </span>--no-http<span class="w"> </span>--no-cve

<span class="c1"># Directory scan only</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span>,443<span class="w"> </span>--dirs<span class="w"> </span>--no-ssl<span class="w"> </span>--no-cve
</code></pre></div>

<h3 id="134-output-formats">13.4 Output Formats<a class="header-link" href="#134-output-formats" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># JSON output (for automation)</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>-o<span class="w"> </span>scan_results.json

<span class="c1"># HTML report (for sharing)</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>--full<span class="w"> </span>-o<span class="w"> </span>report.html

<span class="c1"># Text report to file</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>-o<span class="w"> </span>report.txt

<span class="c1"># Quiet mode with JSON to stdout</span>
python<span class="w"> </span>main.py<span class="w"> </span>example.com<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span>json<span class="w"> </span>--confirm
</code></pre></div>

<hr />
<h2 id="14-exercises">14. Exercises<a class="header-link" href="#14-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-run-the-scanner">Exercise 1: Run the Scanner<a class="header-link" href="#exercise-1-run-the-scanner" title="Permanent link">&para;</a></h3>
<p>Set up and run the scanner against a locally hosted test application:
1. Install DVWA or WebGoat in a Docker container
2. Run the scanner with <code>--full</code> against localhost
3. Analyze the report and categorize all findings
4. Determine which findings are true vs. false positives</p>
<h3 id="exercise-2-add-udp-scanning">Exercise 2: Add UDP Scanning<a class="header-link" href="#exercise-2-add-udp-scanning" title="Permanent link">&para;</a></h3>
<p>Extend the port scanner to support basic UDP scanning:
1. Implement UDP port scanning using SOCK_DGRAM
2. Handle the differences (no handshake, less reliable)
3. Add support for common UDP services (DNS/53, SNMP/161, NTP/123)
4. Update the CLI to accept <code>--udp</code> flag</p>
<h3 id="exercise-3-implement-a-web-crawler">Exercise 3: Implement a Web Crawler<a class="header-link" href="#exercise-3-implement-a-web-crawler" title="Permanent link">&para;</a></h3>
<p>Add a web crawler module that:
1. Starts from the base URL and discovers linked pages
2. Extracts all forms and their parameters
3. Identifies input fields that could be attack surfaces
4. Respects robots.txt
5. Limits crawl depth and follows the rate limiter</p>
<h3 id="exercise-4-add-authentication-support">Exercise 4: Add Authentication Support<a class="header-link" href="#exercise-4-add-authentication-support" title="Permanent link">&para;</a></h3>
<p>Extend the HTTP checker to support authenticated scanning:
1. Accept login credentials via CLI
2. Perform authentication (form-based or cookie-based)
3. Scan authenticated pages that require login
4. Support Bearer token authentication for APIs</p>
<h3 id="exercise-5-custom-cve-database">Exercise 5: Custom CVE Database<a class="header-link" href="#exercise-5-custom-cve-database" title="Permanent link">&para;</a></h3>
<p>Build a more comprehensive CVE lookup system:
1. Download CVE data from NVD (NIST)
2. Store in a local SQLite database
3. Implement version range matching (not just exact match)
4. Add CVSS score parsing and severity mapping
5. Support automatic database updates</p>
<h3 id="exercise-6-parallel-module-execution">Exercise 6: Parallel Module Execution<a class="header-link" href="#exercise-6-parallel-module-execution" title="Permanent link">&para;</a></h3>
<p>Optimize the scanner for speed:
1. Run independent modules in parallel (e.g., HTTP check and SSL check)
2. Implement a progress bar showing overall completion
3. Add support for scanning multiple targets from a file
4. Benchmark and compare sequential vs. parallel execution times</p>
<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">          </span><span class="nx">Vulnerability</span><span class="w"> </span><span class="nx">Scanner</span><span class="w"> </span><span class="nx">Key</span><span class="w"> </span><span class="nx">Takeaways</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Ethics</span><span class="w"> </span><span class="nx">first</span><span class="p">:</span><span class="w"> </span><span class="nx">ALWAYS</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">authorization</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">scanning</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Rate</span><span class="w"> </span><span class="nx">limiting</span><span class="p">:</span><span class="w"> </span><span class="nx">Responsible</span><span class="w"> </span><span class="nx">scanning</span><span class="w"> </span><span class="nx">respects</span><span class="w"> </span><span class="nx">target</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nx">resources</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">network</span><span class="w"> </span><span class="nx">capacity</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Modular</span><span class="w"> </span><span class="nx">design</span><span class="p">:</span><span class="w"> </span><span class="nx">Each</span><span class="w"> </span><span class="nx">scan</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">independent</span><span class="w"> </span><span class="nx">module</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nx">that</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nx">separately</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">combined</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Defense</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">depth</span><span class="p">:</span><span class="w"> </span><span class="nx">Port</span><span class="w"> </span><span class="nx">scanning</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">banner</span><span class="w"> </span><span class="nx">grabbing</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">HTTP</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nx">headers</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">SSL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">directory</span><span class="w"> </span><span class="nx">scanning</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">CVE</span><span class="w"> </span><span class="nx">lookup</span><span class="w"> </span><span class="nx">gives</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nx">comprehensive</span><span class="w"> </span><span class="nx">coverage</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">False</span><span class="w"> </span><span class="nx">positives</span><span class="p">:</span><span class="w"> </span><span class="nx">Scanners</span><span class="w"> </span><span class="nx">produce</span><span class="w"> </span><span class="nx">noise</span><span class="p">;</span><span class="w"> </span><span class="nx">human</span><span class="w"> </span><span class="nx">analysis</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="k">is</span><span class="w"> </span><span class="nx">needed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">verify</span><span class="w"> </span><span class="nx">findings</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="nx">Version</span><span class="w"> </span><span class="nx">detection</span><span class="p">:</span><span class="w"> </span><span class="nx">Accurate</span><span class="w"> </span><span class="nx">service</span><span class="o">/</span><span class="nx">version</span><span class="w"> </span><span class="nx">identification</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="k">is</span><span class="w"> </span><span class="nx">critical</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">CVE</span><span class="w"> </span><span class="nx">matching</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">7</span><span class="p">.</span><span class="w"> </span><span class="nx">Reporting</span><span class="p">:</span><span class="w"> </span><span class="nx">Clear</span><span class="p">,</span><span class="w"> </span><span class="nx">actionable</span><span class="w"> </span><span class="nx">reports</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">severity</span><span class="w"> </span><span class="nx">ratings</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="k">and</span><span class="w"> </span><span class="nx">remediation</span><span class="w"> </span><span class="nx">advice</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">important</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">detection</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">8</span><span class="p">.</span><span class="w"> </span><span class="nx">Automation</span><span class="p">:</span><span class="w"> </span><span class="nx">CLI</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">structured</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="nx">enables</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nx">integration</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">CI</span><span class="o">/</span><span class="nx">CD</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">regular</span><span class="w"> </span><span class="nx">security</span><span class="w"> </span><span class="nx">assessments</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">9</span><span class="p">.</span><span class="w"> </span><span class="nx">Continuous</span><span class="p">:</span><span class="w"> </span><span class="nx">Security</span><span class="w"> </span><span class="nx">scanning</span><span class="w"> </span><span class="nx">should</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">regular</span><span class="p">,</span><span class="w"> </span><span class="k">not</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nx">one</span><span class="o">-</span><span class="nx">time</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="nx">integrate</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">development</span><span class="w"> </span><span class="nx">workflow</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="w"> </span><span class="nx">Limitations</span><span class="p">:</span><span class="w"> </span><span class="nx">Automated</span><span class="w"> </span><span class="nx">scanners</span><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">common</span><span class="w"> </span><span class="nx">issues</span><span class="w"> </span><span class="nx">but</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nx">cannot</span><span class="w"> </span><span class="nx">replace</span><span class="w"> </span><span class="nx">manual</span><span class="w"> </span><span class="nx">penetration</span><span class="w"> </span><span class="nx">testing</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">logic</span><span class="w"> </span><span class="nx">flaws</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<p><strong>Previous</strong>: <a href="15_Project_Secure_API.md">15. Project: Building a Secure REST API</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Security/15_Project_Secure_API.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Project: Building a Secure REST API</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Security/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}