{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 06: I/O and Redirection - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Shell_Script/">Shell Script</a>
    <span class="separator">/</span>
    <span class="current">Lesson 06: I/O and Redirection</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Lesson 06: I/O and Redirection</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Shell_Script/05_Functions_and_Libraries.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Lesson 05: Functions and Libraries</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Shell_Script/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Shell_Script/07_String_Processing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Lesson 07: String Processing and Text Manipulation</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#1-file-descriptors">1. File Descriptors</a><ul>
<li><a href="#11-standard-file-descriptors">1.1 Standard File Descriptors</a></li>
<li><a href="#12-custom-file-descriptors">1.2 Custom File Descriptors</a></li>
<li><a href="#13-opening-file-descriptors-for-readwrite">1.3 Opening File Descriptors for Read/Write</a></li>
<li><a href="#14-duplicating-file-descriptors">1.4 Duplicating File Descriptors</a></li>
<li><a href="#15-file-descriptor-inspection">1.5 File Descriptor Inspection</a></li>
</ul>
</li>
<li><a href="#2-advanced-redirection">2. Advanced Redirection</a><ul>
<li><a href="#21-redirecting-stderr-separately">2.1 Redirecting Stderr Separately</a></li>
<li><a href="#22-merging-stdout-and-stderr">2.2 Merging Stdout and Stderr</a></li>
<li><a href="#23-discarding-output">2.3 Discarding Output</a></li>
<li><a href="#24-swapping-stdout-and-stderr">2.4 Swapping Stdout and Stderr</a></li>
<li><a href="#25-saving-and-restoring-file-descriptors">2.5 Saving and Restoring File Descriptors</a></li>
<li><a href="#26-appending-vs-truncating">2.6 Appending vs Truncating</a></li>
</ul>
</li>
<li><a href="#3-here-documents-and-here-strings">3. Here Documents and Here Strings</a><ul>
<li><a href="#31-basic-here-document">3.1 Basic Here Document</a></li>
<li><a href="#32-here-document-without-variable-expansion">3.2 Here Document Without Variable Expansion</a></li>
<li><a href="#33-here-document-to-variables">3.3 Here Document to Variables</a></li>
<li><a href="#34-here-document-with-command-input">3.4 Here Document with Command Input</a></li>
<li><a href="#35-here-strings">3.5 Here Strings</a></li>
<li><a href="#36-practical-template-generation">3.6 Practical Template Generation</a></li>
</ul>
</li>
<li><a href="#4-process-substitution">4. Process Substitution</a><ul>
<li><a href="#41-input-process-substitution">4.1 Input Process Substitution</a></li>
<li><a href="#42-output-process-substitution">4.2 Output Process Substitution</a></li>
<li><a href="#43-avoiding-subshell-variable-scope-issues">4.3 Avoiding Subshell Variable Scope Issues</a></li>
<li><a href="#44-multiple-input-streams">4.4 Multiple Input Streams</a></li>
<li><a href="#45-practical-examples">4.5 Practical Examples</a></li>
</ul>
</li>
<li><a href="#5-named-pipes-fifos">5. Named Pipes (FIFOs)</a><ul>
<li><a href="#51-creating-and-using-fifos">5.1 Creating and Using FIFOs</a></li>
<li><a href="#52-producer-consumer-pattern">5.2 Producer-Consumer Pattern</a></li>
<li><a href="#53-bidirectional-communication">5.3 Bidirectional Communication</a></li>
<li><a href="#54-when-to-use-fifos-vs-process-substitution">5.4 When to Use FIFOs vs Process Substitution</a></li>
</ul>
</li>
<li><a href="#6-pipe-pitfalls-and-solutions">6. Pipe Pitfalls and Solutions</a><ul>
<li><a href="#61-subshell-variable-scope-loss">6.1 Subshell Variable Scope Loss</a></li>
<li><a href="#62-pipestatus-array">6.2 PIPESTATUS Array</a></li>
<li><a href="#63-pipeline-error-handling">6.3 Pipeline Error Handling</a></li>
<li><a href="#64-named-pipe-deadlock-prevention">6.4 Named Pipe Deadlock Prevention</a></li>
</ul>
</li>
<li><a href="#7-practical-io-patterns">7. Practical I/O Patterns</a><ul>
<li><a href="#71-tee-to-multiple-destinations">7.1 Tee to Multiple Destinations</a></li>
<li><a href="#72-logging-to-console-and-file">7.2 Logging to Console and File</a></li>
<li><a href="#73-reading-and-writing-same-file-safely">7.3 Reading and Writing Same File Safely</a></li>
<li><a href="#74-atomic-file-writes">7.4 Atomic File Writes</a></li>
<li><a href="#75-file-locking-for-safe-concurrent-access">7.5 File Locking for Safe Concurrent Access</a></li>
<li><a href="#76-progress-indication-with-fifos">7.6 Progress Indication with FIFOs</a></li>
</ul>
</li>
<li><a href="#practice-problems">Practice Problems</a><ul>
<li><a href="#problem-1-multi-target-logger">Problem 1: Multi-Target Logger</a></li>
<li><a href="#problem-2-pipeline-monitor">Problem 2: Pipeline Monitor</a></li>
<li><a href="#problem-3-fifo-based-queue-system">Problem 3: FIFO-Based Queue System</a></li>
<li><a href="#problem-4-configuration-validator">Problem 4: Configuration Validator</a></li>
<li><a href="#problem-5-stream-processor-with-fds">Problem 5: Stream Processor with FDs</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="lesson-06-io-and-redirection">Lesson 06: I/O and Redirection<a class="header-link" href="#lesson-06-io-and-redirection" title="Permanent link">&para;</a></h1>
<p><strong>Difficulty</strong>: ‚≠ê‚≠ê‚≠ê</p>
<p><strong>Previous</strong>: <a href="./05_Functions_and_Libraries.md">05_Functions_and_Libraries.md</a> | <strong>Next</strong>: <a href="./07_String_Processing.md">07_String_Processing.md</a></p>
<hr />
<h2 id="1-file-descriptors">1. File Descriptors<a class="header-link" href="#1-file-descriptors" title="Permanent link">&para;</a></h2>
<p>File descriptors (FDs) are integers that reference open files or I/O streams. Understanding them is fundamental to mastering I/O redirection in bash.</p>
<h3 id="11-standard-file-descriptors">1.1 Standard File Descriptors<a class="header-link" href="#11-standard-file-descriptors" title="Permanent link">&para;</a></h3>
<p>Every process has three standard file descriptors:</p>
<table>
<thead>
<tr>
<th>FD</th>
<th>Name</th>
<th>Purpose</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>stdin</td>
<td>Standard input</td>
<td>Keyboard</td>
</tr>
<tr>
<td>1</td>
<td>stdout</td>
<td>Standard output</td>
<td>Terminal</td>
</tr>
<tr>
<td>2</td>
<td>stderr</td>
<td>Standard error</td>
<td>Terminal</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Read from stdin (FD 0)</span>
<span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Enter your name: &quot;</span><span class="w"> </span>name
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello, </span><span class="nv">$name</span><span class="s2">&quot;</span>

<span class="c1"># Write to stdout (FD 1)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This goes to stdout&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w">  </span><span class="c1"># Explicit (same as just echo)</span>

<span class="c1"># Write to stderr (FD 2)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This is an error message&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
</code></pre></div>

<h3 id="12-custom-file-descriptors">1.2 Custom File Descriptors<a class="header-link" href="#12-custom-file-descriptors" title="Permanent link">&para;</a></h3>
<p>You can create custom file descriptors (3-9 are commonly used):</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Open file for reading on FD 3</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&lt;<span class="w"> </span>input.txt

<span class="c1"># Read from FD 3</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-u<span class="w"> </span><span class="m">3</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Line: </span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="k">done</span>

<span class="c1"># Close FD 3</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&lt;<span class="p">&amp;</span>-

<span class="c1"># Open file for writing on FD 4</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">4</span>&gt;<span class="w"> </span>output.txt

<span class="c1"># Write to FD 4</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;First line&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">4</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Second line&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">4</span>

<span class="c1"># Close FD 4</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">4</span>&gt;<span class="p">&amp;</span>-
</code></pre></div>

<h3 id="13-opening-file-descriptors-for-readwrite">1.3 Opening File Descriptors for Read/Write<a class="header-link" href="#13-opening-file-descriptors-for-readwrite" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Open file for both reading and writing on FD 5</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">5</span>&lt;&gt;<span class="w"> </span>datafile.txt

<span class="c1"># Read current content</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-u<span class="w"> </span><span class="m">5</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Read: </span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="k">done</span>

<span class="c1"># Write new content (appends)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;New data&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">5</span>

<span class="c1"># Close FD 5</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">5</span>&gt;<span class="p">&amp;</span>-
</code></pre></div>

<h3 id="14-duplicating-file-descriptors">1.4 Duplicating File Descriptors<a class="header-link" href="#14-duplicating-file-descriptors" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Duplicate stdout (FD 1) to FD 3</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="c1"># Now redirect stdout to a file</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">1</span>&gt;<span class="w"> </span>output.log

<span class="c1"># This goes to output.log</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Logging to file&quot;</span>

<span class="c1"># This still goes to terminal (via FD 3)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Direct to terminal&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">3</span>

<span class="c1"># Restore stdout from FD 3</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">3</span>

<span class="c1"># Close FD 3</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-

<span class="c1"># Now back to terminal</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Back to normal stdout&quot;</span>
</code></pre></div>

<h3 id="15-file-descriptor-inspection">1.5 File Descriptor Inspection<a class="header-link" href="#15-file-descriptor-inspection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># View file descriptors for current shell</span>
ls<span class="w"> </span>-l<span class="w"> </span>/dev/fd/
<span class="c1"># or</span>
ls<span class="w"> </span>-l<span class="w"> </span>/proc/self/fd/

<span class="c1"># Check if FD is open</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-e<span class="w"> </span>/dev/fd/3<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;FD 3 is open&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;FD 3 is closed&quot;</span>
<span class="k">fi</span>

<span class="c1"># Get information about FD</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">5</span>&gt;<span class="w"> </span>myfile.txt
readlink<span class="w"> </span>/proc/self/fd/5<span class="w">  </span><span class="c1"># Shows the file path</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">5</span>&gt;<span class="p">&amp;</span>-
</code></pre></div>

<h2 id="2-advanced-redirection">2. Advanced Redirection<a class="header-link" href="#2-advanced-redirection" title="Permanent link">&para;</a></h2>
<p>Beyond basic <code>&gt;</code> and <code>&lt;</code>, bash offers powerful redirection operators.</p>
<h3 id="21-redirecting-stderr-separately">2.1 Redirecting Stderr Separately<a class="header-link" href="#21-redirecting-stderr-separately" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Redirect stdout to file1, stderr to file2</span>
<span class="nb">command</span><span class="w"> </span>&gt;<span class="w"> </span>stdout.log<span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>stderr.log

<span class="c1"># Example: compile C program</span>
gcc<span class="w"> </span>program.c<span class="w"> </span>-o<span class="w"> </span>program<span class="w"> </span>&gt;<span class="w"> </span>compile_output.txt<span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>compile_errors.txt

<span class="c1"># Check if compilation had errors</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-s<span class="w"> </span>compile_errors.txt<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Compilation failed:&quot;</span>
<span class="w">    </span>cat<span class="w"> </span>compile_errors.txt
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Compilation successful!&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="22-merging-stdout-and-stderr">2.2 Merging Stdout and Stderr<a class="header-link" href="#22-merging-stdout-and-stderr" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Method 1: Redirect stderr to stdout</span>
<span class="nb">command</span><span class="w"> </span>&gt;<span class="w"> </span>output.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="c1"># Method 2: Shorthand (Bash 4+)</span>
<span class="nb">command</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>output.log

<span class="c1"># Method 3: Append both</span>
<span class="nb">command</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>output.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="c1"># Example: run test suite</span>
./run_tests.sh<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>test_results.log

<span class="c1"># This is WRONG (order matters):</span>
<span class="nb">command</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>output.log<span class="w">  </span><span class="c1"># stderr still goes to terminal!</span>
<span class="c1"># Correct:</span>
<span class="nb">command</span><span class="w"> </span>&gt;<span class="w"> </span>output.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w">  </span><span class="c1"># stderr follows stdout to file</span>
</code></pre></div>

<h3 id="23-discarding-output">2.3 Discarding Output<a class="header-link" href="#23-discarding-output" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Discard stdout</span>
<span class="nb">command</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="c1"># Discard stderr</span>
<span class="nb">command</span><span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>/dev/null

<span class="c1"># Discard both</span>
<span class="nb">command</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null

<span class="c1"># Example: silent operation</span>
<span class="k">if</span><span class="w"> </span>some_command<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Command succeeded (silently)&quot;</span>
<span class="k">fi</span>

<span class="c1"># Keep stderr, discard stdout</span>
<span class="nb">command</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="c1"># Example: check if command exists</span>
<span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>python3<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;python3 is installed&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="24-swapping-stdout-and-stderr">2.4 Swapping Stdout and Stderr<a class="header-link" href="#24-swapping-stdout-and-stderr" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Swap stdout and stderr</span>
<span class="nb">command</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-

<span class="c1"># Explanation:</span>
<span class="c1"># 3&gt;&amp;1  - Save stdout to FD 3</span>
<span class="c1"># 1&gt;&amp;2  - Redirect stdout to stderr</span>
<span class="c1"># 2&gt;&amp;3  - Redirect stderr to FD 3 (original stdout)</span>
<span class="c1"># 3&gt;&amp;-  - Close FD 3</span>

<span class="c1"># Practical example: error messages to stdout, normal output to stderr</span>
swap_outputs<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-
<span class="o">}</span>

<span class="c1"># Now errors appear on stdout (can be captured)</span>
<span class="nv">errors</span><span class="o">=</span><span class="k">$(</span>swap_outputs<span class="w"> </span>some_command<span class="k">)</span>
</code></pre></div>

<h3 id="25-saving-and-restoring-file-descriptors">2.5 Saving and Restoring File Descriptors<a class="header-link" href="#25-saving-and-restoring-file-descriptors" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Save original stdout and stderr</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="m">4</span>&gt;<span class="p">&amp;</span><span class="m">2</span>

<span class="c1"># Redirect stdout and stderr to files</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">1</span>&gt;<span class="w"> </span>output.log<span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>error.log

<span class="c1"># Commands here write to log files</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This goes to output.log&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This is an error&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>

<span class="c1"># Restore original stdout and stderr</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">4</span>

<span class="c1"># Close backup FDs</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-<span class="w"> </span><span class="m">4</span>&gt;<span class="p">&amp;</span>-

<span class="c1"># Now back to terminal</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Back to terminal&quot;</span>
</code></pre></div>

<h3 id="26-appending-vs-truncating">2.6 Appending vs Truncating<a class="header-link" href="#26-appending-vs-truncating" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Truncate file (overwrite)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;New content&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>file.txt

<span class="c1"># Append to file</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Additional content&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>file.txt

<span class="c1"># Append stderr</span>
<span class="nb">command</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="w"> </span>error.log

<span class="c1"># Append both stdout and stderr</span>
<span class="nb">command</span><span class="w"> </span><span class="p">&amp;</span>&gt;&gt;<span class="w"> </span>output.log
</code></pre></div>

<h2 id="3-here-documents-and-here-strings">3. Here Documents and Here Strings<a class="header-link" href="#3-here-documents-and-here-strings" title="Permanent link">&para;</a></h2>
<p>Here documents provide multi-line input to commands without creating temporary files.</p>
<h3 id="31-basic-here-document">3.1 Basic Here Document<a class="header-link" href="#31-basic-here-document" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Basic here document</span>
cat<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">This is a multi-line</span>
<span class="s">here document.</span>
<span class="s">It can contain variables: $HOME</span>
<span class="s">And command substitution: $(date)</span>
<span class="s">EOF</span>

<span class="c1"># With indentation (&lt;&lt;- removes leading tabs, not spaces)</span>
cat<span class="w"> </span><span class="s">&lt;&lt;-EOF</span>
<span class="s">    This is indented with tabs</span>
<span class="s">    The tabs will be removed</span>
<span class="s">    But the text stays aligned</span>
<span class="s">EOF</span>
</code></pre></div>

<h3 id="32-here-document-without-variable-expansion">3.2 Here Document Without Variable Expansion<a class="header-link" href="#32-here-document-without-variable-expansion" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Quote the delimiter to prevent expansion</span>
cat<span class="w"> </span><span class="s">&lt;&lt;&#39;EOF&#39;</span>
<span class="s">Variables are literal: $HOME</span>
<span class="s">Command substitution is literal: $(date)</span>
<span class="s">This is useful for generating scripts or code.</span>
<span class="s">EOF</span>

<span class="c1"># Example: generate a bash script</span>
cat<span class="w"> </span><span class="s">&lt;&lt;&#39;SCRIPT&#39; &gt; myscript.sh</span>
<span class="s">#!/bin/bash</span>
<span class="s">echo &quot;Hello from generated script&quot;</span>
<span class="s">echo &quot;Current directory: $PWD&quot;</span>
<span class="s">SCRIPT</span>

chmod<span class="w"> </span>+x<span class="w"> </span>myscript.sh
</code></pre></div>

<h3 id="33-here-document-to-variables">3.3 Here Document to Variables<a class="header-link" href="#33-here-document-to-variables" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Assign here document to variable</span>
<span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>sql_query<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">SELECT u.name, u.email, o.order_id</span>
<span class="s">FROM users u</span>
<span class="s">JOIN orders o ON u.id = o.user_id</span>
<span class="s">WHERE o.status = &#39;pending&#39;</span>
<span class="s">ORDER BY o.created_at DESC</span>
<span class="s">LIMIT 10;</span>
<span class="s">EOF</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Executing query:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$sql_query</span><span class="s2">&quot;</span>

<span class="c1"># Alternative method (using command substitution)</span>
<span class="nv">json_data</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">{</span>
<span class="s">    &quot;name&quot;: &quot;John Doe&quot;,</span>
<span class="s">    &quot;email&quot;: &quot;john@example.com&quot;,</span>
<span class="s">    &quot;age&quot;: 30,</span>
<span class="s">    &quot;roles&quot;: [&quot;admin&quot;, &quot;user&quot;]</span>
<span class="s">}</span>
<span class="s">EOF</span>
<span class="k">)</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$json_data</span><span class="s2">&quot;</span>
</code></pre></div>

<h3 id="34-here-document-with-command-input">3.4 Here Document with Command Input<a class="header-link" href="#34-here-document-with-command-input" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Send multi-line input to a command</span>
mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p<span class="w"> </span><span class="s">&lt;&lt;SQL</span>
<span class="s">USE mydb;</span>
<span class="s">CREATE TABLE IF NOT EXISTS users (</span>
<span class="s">    id INT PRIMARY KEY AUTO_INCREMENT,</span>
<span class="s">    username VARCHAR(50) NOT NULL,</span>
<span class="s">    email VARCHAR(100) NOT NULL,</span>
<span class="s">    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
<span class="s">);</span>
<span class="s">INSERT INTO users (username, email) VALUES (&#39;alice&#39;, &#39;alice@example.com&#39;);</span>
<span class="s">SQL</span>

<span class="c1"># Python script execution</span>
python3<span class="w"> </span><span class="s">&lt;&lt;PYTHON</span>
<span class="s">import sys</span>
<span class="s">import json</span>

<span class="s">data = {</span>
<span class="s">    &#39;message&#39;: &#39;Hello from Python&#39;,</span>
<span class="s">    &#39;version&#39;: sys.version</span>
<span class="s">}</span>

<span class="s">print(json.dumps(data, indent=2))</span>
<span class="s">PYTHON</span>
</code></pre></div>

<h3 id="35-here-strings">3.5 Here Strings<a class="header-link" href="#35-here-strings" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Here string: single-line input</span>
grep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;This is a test pattern string&quot;</span>

<span class="c1"># Useful for piping variables</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>word<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Word: </span><span class="nv">$word</span><span class="s2">&quot;</span>
<span class="k">done</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;one two three four five&quot;</span>

<span class="c1"># Example: parse CSV line</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>name<span class="w"> </span>age<span class="w"> </span>city<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;John,30,NYC&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Name: </span><span class="nv">$name</span><span class="s2">, Age: </span><span class="nv">$age</span><span class="s2">, City: </span><span class="nv">$city</span><span class="s2">&quot;</span>

<span class="c1"># Base64 encode a string</span>
<span class="nv">encoded</span><span class="o">=</span><span class="k">$(</span>base64<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;Secret message&quot;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Encoded: </span><span class="nv">$encoded</span><span class="s2">&quot;</span>

<span class="c1"># Decode it back</span>
<span class="nv">decoded</span><span class="o">=</span><span class="k">$(</span>base64<span class="w"> </span>-d<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$encoded</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Decoded: </span><span class="nv">$decoded</span><span class="s2">&quot;</span>
</code></pre></div>

<h3 id="36-practical-template-generation">3.6 Practical Template Generation<a class="header-link" href="#36-practical-template-generation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

generate_html<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">title</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">content</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span>cat<span class="w"> </span><span class="s">&lt;&lt;HTML</span>
<span class="s">&lt;!DOCTYPE html&gt;</span>
<span class="s">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="s">&lt;head&gt;</span>
<span class="s">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="s">    &lt;title&gt;$title&lt;/title&gt;</span>
<span class="s">&lt;/head&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">    &lt;h1&gt;$title&lt;/h1&gt;</span>
<span class="s">    &lt;p&gt;$content&lt;/p&gt;</span>
<span class="s">    &lt;footer&gt;Generated on $(date)&lt;/footer&gt;</span>
<span class="s">&lt;/body&gt;</span>
<span class="s">&lt;/html&gt;</span>
<span class="s">HTML</span>
<span class="o">}</span>

<span class="c1"># Generate HTML page</span>
generate_html<span class="w"> </span><span class="s2">&quot;My Page&quot;</span><span class="w"> </span><span class="s2">&quot;Welcome to my website!&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>index.html

<span class="c1"># Generate configuration file</span>
generate_config<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">host</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">port</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span>cat<span class="w"> </span><span class="s">&lt;&lt;CONFIG &gt; app.conf</span>
<span class="s"># Application Configuration</span>
<span class="s"># Generated: $(date)</span>

<span class="s">[server]</span>
<span class="s">host = $host</span>
<span class="s">port = $port</span>
<span class="s">workers = 4</span>

<span class="s">[database]</span>
<span class="s">host = localhost</span>
<span class="s">port = 5432</span>
<span class="s">name = myapp</span>

<span class="s">[logging]</span>
<span class="s">level = INFO</span>
<span class="s">file = /var/log/myapp.log</span>
<span class="s">CONFIG</span>
<span class="o">}</span>

generate_config<span class="w"> </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="w"> </span><span class="s2">&quot;8080&quot;</span>
</code></pre></div>

<h2 id="4-process-substitution">4. Process Substitution<a class="header-link" href="#4-process-substitution" title="Permanent link">&para;</a></h2>
<p>Process substitution creates temporary named pipes for command output, allowing commands to be used where files are expected.</p>
<h3 id="41-input-process-substitution">4.1 Input Process Substitution<a class="header-link" href="#41-input-process-substitution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Compare output of two commands</span>
diff<span class="w"> </span>&lt;<span class="o">(</span>ls<span class="w"> </span>dir1<span class="o">)</span><span class="w"> </span>&lt;<span class="o">(</span>ls<span class="w"> </span>dir2<span class="o">)</span>

<span class="c1"># More complex example: compare sorted lists</span>
diff<span class="w"> </span>&lt;<span class="o">(</span>sort<span class="w"> </span>file1.txt<span class="o">)</span><span class="w"> </span>&lt;<span class="o">(</span>sort<span class="w"> </span>file2.txt<span class="o">)</span>

<span class="c1"># Compare running processes on two systems</span>
diff<span class="w"> </span>&lt;<span class="o">(</span>ssh<span class="w"> </span>server1<span class="w"> </span>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="o">)</span><span class="w"> </span>&lt;<span class="o">(</span>ssh<span class="w"> </span>server2<span class="w"> </span>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="o">)</span>

<span class="c1"># Example: find common lines in two command outputs</span>
comm<span class="w"> </span>-12<span class="w"> </span>&lt;<span class="o">(</span>sort<span class="w"> </span>list1.txt<span class="o">)</span><span class="w"> </span>&lt;<span class="o">(</span>sort<span class="w"> </span>list2.txt<span class="o">)</span>
</code></pre></div>

<h3 id="42-output-process-substitution">4.2 Output Process Substitution<a class="header-link" href="#42-output-process-substitution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Write to multiple files simultaneously</span>
tee<span class="w"> </span>&gt;<span class="o">(</span>grep<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>errors.log<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&gt;<span class="o">(</span>grep<span class="w"> </span><span class="s2">&quot;WARN&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>warnings.log<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&gt;<span class="o">(</span>grep<span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>info.log<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&lt;<span class="w"> </span>application.log<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="c1"># Example: split log by severity</span>
process_logs<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">logfile</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$logfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>&gt;<span class="o">(</span>grep<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>errors.log<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>&gt;<span class="o">(</span>grep<span class="w"> </span><span class="s2">&quot;WARN&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>warnings.log<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>&gt;<span class="w"> </span>all.log
<span class="o">}</span>
</code></pre></div>

<h3 id="43-avoiding-subshell-variable-scope-issues">4.3 Avoiding Subshell Variable Scope Issues<a class="header-link" href="#43-avoiding-subshell-variable-scope-issues" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># PROBLEM: Variables in pipeline are in subshell</span>
<span class="nv">count</span><span class="o">=</span><span class="m">0</span>
cat<span class="w"> </span>file.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span>count++<span class="o">))</span>
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Lines: </span><span class="nv">$count</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Output: 0 (variable not modified!)</span>

<span class="c1"># SOLUTION 1: Process substitution</span>
<span class="nv">count</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span>count++<span class="o">))</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>cat<span class="w"> </span>file.txt<span class="o">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Lines: </span><span class="nv">$count</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Correct count</span>

<span class="c1"># SOLUTION 2: Use here string with command substitution (for small files)</span>
<span class="nv">count</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span>count++<span class="o">))</span>
<span class="k">done</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>file.txt<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Lines: </span><span class="nv">$count</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Correct count</span>
</code></pre></div>

<h3 id="44-multiple-input-streams">4.4 Multiple Input Streams<a class="header-link" href="#44-multiple-input-streams" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Read from multiple files in parallel</span>
paste<span class="w"> </span>&lt;<span class="o">(</span>cut<span class="w"> </span>-d<span class="s1">&#39;,&#39;</span><span class="w"> </span>-f1<span class="w"> </span>file1.csv<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>&lt;<span class="o">(</span>cut<span class="w"> </span>-d<span class="s1">&#39;,&#39;</span><span class="w"> </span>-f2<span class="w"> </span>file2.csv<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span>&lt;<span class="o">(</span>cut<span class="w"> </span>-d<span class="s1">&#39;,&#39;</span><span class="w"> </span>-f3<span class="w"> </span>file3.csv<span class="o">)</span>

<span class="c1"># Example: merge data from multiple sources</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-u<span class="w"> </span><span class="m">3</span><span class="w"> </span>name<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-u<span class="w"> </span><span class="m">4</span><span class="w"> </span>age<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-u<span class="w"> </span><span class="m">5</span><span class="w"> </span>city<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$name</span><span class="s2"> is </span><span class="nv">$age</span><span class="s2"> years old and lives in </span><span class="nv">$city</span><span class="s2">&quot;</span>
<span class="k">done</span><span class="w"> </span><span class="m">3</span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>cut<span class="w"> </span>-d<span class="s1">&#39;,&#39;</span><span class="w"> </span>-f1<span class="w"> </span>data.csv<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span><span class="m">4</span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>cut<span class="w"> </span>-d<span class="s1">&#39;,&#39;</span><span class="w"> </span>-f2<span class="w"> </span>data.csv<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span><span class="m">5</span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>cut<span class="w"> </span>-d<span class="s1">&#39;,&#39;</span><span class="w"> </span>-f3<span class="w"> </span>data.csv<span class="o">)</span>
</code></pre></div>

<h3 id="45-practical-examples">4.5 Practical Examples<a class="header-link" href="#45-practical-examples" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Example 1: Find files modified in last 24 hours that contain pattern</span>
grep<span class="w"> </span><span class="s2">&quot;TODO&quot;</span><span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span>.<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>-1<span class="w"> </span>-exec<span class="w"> </span>cat<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="o">)</span>

<span class="c1"># Example 2: Monitor log file and send alerts</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$line</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;CRITICAL&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Alert: </span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Critical Error&quot;</span><span class="w"> </span>admin@example.com
<span class="w">    </span><span class="k">fi</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/app.log<span class="o">)</span>

<span class="c1"># Example 3: Process compressed file without extracting</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Processing: </span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>gunzip<span class="w"> </span>-c<span class="w"> </span>data.txt.gz<span class="o">)</span>

<span class="c1"># Example 4: Create temporary file list for processing</span>
tar<span class="w"> </span>czf<span class="w"> </span>backup.tar.gz<span class="w"> </span>-T<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span>/data<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>-7<span class="o">)</span>
</code></pre></div>

<h2 id="5-named-pipes-fifos">5. Named Pipes (FIFOs)<a class="header-link" href="#5-named-pipes-fifos" title="Permanent link">&para;</a></h2>
<p>Named pipes allow inter-process communication through the filesystem.</p>
<h3 id="51-creating-and-using-fifos">5.1 Creating and Using FIFOs<a class="header-link" href="#51-creating-and-using-fifos" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Create named pipe</span>
mkfifo<span class="w"> </span>mypipe

<span class="c1"># Producer (background process)</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..10<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Message </span><span class="nv">$i</span><span class="s2">&quot;</span>
<span class="w">        </span>sleep<span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&gt;<span class="w"> </span>mypipe
<span class="o">}</span><span class="w"> </span><span class="p">&amp;</span>

<span class="c1"># Consumer</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Received: </span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>mypipe

<span class="c1"># Cleanup</span>
rm<span class="w"> </span>mypipe
</code></pre></div>

<h3 id="52-producer-consumer-pattern">5.2 Producer-Consumer Pattern<a class="header-link" href="#52-producer-consumer-pattern" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nv">PIPE</span><span class="o">=</span><span class="s2">&quot;/tmp/data_pipe_</span><span class="nv">$$</span><span class="s2">&quot;</span>

<span class="c1"># Create pipe and set trap for cleanup</span>
mkfifo<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PIPE</span><span class="s2">&quot;</span>
<span class="nb">trap</span><span class="w"> </span><span class="s2">&quot;rm -f &#39;</span><span class="nv">$PIPE</span><span class="s2">&#39;&quot;</span><span class="w"> </span>EXIT

<span class="c1"># Producer: generate data</span>
producer<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">pipe</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Producer starting...&quot;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..100<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Data item </span><span class="nv">$i</span><span class="s2">: </span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">        </span>sleep<span class="w"> </span><span class="m">0</span>.1
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pipe</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Producer finished&quot;</span>
<span class="o">}</span>

<span class="c1"># Consumer: process data</span>
consumer<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">pipe</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Consumer starting...&quot;</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">0</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="o">((</span>count++<span class="o">))</span>
<span class="w">        </span><span class="c1"># Process data (simulate work)</span>
<span class="w">        </span><span class="o">[[</span><span class="w"> </span><span class="k">$((</span><span class="nv">count</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">10</span><span class="k">))</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Processed </span><span class="nv">$count</span><span class="s2"> items&quot;</span>
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pipe</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Consumer finished: </span><span class="nv">$count</span><span class="s2"> items processed&quot;</span>
<span class="o">}</span>

<span class="c1"># Run producer in background</span>
producer<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PIPE</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>
<span class="nv">producer_pid</span><span class="o">=</span><span class="nv">$!</span>

<span class="c1"># Run consumer in foreground</span>
consumer<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PIPE</span><span class="s2">&quot;</span>

<span class="c1"># Wait for producer to finish</span>
<span class="nb">wait</span><span class="w"> </span><span class="nv">$producer_pid</span>
</code></pre></div>

<h3 id="53-bidirectional-communication">5.3 Bidirectional Communication<a class="header-link" href="#53-bidirectional-communication" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nv">REQUEST_PIPE</span><span class="o">=</span><span class="s2">&quot;/tmp/request_</span><span class="nv">$$</span><span class="s2">&quot;</span>
<span class="nv">RESPONSE_PIPE</span><span class="o">=</span><span class="s2">&quot;/tmp/response_</span><span class="nv">$$</span><span class="s2">&quot;</span>

<span class="c1"># Create pipes</span>
mkfifo<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$REQUEST_PIPE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESPONSE_PIPE</span><span class="s2">&quot;</span>
<span class="nb">trap</span><span class="w"> </span><span class="s2">&quot;rm -f &#39;</span><span class="nv">$REQUEST_PIPE</span><span class="s2">&#39; &#39;</span><span class="nv">$RESPONSE_PIPE</span><span class="s2">&#39;&quot;</span><span class="w"> </span>EXIT

<span class="c1"># Server process</span>
server<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Server started&quot;</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="c1"># Read request</span>
<span class="w">        </span><span class="nb">read</span><span class="w"> </span>request<span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$REQUEST_PIPE</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Process request</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nv">$request</span><span class="w"> </span><span class="k">in</span>
<span class="w">            </span><span class="s2">&quot;PING&quot;</span><span class="o">)</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;PONG&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESPONSE_PIPE</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="p">;;</span>
<span class="w">            </span><span class="s2">&quot;TIME&quot;</span><span class="o">)</span>
<span class="w">                </span>date<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESPONSE_PIPE</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="p">;;</span>
<span class="w">            </span><span class="s2">&quot;QUIT&quot;</span><span class="o">)</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;BYE&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESPONSE_PIPE</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">                </span><span class="p">;;</span>
<span class="w">            </span>*<span class="o">)</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Unknown command&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESPONSE_PIPE</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="p">;;</span>
<span class="w">        </span><span class="k">esac</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Server stopped&quot;</span>
<span class="o">}</span>

<span class="c1"># Client function</span>
client<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">command</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span><span class="c1"># Send request</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$command</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$REQUEST_PIPE</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Read response</span>
<span class="w">    </span><span class="nb">read</span><span class="w"> </span>response<span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESPONSE_PIPE</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Response: </span><span class="nv">$response</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Start server in background</span>
server<span class="w"> </span><span class="p">&amp;</span>
<span class="nv">server_pid</span><span class="o">=</span><span class="nv">$!</span>

sleep<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># Give server time to start</span>

<span class="c1"># Send requests</span>
client<span class="w"> </span><span class="s2">&quot;PING&quot;</span>
client<span class="w"> </span><span class="s2">&quot;TIME&quot;</span>
client<span class="w"> </span><span class="s2">&quot;QUIT&quot;</span>

<span class="c1"># Wait for server</span>
<span class="nb">wait</span><span class="w"> </span><span class="nv">$server_pid</span>
</code></pre></div>

<h3 id="54-when-to-use-fifos-vs-process-substitution">5.4 When to Use FIFOs vs Process Substitution<a class="header-link" href="#54-when-to-use-fifos-vs-process-substitution" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>FIFO</th>
<th>Process Substitution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Persistence</td>
<td>Yes (until deleted)</td>
<td>No (automatic cleanup)</td>
</tr>
<tr>
<td>Multiple readers/writers</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Explicit synchronization</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Use in background</td>
<td>Easy</td>
<td>Complex</td>
</tr>
<tr>
<td>Cleanup required</td>
<td>Manual</td>
<td>Automatic</td>
</tr>
<tr>
<td>Best for</td>
<td>Long-running IPC</td>
<td>One-time operations</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Use process substitution for one-time comparison</span>
diff<span class="w"> </span>&lt;<span class="o">(</span>command1<span class="o">)</span><span class="w"> </span>&lt;<span class="o">(</span>command2<span class="o">)</span>

<span class="c1"># Use FIFO for persistent communication</span>
mkfifo<span class="w"> </span>/tmp/logpipe
tail<span class="w"> </span>-f<span class="w"> </span>/var/log/app.log<span class="w"> </span>&gt;<span class="w"> </span>/tmp/logpipe<span class="w"> </span><span class="p">&amp;</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>process_log_line<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>/tmp/logpipe
</code></pre></div>

<h2 id="6-pipe-pitfalls-and-solutions">6. Pipe Pitfalls and Solutions<a class="header-link" href="#6-pipe-pitfalls-and-solutions" title="Permanent link">&para;</a></h2>
<h3 id="61-subshell-variable-scope-loss">6.1 Subshell Variable Scope Loss<a class="header-link" href="#61-subshell-variable-scope-loss" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># PROBLEM: Last command in pipeline runs in subshell</span>
<span class="nv">total</span><span class="o">=</span><span class="m">0</span>
cat<span class="w"> </span>numbers.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>num<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span><span class="nv">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>num<span class="o">))</span>
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Total: </span><span class="nv">$total</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Output: 0 (not modified!)</span>

<span class="c1"># SOLUTION 1: Process substitution</span>
<span class="nv">total</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>num<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span><span class="nv">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>num<span class="o">))</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>cat<span class="w"> </span>numbers.txt<span class="o">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Total: </span><span class="nv">$total</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Correct</span>

<span class="c1"># SOLUTION 2: Use lastpipe (Bash 4.2+, only in scripts)</span>
<span class="nb">shopt</span><span class="w"> </span>-s<span class="w"> </span>lastpipe
<span class="nv">total</span><span class="o">=</span><span class="m">0</span>
cat<span class="w"> </span>numbers.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>num<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span><span class="nv">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>num<span class="o">))</span>
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Total: </span><span class="nv">$total</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Correct</span>

<span class="c1"># SOLUTION 3: Temporary file</span>
<span class="nv">tmpfile</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
cat<span class="w"> </span>numbers.txt<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span>
<span class="nv">total</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>num<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span><span class="nv">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>num<span class="o">))</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span>
rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Total: </span><span class="nv">$total</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Correct</span>
</code></pre></div>

<h3 id="62-pipestatus-array">6.2 PIPESTATUS Array<a class="header-link" href="#62-pipestatus-array" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check exit status of all pipeline commands</span>
command1<span class="w"> </span><span class="p">|</span><span class="w"> </span>command2<span class="w"> </span><span class="p">|</span><span class="w"> </span>command3

<span class="c1"># PIPESTATUS contains exit codes of all commands</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Exit codes: </span><span class="si">${</span><span class="nv">PIPESTATUS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Example: detect failure anywhere in pipeline</span>
<span class="nb">false</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nb">true</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">PIPESTATUS</span><span class="p">[0]</span><span class="si">}</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;First command failed&quot;</span>
<span class="k">fi</span>

<span class="c1"># Practical example: database pipeline</span>
<span class="o">{</span>
<span class="w">    </span>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p<span class="w"> </span>mydb<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;SELECT * FROM users&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>grep<span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sort<span class="w"> </span>-k2
<span class="o">}</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null

<span class="nv">pipeline_status</span><span class="o">=(</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PIPESTATUS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">pipeline_status</span><span class="p">[0]</span><span class="si">}</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Database query failed&quot;</span>
<span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">pipeline_status</span><span class="p">[1]</span><span class="si">}</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Grep failed&quot;</span>
<span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">pipeline_status</span><span class="p">[2]</span><span class="si">}</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Sort failed&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Pipeline succeeded&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="63-pipeline-error-handling">6.3 Pipeline Error Handling<a class="header-link" href="#63-pipeline-error-handling" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Enable pipefail: pipeline fails if any command fails</span>
<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>pipefail

<span class="c1"># Now the pipeline returns non-zero if any command fails</span>
<span class="k">if</span><span class="w"> </span>command1<span class="w"> </span><span class="p">|</span><span class="w"> </span>command2<span class="w"> </span><span class="p">|</span><span class="w"> </span>command3<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Pipeline succeeded&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Pipeline failed&quot;</span>
<span class="k">fi</span>

<span class="c1"># Practical example: safe data processing</span>
<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail<span class="w">  </span><span class="c1"># Exit on error, undefined variable, or pipeline failure</span>

process_data<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">input</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$input</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^#&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>sort<span class="w"> </span>-u<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>sed<span class="w"> </span><span class="s1">&#39;s/foo/bar/g&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># If any command fails, script exits</span>
<span class="o">}</span>

<span class="c1"># Error handling with pipefail</span>
<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>pipefail
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>tar<span class="w"> </span>czf<span class="w"> </span>backup.tar.gz<span class="w"> </span>--exclude<span class="o">=</span><span class="s2">&quot;*.tmp&quot;</span><span class="w"> </span>-T<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span>/data<span class="w"> </span>-type<span class="w"> </span>f<span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup failed&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="64-named-pipe-deadlock-prevention">6.4 Named Pipe Deadlock Prevention<a class="header-link" href="#64-named-pipe-deadlock-prevention" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># PROBLEM: Deadlock if reader/writer not coordinated</span>
mkfifo<span class="w"> </span>mypipe
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>mypipe<span class="w">  </span><span class="c1"># BLOCKS forever (no reader)!</span>

<span class="c1"># SOLUTION 1: Open pipe for reading and writing</span>
mkfifo<span class="w"> </span>mypipe
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&lt;&gt;<span class="w"> </span>mypipe<span class="w">  </span><span class="c1"># Open for read/write</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">3</span><span class="w">  </span><span class="c1"># Write</span>
<span class="nb">read</span><span class="w"> </span>line<span class="w"> </span>&lt;<span class="p">&amp;</span><span class="m">3</span><span class="w">    </span><span class="c1"># Read</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">3</span>&gt;<span class="p">&amp;</span>-<span class="w">        </span><span class="c1"># Close</span>

rm<span class="w"> </span>mypipe

<span class="c1"># SOLUTION 2: Background processes with proper synchronization</span>
mkfifo<span class="w"> </span>mypipe
<span class="nb">trap</span><span class="w"> </span><span class="s2">&quot;rm -f mypipe&quot;</span><span class="w"> </span>EXIT

<span class="c1"># Reader in background</span>
cat<span class="w"> </span>&lt;<span class="w"> </span>mypipe<span class="w"> </span><span class="p">&amp;</span>
<span class="nv">reader_pid</span><span class="o">=</span><span class="nv">$!</span>

<span class="c1"># Writer</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>mypipe

<span class="c1"># Wait for reader</span>
<span class="nb">wait</span><span class="w"> </span><span class="nv">$reader_pid</span>
</code></pre></div>

<h2 id="7-practical-io-patterns">7. Practical I/O Patterns<a class="header-link" href="#7-practical-io-patterns" title="Permanent link">&para;</a></h2>
<h3 id="71-tee-to-multiple-destinations">7.1 Tee to Multiple Destinations<a class="header-link" href="#71-tee-to-multiple-destinations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Basic tee: write to file and stdout</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Important message&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>log.txt

<span class="c1"># Multiple files</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Message&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>file1.txt<span class="w"> </span>file2.txt<span class="w"> </span>file3.txt

<span class="c1"># Append mode</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;New entry&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>logfile.txt

<span class="c1"># Complex example: split processing</span>
cat<span class="w"> </span>data.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&gt;<span class="o">(</span>grep<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>errors.log<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&gt;<span class="o">(</span>grep<span class="w"> </span><span class="s2">&quot;WARN&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>warnings.log<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&gt;<span class="o">(</span>wc<span class="w"> </span>-l<span class="w"> </span>&gt;<span class="w"> </span>linecount.txt<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>info.log
</code></pre></div>

<h3 id="72-logging-to-console-and-file">7.2 Logging to Console and File<a class="header-link" href="#72-logging-to-console-and-file" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Setup logging</span>
<span class="nv">LOGFILE</span><span class="o">=</span><span class="s2">&quot;application.log&quot;</span>

log<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">level</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">shift</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">message</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">timestamp</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="c1"># Log to both console and file</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[</span><span class="nv">$timestamp</span><span class="s2">] [</span><span class="nv">$level</span><span class="s2">] </span><span class="nv">$message</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
log<span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="w"> </span><span class="s2">&quot;Application started&quot;</span>
log<span class="w"> </span><span class="s2">&quot;WARN&quot;</span><span class="w"> </span><span class="s2">&quot;Configuration file not found, using defaults&quot;</span>
log<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="w"> </span><span class="s2">&quot;Failed to connect to database&quot;</span>

<span class="c1"># Alternative: redirect all output</span>
<span class="nb">exec</span><span class="w"> </span>&gt;<span class="w"> </span>&gt;<span class="o">(</span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOGFILE</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="nb">exec</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="c1"># Now all output goes to both console and file</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This appears in both places&quot;</span>
ls<span class="w"> </span>/nonexistent<span class="w">  </span><span class="c1"># Error also logged</span>
</code></pre></div>

<h3 id="73-reading-and-writing-same-file-safely">7.3 Reading and Writing Same File Safely<a class="header-link" href="#73-reading-and-writing-same-file-safely" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># WRONG: This truncates the file before reading!</span>
sort<span class="w"> </span>file.txt<span class="w"> </span>&gt;<span class="w"> </span>file.txt<span class="w">  </span><span class="c1"># file.txt becomes empty!</span>

<span class="c1"># SOLUTION 1: Use sponge (from moreutils)</span>
sort<span class="w"> </span>file.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sponge<span class="w"> </span>file.txt

<span class="c1"># SOLUTION 2: Use temporary file</span>
sort<span class="w"> </span>file.txt<span class="w"> </span>&gt;<span class="w"> </span>file.txt.tmp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>file.txt.tmp<span class="w"> </span>file.txt

<span class="c1"># SOLUTION 3: In-place edit with -i flag (if supported)</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/foo/bar/g&#39;</span><span class="w"> </span>file.txt

<span class="c1"># Atomic file replacement</span>
update_config<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">config_file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">tmpfile</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>

<span class="w">    </span><span class="c1"># Process file</span>
<span class="w">    </span>process_config<span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$config_file</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Atomic replacement</span>
<span class="w">    </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$config_file</span><span class="s2">&quot;</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="74-atomic-file-writes">7.4 Atomic File Writes<a class="header-link" href="#74-atomic-file-writes" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Atomic write pattern: write to temp, then move</span>
atomic_write<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target_file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">content</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">tmpfile</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">target_file</span><span class="si">}</span><span class="s2">.XXXXXX&quot;</span><span class="k">)</span>

<span class="w">    </span><span class="c1"># Write to temporary file</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$content</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Verify write succeeded</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># Atomic move (on same filesystem)</span>
<span class="w">        </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_file</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
atomic_write<span class="w"> </span><span class="s2">&quot;config.json&quot;</span><span class="w"> </span><span class="s1">&#39;{&quot;setting&quot;: &quot;value&quot;}&#39;</span>

<span class="c1"># Complex example: update critical file</span>
update_critical_file<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">tmpfile</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>

<span class="w">    </span><span class="c1"># Set trap for cleanup</span>
<span class="w">    </span><span class="nb">trap</span><span class="w"> </span><span class="s2">&quot;rm -f &#39;</span><span class="nv">$tmpfile</span><span class="s2">&#39;&quot;</span><span class="w"> </span>RETURN

<span class="w">    </span><span class="c1"># Generate new content</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>generate_content<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Failed to generate content&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Validate new content</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>validate_content<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Content validation failed&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Set same permissions as original</span>
<span class="w">    </span>chmod<span class="w"> </span>--reference<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null

<span class="w">    </span><span class="c1"># Atomic replacement</span>
<span class="w">    </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="75-file-locking-for-safe-concurrent-access">7.5 File Locking for Safe Concurrent Access<a class="header-link" href="#75-file-locking-for-safe-concurrent-access" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Use flock for file locking</span>
update_counter<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">counter_file</span><span class="o">=</span><span class="s2">&quot;counter.txt&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">lockfile</span><span class="o">=</span><span class="s2">&quot;counter.lock&quot;</span>

<span class="w">    </span><span class="c1"># Acquire exclusive lock (FD 200)</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span>flock<span class="w"> </span>-x<span class="w"> </span><span class="m">200</span>

<span class="w">        </span><span class="c1"># Read current value</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">0</span>
<span class="w">        </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="nv">$counter_file</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$counter_file</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="w">        </span><span class="c1"># Increment</span>
<span class="w">        </span><span class="o">((</span>count++<span class="o">))</span>

<span class="w">        </span><span class="c1"># Write back</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$count</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$counter_file</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Counter updated to: </span><span class="nv">$count</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="m">200</span>&gt;<span class="s2">&quot;</span><span class="nv">$lockfile</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Multiple processes can safely call this</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..10<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>update_counter<span class="w"> </span><span class="p">&amp;</span>
<span class="k">done</span>
<span class="nb">wait</span>

<span class="c1"># Final value</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Final count: </span><span class="k">$(</span>cat<span class="w"> </span>counter.txt<span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># Alternative: inline locking</span>
<span class="o">{</span>
<span class="w">    </span>flock<span class="w"> </span>-x<span class="w"> </span><span class="m">200</span>

<span class="w">    </span><span class="c1"># Critical section</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Exclusive access to resource&quot;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">2</span>

<span class="o">}</span><span class="w"> </span><span class="m">200</span>&gt;/tmp/mylock
</code></pre></div>

<h3 id="76-progress-indication-with-fifos">7.6 Progress Indication with FIFOs<a class="header-link" href="#76-progress-indication-with-fifos" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Create progress pipe</span>
mkfifo<span class="w"> </span>/tmp/progress_<span class="nv">$$</span>
<span class="nb">trap</span><span class="w"> </span><span class="s2">&quot;rm -f /tmp/progress_</span><span class="nv">$$</span><span class="s2">&quot;</span><span class="w"> </span>EXIT

<span class="c1"># Progress monitor (background)</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>percent<span class="w"> </span>message<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;\r[%-50s] %d%% %s&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">            </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;#%.0s&#39;</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="k">$((</span><span class="nv">percent</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="k">))))</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">            </span><span class="s2">&quot;</span><span class="nv">$percent</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">            </span><span class="s2">&quot;</span><span class="nv">$message</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>/tmp/progress_<span class="nv">$$</span>
<span class="w">    </span><span class="nb">echo</span>
<span class="o">}</span><span class="w"> </span><span class="p">&amp;</span>
<span class="nv">monitor_pid</span><span class="o">=</span><span class="nv">$!</span>

<span class="c1"># Worker process</span>
<span class="o">{</span>
<span class="w">    </span><span class="nv">total</span><span class="o">=</span><span class="m">100</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nv">$total</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="c1"># Simulate work</span>
<span class="w">        </span>sleep<span class="w"> </span><span class="m">0</span>.05

<span class="w">        </span><span class="c1"># Report progress</span>
<span class="w">        </span><span class="nv">percent</span><span class="o">=</span><span class="k">$((</span><span class="nv">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">total</span><span class="k">))</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$percent</span><span class="s2"> Processing item </span><span class="nv">$i</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/progress_<span class="nv">$$</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span><span class="w"> </span><span class="p">&amp;</span>
<span class="nv">worker_pid</span><span class="o">=</span><span class="nv">$!</span>

<span class="c1"># Wait for completion</span>
<span class="nb">wait</span><span class="w"> </span><span class="nv">$worker_pid</span>
<span class="nb">wait</span><span class="w"> </span><span class="nv">$monitor_pid</span>
</code></pre></div>

<h2 id="practice-problems">Practice Problems<a class="header-link" href="#practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-multi-target-logger">Problem 1: Multi-Target Logger<a class="header-link" href="#problem-1-multi-target-logger" title="Permanent link">&para;</a></h3>
<p>Create a logging system that:
- Accepts log level (DEBUG, INFO, WARN, ERROR) and message
- Writes all logs to <code>all.log</code>
- Writes ERROR logs to <code>error.log</code>
- Writes WARN and ERROR to <code>important.log</code>
- Displays ERROR and WARN on stderr, others on stdout
- Adds timestamp and hostname to each log entry
- Implements log rotation when file exceeds 10MB</p>
<h3 id="problem-2-pipeline-monitor">Problem 2: Pipeline Monitor<a class="header-link" href="#problem-2-pipeline-monitor" title="Permanent link">&para;</a></h3>
<p>Write a script that:
- Runs a multi-stage pipeline (e.g., download | decompress | process | upload)
- Monitors the exit status of each stage using PIPESTATUS
- Logs progress to a file using process substitution
- Implements retry logic for failed stages
- Reports which stage failed and why
- Calculates total time and throughput</p>
<h3 id="problem-3-fifo-based-queue-system">Problem 3: FIFO-Based Queue System<a class="header-link" href="#problem-3-fifo-based-queue-system" title="Permanent link">&para;</a></h3>
<p>Implement a simple job queue using named pipes:
- Create <code>job_submit</code> command that sends jobs to a queue
- Create <code>job_worker</code> that processes jobs from the queue
- Support multiple concurrent workers
- Implement job status tracking (pending, running, completed, failed)
- Handle worker crashes gracefully
- Provide <code>job_status</code> command to check queue state</p>
<h3 id="problem-4-configuration-validator">Problem 4: Configuration Validator<a class="header-link" href="#problem-4-configuration-validator" title="Permanent link">&para;</a></h3>
<p>Build a tool that:
- Reads configuration file from stdin or file argument
- Validates syntax using a validation command
- If valid, atomically replaces the old config
- If invalid, shows errors on stderr and keeps old config
- Creates backup before replacement (keep last 5 backups)
- Logs all changes with timestamp
- Supports dry-run mode (validate without replacing)</p>
<h3 id="problem-5-stream-processor-with-fds">Problem 5: Stream Processor with FDs<a class="header-link" href="#problem-5-stream-processor-with-fds" title="Permanent link">&para;</a></h3>
<p>Create a stream processing framework:
- Opens 3 input streams on FDs 3, 4, 5
- Merges streams with timestamps
- Filters based on regex pattern
- Splits output to different files based on content
- Maintains statistics (lines processed per stream, matches, errors)
- Uses process substitution for real-time monitoring
- Handles stream termination gracefully</p>
<p><strong>Previous</strong>: <a href="./05_Functions_and_Libraries.md">05_Functions_and_Libraries.md</a> | <strong>Next</strong>: <a href="./07_String_Processing.md">07_String_Processing.md</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Shell_Script/05_Functions_and_Libraries.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Lesson 05: Functions and Libraries</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Shell_Script/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Shell_Script/07_String_Processing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Lesson 07: String Processing and Text Manipulation</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}