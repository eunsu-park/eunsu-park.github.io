{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 12: Portability and Best Practices - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Shell_Script/">Shell Script</a>
    <span class="separator">/</span>
    <span class="current">Lesson 12: Portability and Best Practices</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Lesson 12: Portability and Best Practices</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Shell_Script/11_Argument_Parsing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Lesson 11: Argument Parsing and CLI Interfaces</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Shell_Script/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Shell_Script/13_Testing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Shell Script Testing</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#1-posix-sh-vs-bash-vs-zsh">1. POSIX sh vs Bash vs Zsh</a><ul>
<li><a href="#feature-comparison">Feature Comparison</a></li>
<li><a href="#shell-detection">Shell Detection</a></li>
<li><a href="#when-to-use-which-shell">When to Use Which Shell</a></li>
</ul>
</li>
<li><a href="#2-common-bashisms-to-avoid">2. Common Bashisms to Avoid</a><ul>
<li><a href="#test-operators-vs">Test Operators: [[ ]] vs [ ]</a></li>
<li><a href="#arrays">Arrays</a></li>
<li><a href="#process-substitution">Process Substitution</a></li>
<li><a href="#here-strings">Here Strings</a></li>
<li><a href="#random">$RANDOM</a></li>
<li><a href="#source-vs">source vs .</a></li>
<li><a href="#echo-vs-printf">echo vs printf</a></li>
<li><a href="#function-keyword">function Keyword</a></li>
<li><a href="#local-variables">local Variables</a></li>
<li><a href="#complete-posix-vs-bash-example">Complete POSIX vs Bash Example</a></li>
</ul>
</li>
<li><a href="#3-google-shell-style-guide-highlights">3. Google Shell Style Guide Highlights</a><ul>
<li><a href="#file-header">File Header</a></li>
<li><a href="#function-comments">Function Comments</a></li>
<li><a href="#todo-comments">TODO Comments</a></li>
<li><a href="#naming-conventions">Naming Conventions</a></li>
<li><a href="#indentation-and-formatting">Indentation and Formatting</a></li>
<li><a href="#quoting-rules">Quoting Rules</a></li>
<li><a href="#when-to-use-shell-vs-pythonperl">When to Use Shell vs Python/Perl</a></li>
</ul>
</li>
<li><a href="#4-security-best-practices">4. Security Best Practices</a><ul>
<li><a href="#input-sanitization">Input Sanitization</a></li>
<li><a href="#quoting-to-prevent-injection">Quoting to Prevent Injection</a></li>
<li><a href="#avoiding-eval">Avoiding eval</a></li>
<li><a href="#secure-temporary-files">Secure Temporary Files</a></li>
<li><a href="#path-hardening">PATH Hardening</a></li>
<li><a href="#running-as-least-privilege">Running as Least Privilege</a></li>
</ul>
</li>
<li><a href="#5-performance-optimization">5. Performance Optimization</a><ul>
<li><a href="#minimize-external-commands">Minimize External Commands</a></li>
<li><a href="#avoid-subshells">Avoid Subshells</a></li>
<li><a href="#use-mapfilereadarray">Use mapfile/readarray</a></li>
<li><a href="#batch-operations">Batch Operations</a></li>
<li><a href="#benchmarking">Benchmarking</a></li>
</ul>
</li>
<li><a href="#6-code-organization">6. Code Organization</a><ul>
<li><a href="#script-template">Script Template</a></li>
<li><a href="#modular-design">Modular Design</a></li>
<li><a href="#configuration-management">Configuration Management</a></li>
</ul>
</li>
<li><a href="#7-dependency-management">7. Dependency Management</a><ul>
<li><a href="#checking-required-commands">Checking Required Commands</a></li>
<li><a href="#version-checking">Version Checking</a></li>
<li><a href="#graceful-degradation">Graceful Degradation</a></li>
</ul>
</li>
<li><a href="#8-distribution-and-packaging">8. Distribution and Packaging</a><ul>
<li><a href="#single-file-script">Single-File Script</a></li>
<li><a href="#self-extracting-archive">Self-Extracting Archive</a></li>
<li><a href="#create-the-self-extracting-archive">Create the self-extracting archive:</a></li>
<li><a href="#man-page">Man Page</a></li>
<li><a href="#bash-completion">Bash Completion</a></li>
</ul>
</li>
<li><a href="#9-practice-problems">9. Practice Problems</a><ul>
<li><a href="#problem-1-posix-shell-converter">Problem 1: POSIX Shell Converter</a></li>
<li><a href="#problem-2-performance-profiler">Problem 2: Performance Profiler</a></li>
<li><a href="#problem-3-security-auditor">Problem 3: Security Auditor</a></li>
<li><a href="#problem-4-package-manager">Problem 4: Package Manager</a></li>
<li><a href="#problem-5-test-framework">Problem 5: Test Framework</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="lesson-12-portability-and-best-practices">Lesson 12: Portability and Best Practices<a class="header-link" href="#lesson-12-portability-and-best-practices" title="Permanent link">&para;</a></h1>
<p><strong>Difficulty</strong>: ‚≠ê‚≠ê‚≠ê‚≠ê</p>
<p><strong>Previous</strong>: <a href="./11_Argument_Parsing.md">11_Argument_Parsing.md</a> | <strong>Next</strong>: <a href="./13_Testing.md">13_Testing.md</a></p>
<hr />
<h2 id="1-posix-sh-vs-bash-vs-zsh">1. POSIX sh vs Bash vs Zsh<a class="header-link" href="#1-posix-sh-vs-bash-vs-zsh" title="Permanent link">&para;</a></h2>
<p>Understanding differences between shells ensures portability.</p>
<h3 id="feature-comparison">Feature Comparison<a class="header-link" href="#feature-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>POSIX sh</th>
<th>Bash</th>
<th>Zsh</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Arrays</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>sh: use positional params</td>
</tr>
<tr>
<td><code>[[ ]]</code> test</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>sh: use <code>[ ]</code></td>
</tr>
<tr>
<td>Process substitution</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td><code>&lt;(command)</code></td>
</tr>
<tr>
<td>Here strings</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td><code>&lt;&lt;&lt; "string"</code></td>
</tr>
<tr>
<td><code>local</code> keyword</td>
<td>No*</td>
<td>Yes</td>
<td>Yes</td>
<td>*Widely supported but not POSIX</td>
</tr>
<tr>
<td><code>function</code> keyword</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>POSIX uses <code>name() { }</code></td>
</tr>
<tr>
<td><code>$RANDOM</code></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>sh: use <code>/dev/urandom</code></td>
</tr>
<tr>
<td><code>source</code></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>sh: use <code>.</code></td>
</tr>
<tr>
<td><code>echo -n</code></td>
<td>No*</td>
<td>Yes</td>
<td>Yes</td>
<td>*Use <code>printf</code> instead</td>
</tr>
<tr>
<td>Arithmetic <code>$(( ))</code></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>POSIX-compliant</td>
</tr>
<tr>
<td>Parameter expansion</td>
<td>Basic</td>
<td>Extended</td>
<td>Extended</td>
<td>Bash has more patterns</td>
</tr>
<tr>
<td>Associative arrays</td>
<td>No</td>
<td>Yes (4.0+)</td>
<td>Yes</td>
<td>sh: use eval tricks</td>
</tr>
<tr>
<td><code>&amp;&gt;&gt;</code> redirection</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>sh: use <code>&gt;&gt;file 2&gt;&amp;1</code></td>
</tr>
<tr>
<td><code>time</code> keyword</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>sh: use <code>/usr/bin/time</code></td>
</tr>
<tr>
<td><code>select</code> loop</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>sh: manual menu</td>
</tr>
</tbody>
</table>
<h3 id="shell-detection">Shell Detection<a class="header-link" href="#shell-detection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># Detect which shell is running this script</span>
detect_shell<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASH_VERSION</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running in Bash: </span><span class="nv">$BASH_VERSION</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ZSH_VERSION</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running in Zsh: </span><span class="nv">$ZSH_VERSION</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$KSH_VERSION</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running in Ksh: </span><span class="nv">$KSH_VERSION</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running in unknown shell (possibly POSIX sh)&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

detect_shell

<span class="c1"># Check if running in Bash</span>
is_bash<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BASH_VERSION</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span>
<span class="o">}</span>

<span class="k">if</span><span class="w"> </span>is_bash<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Bash-specific features available&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Using POSIX-compatible features only&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="when-to-use-which-shell">When to Use Which Shell<a class="header-link" href="#when-to-use-which-shell" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># Use POSIX sh when:</span>
<span class="c1"># - Maximum portability required</span>
<span class="c1"># - Script must run on embedded systems</span>
<span class="c1"># - Minimal dependencies</span>
<span class="c1"># - Alpine Linux (uses busybox sh)</span>

<span class="c1"># Use Bash when:</span>
<span class="c1"># - Advanced features needed (arrays, associative arrays)</span>
<span class="c1"># - Better error handling ([[ ]], set -euo pipefail)</span>
<span class="c1"># - More readable code</span>
<span class="c1"># - Linux systems (Bash is ubiquitous)</span>

<span class="c1"># Use Zsh when:</span>
<span class="c1"># - Interactive features needed</span>
<span class="c1"># - macOS default shell (10.15+)</span>
<span class="c1"># - Advanced globbing required</span>

<span class="c1"># Shebang choices:</span>
<span class="c1">#!/bin/sh          # POSIX sh (maximum portability)</span>
<span class="c1">#!/bin/bash        # Bash (common location)</span>
<span class="c1">#!/usr/bin/env bash  # Bash (portable location lookup)</span>
</code></pre></div>

<h2 id="2-common-bashisms-to-avoid">2. Common Bashisms to Avoid<a class="header-link" href="#2-common-bashisms-to-avoid" title="Permanent link">&para;</a></h2>
<p>Bashisms are Bash-specific features that don't work in POSIX sh.</p>
<h3 id="test-operators-vs">Test Operators: [[ ]] vs [ ]<a class="header-link" href="#test-operators-vs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (Bashism): [[ ]]</span>
<span class="c1"># [[ $var == &quot;value&quot; ]]</span>

<span class="c1"># GOOD (POSIX): [ ]</span>
<span class="nv">var</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$var</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;value&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Match&quot;</span>
<span class="k">fi</span>

<span class="c1"># BAD (Bashism): [[ with pattern matching ]]</span>
<span class="c1"># [[ $file == *.txt ]]</span>

<span class="c1"># GOOD (POSIX): use case</span>
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span>*.txt<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Text file&quot;</span><span class="w"> </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Other file&quot;</span><span class="w"> </span><span class="p">;;</span>
<span class="k">esac</span>

<span class="c1"># BAD (Bashism): [[ with regex ]]</span>
<span class="c1"># [[ $string =~ ^[0-9]+$ ]]</span>

<span class="c1"># GOOD (POSIX): use grep</span>
<span class="k">if</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$string</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-qE<span class="w"> </span><span class="s1">&#39;^[0-9]+$&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Number&quot;</span>
<span class="k">fi</span>

<span class="c1"># BAD (Bashism): [[ with &amp;&amp; ]]</span>
<span class="c1"># [[ -f file &amp;&amp; -r file ]]</span>

<span class="c1"># GOOD (POSIX): separate [ ] or use -a</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>file<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-r<span class="w"> </span>file<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File exists and is readable&quot;</span>
<span class="k">fi</span>

<span class="c1"># Alternative (but [ ] is deprecated):</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>file<span class="w"> </span>-a<span class="w"> </span>-r<span class="w"> </span>file<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File exists and is readable&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="arrays">Arrays<a class="header-link" href="#arrays" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (Bashism): arrays</span>
<span class="c1"># array=(one two three)</span>
<span class="c1"># echo &quot;${array[1]}&quot;</span>

<span class="c1"># GOOD (POSIX): use positional parameters</span>
<span class="nb">set</span><span class="w"> </span>--<span class="w"> </span>one<span class="w"> </span>two<span class="w"> </span>three
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Prints: two</span>

<span class="c1"># GOOD (POSIX): use space-separated string</span>
<span class="nv">items</span><span class="o">=</span><span class="s2">&quot;one two three&quot;</span>
<span class="k">for</span><span class="w"> </span>item<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$items</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$item</span><span class="s2">&quot;</span>
<span class="k">done</span>

<span class="c1"># GOOD (POSIX): use newline-separated string</span>
<span class="nv">items</span><span class="o">=</span><span class="s2">&quot;one</span>
<span class="s2">two</span>
<span class="s2">three&quot;</span>

<span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;</span>
<span class="s1">&#39;</span>
<span class="k">for</span><span class="w"> </span>item<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$items</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$item</span><span class="s2">&quot;</span>
<span class="k">done</span>
</code></pre></div>

<h3 id="process-substitution">Process Substitution<a class="header-link" href="#process-substitution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (Bashism): process substitution</span>
<span class="c1"># diff &lt;(sort file1) &lt;(sort file2)</span>

<span class="c1"># GOOD (POSIX): use temporary files</span>
<span class="nv">tmp1</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
<span class="nv">tmp2</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
<span class="nb">trap</span><span class="w"> </span><span class="s1">&#39;rm -f &quot;$tmp1&quot; &quot;$tmp2&quot;&#39;</span><span class="w"> </span>EXIT

sort<span class="w"> </span>file1<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmp1</span><span class="s2">&quot;</span>
sort<span class="w"> </span>file2<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmp2</span><span class="s2">&quot;</span>
diff<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmp1</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmp2</span><span class="s2">&quot;</span>
</code></pre></div>

<h3 id="here-strings">Here Strings<a class="header-link" href="#here-strings" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (Bashism): here string</span>
<span class="c1"># grep &quot;pattern&quot; &lt;&lt;&lt; &quot;$variable&quot;</span>

<span class="c1"># GOOD (POSIX): echo with pipe</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$variable</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span>

<span class="c1"># GOOD (POSIX): here document</span>
grep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">$variable</span>
<span class="s">EOF</span>

<span class="c1"># GOOD (POSIX): printf with pipe</span>
<span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;%s\n&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$variable</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span>
</code></pre></div>

<h3 id="random">$RANDOM<a class="header-link" href="#random" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (Bashism): $RANDOM</span>
<span class="c1"># random_num=$RANDOM</span>

<span class="c1"># GOOD (POSIX): /dev/urandom</span>
<span class="nv">random_num</span><span class="o">=</span><span class="k">$(</span>od<span class="w"> </span>-An<span class="w"> </span>-N2<span class="w"> </span>-i<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>

<span class="c1"># GOOD (POSIX): awk with /dev/urandom</span>
<span class="nv">random_num</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;BEGIN{srand(); print int(rand()*32768)}&#39;</span><span class="k">)</span>

<span class="c1"># GOOD (POSIX): hexdump</span>
<span class="nv">random_num</span><span class="o">=</span><span class="k">$(</span>hexdump<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;/2 &quot;%u&quot;&#39;</span><span class="w"> </span>/dev/urandom<span class="k">)</span>
</code></pre></div>

<h3 id="source-vs">source vs .<a class="header-link" href="#source-vs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (Bashism): source</span>
<span class="c1"># source ./config.sh</span>

<span class="c1"># GOOD (POSIX): .</span>
.<span class="w"> </span>./config.sh

<span class="c1"># Both work in Bash, but only . is POSIX</span>
</code></pre></div>

<h3 id="echo-vs-printf">echo vs printf<a class="header-link" href="#echo-vs-printf" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (not portable): echo -n</span>
<span class="c1"># echo -n &quot;No newline&quot;</span>

<span class="c1"># GOOD (POSIX): printf</span>
<span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;No newline&quot;</span>

<span class="c1"># BAD (not portable): echo with backslashes</span>
<span class="c1"># echo &quot;Line 1\nLine 2&quot;</span>

<span class="c1"># GOOD (POSIX): printf</span>
<span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;Line 1\nLine 2\n&quot;</span>

<span class="c1"># echo is only safe for simple strings without flags or escapes</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Simple string&quot;</span><span class="w">  </span><span class="c1"># OK</span>

<span class="c1"># printf is always safe and portable</span>
<span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;%s\n&#39;</span><span class="w"> </span><span class="s2">&quot;Any string&quot;</span><span class="w">  </span><span class="c1"># Always works</span>
</code></pre></div>

<h3 id="function-keyword">function Keyword<a class="header-link" href="#function-keyword" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (Bashism): function keyword</span>
<span class="c1"># function my_func() {</span>
<span class="c1">#     echo &quot;Hello&quot;</span>
<span class="c1"># }</span>

<span class="c1"># GOOD (POSIX): no function keyword</span>
my_func<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello&quot;</span>
<span class="o">}</span>

<span class="c1"># Call it</span>
my_func
</code></pre></div>

<h3 id="local-variables">local Variables<a class="header-link" href="#local-variables" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># BAD (not POSIX, but widely supported): local</span>
<span class="c1"># my_func() {</span>
<span class="c1">#     local var=&quot;value&quot;</span>
<span class="c1"># }</span>

<span class="c1"># GOOD (POSIX): no local keyword (variables are global)</span>
my_func<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Use prefixed names to avoid conflicts</span>
<span class="w">    </span><span class="nv">_myfunc_var</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_myfunc_var</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Alternative: use subshell for isolation</span>
my_func_isolated<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="o">(</span>
<span class="w">        </span><span class="nv">var</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="w">  </span><span class="c1"># Only exists in subshell</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$var</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="o">)</span>
<span class="o">}</span>

<span class="c1"># Note: local is so widely supported that it&#39;s often used anyway</span>
<span class="c1"># even in &quot;POSIX&quot; scripts. Busybox sh supports it, for example.</span>
</code></pre></div>

<h3 id="complete-posix-vs-bash-example">Complete POSIX vs Bash Example<a class="header-link" href="#complete-posix-vs-bash-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>
<span class="c1"># POSIX-compatible version</span>

<span class="c1"># Check if file is readable text file</span>
is_readable_text_file<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Check exists and is regular file</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Check readable</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Check if text file (using file command)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>file<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span>*text*<span class="o">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>
<span class="o">}</span>

<span class="c1"># Bash version (simpler)</span>
<span class="c1">#!/bin/bash</span>
is_readable_text_file<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">$(</span>file<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*text*<span class="w"> </span><span class="o">]]</span>
<span class="o">}</span>
</code></pre></div>

<h2 id="3-google-shell-style-guide-highlights">3. Google Shell Style Guide Highlights<a class="header-link" href="#3-google-shell-style-guide-highlights" title="Permanent link">&para;</a></h2>
<p>Google's Shell Style Guide provides industry best practices.</p>
<h3 id="file-header">File Header<a class="header-link" href="#file-header" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># Script name: deploy.sh</span>
<span class="c1"># Description: Deploys application to production</span>
<span class="c1"># Author: John Doe &lt;john@example.com&gt;</span>
<span class="c1"># Date: 2024-01-15</span>
<span class="c1"># Version: 1.0.0</span>
<span class="c1">#</span>
<span class="c1"># Usage: deploy.sh [--dry-run] [--environment ENV] VERSION</span>
<span class="c1">#</span>
<span class="c1"># Copyright 2024 Company Name</span>
<span class="c1"># License: MIT</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail
</code></pre></div>

<h3 id="function-comments">Function Comments<a class="header-link" href="#function-comments" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1">#######################################</span>
<span class="c1"># Processes a file and generates output.</span>
<span class="c1"># Globals:</span>
<span class="c1">#   OUTPUT_DIR</span>
<span class="c1"># Arguments:</span>
<span class="c1">#   $1 - Input file path</span>
<span class="c1">#   $2 - Output format (json|xml)</span>
<span class="c1"># Outputs:</span>
<span class="c1">#   Writes processed data to OUTPUT_DIR</span>
<span class="c1"># Returns:</span>
<span class="c1">#   0 on success, 1 on error</span>
<span class="c1">#######################################</span>
process_file<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">input_file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">format</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span><span class="c1"># Implementation...</span>
<span class="o">}</span>

<span class="c1">#######################################</span>
<span class="c1"># Cleanup function for trap.</span>
<span class="c1"># Globals:</span>
<span class="c1">#   TEMP_FILES</span>
<span class="c1"># Arguments:</span>
<span class="c1">#   None</span>
<span class="c1"># Outputs:</span>
<span class="c1">#   Cleanup messages to stderr</span>
<span class="c1">#######################################</span>
cleanup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Implementation...</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="todo-comments">TODO Comments<a class="header-link" href="#todo-comments" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># TODO(username): Add error handling for network failures</span>
<span class="c1"># TODO(username): Implement retry logic with exponential backoff</span>

<span class="c1"># FIXME(username): This breaks when file has spaces in name</span>
process_file<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="o">}</span>

<span class="c1"># NOTE: This function is deprecated, use process_file_v2 instead</span>
process_file_v1<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="o">}</span>

<span class="c1"># HACK: Temporary workaround for bug in external tool</span>
<span class="c1"># Will be removed when tool is updated</span>
workaround<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="naming-conventions">Naming Conventions<a class="header-link" href="#naming-conventions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Constants: UPPER_CASE</span>
<span class="nb">readonly</span><span class="w"> </span><span class="nv">MAX_RETRIES</span><span class="o">=</span><span class="m">3</span>
<span class="nb">readonly</span><span class="w"> </span><span class="nv">DEFAULT_TIMEOUT</span><span class="o">=</span><span class="m">30</span>
<span class="nb">readonly</span><span class="w"> </span><span class="nv">CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;/etc/app/config.conf&quot;</span>

<span class="c1"># Environment variables: UPPER_CASE</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DEBUG_MODE</span><span class="o">=</span><span class="m">0</span>

<span class="c1"># Variables: lowercase_with_underscores</span>
<span class="nv">user_name</span><span class="o">=</span><span class="s2">&quot;john&quot;</span>
<span class="nv">file_path</span><span class="o">=</span><span class="s2">&quot;/tmp/file.txt&quot;</span>
<span class="nv">retry_count</span><span class="o">=</span><span class="m">0</span>

<span class="c1"># Functions: lowercase_with_underscores</span>
process_file<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">input_file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="o">}</span>

calculate_checksum<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="o">}</span>

<span class="c1"># Private functions: _prefix (convention, not enforced)</span>
_internal_helper<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="indentation-and-formatting">Indentation and Formatting<a class="header-link" href="#indentation-and-formatting" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Use 2 spaces for indentation</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$condition</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Indented with 2 spaces&quot;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$nested</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Nested also 2 spaces&quot;</span>
<span class="w">  </span><span class="k">fi</span>
<span class="k">fi</span>

<span class="c1"># Line length: max 80 characters (flexible to 100)</span>
very_long_command<span class="w"> </span>--option1<span class="w"> </span>value1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--option2<span class="w"> </span>value2<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--option3<span class="w"> </span>value3

<span class="c1"># Pipe formatting</span>
cat<span class="w"> </span>file.txt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>uniq

<span class="c1"># Or:</span>
cat<span class="w"> </span>file.txt<span class="w"> </span><span class="p">|</span>
<span class="w">  </span>grep<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="w"> </span><span class="p">|</span>
<span class="w">  </span>sort<span class="w"> </span><span class="p">|</span>
<span class="w">  </span>uniq
</code></pre></div>

<h3 id="quoting-rules">Quoting Rules<a class="header-link" href="#quoting-rules" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Always quote variables</span>
<span class="nv">filename</span><span class="o">=</span><span class="s2">&quot;my file.txt&quot;</span>
cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$filename</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># GOOD</span>
<span class="c1"># cat $filename  # BAD - word splitting</span>

<span class="c1"># Quote command substitutions</span>
<span class="nv">result</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">command</span><span class="k">)</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># GOOD</span>
<span class="c1"># result=$(command)  # BAD - not wrong, but inconsistent</span>

<span class="c1"># Single quotes for literal strings</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;No expansion happens here: $var&#39;</span>

<span class="c1"># Double quotes for strings with variables</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Value: </span><span class="nv">$var</span><span class="s2">&quot;</span>

<span class="c1"># Quote array expansions</span>
<span class="nv">files</span><span class="o">=(</span><span class="s2">&quot;file1.txt&quot;</span><span class="w"> </span><span class="s2">&quot;file2.txt&quot;</span><span class="o">)</span>
process<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># GOOD</span>
<span class="c1"># process ${files[@]}  # BAD</span>

<span class="c1"># Don&#39;t quote arithmetic expansions</span>
<span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="nv">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span><span class="w">  </span><span class="c1"># GOOD</span>

<span class="c1"># Don&#39;t quote comparison integers</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$count</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c1"># OK (but quoting doesn&#39;t hurt)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Greater than 10&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="when-to-use-shell-vs-pythonperl">When to Use Shell vs Python/Perl<a class="header-link" href="#when-to-use-shell-vs-pythonperl" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Use shell for:</span>
<span class="c1"># - Simple scripts (&lt; 100 lines)</span>
<span class="c1"># - Primarily calling other programs</span>
<span class="c1"># - File system operations</span>
<span class="c1"># - Simple data processing</span>
<span class="c1"># - System administration tasks</span>

<span class="c1"># Use Python/Perl for:</span>
<span class="c1"># - Complex data structures</span>
<span class="c1"># - Text processing with complex logic</span>
<span class="c1"># - Scripts &gt; 100 lines</span>
<span class="c1"># - Need for libraries (HTTP, JSON, etc.)</span>
<span class="c1"># - Complex algorithms</span>
<span class="c1"># - Better error handling required</span>
<span class="c1"># - Testing required</span>

<span class="c1"># Example: When shell is appropriate</span>
<span class="c1">#!/bin/bash</span>
<span class="c1"># Simple backup script</span>
tar<span class="w"> </span>czf<span class="w"> </span><span class="s2">&quot;backup_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span><span class="s2">.tar.gz&quot;</span><span class="w"> </span>/important/data
aws<span class="w"> </span>s3<span class="w"> </span>cp<span class="w"> </span><span class="s2">&quot;backup_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span><span class="s2">.tar.gz&quot;</span><span class="w"> </span>s3://backups/

<span class="c1"># Example: When Python is better</span>
<span class="c1">#!/usr/bin/env python3</span>
<span class="c1"># Complex data processing with error handling</span>
import<span class="w"> </span>json
import<span class="w"> </span>requests
import<span class="w"> </span>logging

<span class="c1"># ... complex logic ...</span>
</code></pre></div>

<h2 id="4-security-best-practices">4. Security Best Practices<a class="header-link" href="#4-security-best-practices" title="Permanent link">&para;</a></h2>
<p>Security considerations for shell scripts.</p>
<h3 id="input-sanitization">Input Sanitization<a class="header-link" href="#input-sanitization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Always validate and sanitize input</span>
sanitize_filename<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">filename</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span><span class="c1"># Remove path components</span>
<span class="w">    </span><span class="nv">filename</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$filename</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="w">    </span><span class="c1"># Remove dangerous characters</span>
<span class="w">    </span><span class="nv">filename</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$filename</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-cd<span class="w"> </span><span class="s1">&#39;[:alnum:]._-&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="c1"># Limit length</span>
<span class="w">    </span><span class="nv">filename</span><span class="o">=</span><span class="si">${</span><span class="nv">filename</span><span class="p">:</span><span class="nv">0</span><span class="p">:</span><span class="nv">255</span><span class="si">}</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$filename</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
<span class="nv">user_input</span><span class="o">=</span><span class="s2">&quot;../../etc/passwd&quot;</span>
<span class="nv">safe_name</span><span class="o">=</span><span class="k">$(</span>sanitize_filename<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user_input</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Safe: </span><span class="nv">$safe_name</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Prints: etcpasswd</span>

<span class="c1"># Validate numeric input</span>
validate_number<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">input</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$input</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>+$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Not a valid number&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$input</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Validate against whitelist</span>
validate_enum<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">input</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">shift</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">valid_values</span><span class="o">=(</span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="o">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span>value<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">valid_values</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$input</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$value</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Invalid value: </span><span class="nv">$input</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Valid values: </span><span class="si">${</span><span class="nv">valid_values</span><span class="p">[*]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
<span class="k">if</span><span class="w"> </span>validate_enum<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user_choice</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="w"> </span><span class="s2">&quot;stop&quot;</span><span class="w"> </span><span class="s2">&quot;restart&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Valid choice&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="quoting-to-prevent-injection">Quoting to Prevent Injection<a class="header-link" href="#quoting-to-prevent-injection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># BAD: Command injection vulnerability</span>
<span class="nv">user_input</span><span class="o">=</span><span class="s2">&quot;file.txt; rm -rf /&quot;</span>
cat<span class="w"> </span><span class="nv">$user_input</span><span class="w">  </span><span class="c1"># DANGEROUS!</span>

<span class="c1"># GOOD: Proper quoting</span>
cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user_input</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Safe - treated as single filename</span>

<span class="c1"># BAD: SQL injection (if using sqlite3 directly)</span>
<span class="nv">query</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM users WHERE name = &#39;</span><span class="nv">$user_input</span><span class="s2">&#39;&quot;</span>
sqlite3<span class="w"> </span>db.sqlite<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$query</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># VULNERABLE</span>

<span class="c1"># GOOD: Use parameterized queries (via here-doc or file)</span>
sqlite3<span class="w"> </span>db.sqlite<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">SELECT * FROM users WHERE name = &#39;$user_input&#39;;</span>
<span class="s">EOF</span>

<span class="c1"># Better: Use proper tools with parameter binding</span>
<span class="c1"># (For complex DB work, use Python/Perl/etc.)</span>

<span class="c1"># BAD: HTML injection</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div&gt;</span><span class="nv">$user_input</span><span class="s2">&lt;/div&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>output.html

<span class="c1"># GOOD: Escape HTML entities</span>
escape_html<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">input</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nv">input</span><span class="o">=</span><span class="si">${</span><span class="nv">input</span><span class="p">//&amp;/&amp;amp;</span><span class="si">}</span>
<span class="w">    </span><span class="nv">input</span><span class="o">=</span><span class="si">${</span><span class="nv">input</span><span class="p">//&lt;/&amp;lt;</span><span class="si">}</span>
<span class="w">    </span><span class="nv">input</span><span class="o">=</span><span class="si">${</span><span class="nv">input</span><span class="p">//&gt;/&amp;gt;</span><span class="si">}</span>
<span class="w">    </span><span class="nv">input</span><span class="o">=</span><span class="si">${</span><span class="nv">input</span><span class="p">//</span><span class="se">\&quot;</span><span class="p">/&amp;quot;</span><span class="si">}</span>
<span class="w">    </span><span class="nv">input</span><span class="o">=</span><span class="si">${</span><span class="nv">input</span><span class="p">//</span><span class="se">\&#39;</span><span class="p">/&amp;#39;</span><span class="si">}</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$input</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="nv">safe_input</span><span class="o">=</span><span class="k">$(</span>escape_html<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user_input</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div&gt;</span><span class="nv">$safe_input</span><span class="s2">&lt;/div&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>output.html
</code></pre></div>

<h3 id="avoiding-eval">Avoiding eval<a class="header-link" href="#avoiding-eval" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># BAD: eval is dangerous</span>
<span class="nv">user_command</span><span class="o">=</span><span class="s2">&quot;rm -rf /&quot;</span>
<span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user_command</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># NEVER DO THIS</span>

<span class="c1"># GOOD: Use case or if/else instead</span>
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user_command</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span>start<span class="o">)</span><span class="w"> </span>start_service<span class="w"> </span><span class="p">;;</span>
<span class="w">    </span>stop<span class="o">)</span><span class="w"> </span>stop_service<span class="w"> </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Unknown command&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="p">;;</span>
<span class="k">esac</span>

<span class="c1"># BAD: Dynamic variable names with eval</span>
<span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">prefix</span><span class="si">}</span><span class="s2">_var=value&quot;</span>

<span class="c1"># GOOD: Use associative arrays (Bash 4+)</span>
<span class="nb">declare</span><span class="w"> </span>-A<span class="w"> </span>config
config<span class="o">[</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">prefix</span><span class="si">}</span><span class="s2">_var&quot;</span><span class="o">]=</span><span class="s2">&quot;value&quot;</span>

<span class="c1"># If you MUST use eval, validate thoroughly</span>
safe_eval<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span><span class="c1"># Whitelist of allowed commands</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;echo &quot;</span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Command not allowed&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>
<span class="o">}</span>
</code></pre></div>

<h3 id="secure-temporary-files">Secure Temporary Files<a class="header-link" href="#secure-temporary-files" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># BAD: Predictable temp file names</span>
<span class="nv">tmpfile</span><span class="o">=</span><span class="s2">&quot;/tmp/myapp_</span><span class="nv">$$</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># $$ is predictable</span>

<span class="c1"># GOOD: Use mktemp</span>
<span class="nv">tmpfile</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="nb">trap</span><span class="w"> </span><span class="s1">&#39;rm -f &quot;$tmpfile&quot;&#39;</span><span class="w"> </span>EXIT

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpfile</span><span class="s2">&quot;</span>

<span class="c1"># GOOD: Temp directory</span>
<span class="nv">tmpdir</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="w"> </span>-d<span class="k">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="nb">trap</span><span class="w"> </span><span class="s1">&#39;rm -rf &quot;$tmpdir&quot;&#39;</span><span class="w"> </span>EXIT

<span class="c1"># Set restrictive permissions</span>
chmod<span class="w"> </span><span class="m">700</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpdir</span><span class="s2">&quot;</span>

<span class="c1"># Create files in temp directory</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpdir</span><span class="s2">/file1.txt&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;more&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpdir</span><span class="s2">/file2.txt&quot;</span>
</code></pre></div>

<h3 id="path-hardening">PATH Hardening<a class="header-link" href="#path-hardening" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Set secure PATH</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin:/usr/bin:/bin&quot;</span>

<span class="c1"># Or use absolute paths for critical commands</span>
/usr/bin/whoami
/bin/cat<span class="w"> </span>/etc/passwd

<span class="c1"># Verify command location</span>
require_command<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span>path

<span class="w">    </span><span class="nv">path</span><span class="o">=</span><span class="k">$(</span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Command not found: </span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Verify it&#39;s in expected location</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span>/usr/bin/*<span class="p">|</span>/bin/*<span class="p">|</span>/usr/local/bin/*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Using: </span><span class="nv">$path</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Warning: Command in unexpected location: </span><span class="nv">$path</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>
<span class="o">}</span>

require_command<span class="w"> </span><span class="s2">&quot;grep&quot;</span>
require_command<span class="w"> </span><span class="s2">&quot;awk&quot;</span>
</code></pre></div>

<h3 id="running-as-least-privilege">Running as Least Privilege<a class="header-link" href="#running-as-least-privilege" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if running as root when not needed</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Do not run this script as root&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Drop privileges if started as root</span>
drop_privileges<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">user</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Dropping privileges to user: </span><span class="nv">$user</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">exec</span><span class="w"> </span>su<span class="w"> </span>-<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user</span><span class="s2">&quot;</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2"> </span><span class="nv">$*</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Require root for certain operations</span>
require_root<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: This script must be run as root&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Check for sudo</span>
has_sudo<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>sudo<span class="w"> </span>-n<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null
<span class="o">}</span>

<span class="c1"># Use sudo for specific commands only</span>
safe_system_update<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>has_sudo<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
<span class="w">        </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: sudo access required&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>
</code></pre></div>

<h2 id="5-performance-optimization">5. Performance Optimization<a class="header-link" href="#5-performance-optimization" title="Permanent link">&para;</a></h2>
<p>Writing efficient shell scripts.</p>
<h3 id="minimize-external-commands">Minimize External Commands<a class="header-link" href="#minimize-external-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># BAD: External command for string manipulation</span>
<span class="nv">basename</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nv">dirname</span><span class="o">=</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># GOOD: Built-in parameter expansion</span>
<span class="nv">basename</span><span class="o">=</span><span class="si">${</span><span class="nv">path</span><span class="p">##*/</span><span class="si">}</span>
<span class="nv">dirname</span><span class="o">=</span><span class="si">${</span><span class="nv">path</span><span class="p">%/*</span><span class="si">}</span>

<span class="c1"># BAD: Using grep/sed for simple checks</span>
<span class="k">if</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$string</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;pattern&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Found&quot;</span>
<span class="k">fi</span>

<span class="c1"># GOOD: Built-in pattern matching (Bash)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$string</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*pattern*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Found&quot;</span>
<span class="k">fi</span>

<span class="c1"># BAD: Multiple echo calls</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Line 1&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Line 2&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Line 3&quot;</span>

<span class="c1"># GOOD: Single printf or here-doc</span>
<span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;%s\n&#39;</span><span class="w"> </span><span class="s2">&quot;Line 1&quot;</span><span class="w"> </span><span class="s2">&quot;Line 2&quot;</span><span class="w"> </span><span class="s2">&quot;Line 3&quot;</span>

<span class="c1"># Or:</span>
cat<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">Line 1</span>
<span class="s">Line 2</span>
<span class="s">Line 3</span>
<span class="s">EOF</span>
</code></pre></div>

<h3 id="avoid-subshells">Avoid Subshells<a class="header-link" href="#avoid-subshells" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># BAD: Subshell in loop</span>
<span class="nv">count</span><span class="o">=</span><span class="m">0</span>
cat<span class="w"> </span>file.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span>count++<span class="o">))</span>
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$count</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Prints 0 (subshell!)</span>

<span class="c1"># GOOD: Process substitution or redirection</span>
<span class="nv">count</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="o">((</span>count++<span class="o">))</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>file.txt
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$count</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Correct count</span>

<span class="c1"># BAD: Command substitution for variable assignment in loop</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..1000<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">date_str</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span><span class="w">  </span><span class="c1"># Called 1000 times!</span>
<span class="k">done</span>

<span class="c1"># GOOD: Calculate once</span>
<span class="nv">date_str</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..1000<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="c1"># Use $date_str</span>
<span class="k">done</span>
</code></pre></div>

<h3 id="use-mapfilereadarray">Use mapfile/readarray<a class="header-link" href="#use-mapfilereadarray" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># BAD: Reading file in loop with command substitution</span>
<span class="nv">files</span><span class="o">=()</span>
<span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">files</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.txt&quot;</span><span class="o">)</span>

<span class="c1"># GOOD: Use mapfile (Bash 4+)</span>
mapfile<span class="w"> </span>-t<span class="w"> </span>files<span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.txt&quot;</span><span class="o">)</span>

<span class="c1"># Or readarray (same as mapfile)</span>
readarray<span class="w"> </span>-t<span class="w"> </span>files<span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.txt&quot;</span><span class="o">)</span>

<span class="c1"># Read from file</span>
mapfile<span class="w"> </span>-t<span class="w"> </span>lines<span class="w"> </span>&lt;<span class="w"> </span>file.txt

<span class="c1"># Skip empty lines</span>
mapfile<span class="w"> </span>-t<span class="w"> </span>lines<span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;^$&#39;</span><span class="w"> </span>file.txt<span class="o">)</span>
</code></pre></div>

<h3 id="batch-operations">Batch Operations<a class="header-link" href="#batch-operations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># BAD: Multiple operations in loop</span>
<span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span>
<span class="k">done</span>

<span class="c1"># GOOD: Batch operation</span>
chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span>*.txt

<span class="c1"># BAD: Individual git operations</span>
<span class="k">for</span><span class="w"> </span>commit<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$commits</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>git<span class="w"> </span>show<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$commit</span><span class="s2">&quot;</span>
<span class="k">done</span>

<span class="c1"># GOOD: Single git command</span>
git<span class="w"> </span>show<span class="w"> </span><span class="nv">$commits</span>

<span class="c1"># BAD: Multiple curl requests in sequence</span>
<span class="k">for</span><span class="w"> </span>url<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$urls</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>curl<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$url</span><span class="s2">&quot;</span>
<span class="k">done</span>

<span class="c1"># GOOD: Parallel curl with xargs</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$urls</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-P<span class="w"> </span><span class="m">4</span><span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>curl
</code></pre></div>

<h3 id="benchmarking">Benchmarking<a class="header-link" href="#benchmarking" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Simple timing</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Method 1:&quot;</span>
<span class="nb">time</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..1000<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nv">basename</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">&quot;/path/to/file</span><span class="nv">$i</span><span class="s2">.txt&quot;</span><span class="k">)</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Method 2:&quot;</span>
<span class="nb">time</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..1000<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nv">basename</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">path</span><span class="p">##*/</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

<span class="c1"># More detailed timing</span>
benchmark<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">iterations</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">100</span><span class="si">}</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">code</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">start</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s%N<span class="k">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span>i&lt;iterations<span class="p">;</span><span class="w"> </span>i++<span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$code</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">end</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s%N<span class="k">)</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="nv">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">start</span><span class="o">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1000000</span><span class="k">))</span><span class="w">  </span><span class="c1"># Convert to milliseconds</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Duration: </span><span class="si">${</span><span class="nv">duration</span><span class="si">}</span><span class="s2">ms for </span><span class="nv">$iterations</span><span class="s2"> iterations&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Average: </span><span class="k">$((</span><span class="nv">duration</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">iterations</span><span class="k">))</span><span class="s2">ms per iteration&quot;</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
benchmark<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="s1">&#39;x=$(basename &quot;/path/to/file.txt&quot;)&#39;</span>
benchmark<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="s1">&#39;x=${path##*/}&#39;</span>
</code></pre></div>

<h2 id="6-code-organization">6. Code Organization<a class="header-link" href="#6-code-organization" title="Permanent link">&para;</a></h2>
<p>Structuring scripts for maintainability.</p>
<h3 id="script-template">Script Template<a class="header-link" href="#script-template" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># Script: script_name.sh</span>
<span class="c1"># Description: Brief description</span>
<span class="c1"># Author: Your Name</span>
<span class="c1"># Date: 2024-01-15</span>
<span class="c1">#</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail

<span class="c1"># ============================================================================</span>
<span class="c1"># CONSTANTS</span>
<span class="c1"># ============================================================================</span>

<span class="nb">readonly</span><span class="w"> </span><span class="nv">SCRIPT_NAME</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nb">readonly</span><span class="w"> </span><span class="nv">SCRIPT_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">readonly</span><span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span>

<span class="nb">readonly</span><span class="w"> </span><span class="nv">DEFAULT_TIMEOUT</span><span class="o">=</span><span class="m">30</span>
<span class="nb">readonly</span><span class="w"> </span><span class="nv">MAX_RETRIES</span><span class="o">=</span><span class="m">3</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># GLOBAL VARIABLES</span>
<span class="c1"># ============================================================================</span>

<span class="nv">VERBOSE</span><span class="o">=</span><span class="m">0</span>
<span class="nv">DRY_RUN</span><span class="o">=</span><span class="m">0</span>
<span class="nv">CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># HELPER FUNCTIONS</span>
<span class="c1"># ============================================================================</span>

log<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] </span><span class="nv">$*</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="o">}</span>

error<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;ERROR: </span><span class="nv">$*</span><span class="s2">&quot;</span>
<span class="o">}</span>

die<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>error<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$*</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="o">}</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># CORE FUNCTIONS</span>
<span class="c1"># ============================================================================</span>

main_function_1<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Implementation</span>
<span class="w">    </span>:
<span class="o">}</span>

main_function_2<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Implementation</span>
<span class="w">    </span>:
<span class="o">}</span>

<span class="c1"># ============================================================================</span>
<span class="c1"># MAIN</span>
<span class="c1"># ============================================================================</span>

main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Parse arguments</span>
<span class="w">    </span><span class="c1"># Validate input</span>
<span class="w">    </span><span class="c1"># Execute main logic</span>
<span class="w">    </span>:
<span class="o">}</span>

<span class="c1"># Only run main if script is executed, not sourced</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>main<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<h3 id="modular-design">Modular Design<a class="header-link" href="#modular-design" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># config.sh - Configuration module</span>
load_config<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">config_file</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$config_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Config file not found: </span><span class="nv">$config_file</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Source config file</span>
<span class="w">    </span><span class="c1"># shellcheck source=/dev/null</span>
<span class="w">    </span>.<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$config_file</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># logger.sh - Logging module</span>
setup_logger<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">LOG_FILE</span><span class="o">=</span><span class="si">${</span><span class="nv">LOG_FILE</span><span class="k">:-</span><span class="p">/var/log/app.log</span><span class="si">}</span>
<span class="w">    </span><span class="nv">LOG_LEVEL</span><span class="o">=</span><span class="si">${</span><span class="nv">LOG_LEVEL</span><span class="k">:-</span><span class="nv">INFO</span><span class="si">}</span>
<span class="o">}</span>

log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">level</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">shift</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] [</span><span class="nv">$level</span><span class="s2">] </span><span class="nv">$*</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># network.sh - Network module</span>
check_connectivity<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">host</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-W<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$host</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
<span class="o">}</span>

download_file<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">url</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="nv">$2</span>
<span class="w">    </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$url</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># main.sh - Main script</span>
<span class="c1">#!/bin/bash</span>

<span class="c1"># Source modules</span>
<span class="nv">SCRIPT_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
.<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/config.sh&quot;</span>
.<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/logger.sh&quot;</span>
.<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/network.sh&quot;</span>

main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>load_config<span class="w"> </span><span class="s2">&quot;/etc/app/config.conf&quot;</span>
<span class="w">    </span>setup_logger

<span class="w">    </span><span class="k">if</span><span class="w"> </span>check_connectivity<span class="w"> </span><span class="s2">&quot;example.com&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span>INFO<span class="w"> </span><span class="s2">&quot;Network available&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

main<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</code></pre></div>

<h3 id="configuration-management">Configuration Management<a class="header-link" href="#configuration-management" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Load configuration from file</span>
load_config_ini<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">config_file</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$config_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Parse INI-style config</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>key<span class="w"> </span>value<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="c1"># Skip comments and empty lines</span>
<span class="w">        </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$key</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[[</span>:space:<span class="o">]]</span>*#<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">continue</span>
<span class="w">        </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$key</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">continue</span>

<span class="w">        </span><span class="c1"># Remove leading/trailing whitespace</span>
<span class="w">        </span><span class="nv">key</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$key</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="k">)</span>
<span class="w">        </span><span class="nv">value</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$value</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="k">)</span>

<span class="w">        </span><span class="c1"># Export as environment variable</span>
<span class="w">        </span><span class="nb">export</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$key</span><span class="s2">=</span><span class="nv">$value</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$config_file</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Generate config file</span>
generate_config<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output_file</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># Application Configuration</span>

<span class="s"># Database settings</span>
<span class="s">DB_HOST=localhost</span>
<span class="s">DB_PORT=5432</span>
<span class="s">DB_NAME=myapp</span>
<span class="s">DB_USER=appuser</span>

<span class="s"># API settings</span>
<span class="s">API_KEY=your_api_key_here</span>
<span class="s">API_TIMEOUT=30</span>

<span class="s"># Application settings</span>
<span class="s">DEBUG_MODE=0</span>
<span class="s">LOG_LEVEL=INFO</span>
<span class="s">MAX_CONNECTIONS=100</span>
<span class="s">EOF</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Configuration written to: </span><span class="nv">$output_file</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Load config from environment, file, or defaults</span>
load_config_priority<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># 1. Defaults</span>
<span class="w">    </span><span class="nv">DB_HOST</span><span class="o">=</span><span class="si">${</span><span class="nv">DB_HOST</span><span class="k">:-</span><span class="nv">localhost</span><span class="si">}</span>
<span class="w">    </span><span class="nv">DB_PORT</span><span class="o">=</span><span class="si">${</span><span class="nv">DB_PORT</span><span class="k">:-</span><span class="nv">5432</span><span class="si">}</span>
<span class="w">    </span><span class="nv">API_TIMEOUT</span><span class="o">=</span><span class="si">${</span><span class="nv">API_TIMEOUT</span><span class="k">:-</span><span class="nv">30</span><span class="si">}</span>

<span class="w">    </span><span class="c1"># 2. Config file (if exists)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;/etc/app/config.conf&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># shellcheck source=/dev/null</span>
<span class="w">        </span>.<span class="w"> </span><span class="s2">&quot;/etc/app/config.conf&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># 3. Environment variables (highest priority, already loaded)</span>

<span class="w">    </span><span class="c1"># Export final values</span>
<span class="w">    </span><span class="nb">export</span><span class="w"> </span>DB_HOST<span class="w"> </span>DB_PORT<span class="w"> </span>API_TIMEOUT
<span class="o">}</span>
</code></pre></div>

<h2 id="7-dependency-management">7. Dependency Management<a class="header-link" href="#7-dependency-management" title="Permanent link">&para;</a></h2>
<p>Managing script dependencies.</p>
<h3 id="checking-required-commands">Checking Required Commands<a class="header-link" href="#checking-required-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check single command</span>
require_command<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Required command not found: </span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Check multiple commands</span>
require_commands<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">missing</span><span class="o">=()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span>cmd<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">missing</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${#</span><span class="nv">missing</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Required commands not found:&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;  - %s\n&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">missing</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Check with installation instructions</span>
require_command_with_hint<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">install_cmd</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt;&amp;2</span>
<span class="s">Error: Required command not found: $cmd</span>

<span class="s">To install, run:</span>
<span class="s">    $install_cmd</span>

<span class="s">EOF</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
require_commands<span class="w"> </span>grep<span class="w"> </span>sed<span class="w"> </span>awk<span class="w"> </span>curl<span class="w"> </span>jq<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>

require_command_with_hint<span class="w"> </span><span class="s2">&quot;jq&quot;</span><span class="w"> </span><span class="s2">&quot;apt-get install jq&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
require_command_with_hint<span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="w"> </span><span class="s2">&quot;curl -fsSL https://get.docker.com | sh&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</code></pre></div>

<h3 id="version-checking">Version Checking<a class="header-link" href="#version-checking" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Get command version</span>
get_version<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span>bash<span class="o">)</span>
<span class="w">            </span>bash<span class="w"> </span>--version<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span><span class="s1">&#39;\d+\.\d+\.\d+&#39;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>python*<span class="o">)</span>
<span class="w">            </span><span class="nv">$cmd</span><span class="w"> </span>--version<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span><span class="s1">&#39;\d+\.\d+\.\d+&#39;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>git<span class="o">)</span>
<span class="w">            </span>git<span class="w"> </span>--version<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span><span class="s1">&#39;\d+\.\d+\.\d+&#39;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>docker<span class="o">)</span>
<span class="w">            </span>docker<span class="w"> </span>--version<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span><span class="s1">&#39;\d+\.\d+\.\d+&#39;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Unknown command: </span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>
<span class="o">}</span>

<span class="c1"># Compare versions</span>
version_compare<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">version1</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">version2</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$version1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$version2</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0&quot;</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span>.
<span class="w">    </span><span class="nb">local</span><span class="w"> </span>i<span class="w"> </span><span class="nv">ver1</span><span class="o">=(</span><span class="nv">$version1</span><span class="o">)</span><span class="w"> </span><span class="nv">ver2</span><span class="o">=(</span><span class="nv">$version2</span><span class="o">)</span>

<span class="w">    </span><span class="c1"># Fill empty positions with zeros</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="si">${#</span><span class="nv">ver1</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span>i&lt;<span class="si">${#</span><span class="nv">ver2</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span>i++<span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span>ver1<span class="o">[</span>i<span class="o">]=</span><span class="m">0</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span>i&lt;<span class="si">${#</span><span class="nv">ver1</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span>i++<span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="si">${</span><span class="nv">ver2</span><span class="p">[i]</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span>ver2<span class="o">[</span>i<span class="o">]=</span><span class="m">0</span>
<span class="w">        </span><span class="k">fi</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="m">10</span><span class="c1">#${ver1[i]} &gt; 10#${ver2[i]})); then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="k">fi</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="m">10</span><span class="c1">#${ver1[i]} &lt; 10#${ver2[i]})); then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-1&quot;</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0&quot;</span>
<span class="o">}</span>

<span class="c1"># Require minimum version</span>
require_version<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">min_version</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span>current_version
<span class="w">    </span><span class="nv">current_version</span><span class="o">=</span><span class="k">$(</span>get_version<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span><span class="k">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span>cmp
<span class="w">    </span><span class="nv">cmp</span><span class="o">=</span><span class="k">$(</span>version_compare<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$current_version</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$min_version</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmp</span><span class="s2">&quot;</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: </span><span class="nv">$cmd</span><span class="s2"> version </span><span class="nv">$current_version</span><span class="s2"> is too old&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;       Minimum required version: </span><span class="nv">$min_version</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Using </span><span class="nv">$cmd</span><span class="s2"> version </span><span class="nv">$current_version</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
require_version<span class="w"> </span><span class="s2">&quot;bash&quot;</span><span class="w"> </span><span class="s2">&quot;4.0.0&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
require_version<span class="w"> </span><span class="s2">&quot;git&quot;</span><span class="w"> </span><span class="s2">&quot;2.0.0&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</code></pre></div>

<h3 id="graceful-degradation">Graceful Degradation<a class="header-link" href="#graceful-degradation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Use advanced features if available, fallback otherwise</span>
use_color<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-t<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>tput<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># Terminal with tput support</span>
<span class="w">        </span><span class="nv">RED</span><span class="o">=</span><span class="k">$(</span>tput<span class="w"> </span>setaf<span class="w"> </span><span class="m">1</span><span class="k">)</span>
<span class="w">        </span><span class="nv">GREEN</span><span class="o">=</span><span class="k">$(</span>tput<span class="w"> </span>setaf<span class="w"> </span><span class="m">2</span><span class="k">)</span>
<span class="w">        </span><span class="nv">RESET</span><span class="o">=</span><span class="k">$(</span>tput<span class="w"> </span>sgr0<span class="k">)</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-t<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># Terminal without tput</span>
<span class="w">        </span><span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<span class="w">        </span><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<span class="w">        </span><span class="nv">RESET</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="c1"># No terminal</span>
<span class="w">        </span><span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">RESET</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Use jq if available, fallback to grep/sed</span>
parse_json<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">json_file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">key</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>jq<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;.</span><span class="nv">$key</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$json_file</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="c1"># Fallback to grep/sed (fragile but works for simple cases)</span>
<span class="w">        </span>grep<span class="w"> </span><span class="s2">&quot;\&quot;</span><span class="nv">$key</span><span class="s2">\&quot;&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$json_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/.*: &quot;\(.*\)&quot;.*/\1/&#39;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Use parallel if available, fallback to xargs</span>
parallel_execute<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">shift</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">items</span><span class="o">=(</span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="o">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>parallel<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;%s\n&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">items</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>parallel<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;%s\n&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">items</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-P<span class="w"> </span><span class="m">4</span><span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2"> {}&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>
</code></pre></div>

<h2 id="8-distribution-and-packaging">8. Distribution and Packaging<a class="header-link" href="#8-distribution-and-packaging" title="Permanent link">&para;</a></h2>
<p>Preparing scripts for distribution.</p>
<h3 id="single-file-script">Single-File Script<a class="header-link" href="#single-file-script" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># Complete standalone script with everything embedded</span>
<span class="c1">#</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail

<span class="c1"># Embed configuration</span>
<span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>DEFAULT_CONFIG<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39; || true</span>
<span class="s">DB_HOST=localhost</span>
<span class="s">DB_PORT=5432</span>
<span class="s">EOF</span>

<span class="c1"># Embed helper functions</span>
error<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: </span><span class="nv">$*</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
info<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;INFO: </span><span class="nv">$*</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>

<span class="c1"># Main logic</span>
main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>info<span class="w"> </span><span class="s2">&quot;Starting application&quot;</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="o">}</span>

main<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</code></pre></div>

<h3 id="self-extracting-archive">Self-Extracting Archive<a class="header-link" href="#self-extracting-archive" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># Self-extracting script with embedded tarball</span>

<span class="nv">ARCHIVE_LINE</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span><span class="s1">&#39;/^__ARCHIVE__/ {print NR + 1; exit 0; }&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># Extract embedded archive</span>
tail<span class="w"> </span>-n<span class="w"> </span>+<span class="si">${</span><span class="nv">ARCHIVE_LINE</span><span class="si">}</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tar<span class="w"> </span>xz<span class="w"> </span>-C<span class="w"> </span>/tmp

<span class="c1"># Run installer</span>
<span class="nb">cd</span><span class="w"> </span>/tmp/installer
./install.sh

<span class="nb">exit</span><span class="w"> </span><span class="m">0</span>

__ARCHIVE__
<span class="c1"># Compressed tarball data starts here (created with tar czf)</span>
</code></pre></div>

<h3 id="create-the-self-extracting-archive">Create the self-extracting archive:<a class="header-link" href="#create-the-self-extracting-archive" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Create installer package</span>
create_installer<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output_file</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">source_dir</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span><span class="c1"># Create header script</span>
<span class="w">    </span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s">&lt;&lt; &#39;HEADER&#39;</span>
<span class="s">#!/bin/bash</span>
<span class="s">ARCHIVE_LINE=$(awk &#39;/^__ARCHIVE__/ {print NR + 1; exit 0; }&#39; &quot;$0&quot;)</span>
<span class="s">tail -n +${ARCHIVE_LINE} &quot;$0&quot; | tar xz -C /tmp</span>
<span class="s">cd /tmp/installer &amp;&amp; ./install.sh</span>
<span class="s">exit 0</span>
<span class="s">__ARCHIVE__</span>
<span class="s">HEADER</span>

<span class="w">    </span><span class="c1"># Append tarball</span>
<span class="w">    </span>tar<span class="w"> </span>czf<span class="w"> </span>-<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source_dir</span><span class="s2">&quot;</span><span class="w"> </span>.<span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output_file</span><span class="s2">&quot;</span>

<span class="w">    </span>chmod<span class="w"> </span>+x<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output_file</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Created: </span><span class="nv">$output_file</span><span class="s2">&quot;</span>
<span class="o">}</span>

create_installer<span class="w"> </span><span class="s2">&quot;install.sh&quot;</span><span class="w"> </span><span class="s2">&quot;./installer_files&quot;</span>
</code></pre></div>

<h3 id="man-page">Man Page<a class="header-link" href="#man-page" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Generate man page</span>
generate_manpage<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cmd_name</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output_file</span><span class="o">=</span><span class="nv">$2</span>

<span class="w">    </span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">.TH MYTOOL 1 &quot;January 2024&quot; &quot;mytool 1.0.0&quot; &quot;User Commands&quot;</span>
<span class="s">.SH NAME</span>
<span class="s">mytool \- Brief description of mytool</span>
<span class="s">.SH SYNOPSIS</span>
<span class="s">.B mytool</span>
<span class="s">[\fIOPTIONS\fR] \fICOMMAND\fR [\fIARGS\fR]</span>
<span class="s">.SH DESCRIPTION</span>
<span class="s">.B mytool</span>
<span class="s">is a tool that does something useful.</span>
<span class="s">Detailed description goes here.</span>
<span class="s">.SH OPTIONS</span>
<span class="s">.TP</span>
<span class="s">.BR \-v &quot;, &quot; \-\-verbose</span>
<span class="s">Enable verbose output</span>
<span class="s">.TP</span>
<span class="s">.BR \-h &quot;, &quot; \-\-help</span>
<span class="s">Show help message</span>
<span class="s">.SH EXAMPLES</span>
<span class="s">.TP</span>
<span class="s">mytool process file.txt</span>
<span class="s">Process a file</span>
<span class="s">.TP</span>
<span class="s">mytool \-v \-\-output=result.txt input.txt</span>
<span class="s">Verbose processing with output file</span>
<span class="s">.SH EXIT STATUS</span>
<span class="s">.TP</span>
<span class="s">.B 0</span>
<span class="s">Success</span>
<span class="s">.TP</span>
<span class="s">.B 1</span>
<span class="s">General error</span>
<span class="s">.SH AUTHOR</span>
<span class="s">Written by Your Name.</span>
<span class="s">.SH REPORTING BUGS</span>
<span class="s">Report bugs to: bugs@example.com</span>
<span class="s">.SH SEE ALSO</span>
<span class="s">Full documentation at: https://example.com/docs</span>
<span class="s">EOF</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Man page created: </span><span class="nv">$output_file</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Install with: cp </span><span class="nv">$output_file</span><span class="s2"> /usr/local/share/man/man1/&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;View with: man </span><span class="nv">$cmd_name</span><span class="s2">&quot;</span>
<span class="o">}</span>

generate_manpage<span class="w"> </span><span class="s2">&quot;mytool&quot;</span><span class="w"> </span><span class="s2">&quot;mytool.1&quot;</span>
</code></pre></div>

<h3 id="bash-completion">Bash Completion<a class="header-link" href="#bash-completion" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Bash completion script for mytool</span>
_mytool_completion<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span>cur<span class="w"> </span>prev<span class="w"> </span>opts
<span class="w">    </span><span class="nv">COMPREPLY</span><span class="o">=()</span>
<span class="w">    </span><span class="nv">cur</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">COMP_WORDS</span><span class="p">[COMP_CWORD]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nv">prev</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">COMP_WORDS</span><span class="p">[COMP_CWORD-1]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Options</span>
<span class="w">    </span><span class="nv">opts</span><span class="o">=</span><span class="s2">&quot;-v --verbose -o --output -h --help --version&quot;</span>

<span class="w">    </span><span class="c1"># Commands</span>
<span class="w">    </span><span class="nv">commands</span><span class="o">=</span><span class="s2">&quot;start stop restart status&quot;</span>

<span class="w">    </span><span class="c1"># Complete options</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">cur</span><span class="si">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>-*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="w"> </span><span class="k">$(</span><span class="nb">compgen</span><span class="w"> </span>-W<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">opts</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--<span class="w"> </span><span class="si">${</span><span class="nv">cur</span><span class="si">}</span><span class="k">)</span><span class="w"> </span><span class="o">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Complete commands</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$COMP_CWORD</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="w"> </span><span class="k">$(</span><span class="nb">compgen</span><span class="w"> </span>-W<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">commands</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--<span class="w"> </span><span class="si">${</span><span class="nv">cur</span><span class="si">}</span><span class="k">)</span><span class="w"> </span><span class="o">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Complete files for --output</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">prev</span><span class="si">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;-o&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">prev</span><span class="si">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;--output&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="w"> </span><span class="k">$(</span><span class="nb">compgen</span><span class="w"> </span>-f<span class="w"> </span>--<span class="w"> </span><span class="si">${</span><span class="nv">cur</span><span class="si">}</span><span class="k">)</span><span class="w"> </span><span class="o">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Default: complete files</span>
<span class="w">    </span><span class="nv">COMPREPLY</span><span class="o">=(</span><span class="w"> </span><span class="k">$(</span><span class="nb">compgen</span><span class="w"> </span>-f<span class="w"> </span>--<span class="w"> </span><span class="si">${</span><span class="nv">cur</span><span class="si">}</span><span class="k">)</span><span class="w"> </span><span class="o">)</span>
<span class="o">}</span>

<span class="c1"># Register completion</span>
<span class="nb">complete</span><span class="w"> </span>-F<span class="w"> </span>_mytool_completion<span class="w"> </span>mytool

<span class="c1"># Install instructions:</span>
<span class="c1"># cp mytool-completion.bash /etc/bash_completion.d/mytool</span>
</code></pre></div>

<h2 id="9-practice-problems">9. Practice Problems<a class="header-link" href="#9-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-posix-shell-converter">Problem 1: POSIX Shell Converter<a class="header-link" href="#problem-1-posix-shell-converter" title="Permanent link">&para;</a></h3>
<p>Create a tool that:
- Analyzes a Bash script and identifies Bashisms
- Suggests POSIX-compatible alternatives
- Optionally attempts automatic conversion
- Generates a report of changes needed
- Tests the converted script for syntax errors
- Maintains functionality through testing</p>
<h3 id="problem-2-performance-profiler">Problem 2: Performance Profiler<a class="header-link" href="#problem-2-performance-profiler" title="Permanent link">&para;</a></h3>
<p>Build a profiling tool that:
- Instruments a shell script to measure execution time of each function
- Identifies bottlenecks (slowest functions)
- Counts how many times each command is called
- Suggests optimizations based on analysis
- Generates a visual report (HTML or terminal-based)
- Compares "before" and "after" performance</p>
<h3 id="problem-3-security-auditor">Problem 3: Security Auditor<a class="header-link" href="#problem-3-security-auditor" title="Permanent link">&para;</a></h3>
<p>Develop a security audit tool that:
- Scans scripts for common vulnerabilities (eval, unquoted variables, etc.)
- Checks for insecure temp file creation
- Identifies potential command injection points
- Verifies input validation practices
- Checks file permissions and ownership
- Generates a security report with severity levels
- Suggests fixes for each issue found</p>
<h3 id="problem-4-package-manager">Problem 4: Package Manager<a class="header-link" href="#problem-4-package-manager" title="Permanent link">&para;</a></h3>
<p>Create a simple package manager for shell scripts that:
- Installs scripts to appropriate directories (<code>/usr/local/bin</code>)
- Manages dependencies (checks for required commands)
- Handles version updates
- Generates and installs man pages
- Sets up bash completion
- Supports uninstallation with cleanup
- Maintains a registry of installed scripts</p>
<h3 id="problem-5-test-framework">Problem 5: Test Framework<a class="header-link" href="#problem-5-test-framework" title="Permanent link">&para;</a></h3>
<p>Implement a testing framework for shell scripts that:
- Supports unit tests for functions
- Mocks external commands
- Captures and validates output (stdout/stderr)
- Tests exit codes
- Provides assertions (assert_equals, assert_contains, etc.)
- Generates coverage reports
- Integrates with CI/CD systems
- Produces JUnit-style XML reports</p>
<hr />
<p><strong>Previous</strong>: <a href="./11_Argument_Parsing.md">11_Argument_Parsing.md</a> | <strong>Next</strong>: <a href="./13_Testing.md">13_Testing.md</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Shell_Script/11_Argument_Parsing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Lesson 11: Argument Parsing and CLI Interfaces</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Shell_Script/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Shell_Script/13_Testing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Shell Script Testing</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}