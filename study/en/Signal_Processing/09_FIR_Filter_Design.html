{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIR Filter Design - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Signal_Processing/">Signal Processing</a>
    <span class="separator">/</span>
    <span class="current">FIR Filter Design</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>FIR Filter Design</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Signal_Processing/08_Digital_Filter_Fundamentals.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Digital Filter Fundamentals</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Signal_Processing/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Signal_Processing/10_IIR_Filter_Design.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">IIR Filter Design</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-fir-filter-design-specifications">1. FIR Filter Design Specifications</a><ul>
<li><a href="#11-filter-terminology">1.1 Filter Terminology</a></li>
<li><a href="#12-decibel-specifications">1.2 Decibel Specifications</a></li>
<li><a href="#13-fir-vs-iir-trade-offs">1.3 FIR vs IIR Trade-offs</a></li>
</ul>
</li>
<li><a href="#2-ideal-filters-and-impulse-responses">2. Ideal Filters and Impulse Responses</a><ul>
<li><a href="#21-ideal-lowpass-filter">2.1 Ideal Lowpass Filter</a></li>
<li><a href="#22-other-ideal-filter-types">2.2 Other Ideal Filter Types</a></li>
</ul>
</li>
<li><a href="#3-window-method">3. Window Method</a><ul>
<li><a href="#31-basic-principle">3.1 Basic Principle</a></li>
<li><a href="#32-effect-of-windowing">3.2 Effect of Windowing</a></li>
<li><a href="#33-gibbs-phenomenon">3.3 Gibbs Phenomenon</a></li>
</ul>
</li>
<li><a href="#4-window-functions">4. Window Functions</a><ul>
<li><a href="#41-common-windows">4.1 Common Windows</a><ul>
<li><a href="#rectangular-window">Rectangular Window</a></li>
<li><a href="#hann-hanning-window">Hann (Hanning) Window</a></li>
<li><a href="#hamming-window">Hamming Window</a></li>
<li><a href="#blackman-window">Blackman Window</a></li>
</ul>
</li>
<li><a href="#42-window-comparison-table">4.2 Window Comparison Table</a></li>
<li><a href="#43-visualizing-windows-and-their-spectra">4.3 Visualizing Windows and Their Spectra</a></li>
<li><a href="#44-design-steps-using-window-method">4.4 Design Steps Using Window Method</a></li>
</ul>
</li>
<li><a href="#5-kaiser-window-design">5. Kaiser Window Design</a><ul>
<li><a href="#51-kaiser-window-definition">5.1 Kaiser Window Definition</a></li>
<li><a href="#52-kaisers-empirical-formulas">5.2 Kaiser's Empirical Formulas</a></li>
<li><a href="#53-kaiser-window-design-procedure">5.3 Kaiser Window Design Procedure</a></li>
<li><a href="#54-using-scipysignalkaiserord">5.4 Using scipy.signal.kaiserord</a></li>
</ul>
</li>
<li><a href="#6-frequency-sampling-method">6. Frequency Sampling Method</a><ul>
<li><a href="#61-principle">6.1 Principle</a></li>
<li><a href="#62-transition-samples">6.2 Transition Samples</a></li>
<li><a href="#63-implementation">6.3 Implementation</a></li>
</ul>
</li>
<li><a href="#7-optimal-equiripple-design-parks-mcclellan-algorithm">7. Optimal Equiripple Design: Parks-McClellan Algorithm</a><ul>
<li><a href="#71-minimax-optimization">7.1 Minimax Optimization</a></li>
<li><a href="#72-equiripple-property">7.2 Equiripple Property</a></li>
<li><a href="#73-remez-exchange-algorithm">7.3 Remez Exchange Algorithm</a></li>
<li><a href="#74-implementation-with-scipysignalremez">7.4 Implementation with scipy.signal.remez</a></li>
<li><a href="#75-bandpass-filter-example">7.5 Bandpass Filter Example</a></li>
</ul>
</li>
<li><a href="#8-linear-phase-fir-filters">8. Linear Phase FIR Filters</a><ul>
<li><a href="#81-importance-of-linear-phase">8.1 Importance of Linear Phase</a></li>
<li><a href="#82-symmetry-conditions">8.2 Symmetry Conditions</a></li>
<li><a href="#83-four-types-of-linear-phase-fir-filters">8.3 Four Types of Linear Phase FIR Filters</a></li>
<li><a href="#84-amplitude-response-formulas">8.4 Amplitude Response Formulas</a></li>
</ul>
</li>
<li><a href="#9-comparison-of-design-methods">9. Comparison of Design Methods</a><ul>
<li><a href="#91-head-to-head-comparison">9.1 Head-to-Head Comparison</a></li>
<li><a href="#92-summary-of-design-methods">9.2 Summary of Design Methods</a></li>
</ul>
</li>
<li><a href="#10-fir-filter-implementation">10. FIR Filter Implementation</a><ul>
<li><a href="#101-direct-convolution">10.1 Direct Convolution</a></li>
<li><a href="#102-fft-based-filtering">10.2 FFT-Based Filtering</a></li>
<li><a href="#103-overlap-add-method">10.3 Overlap-Add Method</a></li>
<li><a href="#104-overlap-save-method">10.4 Overlap-Save Method</a></li>
<li><a href="#105-performance-comparison">10.5 Performance Comparison</a></li>
</ul>
</li>
<li><a href="#11-python-implementation">11. Python Implementation</a><ul>
<li><a href="#111-complete-design-example">11.1 Complete Design Example</a></li>
<li><a href="#112-filtering-a-real-signal">11.2 Filtering a Real Signal</a></li>
<li><a href="#113-multi-band-filter-design">11.3 Multi-band Filter Design</a></li>
</ul>
</li>
<li><a href="#12-exercises">12. Exercises</a><ul>
<li><a href="#exercise-1-window-selection">Exercise 1: Window Selection</a></li>
<li><a href="#exercise-2-kaiser-window-design">Exercise 2: Kaiser Window Design</a></li>
<li><a href="#exercise-3-parks-mcclellan-bandpass-filter">Exercise 3: Parks-McClellan Bandpass Filter</a></li>
<li><a href="#exercise-4-overlap-add-implementation">Exercise 4: Overlap-Add Implementation</a></li>
<li><a href="#exercise-5-linear-phase-constraints">Exercise 5: Linear Phase Constraints</a></li>
<li><a href="#exercise-6-comparison-study">Exercise 6: Comparison Study</a></li>
<li><a href="#exercise-7-minimum-phase-fir-filter">Exercise 7: Minimum-Phase FIR Filter</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
<li><a href="#navigation">Navigation</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="fir-filter-design">FIR Filter Design<a class="header-link" href="#fir-filter-design" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand the specifications and terminology of digital filter design</li>
<li>Master the window method for FIR filter design and compare window functions</li>
<li>Learn frequency sampling and optimal equiripple (Parks-McClellan) design methods</li>
<li>Understand linear phase FIR filter types and their constraints</li>
<li>Design FIR filters using Python's <code>scipy.signal</code> module</li>
<li>Implement FIR filtering using direct convolution, overlap-add, and overlap-save methods</li>
<li>Compare design methods in terms of transition width, stopband attenuation, and computational cost</li>
</ul>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-fir-filter-design-specifications">FIR Filter Design Specifications</a></li>
<li><a href="#2-ideal-filters-and-impulse-responses">Ideal Filters and Impulse Responses</a></li>
<li><a href="#3-window-method">Window Method</a></li>
<li><a href="#4-window-functions">Window Functions</a></li>
<li><a href="#5-kaiser-window-design">Kaiser Window Design</a></li>
<li><a href="#6-frequency-sampling-method">Frequency Sampling Method</a></li>
<li><a href="#7-optimal-equiripple-design-parks-mcclellan-algorithm">Optimal Equiripple Design: Parks-McClellan Algorithm</a></li>
<li><a href="#8-linear-phase-fir-filters">Linear Phase FIR Filters</a></li>
<li><a href="#9-comparison-of-design-methods">Comparison of Design Methods</a></li>
<li><a href="#10-fir-filter-implementation">FIR Filter Implementation</a></li>
<li><a href="#11-python-implementation">Python Implementation</a></li>
<li><a href="#12-exercises">Exercises</a></li>
</ol>
<hr />
<h2 id="1-fir-filter-design-specifications">1. FIR Filter Design Specifications<a class="header-link" href="#1-fir-filter-design-specifications" title="Permanent link">&para;</a></h2>
<h3 id="11-filter-terminology">1.1 Filter Terminology<a class="header-link" href="#11-filter-terminology" title="Permanent link">&para;</a></h3>
<p>A digital filter is characterized by its <strong>frequency response</strong> $H(e^{j\omega})$, which specifies how different frequency components of a signal are modified. The key specifications include:</p>
<p><strong>Frequency bands:</strong>
- <strong>Passband</strong>: frequencies that should pass through with minimal distortion, $0 \leq \omega \leq \omega_p$
- <strong>Stopband</strong>: frequencies that should be attenuated, $\omega_s \leq \omega \leq \pi$
- <strong>Transition band</strong>: the region between passband and stopband, $\omega_p < \omega < \omega_s$</p>
<p><strong>Tolerances:</strong>
- <strong>Passband ripple</strong> $\delta_1$: maximum deviation from unity in the passband
- <strong>Stopband attenuation</strong> $\delta_2$: maximum magnitude in the stopband</p>
<div class="highlight"><pre><span></span><code>Magnitude Response Specification
|H(e^jÏ‰)|
    â†‘
1+Î´â‚ â”€ â”€ â”€ â”€â”
    â”‚        â”‚
  1 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚        â”‚
1-Î´â‚ â”€ â”€ â”€ â”€â”˜        â•²
    â”‚                    â•²
  Î´â‚‚ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                      â”‚
  0 â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â†’ Ï‰
    0     Ï‰p    Ï‰s        Ï€

         Passband â”‚Trans.â”‚ Stopband
                  â”‚ band â”‚
</code></pre></div>

<h3 id="12-decibel-specifications">1.2 Decibel Specifications<a class="header-link" href="#12-decibel-specifications" title="Permanent link">&para;</a></h3>
<p>In practice, filter specifications are often given in decibels:</p>
<p>$$A_p = -20\log_{10}(1 - \delta_1) \quad \text{(passband ripple in dB)}$$</p>
<p>$$A_s = -20\log_{10}(\delta_2) \quad \text{(stopband attenuation in dB)}$$</p>
<p>Common specification examples:
- Passband ripple: $A_p \leq 0.1$ dB (implies $\delta_1 \approx 0.0115$)
- Stopband attenuation: $A_s \geq 60$ dB (implies $\delta_2 = 0.001$)</p>
<h3 id="13-fir-vs-iir-trade-offs">1.3 FIR vs IIR Trade-offs<a class="header-link" href="#13-fir-vs-iir-trade-offs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="n">FIR</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="n">IIR</span><span class="w"> </span><span class="n">Comparison</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Property</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="n">FIR</span><span class="w">             </span><span class="err">â”‚</span><span class="w"> </span><span class="n">IIR</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Stability</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Always</span><span class="w"> </span><span class="n">stable</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">unstable</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Linear</span><span class="w"> </span><span class="n">phase</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Easily</span><span class="w"> </span><span class="n">achieved</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Not</span><span class="w"> </span><span class="n">possible</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Filter</span><span class="w"> </span><span class="n">order</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Higher</span><span class="w">          </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Lower</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Computation</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="n">More</span><span class="w"> </span><span class="n">multiplies</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Fewer</span><span class="w"> </span><span class="n">multiplies</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Design</span><span class="w"> </span><span class="n">methods</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Window</span><span class="p">,</span><span class="w"> </span><span class="n">PM</span><span class="p">,</span><span class="w"> </span><span class="n">FS</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Analog</span><span class="w"> </span><span class="n">prototypes</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="n">delay</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Constant</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Non</span><span class="o">-</span><span class="n">constant</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Round</span><span class="o">-</span><span class="n">off</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Less</span><span class="w"> </span><span class="n">sensitive</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">More</span><span class="w"> </span><span class="n">sensitive</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Implementation</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">feedback</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Feedback</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<p>An FIR filter of order $M$ has the transfer function:</p>
<p>$$H(z) = \sum_{n=0}^{M} h[n] z^{-n}$$</p>
<p>The output is a finite convolution:</p>
<p>$$y[n] = \sum_{k=0}^{M} h[k] x[n-k]$$</p>
<hr />
<h2 id="2-ideal-filters-and-impulse-responses">2. Ideal Filters and Impulse Responses<a class="header-link" href="#2-ideal-filters-and-impulse-responses" title="Permanent link">&para;</a></h2>
<h3 id="21-ideal-lowpass-filter">2.1 Ideal Lowpass Filter<a class="header-link" href="#21-ideal-lowpass-filter" title="Permanent link">&para;</a></h3>
<p>The ideal lowpass filter has the frequency response:</p>
<p>$$H_d(e^{j\omega}) = \begin{cases} 1, & |\omega| \leq \omega_c \\ 0, & \omega_c < |\omega| \leq \pi \end{cases}$$</p>
<p>Its impulse response is obtained via the inverse DTFT:</p>
<p>$$h_d[n] = \frac{1}{2\pi} \int_{-\pi}^{\pi} H_d(e^{j\omega}) e^{j\omega n} d\omega = \frac{\sin(\omega_c n)}{\pi n}$$</p>
<p>This is a <strong>sinc function</strong> that is:
- Infinite in duration (non-causal, unrealizable)
- Symmetric about $n = 0$</p>
<h3 id="22-other-ideal-filter-types">2.2 Other Ideal Filter Types<a class="header-link" href="#22-other-ideal-filter-types" title="Permanent link">&para;</a></h3>
<p><strong>Ideal highpass filter:</strong></p>
<p>$$h_d[n] = \delta[n] - \frac{\sin(\omega_c n)}{\pi n}$$</p>
<p><strong>Ideal bandpass filter</strong> ($\omega_{c1} < |\omega| < \omega_{c2}$):</p>
<p>$$h_d[n] = \frac{\sin(\omega_{c2} n)}{\pi n} - \frac{\sin(\omega_{c1} n)}{\pi n}$$</p>
<p><strong>Ideal bandstop filter:</strong></p>
<p>$$h_d[n] = \delta[n] - \frac{\sin(\omega_{c2} n)}{\pi n} + \frac{\sin(\omega_{c1} n)}{\pi n}$$</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ideal_lowpass</span><span class="p">(</span><span class="n">omega_c</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute ideal lowpass filter impulse response (truncated).&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">M</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Handle n = 0 case (sinc(0) = omega_c / pi)</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">M</span>
    <span class="n">h</span><span class="p">[</span><span class="n">center</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega_c</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="c1"># Non-zero indices</span>
    <span class="n">nonzero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
    <span class="n">h</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omega_c</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="n">nonzero</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">n</span><span class="p">[</span><span class="n">nonzero</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">h</span>

<span class="c1"># Plot ideal lowpass impulse responses for different cutoff frequencies</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>
                           <span class="p">[</span><span class="s1">&#39;Ï‰c = Ï€/4&#39;</span><span class="p">,</span> <span class="s1">&#39;Ï‰c = Ï€/2&#39;</span><span class="p">,</span> <span class="s1">&#39;Ï‰c = 3Ï€/4&#39;</span><span class="p">]):</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">ideal_lowpass</span><span class="p">(</span><span class="n">wc</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;h[n]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ideal LP Impulse Response (</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ideal_lowpass_responses.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="3-window-method">3. Window Method<a class="header-link" href="#3-window-method" title="Permanent link">&para;</a></h2>
<h3 id="31-basic-principle">3.1 Basic Principle<a class="header-link" href="#31-basic-principle" title="Permanent link">&para;</a></h3>
<p>The window method is the simplest FIR design approach. The idea is to:</p>
<ol>
<li>Start with the ideal (infinite) impulse response $h_d[n]$</li>
<li>Multiply by a finite-duration window $w[n]$ of length $N = M + 1$</li>
<li>Shift the result to make the filter causal</li>
</ol>
<p>$$h[n] = h_d[n - M/2] \cdot w[n], \quad n = 0, 1, \ldots, M$$</p>
<p>In the frequency domain, this multiplication corresponds to convolution:</p>
<p>$$H(e^{j\omega}) = \frac{1}{2\pi} H_d(e^{j\omega}) * W(e^{j\omega})$$</p>
<h3 id="32-effect-of-windowing">3.2 Effect of Windowing<a class="header-link" href="#32-effect-of-windowing" title="Permanent link">&para;</a></h3>
<p>The window's frequency response $W(e^{j\omega})$ determines:</p>
<ol>
<li><strong>Mainlobe width</strong>: Controls the transition bandwidth -- wider mainlobe means wider transition band</li>
<li><strong>Sidelobe level</strong>: Determines stopband attenuation -- higher sidelobes mean less stopband attenuation</li>
<li><strong>Sidelobe decay rate</strong>: How quickly sidelobes decrease with frequency</li>
</ol>
<div class="highlight"><pre><span></span><code>Window Spectrum Properties
|W(e^jÏ‰)|
    â†‘
    â”‚   â•±â•²        Mainlobe
    â”‚  â•±  â•²       width = Î”Ï‰_ML
    â”‚ â•±    â•²
    â”‚â•±      â•²  â•±â•²
    â”‚        â•²â•±  â•²  â•±â•²       Peak sidelobe
    â”‚         â”‚   â•²â•±  â•²      level (dB)
    â”‚         â”‚    â”‚   â•²â•±â•²
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â†’ Ï‰
    0      Î”Ï‰_ML/2          Ï€
</code></pre></div>

<h3 id="33-gibbs-phenomenon">3.3 Gibbs Phenomenon<a class="header-link" href="#33-gibbs-phenomenon" title="Permanent link">&para;</a></h3>
<p>When truncating the ideal impulse response with a rectangular window, the Gibbs phenomenon causes approximately 9% overshoot (about $-21$ dB stopband attenuation) at the band edge, regardless of the filter length. Increasing the filter order $M$ only narrows the transition width but does not reduce the ripple amplitude.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">windowed_lowpass</span><span class="p">(</span><span class="n">omega_c</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">window_type</span><span class="o">=</span><span class="s1">&#39;rectangular&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Design lowpass FIR filter using window method.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># Delay for linear phase</span>

    <span class="c1"># Ideal lowpass impulse response (shifted for causality)</span>
    <span class="n">h_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="n">h_d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega_c</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h_d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omega_c</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">))</span>

    <span class="c1"># Apply window</span>
    <span class="k">if</span> <span class="n">window_type</span> <span class="o">==</span> <span class="s1">&#39;rectangular&#39;</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">window_type</span> <span class="o">==</span> <span class="s1">&#39;hamming&#39;</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">window_type</span> <span class="o">==</span> <span class="s1">&#39;hanning&#39;</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">hann</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">window_type</span> <span class="o">==</span> <span class="s1">&#39;blackman&#39;</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">blackman</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">h_d</span> <span class="o">*</span> <span class="n">w</span>
    <span class="k">return</span> <span class="n">h</span>

<span class="c1"># Demonstrate Gibbs phenomenon with rectangular window</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">omega_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">M</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">windowed_lowpass</span><span class="p">(</span><span class="n">omega_c</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="s1">&#39;rectangular&#39;</span><span class="p">)</span>

    <span class="c1"># Frequency response</span>
    <span class="n">w_freq</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span>
    <span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_freq</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mi">21</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-21 dB (Gibbs)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ï‰c = Ï€/2&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€ rad/sample)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rectangular Window, M = </span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Gibbs Phenomenon: Stopband ripple remains ~-21 dB&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;gibbs_phenomenon.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="4-window-functions">4. Window Functions<a class="header-link" href="#4-window-functions" title="Permanent link">&para;</a></h2>
<h3 id="41-common-windows">4.1 Common Windows<a class="header-link" href="#41-common-windows" title="Permanent link">&para;</a></h3>
<p>Each window function trades off mainlobe width against sidelobe level. Smoother windows have wider mainlobes but lower sidelobes.</p>
<h4 id="rectangular-window">Rectangular Window<a class="header-link" href="#rectangular-window" title="Permanent link">&para;</a></h4>
<p>$$w[n] = 1, \quad 0 \leq n \leq M$$</p>
<ul>
<li><strong>Mainlobe width</strong>: $\Delta\omega_\text{ML} = 4\pi / (M+1)$</li>
<li><strong>Peak sidelobe</strong>: $-13$ dB</li>
<li><strong>Minimum stopband attenuation</strong>: $-21$ dB</li>
<li><strong>Transition width</strong>: $\Delta\omega \approx 0.92 \cdot 2\pi / (M+1)$</li>
</ul>
<h4 id="hann-hanning-window">Hann (Hanning) Window<a class="header-link" href="#hann-hanning-window" title="Permanent link">&para;</a></h4>
<p>$$w[n] = 0.5 - 0.5\cos\left(\frac{2\pi n}{M}\right), \quad 0 \leq n \leq M$$</p>
<ul>
<li><strong>Mainlobe width</strong>: $\Delta\omega_\text{ML} = 8\pi / (M+1)$</li>
<li><strong>Peak sidelobe</strong>: $-31$ dB</li>
<li><strong>Minimum stopband attenuation</strong>: $-44$ dB</li>
<li><strong>Transition width</strong>: $\Delta\omega \approx 3.11 \cdot 2\pi / (M+1)$</li>
</ul>
<h4 id="hamming-window">Hamming Window<a class="header-link" href="#hamming-window" title="Permanent link">&para;</a></h4>
<p>$$w[n] = 0.54 - 0.46\cos\left(\frac{2\pi n}{M}\right), \quad 0 \leq n \leq M$$</p>
<ul>
<li><strong>Mainlobe width</strong>: $\Delta\omega_\text{ML} = 8\pi / (M+1)$</li>
<li><strong>Peak sidelobe</strong>: $-41$ dB</li>
<li><strong>Minimum stopband attenuation</strong>: $-53$ dB</li>
<li><strong>Transition width</strong>: $\Delta\omega \approx 3.32 \cdot 2\pi / (M+1)$</li>
</ul>
<h4 id="blackman-window">Blackman Window<a class="header-link" href="#blackman-window" title="Permanent link">&para;</a></h4>
<p>$$w[n] = 0.42 - 0.5\cos\left(\frac{2\pi n}{M}\right) + 0.08\cos\left(\frac{4\pi n}{M}\right), \quad 0 \leq n \leq M$$</p>
<ul>
<li><strong>Mainlobe width</strong>: $\Delta\omega_\text{ML} = 12\pi / (M+1)$</li>
<li><strong>Peak sidelobe</strong>: $-57$ dB</li>
<li><strong>Minimum stopband attenuation</strong>: $-74$ dB</li>
<li><strong>Transition width</strong>: $\Delta\omega \approx 5.56 \cdot 2\pi / (M+1)$</li>
</ul>
<h3 id="42-window-comparison-table">4.2 Window Comparison Table<a class="header-link" href="#42-window-comparison-table" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Window      â”‚ Peak Sidelobeâ”‚ Min Stopband  â”‚ Approx. Trans.    â”‚
â”‚             â”‚ Level (dB)   â”‚ Atten. (dB)   â”‚ Width (rad)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Rectangular â”‚ -13          â”‚ -21           â”‚ 0.92Â·(2Ï€/M)       â”‚
â”‚ Hann        â”‚ -31          â”‚ -44           â”‚ 3.11Â·(2Ï€/M)       â”‚
â”‚ Hamming     â”‚ -41          â”‚ -53           â”‚ 3.32Â·(2Ï€/M)       â”‚
â”‚ Blackman    â”‚ -57          â”‚ -74           â”‚ 5.56Â·(2Ï€/M)       â”‚
â”‚ Kaiser(Î²=6) â”‚ -44          â”‚ -60           â”‚ adjustable        â”‚
â”‚ Kaiser(Î²=9) â”‚ -69          â”‚ -90           â”‚ adjustable        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="43-visualizing-windows-and-their-spectra">4.3 Visualizing Windows and Their Spectra<a class="header-link" href="#43-visualizing-windows-and-their-spectra" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_windows</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare common window functions in time and frequency domains.&quot;&quot;&quot;</span>
    <span class="n">windows</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Rectangular&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;Hann&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">hann</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;Hamming&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;Blackman&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">blackman</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>

    <span class="c1"># Time domain</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">windows</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">w</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sample n&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;w[n]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Window Functions (Time Domain)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Frequency domain (log magnitude)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nfft</span> <span class="o">=</span> <span class="mi">4096</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">windows</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">nfft</span><span class="p">)</span>
        <span class="n">W_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">nfft</span><span class="p">)</span>
        <span class="n">W_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">W_shift</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">W_shift</span><span class="p">))</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">W_dB</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€ rad/sample)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Window Spectra (Frequency Domain)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;window_comparison.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">compare_windows</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>

<h3 id="44-design-steps-using-window-method">4.4 Design Steps Using Window Method<a class="header-link" href="#44-design-steps-using-window-method" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Determine specifications</strong>: $\omega_p$, $\omega_s$, $\delta_1$, $\delta_2$</li>
<li><strong>Select window type</strong> based on required stopband attenuation</li>
<li><strong>Compute transition width</strong>: $\Delta\omega = \omega_s - \omega_p$</li>
<li><strong>Determine filter order</strong> $M$ from the window's transition width formula</li>
<li><strong>Set cutoff frequency</strong>: $\omega_c = (\omega_p + \omega_s) / 2$</li>
<li><strong>Compute ideal impulse response</strong> $h_d[n]$ shifted by $M/2$</li>
<li><strong>Apply window</strong> to get $h[n] = h_d[n] \cdot w[n]$</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">design_fir_window</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">delta_s</span><span class="p">,</span> <span class="n">window_type</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Design FIR lowpass filter using window method.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        wp: passband edge (normalized, 0 to pi)</span>
<span class="sd">        ws: stopband edge (normalized, 0 to pi)</span>
<span class="sd">        delta_s: stopband attenuation (linear)</span>
<span class="sd">        window_type: &#39;rectangular&#39;, &#39;hann&#39;, &#39;hamming&#39;, or &#39;blackman&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        h: filter coefficients</span>
<span class="sd">        M: filter order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Transition width</span>
    <span class="n">delta_w</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">-</span> <span class="n">wp</span>

    <span class="c1"># Cutoff frequency (midpoint)</span>
    <span class="n">wc</span> <span class="o">=</span> <span class="p">(</span><span class="n">wp</span> <span class="o">+</span> <span class="n">ws</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Determine filter order M from window type</span>
    <span class="n">transition_coefficients</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rectangular&#39;</span><span class="p">:</span> <span class="mf">0.92</span><span class="p">,</span>
        <span class="s1">&#39;hann&#39;</span><span class="p">:</span>        <span class="mf">3.11</span><span class="p">,</span>
        <span class="s1">&#39;hamming&#39;</span><span class="p">:</span>     <span class="mf">3.32</span><span class="p">,</span>
        <span class="s1">&#39;blackman&#39;</span><span class="p">:</span>    <span class="mf">5.56</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="n">transition_coefficients</span><span class="p">[</span><span class="n">window_type</span><span class="p">]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">coeff</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">delta_w</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Ensure even order for Type I filter</span>

    <span class="c1"># Compute windowed ideal lowpass</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">h_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">n</span> <span class="o">==</span> <span class="n">alpha</span><span class="p">,</span>
        <span class="n">wc</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wc</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1"># Apply window</span>
    <span class="n">windows</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rectangular&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;hann&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">hann</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;hamming&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;blackman&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">blackman</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[</span><span class="n">window_type</span><span class="p">]</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">h_d</span> <span class="o">*</span> <span class="n">w</span>

    <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">M</span>

<span class="c1"># Example: design lowpass filter</span>
<span class="n">wp</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># Passband edge</span>
<span class="n">ws</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># Stopband edge</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">window_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rectangular&#39;</span><span class="p">,</span> <span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="s1">&#39;blackman&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wtype</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">window_types</span><span class="p">):</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">design_fir_window</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">wtype</span><span class="p">)</span>
    <span class="n">w_freq</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
    <span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_freq</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Ï‰p = 0.3Ï€&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Ï‰s = 0.5Ï€&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€ rad/sample)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wtype</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> Window, M = </span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;FIR Lowpass Filter Design: Window Method Comparison&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fir_window_method.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="5-kaiser-window-design">5. Kaiser Window Design<a class="header-link" href="#5-kaiser-window-design" title="Permanent link">&para;</a></h2>
<h3 id="51-kaiser-window-definition">5.1 Kaiser Window Definition<a class="header-link" href="#51-kaiser-window-definition" title="Permanent link">&para;</a></h3>
<p>The Kaiser window provides a <strong>continuously adjustable</strong> parameter $\beta$ that controls the trade-off between mainlobe width and sidelobe level:</p>
<p>$$w[n] = \frac{I_0\left(\beta\sqrt{1 - \left(\frac{2n}{M} - 1\right)^2}\right)}{I_0(\beta)}, \quad 0 \leq n \leq M$$</p>
<p>where $I_0(\cdot)$ is the zeroth-order modified Bessel function of the first kind.</p>
<h3 id="52-kaisers-empirical-formulas">5.2 Kaiser's Empirical Formulas<a class="header-link" href="#52-kaisers-empirical-formulas" title="Permanent link">&para;</a></h3>
<p>Given the desired stopband attenuation $A_s$ (in dB):</p>
<p><strong>Parameter $\beta$:</strong></p>
<p>$$\beta = \begin{cases} 0.1102(A_s - 8.7), & A_s > 50 \\ 0.5842(A_s - 21)^{0.4} + 0.07886(A_s - 21), & 21 \leq A_s \leq 50 \\ 0, & A_s < 21 \end{cases}$$</p>
<p><strong>Filter order $M$:</strong></p>
<p>$$M = \left\lceil \frac{A_s - 7.95}{2.285 \cdot \Delta\omega} \right\rceil$$</p>
<p>where $\Delta\omega = \omega_s - \omega_p$ is the transition width.</p>
<h3 id="53-kaiser-window-design-procedure">5.3 Kaiser Window Design Procedure<a class="header-link" href="#53-kaiser-window-design-procedure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">kaiser_fir_design</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Design FIR lowpass filter using Kaiser window.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        wp: passband edge (normalized, 0 to pi)</span>
<span class="sd">        ws: stopband edge (normalized, 0 to pi)</span>
<span class="sd">        As_dB: stopband attenuation in dB</span>

<span class="sd">    Returns:</span>
<span class="sd">        h: filter coefficients</span>
<span class="sd">        M: filter order</span>
<span class="sd">        beta: Kaiser window parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Transition width</span>
    <span class="n">delta_w</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">-</span> <span class="n">wp</span>

    <span class="c1"># Cutoff frequency</span>
    <span class="n">wc</span> <span class="o">=</span> <span class="p">(</span><span class="n">wp</span> <span class="o">+</span> <span class="n">ws</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Kaiser&#39;s empirical formula for beta</span>
    <span class="k">if</span> <span class="n">As_dB</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.1102</span> <span class="o">*</span> <span class="p">(</span><span class="n">As_dB</span> <span class="o">-</span> <span class="mf">8.7</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">As_dB</span> <span class="o">&gt;=</span> <span class="mi">21</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5842</span> <span class="o">*</span> <span class="p">(</span><span class="n">As_dB</span> <span class="o">-</span> <span class="mi">21</span><span class="p">)</span><span class="o">**</span><span class="mf">0.4</span> <span class="o">+</span> <span class="mf">0.07886</span> <span class="o">*</span> <span class="p">(</span><span class="n">As_dB</span> <span class="o">-</span> <span class="mi">21</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Filter order</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">As_dB</span> <span class="o">-</span> <span class="mf">7.95</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.285</span> <span class="o">*</span> <span class="n">delta_w</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Ensure even order for Type I</span>

    <span class="c1"># Ideal lowpass impulse response</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">h_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">n</span> <span class="o">==</span> <span class="n">alpha</span><span class="p">,</span>
        <span class="n">wc</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wc</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1"># Kaiser window</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">kaiser</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">h_d</span> <span class="o">*</span> <span class="n">w</span>
    <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">beta</span>

<span class="c1"># Design filters with different stopband attenuations</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">specs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">As</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">specs</span><span class="p">):</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">kaiser_fir_design</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">As</span><span class="p">)</span>
    <span class="n">w_freq</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
    <span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_freq</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">As</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">As</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€ rad/sample)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Kaiser: As=</span><span class="si">{</span><span class="n">As</span><span class="si">}</span><span class="s1"> dB, Î²=</span><span class="si">{</span><span class="n">beta</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, M=</span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">As</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Kaiser Window FIR Design: Varying Stopband Attenuation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;kaiser_design.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="54-using-scipysignalkaiserord">5.4 Using scipy.signal.kaiserord<a class="header-link" href="#54-using-scipysignalkaiserord" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># scipy provides convenient functions for Kaiser window design</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">kaiserord</span><span class="p">,</span> <span class="n">firwin</span>

<span class="c1"># Specification</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">8000</span>  <span class="c1"># Sample rate (Hz)</span>
<span class="n">f_pass</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Passband edge (Hz)</span>
<span class="n">f_stop</span> <span class="o">=</span> <span class="mi">1500</span>  <span class="c1"># Stopband edge (Hz)</span>
<span class="n">A_stop</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># Stopband attenuation (dB)</span>

<span class="c1"># Compute transition width in normalized frequency</span>
<span class="n">nyquist</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_stop</span> <span class="o">-</span> <span class="n">f_pass</span><span class="p">)</span> <span class="o">/</span> <span class="n">nyquist</span>  <span class="c1"># Normalized transition width</span>

<span class="c1"># Kaiser window parameters</span>
<span class="n">numtaps</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">kaiserord</span><span class="p">(</span><span class="n">A_stop</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<span class="k">if</span> <span class="n">numtaps</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">numtaps</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># firwin needs odd number of taps for Type I</span>

<span class="c1"># Design the filter</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_pass</span> <span class="o">+</span> <span class="n">f_stop</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">nyquist</span>  <span class="c1"># Normalized cutoff</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;kaiser&#39;</span><span class="p">,</span> <span class="n">beta</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filter order: </span><span class="si">{</span><span class="n">numtaps</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of taps: </span><span class="si">{</span><span class="n">numtaps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kaiser beta: </span><span class="si">{</span><span class="n">beta</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Frequency response</span>
<span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Magnitude response</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">A_stop</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">A_stop</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_pass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;fp=</span><span class="si">{</span><span class="n">f_pass</span><span class="si">}</span><span class="s1"> Hz&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_stop</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;fs=</span><span class="si">{</span><span class="n">f_stop</span><span class="si">}</span><span class="s1"> Hz&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude Response&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Impulse response</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sample n&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;h[n]&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Impulse Response (M=</span><span class="si">{</span><span class="n">numtaps</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;kaiser_scipy.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="6-frequency-sampling-method">6. Frequency Sampling Method<a class="header-link" href="#6-frequency-sampling-method" title="Permanent link">&para;</a></h2>
<h3 id="61-principle">6.1 Principle<a class="header-link" href="#61-principle" title="Permanent link">&para;</a></h3>
<p>The frequency sampling method designs an FIR filter by specifying the desired frequency response at $N$ equally spaced frequency points and computing the filter coefficients via the inverse DFT:</p>
<p>$$H[k] = H(e^{j 2\pi k / N}), \quad k = 0, 1, \ldots, N-1$$</p>
<p>$$h[n] = \frac{1}{N} \sum_{k=0}^{N-1} H[k] e^{j 2\pi k n / N}, \quad n = 0, 1, \ldots, N-1$$</p>
<h3 id="62-transition-samples">6.2 Transition Samples<a class="header-link" href="#62-transition-samples" title="Permanent link">&para;</a></h3>
<p>The key insight is that <strong>transition band samples</strong> can be optimized to reduce stopband ripple. Instead of a hard transition from 1 to 0, intermediate values $T_1, T_2, \ldots$ are placed in the transition band.</p>
<div class="highlight"><pre><span></span><code><span class="n">Frequency</span><span class="w"> </span><span class="n">samples</span><span class="w"> </span><span class="n">H</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="err">:</span>
<span class="n">H</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>
<span class="w">  </span><span class="err">â†‘</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â—</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â—</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â—</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â—</span>
<span class="w">  </span><span class="err">â”‚</span><span class="w">                   </span><span class="err">â•²</span>
<span class="n">Tâ‚</span><span class="err">â”‚</span><span class="w">                    </span><span class="err">â—</span><span class="w">   </span><span class="err">â†</span><span class="w"> </span><span class="n">Transition</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="p">(</span><span class="n">optimized</span><span class="p">)</span>
<span class="w">  </span><span class="err">â”‚</span><span class="w">                      </span><span class="err">â•²</span>
<span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â”€â—</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â—</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â—</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â—</span><span class="w"> </span><span class="err">â”€</span><span class="w"> </span><span class="err">â—</span>
<span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’</span><span class="w"> </span><span class="n">k</span>
</code></pre></div>

<h3 id="63-implementation">6.3 Implementation<a class="header-link" href="#63-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">freq_sampling_lowpass</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cutoff_bin</span><span class="p">,</span> <span class="n">transition_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIR filter design via frequency sampling.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        N: number of samples (filter length)</span>
<span class="sd">        cutoff_bin: passband ends at bin index cutoff_bin</span>
<span class="sd">        transition_values: list of transition band sample values</span>

<span class="sd">    Returns:</span>
<span class="sd">        h: filter coefficients (real)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

    <span class="c1"># Passband (bins 0 to cutoff_bin)</span>
    <span class="n">H</span><span class="p">[:</span><span class="n">cutoff_bin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Mirror for negative frequencies (ensure real h[n])</span>
    <span class="n">H</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="n">cutoff_bin</span><span class="p">:]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Transition band samples</span>
    <span class="k">if</span> <span class="n">transition_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">T</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transition_values</span><span class="p">):</span>
            <span class="n">H</span><span class="p">[</span><span class="n">cutoff_bin</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span>
            <span class="n">H</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="n">cutoff_bin</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span>

    <span class="c1"># Inverse DFT to get filter coefficients</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>

    <span class="c1"># Circular shift for causal filter</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">h</span>

<span class="c1"># Compare with and without optimized transition samples</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">cutoff_bin</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Without transition samples</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">freq_sampling_lowpass</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cutoff_bin</span><span class="p">)</span>
<span class="n">w1</span><span class="p">,</span> <span class="n">H1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>

<span class="c1"># With optimized transition sample</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">freq_sampling_lowpass</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cutoff_bin</span><span class="p">,</span> <span class="n">transition_values</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">])</span>
<span class="n">w2</span><span class="p">,</span> <span class="n">H2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>

<span class="c1"># With two optimized transition samples</span>
<span class="n">h3</span> <span class="o">=</span> <span class="n">freq_sampling_lowpass</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cutoff_bin</span><span class="p">,</span> <span class="n">transition_values</span><span class="o">=</span><span class="p">[</span><span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">])</span>
<span class="n">w3</span><span class="p">,</span> <span class="n">H3</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h3</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;No transition&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T=[0.5]&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T=[0.59, 0.11]&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€ rad/sample)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Frequency Sampling: Effect of Transition Values&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">h3</span><span class="p">,</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sample n&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;h[n]&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Impulse Response (Optimized Transition)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;freq_sampling.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="7-optimal-equiripple-design-parks-mcclellan-algorithm">7. Optimal Equiripple Design: Parks-McClellan Algorithm<a class="header-link" href="#7-optimal-equiripple-design-parks-mcclellan-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="71-minimax-optimization">7.1 Minimax Optimization<a class="header-link" href="#71-minimax-optimization" title="Permanent link">&para;</a></h3>
<p>The Parks-McClellan (PM) algorithm, also known as the Remez exchange algorithm, designs FIR filters that minimize the maximum weighted error in the frequency domain:</p>
<p>$$\min_{h} \max_{\omega \in \text{bands}} \left| W(\omega) \left[ H_d(\omega) - H(\omega) \right] \right|$$</p>
<p>where:
- $H_d(\omega)$ is the desired frequency response
- $H(\omega) = \sum_{n=0}^{M} h[n] e^{-j\omega n}$ is the actual response
- $W(\omega)$ is a weighting function</p>
<h3 id="72-equiripple-property">7.2 Equiripple Property<a class="header-link" href="#72-equiripple-property" title="Permanent link">&para;</a></h3>
<p>The Chebyshev theorem guarantees that the optimal solution exhibits an <strong>equiripple</strong> error -- the error oscillates between $\pm\delta$ with equal amplitude across all specified bands:</p>
<div class="highlight"><pre><span></span><code>Equiripple Error Behavior:
          Passband                      Stopband
    â†‘    +Î´â‚ â”€ â”€ â”€ â•±â•²    â•±â•²
H(Ï‰)â”‚          â•±  â•² â•±  â•²
    â”‚    â”€â”€â”€â”€â”€â•±â”€â”€â”€â”€â•²â•±â”€â”€â”€â”€â•²â”€â”€â”€â”€ 1.0
    â”‚
    â”‚                                     â•±â•²    â•±â•²    â•±â•²
    â”‚     -Î´â‚ â”€ â”€ â”€               â”€â”€â•²â”€â”€â•±â”€â”€â•²â”€â”€â•±â”€â”€â•²â”€â”€â•±â”€â”€
    â”‚                          +Î´â‚‚ â”€ â”€â•²â•±â”€ â”€ â•²â•±â”€ â”€ â•²â•±â”€
    â”‚                          -Î´â‚‚ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Ï‰
</code></pre></div>

<h3 id="73-remez-exchange-algorithm">7.3 Remez Exchange Algorithm<a class="header-link" href="#73-remez-exchange-algorithm" title="Permanent link">&para;</a></h3>
<p>The algorithm iteratively:</p>
<ol>
<li><strong>Initialize</strong> with $(M/2 + 2)$ extremal frequency points</li>
<li><strong>Solve</strong> the interpolation problem to find the polynomial that produces equiripple behavior</li>
<li><strong>Search</strong> for new extremal points where the error is maximum</li>
<li><strong>Exchange</strong> the current extremal set with the new one</li>
<li><strong>Repeat</strong> until convergence (extremal points stabilize)</li>
</ol>
<h3 id="74-implementation-with-scipysignalremez">7.4 Implementation with scipy.signal.remez<a class="header-link" href="#74-implementation-with-scipysignalremez" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">remez</span><span class="p">,</span> <span class="n">freqz</span>

<span class="k">def</span><span class="w"> </span><span class="nf">parks_mcclellan_lowpass</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">fs_hz</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Design lowpass FIR filter using Parks-McClellan algorithm.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        numtaps: number of filter taps (M + 1)</span>
<span class="sd">        fp: passband edge frequency (Hz)</span>
<span class="sd">        fs_freq: stopband edge frequency (Hz)</span>
<span class="sd">        fs_hz: sampling frequency (Hz)</span>
<span class="sd">        weight: weighting [W_pass, W_stop]</span>

<span class="sd">    Returns:</span>
<span class="sd">        h: filter coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Bands: [0, fp, fs, fs_hz/2]</span>
    <span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">fs_hz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">desired</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Passband = 1, Stopband = 0</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">remez</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">desired</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs_hz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span>

<span class="c1"># Example: lowpass filter design</span>
<span class="n">fs_hz</span> <span class="o">=</span> <span class="mi">8000</span>
<span class="n">numtaps</span> <span class="o">=</span> <span class="mi">51</span>
<span class="n">fp</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Passband edge (Hz)</span>
<span class="n">f_stop</span> <span class="o">=</span> <span class="mi">1500</span>  <span class="c1"># Stopband edge (Hz)</span>

<span class="c1"># Different weighting schemes</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Equal weight&#39;</span><span class="p">),</span>
    <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;Stopband 10Ã— weight&#39;</span><span class="p">),</span>
    <span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Passband 10Ã— weight&#39;</span><span class="p">),</span>
    <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;Stopband 100Ã— weight&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">parks_mcclellan_lowpass</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">fs_hz</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="n">freq</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs_hz</span><span class="p">)</span>
    <span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;fp=</span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s1"> Hz&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_stop</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;fs=</span><span class="si">{</span><span class="n">f_stop</span><span class="si">}</span><span class="s1"> Hz&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PM Design: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Parks-McClellan Filter Design with Different Weights&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;parks_mcclellan.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="75-bandpass-filter-example">7.5 Bandpass Filter Example<a class="header-link" href="#75-bandpass-filter-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Bandpass filter using Parks-McClellan</span>
<span class="n">fs_hz</span> <span class="o">=</span> <span class="mi">8000</span>
<span class="n">numtaps</span> <span class="o">=</span> <span class="mi">101</span>

<span class="c1"># Bandpass: pass 1000-2000 Hz, stop below 500 and above 2500</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2500</span><span class="p">,</span> <span class="n">fs_hz</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">desired</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">h_bp</span> <span class="o">=</span> <span class="n">remez</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">desired</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs_hz</span><span class="p">)</span>

<span class="c1"># Frequency response</span>
<span class="n">freq</span><span class="p">,</span> <span class="n">H_bp</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h_bp</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs_hz</span><span class="p">)</span>
<span class="n">H_bp_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_bp</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">H_bp_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Passband&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bandpass FIR (Parks-McClellan)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_bp</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Passband&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|H(f)|&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude Response (Linear)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;bandpass_pm.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="8-linear-phase-fir-filters">8. Linear Phase FIR Filters<a class="header-link" href="#8-linear-phase-fir-filters" title="Permanent link">&para;</a></h2>
<h3 id="81-importance-of-linear-phase">8.1 Importance of Linear Phase<a class="header-link" href="#81-importance-of-linear-phase" title="Permanent link">&para;</a></h3>
<p>A filter has <strong>linear phase</strong> if its frequency response can be written as:</p>
<p>$$H(e^{j\omega}) = |H(e^{j\omega})| \cdot e^{-j\omega \tau}$$</p>
<p>where $\tau$ is a constant group delay. Linear phase means all frequency components are delayed by the same amount, preserving the waveform shape.</p>
<p><strong>Group delay:</strong></p>
<p>$$\tau(\omega) = -\frac{d\angle H(e^{j\omega})}{d\omega} = \text{constant} = \frac{M}{2}$$</p>
<h3 id="82-symmetry-conditions">8.2 Symmetry Conditions<a class="header-link" href="#82-symmetry-conditions" title="Permanent link">&para;</a></h3>
<p>Linear phase FIR filters require symmetric or antisymmetric impulse responses:</p>
<p><strong>Symmetric</strong> (Type I and II): $h[n] = h[M - n]$</p>
<p><strong>Antisymmetric</strong> (Type III and IV): $h[n] = -h[M - n]$</p>
<h3 id="83-four-types-of-linear-phase-fir-filters">8.3 Four Types of Linear Phase FIR Filters<a class="header-link" href="#83-four-types-of-linear-phase-fir-filters" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Type</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Symmetry</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Order</span><span class="w"> </span><span class="nx">M</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Suitable</span><span class="w"> </span><span class="nx">For</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">I</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Symmetric</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Even</span><span class="w">                 </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="nx">types</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">II</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Symmetric</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Odd</span><span class="w">                  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">LP</span><span class="p">,</span><span class="w"> </span><span class="nx">BP</span><span class="w"> </span><span class="nx">only</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">III</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Antisymmetric</span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Even</span><span class="w">                 </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">BP</span><span class="p">,</span><span class="w"> </span><span class="nx">Hilbert</span><span class="p">,</span><span class="w"> </span><span class="nx">Diff</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">IV</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Antisymmetric</span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Odd</span><span class="w">                  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">HP</span><span class="p">,</span><span class="w"> </span><span class="nx">BP</span><span class="p">,</span><span class="w"> </span><span class="nx">Hilbert</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<p><strong>Type I</strong> (even order, symmetric):
- $H(e^{j0}) = \sum h[n]$ (no constraint)
- $H(e^{j\pi}) = \sum (-1)^n h[n]$ (no constraint)
- Suitable for any filter type</p>
<p><strong>Type II</strong> (odd order, symmetric):
- $H(e^{j\pi}) = 0$ always
- Cannot be used for highpass or bandstop filters</p>
<p><strong>Type III</strong> (even order, antisymmetric):
- $H(e^{j0}) = 0$ and $H(e^{j\pi}) = 0$ always
- Suitable for bandpass, Hilbert transform, differentiator</p>
<p><strong>Type IV</strong> (odd order, antisymmetric):
- $H(e^{j0}) = 0$ always
- Cannot be used for lowpass filters</p>
<h3 id="84-amplitude-response-formulas">8.4 Amplitude Response Formulas<a class="header-link" href="#84-amplitude-response-formulas" title="Permanent link">&para;</a></h3>
<p>For a Type I filter (even $M$, symmetric), the frequency response is:</p>
<p>$$H(e^{j\omega}) = e^{-j\omega M/2} A(\omega)$$</p>
<p>where the <strong>amplitude response</strong> is:</p>
<p>$$A(\omega) = h[M/2] + 2 \sum_{k=1}^{M/2} h[M/2 - k] \cos(k\omega)$$</p>
<p>This is a real-valued function, making it easy to analyze passband/stopband behavior.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_linear_phase</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze linear phase properties of FIR filter.&quot;&quot;&quot;</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Check symmetry</span>
    <span class="n">is_symmetric</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">is_antisymmetric</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">is_symmetric</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;Type I&quot;</span>
    <span class="k">elif</span> <span class="n">is_symmetric</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;Type II&quot;</span>
    <span class="k">elif</span> <span class="n">is_antisymmetric</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;Type III&quot;</span>
    <span class="k">elif</span> <span class="n">is_antisymmetric</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;Type IV&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;Not linear phase&quot;</span>

    <span class="c1"># Frequency response</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>

    <span class="c1"># Group delay</span>
    <span class="n">w_gd</span><span class="p">,</span> <span class="n">gd</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">group_delay</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">w</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Magnitude</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ftype</span><span class="si">}</span><span class="s1">: Magnitude Response&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Phase</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">H</span><span class="p">)),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (radians)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ftype</span><span class="si">}</span><span class="s1">: Phase Response&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Group delay</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_gd</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">gd</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">M</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;M/2 = </span><span class="si">{</span><span class="n">M</span><span class="o">/</span><span class="mi">2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Group Delay (samples)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Group Delay&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Impulse response (with symmetry visualization)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">M</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Center of symmetry&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;h[n]&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Impulse Response (M=</span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€)&#39;</span> <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;Sample n&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€)&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Linear Phase Analysis: </span><span class="si">{</span><span class="n">ftype</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ftype</span>

<span class="c1"># Example: Type I lowpass</span>
<span class="n">h_type1</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>  <span class="c1"># 50th order, symmetric</span>
<span class="n">ftype</span> <span class="o">=</span> <span class="n">analyze_linear_phase</span><span class="p">(</span><span class="n">h_type1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;linear_phase_analysis.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected filter type: </span><span class="si">{</span><span class="n">ftype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="9-comparison-of-design-methods">9. Comparison of Design Methods<a class="header-link" href="#9-comparison-of-design-methods" title="Permanent link">&para;</a></h2>
<h3 id="91-head-to-head-comparison">9.1 Head-to-Head Comparison<a class="header-link" href="#91-head-to-head-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_design_methods</span><span class="p">(</span><span class="n">numtaps</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span> <span class="n">wp</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare window, Kaiser, and Parks-McClellan methods for the same specs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wc_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">wp</span> <span class="o">+</span> <span class="n">ws</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># Cutoff for window methods</span>

    <span class="c1"># Method 1: Hamming window</span>
    <span class="n">h_hamming</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">wc_norm</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">)</span>

    <span class="c1"># Method 2: Kaiser window (60 dB attenuation)</span>
    <span class="n">h_kaiser</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">wc_norm</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;kaiser&#39;</span><span class="p">,</span> <span class="mf">5.65</span><span class="p">))</span>

    <span class="c1"># Method 3: Parks-McClellan</span>
    <span class="n">h_pm</span> <span class="o">=</span> <span class="n">remez</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">wp</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ws</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Frequency responses</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;Hamming Window&#39;</span><span class="p">,</span> <span class="n">h_hamming</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Kaiser Window (Î²=5.65)&#39;</span><span class="p">,</span> <span class="n">h_kaiser</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Parks-McClellan&#39;</span><span class="p">,</span> <span class="n">h_pm</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>

    <span class="c1"># Overlay magnitude responses</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude Response Comparison&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Passband detail</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Passband Detail&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">wp</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Transition band detail</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|H(f)|&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition Band Detail&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">wp</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">ws</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Impulse responses</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">numtaps</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sample n&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;h[n]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Impulse Responses&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FIR Design Comparison (N=</span><span class="si">{</span><span class="n">numtaps</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;design_comparison.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">compare_design_methods</span><span class="p">(</span><span class="n">numtaps</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span> <span class="n">wp</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div>

<h3 id="92-summary-of-design-methods">9.2 Summary of Design Methods<a class="header-link" href="#92-summary-of-design-methods" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Method</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Optimality</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Control</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Best</span><span class="w"> </span><span class="nx">For</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Window</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Suboptimal</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Limited</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Quick</span><span class="w"> </span><span class="nx">design</span><span class="p">,</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="nx">discrete</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">education</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">window</span><span class="w"> </span><span class="kd">choice</span><span class="p">)</span><span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Kaiser</span><span class="w"> </span><span class="nx">Window</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Near</span><span class="o">-</span><span class="nx">optimal</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Continuous</span><span class="w"> </span><span class="nx">Î²</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Good</span><span class="w"> </span><span class="nx">balance</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">parameter</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">control</span><span class="w"> </span><span class="k">and</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">simplicity</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Freq</span><span class="p">.</span><span class="w"> </span><span class="nx">Sampling</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Suboptimal</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Transition</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Hardware</span><span class="w"> </span><span class="kd">impl</span><span class="p">.,</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">samples</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">DFT</span><span class="o">-</span><span class="nx">based</span><span class="w"> </span><span class="nx">filters</span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">Parks</span><span class="o">-</span><span class="nx">McClellan</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Optimal</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Weight</span><span class="w"> </span><span class="nx">func</span><span class="p">,</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Production</span><span class="p">,</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="nx">minimax</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">multiple</span><span class="w"> </span><span class="nx">bands</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">stringent</span><span class="w"> </span><span class="nx">specs</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<p><strong>Key insight</strong>: For the same filter order, Parks-McClellan achieves the smallest maximum error (equiripple). Window methods produce filters with monotonically increasing stopband attenuation, which "wastes" attenuation at higher frequencies.</p>
<hr />
<h2 id="10-fir-filter-implementation">10. FIR Filter Implementation<a class="header-link" href="#10-fir-filter-implementation" title="Permanent link">&para;</a></h2>
<h3 id="101-direct-convolution">10.1 Direct Convolution<a class="header-link" href="#101-direct-convolution" title="Permanent link">&para;</a></h3>
<p>The most straightforward implementation computes the output as a direct convolution:</p>
<p>$$y[n] = \sum_{k=0}^{M} h[k] x[n-k]$$</p>
<p><strong>Complexity</strong>: $O(MN)$ for filtering $N$ samples with an $M$-th order filter.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fir_direct</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Direct-form FIR filter implementation.&quot;&quot;&quot;</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">h</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">y</span>

<span class="c1"># Using numpy&#39;s convolve (optimized)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

<span class="n">y_direct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">, Filter length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="si">}</span><span class="s2">, Output length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y_direct</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="102-fft-based-filtering">10.2 FFT-Based Filtering<a class="header-link" href="#102-fft-based-filtering" title="Permanent link">&para;</a></h3>
<p>For long signals, FFT-based convolution is much faster:</p>
<p>$$y = \text{IFFT}[\text{FFT}(x) \cdot \text{FFT}(h)]$$</p>
<p><strong>Complexity</strong>: $O(N \log N)$ instead of $O(MN)$.</p>
<p>The crossover point where FFT becomes faster is typically $M \approx 50-100$.</p>
<h3 id="103-overlap-add-method">10.3 Overlap-Add Method<a class="header-link" href="#103-overlap-add-method" title="Permanent link">&para;</a></h3>
<p>For real-time or block-based processing where the input arrives in segments:</p>
<ol>
<li><strong>Divide</strong> input $x[n]$ into non-overlapping blocks of length $L$</li>
<li><strong>Zero-pad</strong> each block to length $L + M$</li>
<li><strong>FFT-convolve</strong> each block with the filter $h[n]$</li>
<li><strong>Overlap-add</strong> adjacent output blocks (last $M$ samples overlap)</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">overlap_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overlap-add FIR filtering.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        x: input signal</span>
<span class="sd">        h: FIR filter coefficients</span>
<span class="sd">        L: block size</span>

<span class="sd">    Returns:</span>
<span class="sd">        y: filtered output</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N_fft</span> <span class="o">=</span> <span class="n">L</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Zero-pad filter to FFT length</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">N_fft</span><span class="p">)</span>

    <span class="c1"># Output array</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Process blocks</span>
    <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="n">L</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_blocks</span><span class="p">):</span>
        <span class="c1"># Extract block</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">L</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">x_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">x_block</span><span class="p">[:</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

        <span class="c1"># FFT convolution</span>
        <span class="n">X_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">x_block</span><span class="p">,</span> <span class="n">N_fft</span><span class="p">)</span>
        <span class="n">y_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">X_block</span> <span class="o">*</span> <span class="n">H</span><span class="p">))</span>

        <span class="c1"># Overlap-add</span>
        <span class="n">y</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="n">N_fft</span><span class="p">]</span> <span class="o">+=</span> <span class="n">y_block</span>

    <span class="k">return</span> <span class="n">y</span><span class="p">[:</span><span class="n">N</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Verify overlap-add produces same result as direct convolution</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

<span class="n">y_direct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="n">y_ola</span> <span class="o">=</span> <span class="n">overlap_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_direct</span> <span class="o">-</span> <span class="n">y_ola</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum error between direct and overlap-add: </span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="104-overlap-save-method">10.4 Overlap-Save Method<a class="header-link" href="#104-overlap-save-method" title="Permanent link">&para;</a></h3>
<p>An alternative to overlap-add:</p>
<ol>
<li><strong>Overlap</strong> input blocks by $M-1$ samples (each block has $M-1$ samples from previous block)</li>
<li><strong>FFT-convolve</strong> using circular convolution (length $L+M-1$)</li>
<li><strong>Discard</strong> first $M-1$ samples of each output block (corrupted by circular wrap-around)</li>
<li><strong>Concatenate</strong> remaining samples</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">overlap_save</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overlap-save FIR filtering.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        x: input signal</span>
<span class="sd">        h: FIR filter coefficients</span>
<span class="sd">        L: block size (output samples per block)</span>

<span class="sd">    Returns:</span>
<span class="sd">        y: filtered output</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">N_fft</span> <span class="o">=</span> <span class="n">L</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Zero-pad filter to FFT length</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">N_fft</span><span class="p">)</span>

    <span class="c1"># Prepend M-1 zeros to input</span>
    <span class="n">x_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x</span><span class="p">])</span>
    <span class="n">N_padded</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_padded</span><span class="p">)</span>

    <span class="c1"># Output</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">output_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">block_start</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">block_start</span> <span class="o">&lt;</span> <span class="n">N_padded</span><span class="p">:</span>
        <span class="c1"># Extract overlapping block of length N_fft</span>
        <span class="n">block_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">block_start</span> <span class="o">+</span> <span class="n">N_fft</span><span class="p">,</span> <span class="n">N_padded</span><span class="p">)</span>
        <span class="n">x_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_fft</span><span class="p">)</span>
        <span class="n">x_block</span><span class="p">[:</span><span class="n">block_end</span> <span class="o">-</span> <span class="n">block_start</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_padded</span><span class="p">[</span><span class="n">block_start</span><span class="p">:</span><span class="n">block_end</span><span class="p">]</span>

        <span class="c1"># Circular convolution via FFT</span>
        <span class="n">X_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">x_block</span><span class="p">,</span> <span class="n">N_fft</span><span class="p">)</span>
        <span class="n">y_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">X_block</span> <span class="o">*</span> <span class="n">H</span><span class="p">))</span>

        <span class="c1"># Keep only valid samples (discard first M-1)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">y_block</span><span class="p">[</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="n">valid_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="n">N</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">output_idx</span><span class="p">)</span>
        <span class="n">y</span><span class="p">[</span><span class="n">output_idx</span><span class="p">:</span><span class="n">output_idx</span> <span class="o">+</span> <span class="n">valid_len</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[:</span><span class="n">valid_len</span><span class="p">]</span>

        <span class="n">output_idx</span> <span class="o">+=</span> <span class="n">L</span>
        <span class="n">block_start</span> <span class="o">+=</span> <span class="n">L</span>  <span class="c1"># Advance by L (not N_fft)</span>

    <span class="k">return</span> <span class="n">y</span><span class="p">[:</span><span class="n">N</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Verify overlap-save</span>
<span class="n">y_ols</span> <span class="o">=</span> <span class="n">overlap_save</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<span class="n">error_ols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_direct</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">y_ols</span><span class="p">)]</span> <span class="o">-</span> <span class="n">y_ols</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">y_direct</span><span class="p">)]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum error between direct and overlap-save: </span><span class="si">{</span><span class="n">error_ols</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="105-performance-comparison">10.5 Performance Comparison<a class="header-link" href="#105-performance-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">benchmark_methods</span><span class="p">(</span><span class="n">signal_lengths</span><span class="p">,</span> <span class="n">filter_order</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Benchmark different FIR filtering methods.&quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="n">filter_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Direct (np.convolve)&#39;</span><span class="p">,</span> <span class="s1">&#39;Overlap-Add&#39;</span><span class="p">,</span> <span class="s1">&#39;scipy.fftconvolve&#39;</span><span class="p">]}</span>

    <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">signal_lengths</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

        <span class="c1"># Direct convolution</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Direct (np.convolve)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

        <span class="c1"># Overlap-add</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">overlap_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Overlap-Add&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

        <span class="c1"># scipy FFT convolve</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">fftconvolve</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">fftconvolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;scipy.fftconvolve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="n">signal_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">benchmark_methods</span><span class="p">(</span><span class="n">signal_lengths</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">times</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">signal_lengths</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Signal Length N&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Time (seconds)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;FIR Filtering: Performance Comparison&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fir_performance.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="11-python-implementation">11. Python Implementation<a class="header-link" href="#11-python-implementation" title="Permanent link">&para;</a></h2>
<h3 id="111-complete-design-example">11.1 Complete Design Example<a class="header-link" href="#111-complete-design-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">firwin</span><span class="p">,</span> <span class="n">remez</span><span class="p">,</span> <span class="n">freqz</span><span class="p">,</span> <span class="n">kaiserord</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">complete_fir_design</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">A_stop_dB</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kaiser&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complete FIR lowpass filter design workflow.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        fs: sampling frequency (Hz)</span>
<span class="sd">        f_pass: passband edge (Hz)</span>
<span class="sd">        f_stop: stopband edge (Hz)</span>
<span class="sd">        A_stop_dB: stopband attenuation (dB)</span>
<span class="sd">        method: &#39;kaiser&#39;, &#39;hamming&#39;, or &#39;remez&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        h: filter coefficients</span>
<span class="sd">        info: design information dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nyq</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;kaiser&#39;</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_stop</span> <span class="o">-</span> <span class="n">f_pass</span><span class="p">)</span> <span class="o">/</span> <span class="n">nyq</span>
        <span class="n">numtaps</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">kaiserord</span><span class="p">(</span><span class="n">A_stop_dB</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numtaps</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">numtaps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_pass</span> <span class="o">+</span> <span class="n">f_stop</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">nyq</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;kaiser&#39;</span><span class="p">,</span> <span class="n">beta</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Kaiser&#39;</span><span class="p">,</span> <span class="s1">&#39;numtaps&#39;</span><span class="p">:</span> <span class="n">numtaps</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="n">beta</span><span class="p">}</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;hamming&#39;</span><span class="p">:</span>
        <span class="c1"># Estimate order from transition width</span>
        <span class="n">delta_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_stop</span> <span class="o">-</span> <span class="n">f_pass</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
        <span class="n">numtaps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">3.32</span> <span class="o">/</span> <span class="n">delta_f</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">numtaps</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">numtaps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_pass</span> <span class="o">+</span> <span class="n">f_stop</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">nyq</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Hamming&#39;</span><span class="p">,</span> <span class="s1">&#39;numtaps&#39;</span><span class="p">:</span> <span class="n">numtaps</span><span class="p">}</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;remez&#39;</span><span class="p">:</span>
        <span class="c1"># Start with estimated order, iterate if needed</span>
        <span class="n">delta_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_stop</span> <span class="o">-</span> <span class="n">f_pass</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
        <span class="n">numtaps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="o">-</span><span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.001</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">))</span> <span class="o">-</span> <span class="mi">13</span><span class="p">)</span> <span class="o">/</span>
                              <span class="p">(</span><span class="mf">14.6</span> <span class="o">*</span> <span class="n">delta_f</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">numtaps</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">numtaps</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">delta_s</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">A_stop_dB</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">delta_s</span><span class="p">]</span>  <span class="c1"># Weight stopband more</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">remez</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">nyq</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                  <span class="n">weight</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Parks-McClellan&#39;</span><span class="p">,</span> <span class="s1">&#39;numtaps&#39;</span><span class="p">:</span> <span class="n">numtaps</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">info</span>

<span class="c1"># Design and analyze</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span>
<span class="n">f_pass</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">f_stop</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">A_stop</span> <span class="o">=</span> <span class="mi">60</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;kaiser&#39;</span><span class="p">,</span> <span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="s1">&#39;remez&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">complete_fir_design</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">A_stop</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

    <span class="c1"># Frequency response</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">freqz</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

    <span class="c1"># Magnitude</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">A_stop</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">A_stop</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_pass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_stop</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (N=</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;numtaps&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Group delay</span>
    <span class="n">w_gd</span><span class="p">,</span> <span class="n">gd</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">group_delay</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">w</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_gd</span><span class="p">,</span> <span class="n">gd</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Group Delay (samples)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: Group Delay&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Complete FIR Filter Design Comparison&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;complete_fir_design.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="112-filtering-a-real-signal">11.2 Filtering a Real Signal<a class="header-link" href="#112-filtering-a-real-signal" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_filtering</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate FIR filtering on a multi-tone signal.&quot;&quot;&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="mi">8000</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>

    <span class="c1"># Create signal: 200 Hz + 800 Hz + 2000 Hz + noise</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">200</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
         <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">800</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
         <span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span>
         <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>

    <span class="c1"># Design lowpass filter (cutoff ~1000 Hz)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">)</span>

    <span class="c1"># Apply filter</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># Compensate for group delay</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Time domain</span>
    <span class="n">t_ms</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_ms</span><span class="p">[:</span><span class="mi">500</span><span class="p">],</span> <span class="n">x</span><span class="p">[:</span><span class="mi">500</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_ms</span><span class="p">[:</span><span class="mi">500</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">delay</span><span class="p">:</span><span class="n">delay</span> <span class="o">+</span> <span class="mi">500</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filtered (delay compensated)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time Domain&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Spectrum comparison</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.fft</span><span class="w"> </span><span class="kn">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">fftfreq</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">fftfreq</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)[:</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">(</span><span class="n">x</span><span class="p">))[:</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">N</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">(</span><span class="n">y</span><span class="p">))[:</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filtered&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cutoff&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Frequency Domain&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Spectrogram</span>
    <span class="n">f_spec</span><span class="p">,</span> <span class="n">t_spec</span><span class="p">,</span> <span class="n">Sxx</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">f_spec_f</span><span class="p">,</span> <span class="n">t_spec_f</span><span class="p">,</span> <span class="n">Syy</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t_spec</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">f_spec</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Sxx</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
                        <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Spectrogram (Original Signal)&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fir_filtering_demo.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">demonstrate_filtering</span><span class="p">()</span>
</code></pre></div>

<h3 id="113-multi-band-filter-design">11.3 Multi-band Filter Design<a class="header-link" href="#113-multi-band-filter-design" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Design a multi-band filter using firwin2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">firwin2</span>

<span class="c1"># Arbitrary magnitude response</span>
<span class="n">numtaps</span> <span class="o">=</span> <span class="mi">201</span>
<span class="n">freq_points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">gain_points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">h_multiband</span> <span class="o">=</span> <span class="n">firwin2</span><span class="p">(</span><span class="n">numtaps</span><span class="p">,</span> <span class="n">freq_points</span><span class="p">,</span> <span class="n">gain_points</span><span class="p">)</span>

<span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">freqz</span><span class="p">(</span><span class="n">h_multiband</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
<span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Desired vs actual</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq_points</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">gain_points</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span>
             <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Desired&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Multi-band Filter: Magnitude&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Multi-band Filter: dB Scale&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;multiband_fir.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="12-exercises">12. Exercises<a class="header-link" href="#12-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-window-selection">Exercise 1: Window Selection<a class="header-link" href="#exercise-1-window-selection" title="Permanent link">&para;</a></h3>
<p>Design a lowpass FIR filter with the following specifications:
- Sampling frequency: $f_s = 10000$ Hz
- Passband edge: $f_p = 1500$ Hz
- Stopband edge: $f_s = 2000$ Hz
- Minimum stopband attenuation: $60$ dB</p>
<p>(a) Which window type(s) can meet the stopband specification?</p>
<p>(b) For each viable window, compute the required filter order $M$.</p>
<p>(c) Design the filter using <code>scipy.signal.firwin</code> and verify the specifications are met.</p>
<p>(d) Compare the resulting filters in terms of passband ripple and transition width.</p>
<h3 id="exercise-2-kaiser-window-design">Exercise 2: Kaiser Window Design<a class="header-link" href="#exercise-2-kaiser-window-design" title="Permanent link">&para;</a></h3>
<p>A digital filter must satisfy:
- Passband: $0 \leq f \leq 3$ kHz with ripple $\leq 0.1$ dB
- Stopband: $f \geq 4$ kHz with attenuation $\geq 50$ dB
- Sampling rate: $f_s = 20$ kHz</p>
<p>(a) Compute the Kaiser window parameter $\beta$ using the empirical formula.</p>
<p>(b) Compute the minimum filter order $M$.</p>
<p>(c) Design the filter and plot the magnitude response, phase response, and group delay.</p>
<p>(d) Verify the design meets specifications by measuring actual passband ripple and stopband attenuation.</p>
<h3 id="exercise-3-parks-mcclellan-bandpass-filter">Exercise 3: Parks-McClellan Bandpass Filter<a class="header-link" href="#exercise-3-parks-mcclellan-bandpass-filter" title="Permanent link">&para;</a></h3>
<p>Design a bandpass FIR filter using the Parks-McClellan algorithm:
- $f_s = 44100$ Hz (CD audio rate)
- Stopband 1: $0$ to $800$ Hz (attenuation $\geq 40$ dB)
- Passband: $1000$ to $3000$ Hz (ripple $\leq 0.5$ dB)
- Stopband 2: $3500$ to $22050$ Hz (attenuation $\geq 40$ dB)</p>
<p>(a) Choose appropriate weights for equal ripple in both stopbands.</p>
<p>(b) Determine the minimum filter order.</p>
<p>(c) Plot the magnitude response and verify the specifications.</p>
<p>(d) Apply the filter to a chirp signal (sweep from 100 Hz to 10 kHz) and display the spectrogram before and after filtering.</p>
<h3 id="exercise-4-overlap-add-implementation">Exercise 4: Overlap-Add Implementation<a class="header-link" href="#exercise-4-overlap-add-implementation" title="Permanent link">&para;</a></h3>
<p>Implement a real-time FIR filter processor using the overlap-add method:</p>
<p>(a) Write a class <code>StreamingFIRFilter</code> that processes audio in blocks.</p>
<p>(b) Test with block sizes of 64, 256, 1024, and 4096 samples.</p>
<p>(c) Verify the output matches direct convolution (<code>np.convolve</code>).</p>
<p>(d) Measure and plot processing time per block as a function of block size.</p>
<p>(e) Find the optimal block size for a 200-tap filter applied to a 10-second audio signal at 44100 Hz.</p>
<h3 id="exercise-5-linear-phase-constraints">Exercise 5: Linear Phase Constraints<a class="header-link" href="#exercise-5-linear-phase-constraints" title="Permanent link">&para;</a></h3>
<p>(a) Prove that a Type II FIR filter (odd order, symmetric coefficients) always has $H(e^{j\pi}) = 0$. Why does this make it unsuitable for highpass filter design?</p>
<p>(b) Design a highpass FIR filter with cutoff at $0.6\pi$ using:
   - Type I (even order)
   - Type IV (odd order, antisymmetric)</p>
<p>Compare the results. Which has better performance near $\omega = \pi$?</p>
<p>(c) Design a Hilbert transform filter (Type III) of order 30. Plot its magnitude and phase response. What happens at $\omega = 0$ and $\omega = \pi$?</p>
<h3 id="exercise-6-comparison-study">Exercise 6: Comparison Study<a class="header-link" href="#exercise-6-comparison-study" title="Permanent link">&para;</a></h3>
<p>For the specifications: $f_s = 16000$ Hz, $f_p = 2000$ Hz, $f_\text{stop} = 2500$ Hz, $A_s = 50$ dB:</p>
<p>(a) Design the filter using (i) Hamming window, (ii) Kaiser window, (iii) Parks-McClellan.</p>
<p>(b) For each method, report: filter order, passband ripple (dB), actual stopband attenuation (dB), transition width (Hz).</p>
<p>(c) Create a single figure with 4 subplots: overlay of magnitude responses, passband detail, impulse responses, and pole-zero plots.</p>
<p>(d) Which method gives the best result for the lowest filter order? Justify your answer.</p>
<h3 id="exercise-7-minimum-phase-fir-filter">Exercise 7: Minimum-Phase FIR Filter<a class="header-link" href="#exercise-7-minimum-phase-fir-filter" title="Permanent link">&para;</a></h3>
<p>(a) Design a linear-phase lowpass FIR filter of order 40 using the Hamming window method.</p>
<p>(b) Convert it to a minimum-phase FIR filter using the cepstral method:
   - Compute the cepstrum $\hat{h}[n] = \text{IFFT}(\log|\text{FFT}(h)|)$
   - Construct the minimum-phase version</p>
<p>(c) Compare the magnitude responses, phase responses, and group delays of both filters.</p>
<p>(d) When would you prefer minimum-phase over linear-phase? Discuss with examples.</p>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Oppenheim, A. V., &amp; Schafer, R. W. (2010).</strong> <em>Discrete-Time Signal Processing</em> (3rd ed.). Pearson. Chapters 7-8.</li>
<li><strong>Proakis, J. G., &amp; Manolakis, D. G. (2007).</strong> <em>Digital Signal Processing</em> (4th ed.). Pearson. Chapter 10.</li>
<li><strong>Parks, T. W., &amp; Burrus, C. S. (1987).</strong> <em>Digital Filter Design</em>. Wiley.</li>
<li><strong>Kaiser, J. F. (1974).</strong> "Nonrecursive Digital Filter Design Using the I0-sinh Window Function." <em>Proceedings of the 1974 IEEE International Symposium on Circuits and Systems</em>.</li>
<li><strong>McClellan, J. H., Parks, T. W., &amp; Rabiner, L. R. (1973).</strong> "A Computer Program for Designing Optimum FIR Linear Phase Digital Filters." <em>IEEE Trans. Audio Electroacoustics</em>, 21(6), 506-526.</li>
<li><strong>SciPy Documentation</strong> -- <code>scipy.signal</code> module: https://docs.scipy.org/doc/scipy/reference/signal.html</li>
</ol>
<hr />
<h2 id="navigation">Navigation<a class="header-link" href="#navigation" title="Permanent link">&para;</a></h2>
<ul>
<li>Previous: <a href="08_Z_Transform_and_Transfer_Functions.md">08. Z-Transform and Transfer Functions</a></li>
<li>Next: <a href="10_IIR_Filter_Design.md">10. IIR Filter Design</a></li>
<li><a href="00_Overview.md">Back to Overview</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Signal_Processing/08_Digital_Filter_Fundamentals.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Digital Filter Fundamentals</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Signal_Processing/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Signal_Processing/10_IIR_Filter_Design.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">IIR Filter Design</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}