{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IIR Filter Design - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Signal_Processing/">Signal Processing</a>
    <span class="separator">/</span>
    <span class="current">IIR Filter Design</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>IIR Filter Design</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Signal_Processing/09_FIR_Filter_Design.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">FIR Filter Design</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Signal_Processing/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Signal_Processing/11_Multirate_Processing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Multirate Signal Processing</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-introduction-to-iir-filter-design">1. Introduction to IIR Filter Design</a><ul>
<li><a href="#11-iir-filter-structure">1.1 IIR Filter Structure</a></li>
<li><a href="#12-design-approach">1.2 Design Approach</a></li>
<li><a href="#13-why-start-with-analog-prototypes">1.3 Why Start with Analog Prototypes?</a></li>
</ul>
</li>
<li><a href="#2-analog-prototype-filters">2. Analog Prototype Filters</a><ul>
<li><a href="#21-analog-filter-specifications">2.1 Analog Filter Specifications</a></li>
<li><a href="#22-normalized-lowpass-prototype">2.2 Normalized Lowpass Prototype</a></li>
</ul>
</li>
<li><a href="#3-butterworth-filters">3. Butterworth Filters</a><ul>
<li><a href="#31-magnitude-response">3.1 Magnitude Response</a></li>
<li><a href="#32-pole-locations">3.2 Pole Locations</a></li>
<li><a href="#33-order-determination">3.3 Order Determination</a></li>
<li><a href="#34-magnitude-response-visualization">3.4 Magnitude Response Visualization</a></li>
</ul>
</li>
<li><a href="#4-chebyshev-type-i-filters">4. Chebyshev Type I Filters</a><ul>
<li><a href="#41-magnitude-response">4.1 Magnitude Response</a></li>
<li><a href="#42-chebyshev-polynomials">4.2 Chebyshev Polynomials</a></li>
<li><a href="#43-order-determination">4.3 Order Determination</a></li>
<li><a href="#44-pole-locations">4.4 Pole Locations</a></li>
</ul>
</li>
<li><a href="#5-chebyshev-type-ii-filters">5. Chebyshev Type II Filters</a><ul>
<li><a href="#51-magnitude-response">5.1 Magnitude Response</a></li>
<li><a href="#52-comparison-with-type-i">5.2 Comparison with Type I</a></li>
</ul>
</li>
<li><a href="#6-elliptic-cauer-filters">6. Elliptic (Cauer) Filters</a><ul>
<li><a href="#61-magnitude-response">6.1 Magnitude Response</a></li>
<li><a href="#62-order-advantage">6.2 Order Advantage</a></li>
<li><a href="#63-elliptic-filter-visualization">6.3 Elliptic Filter Visualization</a></li>
</ul>
</li>
<li><a href="#7-analog-to-digital-conversion">7. Analog-to-Digital Conversion</a><ul>
<li><a href="#71-overview-of-methods">7.1 Overview of Methods</a></li>
</ul>
</li>
<li><a href="#8-bilinear-transform">8. Bilinear Transform</a><ul>
<li><a href="#81-the-mapping">8.1 The Mapping</a></li>
<li><a href="#82-key-properties">8.2 Key Properties</a></li>
<li><a href="#83-frequency-warping">8.3 Frequency Warping</a></li>
<li><a href="#84-pre-warping">8.4 Pre-warping</a></li>
<li><a href="#85-step-by-step-blt-design">8.5 Step-by-Step BLT Design</a></li>
</ul>
</li>
<li><a href="#9-impulse-invariance-method">9. Impulse Invariance Method</a><ul>
<li><a href="#91-principle">9.1 Principle</a></li>
<li><a href="#92-mapping">9.2 Mapping</a></li>
<li><a href="#93-aliasing-problem">9.3 Aliasing Problem</a></li>
<li><a href="#94-implementation-example">9.4 Implementation Example</a></li>
</ul>
</li>
<li><a href="#10-complete-iir-design-procedure">10. Complete IIR Design Procedure</a><ul>
<li><a href="#101-step-by-step-procedure">10.1 Step-by-Step Procedure</a></li>
<li><a href="#102-using-scipysignal-direct-design-functions">10.2 Using scipy.signal Direct Design Functions</a></li>
</ul>
</li>
<li><a href="#11-stability-analysis">11. Stability Analysis</a><ul>
<li><a href="#111-stability-criterion">11.1 Stability Criterion</a></li>
<li><a href="#112-second-order-sections-sos-for-numerical-stability">11.2 Second-Order Sections (SOS) for Numerical Stability</a></li>
<li><a href="#113-numerical-comparison-tf-vs-sos">11.3 Numerical Comparison: tf vs SOS</a></li>
</ul>
</li>
<li><a href="#12-comparison-of-filter-types">12. Comparison of Filter Types</a><ul>
<li><a href="#121-summary-table">12.1 Summary Table</a></li>
<li><a href="#122-comprehensive-visual-comparison">12.2 Comprehensive Visual Comparison</a></li>
</ul>
</li>
<li><a href="#13-python-implementation">13. Python Implementation</a><ul>
<li><a href="#131-complete-iir-design-workflow">13.1 Complete IIR Design Workflow</a></li>
<li><a href="#132-real-time-iir-filtering-with-sos">13.2 Real-Time IIR Filtering with SOS</a></li>
</ul>
</li>
<li><a href="#14-exercises">14. Exercises</a><ul>
<li><a href="#exercise-1-butterworth-filter-design">Exercise 1: Butterworth Filter Design</a></li>
<li><a href="#exercise-2-chebyshev-filter-comparison">Exercise 2: Chebyshev Filter Comparison</a></li>
<li><a href="#exercise-3-elliptic-filter-for-audio">Exercise 3: Elliptic Filter for Audio</a></li>
<li><a href="#exercise-4-bilinear-transform-by-hand">Exercise 4: Bilinear Transform by Hand</a></li>
<li><a href="#exercise-5-stability-investigation">Exercise 5: Stability Investigation</a></li>
<li><a href="#exercise-6-iir-vs-fir-comparison">Exercise 6: IIR vs FIR Comparison</a></li>
<li><a href="#exercise-7-bandstop-notch-filter">Exercise 7: Bandstop (Notch) Filter</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
<li><a href="#navigation">Navigation</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="iir-filter-design">IIR Filter Design<a class="header-link" href="#iir-filter-design" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="header-link" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Understand the characteristics of classical analog prototype filters (Butterworth, Chebyshev, Elliptic)</li>
<li>Master the bilinear transform and impulse invariance methods for analog-to-digital conversion</li>
<li>Learn to determine filter order from frequency-domain specifications</li>
<li>Design IIR digital filters using Python's <code>scipy.signal</code> module</li>
<li>Verify filter stability using pole-zero analysis</li>
<li>Compare filter types and select the appropriate design for a given application</li>
</ul>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-introduction-to-iir-filter-design">Introduction to IIR Filter Design</a></li>
<li><a href="#2-analog-prototype-filters">Analog Prototype Filters</a></li>
<li><a href="#3-butterworth-filters">Butterworth Filters</a></li>
<li><a href="#4-chebyshev-type-i-filters">Chebyshev Type I Filters</a></li>
<li><a href="#5-chebyshev-type-ii-filters">Chebyshev Type II Filters</a></li>
<li><a href="#6-elliptic-cauer-filters">Elliptic (Cauer) Filters</a></li>
<li><a href="#7-analog-to-digital-conversion">Analog-to-Digital Conversion</a></li>
<li><a href="#8-bilinear-transform">Bilinear Transform</a></li>
<li><a href="#9-impulse-invariance-method">Impulse Invariance Method</a></li>
<li><a href="#10-complete-iir-design-procedure">Complete IIR Design Procedure</a></li>
<li><a href="#11-stability-analysis">Stability Analysis</a></li>
<li><a href="#12-comparison-of-filter-types">Comparison of Filter Types</a></li>
<li><a href="#13-python-implementation">Python Implementation</a></li>
<li><a href="#14-exercises">Exercises</a></li>
</ol>
<hr />
<h2 id="1-introduction-to-iir-filter-design">1. Introduction to IIR Filter Design<a class="header-link" href="#1-introduction-to-iir-filter-design" title="Permanent link">&para;</a></h2>
<h3 id="11-iir-filter-structure">1.1 IIR Filter Structure<a class="header-link" href="#11-iir-filter-structure" title="Permanent link">&para;</a></h3>
<p>An IIR (Infinite Impulse Response) filter has both feedforward and feedback paths. Its transfer function is a ratio of polynomials:</p>
<p>$$H(z) = \frac{B(z)}{A(z)} = \frac{\sum_{k=0}^{M} b_k z^{-k}}{1 + \sum_{k=1}^{N} a_k z^{-k}}$$</p>
<p>The difference equation is:</p>
<p>$$y[n] = \sum_{k=0}^{M} b_k x[n-k] - \sum_{k=1}^{N} a_k y[n-k]$$</p>
<h3 id="12-design-approach">1.2 Design Approach<a class="header-link" href="#12-design-approach" title="Permanent link">&para;</a></h3>
<p>Unlike FIR filters (designed directly in the discrete domain), IIR filters are typically designed by:</p>
<ol>
<li><strong>Starting with an analog prototype</strong> $H_a(s)$ with well-known properties</li>
<li><strong>Transforming</strong> the analog filter to a digital filter $H(z)$</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                 </span><span class="nx">IIR</span><span class="w"> </span><span class="nx">Filter</span><span class="w"> </span><span class="nx">Design</span><span class="w"> </span><span class="nx">Pipeline</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Digital</span><span class="w"> </span><span class="nx">Specs</span><span class="w">     </span><span class="nx">Analog</span><span class="w"> </span><span class="nx">Specs</span><span class="w">     </span><span class="nx">Analog</span><span class="w"> </span><span class="nx">Filter</span><span class="w">    </span><span class="nx">Digital</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Ï‰p</span><span class="p">,</span><span class="w"> </span><span class="nx">Ï‰s</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Î©p</span><span class="p">,</span><span class="w"> </span><span class="nx">Î©s</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Ha</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”€â”€â–¶â”‚</span><span class="w"> </span><span class="nx">H</span><span class="p">(</span><span class="nx">z</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Î´â‚</span><span class="p">,</span><span class="w"> </span><span class="nx">Î´â‚‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Î´â‚</span><span class="p">,</span><span class="w"> </span><span class="nx">Î´â‚‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Step</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w">           </span><span class="nx">Step</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">          </span><span class="nx">Step</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w">         </span><span class="nx">Step</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Specify</span><span class="w"> </span><span class="nx">digital</span><span class="w">   </span><span class="nx">Pre</span><span class="o">-</span><span class="nx">warp</span><span class="w"> </span><span class="nx">to</span><span class="w">      </span><span class="nx">Design</span><span class="w"> </span><span class="nx">analog</span><span class="w">   </span><span class="nx">Apply</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">requirements</span><span class="w">      </span><span class="nx">analog</span><span class="w"> </span><span class="nx">specs</span><span class="w">     </span><span class="nx">prototype</span><span class="w">       </span><span class="nx">BLT</span><span class="o">/</span><span class="nx">IIM</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="13-why-start-with-analog-prototypes">1.3 Why Start with Analog Prototypes?<a class="header-link" href="#13-why-start-with-analog-prototypes" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Decades of theory</strong>: Butterworth, Chebyshev, and elliptic filter designs are well-established</li>
<li><strong>Closed-form solutions</strong>: Pole/zero locations can be computed analytically</li>
<li><strong>Optimal properties</strong>: Each type is optimal in a specific sense (flatness, equiripple, minimum order)</li>
<li><strong>Frequency transformations</strong>: Lowpass prototypes can be transformed to highpass, bandpass, bandstop</li>
</ul>
<hr />
<h2 id="2-analog-prototype-filters">2. Analog Prototype Filters<a class="header-link" href="#2-analog-prototype-filters" title="Permanent link">&para;</a></h2>
<h3 id="21-analog-filter-specifications">2.1 Analog Filter Specifications<a class="header-link" href="#21-analog-filter-specifications" title="Permanent link">&para;</a></h3>
<p>An analog lowpass filter specification consists of:</p>
<ul>
<li><strong>Passband edge frequency</strong> $\Omega_p$</li>
<li><strong>Stopband edge frequency</strong> $\Omega_s$</li>
<li><strong>Passband ripple</strong> $R_p$ (dB) or tolerance $\epsilon$</li>
<li><strong>Stopband attenuation</strong> $A_s$ (dB)</li>
</ul>
<p>The relationship between ripple parameter $\epsilon$ and passband ripple:</p>
<p>$$R_p = 10\log_{10}(1 + \epsilon^2) \quad \text{dB}$$</p>
<h3 id="22-normalized-lowpass-prototype">2.2 Normalized Lowpass Prototype<a class="header-link" href="#22-normalized-lowpass-prototype" title="Permanent link">&para;</a></h3>
<p>All classical designs start with a <strong>normalized lowpass prototype</strong> with passband edge at $\Omega_p = 1$ rad/s. The prototype is then frequency-scaled and transformed to the desired filter type.</p>
<p><strong>Selectivity factor:</strong></p>
<p>$$k = \frac{\Omega_p}{\Omega_s} < 1$$</p>
<p>A smaller $k$ means the transition band is wider relative to the passband, making the design easier.</p>
<hr />
<h2 id="3-butterworth-filters">3. Butterworth Filters<a class="header-link" href="#3-butterworth-filters" title="Permanent link">&para;</a></h2>
<h3 id="31-magnitude-response">3.1 Magnitude Response<a class="header-link" href="#31-magnitude-response" title="Permanent link">&para;</a></h3>
<p>The Butterworth filter provides the <strong>maximally flat magnitude response</strong> in the passband. Its squared magnitude response is:</p>
<p>$$|H_a(j\Omega)|^2 = \frac{1}{1 + \left(\Omega / \Omega_c\right)^{2N}}$$</p>
<p>where $N$ is the filter order and $\Omega_c$ is the $-3$ dB cutoff frequency.</p>
<p><strong>Properties:</strong>
- All derivatives of $|H_a(j\Omega)|^2$ up to order $2N-1$ are zero at $\Omega = 0$
- Monotonically decreasing magnitude
- $|H_a(j\Omega_c)|^2 = 1/2$ ($-3$ dB at cutoff)
- Rolloff rate: $-20N$ dB/decade in the stopband</p>
<h3 id="32-pole-locations">3.2 Pole Locations<a class="header-link" href="#32-pole-locations" title="Permanent link">&para;</a></h3>
<p>The poles of the Butterworth filter lie on a circle of radius $\Omega_c$ in the $s$-plane, equally spaced:</p>
<p>$$s_k = \Omega_c \exp\left[j\frac{\pi}{2N}(2k + N - 1)\right], \quad k = 0, 1, \ldots, 2N-1$$</p>
<p>For a stable (causal) filter, we select only the left-half-plane poles ($\text{Re}(s_k) < 0$).</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>

<span class="k">def</span><span class="w"> </span><span class="nf">butterworth_poles</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Omega_c</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Butterworth filter poles in the s-plane.&quot;&quot;&quot;</span>
    <span class="n">poles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">s_k</span> <span class="o">=</span> <span class="n">Omega_c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">s_k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Left-half plane only</span>
            <span class="n">poles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poles</span><span class="p">)</span>

<span class="c1"># Visualize pole locations for different orders</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">N</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]):</span>
    <span class="n">poles</span> <span class="o">=</span> <span class="n">butterworth_poles</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="c1"># Unit circle</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="c1"># Poles</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">poles</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">poles</span><span class="p">),</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Butterworth N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1"> Poles&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;butterworth_poles.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="33-order-determination">3.3 Order Determination<a class="header-link" href="#33-order-determination" title="Permanent link">&para;</a></h3>
<p>Given specifications $(\Omega_p, \Omega_s, R_p, A_s)$, the minimum Butterworth order is:</p>
<p>$$N \geq \frac{\log\left(\frac{10^{A_s/10} - 1}{10^{R_p/10} - 1}\right)}{2\log(\Omega_s / \Omega_p)}$$</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">butterworth_order</span><span class="p">(</span><span class="n">Omega_p</span><span class="p">,</span> <span class="n">Omega_s</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute minimum Butterworth filter order.&quot;&quot;&quot;</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">As_dB</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">Rp_dB</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Omega_s</span> <span class="o">/</span> <span class="n">Omega_p</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">N</span>

<span class="c1"># Example</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">butterworth_order</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum Butterworth order: N = </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Compare with scipy</span>
<span class="n">N_scipy</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">buttord</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;scipy.signal.buttord: N = </span><span class="si">{</span><span class="n">N_scipy</span><span class="si">}</span><span class="s2">, Wn = </span><span class="si">{</span><span class="n">Wn</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="34-magnitude-response-visualization">3.4 Magnitude Response Visualization<a class="header-link" href="#34-magnitude-response-visualization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Different orders</span>
<span class="n">orders</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Butterworth: Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-3 dB&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|H(jÎ©)|&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Butterworth: Magnitude (Linear)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-3 dB&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;butterworth_responses.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="4-chebyshev-type-i-filters">4. Chebyshev Type I Filters<a class="header-link" href="#4-chebyshev-type-i-filters" title="Permanent link">&para;</a></h2>
<h3 id="41-magnitude-response">4.1 Magnitude Response<a class="header-link" href="#41-magnitude-response" title="Permanent link">&para;</a></h3>
<p>The Chebyshev Type I filter has an <strong>equiripple passband</strong> and monotonic stopband:</p>
<p>$$|H_a(j\Omega)|^2 = \frac{1}{1 + \epsilon^2 T_N^2(\Omega / \Omega_p)}$$</p>
<p>where $T_N(\cdot)$ is the Chebyshev polynomial of the first kind of degree $N$:</p>
<p>$$T_N(x) = \begin{cases} \cos(N \cos^{-1}(x)), & |x| \leq 1 \\ \cosh(N \cosh^{-1}(x)), & |x| > 1 \end{cases}$$</p>
<p><strong>Properties:</strong>
- Equiripple in the passband with ripple $\epsilon$
- Passband ripple: $R_p = 10\log_{10}(1 + \epsilon^2)$ dB
- Sharper transition than Butterworth for the same order
- Monotonically decreasing stopband</p>
<h3 id="42-chebyshev-polynomials">4.2 Chebyshev Polynomials<a class="header-link" href="#42-chebyshev-polynomials" title="Permanent link">&para;</a></h3>
<p>The first few Chebyshev polynomials:</p>
<p>$$T_0(x) = 1, \quad T_1(x) = x, \quad T_2(x) = 2x^2 - 1$$</p>
<p>$$T_3(x) = 4x^3 - 3x, \quad T_4(x) = 8x^4 - 8x^2 + 1$$</p>
<p>Recurrence relation: $T_{N+1}(x) = 2x \cdot T_N(x) - T_{N-1}(x)$</p>
<h3 id="43-order-determination">4.3 Order Determination<a class="header-link" href="#43-order-determination" title="Permanent link">&para;</a></h3>
<p>$$N \geq \frac{\cosh^{-1}\left(\sqrt{\frac{10^{A_s/10} - 1}{10^{R_p/10} - 1}}\right)}{\cosh^{-1}(\Omega_s / \Omega_p)}$$</p>
<h3 id="44-pole-locations">4.4 Pole Locations<a class="header-link" href="#44-pole-locations" title="Permanent link">&para;</a></h3>
<p>The poles of a Chebyshev Type I filter lie on an ellipse in the $s$-plane:</p>
<p>$$s_k = \sigma_k + j\omega_k$$</p>
<p>where:</p>
<p>$$\sigma_k = -\sinh\left(\frac{1}{N}\sinh^{-1}\left(\frac{1}{\epsilon}\right)\right) \sin\left(\frac{(2k-1)\pi}{2N}\right)$$</p>
<p>$$\omega_k = \cosh\left(\frac{1}{N}\sinh^{-1}\left(\frac{1}{\epsilon}\right)\right) \cos\left(\frac{(2k-1)\pi}{2N}\right)$$</p>
<p>for $k = 1, 2, \ldots, N$.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chebyshev1_analysis</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze Chebyshev Type I filter.&quot;&quot;&quot;</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">Rp_dB</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Pole locations</span>
    <span class="n">poles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">theta_k</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">sigma_k</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">epsilon</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_k</span><span class="p">)</span>
        <span class="n">omega_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">epsilon</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_k</span><span class="p">)</span>
        <span class="n">poles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma_k</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">omega_k</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poles</span><span class="p">),</span> <span class="n">epsilon</span>

<span class="c1"># Compare Butterworth and Chebyshev</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]:</span>
    <span class="c1"># Chebyshev Type I (1 dB ripple)</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby1</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Chebyshev Type I (Rp = 1 dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Pole-zero plot for N=4</span>
<span class="n">poles_butter</span> <span class="o">=</span> <span class="n">butterworth_poles</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">poles_cheby</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">chebyshev1_analysis</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unit circle&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">poles_butter</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">poles_butter</span><span class="p">),</span> <span class="s1">&#39;bx&#39;</span><span class="p">,</span>
             <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Butterworth&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">poles_cheby</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">poles_cheby</span><span class="p">),</span> <span class="s1">&#39;r+&#39;</span><span class="p">,</span>
             <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Chebyshev I&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pole Locations: Butterworth vs Chebyshev I (N=4)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;chebyshev1_analysis.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="5-chebyshev-type-ii-filters">5. Chebyshev Type II Filters<a class="header-link" href="#5-chebyshev-type-ii-filters" title="Permanent link">&para;</a></h2>
<h3 id="51-magnitude-response">5.1 Magnitude Response<a class="header-link" href="#51-magnitude-response" title="Permanent link">&para;</a></h3>
<p>The Chebyshev Type II (inverse Chebyshev) filter has a <strong>flat passband</strong> and <strong>equiripple stopband</strong>:</p>
<p>$$|H_a(j\Omega)|^2 = \frac{1}{1 + \frac{1}{\epsilon^2 T_N^2(\Omega_s / \Omega)}}$$</p>
<p><strong>Properties:</strong>
- Monotonically decreasing (flat) passband
- Equiripple behavior in the stopband
- Has both poles and zeros (unlike Type I which has only poles)
- Zeros lie on the $j\Omega$ axis, creating nulls in the stopband</p>
<h3 id="52-comparison-with-type-i">5.2 Comparison with Type I<a class="header-link" href="#52-comparison-with-type-i" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># Chebyshev Type I (1 dB ripple)</span>
<span class="n">b1</span><span class="p">,</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby1</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">w1</span><span class="p">,</span> <span class="n">H1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqs</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">))</span>

<span class="c1"># Chebyshev Type II (40 dB stopband attenuation)</span>
<span class="n">b2</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">w2</span><span class="p">,</span> <span class="n">H2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqs</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">))</span>

<span class="c1"># Butterworth (same order)</span>
<span class="n">b_bw</span><span class="p">,</span> <span class="n">a_bw</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">w_bw</span><span class="p">,</span> <span class="n">H_bw</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqs</span><span class="p">(</span><span class="n">b_bw</span><span class="p">,</span> <span class="n">a_bw</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">))</span>

<span class="c1"># dB plot</span>
<span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">w_bw</span><span class="p">,</span> <span class="n">H_bw</span><span class="p">,</span> <span class="s1">&#39;Butterworth&#39;</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">H1</span><span class="p">,</span> <span class="s1">&#39;Chebyshev I&#39;</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">w2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="s1">&#39;Chebyshev II&#39;</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">)]:</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span> <span class="n">style</span><span class="p">,</span>
                 <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Filter Comparison (N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Passband detail (linear scale)</span>
<span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">w_bw</span><span class="p">,</span> <span class="n">H_bw</span><span class="p">,</span> <span class="s1">&#39;Butterworth&#39;</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">H1</span><span class="p">,</span> <span class="s1">&#39;Chebyshev I&#39;</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">w2</span><span class="p">,</span> <span class="n">H2</span><span class="p">,</span> <span class="s1">&#39;Chebyshev II&#39;</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">)]:</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="n">style</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (rad/s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|H(jÎ©)|&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Passband Detail&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;chebyshev2_comparison.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="6-elliptic-cauer-filters">6. Elliptic (Cauer) Filters<a class="header-link" href="#6-elliptic-cauer-filters" title="Permanent link">&para;</a></h2>
<h3 id="61-magnitude-response">6.1 Magnitude Response<a class="header-link" href="#61-magnitude-response" title="Permanent link">&para;</a></h3>
<p>The elliptic filter achieves the <strong>minimum order</strong> for given specifications by distributing ripple in both passband and stopband:</p>
<p>$$|H_a(j\Omega)|^2 = \frac{1}{1 + \epsilon^2 R_N^2(\Omega / \Omega_p)}$$</p>
<p>where $R_N(\cdot)$ is a rational Chebyshev (Jacobian elliptic) function.</p>
<p><strong>Properties:</strong>
- Equiripple in both passband and stopband
- Sharpest possible transition for given order
- Most efficient in terms of order vs specifications
- Both poles and zeros</p>
<h3 id="62-order-advantage">6.2 Order Advantage<a class="header-link" href="#62-order-advantage" title="Permanent link">&para;</a></h3>
<p>For the same specifications, the required filter order satisfies:</p>
<p>$$N_\text{Elliptic} \leq N_\text{Chebyshev} \leq N_\text{Butterworth}$$</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_filter_orders</span><span class="p">(</span><span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare required orders for different filter types.&quot;&quot;&quot;</span>
    <span class="c1"># Butterworth</span>
    <span class="n">N_butter</span><span class="p">,</span> <span class="n">Wn_butter</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">buttord</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Chebyshev Type I</span>
    <span class="n">N_cheby1</span><span class="p">,</span> <span class="n">Wn_cheby1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb1ord</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Chebyshev Type II</span>
    <span class="n">N_cheby2</span><span class="p">,</span> <span class="n">Wn_cheby2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb2ord</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Elliptic</span>
    <span class="n">N_ellip</span><span class="p">,</span> <span class="n">Wn_ellip</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellipord</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Specifications: Rp=</span><span class="si">{</span><span class="n">Rp_dB</span><span class="si">}</span><span class="s2"> dB, As=</span><span class="si">{</span><span class="n">As_dB</span><span class="si">}</span><span class="s2"> dB, wp=</span><span class="si">{</span><span class="n">wp</span><span class="si">}</span><span class="s2">, ws=</span><span class="si">{</span><span class="n">ws</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Filter Type&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Order N&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Natural Freq&#39;</span><span class="si">:</span><span class="s2">&gt;12</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Butterworth&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">N_butter</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">Wn_butter</span><span class="si">:</span><span class="s2">&gt;12.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Chebyshev I&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">N_cheby1</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">Wn_cheby1</span><span class="si">:</span><span class="s2">&gt;12.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Chebyshev II&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">N_cheby2</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">Wn_cheby2</span><span class="si">:</span><span class="s2">&gt;12.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Elliptic&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">N_ellip</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">Wn_ellip</span><span class="si">:</span><span class="s2">&gt;12.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">N_butter</span><span class="p">,</span> <span class="n">N_cheby1</span><span class="p">,</span> <span class="n">N_cheby2</span><span class="p">,</span> <span class="n">N_ellip</span>

<span class="n">orders</span> <span class="o">=</span> <span class="n">compare_filter_orders</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
</code></pre></div>

<h3 id="63-elliptic-filter-visualization">6.3 Elliptic Filter Visualization<a class="header-link" href="#63-elliptic-filter-visualization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Same specifications, different filter types</span>
<span class="n">Rp</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># dB</span>
<span class="n">As</span> <span class="o">=</span> <span class="mi">60</span>   <span class="c1"># dB</span>
<span class="n">wp</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># rad/s</span>
<span class="n">ws</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1300</span>  <span class="c1"># rad/s</span>

<span class="n">filters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;Butterworth&#39;</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">buttord</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Chebyshev I&#39;</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb1ord</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby1</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Chebyshev II&#39;</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb2ord</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby2</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Elliptic&#39;</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellipord</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellip</span><span class="p">),</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ord_func</span><span class="p">,</span> <span class="n">design_func</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">filters</span><span class="p">):</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">ord_func</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;Chebyshev I&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">design_func</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;Chebyshev II&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">design_func</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;Elliptic&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">design_func</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">design_func</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">ws</span><span class="p">,</span> <span class="mi">5000</span><span class="p">))</span>
    <span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">Rp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">Rp</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">As</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">As</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">wp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ws</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> (N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Filter Type Comparison (Rp=</span><span class="si">{</span><span class="n">Rp</span><span class="si">}</span><span class="s1"> dB, As=</span><span class="si">{</span><span class="n">As</span><span class="si">}</span><span class="s1"> dB)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;filter_type_comparison.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="7-analog-to-digital-conversion">7. Analog-to-Digital Conversion<a class="header-link" href="#7-analog-to-digital-conversion" title="Permanent link">&para;</a></h2>
<h3 id="71-overview-of-methods">7.1 Overview of Methods<a class="header-link" href="#71-overview-of-methods" title="Permanent link">&para;</a></h3>
<p>Three primary methods convert analog filters $H_a(s)$ to digital filters $H(z)$:</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">            </span><span class="n">Analog</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="n">Digital</span><span class="w"> </span><span class="n">Conversion</span><span class="w"> </span><span class="n">Methods</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="k">Method</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Mapping</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">z</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Bilinear</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">T</span><span class="p">)(</span><span class="n">z</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Transform</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">No</span><span class="w"> </span><span class="n">aliasing</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Frequency</span><span class="w"> </span><span class="n">warping</span><span class="w"> </span><span class="p">(</span><span class="n">correctable</span><span class="p">)</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Most</span><span class="w"> </span><span class="n">widely</span><span class="w"> </span><span class="n">used</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Impulse</span><span class="w">          </span><span class="err">â”‚</span><span class="w"> </span><span class="n">h</span><span class="o">[</span><span class="n">n</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="err">Â·</span><span class="w"> </span><span class="n">h_a</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Invariance</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Preserves</span><span class="w"> </span><span class="n">impulse</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="n">shape</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Aliasing</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="k">domain</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">Only</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">bandlimited</span><span class="w"> </span><span class="n">filters</span><span class="w"> </span><span class="p">(</span><span class="n">LP</span><span class="p">,</span><span class="w"> </span><span class="n">BP</span><span class="p">)</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Matched</span><span class="w">          </span><span class="err">â”‚</span><span class="w"> </span><span class="k">Map</span><span class="w"> </span><span class="nl">poles</span><span class="p">:</span><span class="w"> </span><span class="n">s_k</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">z_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="n">s_k</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Z</span><span class="o">-</span><span class="n">Transform</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="k">Map</span><span class="w"> </span><span class="nl">zeros</span><span class="p">:</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">mapping</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="err">â”‚</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Simple</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">formal</span><span class="w"> </span><span class="n">optimality</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="8-bilinear-transform">8. Bilinear Transform<a class="header-link" href="#8-bilinear-transform" title="Permanent link">&para;</a></h2>
<h3 id="81-the-mapping">8.1 The Mapping<a class="header-link" href="#81-the-mapping" title="Permanent link">&para;</a></h3>
<p>The bilinear transform (BLT) maps the entire $s$-plane to the $z$-plane via:</p>
<p>$$s = \frac{2}{T} \cdot \frac{z - 1}{z + 1}$$</p>
<p>or equivalently:</p>
<p>$$z = \frac{1 + (T/2)s}{1 - (T/2)s}$$</p>
<p>where $T$ is the sampling period.</p>
<h3 id="82-key-properties">8.2 Key Properties<a class="header-link" href="#82-key-properties" title="Permanent link">&para;</a></h3>
<p><strong>Stability preservation</strong>: The left half of the $s$-plane maps to the interior of the unit circle in the $z$-plane. This ensures that a stable analog filter always produces a stable digital filter.</p>
<p><strong>Frequency mapping</strong>: The imaginary axis ($s = j\Omega$) maps to the unit circle ($z = e^{j\omega}$) with the nonlinear frequency warping:</p>
<p>$$\omega = 2\arctan\left(\frac{\Omega T}{2}\right) \quad \Leftrightarrow \quad \Omega = \frac{2}{T}\tan\left(\frac{\omega}{2}\right)$$</p>
<h3 id="83-frequency-warping">8.3 Frequency Warping<a class="header-link" href="#83-frequency-warping" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Bilinear Transform Frequency Warping:

Î© (analog)     Ï‰ (digital)
   â†‘              â†‘
   â”‚     â•±       Ï€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•±
   â”‚   â•±          â”‚              â•±
   â”‚  â•±           â”‚            â•±
   â”‚ â•±            â”‚         â•±      Nonlinear
   â”‚â•±             â”‚      â•±        compression
 0 â”œâ”€â”€â”€â†’ Ï‰     0 â”œâ”€â”€â”€â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Î©
   0    Ï€         0

- Low frequencies: Î© â‰ˆ Ï‰ (nearly linear)
- High frequencies: compressed into [0, Ï€]
- Î© = âˆ maps to Ï‰ = Ï€
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Visualize frequency warping</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Sampling period</span>
<span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">omega</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Omega</span><span class="p">,</span> <span class="n">omega</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;BLT mapping&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Omega</span><span class="p">,</span> <span class="n">Omega</span> <span class="o">*</span> <span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Linear (ideal)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Analog Frequency Î© (rad/s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Digital Frequency Ï‰/Ï€&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bilinear Transform: Frequency Warping&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Warping effect at different frequencies</span>
<span class="n">freq_analog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
<span class="n">freq_digital</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">freq_analog</span> <span class="o">*</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq_analog</span><span class="p">)),</span>
            <span class="n">freq_digital</span> <span class="o">/</span> <span class="p">(</span><span class="n">freq_analog</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span>
            <span class="n">tick_label</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freq_analog</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Analog Frequency Î© (rad/s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Warping Error (%)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Frequency Warping Error&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;bilinear_warping.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="84-pre-warping">8.4 Pre-warping<a class="header-link" href="#84-pre-warping" title="Permanent link">&para;</a></h3>
<p>To ensure critical frequencies are mapped correctly, we <strong>pre-warp</strong> the analog specifications:</p>
<p>$$\Omega_p' = \frac{2}{T}\tan\left(\frac{\omega_p}{2}\right), \quad \Omega_s' = \frac{2}{T}\tan\left(\frac{\omega_s}{2}\right)$$</p>
<p>Then design the analog filter with these pre-warped frequencies, and apply the bilinear transform.</p>
<h3 id="85-step-by-step-blt-design">8.5 Step-by-Step BLT Design<a class="header-link" href="#85-step-by-step-blt-design" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iir_design_blt</span><span class="p">(</span><span class="n">wp_digital</span><span class="p">,</span> <span class="n">ws_digital</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;butter&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complete IIR design using bilinear transform with pre-warping.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        wp_digital: digital passband edge (Hz)</span>
<span class="sd">        ws_digital: digital stopband edge (Hz)</span>
<span class="sd">        Rp_dB: passband ripple (dB)</span>
<span class="sd">        As_dB: stopband attenuation (dB)</span>
<span class="sd">        fs: sampling frequency (Hz)</span>
<span class="sd">        ftype: &#39;butter&#39;, &#39;cheby1&#39;, &#39;cheby2&#39;, or &#39;ellip&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        b, a: digital filter coefficients</span>
<span class="sd">        N: filter order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span>

    <span class="c1"># Step 1: Pre-warp digital frequencies to analog</span>
    <span class="n">Omega_p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">wp_digital</span> <span class="o">/</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">Omega_s</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ws_digital</span> <span class="o">/</span> <span class="n">fs</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pre-warped frequencies: Î©p = </span><span class="si">{</span><span class="n">Omega_p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Î©s = </span><span class="si">{</span><span class="n">Omega_s</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: Determine order</span>
    <span class="k">if</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s1">&#39;butter&#39;</span><span class="p">:</span>
        <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">buttord</span><span class="p">(</span><span class="n">Omega_p</span><span class="p">,</span> <span class="n">Omega_s</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Step 3: Design analog prototype</span>
        <span class="n">ba</span><span class="p">,</span> <span class="n">aa</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s1">&#39;cheby1&#39;</span><span class="p">:</span>
        <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb1ord</span><span class="p">(</span><span class="n">Omega_p</span><span class="p">,</span> <span class="n">Omega_s</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ba</span><span class="p">,</span> <span class="n">aa</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby1</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s1">&#39;cheby2&#39;</span><span class="p">:</span>
        <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb2ord</span><span class="p">(</span><span class="n">Omega_p</span><span class="p">,</span> <span class="n">Omega_s</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ba</span><span class="p">,</span> <span class="n">aa</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s1">&#39;ellip&#39;</span><span class="p">:</span>
        <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellipord</span><span class="p">(</span><span class="n">Omega_p</span><span class="p">,</span> <span class="n">Omega_s</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ba</span><span class="p">,</span> <span class="n">aa</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellip</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp_dB</span><span class="p">,</span> <span class="n">As_dB</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analog filter order: N = </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 4: Bilinear transform</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">bilinear</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">N</span>

<span class="c1"># Example</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">8000</span>
<span class="n">wp</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Hz</span>
<span class="n">ws</span> <span class="o">=</span> <span class="mi">1500</span>  <span class="c1"># Hz</span>
<span class="n">Rp</span> <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># dB</span>
<span class="n">As</span> <span class="o">=</span> <span class="mi">60</span>    <span class="c1"># dB</span>

<span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">iir_design_blt</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;ellip&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Digital filter coefficients:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;b = </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;a = </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Verify</span>
<span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Magnitude</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">Rp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">Rp</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">As</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;-</span><span class="si">{</span><span class="n">As</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Elliptic IIR (N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">): Magnitude&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Phase</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">H</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (degrees)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase Response&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Group delay</span>
<span class="n">w_gd</span><span class="p">,</span> <span class="n">gd</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">group_delay</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">w</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_gd</span><span class="p">,</span> <span class="n">gd</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Group Delay (samples)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Group Delay (Non-constant!)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Pole-zero plot</span>
<span class="n">z_zeros</span><span class="p">,</span> <span class="n">z_poles</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">tf2zpk</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">z_zeros</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_zeros</span><span class="p">),</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Zeros&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">z_poles</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_poles</span><span class="p">),</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Poles&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pole-Zero Plot&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;IIR Filter Design via Bilinear Transform&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;iir_blt_design.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="9-impulse-invariance-method">9. Impulse Invariance Method<a class="header-link" href="#9-impulse-invariance-method" title="Permanent link">&para;</a></h2>
<h3 id="91-principle">9.1 Principle<a class="header-link" href="#91-principle" title="Permanent link">&para;</a></h3>
<p>The impulse invariance method sets the digital filter's impulse response equal to samples of the analog impulse response:</p>
<p>$$h[n] = T \cdot h_a(nT)$$</p>
<p>where $h_a(t)$ is the analog impulse response and $T$ is the sampling period.</p>
<h3 id="92-mapping">9.2 Mapping<a class="header-link" href="#92-mapping" title="Permanent link">&para;</a></h3>
<p>If the analog filter has a partial fraction expansion:</p>
<p>$$H_a(s) = \sum_{k=1}^{N} \frac{A_k}{s - s_k}$$</p>
<p>then the digital filter is:</p>
<p>$$H(z) = T \sum_{k=1}^{N} \frac{A_k}{1 - e^{s_k T} z^{-1}}$$</p>
<p>Each analog pole $s_k$ maps to a digital pole $z_k = e^{s_k T}$.</p>
<h3 id="93-aliasing-problem">9.3 Aliasing Problem<a class="header-link" href="#93-aliasing-problem" title="Permanent link">&para;</a></h3>
<p>The frequency response of the digital filter is a sum of shifted copies of the analog response:</p>
<p>$$H(e^{j\omega}) = \frac{1}{T} \sum_{k=-\infty}^{\infty} H_a\left(j\frac{\omega - 2\pi k}{T}\right)$$</p>
<p>This causes <strong>aliasing</strong> if $H_a(j\Omega)$ is not bandlimited, which makes impulse invariance unsuitable for highpass and bandstop filters.</p>
<h3 id="94-implementation-example">9.4 Implementation Example<a class="header-link" href="#94-implementation-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">impulse_invariance</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply impulse invariance method to convert analog filter to digital.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        ba, aa: analog filter coefficients (transfer function form)</span>
<span class="sd">        fs: sampling frequency</span>

<span class="sd">    Returns:</span>
<span class="sd">        bd, ad: digital filter coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span>

    <span class="c1"># Convert to zeros, poles, gain form</span>
    <span class="n">z_a</span><span class="p">,</span> <span class="n">p_a</span><span class="p">,</span> <span class="n">k_a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">tf2zpk</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="n">aa</span><span class="p">)</span>

    <span class="c1"># Partial fraction expansion</span>
    <span class="n">residues</span><span class="p">,</span> <span class="n">poles</span><span class="p">,</span> <span class="n">direct</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="n">aa</span><span class="p">)</span>

    <span class="c1"># Map poles: z_k = exp(s_k * T)</span>
    <span class="n">z_poles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">poles</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>

    <span class="c1"># Construct digital transfer function</span>
    <span class="c1"># H(z) = T * sum(A_k / (1 - e^(s_k*T) * z^-1))</span>
    <span class="n">bd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">])</span>
    <span class="n">ad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">A_k</span><span class="p">,</span> <span class="n">z_k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">residues</span><span class="p">,</span> <span class="n">z_poles</span><span class="p">):</span>
        <span class="c1"># Each term: T * A_k / (1 - z_k * z^-1)</span>
        <span class="n">bd_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">T</span> <span class="o">*</span> <span class="n">A_k</span><span class="p">])</span>
        <span class="n">ad_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">z_k</span><span class="p">])</span>

        <span class="c1"># Combine fractions</span>
        <span class="n">bd_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">bd</span><span class="p">,</span> <span class="n">ad_k</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">bd_k</span><span class="p">,</span> <span class="n">ad</span><span class="p">)</span>
        <span class="n">ad_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span> <span class="n">ad_k</span><span class="p">)</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="n">bd_new</span>
        <span class="n">ad</span> <span class="o">=</span> <span class="n">ad_new</span>

    <span class="c1"># Ensure real coefficients</span>
    <span class="n">bd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">bd</span><span class="p">)</span>
    <span class="n">ad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ad</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bd</span><span class="p">,</span> <span class="n">ad</span>

<span class="c1"># Compare BLT and impulse invariance for a Butterworth lowpass</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">8000</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">fc</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Cutoff frequency (Hz)</span>

<span class="c1"># Analog prototype</span>
<span class="n">Omega_c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fc</span>
<span class="n">ba</span><span class="p">,</span> <span class="n">aa</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Omega_c</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Method 1: Bilinear transform</span>
<span class="n">bd_blt</span><span class="p">,</span> <span class="n">ad_blt</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">bilinear</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="c1"># Method 2: Impulse invariance</span>
<span class="n">bd_ii</span><span class="p">,</span> <span class="n">ad_ii</span> <span class="o">=</span> <span class="n">impulse_invariance</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="c1"># Compare frequency responses</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">w_blt</span><span class="p">,</span> <span class="n">H_blt</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">bd_blt</span><span class="p">,</span> <span class="n">ad_blt</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">w_ii</span><span class="p">,</span> <span class="n">H_ii</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">bd_ii</span><span class="p">,</span> <span class="n">ad_ii</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

<span class="c1"># Also plot the analog response for reference</span>
<span class="n">w_a</span><span class="p">,</span> <span class="n">H_a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqs</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4096</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_a</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_a</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
             <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Analog&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_blt</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_blt</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
             <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bilinear Transform&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_ii</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_ii</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
             <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Impulse Invariance&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BLT vs Impulse Invariance&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Near Nyquist detail</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_blt</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_blt</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
             <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;BLT&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_ii</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_ii</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
             <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Impulse Invariance&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Detail Near Nyquist (aliasing visible)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;impulse_invariance.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="10-complete-iir-design-procedure">10. Complete IIR Design Procedure<a class="header-link" href="#10-complete-iir-design-procedure" title="Permanent link">&para;</a></h2>
<h3 id="101-step-by-step-procedure">10.1 Step-by-Step Procedure<a class="header-link" href="#101-step-by-step-procedure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="nx">IIR</span><span class="w"> </span><span class="nx">Filter</span><span class="w"> </span><span class="nx">Design</span><span class="w"> </span><span class="nx">Steps</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Specify</span><span class="w"> </span><span class="nx">digital</span><span class="w"> </span><span class="nx">requirements</span><span class="p">:</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Passband</span><span class="o">/</span><span class="nx">stopband</span><span class="w"> </span><span class="nx">edges</span><span class="w"> </span><span class="p">(</span><span class="nx">Ï‰p</span><span class="p">,</span><span class="w"> </span><span class="nx">Ï‰s</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">fp</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">)</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Passband</span><span class="w"> </span><span class="nx">ripple</span><span class="w"> </span><span class="nx">Rp</span><span class="w"> </span><span class="p">(</span><span class="nx">dB</span><span class="p">)</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Stopband</span><span class="w"> </span><span class="nx">attenuation</span><span class="w"> </span><span class="nx">As</span><span class="w"> </span><span class="p">(</span><span class="nx">dB</span><span class="p">)</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Choose</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="k">type</span><span class="p">:</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Butterworth</span><span class="p">:</span><span class="w"> </span><span class="nx">maximally</span><span class="w"> </span><span class="nx">flat</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Chebyshev</span><span class="w"> </span><span class="nx">I</span><span class="p">:</span><span class="w"> </span><span class="nx">equiripple</span><span class="w"> </span><span class="nx">passband</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Chebyshev</span><span class="w"> </span><span class="nx">II</span><span class="p">:</span><span class="w"> </span><span class="nx">equiripple</span><span class="w"> </span><span class="nx">stopband</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Elliptic</span><span class="p">:</span><span class="w"> </span><span class="nx">minimum</span><span class="w"> </span><span class="nx">order</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Choose</span><span class="w"> </span><span class="nx">conversion</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="p">(</span><span class="nx">usually</span><span class="w"> </span><span class="nx">BLT</span><span class="p">)</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Pre</span><span class="o">-</span><span class="nx">warp</span><span class="w"> </span><span class="nx">critical</span><span class="w"> </span><span class="nx">frequencies</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Determine</span><span class="w"> </span><span class="nx">minimum</span><span class="w"> </span><span class="nx">analog</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="nx">order</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="nx">Design</span><span class="w"> </span><span class="nx">analog</span><span class="w"> </span><span class="nx">prototype</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">7</span><span class="p">.</span><span class="w"> </span><span class="nx">Apply</span><span class="w"> </span><span class="nx">analog</span><span class="o">-</span><span class="nx">to</span><span class="o">-</span><span class="nx">digital</span><span class="w"> </span><span class="nx">transformation</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">8</span><span class="p">.</span><span class="w"> </span><span class="nx">Verify</span><span class="w"> </span><span class="nx">specifications</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="nx">passband</span><span class="w"> </span><span class="nx">ripple</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="nx">stopband</span><span class="w"> </span><span class="nx">attenuation</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="nx">stability</span><span class="w"> </span><span class="p">(</span><span class="nx">all</span><span class="w"> </span><span class="nx">poles</span><span class="w"> </span><span class="nx">inside</span><span class="w"> </span><span class="nx">unit</span><span class="w"> </span><span class="nx">circle</span><span class="p">)</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">9</span><span class="p">.</span><span class="w"> </span><span class="nx">Implement</span><span class="w"> </span><span class="p">(</span><span class="nx">Direct</span><span class="w"> </span><span class="nx">Form</span><span class="w"> </span><span class="nx">II</span><span class="p">,</span><span class="w"> </span><span class="nx">SOS</span><span class="w"> </span><span class="nx">cascade</span><span class="p">,</span><span class="w"> </span><span class="nx">etc</span><span class="p">.)</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="102-using-scipysignal-direct-design-functions">10.2 Using scipy.signal Direct Design Functions<a class="header-link" href="#102-using-scipysignal-direct-design-functions" title="Permanent link">&para;</a></h3>
<p>SciPy provides high-level functions that handle pre-warping internally:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">design_all_types</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Design IIR lowpass filter using all four types.&quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Direct digital design (scipy handles pre-warping internally)</span>
    <span class="c1"># Butterworth</span>
    <span class="n">N_b</span><span class="p">,</span> <span class="n">Wn_b</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">buttord</span><span class="p">(</span><span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">b_b</span><span class="p">,</span> <span class="n">a_b</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N_b</span><span class="p">,</span> <span class="n">Wn_b</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Butterworth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_b</span><span class="p">,</span> <span class="n">a_b</span><span class="p">,</span> <span class="n">N_b</span><span class="p">)</span>

    <span class="c1"># Chebyshev Type I</span>
    <span class="n">N_c1</span><span class="p">,</span> <span class="n">Wn_c1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb1ord</span><span class="p">(</span><span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">b_c1</span><span class="p">,</span> <span class="n">a_c1</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby1</span><span class="p">(</span><span class="n">N_c1</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">Wn_c1</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Chebyshev I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_c1</span><span class="p">,</span> <span class="n">a_c1</span><span class="p">,</span> <span class="n">N_c1</span><span class="p">)</span>

    <span class="c1"># Chebyshev Type II</span>
    <span class="n">N_c2</span><span class="p">,</span> <span class="n">Wn_c2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb2ord</span><span class="p">(</span><span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">b_c2</span><span class="p">,</span> <span class="n">a_c2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby2</span><span class="p">(</span><span class="n">N_c2</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Wn_c2</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Chebyshev II&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_c2</span><span class="p">,</span> <span class="n">a_c2</span><span class="p">,</span> <span class="n">N_c2</span><span class="p">)</span>

    <span class="c1"># Elliptic</span>
    <span class="n">N_e</span><span class="p">,</span> <span class="n">Wn_e</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellipord</span><span class="p">(</span><span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">b_e</span><span class="p">,</span> <span class="n">a_e</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellip</span><span class="p">(</span><span class="n">N_e</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Wn_e</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Elliptic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_e</span><span class="p">,</span> <span class="n">a_e</span><span class="p">,</span> <span class="n">N_e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Design and compare</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span>
<span class="n">f_pass</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">f_stop</span> <span class="o">=</span> <span class="mi">2500</span>
<span class="n">Rp</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">As</span> <span class="o">=</span> <span class="mi">60</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">design_all_types</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">H_dB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">H_dB</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">Rp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Rp = -</span><span class="si">{</span><span class="n">Rp</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">As</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;As = -</span><span class="si">{</span><span class="n">As</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_pass</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">f_stop</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> (N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;IIR Filter Comparison (fp=</span><span class="si">{</span><span class="n">f_pass</span><span class="si">}</span><span class="s1"> Hz, fs_stop=</span><span class="si">{</span><span class="n">f_stop</span><span class="si">}</span><span class="s1"> Hz)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;iir_all_types.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Print summary</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;Filter Type&#39;</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Order&#39;</span><span class="si">:</span><span class="s2">&lt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Actual Rp (dB)&#39;</span><span class="si">:</span><span class="s2">&lt;16</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Actual As (dB)&#39;</span><span class="si">:</span><span class="s2">&lt;16</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">55</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">H_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">w</span>

    <span class="c1"># Passband ripple</span>
    <span class="n">pass_idx</span> <span class="o">=</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="n">f_pass</span>
    <span class="n">Rp_actual</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">H_mag</span><span class="p">[</span><span class="n">pass_idx</span><span class="p">]))</span>

    <span class="c1"># Stopband attenuation</span>
    <span class="n">stop_idx</span> <span class="o">=</span> <span class="n">f</span> <span class="o">&gt;=</span> <span class="n">f_stop</span>
    <span class="n">As_actual</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">H_mag</span><span class="p">[</span><span class="n">stop_idx</span><span class="p">]))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">N</span><span class="si">:</span><span class="s2">&lt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">Rp_actual</span><span class="si">:</span><span class="s2">&lt;16.4f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">As_actual</span><span class="si">:</span><span class="s2">&lt;16.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="11-stability-analysis">11. Stability Analysis<a class="header-link" href="#11-stability-analysis" title="Permanent link">&para;</a></h2>
<h3 id="111-stability-criterion">11.1 Stability Criterion<a class="header-link" href="#111-stability-criterion" title="Permanent link">&para;</a></h3>
<p>A digital IIR filter is <strong>stable</strong> if and only if all poles of $H(z)$ lie strictly inside the unit circle:</p>
<p>$$|z_k| < 1, \quad \forall k$$</p>
<h3 id="112-second-order-sections-sos-for-numerical-stability">11.2 Second-Order Sections (SOS) for Numerical Stability<a class="header-link" href="#112-second-order-sections-sos-for-numerical-stability" title="Permanent link">&para;</a></h3>
<p>High-order IIR filters implemented in direct form can suffer from coefficient quantization and numerical precision issues. The solution is to implement as a <strong>cascade of second-order sections (biquads)</strong>:</p>
<p>$$H(z) = \prod_{i=1}^{L} \frac{b_{0i} + b_{1i}z^{-1} + b_{2i}z^{-2}}{1 + a_{1i}z^{-1} + a_{2i}z^{-2}}$$</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stability_analysis</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze IIR filter stability.&quot;&quot;&quot;</span>
    <span class="c1"># Poles and zeros</span>
    <span class="n">zeros</span><span class="p">,</span> <span class="n">poles</span><span class="p">,</span> <span class="n">gain</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">tf2zpk</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="c1"># Check stability</span>
    <span class="n">pole_mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">poles</span><span class="p">)</span>
    <span class="n">is_stable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">pole_mags</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">max_pole_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pole_mags</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filter: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Number of poles: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">poles</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Number of zeros: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum pole magnitude: </span><span class="si">{</span><span class="n">max_pole_mag</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Stable: </span><span class="si">{</span><span class="n">is_stable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Stability margin: </span><span class="si">{</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">max_pole_mag</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Pole-zero plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unit circle&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">zeros</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">zeros</span><span class="p">),</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Zeros (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">poles</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">poles</span><span class="p">),</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Poles (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">poles</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="c1"># Color poles by stability</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poles</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">p</span><span class="p">)),</span> <span class="mf">0.03</span><span class="p">,</span>
                            <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pole-Zero Plot: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="s1">(Stable: </span><span class="si">{</span><span class="n">is_stable</span><span class="si">}</span><span class="s1">, &#39;</span>
                 <span class="sa">f</span><span class="s1">&#39;Max |pole| = </span><span class="si">{</span><span class="n">max_pole_mag</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">is_stable</span>

<span class="c1"># Design a high-order filter and check stability</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">b_high</span><span class="p">,</span> <span class="n">a_high</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>  <span class="c1"># 12th-order Butterworth</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">stable</span> <span class="o">=</span> <span class="n">stability_analysis</span><span class="p">(</span><span class="n">b_high</span><span class="p">,</span> <span class="n">a_high</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Butterworth N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;stability_analysis.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Convert to SOS form for better numerical stability</span>
<span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">tf2sos</span><span class="p">(</span><span class="n">b_high</span><span class="p">,</span> <span class="n">a_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SOS representation: </span><span class="si">{</span><span class="n">sos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> second-order sections&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SOS coefficients:</span><span class="se">\n</span><span class="si">{</span><span class="n">sos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="113-numerical-comparison-tf-vs-sos">11.3 Numerical Comparison: tf vs SOS<a class="header-link" href="#113-numerical-comparison-tf-vs-sos" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_tf_vs_sos</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare direct form vs SOS implementation for high-order filter.&quot;&quot;&quot;</span>
    <span class="c1"># Design high-order filter</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">)</span>

    <span class="c1"># Test signal</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># Filter using tf form</span>
    <span class="n">y_tf</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># Filter using SOS form</span>
    <span class="n">y_sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfilt</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># Compare</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Frequency response comparison</span>
    <span class="n">w_tf</span><span class="p">,</span> <span class="n">H_tf</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
    <span class="n">w_sos</span><span class="p">,</span> <span class="n">H_sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfreqz</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_tf</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_tf</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
                     <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;tf form&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_sos</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H_sos</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
                     <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SOS form&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency (Ã—Ï€)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Frequency Response&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Output comparison</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_tf</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;tf form&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_sos</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SOS form&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sample&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Output Signal&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Difference</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_tf</span> <span class="o">-</span> <span class="n">y_sos</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sample&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|y_tf - y_sos|&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Numerical Difference (max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Pole magnitudes</span>
    <span class="n">zeros_tf</span><span class="p">,</span> <span class="n">poles_tf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">tf2zpk</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">poles_tf</span><span class="p">),</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unit circle&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pole Index&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|pole|&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pole Magnitudes (N=</span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Direct Form vs SOS (Order=</span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;tf_vs_sos.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">compare_tf_vs_sos</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="12-comparison-of-filter-types">12. Comparison of Filter Types<a class="header-link" href="#12-comparison-of-filter-types" title="Permanent link">&para;</a></h2>
<h3 id="121-summary-table">12.1 Summary Table<a class="header-link" href="#121-summary-table" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">IIR</span><span class="w"> </span><span class="nv">Filter</span><span class="w"> </span><span class="nv">Type</span><span class="w"> </span><span class="nv">Comparison</span><span class="w">                          </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">              </span>â”‚<span class="w"> </span><span class="nv">Butterworth</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Chebyshev</span><span class="w"> </span><span class="nv">I</span>â”‚<span class="w"> </span><span class="nv">Chebyshev</span><span class="w"> </span><span class="nv">II</span>â”‚<span class="w"> </span><span class="nv">Elliptic</span><span class="w">      </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Passband</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Maximally</span><span class="w">   </span>â”‚<span class="w"> </span><span class="nv">Equiripple</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Monotonic</span><span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Equiripple</span><span class="w">    </span>â”‚
â”‚<span class="w">              </span>â”‚<span class="w"> </span><span class="nv">flat</span><span class="w">        </span>â”‚<span class="w">            </span>â”‚<span class="w">            </span>â”‚<span class="w">               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Stopband</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Monotonic</span><span class="w">   </span>â”‚<span class="w"> </span><span class="nv">Monotonic</span><span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Equiripple</span><span class="w"> </span>â”‚<span class="w"> </span><span class="nv">Equiripple</span><span class="w">    </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Transition</span><span class="w">   </span>â”‚<span class="w"> </span><span class="nv">Widest</span><span class="w">      </span>â”‚<span class="w"> </span><span class="nv">Medium</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Medium</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Sharpest</span><span class="w">      </span>â”‚
â”‚<span class="w"> </span><span class="nv">band</span><span class="w">         </span>â”‚<span class="w">             </span>â”‚<span class="w">            </span>â”‚<span class="w">            </span>â”‚<span class="w">               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Order</span><span class="w"> </span><span class="k">for</span><span class="w">    </span>â”‚<span class="w"> </span><span class="nv">Highest</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Medium</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Medium</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Lowest</span><span class="w">        </span>â”‚
â”‚<span class="w"> </span><span class="nv">given</span><span class="w"> </span><span class="nv">specs</span><span class="w">  </span>â”‚<span class="w">             </span>â”‚<span class="w">            </span>â”‚<span class="w">            </span>â”‚<span class="w">               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Group</span><span class="w"> </span><span class="nv">delay</span><span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Most</span><span class="w">        </span>â”‚<span class="w"> </span><span class="nv">Less</span><span class="w">       </span>â”‚<span class="w"> </span><span class="nv">Better</span><span class="w"> </span><span class="nv">than</span>â”‚<span class="w"> </span><span class="nv">Most</span><span class="w">          </span>â”‚
â”‚<span class="w">              </span>â”‚<span class="w"> </span><span class="nv">uniform</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">uniform</span><span class="w">    </span>â”‚<span class="w"> </span><span class="nv">Type</span><span class="w"> </span><span class="nv">I</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">non</span><span class="o">-</span><span class="nv">uniform</span><span class="w">   </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">Use</span><span class="w"> </span><span class="nv">case</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">General</span>,<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">Sharp</span><span class="w">      </span>â”‚<span class="w"> </span><span class="nv">Flat</span><span class="w">       </span>â”‚<span class="w"> </span><span class="nv">Minimum</span><span class="w"> </span><span class="nv">order</span>,â”‚
â”‚<span class="w">              </span>â”‚<span class="w"> </span><span class="nv">smooth</span><span class="w">      </span>â”‚<span class="w"> </span><span class="nv">cutoff</span>,<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">passband</span>,<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">tight</span><span class="w"> </span><span class="nv">specs</span><span class="w">   </span>â”‚
â”‚<span class="w">              </span>â”‚<span class="w"> </span><span class="nv">response</span><span class="w">    </span>â”‚<span class="w"> </span><span class="nv">ok</span><span class="w"> </span><span class="nv">ripple</span><span class="w">  </span>â”‚<span class="w"> </span><span class="nv">ok</span><span class="w"> </span><span class="nv">stopband</span>â”‚<span class="w">               </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="122-comprehensive-visual-comparison">12.2 Comprehensive Visual Comparison<a class="header-link" href="#122-comprehensive-visual-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">comprehensive_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete comparison of all four IIR filter types.&quot;&quot;&quot;</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="n">fstop</span> <span class="o">=</span> <span class="mi">3000</span>
    <span class="n">Rp</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">As</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Butterworth</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">buttord</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">fstop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">)</span>
    <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;Butterworth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># Chebyshev I</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb1ord</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">fstop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby1</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">)</span>
    <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;Chebyshev I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># Chebyshev II</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb2ord</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">fstop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">)</span>
    <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;Chebyshev II&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># Elliptic</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellipord</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">fstop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellip</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">)</span>
    <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;Elliptic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Butterworth&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;Chebyshev I&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Chebyshev II&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;Elliptic&#39;</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">}</span>

    <span class="c1"># Magnitude response overlay</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfreqz</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> (N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">Rp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">As</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude Response&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Passband detail</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfreqz</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> (N=</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Passband Detail&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fp</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Group delay</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sos2tf</span><span class="p">(</span><span class="n">sos</span><span class="p">)</span>
        <span class="n">w_gd</span><span class="p">,</span> <span class="n">gd</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">group_delay</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">w</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w_gd</span><span class="p">,</span> <span class="n">gd</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Group Delay (samples)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Group Delay&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Step response</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfilt</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sample&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Step Response&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Comprehensive IIR Filter Comparison&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;comprehensive_comparison.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">comprehensive_comparison</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="13-python-implementation">13. Python Implementation<a class="header-link" href="#13-python-implementation" title="Permanent link">&para;</a></h2>
<h3 id="131-complete-iir-design-workflow">13.1 Complete IIR Design Workflow<a class="header-link" href="#131-complete-iir-design-workflow" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">complete_iir_workflow</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">,</span> <span class="n">band_type</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complete IIR filter design and analysis workflow.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        fs: sampling frequency (Hz)</span>
<span class="sd">        filter_type: &#39;butter&#39;, &#39;cheby1&#39;, &#39;cheby2&#39;, &#39;ellip&#39;</span>
<span class="sd">        band_type: &#39;lowpass&#39;, &#39;highpass&#39;, &#39;bandpass&#39;, &#39;bandstop&#39;</span>
<span class="sd">        freqs: (f_pass, f_stop) or ((fp1, fp2), (fs1, fs2)) for bandpass/stop</span>
<span class="sd">        Rp: passband ripple (dB)</span>
<span class="sd">        As: stopband attenuation (dB)</span>

<span class="sd">    Returns:</span>
<span class="sd">        sos: second-order sections</span>
<span class="sd">        info: design information</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span> <span class="o">=</span> <span class="n">freqs</span>

    <span class="c1"># Order determination</span>
    <span class="n">ord_funcs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;butter&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">buttord</span><span class="p">,</span>
        <span class="s1">&#39;cheby1&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb1ord</span><span class="p">,</span>
        <span class="s1">&#39;cheby2&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheb2ord</span><span class="p">,</span>
        <span class="s1">&#39;ellip&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellipord</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">Wn</span> <span class="o">=</span> <span class="n">ord_funcs</span><span class="p">[</span><span class="n">filter_type</span><span class="p">](</span><span class="n">f_pass</span><span class="p">,</span> <span class="n">f_stop</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

    <span class="c1"># Design</span>
    <span class="n">design_funcs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;butter&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="n">band_type</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cheby1&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby1</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="n">band_type</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cheby2&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">cheby2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="n">band_type</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ellip&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">ellip</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="n">band_type</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">sos</span> <span class="o">=</span> <span class="n">design_funcs</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]()</span>

    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;filter_type&#39;</span><span class="p">:</span> <span class="n">filter_type</span><span class="p">,</span>
        <span class="s1">&#39;band_type&#39;</span><span class="p">:</span> <span class="n">band_type</span><span class="p">,</span>
        <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span>
        <span class="s1">&#39;Wn&#39;</span><span class="p">:</span> <span class="n">Wn</span><span class="p">,</span>
        <span class="s1">&#39;Rp&#39;</span><span class="p">:</span> <span class="n">Rp</span><span class="p">,</span>
        <span class="s1">&#39;As&#39;</span><span class="p">:</span> <span class="n">As</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">sos</span><span class="p">,</span> <span class="n">info</span>

<span class="c1"># Example: Bandpass filter</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">44100</span>
<span class="n">sos_bp</span><span class="p">,</span> <span class="n">info_bp</span> <span class="o">=</span> <span class="n">complete_iir_workflow</span><span class="p">(</span>
    <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
    <span class="n">filter_type</span><span class="o">=</span><span class="s1">&#39;ellip&#39;</span><span class="p">,</span>
    <span class="n">band_type</span><span class="o">=</span><span class="s1">&#39;bandpass&#39;</span><span class="p">,</span>
    <span class="n">freqs</span><span class="o">=</span><span class="p">([</span><span class="mi">800</span><span class="p">,</span> <span class="mi">3000</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">3500</span><span class="p">]),</span>
    <span class="n">Rp</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">As</span><span class="o">=</span><span class="mi">50</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bandpass filter: </span><span class="si">{</span><span class="n">info_bp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Apply to signal</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
<span class="c1"># Speech-like signal: mix of tones + noise</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">200</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>    <span class="c1"># Low freq</span>
     <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>           <span class="c1"># Mid freq (passband)</span>
     <span class="mf">0.8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2000</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>     <span class="c1"># Mid freq (passband)</span>
     <span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">5000</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>     <span class="c1"># High freq</span>
     <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>      <span class="c1"># Noise</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfilt</span><span class="p">(</span><span class="n">sos_bp</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Time domain</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">2000</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2000</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">2000</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">y</span><span class="p">[:</span><span class="mi">2000</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filtered&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time Domain: Bandpass Filtering&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Spectrum</span>
<span class="n">N_fft</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">freqs_fft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">N_fft</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">N_fft</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">/</span> <span class="n">N_fft</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs_fft</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs_fft</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Y</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filtered&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Passband&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Frequency Domain&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Filter frequency response</span>
<span class="n">w</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfreqz</span><span class="p">(</span><span class="n">sos_bp</span><span class="p">,</span> <span class="n">worN</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Passband&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Filter Response (Elliptic N=</span><span class="si">{</span><span class="n">info_bp</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;iir_bandpass_demo.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h3 id="132-real-time-iir-filtering-with-sos">13.2 Real-Time IIR Filtering with SOS<a class="header-link" href="#132-real-time-iir-filtering-with-sos" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RealtimeIIRFilter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Real-time IIR filter using second-order sections.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with SOS coefficients.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            sos: second-order sections array (L x 6)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># State variables: 2 delay elements per section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sections</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a single input sample.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sections</span><span class="p">):</span>
            <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Direct Form II Transposed</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">y</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>  <span class="c1"># Output of this section is input to next</span>

        <span class="k">return</span> <span class="n">y</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_block</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a block of samples.&quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_block</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_block</span><span class="p">)):</span>
            <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_sample</span><span class="p">(</span><span class="n">x_block</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">y</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset filter state.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sections</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Demonstration</span>
<span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">)</span>
<span class="n">filt</span> <span class="o">=</span> <span class="n">RealtimeIIRFilter</span><span class="p">(</span><span class="n">sos</span><span class="p">)</span>

<span class="c1"># Process in blocks (simulating real-time)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">block_size</span> <span class="o">=</span> <span class="mi">64</span>

<span class="n">y_realtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">block_size</span><span class="p">):</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">block_size</span><span class="p">]</span>
    <span class="n">y_realtime</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)]</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">process_block</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

<span class="c1"># Compare with scipy batch processing</span>
<span class="n">y_batch</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfilt</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_realtime</span> <span class="o">-</span> <span class="n">y_batch</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum error between real-time and batch: </span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="14-exercises">14. Exercises<a class="header-link" href="#14-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-butterworth-filter-design">Exercise 1: Butterworth Filter Design<a class="header-link" href="#exercise-1-butterworth-filter-design" title="Permanent link">&para;</a></h3>
<p>Design a digital Butterworth lowpass filter with:
- Sampling frequency: $f_s = 10000$ Hz
- Passband edge: $f_p = 1500$ Hz with $\leq 0.5$ dB ripple
- Stopband edge: $f_s = 2000$ Hz with $\geq 40$ dB attenuation</p>
<p>(a) Compute the required filter order using the Butterworth order formula.</p>
<p>(b) Pre-warp the digital frequencies to analog frequencies.</p>
<p>(c) Design the analog Butterworth prototype and apply the bilinear transform.</p>
<p>(d) Verify the design meets specifications. Plot magnitude response, phase response, group delay, and pole-zero diagram.</p>
<p>(e) Compare your manual design with <code>scipy.signal.butter</code>. Are the results identical?</p>
<h3 id="exercise-2-chebyshev-filter-comparison">Exercise 2: Chebyshev Filter Comparison<a class="header-link" href="#exercise-2-chebyshev-filter-comparison" title="Permanent link">&para;</a></h3>
<p>For the specifications: $f_s = 8000$ Hz, $f_p = 1000$ Hz, $f_\text{stop} = 1200$ Hz, $R_p = 1$ dB, $A_s = 50$ dB:</p>
<p>(a) Design both Chebyshev Type I and Type II filters.</p>
<p>(b) Compare their frequency responses on a single plot.</p>
<p>(c) Which has better group delay flatness in the passband? Show quantitatively.</p>
<p>(d) Apply both filters to a chirp signal (sweep 100 Hz to 4000 Hz) and compare the outputs.</p>
<h3 id="exercise-3-elliptic-filter-for-audio">Exercise 3: Elliptic Filter for Audio<a class="header-link" href="#exercise-3-elliptic-filter-for-audio" title="Permanent link">&para;</a></h3>
<p>Design an elliptic lowpass filter for audio anti-aliasing:
- Input sampling rate: 96 kHz (to be downsampled to 48 kHz)
- Passband: 0 to 20 kHz with ripple $\leq 0.01$ dB
- Stopband: 24 kHz to 48 kHz with attenuation $\geq 96$ dB (16-bit precision)</p>
<p>(a) Determine the minimum filter order.</p>
<p>(b) Implement using SOS form.</p>
<p>(c) Plot the magnitude response on both linear and dB scales.</p>
<p>(d) Compute and plot the group delay. Is the group delay variation acceptable for audio?</p>
<h3 id="exercise-4-bilinear-transform-by-hand">Exercise 4: Bilinear Transform by Hand<a class="header-link" href="#exercise-4-bilinear-transform-by-hand" title="Permanent link">&para;</a></h3>
<p>Given the first-order analog lowpass filter:</p>
<p>$$H_a(s) = \frac{\Omega_c}{s + \Omega_c}$$</p>
<p>(a) Apply the bilinear transform $s = \frac{2}{T}\frac{z-1}{z+1}$ to derive $H(z)$.</p>
<p>(b) For $\Omega_c = 2\pi \times 1000$ rad/s and $f_s = 8000$ Hz, compute the digital filter coefficients $b_0, b_1, a_0, a_1$.</p>
<p>(c) Verify by comparing the frequency response of $H(z)$ with the warped analog response.</p>
<p>(d) Repeat for a second-order Butterworth filter with the same cutoff.</p>
<h3 id="exercise-5-stability-investigation">Exercise 5: Stability Investigation<a class="header-link" href="#exercise-5-stability-investigation" title="Permanent link">&para;</a></h3>
<p>(a) Design a 16th-order Chebyshev Type I filter ($R_p = 3$ dB, $\omega_c = 0.1\pi$) in both <code>tf</code> and <code>sos</code> forms.</p>
<p>(b) Compute and display the pole magnitudes for both representations.</p>
<p>(c) Filter a white noise signal using both representations. Is the <code>tf</code> form output valid?</p>
<p>(d) At what order does the <code>tf</code> form typically break down for Chebyshev Type I filters? Experiment with orders 4, 8, 12, 16, 20, 24.</p>
<h3 id="exercise-6-iir-vs-fir-comparison">Exercise 6: IIR vs FIR Comparison<a class="header-link" href="#exercise-6-iir-vs-fir-comparison" title="Permanent link">&para;</a></h3>
<p>For the specification: $f_s = 16000$ Hz, $f_p = 3000$ Hz, $f_\text{stop} = 3500$ Hz, $A_s = 60$ dB:</p>
<p>(a) Design both an IIR (elliptic) and FIR (Parks-McClellan) filter.</p>
<p>(b) Compare: filter orders, computational cost per sample, group delay, magnitude response.</p>
<p>(c) Filter a speech-like signal (sum of harmonics at 100, 200, ..., 5000 Hz). Compare the time-domain outputs visually and by computing the SNR improvement.</p>
<p>(d) For which application scenarios would you choose IIR over FIR, and vice versa?</p>
<h3 id="exercise-7-bandstop-notch-filter">Exercise 7: Bandstop (Notch) Filter<a class="header-link" href="#exercise-7-bandstop-notch-filter" title="Permanent link">&para;</a></h3>
<p>Design a narrow bandstop filter to remove 60 Hz powerline interference from an ECG signal:
- Sampling frequency: 500 Hz
- Remove: 59-61 Hz
- Passband: 0-55 Hz and 65-250 Hz
- Passband ripple: $\leq 0.1$ dB
- Stopband attenuation: $\geq 30$ dB</p>
<p>(a) Design using an elliptic prototype. What order is needed?</p>
<p>(b) Plot the magnitude response with a zoomed view around 60 Hz.</p>
<p>(c) Generate a synthetic ECG signal with 60 Hz contamination and demonstrate the filter's effectiveness.</p>
<p>(d) Compute and compare the group delay for Butterworth vs elliptic implementations.</p>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Oppenheim, A. V., &amp; Schafer, R. W. (2010).</strong> <em>Discrete-Time Signal Processing</em> (3rd ed.). Pearson. Chapter 7.</li>
<li><strong>Proakis, J. G., &amp; Manolakis, D. G. (2007).</strong> <em>Digital Signal Processing</em> (4th ed.). Pearson. Chapter 11.</li>
<li><strong>Parks, T. W., &amp; Burrus, C. S. (1987).</strong> <em>Digital Filter Design</em>. Wiley.</li>
<li><strong>Antoniou, A. (2006).</strong> <em>Digital Signal Processing: Signals, Systems, and Filters</em>. McGraw-Hill.</li>
<li><strong>SciPy Documentation</strong> -- Filter design functions: https://docs.scipy.org/doc/scipy/reference/signal.html</li>
<li><strong>Smith, S. W. (1997).</strong> <em>The Scientist and Engineer's Guide to Digital Signal Processing</em>. Available free at http://www.dspguide.com/</li>
</ol>
<hr />
<h2 id="navigation">Navigation<a class="header-link" href="#navigation" title="Permanent link">&para;</a></h2>
<ul>
<li>Previous: <a href="09_FIR_Filter_Design.md">09. FIR Filter Design</a></li>
<li>Next: <a href="11_Multirate_Processing.md">11. Multirate Signal Processing</a></li>
<li><a href="00_Overview.md">Back to Overview</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Signal_Processing/09_FIR_Filter_Design.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">FIR Filter Design</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Signal_Processing/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Signal_Processing/11_Multirate_Processing.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Multirate Signal Processing</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}