{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15. Image Signal Processing - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Signal_Processing/">Signal Processing</a>
    <span class="separator">/</span>
    <span class="current">15. Image Signal Processing</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>15. Image Signal Processing</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Signal_Processing/14_Time_Frequency_Analysis.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">14. Time-Frequency Analysis</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Signal_Processing/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Signal_Processing/16_Applications.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">16. Applications of Signal Processing</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-images-as-2d-signals">1. Images as 2D Signals</a><ul>
<li><a href="#11-digital-image-representation">1.1 Digital Image Representation</a></li>
<li><a href="#12-image-formation">1.2 Image Formation</a></li>
<li><a href="#13-image-properties-from-a-signal-processing-perspective">1.3 Image Properties from a Signal Processing Perspective</a></li>
<li><a href="#14-spatial-frequency">1.4 Spatial Frequency</a></li>
</ul>
</li>
<li><a href="#2-2d-discrete-fourier-transform">2. 2D Discrete Fourier Transform</a><ul>
<li><a href="#21-definition">2.1 Definition</a></li>
<li><a href="#22-separability">2.2 Separability</a></li>
<li><a href="#23-interpreting-the-2d-spectrum">2.3 Interpreting the 2D Spectrum</a></li>
<li><a href="#24-properties-of-the-2d-dft">2.4 Properties of the 2D DFT</a></li>
<li><a href="#25-centering-the-spectrum">2.5 Centering the Spectrum</a></li>
</ul>
</li>
<li><a href="#3-2d-convolution">3. 2D Convolution</a><ul>
<li><a href="#31-definition">3.1 Definition</a></li>
<li><a href="#32-boundary-handling">3.2 Boundary Handling</a></li>
<li><a href="#33-convolution-theorem-in-2d">3.3 Convolution Theorem in 2D</a></li>
</ul>
</li>
<li><a href="#4-spatial-domain-filtering-smoothing">4. Spatial Domain Filtering: Smoothing</a><ul>
<li><a href="#41-averaging-box-filter">4.1 Averaging (Box) Filter</a></li>
<li><a href="#42-gaussian-filter">4.2 Gaussian Filter</a></li>
<li><a href="#43-weighted-averaging">4.3 Weighted Averaging</a></li>
</ul>
</li>
<li><a href="#5-spatial-domain-filtering-sharpening">5. Spatial Domain Filtering: Sharpening</a><ul>
<li><a href="#51-the-laplacian-operator">5.1 The Laplacian Operator</a></li>
<li><a href="#52-laplacian-sharpening">5.2 Laplacian Sharpening</a></li>
<li><a href="#53-unsharp-masking">5.3 Unsharp Masking</a></li>
</ul>
</li>
<li><a href="#6-median-filtering">6. Median Filtering</a><ul>
<li><a href="#61-definition">6.1 Definition</a></li>
<li><a href="#62-properties">6.2 Properties</a></li>
<li><a href="#63-comparison-with-linear-filters">6.3 Comparison with Linear Filters</a></li>
</ul>
</li>
<li><a href="#7-frequency-domain-filtering-lowpass">7. Frequency Domain Filtering: Lowpass</a><ul>
<li><a href="#71-general-procedure">7.1 General Procedure</a></li>
<li><a href="#72-ideal-lowpass-filter">7.2 Ideal Lowpass Filter</a></li>
<li><a href="#73-butterworth-lowpass-filter">7.3 Butterworth Lowpass Filter</a></li>
<li><a href="#74-gaussian-lowpass-filter">7.4 Gaussian Lowpass Filter</a></li>
<li><a href="#75-comparison-of-lowpass-filters">7.5 Comparison of Lowpass Filters</a></li>
</ul>
</li>
<li><a href="#8-frequency-domain-filtering-highpass-and-bandpass">8. Frequency Domain Filtering: Highpass and Bandpass</a><ul>
<li><a href="#81-highpass-filters">8.1 Highpass Filters</a></li>
<li><a href="#82-high-boost-filter-highpass-emphasis">8.2 High-Boost Filter (Highpass Emphasis)</a></li>
<li><a href="#83-bandpass-and-bandstop-notch-filters">8.3 Bandpass and Bandstop (Notch) Filters</a></li>
</ul>
</li>
<li><a href="#9-edge-detection-gradient-operators">9. Edge Detection: Gradient Operators</a><ul>
<li><a href="#91-image-gradient">9.1 Image Gradient</a></li>
<li><a href="#92-sobel-operator">9.2 Sobel Operator</a></li>
<li><a href="#93-prewitt-operator">9.3 Prewitt Operator</a></li>
<li><a href="#94-scharr-operator">9.4 Scharr Operator</a></li>
<li><a href="#95-roberts-cross-operator">9.5 Roberts Cross Operator</a></li>
</ul>
</li>
<li><a href="#10-edge-detection-laplacian-and-log">10. Edge Detection: Laplacian and LoG</a><ul>
<li><a href="#101-laplacian-edge-detection">10.1 Laplacian Edge Detection</a></li>
<li><a href="#102-laplacian-of-gaussian-log">10.2 Laplacian of Gaussian (LoG)</a></li>
<li><a href="#103-difference-of-gaussians-dog">10.3 Difference of Gaussians (DoG)</a></li>
</ul>
</li>
<li><a href="#11-canny-edge-detector">11. Canny Edge Detector</a><ul>
<li><a href="#111-design-criteria">11.1 Design Criteria</a></li>
<li><a href="#112-algorithm-steps">11.2 Algorithm Steps</a></li>
<li><a href="#113-non-maximum-suppression">11.3 Non-Maximum Suppression</a></li>
<li><a href="#114-hysteresis-thresholding">11.4 Hysteresis Thresholding</a></li>
<li><a href="#115-parameter-selection">11.5 Parameter Selection</a></li>
</ul>
</li>
<li><a href="#12-image-enhancement">12. Image Enhancement</a><ul>
<li><a href="#121-histogram">12.1 Histogram</a></li>
<li><a href="#122-histogram-equalization">12.2 Histogram Equalization</a></li>
<li><a href="#123-contrast-limited-adaptive-histogram-equalization-clahe">12.3 Contrast Limited Adaptive Histogram Equalization (CLAHE)</a></li>
<li><a href="#124-contrast-stretching">12.4 Contrast Stretching</a></li>
<li><a href="#125-gamma-correction">12.5 Gamma Correction</a></li>
</ul>
</li>
<li><a href="#13-image-compression-jpeg-overview">13. Image Compression: JPEG Overview</a><ul>
<li><a href="#131-the-jpeg-pipeline">13.1 The JPEG Pipeline</a></li>
<li><a href="#132-color-space-conversion">13.2 Color Space Conversion</a></li>
<li><a href="#133-chroma-subsampling">13.3 Chroma Subsampling</a></li>
<li><a href="#134-the-2d-discrete-cosine-transform-dct">13.4 The 2D Discrete Cosine Transform (DCT)</a></li>
<li><a href="#135-quantization">13.5 Quantization</a></li>
<li><a href="#136-entropy-coding">13.6 Entropy Coding</a></li>
<li><a href="#137-jpeg-artifacts">13.7 JPEG Artifacts</a></li>
</ul>
</li>
<li><a href="#14-sampling-in-2d">14. Sampling in 2D</a><ul>
<li><a href="#141-2d-sampling-theorem">14.1 2D Sampling Theorem</a></li>
<li><a href="#142-aliasing-in-2d">14.2 Aliasing in 2D</a></li>
<li><a href="#143-anti-aliasing">14.3 Anti-Aliasing</a></li>
<li><a href="#144-image-interpolation-upsampling">14.4 Image Interpolation (Upsampling)</a></li>
</ul>
</li>
<li><a href="#15-python-implementation">15. Python Implementation</a><ul>
<li><a href="#151-2d-dft-visualization">15.1 2D DFT Visualization</a></li>
<li><a href="#152-spatial-filtering-smoothing-and-sharpening">15.2 Spatial Filtering: Smoothing and Sharpening</a></li>
<li><a href="#153-frequency-domain-filtering">15.3 Frequency Domain Filtering</a></li>
<li><a href="#154-edge-detection">15.4 Edge Detection</a></li>
<li><a href="#155-histogram-equalization">15.5 Histogram Equalization</a></li>
<li><a href="#156-dct-based-compression-demo">15.6 DCT-Based Compression Demo</a></li>
</ul>
</li>
<li><a href="#16-exercises">16. Exercises</a><ul>
<li><a href="#exercise-1-2d-dft-properties">Exercise 1: 2D DFT Properties</a></li>
<li><a href="#exercise-2-smoothing-filter-comparison">Exercise 2: Smoothing Filter Comparison</a></li>
<li><a href="#exercise-3-frequency-domain-design">Exercise 3: Frequency Domain Design</a></li>
<li><a href="#exercise-4-edge-detection-comparison">Exercise 4: Edge Detection Comparison</a></li>
<li><a href="#exercise-5-histogram-processing">Exercise 5: Histogram Processing</a></li>
<li><a href="#exercise-6-jpeg-compression-analysis">Exercise 6: JPEG Compression Analysis</a></li>
<li><a href="#exercise-7-2d-sampling-and-aliasing">Exercise 7: 2D Sampling and Aliasing</a></li>
</ul>
</li>
<li><a href="#17-summary">17. Summary</a></li>
<li><a href="#18-references">18. References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="15-image-signal-processing">15. Image Signal Processing<a class="header-link" href="#15-image-signal-processing" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./14_Time_Frequency_Analysis.md">14. Time-Frequency Analysis</a> | <strong>Next</strong>: <a href="./16_Applications.md">16. Applications</a></p>
<hr />
<p>An image is a two-dimensional signal: a function of spatial coordinates rather than time. Nearly every concept from 1D signal processing -- convolution, Fourier transforms, filtering, sampling -- has a natural 2D extension. This lesson develops the signal processing foundations of image analysis, covering spatial and frequency domain operations, edge detection, enhancement, and compression. We use NumPy and SciPy throughout, focusing on the underlying signal processing principles rather than high-level computer vision APIs.</p>
<p><strong>Difficulty</strong>: â­â­â­</p>
<p><strong>Prerequisites</strong>: 1D DFT, convolution, FIR filter design, sampling theorem</p>
<p><strong>Learning Objectives</strong>:
- Represent images as 2D discrete signals and understand their sampling structure
- Compute and interpret the 2D Discrete Fourier Transform
- Apply 2D convolution for spatial domain filtering (smoothing, sharpening, median)
- Design and apply frequency domain filters (lowpass, highpass, bandpass)
- Implement gradient-based and Laplacian edge detectors, including the Canny algorithm
- Apply histogram equalization and contrast stretching for image enhancement
- Understand the DCT-based JPEG compression pipeline
- Explain 2D sampling, resolution, and the Nyquist criterion in two dimensions</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-images-as-2d-signals">Images as 2D Signals</a></li>
<li><a href="#2-2d-discrete-fourier-transform">2D Discrete Fourier Transform</a></li>
<li><a href="#3-2d-convolution">2D Convolution</a></li>
<li><a href="#4-spatial-domain-filtering-smoothing">Spatial Domain Filtering: Smoothing</a></li>
<li><a href="#5-spatial-domain-filtering-sharpening">Spatial Domain Filtering: Sharpening</a></li>
<li><a href="#6-median-filtering">Median Filtering</a></li>
<li><a href="#7-frequency-domain-filtering-lowpass">Frequency Domain Filtering: Lowpass</a></li>
<li><a href="#8-frequency-domain-filtering-highpass-and-bandpass">Frequency Domain Filtering: Highpass and Bandpass</a></li>
<li><a href="#9-edge-detection-gradient-operators">Edge Detection: Gradient Operators</a></li>
<li><a href="#10-edge-detection-laplacian-and-log">Edge Detection: Laplacian and LoG</a></li>
<li><a href="#11-canny-edge-detector">Canny Edge Detector</a></li>
<li><a href="#12-image-enhancement">Image Enhancement</a></li>
<li><a href="#13-image-compression-jpeg-overview">Image Compression: JPEG Overview</a></li>
<li><a href="#14-sampling-in-2d">Sampling in 2D</a></li>
<li><a href="#15-python-implementation">Python Implementation</a></li>
<li><a href="#16-exercises">Exercises</a></li>
<li><a href="#17-summary">Summary</a></li>
<li><a href="#18-references">References</a></li>
</ol>
<hr />
<h2 id="1-images-as-2d-signals">1. Images as 2D Signals<a class="header-link" href="#1-images-as-2d-signals" title="Permanent link">&para;</a></h2>
<h3 id="11-digital-image-representation">1.1 Digital Image Representation<a class="header-link" href="#11-digital-image-representation" title="Permanent link">&para;</a></h3>
<p>A grayscale digital image is a 2D function $f[m, n]$ where:
- $m \in \{0, 1, \ldots, M-1\}$ is the row index (vertical coordinate)
- $n \in \{0, 1, \ldots, N-1\}$ is the column index (horizontal coordinate)
- $f[m, n] \in [0, 255]$ for an 8-bit image (0 = black, 255 = white)</p>
<p>A color image has three channels: $f_R[m,n]$, $f_G[m,n]$, $f_B[m,n]$.</p>
<h3 id="12-image-formation">1.2 Image Formation<a class="header-link" href="#12-image-formation" title="Permanent link">&para;</a></h3>
<p>An image results from sampling a continuous light intensity field $f(x, y)$:</p>
<p>$$f[m, n] = f(m \Delta x, n \Delta y)$$</p>
<p>where $\Delta x$ and $\Delta y$ are the spatial sampling intervals. The reciprocals $1/\Delta x$ and $1/\Delta y$ are the spatial sampling frequencies.</p>
<h3 id="13-image-properties-from-a-signal-processing-perspective">1.3 Image Properties from a Signal Processing Perspective<a class="header-link" href="#13-image-properties-from-a-signal-processing-perspective" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>1D Signal</th>
<th>2D Image</th>
</tr>
</thead>
<tbody>
<tr>
<td>Independent variable</td>
<td>Time $t$</td>
<td>Spatial coordinates $(x, y)$</td>
</tr>
<tr>
<td>Sampling</td>
<td>Temporal sampling rate $f_s$</td>
<td>Spatial resolution (pixels per unit length)</td>
</tr>
<tr>
<td>Frequency</td>
<td>Temporal frequency (Hz)</td>
<td>Spatial frequency (cycles/pixel or cycles/mm)</td>
</tr>
<tr>
<td>Filtering</td>
<td>Temporal filters</td>
<td>Spatial filters (kernels)</td>
</tr>
<tr>
<td>Transform</td>
<td>1D DFT</td>
<td>2D DFT</td>
</tr>
</tbody>
</table>
<h3 id="14-spatial-frequency">1.4 Spatial Frequency<a class="header-link" href="#14-spatial-frequency" title="Permanent link">&para;</a></h3>
<p>Spatial frequency describes how rapidly pixel values change across the image:
- <strong>Low spatial frequencies</strong>: Smooth regions, gradual intensity changes (sky, walls)
- <strong>High spatial frequencies</strong>: Edges, textures, fine details (hair, text, noise)</p>
<p>A sinusoidal pattern in an image: $f[m,n] = \cos(2\pi u_0 m + 2\pi v_0 n)$ has spatial frequencies $u_0$ (vertical, cycles/pixel) and $v_0$ (horizontal, cycles/pixel).</p>
<hr />
<h2 id="2-2d-discrete-fourier-transform">2. 2D Discrete Fourier Transform<a class="header-link" href="#2-2d-discrete-fourier-transform" title="Permanent link">&para;</a></h2>
<h3 id="21-definition">2.1 Definition<a class="header-link" href="#21-definition" title="Permanent link">&para;</a></h3>
<p>The <strong>2D DFT</strong> of an $M \times N$ image $f[m, n]$ is:</p>
<p>$$\boxed{F[k, l] = \sum_{m=0}^{M-1} \sum_{n=0}^{N-1} f[m, n] \, e^{-j2\pi(km/M + ln/N)}}$$</p>
<p>where $k \in \{0, \ldots, M-1\}$ and $l \in \{0, \ldots, N-1\}$.</p>
<p>The <strong>inverse 2D DFT</strong> is:</p>
<p>$$f[m, n] = \frac{1}{MN} \sum_{k=0}^{M-1} \sum_{l=0}^{N-1} F[k, l] \, e^{j2\pi(km/M + ln/N)}$$</p>
<h3 id="22-separability">2.2 Separability<a class="header-link" href="#22-separability" title="Permanent link">&para;</a></h3>
<p>The 2D DFT is <strong>separable</strong>: it can be computed as 1D DFTs along rows followed by 1D DFTs along columns (or vice versa):</p>
<p>$$F[k, l] = \sum_{m=0}^{M-1} \left(\sum_{n=0}^{N-1} f[m,n] \, e^{-j2\pi ln/N}\right) e^{-j2\pi km/M}$$</p>
<p>This reduces the complexity from $O(M^2 N^2)$ to $O(MN(\log M + \log N))$ using the FFT.</p>
<h3 id="23-interpreting-the-2d-spectrum">2.3 Interpreting the 2D Spectrum<a class="header-link" href="#23-interpreting-the-2d-spectrum" title="Permanent link">&para;</a></h3>
<p>The magnitude $|F[k,l]|$ shows the strength of each spatial frequency component:
- <strong>Center</strong> ($k = 0, l = 0$): DC component (average intensity)
- <strong>Horizontal axis</strong> ($k = 0$): Horizontal frequency components
- <strong>Vertical axis</strong> ($l = 0$): Vertical frequency components
- <strong>Diagonal</strong>: Diagonal frequency components
- <strong>Distance from center</strong>: Overall spatial frequency magnitude</p>
<p>The phase $\angle F[k,l]$ encodes the spatial position of features. Remarkably, the phase often carries more perceptual information than the magnitude.</p>
<h3 id="24-properties-of-the-2d-dft">2.4 Properties of the 2D DFT<a class="header-link" href="#24-properties-of-the-2d-dft" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Spatial Domain</th>
<th>Frequency Domain</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linearity</td>
<td>$af_1 + bf_2$</td>
<td>$aF_1 + bF_2$</td>
</tr>
<tr>
<td>Shift</td>
<td>$f[m-m_0, n-n_0]$</td>
<td>$F[k,l] \, e^{-j2\pi(km_0/M + ln_0/N)}$</td>
</tr>
<tr>
<td>Convolution</td>
<td>$f * g$</td>
<td>$F \cdot G$</td>
</tr>
<tr>
<td>Correlation</td>
<td>$f \star g$</td>
<td>$F^* \cdot G$</td>
</tr>
<tr>
<td>Parseval's</td>
<td>$\sum|f|^2 = \frac{1}{MN}\sum|F|^2$</td>
<td>(Energy conservation)</td>
</tr>
<tr>
<td>Conjugate symmetry</td>
<td>$f$ real</td>
<td>$F[k,l] = F^*[-k,-l]$</td>
</tr>
</tbody>
</table>
<h3 id="25-centering-the-spectrum">2.5 Centering the Spectrum<a class="header-link" href="#25-centering-the-spectrum" title="Permanent link">&para;</a></h3>
<p>By default, <code>np.fft.fft2</code> places the DC component at corner $(0,0)$. To center it (for visualization), use <code>np.fft.fftshift</code>, which swaps quadrants. Equivalently, multiply the spatial image by $(-1)^{m+n}$ before the DFT.</p>
<hr />
<h2 id="3-2d-convolution">3. 2D Convolution<a class="header-link" href="#3-2d-convolution" title="Permanent link">&para;</a></h2>
<h3 id="31-definition">3.1 Definition<a class="header-link" href="#31-definition" title="Permanent link">&para;</a></h3>
<p>The 2D discrete convolution of image $f[m,n]$ with kernel $h[m,n]$ (size $K \times L$) is:</p>
<p>$$\boxed{g[m, n] = (f * h)[m, n] = \sum_{i=0}^{K-1} \sum_{j=0}^{L-1} f[m-i, n-j] \, h[i, j]}$$</p>
<p>In practice, we usually use <strong>correlation</strong> (flipped kernel), which is equivalent to convolution for symmetric kernels:</p>
<p>$$(f \star h)[m, n] = \sum_{i=0}^{K-1} \sum_{j=0}^{L-1} f[m+i-K/2, n+j-L/2] \, h[i, j]$$</p>
<h3 id="32-boundary-handling">3.2 Boundary Handling<a class="header-link" href="#32-boundary-handling" title="Permanent link">&para;</a></h3>
<p>When the kernel extends beyond the image boundary, we must handle the edges:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zero-padding</td>
<td>Assume 0 outside</td>
<td>Dark borders</td>
</tr>
<tr>
<td>Reflect</td>
<td>Mirror the image</td>
<td>Natural-looking</td>
</tr>
<tr>
<td>Wrap</td>
<td>Periodic extension</td>
<td>Circular convolution</td>
</tr>
<tr>
<td>Replicate</td>
<td>Extend edge pixels</td>
<td>Minimal artifacts</td>
</tr>
<tr>
<td>Crop</td>
<td>Output only valid region</td>
<td>Smaller output</td>
</tr>
</tbody>
</table>
<h3 id="33-convolution-theorem-in-2d">3.3 Convolution Theorem in 2D<a class="header-link" href="#33-convolution-theorem-in-2d" title="Permanent link">&para;</a></h3>
<p>$$f * h \xleftrightarrow{\text{DFT}} F \cdot H$$</p>
<p>Frequency domain filtering is efficient for large kernels:
- <strong>Spatial convolution</strong>: $O(MN \cdot KL)$ operations
- <strong>Frequency domain</strong>: $O(MN \log(MN))$ (FFT + pointwise multiply + IFFT)</p>
<p>Frequency domain filtering is faster when $KL > \log(MN)$.</p>
<hr />
<h2 id="4-spatial-domain-filtering-smoothing">4. Spatial Domain Filtering: Smoothing<a class="header-link" href="#4-spatial-domain-filtering-smoothing" title="Permanent link">&para;</a></h2>
<h3 id="41-averaging-box-filter">4.1 Averaging (Box) Filter<a class="header-link" href="#41-averaging-box-filter" title="Permanent link">&para;</a></h3>
<p>The simplest smoothing filter replaces each pixel with the average of its neighbors:</p>
<p>$$h_{avg} = \frac{1}{K^2} \begin{bmatrix} 1 & 1 & \cdots & 1 \\ 1 & 1 & \cdots & 1 \\ \vdots & & & \vdots \\ 1 & 1 & \cdots & 1 \end{bmatrix}_{K \times K}$$</p>
<p>For $3 \times 3$:
$$h_{3\times3} = \frac{1}{9}\begin{bmatrix} 1 & 1 & 1 \\ 1 & 1 & 1 \\ 1 & 1 & 1 \end{bmatrix}$$</p>
<p><strong>Effect</strong>: Blurs the image, reduces noise, but also blurs edges.</p>
<p><strong>Frequency response</strong>: The 2D box filter is a 2D sinc function in the frequency domain -- it has significant sidelobe leakage.</p>
<h3 id="42-gaussian-filter">4.2 Gaussian Filter<a class="header-link" href="#42-gaussian-filter" title="Permanent link">&para;</a></h3>
<p>A better smoothing filter uses a 2D Gaussian kernel:</p>
<p>$$h_{Gauss}[m, n] = \frac{1}{2\pi\sigma^2} \exp\!\left(-\frac{m^2 + n^2}{2\sigma^2}\right)$$</p>
<p>The Gaussian filter is:
- <strong>Separable</strong>: $h[m,n] = g[m] \cdot g[n]$ where $g[k] = \exp(-k^2/(2\sigma^2))$
- <strong>Isotropic</strong>: Same smoothing in all directions
- <strong>No ringing</strong>: Gaussian in frequency domain too (no sidelobes)
- <strong>Optimal</strong>: Minimizes the space-frequency uncertainty product</p>
<p><strong>Separability</strong> reduces computation from $O(K^2)$ to $O(2K)$ per pixel.</p>
<p>Common kernel sizes: $\sigma = 1 \to 5 \times 5$, $\sigma = 2 \to 9 \times 9$ (choose size $\geq 6\sigma + 1$).</p>
<h3 id="43-weighted-averaging">4.3 Weighted Averaging<a class="header-link" href="#43-weighted-averaging" title="Permanent link">&para;</a></h3>
<p>A compromise between box and Gaussian:</p>
<p>$$h_{weighted} = \frac{1}{16}\begin{bmatrix} 1 & 2 & 1 \\ 2 & 4 & 2 \\ 1 & 2 & 1 \end{bmatrix}$$</p>
<p>This is an approximation to a Gaussian with $\sigma \approx 0.85$.</p>
<hr />
<h2 id="5-spatial-domain-filtering-sharpening">5. Spatial Domain Filtering: Sharpening<a class="header-link" href="#5-spatial-domain-filtering-sharpening" title="Permanent link">&para;</a></h2>
<h3 id="51-the-laplacian-operator">5.1 The Laplacian Operator<a class="header-link" href="#51-the-laplacian-operator" title="Permanent link">&para;</a></h3>
<p>The <strong>Laplacian</strong> is a second-order derivative operator that highlights regions of rapid intensity change:</p>
<p>$$\nabla^2 f = \frac{\partial^2 f}{\partial x^2} + \frac{\partial^2 f}{\partial y^2}$$</p>
<p>Discrete approximation (4-connected):
$$\nabla^2 f[m,n] \approx f[m+1,n] + f[m-1,n] + f[m,n+1] + f[m,n-1] - 4f[m,n]$$</p>
<p>Kernel:
$$h_{Lap4} = \begin{bmatrix} 0 & 1 & 0 \\ 1 & -4 & 1 \\ 0 & 1 & 0 \end{bmatrix}$$</p>
<p>Including diagonals (8-connected):
$$h_{Lap8} = \begin{bmatrix} 1 & 1 & 1 \\ 1 & -8 & 1 \\ 1 & 1 & 1 \end{bmatrix}$$</p>
<h3 id="52-laplacian-sharpening">5.2 Laplacian Sharpening<a class="header-link" href="#52-laplacian-sharpening" title="Permanent link">&para;</a></h3>
<p>Sharpening is achieved by subtracting the Laplacian from the original image:</p>
<p>$$g[m,n] = f[m,n] - c \cdot \nabla^2 f[m,n]$$</p>
<p>where $c > 0$ controls the sharpening strength. The combined kernel for $c = 1$ (4-connected Laplacian):</p>
<p>$$h_{sharp} = \begin{bmatrix} 0 & -1 & 0 \\ -1 & 5 & -1 \\ 0 & -1 & 0 \end{bmatrix}$$</p>
<h3 id="53-unsharp-masking">5.3 Unsharp Masking<a class="header-link" href="#53-unsharp-masking" title="Permanent link">&para;</a></h3>
<p>A classic technique from photography:</p>
<ol>
<li>Blur the image: $f_{blur} = f * h_{Gauss}$</li>
<li>Compute the "unsharp mask": $\text{mask} = f - f_{blur}$</li>
<li>Add a scaled mask back: $g = f + k \cdot \text{mask}$</li>
</ol>
<p>where $k > 0$ is the sharpening factor.</p>
<p>$$g = (1 + k) f - k (f * h_{Gauss}) = f + k(f - f * h_{Gauss})$$</p>
<p>In the frequency domain: $G = F + k(F - F \cdot H_{Gauss}) = F(1 + k - kH_{Gauss})$</p>
<p>This is a <strong>highpass emphasis filter</strong>: it boosts high frequencies while leaving the DC component unchanged.</p>
<hr />
<h2 id="6-median-filtering">6. Median Filtering<a class="header-link" href="#6-median-filtering" title="Permanent link">&para;</a></h2>
<h3 id="61-definition">6.1 Definition<a class="header-link" href="#61-definition" title="Permanent link">&para;</a></h3>
<p>The <strong>median filter</strong> replaces each pixel with the median of pixel values in a local neighborhood:</p>
<p>$$g[m,n] = \text{median}\{f[m+i, n+j] : (i,j) \in \mathcal{W}\}$$</p>
<p>where $\mathcal{W}$ is the filter window (typically $3 \times 3$ or $5 \times 5$).</p>
<h3 id="62-properties">6.2 Properties<a class="header-link" href="#62-properties" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Non-linear</strong>: Cannot be expressed as a convolution</li>
<li><strong>Edge-preserving</strong>: Smooths noise while maintaining sharp edges</li>
<li><strong>Excellent for impulse noise</strong>: Removes salt-and-pepper noise completely</li>
<li><strong>Rank-order filter</strong>: Special case of the more general class of order-statistic filters</li>
</ul>
<h3 id="63-comparison-with-linear-filters">6.3 Comparison with Linear Filters<a class="header-link" href="#63-comparison-with-linear-filters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Gaussian Filter</th>
<th>Median Filter</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td>Linear</td>
<td>Non-linear</td>
</tr>
<tr>
<td>Gaussian noise</td>
<td>Good</td>
<td>Fair</td>
</tr>
<tr>
<td>Salt-and-pepper noise</td>
<td>Poor (blurs spikes)</td>
<td>Excellent (removes spikes)</td>
</tr>
<tr>
<td>Edge preservation</td>
<td>Blurs edges</td>
<td>Preserves edges</td>
</tr>
<tr>
<td>Computation</td>
<td>$O(K^2)$ per pixel</td>
<td>$O(K^2 \log K)$ per pixel (sorting)</td>
</tr>
<tr>
<td>Frequency domain</td>
<td>Lowpass (Gaussian)</td>
<td>No simple frequency interpretation</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="7-frequency-domain-filtering-lowpass">7. Frequency Domain Filtering: Lowpass<a class="header-link" href="#7-frequency-domain-filtering-lowpass" title="Permanent link">&para;</a></h2>
<h3 id="71-general-procedure">7.1 General Procedure<a class="header-link" href="#71-general-procedure" title="Permanent link">&para;</a></h3>
<ol>
<li>Compute 2D DFT: $F = \text{FFT2}(f)$</li>
<li>Center the spectrum: $F_c = \text{fftshift}(F)$</li>
<li>Multiply by filter: $G_c = F_c \cdot H$</li>
<li>Un-center: $G = \text{ifftshift}(G_c)$</li>
<li>Inverse DFT: $g = \text{IFFT2}(G)$</li>
</ol>
<h3 id="72-ideal-lowpass-filter">7.2 Ideal Lowpass Filter<a class="header-link" href="#72-ideal-lowpass-filter" title="Permanent link">&para;</a></h3>
<p>$$H_{ideal}[k, l] = \begin{cases} 1 & \sqrt{k^2 + l^2} \leq D_0 \\ 0 & \text{otherwise} \end{cases}$$</p>
<p>where $D_0$ is the cutoff frequency (in pixels from center).</p>
<p><strong>Problem</strong>: The ideal filter has infinite spatial extent (2D sinc), causing <strong>ringing artifacts</strong> (Gibbs phenomenon).</p>
<h3 id="73-butterworth-lowpass-filter">7.3 Butterworth Lowpass Filter<a class="header-link" href="#73-butterworth-lowpass-filter" title="Permanent link">&para;</a></h3>
<p>$$H_{Butter}[k, l] = \frac{1}{1 + \left(\frac{D(k,l)}{D_0}\right)^{2n}}$$</p>
<p>where $D(k,l) = \sqrt{k^2 + l^2}$ is the distance from the center and $n$ is the filter order.</p>
<ul>
<li>$n = 1$: Gentle rolloff, minimal ringing</li>
<li>$n = 2$: Good tradeoff (commonly used)</li>
<li>$n \to \infty$: Approaches ideal filter</li>
</ul>
<h3 id="74-gaussian-lowpass-filter">7.4 Gaussian Lowpass Filter<a class="header-link" href="#74-gaussian-lowpass-filter" title="Permanent link">&para;</a></h3>
<p>$$H_{Gauss}[k, l] = \exp\!\left(-\frac{D(k,l)^2}{2D_0^2}\right)$$</p>
<p><strong>Properties</strong>:
- No ringing (Gaussian in frequency $\to$ Gaussian in space)
- Smooth rolloff
- $D_0$ corresponds to the frequency where $H = e^{-1/2} \approx 0.607$</p>
<h3 id="75-comparison-of-lowpass-filters">7.5 Comparison of Lowpass Filters<a class="header-link" href="#75-comparison-of-lowpass-filters" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>|H(D)|
  1 â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚    Ideal â”€â”€â”€â”€â”€â”€â”˜
  â”‚    Butter(n=2) â”€â”€â”€â”€â”€â•²
  â”‚    Gaussian â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
  â”‚                         â•²
  0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ D
                   Dâ‚€
</code></pre></div>

<p>The Gaussian filter provides the smoothest spatial response (no ringing) at the cost of the least sharp frequency cutoff.</p>
<hr />
<h2 id="8-frequency-domain-filtering-highpass-and-bandpass">8. Frequency Domain Filtering: Highpass and Bandpass<a class="header-link" href="#8-frequency-domain-filtering-highpass-and-bandpass" title="Permanent link">&para;</a></h2>
<h3 id="81-highpass-filters">8.1 Highpass Filters<a class="header-link" href="#81-highpass-filters" title="Permanent link">&para;</a></h3>
<p>A highpass filter is the complement of a lowpass filter:</p>
<p>$$H_{HP}(k, l) = 1 - H_{LP}(k, l)$$</p>
<p>Highpass filtering preserves edges and fine detail while removing smooth, slowly varying regions.</p>
<p><strong>Ideal highpass</strong>:
$$H_{ideal,HP}[k,l] = \begin{cases} 0 & D(k,l) \leq D_0 \\ 1 & D(k,l) > D_0 \end{cases}$$</p>
<p><strong>Gaussian highpass</strong>:
$$H_{Gauss,HP}[k,l] = 1 - \exp\!\left(-\frac{D(k,l)^2}{2D_0^2}\right)$$</p>
<h3 id="82-high-boost-filter-highpass-emphasis">8.2 High-Boost Filter (Highpass Emphasis)<a class="header-link" href="#82-high-boost-filter-highpass-emphasis" title="Permanent link">&para;</a></h3>
<p>To retain some of the low-frequency content:</p>
<p>$$H_{boost} = a + (1-a) \cdot H_{HP} = a \cdot H_{LP} + H_{HP}$$</p>
<p>For $a > 1$: emphasizes high frequencies while preserving the overall image.</p>
<p>This is equivalent to unsharp masking in the frequency domain.</p>
<h3 id="83-bandpass-and-bandstop-notch-filters">8.3 Bandpass and Bandstop (Notch) Filters<a class="header-link" href="#83-bandpass-and-bandstop-notch-filters" title="Permanent link">&para;</a></h3>
<p><strong>Bandpass filter</strong> passes frequencies in a ring between $D_1$ and $D_2$:</p>
<p>$$H_{BP}[k,l] = \begin{cases} 1 & D_1 \leq D(k,l) \leq D_2 \\ 0 & \text{otherwise} \end{cases}$$</p>
<p><strong>Notch filter</strong> removes specific frequency components (useful for removing periodic noise patterns):</p>
<p>$$H_{notch}[k,l] = \prod_{i=1}^{Q} \frac{1}{1 + \left(\frac{D_{0i}}{D_i(k,l)}\right)^{2n}}$$</p>
<p>where $D_i(k,l)$ is the distance from the $i$-th notch center.</p>
<p><strong>Application</strong>: Removing periodic interference patterns (e.g., moire patterns, scanning artifacts).</p>
<hr />
<h2 id="9-edge-detection-gradient-operators">9. Edge Detection: Gradient Operators<a class="header-link" href="#9-edge-detection-gradient-operators" title="Permanent link">&para;</a></h2>
<h3 id="91-image-gradient">9.1 Image Gradient<a class="header-link" href="#91-image-gradient" title="Permanent link">&para;</a></h3>
<p>The gradient of a 2D image $f(x,y)$ is:</p>
<p>$$\nabla f = \begin{bmatrix} \frac{\partial f}{\partial x} \\ \frac{\partial f}{\partial y} \end{bmatrix} = \begin{bmatrix} G_x \\ G_y \end{bmatrix}$$</p>
<p>The <strong>gradient magnitude</strong> gives edge strength:
$$|\nabla f| = \sqrt{G_x^2 + G_y^2} \approx |G_x| + |G_y|$$</p>
<p>The <strong>gradient direction</strong> gives edge orientation:
$$\theta = \arctan\!\left(\frac{G_y}{G_x}\right)$$</p>
<h3 id="92-sobel-operator">9.2 Sobel Operator<a class="header-link" href="#92-sobel-operator" title="Permanent link">&para;</a></h3>
<p>The Sobel operator computes smoothed gradient estimates:</p>
<p>$$G_x = h_x * f = \begin{bmatrix} -1 & 0 & 1 \\ -2 & 0 & 2 \\ -1 & 0 & 1 \end{bmatrix} * f$$</p>
<p>$$G_y = h_y * f = \begin{bmatrix} -1 & -2 & -1 \\ 0 & 0 & 0 \\ 1 & 2 & 1 \end{bmatrix} * f$$</p>
<p><strong>Design rationale</strong>: The Sobel kernel is separable: $h_x = \begin{bmatrix}1\\2\\1\end{bmatrix} \begin{bmatrix}-1&0&1\end{bmatrix}$. The first factor smooths in the $y$-direction, and the second computes the derivative in the $x$-direction. The smoothing reduces noise sensitivity.</p>
<h3 id="93-prewitt-operator">9.3 Prewitt Operator<a class="header-link" href="#93-prewitt-operator" title="Permanent link">&para;</a></h3>
<p>Similar to Sobel but with uniform weighting:</p>
<p>$$G_x = \begin{bmatrix} -1 & 0 & 1 \\ -1 & 0 & 1 \\ -1 & 0 & 1 \end{bmatrix} * f, \qquad G_y = \begin{bmatrix} -1 & -1 & -1 \\ 0 & 0 & 0 \\ 1 & 1 & 1 \end{bmatrix} * f$$</p>
<h3 id="94-scharr-operator">9.4 Scharr Operator<a class="header-link" href="#94-scharr-operator" title="Permanent link">&para;</a></h3>
<p>An improved gradient approximation with better rotational symmetry:</p>
<p>$$G_x = \begin{bmatrix} -3 & 0 & 3 \\ -10 & 0 & 10 \\ -3 & 0 & 3 \end{bmatrix} * f$$</p>
<h3 id="95-roberts-cross-operator">9.5 Roberts Cross Operator<a class="header-link" href="#95-roberts-cross-operator" title="Permanent link">&para;</a></h3>
<p>The simplest gradient operator, using $2 \times 2$ kernels:</p>
<p>$$G_x = \begin{bmatrix} 1 & 0 \\ 0 & -1 \end{bmatrix} * f, \qquad G_y = \begin{bmatrix} 0 & 1 \\ -1 & 0 \end{bmatrix} * f$$</p>
<p>Sensitive to noise due to the small kernel size.</p>
<hr />
<h2 id="10-edge-detection-laplacian-and-log">10. Edge Detection: Laplacian and LoG<a class="header-link" href="#10-edge-detection-laplacian-and-log" title="Permanent link">&para;</a></h2>
<h3 id="101-laplacian-edge-detection">10.1 Laplacian Edge Detection<a class="header-link" href="#101-laplacian-edge-detection" title="Permanent link">&para;</a></h3>
<p>The Laplacian detects edges as <strong>zero crossings</strong> of the second derivative:</p>
<p>$$\nabla^2 f = \frac{\partial^2 f}{\partial x^2} + \frac{\partial^2 f}{\partial y^2}$$</p>
<p>At an edge: the first derivative has a peak, and the second derivative crosses zero.</p>
<p><strong>Advantages</strong>: Isotropic (detects edges in all directions equally).</p>
<p><strong>Disadvantages</strong>: Highly sensitive to noise (amplifies high-frequency noise even more than first-order operators).</p>
<h3 id="102-laplacian-of-gaussian-log">10.2 Laplacian of Gaussian (LoG)<a class="header-link" href="#102-laplacian-of-gaussian-log" title="Permanent link">&para;</a></h3>
<p>To mitigate noise sensitivity, first smooth with a Gaussian, then apply the Laplacian:</p>
<p>$$\text{LoG}(x, y) = \nabla^2 [G_\sigma * f] = [\nabla^2 G_\sigma] * f$$</p>
<p>The LoG kernel (also called the "Mexican hat" in 1D) is:</p>
<p>$$\text{LoG}(x, y) = -\frac{1}{\pi\sigma^4}\left[1 - \frac{x^2 + y^2}{2\sigma^2}\right] \exp\!\left(-\frac{x^2 + y^2}{2\sigma^2}\right)$$</p>
<p><strong>Marr-Hildreth edge detector</strong>: Find zero crossings of $\text{LoG} * f$.</p>
<h3 id="103-difference-of-gaussians-dog">10.3 Difference of Gaussians (DoG)<a class="header-link" href="#103-difference-of-gaussians-dog" title="Permanent link">&para;</a></h3>
<p>An efficient approximation to the LoG:</p>
<p>$$\text{DoG}(x,y) = G_{\sigma_1}(x,y) - G_{\sigma_2}(x,y) \approx (\sigma_2 - \sigma_1) \cdot \nabla^2 G_{\bar{\sigma}}$$</p>
<p>Typically $\sigma_2 / \sigma_1 \approx 1.6$. The DoG is the basis of the SIFT feature detector.</p>
<hr />
<h2 id="11-canny-edge-detector">11. Canny Edge Detector<a class="header-link" href="#11-canny-edge-detector" title="Permanent link">&para;</a></h2>
<h3 id="111-design-criteria">11.1 Design Criteria<a class="header-link" href="#111-design-criteria" title="Permanent link">&para;</a></h3>
<p>John Canny (1986) formulated edge detection as an optimization problem with three criteria:</p>
<ol>
<li><strong>Good detection</strong>: Low probability of missing real edges and low probability of false edges</li>
<li><strong>Good localization</strong>: Detected edges should be as close as possible to the true edges</li>
<li><strong>Single response</strong>: Only one response per edge (no multiple detections)</li>
</ol>
<h3 id="112-algorithm-steps">11.2 Algorithm Steps<a class="header-link" href="#112-algorithm-steps" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Step 1: Gaussian smoothing
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
f_smooth = f <span class="gs">* G_Ïƒ</span>

<span class="gs">Step 2: Gradient computation (Sobel)</span>
<span class="gs">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="gs">G_x = h_x *</span> f_smooth
G_y = h_y * f_smooth
Magnitude = sqrt(G_xÂ² + G_yÂ²)
Direction Î¸ = atan2(G_y, G_x)

Step 3: Non-maximum suppression
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
For each pixel:
  <span class="k">-</span> Quantize Î¸ to 0Â°, 45Â°, 90Â°, 135Â°
  <span class="k">-</span> Compare magnitude with neighbors along gradient direction
  <span class="k">-</span> Suppress (set to 0) if not a local maximum

Step 4: Double thresholding
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Strong edges:  magnitude &gt; T_high
Weak edges:    T_low &lt; magnitude â‰¤ T_high
Non-edges:     magnitude â‰¤ T_low

Step 5: Edge tracking by hysteresis
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<span class="k">-</span> Strong edges are always edges
<span class="k">-</span> Weak edges are edges only if connected to a strong edge
<span class="k">-</span> Non-edges are discarded
</code></pre></div>

<h3 id="113-non-maximum-suppression">11.3 Non-Maximum Suppression<a class="header-link" href="#113-non-maximum-suppression" title="Permanent link">&para;</a></h3>
<p>This step thins the edges to 1-pixel width by suppressing pixels that are not the local maximum along the gradient direction:</p>
<div class="highlight"><pre><span></span><code>Gradient direction:          Neighbors to compare:
       0Â° (horizontal)       left, right
      45Â° (diagonal)         upper-right, lower-left
      90Â° (vertical)         above, below
     135Â° (anti-diagonal)    upper-left, lower-right
</code></pre></div>

<h3 id="114-hysteresis-thresholding">11.4 Hysteresis Thresholding<a class="header-link" href="#114-hysteresis-thresholding" title="Permanent link">&para;</a></h3>
<p>Using two thresholds ($T_{low}$ and $T_{high}$, typically $T_{low} = 0.4 T_{high}$) prevents:
- Broken edges (that a single high threshold would cause)
- Excessive false edges (that a single low threshold would cause)</p>
<p>The hysteresis step connects weak edge pixels to strong edge pixels using connectivity analysis (e.g., BFS or DFS).</p>
<h3 id="115-parameter-selection">11.5 Parameter Selection<a class="header-link" href="#115-parameter-selection" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Effect</th>
<th>Typical Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\sigma$ (Gaussian)</td>
<td>Noise suppression vs edge localization</td>
<td>1.0 - 3.0</td>
</tr>
<tr>
<td>$T_{high}$</td>
<td>Strong edge threshold</td>
<td>70th-90th percentile of gradient</td>
</tr>
<tr>
<td>$T_{low}$</td>
<td>Weak edge threshold</td>
<td>$0.3 T_{high}$ to $0.5 T_{high}$</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="12-image-enhancement">12. Image Enhancement<a class="header-link" href="#12-image-enhancement" title="Permanent link">&para;</a></h2>
<h3 id="121-histogram">12.1 Histogram<a class="header-link" href="#121-histogram" title="Permanent link">&para;</a></h3>
<p>The <strong>histogram</strong> of an image counts the number of pixels at each intensity level:</p>
<p>$$h[k] = \text{number of pixels with intensity } k, \quad k = 0, 1, \ldots, L-1$$</p>
<p>The <strong>normalized histogram</strong> (probability mass function):</p>
<p>$$p[k] = \frac{h[k]}{M \cdot N}$$</p>
<h3 id="122-histogram-equalization">12.2 Histogram Equalization<a class="header-link" href="#122-histogram-equalization" title="Permanent link">&para;</a></h3>
<p>Histogram equalization redistributes pixel intensities to achieve a (approximately) uniform histogram, maximizing contrast.</p>
<p><strong>Continuous case</strong>: The transformation $s = T(r)$ that produces a uniform distribution is:</p>
<p>$$s = T(r) = \int_0^r p_r(\rho) \, d\rho = \text{CDF}(r)$$</p>
<p><strong>Discrete case</strong>: For an $L$-level image:</p>
<p>$$s_k = T(r_k) = (L-1) \sum_{j=0}^{k} p[j] = (L-1) \cdot \text{CDF}[k]$$</p>
<p><strong>Algorithm</strong>:
1. Compute the histogram $h[k]$
2. Compute the CDF: $\text{CDF}[k] = \sum_{j=0}^{k} p[j]$
3. Map each pixel: $f_{eq}[m,n] = \text{round}((L-1) \cdot \text{CDF}[f[m,n]])$</p>
<h3 id="123-contrast-limited-adaptive-histogram-equalization-clahe">12.3 Contrast Limited Adaptive Histogram Equalization (CLAHE)<a class="header-link" href="#123-contrast-limited-adaptive-histogram-equalization-clahe" title="Permanent link">&para;</a></h3>
<p>Global histogram equalization can over-enhance noise in smooth regions. CLAHE addresses this by:</p>
<ol>
<li>Dividing the image into small tiles (e.g., $8 \times 8$)</li>
<li>Applying histogram equalization to each tile with a <strong>clip limit</strong> that caps the histogram (redistributing excess counts)</li>
<li>Interpolating between tiles for seamless results</li>
</ol>
<h3 id="124-contrast-stretching">12.4 Contrast Stretching<a class="header-link" href="#124-contrast-stretching" title="Permanent link">&para;</a></h3>
<p><strong>Linear contrast stretching</strong> maps the intensity range $[r_{min}, r_{max}]$ to the full range $[0, L-1]$:</p>
<p>$$s = \frac{L-1}{r_{max} - r_{min}} (r - r_{min})$$</p>
<p><strong>Percentile-based stretching</strong>: Use the 2nd and 98th percentiles instead of min/max to avoid outlier influence.</p>
<h3 id="125-gamma-correction">12.5 Gamma Correction<a class="header-link" href="#125-gamma-correction" title="Permanent link">&para;</a></h3>
<p>A power-law transformation:</p>
<p>$$s = c \cdot r^\gamma$$</p>
<ul>
<li>$\gamma < 1$: Brightens dark regions (expands dark tones)</li>
<li>$\gamma = 1$: No change</li>
<li>$\gamma > 1$: Darkens bright regions (expands bright tones)</li>
</ul>
<hr />
<h2 id="13-image-compression-jpeg-overview">13. Image Compression: JPEG Overview<a class="header-link" href="#13-image-compression-jpeg-overview" title="Permanent link">&para;</a></h2>
<h3 id="131-the-jpeg-pipeline">13.1 The JPEG Pipeline<a class="header-link" href="#131-the-jpeg-pipeline" title="Permanent link">&para;</a></h3>
<p>JPEG (Joint Photographic Experts Group) is the most widely used image compression standard. It exploits two properties:
1. <strong>Spatial redundancy</strong>: Nearby pixels are correlated
2. <strong>Psychovisual redundancy</strong>: Humans are less sensitive to high-frequency detail</p>
<div class="highlight"><pre><span></span><code>JPEG Encoding Pipeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

RGB â†’ YCbCr â†’ Chroma    â†’ 8Ã—8 Block â†’ DCT â†’ Quantize â†’ Entropy
              Subsampling  Partition              â†“       Encoding
                                             Q-Table     (Huffman
                                                          or
                                                          Arithmetic)
</code></pre></div>

<h3 id="132-color-space-conversion">13.2 Color Space Conversion<a class="header-link" href="#132-color-space-conversion" title="Permanent link">&para;</a></h3>
<p>Convert from RGB to YCbCr:
- <strong>Y</strong>: Luminance (brightness) -- the most important component
- <strong>Cb</strong>: Blue-difference chrominance
- <strong>Cr</strong>: Red-difference chrominance</p>
<p>$$\begin{bmatrix} Y \\ C_b \\ C_r \end{bmatrix} = \begin{bmatrix} 0.299 & 0.587 & 0.114 \\ -0.169 & -0.331 & 0.500 \\ 0.500 & -0.419 & -0.081 \end{bmatrix} \begin{bmatrix} R \\ G \\ B \end{bmatrix} + \begin{bmatrix} 0 \\ 128 \\ 128 \end{bmatrix}$$</p>
<h3 id="133-chroma-subsampling">13.3 Chroma Subsampling<a class="header-link" href="#133-chroma-subsampling" title="Permanent link">&para;</a></h3>
<p>Human vision has lower spatial resolution for color than for brightness. JPEG exploits this by subsampling the chrominance channels:
- <strong>4:4:4</strong>: No subsampling (full resolution)
- <strong>4:2:2</strong>: Horizontal subsampling by 2
- <strong>4:2:0</strong>: Both horizontal and vertical subsampling by 2 (most common)</p>
<h3 id="134-the-2d-discrete-cosine-transform-dct">13.4 The 2D Discrete Cosine Transform (DCT)<a class="header-link" href="#134-the-2d-discrete-cosine-transform-dct" title="Permanent link">&para;</a></h3>
<p>Each $8 \times 8$ block is transformed using the Type-II DCT:</p>
<p>$$F[u, v] = \frac{1}{4} C_u C_v \sum_{m=0}^{7} \sum_{n=0}^{7} f[m,n] \cos\!\left(\frac{(2m+1)u\pi}{16}\right) \cos\!\left(\frac{(2n+1)v\pi}{16}\right)$$</p>
<p>where $C_u = 1/\sqrt{2}$ for $u = 0$, $C_u = 1$ otherwise.</p>
<p>The DCT is preferred over the DFT because:
- Real-valued (no complex arithmetic)
- Better energy compaction (more energy concentrated in fewer coefficients)
- No discontinuity artifacts at block boundaries (the DCT implicitly assumes an even extension)</p>
<h3 id="135-quantization">13.5 Quantization<a class="header-link" href="#135-quantization" title="Permanent link">&para;</a></h3>
<p>The DCT coefficients are divided by a <strong>quantization matrix</strong> $Q[u,v]$ and rounded:</p>
<p>$$F_Q[u,v] = \text{round}\!\left(\frac{F[u,v]}{Q[u,v]}\right)$$</p>
<p>The quantization matrix has larger values for high-frequency components (more aggressive compression of frequencies humans are less sensitive to). This is the <strong>lossy</strong> step -- information is irreversibly discarded.</p>
<p><strong>Quality factor</strong>: Scaling the $Q$ matrix controls the quality-size tradeoff.</p>
<h3 id="136-entropy-coding">13.6 Entropy Coding<a class="header-link" href="#136-entropy-coding" title="Permanent link">&para;</a></h3>
<p>The quantized coefficients are encoded using:
1. <strong>Zigzag scanning</strong>: Reads the $8 \times 8$ block in a zigzag pattern to group low-frequency (large) coefficients first and high-frequency (often zero) coefficients last
2. <strong>Run-length encoding (RLE)</strong>: Efficiently encodes runs of zeros
3. <strong>Huffman coding</strong> (or arithmetic coding): Variable-length coding for further compression</p>
<h3 id="137-jpeg-artifacts">13.7 JPEG Artifacts<a class="header-link" href="#137-jpeg-artifacts" title="Permanent link">&para;</a></h3>
<p>At high compression ratios, JPEG produces characteristic artifacts:
- <strong>Blocking</strong>: Visible $8 \times 8$ grid boundaries
- <strong>Mosquito noise</strong>: Ringing around sharp edges
- <strong>Color bleeding</strong>: Chrominance artifacts near high-contrast edges</p>
<hr />
<h2 id="14-sampling-in-2d">14. Sampling in 2D<a class="header-link" href="#14-sampling-in-2d" title="Permanent link">&para;</a></h2>
<h3 id="141-2d-sampling-theorem">14.1 2D Sampling Theorem<a class="header-link" href="#141-2d-sampling-theorem" title="Permanent link">&para;</a></h3>
<p>A 2D continuous signal $f(x, y)$ bandlimited to $[-u_{max}, u_{max}] \times [-v_{max}, v_{max}]$ can be perfectly reconstructed from its samples if:</p>
<p>$$\frac{1}{\Delta x} > 2u_{max}, \quad \frac{1}{\Delta y} > 2v_{max}$$</p>
<p>where $\Delta x$ and $\Delta y$ are the sampling intervals.</p>
<h3 id="142-aliasing-in-2d">14.2 Aliasing in 2D<a class="header-link" href="#142-aliasing-in-2d" title="Permanent link">&para;</a></h3>
<p>When the sampling condition is violated, high-frequency content folds back and overlaps with low-frequency content. In images, aliasing manifests as:
- <strong>Moire patterns</strong>: Regular patterns that don't exist in the scene
- <strong>Jagged edges</strong> (staircasing): Diagonal lines appear as staircase steps
- <strong>Wagon wheel effect</strong>: In video, rotating wheels appear to spin backward</p>
<h3 id="143-anti-aliasing">14.3 Anti-Aliasing<a class="header-link" href="#143-anti-aliasing" title="Permanent link">&para;</a></h3>
<p>Before downsampling an image, apply a lowpass filter to remove frequencies above the new Nyquist frequency:</p>
<ol>
<li>Filter: $f_{filtered} = f * h_{LP}$</li>
<li>Downsample: $f_{down}[m,n] = f_{filtered}[Dm, Dn]$</li>
</ol>
<p>where $D$ is the downsampling factor and the cutoff of $h_{LP}$ is $\pi/D$.</p>
<h3 id="144-image-interpolation-upsampling">14.4 Image Interpolation (Upsampling)<a class="header-link" href="#144-image-interpolation-upsampling" title="Permanent link">&para;</a></h3>
<p>Common interpolation methods for image resizing:
- <strong>Nearest neighbor</strong>: Block artifacts, sharp
- <strong>Bilinear</strong>: Smooth, slight blurring
- <strong>Bicubic</strong>: Sharper than bilinear, slight ringing possible
- <strong>Sinc (ideal)</strong>: Perfect reconstruction but infinite support</p>
<p>Bilinear interpolation:</p>
<p>$$f(x, y) = (1-a)(1-b)f[m,n] + a(1-b)f[m,n+1] + (1-a)b f[m+1,n] + ab \, f[m+1,n+1]$$</p>
<p>where $a = x - m$ and $b = y - n$ are the fractional parts.</p>
<hr />
<h2 id="15-python-implementation">15. Python Implementation<a class="header-link" href="#15-python-implementation" title="Permanent link">&para;</a></h2>
<h3 id="151-2d-dft-visualization">15.1 2D DFT Visualization<a class="header-link" href="#151-2d-dft-visualization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_test_image</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a test image with various spatial frequencies.&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

    <span class="c1"># Horizontal bars (vertical frequency)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
        <span class="n">stripe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">img</span><span class="p">[:,</span> <span class="n">size</span><span class="o">//</span><span class="mi">6</span><span class="p">:</span><span class="n">size</span><span class="o">//</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stripe</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">freq</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">img</span><span class="p">[:,</span> <span class="n">size</span><span class="o">//</span><span class="mi">3</span><span class="p">:</span><span class="n">size</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stripe</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">freq</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">img</span><span class="p">[:,</span> <span class="n">size</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">size</span><span class="o">//</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stripe</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">freq</span> <span class="o">==</span> <span class="mi">40</span><span class="p">)</span>

    <span class="c1"># Add a rectangle</span>
    <span class="n">img</span><span class="p">[</span><span class="n">size</span><span class="o">//</span><span class="mi">4</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">size</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">size</span><span class="o">//</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="o">*</span><span class="n">size</span><span class="o">//</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Add a circle</span>
    <span class="n">yy</span><span class="p">,</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="n">size</span><span class="p">,</span> <span class="p">:</span><span class="n">size</span><span class="p">]</span>
    <span class="n">circle</span> <span class="o">=</span> <span class="p">((</span><span class="n">xx</span> <span class="o">-</span> <span class="n">size</span><span class="o">//</span><span class="mi">8</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yy</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">size</span><span class="o">//</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">size</span><span class="o">//</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">img</span><span class="p">[</span><span class="n">circle</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">img</span>


<span class="c1"># Create test image</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">create_test_image</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>

<span class="c1"># Compute 2D DFT</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">F_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
<span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">F_shifted</span><span class="p">))</span>  <span class="c1"># Log scale for visualization</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">F_shifted</span><span class="p">)</span>

<span class="c1"># Display</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Image&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude Spectrum (log scale)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hsv&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase Spectrum&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;2d_dft_visualization.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="152-spatial-filtering-smoothing-and-sharpening">15.2 Spatial Filtering: Smoothing and Sharpening<a class="header-link" href="#152-spatial-filtering-smoothing-and-sharpening" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span><span class="p">,</span> <span class="n">signal</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_noisy_image</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">noise_std</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a test image with noise.&quot;&quot;&quot;</span>
    <span class="c1"># Create a clean image with geometric shapes</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

    <span class="c1"># Rectangle</span>
    <span class="n">img</span><span class="p">[</span><span class="mi">50</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span> <span class="mi">30</span><span class="p">:</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span>

    <span class="c1"># Circle</span>
    <span class="n">yy</span><span class="p">,</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="n">size</span><span class="p">,</span> <span class="p">:</span><span class="n">size</span><span class="p">]</span>
    <span class="n">circle</span> <span class="o">=</span> <span class="p">((</span><span class="n">xx</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yy</span> <span class="o">-</span> <span class="mi">130</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">img</span><span class="p">[</span><span class="n">circle</span><span class="p">]</span> <span class="o">=</span> <span class="mi">220</span>

    <span class="c1"># Triangle</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">80</span><span class="p">):</span>
        <span class="n">img</span><span class="p">[</span><span class="mi">170</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">130</span><span class="o">+</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="mi">230</span><span class="o">-</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">140</span>

    <span class="c1"># Add Gaussian noise</span>
    <span class="n">noisy</span> <span class="o">=</span> <span class="n">img</span> <span class="o">+</span> <span class="n">noise_std</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">noisy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>


<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">clean</span><span class="p">,</span> <span class="n">noisy</span> <span class="o">=</span> <span class="n">generate_noisy_image</span><span class="p">()</span>

<span class="c1"># Define kernels</span>
<span class="n">box_3x3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="mi">9</span>
<span class="n">box_5x5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="o">/</span> <span class="mi">25</span>

<span class="c1"># Gaussian kernel</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">size_g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">sigma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span>  <span class="c1"># Ensure odd</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">size_g</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size_g</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">gaussian_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">xx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">gaussian_kernel</span> <span class="o">/=</span> <span class="n">gaussian_kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Laplacian sharpening kernel</span>
<span class="n">laplacian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                       <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="c1"># Apply filters</span>
<span class="n">smoothed_box</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">noisy</span><span class="p">,</span> <span class="n">box_5x5</span><span class="p">)</span>
<span class="n">smoothed_gauss</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">noisy</span><span class="p">,</span> <span class="n">gaussian_kernel</span><span class="p">)</span>
<span class="n">sharpened</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">laplacian</span><span class="p">)</span>  <span class="c1"># Sharpen the clean image</span>

<span class="c1"># Unsharp mask</span>
<span class="n">blurred</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">unsharp</span> <span class="o">=</span> <span class="n">clean</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">clean</span> <span class="o">-</span> <span class="n">blurred</span><span class="p">)</span>
<span class="n">unsharp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">unsharp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>

<span class="c1"># Display results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Clean Image&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Noisy Image (Ïƒ=20)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">smoothed_box</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Box Filter 5Ã—5&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">smoothed_gauss</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Gaussian Filter (Ïƒ=</span><span class="si">{</span><span class="n">sigma</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">sharpened</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Laplacian Sharpening&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">unsharp</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Unsharp Masking (k=1.5)&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;spatial_filtering.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="153-frequency-domain-filtering">15.3 Frequency Domain Filtering<a class="header-link" href="#153-frequency-domain-filtering" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">frequency_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">filter_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply a frequency domain filter to an image.&quot;&quot;&quot;</span>
    <span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># Compute centered 2D DFT</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>

    <span class="c1"># Create frequency grid</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">-</span> <span class="n">M</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">V</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Apply filter</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">filter_func</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">F</span> <span class="o">*</span> <span class="n">H</span>

    <span class="c1"># Inverse DFT</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">g</span><span class="p">,</span> <span class="n">H</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ideal_lowpass</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">D0</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">D</span> <span class="o">&lt;=</span> <span class="n">D0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">butterworth_lowpass</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">D</span> <span class="o">/</span> <span class="n">D0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gaussian_lowpass</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">D0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">D</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">D0</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>


<span class="c1"># Create test image</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
<span class="n">img</span><span class="p">[</span><span class="mi">80</span><span class="p">:</span><span class="mi">180</span><span class="p">,</span> <span class="mi">60</span><span class="p">:</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">yy</span><span class="p">,</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="n">size</span><span class="p">,</span> <span class="p">:</span><span class="n">size</span><span class="p">]</span>
<span class="n">circle</span> <span class="o">=</span> <span class="p">((</span><span class="n">xx</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yy</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="o">**</span><span class="mi">2</span>
<span class="n">img</span><span class="p">[</span><span class="n">circle</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
<span class="n">img</span> <span class="o">+=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>

<span class="c1"># Apply different lowpass filters</span>
<span class="n">D0</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># Cutoff frequency</span>

<span class="n">filtered_ideal</span><span class="p">,</span> <span class="n">H_ideal</span> <span class="o">=</span> <span class="n">frequency_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ideal_lowpass</span><span class="p">,</span> <span class="n">D0</span><span class="p">)</span>
<span class="n">filtered_butter</span><span class="p">,</span> <span class="n">H_butter</span> <span class="o">=</span> <span class="n">frequency_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">butterworth_lowpass</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">filtered_gauss</span><span class="p">,</span> <span class="n">H_gauss</span> <span class="o">=</span> <span class="n">frequency_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">gaussian_lowpass</span><span class="p">,</span> <span class="n">D0</span><span class="p">)</span>

<span class="c1"># Highpass (complement of Gaussian lowpass)</span>
<span class="n">filtered_hp</span><span class="p">,</span> <span class="n">H_hp</span> <span class="o">=</span> <span class="n">frequency_filter</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">D</span><span class="p">,</span> <span class="n">D0</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">gaussian_lowpass</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">D0</span><span class="p">),</span> <span class="n">D0</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Top row: filters</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">H_ideal</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ideal LP (Dâ‚€=</span><span class="si">{</span><span class="n">D0</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">H_butter</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Butterworth LP (Dâ‚€=</span><span class="si">{</span><span class="n">D0</span><span class="si">}</span><span class="s1">, n=2)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">H_gauss</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Gaussian LP (Dâ‚€=</span><span class="si">{</span><span class="n">D0</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="c1"># Bottom row: filtered images</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">filtered_ideal</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Ideal LP (ringing)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">filtered_butter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Butterworth LP&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">filtered_gauss</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gaussian LP (smooth)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">filtered_hp</span> <span class="o">+</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gaussian HP&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;frequency_domain_filtering.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="154-edge-detection">15.4 Edge Detection<a class="header-link" href="#154-edge-detection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ndimage</span>


<span class="k">def</span><span class="w"> </span><span class="nf">sobel_edge_detection</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manual Sobel edge detection.&quot;&quot;&quot;</span>
    <span class="c1"># Sobel kernels</span>
    <span class="n">Kx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">Ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">Gx</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">Kx</span><span class="p">)</span>
    <span class="n">Gy</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">Ky</span><span class="p">)</span>

    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Gy</span><span class="p">,</span> <span class="n">Gx</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">Gx</span><span class="p">,</span> <span class="n">Gy</span>


<span class="k">def</span><span class="w"> </span><span class="nf">canny_edge_detector</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">low_thresh</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high_thresh</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manual Canny edge detector implementation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    img : ndarray</span>
<span class="sd">        Input grayscale image (float, 0-1 range)</span>
<span class="sd">    sigma : float</span>
<span class="sd">        Gaussian smoothing parameter</span>
<span class="sd">    low_thresh : float</span>
<span class="sd">        Low threshold (fraction of max gradient)</span>
<span class="sd">    high_thresh : float</span>
<span class="sd">        High threshold (fraction of max gradient)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    edges : ndarray</span>
<span class="sd">        Binary edge map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Step 1: Gaussian smoothing</span>
    <span class="n">smoothed</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>

    <span class="c1"># Step 2: Gradient computation (Sobel)</span>
    <span class="n">magnitude</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sobel_edge_detection</span><span class="p">(</span><span class="n">smoothed</span><span class="p">)</span>

    <span class="c1"># Normalize</span>
    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">magnitude</span> <span class="o">/</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">magnitude</span>

    <span class="c1"># Step 3: Non-maximum suppression</span>
    <span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">nms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">magnitude</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">direction</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">angle</span><span class="p">[</span><span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">180</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Determine neighbor direction</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">angle</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mf">22.5</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="mf">157.5</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">):</span>
                <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="mf">22.5</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mf">67.5</span><span class="p">:</span>
                <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="mf">67.5</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mf">112.5</span><span class="p">:</span>
                <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">n1</span> <span class="ow">and</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">n2</span><span class="p">:</span>
                <span class="n">nms</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

    <span class="c1"># Step 4: Double thresholding</span>
    <span class="n">strong</span> <span class="o">=</span> <span class="n">nms</span> <span class="o">&gt;=</span> <span class="n">high_thresh</span>
    <span class="n">weak</span> <span class="o">=</span> <span class="p">(</span><span class="n">nms</span> <span class="o">&gt;=</span> <span class="n">low_thresh</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nms</span> <span class="o">&lt;</span> <span class="n">high_thresh</span><span class="p">)</span>

    <span class="c1"># Step 5: Edge tracking by hysteresis (simplified using dilation)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">strong</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># Connect weak edges adjacent to strong edges</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>  <span class="c1"># Iterate to propagate connectivity</span>
        <span class="n">dilated</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span> <span class="o">|</span> <span class="p">(</span><span class="n">weak</span> <span class="o">&amp;</span> <span class="n">dilated</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">edges</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>


<span class="c1"># Create a test image</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
<span class="c1"># Rectangle</span>
<span class="n">img</span><span class="p">[</span><span class="mi">60</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span><span class="mi">220</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="c1"># Inner rectangle</span>
<span class="n">img</span><span class="p">[</span><span class="mi">90</span><span class="p">:</span><span class="mi">170</span><span class="p">,</span> <span class="mi">70</span><span class="p">:</span><span class="mi">190</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="c1"># Circle</span>
<span class="n">yy</span><span class="p">,</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="n">size</span><span class="p">,</span> <span class="p">:</span><span class="n">size</span><span class="p">]</span>
<span class="n">circle</span> <span class="o">=</span> <span class="p">((</span><span class="n">xx</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yy</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="o">**</span><span class="mi">2</span>
<span class="n">img</span><span class="p">[</span><span class="n">circle</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="c1"># Add mild noise</span>
<span class="n">img</span> <span class="o">+=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Edge detection methods</span>
<span class="n">magnitude</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">Gx</span><span class="p">,</span> <span class="n">Gy</span> <span class="o">=</span> <span class="n">sobel_edge_detection</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="c1"># Laplacian</span>
<span class="n">laplacian</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="n">ndimage</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

<span class="c1"># LoG</span>
<span class="n">log_result</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">gaussian_laplace</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

<span class="c1"># Canny</span>
<span class="n">canny_edges</span> <span class="o">=</span> <span class="n">canny_edge_detector</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">low_thresh</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">high_thresh</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>

<span class="c1"># Display</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Image&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sobel Magnitude&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hsv&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sobel Direction&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">laplacian</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Laplacian (after Gaussian)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">log_result</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Laplacian of Gaussian (Ïƒ=2)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">canny_edges</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Canny Edge Detector&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;edge_detection.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="155-histogram-equalization">15.5 Histogram Equalization<a class="header-link" href="#155-histogram-equalization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">histogram_equalization</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply histogram equalization to an 8-bit grayscale image.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    img : ndarray</span>
<span class="sd">        Input image (uint8 or float [0, 255])</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    equalized : ndarray</span>
<span class="sd">        Histogram-equalized image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img_int</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mi">256</span>

    <span class="c1"># Compute histogram</span>
    <span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">img_int</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">))</span>

    <span class="c1"># Compute CDF</span>
    <span class="n">cdf</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">cdf_normalized</span> <span class="o">=</span> <span class="n">cdf</span> <span class="o">/</span> <span class="n">cdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Normalize to [0, 1]</span>

    <span class="c1"># Map pixel values</span>
    <span class="n">equalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">L</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cdf_normalized</span><span class="p">[</span><span class="n">img_int</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">equalized</span>


<span class="c1"># Create a low-contrast test image</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">yy</span><span class="p">,</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="n">size</span><span class="p">,</span> <span class="p">:</span><span class="n">size</span><span class="p">]</span>

<span class="c1"># Low-contrast image (values concentrated in [80, 170])</span>
<span class="n">img</span> <span class="o">=</span> <span class="mi">80</span> <span class="o">+</span> <span class="mi">90</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">xx</span><span class="o">/</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">yy</span><span class="o">/</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">circle</span> <span class="o">=</span> <span class="p">((</span><span class="n">xx</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yy</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="o">**</span><span class="mi">2</span>
<span class="n">img</span><span class="p">[</span><span class="n">circle</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">img</span> <span class="o">+=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="c1"># Apply histogram equalization</span>
<span class="n">equalized</span> <span class="o">=</span> <span class="n">histogram_equalization</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="c1"># Gamma correction examples</span>
<span class="n">gamma_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">img</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>   <span class="c1"># Brighten</span>
<span class="n">gamma_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">img</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>  <span class="c1"># Darken</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Images</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original (low contrast)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">equalized</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram Equalized&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gamma_low</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gamma = 0.5 (brighten)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gamma_high</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gamma = 2.0 (darken)&#39;</span><span class="p">)</span>

<span class="c1"># Histograms</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Histogram&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">equalized</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Equalized Histogram&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gamma_low</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gamma 0.5 Histogram&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gamma_high</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gamma 2.0 Histogram&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;histogram_equalization.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="156-dct-based-compression-demo">15.6 DCT-Based Compression Demo<a class="header-link" href="#156-dct-based-compression-demo" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.fft</span><span class="w"> </span><span class="kn">import</span> <span class="n">dctn</span><span class="p">,</span> <span class="n">idctn</span>


<span class="k">def</span><span class="w"> </span><span class="nf">jpeg_compress_block</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate JPEG compression on a single 8x8 block.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    block : ndarray</span>
<span class="sd">        8x8 pixel block</span>
<span class="sd">    quality : int</span>
<span class="sd">        Quality factor (1-100)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    reconstructed : ndarray</span>
<span class="sd">        Reconstructed block after compression</span>
<span class="sd">    n_nonzero : int</span>
<span class="sd">        Number of non-zero quantized coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Standard JPEG luminance quantization table</span>
    <span class="n">Q_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span>  <span class="mi">24</span><span class="p">,</span>  <span class="mi">40</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span>  <span class="mi">61</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span>  <span class="mi">58</span><span class="p">,</span>  <span class="mi">60</span><span class="p">,</span>  <span class="mi">55</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span>  <span class="mi">40</span><span class="p">,</span>  <span class="mi">57</span><span class="p">,</span>  <span class="mi">69</span><span class="p">,</span>  <span class="mi">56</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span>  <span class="mi">51</span><span class="p">,</span>  <span class="mi">87</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span>  <span class="mi">62</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span>  <span class="mi">68</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span>  <span class="mi">77</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">81</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span>  <span class="mi">92</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">49</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">101</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span>  <span class="mi">99</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="c1"># Scale quantization table by quality</span>
    <span class="k">if</span> <span class="n">quality</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mi">5000</span> <span class="o">/</span> <span class="n">quality</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">quality</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Q_base</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">/</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>

    <span class="c1"># Shift to center around 0</span>
    <span class="n">block_shifted</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">-</span> <span class="mi">128</span>

    <span class="c1"># Forward DCT</span>
    <span class="n">dct_block</span> <span class="o">=</span> <span class="n">dctn</span><span class="p">(</span><span class="n">block_shifted</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>

    <span class="c1"># Quantize</span>
    <span class="n">quantized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dct_block</span> <span class="o">/</span> <span class="n">Q</span><span class="p">)</span>
    <span class="n">n_nonzero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">quantized</span><span class="p">)</span>

    <span class="c1"># Dequantize</span>
    <span class="n">dequantized</span> <span class="o">=</span> <span class="n">quantized</span> <span class="o">*</span> <span class="n">Q</span>

    <span class="c1"># Inverse DCT</span>
    <span class="n">reconstructed</span> <span class="o">=</span> <span class="n">idctn</span><span class="p">(</span><span class="n">dequantized</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">128</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">reconstructed</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">n_nonzero</span>


<span class="k">def</span><span class="w"> </span><span class="nf">jpeg_compress_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulate JPEG compression on a full image.&quot;&quot;&quot;</span>
    <span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># Pad to multiple of 8</span>
    <span class="n">M_pad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">M</span> <span class="o">/</span> <span class="mi">8</span><span class="p">))</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="n">N_pad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">8</span><span class="p">))</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M_pad</span><span class="p">,</span> <span class="n">N_pad</span><span class="p">))</span>
    <span class="n">padded</span><span class="p">[:</span><span class="n">M</span><span class="p">,</span> <span class="p">:</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span>
    <span class="n">total_nonzero</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M_pad</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_pad</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">padded</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">8</span><span class="p">],</span> <span class="n">nz</span> <span class="o">=</span> <span class="n">jpeg_compress_block</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>
            <span class="n">total_nonzero</span> <span class="o">+=</span> <span class="n">nz</span>

    <span class="n">total_coeffs</span> <span class="o">=</span> <span class="p">(</span><span class="n">M_pad</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">N_pad</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mi">64</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[:</span><span class="n">M</span><span class="p">,</span> <span class="p">:</span><span class="n">N</span><span class="p">],</span> <span class="n">total_nonzero</span> <span class="o">/</span> <span class="n">total_coeffs</span>


<span class="c1"># Create test image</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">yy</span><span class="p">,</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[:</span><span class="n">size</span><span class="p">,</span> <span class="p">:</span><span class="n">size</span><span class="p">]</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
<span class="n">img</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">220</span><span class="p">,</span> <span class="mi">30</span><span class="p">:</span><span class="mi">230</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span>
<span class="n">circle</span> <span class="o">=</span> <span class="p">((</span><span class="n">xx</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yy</span> <span class="o">-</span> <span class="mi">128</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="o">**</span><span class="mi">2</span>
<span class="n">img</span><span class="p">[</span><span class="n">circle</span><span class="p">]</span> <span class="o">=</span> <span class="mi">240</span>
<span class="n">img</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="n">xx</span><span class="o">/</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">img</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>

<span class="c1"># Compress at different quality levels</span>
<span class="n">qualities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qualities</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># Show DCT of one block</span>
<span class="n">block</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span> <span class="mi">30</span><span class="p">:</span><span class="mi">38</span><span class="p">]</span>
<span class="n">dct_block</span> <span class="o">=</span> <span class="n">dctn</span><span class="p">(</span><span class="n">block</span> <span class="o">-</span> <span class="mi">128</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dct_block</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;DCT of 8x8 block</span><span class="se">\n</span><span class="s1">(log magnitude)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qualities</span><span class="p">):</span>
    <span class="n">compressed</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">jpeg_compress_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="n">psnr</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">255</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">img</span> <span class="o">-</span> <span class="n">compressed</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">img</span> <span class="o">-</span> <span class="n">compressed</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">compressed</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Q=</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="se">\n</span><span class="s1">PSNR=</span><span class="si">{</span><span class="n">psnr</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error (non-zero: </span><span class="si">{</span><span class="n">ratio</span><span class="si">:</span><span class="s1">.1%</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;JPEG Compression Simulation (DCT-based)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;jpeg_compression.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="16-exercises">16. Exercises<a class="header-link" href="#16-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-2d-dft-properties">Exercise 1: 2D DFT Properties<a class="header-link" href="#exercise-1-2d-dft-properties" title="Permanent link">&para;</a></h3>
<p>(a) Create a $256 \times 256$ image containing a single white rectangle (64x32 pixels) at the center. Compute and display its 2D DFT magnitude spectrum. Explain the pattern you see in terms of the 2D sinc function.</p>
<p>(b) Shift the rectangle 50 pixels to the right. Compute the new magnitude and phase spectra. What changes and what stays the same? Verify the shift theorem.</p>
<p>(c) Rotate the rectangle by 45 degrees and compute the magnitude spectrum. How does the rotation in the spatial domain affect the frequency domain?</p>
<p>(d) Swap the magnitude of one image with the phase of another. Display the results. Which carries more visual information -- magnitude or phase?</p>
<h3 id="exercise-2-smoothing-filter-comparison">Exercise 2: Smoothing Filter Comparison<a class="header-link" href="#exercise-2-smoothing-filter-comparison" title="Permanent link">&para;</a></h3>
<p>Generate a test image containing:
- A region with additive Gaussian noise ($\sigma = 30$)
- A region with salt-and-pepper noise (5% probability)</p>
<p>(a) Apply box filters of size $3 \times 3$, $5 \times 5$, and $7 \times 7$. Measure the PSNR for each.</p>
<p>(b) Apply Gaussian filters with $\sigma = 1, 2, 3$. Compare with the box filters.</p>
<p>(c) Apply median filters of size $3 \times 3$ and $5 \times 5$. Which noise type benefits most from median filtering?</p>
<p>(d) For each filter, compute the edge preservation metric: the ratio of gradient energy in the filtered image to gradient energy in the original clean image.</p>
<h3 id="exercise-3-frequency-domain-design">Exercise 3: Frequency Domain Design<a class="header-link" href="#exercise-3-frequency-domain-design" title="Permanent link">&para;</a></h3>
<p>(a) Design and implement an ideal bandpass filter that passes spatial frequencies between $D_1 = 20$ and $D_2 = 60$ pixels (from center). Apply to a test image and observe the result.</p>
<p>(b) Create an image with periodic vertical stripes (noise) added to a photograph. Design a notch filter to remove the stripes without affecting the underlying image.</p>
<p>(c) Implement a homomorphic filter: take the log of the image, apply a highpass filter in the frequency domain, then exponentiate. This enhances local contrast by normalizing the illumination. Compare with histogram equalization.</p>
<h3 id="exercise-4-edge-detection-comparison">Exercise 4: Edge Detection Comparison<a class="header-link" href="#exercise-4-edge-detection-comparison" title="Permanent link">&para;</a></h3>
<p>Create a test image with:
- Strong edges (high contrast)
- Weak edges (low contrast)
- Texture regions
- Gaussian noise ($\sigma = 10$)</p>
<p>(a) Apply Sobel, Prewitt, and Scharr operators. Compare the edge maps and gradient magnitudes.</p>
<p>(b) Apply the Laplacian and LoG with $\sigma = 1, 2, 3$. How does $\sigma$ affect the detected edges?</p>
<p>(c) Implement the full Canny edge detector (all 5 steps). Vary the thresholds and Gaussian $\sigma$ to see their effects.</p>
<p>(d) Quantitatively compare the detectors using precision-recall curves against a ground-truth edge map.</p>
<h3 id="exercise-5-histogram-processing">Exercise 5: Histogram Processing<a class="header-link" href="#exercise-5-histogram-processing" title="Permanent link">&para;</a></h3>
<p>(a) Generate a dark image (histogram concentrated in [0, 50]) and a bright image (histogram in [200, 255]). Apply histogram equalization to both and compare.</p>
<p>(b) Implement CLAHE: divide the image into $8 \times 8$ tiles, compute the clipped histogram for each tile, and use bilinear interpolation for smooth transitions. Compare with global histogram equalization.</p>
<p>(c) Implement histogram matching (specification): given a target histogram shape, transform the image so its histogram approximates the target.</p>
<h3 id="exercise-6-jpeg-compression-analysis">Exercise 6: JPEG Compression Analysis<a class="header-link" href="#exercise-6-jpeg-compression-analysis" title="Permanent link">&para;</a></h3>
<p>(a) Implement a complete JPEG compression simulator: color space conversion (for color images), $8 \times 8$ block DCT, quantization, zigzag scan, and RLE. Measure the compression ratio and PSNR at quality factors 10, 30, 50, 70, and 90.</p>
<p>(b) Plot the PSNR vs compression ratio curve (rate-distortion curve).</p>
<p>(c) Visualize the blocking artifacts at low quality. Implement a simple deblocking filter (lowpass filter applied only across block boundaries).</p>
<p>(d) Compare DCT compression with wavelet compression: apply the 2D DWT, threshold small coefficients, and reconstruct. Plot the rate-distortion curves for both methods.</p>
<h3 id="exercise-7-2d-sampling-and-aliasing">Exercise 7: 2D Sampling and Aliasing<a class="header-link" href="#exercise-7-2d-sampling-and-aliasing" title="Permanent link">&para;</a></h3>
<p>(a) Create a high-resolution ($512 \times 512$) image with a zone plate pattern: $f[m,n] = \cos(\alpha(m^2 + n^2))$. Downsample by factors of 2, 4, and 8 (with and without anti-aliasing). Identify the aliasing artifacts.</p>
<p>(b) Implement bilinear and bicubic interpolation from scratch. Upsample a small ($32 \times 32$) image by a factor of 8 using nearest-neighbor, bilinear, and bicubic methods. Compare the results.</p>
<p>(c) Given a natural image, compute its 2D power spectrum and estimate the effective bandwidth. Determine the minimum sampling rate needed to avoid aliasing.</p>
<hr />
<h2 id="17-summary">17. Summary<a class="header-link" href="#17-summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Key Formula / Idea</th>
</tr>
</thead>
<tbody>
<tr>
<td>2D DFT</td>
<td>$F[k,l] = \sum_m\sum_n f[m,n]e^{-j2\pi(km/M + ln/N)}$</td>
</tr>
<tr>
<td>2D convolution</td>
<td>$g = f * h$ (spatial) $\Leftrightarrow$ $G = F \cdot H$ (frequency)</td>
</tr>
<tr>
<td>Gaussian filter</td>
<td>$h[m,n] = \frac{1}{2\pi\sigma^2}e^{-(m^2+n^2)/(2\sigma^2)}$; separable</td>
</tr>
<tr>
<td>Sobel operator</td>
<td>Smoothed gradient: $|\nabla f| = \sqrt{G_x^2 + G_y^2}$</td>
</tr>
<tr>
<td>Laplacian</td>
<td>$\nabla^2 f$; detect edges as zero crossings</td>
</tr>
<tr>
<td>LoG</td>
<td>$\nabla^2(G_\sigma * f) = (\nabla^2 G_\sigma) * f$</td>
</tr>
<tr>
<td>Canny</td>
<td>Smooth $\to$ Gradient $\to$ NMS $\to$ Hysteresis</td>
</tr>
<tr>
<td>Histogram equalization</td>
<td>$s_k = (L-1)\sum_{j=0}^k p[j]$ (CDF mapping)</td>
</tr>
<tr>
<td>DCT (JPEG)</td>
<td>Real-valued, better energy compaction than DFT</td>
</tr>
<tr>
<td>JPEG quantization</td>
<td>$F_Q = \text{round}(F/Q)$ (lossy step)</td>
</tr>
<tr>
<td>2D Nyquist</td>
<td>$1/\Delta x > 2u_{max}$, $1/\Delta y > 2v_{max}$</td>
</tr>
</tbody>
</table>
<p><strong>Key takeaways</strong>:
1. Images are 2D signals; all 1D signal processing concepts extend naturally to 2D.
2. The 2D DFT is separable, enabling efficient computation via row-column FFTs.
3. Spatial filtering (convolution with kernels) handles smoothing, sharpening, and edge detection.
4. Frequency domain filtering is efficient for large kernels and provides intuitive design (lowpass, highpass, notch).
5. Edge detection combines differentiation (gradient or Laplacian) with noise suppression (Gaussian smoothing).
6. The Canny edge detector optimally balances detection accuracy, localization, and single-response criteria.
7. Histogram equalization is a powerful, automatic contrast enhancement technique.
8. JPEG compression exploits the DCT's energy compaction and human visual insensitivity to high-frequency detail.
9. Anti-aliasing (lowpass before downsampling) is critical for artifact-free image resizing.</p>
<hr />
<h2 id="18-references">18. References<a class="header-link" href="#18-references" title="Permanent link">&para;</a></h2>
<ol>
<li>R.C. Gonzalez and R.E. Woods, <em>Digital Image Processing</em>, 4th ed., Pearson, 2018.</li>
<li>A.K. Jain, <em>Fundamentals of Digital Image Processing</em>, Prentice Hall, 1989.</li>
<li>W.K. Pratt, <em>Digital Image Processing</em>, 4th ed., Wiley, 2007.</li>
<li>J.F. Canny, "A computational approach to edge detection," <em>IEEE Trans. PAMI</em>, vol. 8, no. 6, pp. 679-698, 1986.</li>
<li>G.K. Wallace, "The JPEG still picture compression standard," <em>IEEE Trans. Consumer Electronics</em>, vol. 38, no. 1, pp. xviii-xxxiv, 1992.</li>
<li>A.V. Oppenheim and R.W. Schafer, <em>Discrete-Time Signal Processing</em>, 3rd ed., Pearson, 2010 (Chapter 8: The Discrete Fourier Transform).</li>
</ol>
<hr />
<p><strong>Previous</strong>: <a href="./14_Time_Frequency_Analysis.md">14. Time-Frequency Analysis</a> | <strong>Next</strong>: <a href="./16_Applications.md">16. Applications</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Signal_Processing/14_Time_Frequency_Analysis.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">14. Time-Frequency Analysis</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Signal_Processing/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/Signal_Processing/16_Applications.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">16. Applications of Signal Processing</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}