{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16. Applications of Signal Processing - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/Signal_Processing/">Signal Processing</a>
    <span class="separator">/</span>
    <span class="current">16. Applications of Signal Processing</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>16. Applications of Signal Processing</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Signal_Processing/15_Image_Signal_Processing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">15. Image Signal Processing</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Signal_Processing/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-audio-signal-processing">1. Audio Signal Processing</a><ul>
<li><a href="#11-the-audio-signal-chain">1.1 The Audio Signal Chain</a></li>
<li><a href="#12-frequency-ranges">1.2 Frequency Ranges</a></li>
</ul>
</li>
<li><a href="#2-audio-representation-and-formats">2. Audio Representation and Formats</a><ul>
<li><a href="#21-pulse-code-modulation-pcm">2.1 Pulse Code Modulation (PCM)</a></li>
<li><a href="#22-data-rate">2.2 Data Rate</a></li>
<li><a href="#23-dithering">2.3 Dithering</a></li>
</ul>
</li>
<li><a href="#3-digital-audio-effects">3. Digital Audio Effects</a><ul>
<li><a href="#31-delay-based-effects">3.1 Delay-Based Effects</a><ul>
<li><a href="#echodelay">Echo/Delay</a></li>
<li><a href="#reverb">Reverb</a></li>
</ul>
</li>
<li><a href="#32-modulation-based-effects">3.2 Modulation-Based Effects</a><ul>
<li><a href="#chorus">Chorus</a></li>
<li><a href="#flanger">Flanger</a></li>
<li><a href="#vibrato">Vibrato</a></li>
</ul>
</li>
<li><a href="#33-dynamics-processing">3.3 Dynamics Processing</a><ul>
<li><a href="#compressor">Compressor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-pitch-detection">4. Pitch Detection</a><ul>
<li><a href="#41-autocorrelation-method">4.1 Autocorrelation Method</a></li>
<li><a href="#42-cepstrum-method">4.2 Cepstrum Method</a></li>
<li><a href="#43-comparison">4.3 Comparison</a></li>
</ul>
</li>
<li><a href="#5-audio-equalization">5. Audio Equalization</a><ul>
<li><a href="#51-graphic-equalizer">5.1 Graphic Equalizer</a></li>
<li><a href="#52-parametric-equalizer">5.2 Parametric Equalizer</a></li>
<li><a href="#53-shelving-filters">5.3 Shelving Filters</a></li>
</ul>
</li>
<li><a href="#6-speech-coding-linear-predictive-coding-lpc">6. Speech Coding: Linear Predictive Coding (LPC)</a><ul>
<li><a href="#61-the-source-filter-model">6.1 The Source-Filter Model</a></li>
<li><a href="#62-linear-prediction">6.2 Linear Prediction</a></li>
<li><a href="#63-solving-for-lpc-coefficients">6.3 Solving for LPC Coefficients</a></li>
<li><a href="#64-lpc-vocoder">6.4 LPC Vocoder</a></li>
<li><a href="#65-lpc-spectrum">6.5 LPC Spectrum</a></li>
</ul>
</li>
<li><a href="#7-communications-analog-modulation">7. Communications: Analog Modulation</a><ul>
<li><a href="#71-why-modulation">7.1 Why Modulation?</a></li>
<li><a href="#72-amplitude-modulation-am">7.2 Amplitude Modulation (AM)</a></li>
<li><a href="#73-frequency-modulation-fm">7.3 Frequency Modulation (FM)</a></li>
<li><a href="#74-phase-modulation-pm">7.4 Phase Modulation (PM)</a></li>
</ul>
</li>
<li><a href="#8-communications-digital-modulation">8. Communications: Digital Modulation</a><ul>
<li><a href="#81-digital-modulation-overview">8.1 Digital Modulation Overview</a></li>
<li><a href="#82-binary-phase-shift-keying-bpsk">8.2 Binary Phase Shift Keying (BPSK)</a></li>
<li><a href="#83-quadrature-phase-shift-keying-qpsk">8.3 Quadrature Phase Shift Keying (QPSK)</a></li>
<li><a href="#84-quadrature-amplitude-modulation-qam">8.4 Quadrature Amplitude Modulation (QAM)</a></li>
<li><a href="#85-i-q-representation">8.5 I-Q Representation</a></li>
</ul>
</li>
<li><a href="#9-pulse-shaping-and-matched-filtering">9. Pulse Shaping and Matched Filtering</a><ul>
<li><a href="#91-the-inter-symbol-interference-isi-problem">9.1 The Inter-Symbol Interference (ISI) Problem</a></li>
<li><a href="#92-nyquist-isi-criterion">9.2 Nyquist ISI Criterion</a></li>
<li><a href="#93-raised-cosine-pulse">9.3 Raised Cosine Pulse</a></li>
<li><a href="#94-matched-filter">9.4 Matched Filter</a></li>
</ul>
</li>
<li><a href="#10-channel-models-and-equalization">10. Channel Models and Equalization</a><ul>
<li><a href="#101-additive-white-gaussian-noise-awgn-channel">10.1 Additive White Gaussian Noise (AWGN) Channel</a></li>
<li><a href="#102-multipath-channel">10.2 Multipath Channel</a></li>
<li><a href="#103-zero-forcing-zf-equalizer">10.3 Zero-Forcing (ZF) Equalizer</a></li>
<li><a href="#104-mmse-equalizer">10.4 MMSE Equalizer</a></li>
<li><a href="#105-adaptive-equalization">10.5 Adaptive Equalization</a></li>
</ul>
</li>
<li><a href="#11-ofdm-fundamentals">11. OFDM Fundamentals</a><ul>
<li><a href="#111-motivation">11.1 Motivation</a></li>
<li><a href="#112-ofdm-system-model">11.2 OFDM System Model</a></li>
<li><a href="#113-cyclic-prefix-cp">11.3 Cyclic Prefix (CP)</a></li>
<li><a href="#114-one-tap-equalization">11.4 One-Tap Equalization</a></li>
<li><a href="#115-ofdm-parameters-wifi-example">11.5 OFDM Parameters (WiFi Example)</a></li>
</ul>
</li>
<li><a href="#12-radar-signal-processing">12. Radar Signal Processing</a><ul>
<li><a href="#121-radar-basics">12.1 Radar Basics</a></li>
<li><a href="#122-range-resolution">12.2 Range Resolution</a></li>
<li><a href="#123-doppler-processing">12.3 Doppler Processing</a></li>
<li><a href="#124-matched-filter-for-radar">12.4 Matched Filter for Radar</a></li>
</ul>
</li>
<li><a href="#13-chirp-signals-and-pulse-compression">13. Chirp Signals and Pulse Compression</a><ul>
<li><a href="#131-the-linear-fm-chirp">13.1 The Linear FM Chirp</a></li>
<li><a href="#132-pulse-compression">13.2 Pulse Compression</a></li>
<li><a href="#133-range-resolution-after-compression">13.3 Range Resolution After Compression</a></li>
<li><a href="#134-sidelobes-and-windowing">13.4 Sidelobes and Windowing</a></li>
</ul>
</li>
<li><a href="#14-the-ambiguity-function">14. The Ambiguity Function</a><ul>
<li><a href="#141-definition">14.1 Definition</a></li>
<li><a href="#142-properties">14.2 Properties</a></li>
<li><a href="#143-ambiguity-functions-of-common-waveforms">14.3 Ambiguity Functions of Common Waveforms</a></li>
<li><a href="#144-waveform-design">14.4 Waveform Design</a></li>
</ul>
</li>
<li><a href="#15-biomedical-signal-processing-ecg">15. Biomedical Signal Processing: ECG</a><ul>
<li><a href="#151-the-ecg-signal">15.1 The ECG Signal</a></li>
<li><a href="#152-ecg-signal-characteristics">15.2 ECG Signal Characteristics</a></li>
<li><a href="#153-ecg-noise-sources">15.3 ECG Noise Sources</a></li>
<li><a href="#154-ecg-preprocessing-pipeline">15.4 ECG Preprocessing Pipeline</a></li>
<li><a href="#155-qrs-detection-pan-tompkins-algorithm">15.5 QRS Detection: Pan-Tompkins Algorithm</a></li>
</ul>
</li>
<li><a href="#16-biomedical-signal-processing-eeg">16. Biomedical Signal Processing: EEG</a><ul>
<li><a href="#161-the-eeg-signal">16.1 The EEG Signal</a></li>
<li><a href="#162-eeg-frequency-bands">16.2 EEG Frequency Bands</a></li>
<li><a href="#163-eeg-spectral-analysis">16.3 EEG Spectral Analysis</a></li>
<li><a href="#164-event-related-potentials-erps">16.4 Event-Related Potentials (ERPs)</a></li>
<li><a href="#165-spectral-analysis-methods-for-eeg">16.5 Spectral Analysis Methods for EEG</a></li>
</ul>
</li>
<li><a href="#17-heart-rate-variability-hrv">17. Heart Rate Variability (HRV)</a><ul>
<li><a href="#171-what-is-hrv">17.1 What is HRV?</a></li>
<li><a href="#172-time-domain-measures">17.2 Time-Domain Measures</a></li>
<li><a href="#173-frequency-domain-measures">17.3 Frequency-Domain Measures</a></li>
<li><a href="#174-hrv-analysis-pipeline">17.4 HRV Analysis Pipeline</a></li>
</ul>
</li>
<li><a href="#18-python-implementations">18. Python Implementations</a><ul>
<li><a href="#181-digital-audio-effects">18.1 Digital Audio Effects</a></li>
<li><a href="#182-digital-modulation">18.2 Digital Modulation</a></li>
<li><a href="#183-radar-chirp-pulse-compression">18.3 Radar: Chirp Pulse Compression</a></li>
<li><a href="#184-biomedical-ecg-processing">18.4 Biomedical: ECG Processing</a></li>
<li><a href="#185-pitch-detection-demo">18.5 Pitch Detection Demo</a></li>
</ul>
</li>
<li><a href="#19-exercises">19. Exercises</a><ul>
<li><a href="#exercise-1-audio-effects-chain">Exercise 1: Audio Effects Chain</a></li>
<li><a href="#exercise-2-pitch-detection-robustness">Exercise 2: Pitch Detection Robustness</a></li>
<li><a href="#exercise-3-digital-modulation-ber">Exercise 3: Digital Modulation BER</a></li>
<li><a href="#exercise-4-ofdm-system">Exercise 4: OFDM System</a></li>
<li><a href="#exercise-5-radar-waveform-design">Exercise 5: Radar Waveform Design</a></li>
<li><a href="#exercise-6-ecg-analysis-pipeline">Exercise 6: ECG Analysis Pipeline</a></li>
<li><a href="#exercise-7-eeg-spectral-analysis">Exercise 7: EEG Spectral Analysis</a></li>
</ul>
</li>
<li><a href="#20-summary">20. Summary</a></li>
<li><a href="#21-references">21. References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="16-applications-of-signal-processing">16. Applications of Signal Processing<a class="header-link" href="#16-applications-of-signal-processing" title="Permanent link">&para;</a></h1>
<p><strong>Previous</strong>: <a href="./15_Image_Signal_Processing.md">15. Image Signal Processing</a> | <a href="./00_Overview.md">Overview</a></p>
<hr />
<p>Signal processing is not merely a theoretical discipline -- it is an engineering backbone that powers systems we use every day. This final lesson surveys four major application domains: audio, communications, radar/sonar, and biomedical signal processing. For each domain, we develop the key signal processing concepts, provide mathematical foundations, and implement working Python demonstrations. The goal is to show how the tools from the previous fifteen lessons come together in real systems.</p>
<p><strong>Difficulty</strong>: ‚≠ê‚≠ê‚≠ê</p>
<p><strong>Prerequisites</strong>: DFT/FFT, filtering (FIR/IIR), modulation basics, correlation, spectral analysis</p>
<p><strong>Learning Objectives</strong>:
- Understand audio signal representation and implement digital audio effects
- Implement pitch detection using autocorrelation and cepstrum methods
- Describe analog and digital modulation schemes (AM, FM, ASK, FSK, PSK, QAM)
- Explain pulse shaping, matched filtering, and OFDM fundamentals
- Apply matched filtering and chirp compression to radar signal processing
- Compute and interpret the ambiguity function for radar waveform design
- Process biomedical signals (ECG, EEG) using the techniques from this course
- Implement working demonstrations of each application in Python</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-audio-signal-processing">Audio Signal Processing</a></li>
<li><a href="#2-audio-representation-and-formats">Audio Representation and Formats</a></li>
<li><a href="#3-digital-audio-effects">Digital Audio Effects</a></li>
<li><a href="#4-pitch-detection">Pitch Detection</a></li>
<li><a href="#5-audio-equalization">Audio Equalization</a></li>
<li><a href="#6-speech-coding-linear-predictive-coding-lpc">Speech Coding: Linear Predictive Coding (LPC)</a></li>
<li><a href="#7-communications-analog-modulation">Communications: Analog Modulation</a></li>
<li><a href="#8-communications-digital-modulation">Communications: Digital Modulation</a></li>
<li><a href="#9-pulse-shaping-and-matched-filtering">Pulse Shaping and Matched Filtering</a></li>
<li><a href="#10-channel-models-and-equalization">Channel Models and Equalization</a></li>
<li><a href="#11-ofdm-fundamentals">OFDM Fundamentals</a></li>
<li><a href="#12-radar-signal-processing">Radar Signal Processing</a></li>
<li><a href="#13-chirp-signals-and-pulse-compression">Chirp Signals and Pulse Compression</a></li>
<li><a href="#14-the-ambiguity-function">The Ambiguity Function</a></li>
<li><a href="#15-biomedical-signal-processing-ecg">Biomedical Signal Processing: ECG</a></li>
<li><a href="#16-biomedical-signal-processing-eeg">Biomedical Signal Processing: EEG</a></li>
<li><a href="#17-heart-rate-variability-hrv">Heart Rate Variability (HRV)</a></li>
<li><a href="#18-python-implementations">Python Implementations</a></li>
<li><a href="#19-exercises">Exercises</a></li>
<li><a href="#20-summary">Summary</a></li>
<li><a href="#21-references">References</a></li>
</ol>
<hr />
<h2 id="1-audio-signal-processing">1. Audio Signal Processing<a class="header-link" href="#1-audio-signal-processing" title="Permanent link">&para;</a></h2>
<h3 id="11-the-audio-signal-chain">1.1 The Audio Signal Chain<a class="header-link" href="#11-the-audio-signal-chain" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Sound Source ‚Üí Microphone ‚Üí ADC ‚Üí Digital Processing ‚Üí DAC ‚Üí Amplifier ‚Üí Speaker
  (analog)     (transducer)       (DSP algorithms)        (transducer)    (analog)
</code></pre></div>

<p>Audio signal processing operates on digital representations of sound waves. The key parameters are:</p>
<ul>
<li><strong>Sampling rate</strong> ($f_s$): 44.1 kHz (CD), 48 kHz (professional), 96/192 kHz (high-res)</li>
<li><strong>Bit depth</strong>: 16-bit (CD), 24-bit (professional), 32-bit float (internal processing)</li>
<li><strong>Channels</strong>: Mono (1), Stereo (2), Surround (5.1, 7.1), Spatial (Ambisonics)</li>
</ul>
<h3 id="12-frequency-ranges">1.2 Frequency Ranges<a class="header-link" href="#12-frequency-ranges" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Range</th>
<th>Frequency</th>
<th>Musical Context</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sub-bass</td>
<td>20-60 Hz</td>
<td>Felt more than heard</td>
</tr>
<tr>
<td>Bass</td>
<td>60-250 Hz</td>
<td>Kick drum, bass guitar</td>
</tr>
<tr>
<td>Low mid</td>
<td>250-500 Hz</td>
<td>Warmth, body of instruments</td>
</tr>
<tr>
<td>Mid</td>
<td>500 Hz - 2 kHz</td>
<td>Vocal clarity, presence</td>
</tr>
<tr>
<td>Upper mid</td>
<td>2-4 kHz</td>
<td>Perceived loudness, attack</td>
</tr>
<tr>
<td>Presence</td>
<td>4-6 kHz</td>
<td>Definition, clarity</td>
</tr>
<tr>
<td>Brilliance</td>
<td>6-20 kHz</td>
<td>Air, sparkle, sibilance</td>
</tr>
</tbody>
</table>
<p>Human hearing spans approximately 20 Hz to 20 kHz, with maximum sensitivity around 2-5 kHz (the ear canal resonance).</p>
<hr />
<h2 id="2-audio-representation-and-formats">2. Audio Representation and Formats<a class="header-link" href="#2-audio-representation-and-formats" title="Permanent link">&para;</a></h2>
<h3 id="21-pulse-code-modulation-pcm">2.1 Pulse Code Modulation (PCM)<a class="header-link" href="#21-pulse-code-modulation-pcm" title="Permanent link">&para;</a></h3>
<p>PCM is the standard uncompressed digital audio representation:</p>
<ol>
<li><strong>Sample</strong>: Analog signal sampled at rate $f_s$</li>
<li><strong>Quantize</strong>: Each sample mapped to one of $2^B$ levels (for $B$-bit resolution)</li>
<li><strong>Encode</strong>: Binary representation of each quantized sample</li>
</ol>
<p>The <strong>signal-to-quantization-noise ratio (SQNR)</strong> for a full-scale sinusoid:</p>
<p>$$\text{SQNR} = 6.02B + 1.76 \text{ dB}$$</p>
<p>For 16-bit audio: $\text{SQNR} \approx 98$ dB. For 24-bit: $\text{SQNR} \approx 146$ dB.</p>
<h3 id="22-data-rate">2.2 Data Rate<a class="header-link" href="#22-data-rate" title="Permanent link">&para;</a></h3>
<p>Uncompressed data rate:</p>
<p>$$R = f_s \times B \times C$$</p>
<p>where $C$ is the number of channels.</p>
<p>For CD audio (44.1 kHz, 16-bit, stereo): $R = 44100 \times 16 \times 2 = 1.41$ Mbps.</p>
<h3 id="23-dithering">2.3 Dithering<a class="header-link" href="#23-dithering" title="Permanent link">&para;</a></h3>
<p>When reducing bit depth, <strong>dithering</strong> adds a small amount of noise before quantization to convert distortion (harmonic) into noise (broadband). This trades a slight increase in noise floor for the elimination of quantization distortion artifacts.</p>
<p>The dither noise is typically triangular probability density function (TPDF) with amplitude of $\pm 1$ LSB.</p>
<hr />
<h2 id="3-digital-audio-effects">3. Digital Audio Effects<a class="header-link" href="#3-digital-audio-effects" title="Permanent link">&para;</a></h2>
<h3 id="31-delay-based-effects">3.1 Delay-Based Effects<a class="header-link" href="#31-delay-based-effects" title="Permanent link">&para;</a></h3>
<p>Most audio effects are built from delay lines:</p>
<p>$$y[n] = x[n] + g \cdot x[n - D]$$</p>
<p>where $D$ is the delay in samples and $g$ is the feedback/feedforward gain.</p>
<h4 id="echodelay">Echo/Delay<a class="header-link" href="#echodelay" title="Permanent link">&para;</a></h4>
<p>Simple delay with feedback:</p>
<p>$$y[n] = x[n] + g \cdot y[n - D]$$</p>
<p>For an audible echo: $D > 50$ ms ($D > 0.05 f_s$ samples).</p>
<h4 id="reverb">Reverb<a class="header-link" href="#reverb" title="Permanent link">&para;</a></h4>
<p>Reverb simulates the acoustic response of a room. The simplest model uses comb filters and allpass filters (Schroeder reverberator):</p>
<p><strong>Comb filter</strong> (feedback):
$$y[n] = x[n] + g \cdot y[n - D]$$</p>
<p><strong>Allpass filter</strong>:
$$y[n] = -g \cdot x[n] + x[n - D] + g \cdot y[n - D]$$</p>
<p>The Schroeder reverberator cascades 4 parallel comb filters followed by 2 series allpass filters.</p>
<p>More sophisticated reverb uses <strong>convolution reverb</strong>: convolve the dry signal with a measured room impulse response (RIR).</p>
<h3 id="32-modulation-based-effects">3.2 Modulation-Based Effects<a class="header-link" href="#32-modulation-based-effects" title="Permanent link">&para;</a></h3>
<h4 id="chorus">Chorus<a class="header-link" href="#chorus" title="Permanent link">&para;</a></h4>
<p>The chorus effect simulates multiple instruments playing the same note by mixing the original signal with a delayed copy whose delay is slowly modulated:</p>
<p>$$y[n] = x[n] + g \cdot x[n - D(n)]$$</p>
<p>where $D(n) = D_0 + A \sin(2\pi f_{LFO} n / f_s)$ with $D_0 \approx 20$-30 ms, $A \approx 1$-5 ms, $f_{LFO} \approx 0.5$-3 Hz.</p>
<h4 id="flanger">Flanger<a class="header-link" href="#flanger" title="Permanent link">&para;</a></h4>
<p>Similar to chorus but with shorter delays and feedback:</p>
<p>$$y[n] = x[n] + g \cdot y[n - D(n)]$$</p>
<p>with $D_0 \approx 1$-10 ms, creating a sweeping comb filter effect.</p>
<h4 id="vibrato">Vibrato<a class="header-link" href="#vibrato" title="Permanent link">&para;</a></h4>
<p>Pure pitch modulation (no dry signal mixed in):</p>
<p>$$y[n] = x[n - D(n)]$$</p>
<p>with sinusoidal delay modulation.</p>
<h3 id="33-dynamics-processing">3.3 Dynamics Processing<a class="header-link" href="#33-dynamics-processing" title="Permanent link">&para;</a></h3>
<h4 id="compressor">Compressor<a class="header-link" href="#compressor" title="Permanent link">&para;</a></h4>
<p>Reduces the dynamic range by attenuating signals above a threshold:</p>
<p>$$g_{dB}[n] = \begin{cases} 0 & x_{dB}[n] < T \\ (1 - 1/R)(T - x_{dB}[n]) & x_{dB}[n] \geq T \end{cases}$$</p>
<p>where $T$ is the threshold and $R$ is the compression ratio.</p>
<p><strong>Parameters</strong>:
- <strong>Threshold</strong>: Level above which compression begins
- <strong>Ratio</strong>: Amount of compression (2:1, 4:1, $\infty$:1 = limiter)
- <strong>Attack</strong>: How quickly the compressor responds
- <strong>Release</strong>: How quickly the compressor returns to unity gain
- <strong>Knee</strong>: Hard or soft transition at the threshold</p>
<p>The attack and release are implemented with an envelope follower using exponential smoothing:</p>
<p>$$x_{env}[n] = \begin{cases} \alpha_a x_{env}[n-1] + (1-\alpha_a)|x[n]| & |x[n]| > x_{env}[n-1] \\ \alpha_r x_{env}[n-1] + (1-\alpha_r)|x[n]| & |x[n]| \leq x_{env}[n-1] \end{cases}$$</p>
<p>where $\alpha_a = e^{-1/(f_s \cdot t_{attack})}$ and $\alpha_r = e^{-1/(f_s \cdot t_{release})}$.</p>
<hr />
<h2 id="4-pitch-detection">4. Pitch Detection<a class="header-link" href="#4-pitch-detection" title="Permanent link">&para;</a></h2>
<h3 id="41-autocorrelation-method">4.1 Autocorrelation Method<a class="header-link" href="#41-autocorrelation-method" title="Permanent link">&para;</a></h3>
<p>The fundamental frequency of a periodic signal can be detected from the autocorrelation function:</p>
<p>$$R_{xx}[\tau] = \sum_{n=0}^{N-1} x[n] \cdot x[n + \tau]$$</p>
<p>For a periodic signal with period $T_0$ (in samples), $R_{xx}[\tau]$ has peaks at $\tau = 0, T_0, 2T_0, \ldots$. The fundamental frequency is:</p>
<p>$$f_0 = \frac{f_s}{T_0}$$</p>
<p><strong>Algorithm</strong>:
1. Window the signal (Hann window, 20-50 ms frame)
2. Compute the autocorrelation
3. Find the first significant peak after the origin
4. The peak location gives $T_0$</p>
<p><strong>Pitch range constraint</strong>: For speech, $f_0 \in [80, 400]$ Hz, so search for peaks in $\tau \in [f_s/400, f_s/80]$.</p>
<h3 id="42-cepstrum-method">4.2 Cepstrum Method<a class="header-link" href="#42-cepstrum-method" title="Permanent link">&para;</a></h3>
<p>The <strong>cepstrum</strong> (anagram of "spectrum") is defined as:</p>
<p>$$c[n] = \text{IDFT}\{\log|\text{DFT}\{x[n]\}|\}$$</p>
<p>The independent variable $n$ in the cepstrum domain is called <strong>quefrency</strong> (anagram of "frequency") and has units of samples (or time).</p>
<p>For a voiced speech signal, the cepstrum separates the <strong>vocal tract envelope</strong> (low quefrency) from the <strong>pitch excitation</strong> (peak at quefrency = pitch period):</p>
<div class="highlight"><pre><span></span><code>Speech spectrum = Vocal tract envelope √ó Pitch harmonics
    (smooth)              (fine structure)

log(Speech spectrum) = log(Envelope) + log(Harmonics)
    cepstrum domain:    low quefrency   + peak at T‚ÇÄ
</code></pre></div>

<p><strong>Algorithm</strong>:
1. Compute DFT of windowed frame
2. Take log of magnitude spectrum
3. Compute IDFT (cepstrum)
4. Find peak in the expected pitch range
5. Peak quefrency = pitch period $T_0$</p>
<h3 id="43-comparison">4.3 Comparison<a class="header-link" href="#43-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td>Autocorrelation</td>
<td>Robust, simple</td>
<td>Octave errors, broad peaks</td>
</tr>
<tr>
<td>Cepstrum</td>
<td>Good separation of source/filter</td>
<td>Sensitivity to noise, resolution limited</td>
</tr>
<tr>
<td>YIN (improved AC)</td>
<td>State-of-the-art accuracy</td>
<td>More complex</td>
</tr>
<tr>
<td>pYIN</td>
<td>Probabilistic, very robust</td>
<td>Computational cost</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5-audio-equalization">5. Audio Equalization<a class="header-link" href="#5-audio-equalization" title="Permanent link">&para;</a></h2>
<h3 id="51-graphic-equalizer">5.1 Graphic Equalizer<a class="header-link" href="#51-graphic-equalizer" title="Permanent link">&para;</a></h3>
<p>A graphic equalizer consists of parallel bandpass filters at fixed center frequencies (typically at octave or 1/3-octave intervals). Each band has an adjustable gain.</p>
<p>Standard octave-band center frequencies: 31.5, 63, 125, 250, 500, 1000, 2000, 4000, 8000, 16000 Hz.</p>
<h3 id="52-parametric-equalizer">5.2 Parametric Equalizer<a class="header-link" href="#52-parametric-equalizer" title="Permanent link">&para;</a></h3>
<p>A parametric equalizer provides adjustable <strong>center frequency</strong>, <strong>gain</strong>, and <strong>bandwidth</strong> (Q factor) for each band:</p>
<p><strong>Peaking (bell) filter</strong> (second-order IIR):</p>
<p>$$H(z) = \frac{1 + \alpha A \cdot z^{-1} \cdot b_1 + \alpha z^{-2}}{1 + \alpha/A \cdot z^{-1} \cdot a_1 + \alpha z^{-2}}$$</p>
<p>where $A = 10^{G_{dB}/40}$, $\omega_0 = 2\pi f_0/f_s$, $\alpha = \sin(\omega_0)/(2Q)$.</p>
<p>Cookbook biquad coefficients for a peaking EQ:</p>
<p>$$b_0 = 1 + \alpha A, \quad b_1 = -2\cos\omega_0, \quad b_2 = 1 - \alpha A$$
$$a_0 = 1 + \alpha/A, \quad a_1 = -2\cos\omega_0, \quad a_2 = 1 - \alpha/A$$</p>
<h3 id="53-shelving-filters">5.3 Shelving Filters<a class="header-link" href="#53-shelving-filters" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Low shelf</strong>: Boosts/cuts frequencies below $f_0$</li>
<li><strong>High shelf</strong>: Boosts/cuts frequencies above $f_0$</li>
</ul>
<p>Used for bass and treble controls on audio equipment.</p>
<hr />
<h2 id="6-speech-coding-linear-predictive-coding-lpc">6. Speech Coding: Linear Predictive Coding (LPC)<a class="header-link" href="#6-speech-coding-linear-predictive-coding-lpc" title="Permanent link">&para;</a></h2>
<h3 id="61-the-source-filter-model">6.1 The Source-Filter Model<a class="header-link" href="#61-the-source-filter-model" title="Permanent link">&para;</a></h3>
<p>Speech production is modeled as:</p>
<p>$$\text{Excitation source} \to \text{Vocal tract filter} \to \text{Speech signal}$$</p>
<ul>
<li><strong>Voiced sounds</strong> (vowels): Excitation = periodic pulse train at pitch frequency</li>
<li><strong>Unvoiced sounds</strong> (fricatives): Excitation = white noise</li>
<li><strong>Vocal tract</strong>: All-pole filter (resonant tube model)</li>
</ul>
<h3 id="62-linear-prediction">6.2 Linear Prediction<a class="header-link" href="#62-linear-prediction" title="Permanent link">&para;</a></h3>
<p>The current sample is predicted from past samples:</p>
<p>$$\hat{x}[n] = \sum_{k=1}^{p} a_k x[n-k]$$</p>
<p>The prediction error (residual) is:</p>
<p>$$e[n] = x[n] - \hat{x}[n] = x[n] - \sum_{k=1}^{p} a_k x[n-k]$$</p>
<p>The LPC coefficients $\{a_k\}$ are chosen to minimize $E[e^2[n]]$.</p>
<h3 id="63-solving-for-lpc-coefficients">6.3 Solving for LPC Coefficients<a class="header-link" href="#63-solving-for-lpc-coefficients" title="Permanent link">&para;</a></h3>
<p>Minimizing the prediction error leads to the <strong>Yule-Walker (normal) equations</strong>:</p>
<p>$$\mathbf{R}\mathbf{a} = \mathbf{r}$$</p>
<p>where $\mathbf{R}$ is the Toeplitz autocorrelation matrix and $\mathbf{r}$ is the autocorrelation vector.</p>
<p>The <strong>Levinson-Durbin algorithm</strong> solves this in $O(p^2)$ operations, exploiting the Toeplitz structure.</p>
<h3 id="64-lpc-vocoder">6.4 LPC Vocoder<a class="header-link" href="#64-lpc-vocoder" title="Permanent link">&para;</a></h3>
<p>The LPC vocoder transmits only:
1. <strong>LPC coefficients</strong> ($\{a_k\}$, typically $p = 10$-16 for narrowband speech)
2. <strong>Pitch period</strong> (for voiced frames)
3. <strong>Voiced/unvoiced flag</strong>
4. <strong>Gain</strong> (energy of the frame)</p>
<p>This achieves very low bit rates (2.4 kbps for LPC-10) at the cost of speech quality.</p>
<h3 id="65-lpc-spectrum">6.5 LPC Spectrum<a class="header-link" href="#65-lpc-spectrum" title="Permanent link">&para;</a></h3>
<p>The LPC model represents the vocal tract as an all-pole filter:</p>
<p>$$H(z) = \frac{G}{1 - \sum_{k=1}^{p} a_k z^{-k}} = \frac{G}{A(z)}$$</p>
<p>The LPC spectrum $|H(e^{j\omega})|^2$ provides a smooth spectral envelope of the speech signal. The poles of $H(z)$ correspond to the <strong>formant frequencies</strong> (resonances of the vocal tract).</p>
<hr />
<h2 id="7-communications-analog-modulation">7. Communications: Analog Modulation<a class="header-link" href="#7-communications-analog-modulation" title="Permanent link">&para;</a></h2>
<h3 id="71-why-modulation">7.1 Why Modulation?<a class="header-link" href="#71-why-modulation" title="Permanent link">&para;</a></h3>
<p>Modulation shifts a baseband signal to a higher carrier frequency for:
1. <strong>Antenna efficiency</strong>: Antenna size $\sim \lambda/4$; higher frequency = smaller antenna
2. <strong>Frequency division multiplexing</strong>: Multiple signals share the spectrum
3. <strong>Noise performance</strong>: Some modulation schemes provide noise improvement</p>
<h3 id="72-amplitude-modulation-am">7.2 Amplitude Modulation (AM)<a class="header-link" href="#72-amplitude-modulation-am" title="Permanent link">&para;</a></h3>
<p>The AM signal is:</p>
<p>$$x_{AM}(t) = [1 + m \cdot x(t)] \cos(2\pi f_c t)$$</p>
<p>where:
- $f_c$ is the carrier frequency
- $m$ is the modulation index ($0 < m \leq 1$ for no distortion)
- $x(t)$ is the normalized message signal ($|x(t)| \leq 1$)</p>
<p><strong>Spectrum</strong>: The AM spectrum consists of the carrier plus upper and lower sidebands:
$$X_{AM}(f) = \frac{1}{2}\delta(f - f_c) + \frac{m}{4}[X(f - f_c) + X(f + f_c)]$$</p>
<p><strong>Bandwidth</strong>: $B_{AM} = 2W$ where $W$ is the message bandwidth.</p>
<p><strong>Demodulation</strong>: Envelope detection (simple diode + RC circuit).</p>
<h3 id="73-frequency-modulation-fm">7.3 Frequency Modulation (FM)<a class="header-link" href="#73-frequency-modulation-fm" title="Permanent link">&para;</a></h3>
<p>The FM signal is:</p>
<p>$$x_{FM}(t) = A_c \cos\!\left(2\pi f_c t + 2\pi k_f \int_0^t x(\tau) \, d\tau\right)$$</p>
<p>where $k_f$ is the frequency deviation constant (Hz/V).</p>
<p>The <strong>instantaneous frequency</strong> is:</p>
<p>$$f_i(t) = f_c + k_f x(t)$$</p>
<p><strong>Bandwidth</strong> (Carson's rule):</p>
<p>$$B_{FM} \approx 2(\Delta f + W) = 2W(\beta + 1)$$</p>
<p>where $\Delta f = k_f \max|x(t)|$ is the peak frequency deviation and $\beta = \Delta f / W$ is the modulation index.</p>
<p><strong>Advantages of FM over AM</strong>:
- Constant envelope (no amplitude variation) -- robust to nonlinear amplifiers
- Better noise performance (FM captures noise as amplitude variation, which is removed by limiting)
- Capture effect: stronger signal suppresses weaker interferers</p>
<h3 id="74-phase-modulation-pm">7.4 Phase Modulation (PM)<a class="header-link" href="#74-phase-modulation-pm" title="Permanent link">&para;</a></h3>
<p>$$x_{PM}(t) = A_c \cos\!\left(2\pi f_c t + k_p x(t)\right)$$</p>
<p>PM and FM are related: FM of $x(t)$ is equivalent to PM of $\int x(t)dt$.</p>
<hr />
<h2 id="8-communications-digital-modulation">8. Communications: Digital Modulation<a class="header-link" href="#8-communications-digital-modulation" title="Permanent link">&para;</a></h2>
<h3 id="81-digital-modulation-overview">8.1 Digital Modulation Overview<a class="header-link" href="#81-digital-modulation-overview" title="Permanent link">&para;</a></h3>
<p>Digital modulation maps discrete symbols to analog waveforms for transmission:</p>
<table>
<thead>
<tr>
<th>Scheme</th>
<th>What Varies</th>
<th>Constellation</th>
</tr>
</thead>
<tbody>
<tr>
<td>ASK (Amplitude Shift Keying)</td>
<td>Amplitude</td>
<td>Points on real axis</td>
</tr>
<tr>
<td>FSK (Frequency Shift Keying)</td>
<td>Frequency</td>
<td>Orthogonal signals</td>
</tr>
<tr>
<td>PSK (Phase Shift Keying)</td>
<td>Phase</td>
<td>Points on unit circle</td>
</tr>
<tr>
<td>QAM (Quadrature Amplitude Modulation)</td>
<td>Amplitude + Phase</td>
<td>Grid in I-Q plane</td>
</tr>
</tbody>
</table>
<h3 id="82-binary-phase-shift-keying-bpsk">8.2 Binary Phase Shift Keying (BPSK)<a class="header-link" href="#82-binary-phase-shift-keying-bpsk" title="Permanent link">&para;</a></h3>
<p>The simplest PSK scheme maps bits to antipodal signals:</p>
<p>$$s(t) = \begin{cases} +A\cos(2\pi f_c t) & \text{bit } 1 \\ -A\cos(2\pi f_c t) & \text{bit } 0 \end{cases}$$</p>
<p><strong>Bit error rate</strong> in AWGN:</p>
<p>$$P_b = Q\!\left(\sqrt{\frac{2E_b}{N_0}}\right) = \frac{1}{2}\text{erfc}\!\left(\sqrt{\frac{E_b}{N_0}}\right)$$</p>
<p>where $E_b$ is the energy per bit and $N_0$ is the noise power spectral density.</p>
<h3 id="83-quadrature-phase-shift-keying-qpsk">8.3 Quadrature Phase Shift Keying (QPSK)<a class="header-link" href="#83-quadrature-phase-shift-keying-qpsk" title="Permanent link">&para;</a></h3>
<p>QPSK maps pairs of bits (dibits) to four phase states:</p>
<p>$$s_k(t) = A\cos\!\left(2\pi f_c t + \frac{\pi}{4} + \frac{k\pi}{2}\right), \quad k = 0, 1, 2, 3$$</p>
<p><strong>Constellation</strong>: 4 points at angles $\{\pi/4, 3\pi/4, 5\pi/4, 7\pi/4\}$.</p>
<p>QPSK has the <strong>same BER as BPSK</strong> but carries <strong>twice the data rate</strong> in the same bandwidth.</p>
<h3 id="84-quadrature-amplitude-modulation-qam">8.4 Quadrature Amplitude Modulation (QAM)<a class="header-link" href="#84-quadrature-amplitude-modulation-qam" title="Permanent link">&para;</a></h3>
<p>$M$-QAM uses both amplitude and phase to map $\log_2 M$ bits per symbol:</p>
<p>$$s(t) = A_I \cos(2\pi f_c t) - A_Q \sin(2\pi f_c t)$$</p>
<p>where $(A_I, A_Q)$ are chosen from a regular grid.</p>
<p><strong>16-QAM</strong>: 4 bits per symbol, 16 constellation points in a $4 \times 4$ grid.</p>
<p><strong>64-QAM</strong>: 6 bits per symbol (used in WiFi, cable TV).</p>
<p><strong>256-QAM</strong>: 8 bits per symbol (high-throughput WiFi).</p>
<p>The tradeoff: higher $M$ gives higher spectral efficiency but requires higher SNR.</p>
<h3 id="85-i-q-representation">8.5 I-Q Representation<a class="header-link" href="#85-i-q-representation" title="Permanent link">&para;</a></h3>
<p>Any bandpass signal can be represented as:</p>
<p>$$s(t) = I(t)\cos(2\pi f_c t) - Q(t)\sin(2\pi f_c t)$$</p>
<p>where $I(t)$ is the <strong>in-phase</strong> component and $Q(t)$ is the <strong>quadrature</strong> component. The complex baseband equivalent is:</p>
<p>$$\tilde{s}(t) = I(t) + jQ(t)$$</p>
<p>All digital modulation schemes can be described as mapping symbols to points in the $I$-$Q$ plane.</p>
<hr />
<h2 id="9-pulse-shaping-and-matched-filtering">9. Pulse Shaping and Matched Filtering<a class="header-link" href="#9-pulse-shaping-and-matched-filtering" title="Permanent link">&para;</a></h2>
<h3 id="91-the-inter-symbol-interference-isi-problem">9.1 The Inter-Symbol Interference (ISI) Problem<a class="header-link" href="#91-the-inter-symbol-interference-isi-problem" title="Permanent link">&para;</a></h3>
<p>When digital symbols are transmitted as pulses, the tails of one symbol's pulse can interfere with adjacent symbols:</p>
<p>$$r(t) = \sum_k a_k \, p(t - kT_s)$$</p>
<p>where $a_k$ are symbol values, $p(t)$ is the pulse shape, and $T_s$ is the symbol period.</p>
<h3 id="92-nyquist-isi-criterion">9.2 Nyquist ISI Criterion<a class="header-link" href="#92-nyquist-isi-criterion" title="Permanent link">&para;</a></h3>
<p>A pulse $p(t)$ causes zero ISI at the sampling instants if:</p>
<p>$$p(kT_s) = \begin{cases} 1 & k = 0 \\ 0 & k \neq 0 \end{cases}$$</p>
<p>The sinc pulse $p(t) = \text{sinc}(t/T_s)$ achieves this with minimum bandwidth $W = 1/(2T_s)$, but it decays slowly and is impractical.</p>
<h3 id="93-raised-cosine-pulse">9.3 Raised Cosine Pulse<a class="header-link" href="#93-raised-cosine-pulse" title="Permanent link">&para;</a></h3>
<p>The raised cosine pulse provides zero ISI with faster decay:</p>
<p>$$P(f) = \begin{cases} T_s & |f| \leq \frac{1-\alpha}{2T_s} \\[6pt] \frac{T_s}{2}\left[1 + \cos\!\left(\frac{\pi T_s}{\alpha}\left(|f| - \frac{1-\alpha}{2T_s}\right)\right)\right] & \frac{1-\alpha}{2T_s} < |f| \leq \frac{1+\alpha}{2T_s} \\[6pt] 0 & |f| > \frac{1+\alpha}{2T_s} \end{cases}$$</p>
<p>where $\alpha \in [0, 1]$ is the <strong>rolloff factor</strong>.</p>
<p><strong>Bandwidth</strong>: $W = \frac{1+\alpha}{2T_s}$</p>
<p>In practice, the <strong>root-raised cosine (RRC)</strong> filter is split between transmitter and receiver: $P_{RRC}(f) = \sqrt{P_{RC}(f)}$. This way, $P_{TX}(f) \cdot P_{RX}(f) = P_{RC}(f)$, and the receiver filter is the matched filter for the transmitted pulse.</p>
<h3 id="94-matched-filter">9.4 Matched Filter<a class="header-link" href="#94-matched-filter" title="Permanent link">&para;</a></h3>
<p>The <strong>matched filter</strong> maximizes the output SNR for a known pulse $s(t)$ in additive white noise:</p>
<p>$$h_{matched}(t) = s^*(T - t)$$</p>
<p>The matched filter is the time-reversed, conjugated version of the signal, delayed by $T$.</p>
<p><strong>Output SNR</strong> of the matched filter:</p>
<p>$$\text{SNR}_{max} = \frac{2E_s}{N_0}$$</p>
<p>where $E_s = \int |s(t)|^2 \, dt$ is the signal energy. This is the maximum achievable SNR regardless of the filter.</p>
<hr />
<h2 id="10-channel-models-and-equalization">10. Channel Models and Equalization<a class="header-link" href="#10-channel-models-and-equalization" title="Permanent link">&para;</a></h2>
<h3 id="101-additive-white-gaussian-noise-awgn-channel">10.1 Additive White Gaussian Noise (AWGN) Channel<a class="header-link" href="#101-additive-white-gaussian-noise-awgn-channel" title="Permanent link">&para;</a></h3>
<p>$$r(t) = s(t) + n(t)$$</p>
<p>where $n(t)$ is white Gaussian noise with PSD $N_0/2$.</p>
<h3 id="102-multipath-channel">10.2 Multipath Channel<a class="header-link" href="#102-multipath-channel" title="Permanent link">&para;</a></h3>
<p>$$r(t) = \sum_{k=0}^{L-1} h_k \, s(t - \tau_k) + n(t)$$</p>
<p>The discrete-time equivalent:</p>
<p>$$r[n] = \sum_{k=0}^{L-1} h[k] \, s[n-k] + v[n] = (h * s)[n] + v[n]$$</p>
<p>Multipath causes:
- <strong>ISI</strong>: Delayed copies of the signal interfere with current symbols
- <strong>Frequency-selective fading</strong>: Some frequencies are attenuated more than others</p>
<h3 id="103-zero-forcing-zf-equalizer">10.3 Zero-Forcing (ZF) Equalizer<a class="header-link" href="#103-zero-forcing-zf-equalizer" title="Permanent link">&para;</a></h3>
<p>The ZF equalizer inverts the channel:</p>
<p>$$W_{ZF}(f) = \frac{1}{H(f)}$$</p>
<p><strong>Problem</strong>: Noise enhancement at frequencies where $|H(f)|$ is small.</p>
<h3 id="104-mmse-equalizer">10.4 MMSE Equalizer<a class="header-link" href="#104-mmse-equalizer" title="Permanent link">&para;</a></h3>
<p>$$W_{MMSE}(f) = \frac{H^*(f)}{|H(f)|^2 + N_0/E_s}$$</p>
<p>The MMSE equalizer balances ISI elimination with noise suppression. When $N_0 = 0$, it reduces to the ZF equalizer.</p>
<h3 id="105-adaptive-equalization">10.5 Adaptive Equalization<a class="header-link" href="#105-adaptive-equalization" title="Permanent link">&para;</a></h3>
<p>In practice, the channel is unknown and time-varying. Adaptive equalizers (LMS, RLS from Lesson 13) are used with:
- <strong>Training sequence</strong>: Known symbols for initial convergence
- <strong>Decision-directed mode</strong>: Use detected symbols as reference after convergence</p>
<hr />
<h2 id="11-ofdm-fundamentals">11. OFDM Fundamentals<a class="header-link" href="#11-ofdm-fundamentals" title="Permanent link">&para;</a></h2>
<h3 id="111-motivation">11.1 Motivation<a class="header-link" href="#111-motivation" title="Permanent link">&para;</a></h3>
<p>Orthogonal Frequency Division Multiplexing (OFDM) is the dominant modulation scheme for broadband wireless (WiFi, LTE, 5G) and wired (DSL, cable) communications.</p>
<p>The key idea: instead of transmitting one high-rate stream through a frequency-selective channel, transmit many low-rate streams on parallel narrowband subcarriers, each experiencing flat fading.</p>
<h3 id="112-ofdm-system-model">11.2 OFDM System Model<a class="header-link" href="#112-ofdm-system-model" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Transmitter</span><span class="o">:</span>
<span class="w">  </span><span class="n">Data</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">S</span><span class="sr">/P ‚Üí QAM Map ‚Üí IFFT ‚Üí Add CP ‚Üí P/</span><span class="n">S</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">DAC</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Channel</span>

<span class="n">Receiver</span><span class="o">:</span>
<span class="w">  </span><span class="n">ADC</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">S</span><span class="sr">/P ‚Üí Remove CP ‚Üí FFT ‚Üí QAM Demap ‚Üí P/</span><span class="n">S</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">Data</span>
</code></pre></div>

<p>The transmitted OFDM symbol (discrete time):</p>
<p>$$x[n] = \frac{1}{\sqrt{N}} \sum_{k=0}^{N-1} X[k] \, e^{j2\pi kn/N}, \quad n = 0, 1, \ldots, N-1$$</p>
<p>This is simply the <strong>IFFT</strong> of the frequency-domain data symbols $X[k]$.</p>
<h3 id="113-cyclic-prefix-cp">11.3 Cyclic Prefix (CP)<a class="header-link" href="#113-cyclic-prefix-cp" title="Permanent link">&para;</a></h3>
<p>The cyclic prefix copies the last $L_{CP}$ samples to the beginning of the OFDM symbol:</p>
<p>$$\tilde{x}[n] = x[n \mod N], \quad n = -L_{CP}, \ldots, N-1$$</p>
<p>Purpose: converts linear convolution (channel) into <strong>circular convolution</strong>, which is diagonalized by the DFT. This eliminates inter-symbol interference between OFDM symbols.</p>
<p><strong>Condition</strong>: $L_{CP} \geq L_{channel} - 1$ (CP length must be at least as long as the channel impulse response minus 1).</p>
<h3 id="114-one-tap-equalization">11.4 One-Tap Equalization<a class="header-link" href="#114-one-tap-equalization" title="Permanent link">&para;</a></h3>
<p>After removing the CP and taking the FFT at the receiver:</p>
<p>$$Y[k] = H[k] \cdot X[k] + V[k]$$</p>
<p>Each subcarrier sees a <strong>flat</strong> (scalar) channel $H[k]$. Equalization is trivial:</p>
<p>$$\hat{X}[k] = \frac{Y[k]}{H[k]}$$</p>
<p>This is the enormous advantage of OFDM: it reduces a complicated frequency-selective equalization problem to $N$ independent single-tap equalizations.</p>
<h3 id="115-ofdm-parameters-wifi-example">11.5 OFDM Parameters (WiFi Example)<a class="header-link" href="#115-ofdm-parameters-wifi-example" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>802.11a/g (20 MHz)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Subcarriers ($N$)</td>
<td>64</td>
</tr>
<tr>
<td>Data subcarriers</td>
<td>48</td>
</tr>
<tr>
<td>Pilot subcarriers</td>
<td>4</td>
</tr>
<tr>
<td>Subcarrier spacing</td>
<td>312.5 kHz</td>
</tr>
<tr>
<td>Symbol duration</td>
<td>3.2 $\mu$s</td>
</tr>
<tr>
<td>CP duration</td>
<td>0.8 $\mu$s</td>
</tr>
<tr>
<td>Total symbol</td>
<td>4.0 $\mu$s</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="12-radar-signal-processing">12. Radar Signal Processing<a class="header-link" href="#12-radar-signal-processing" title="Permanent link">&para;</a></h2>
<h3 id="121-radar-basics">12.1 Radar Basics<a class="header-link" href="#121-radar-basics" title="Permanent link">&para;</a></h3>
<p><strong>RADAR</strong>: Radio Detection and Ranging. A radar transmits a pulse, and the echo from a target reveals:</p>
<ul>
<li><strong>Range</strong>: $R = \frac{c \cdot \tau}{2}$ where $\tau$ is the round-trip delay and $c$ is the speed of light</li>
<li><strong>Velocity</strong>: Via the Doppler shift $f_d = \frac{2v_r}{\lambda}$ where $v_r$ is the radial velocity and $\lambda$ is the wavelength</li>
</ul>
<h3 id="122-range-resolution">12.2 Range Resolution<a class="header-link" href="#122-range-resolution" title="Permanent link">&para;</a></h3>
<p>The range resolution is determined by the bandwidth of the transmitted pulse:</p>
<p>$$\Delta R = \frac{c}{2B}$$</p>
<p>where $B$ is the signal bandwidth.</p>
<p>For a simple rectangular pulse of duration $\tau_p$:
- Bandwidth: $B \approx 1/\tau_p$
- Range resolution: $\Delta R = c\tau_p/2$</p>
<p><strong>The dilemma</strong>: Good range resolution requires a short pulse (wide bandwidth), but a short pulse has low energy, limiting detection range. Pulse compression resolves this.</p>
<h3 id="123-doppler-processing">12.3 Doppler Processing<a class="header-link" href="#123-doppler-processing" title="Permanent link">&para;</a></h3>
<p>For a moving target, the received signal has a frequency shift:</p>
<p>$$f_d = \frac{2v_r f_c}{c} = \frac{2v_r}{\lambda}$$</p>
<p>The velocity resolution from a coherent processing interval (CPI) of duration $T_{CPI}$:</p>
<p>$$\Delta v = \frac{\lambda}{2T_{CPI}}$$</p>
<h3 id="124-matched-filter-for-radar">12.4 Matched Filter for Radar<a class="header-link" href="#124-matched-filter-for-radar" title="Permanent link">&para;</a></h3>
<p>The radar receiver uses a matched filter to maximize the output SNR:</p>
<p>$$h_{MF}[n] = s^*[N-1-n]$$</p>
<p>The output of the matched filter is the <strong>cross-correlation</strong> of the received signal with the transmitted waveform:</p>
<p>$$y[n] = \sum_k r[k] \, s^*[k - n]$$</p>
<p>For a simple pulse, the matched filter output is a triangle with peak at the target delay.</p>
<hr />
<h2 id="13-chirp-signals-and-pulse-compression">13. Chirp Signals and Pulse Compression<a class="header-link" href="#13-chirp-signals-and-pulse-compression" title="Permanent link">&para;</a></h2>
<h3 id="131-the-linear-fm-chirp">13.1 The Linear FM Chirp<a class="header-link" href="#131-the-linear-fm-chirp" title="Permanent link">&para;</a></h3>
<p>A <strong>chirp</strong> (linear frequency modulated pulse) sweeps frequency linearly across the pulse duration:</p>
<p>$$s(t) = \text{rect}\!\left(\frac{t}{\tau_p}\right) \exp\!\left(j\pi \frac{B}{\tau_p} t^2\right) \exp(j2\pi f_c t)$$</p>
<p>The instantaneous frequency varies from $f_c - B/2$ to $f_c + B/2$ over the pulse duration $\tau_p$.</p>
<p><strong>Key property</strong>: The chirp has bandwidth $B$ and duration $\tau_p$, so its <strong>time-bandwidth product</strong> is:</p>
<p>$$\text{TBP} = B \tau_p \gg 1$$</p>
<h3 id="132-pulse-compression">13.2 Pulse Compression<a class="header-link" href="#132-pulse-compression" title="Permanent link">&para;</a></h3>
<p>The matched filter for a chirp compresses the long pulse into a short peak:</p>
<ul>
<li><strong>Input pulse</strong>: Duration $\tau_p$, bandwidth $B$</li>
<li><strong>Compressed pulse</strong>: Duration $\approx 1/B$, peak amplitude $\approx \sqrt{B\tau_p}$</li>
</ul>
<p>The <strong>compression ratio</strong> is:</p>
<p>$$\text{CR} = B\tau_p$$</p>
<p>The <strong>processing gain</strong> is:</p>
<p>$$G_p = 10\log_{10}(B\tau_p) \text{ dB}$$</p>
<p>Example: $\tau_p = 10$ $\mu$s, $B = 10$ MHz $\Rightarrow$ TBP = 100 $\Rightarrow$ processing gain = 20 dB.</p>
<h3 id="133-range-resolution-after-compression">13.3 Range Resolution After Compression<a class="header-link" href="#133-range-resolution-after-compression" title="Permanent link">&para;</a></h3>
<p>After pulse compression, the range resolution is:</p>
<p>$$\Delta R = \frac{c}{2B}$$</p>
<p>This is determined by the bandwidth $B$, not the pulse duration $\tau_p$. A long chirp pulse achieves the same range resolution as a short CW pulse, but with much more energy.</p>
<h3 id="134-sidelobes-and-windowing">13.4 Sidelobes and Windowing<a class="header-link" href="#134-sidelobes-and-windowing" title="Permanent link">&para;</a></h3>
<p>The compressed pulse has sidelobes (analogous to the sidelobes of a sinc function). Window functions (Hamming, Taylor, etc.) applied to the matched filter reduce sidelobes at the cost of slightly broader mainlobe (degraded resolution).</p>
<hr />
<h2 id="14-the-ambiguity-function">14. The Ambiguity Function<a class="header-link" href="#14-the-ambiguity-function" title="Permanent link">&para;</a></h2>
<h3 id="141-definition">14.1 Definition<a class="header-link" href="#141-definition" title="Permanent link">&para;</a></h3>
<p>The <strong>ambiguity function</strong> describes a radar waveform's ability to simultaneously resolve targets in range and velocity:</p>
<p>$$\chi(\tau, f_d) = \int_{-\infty}^{\infty} s(t) \, s^*(t - \tau) \, e^{j2\pi f_d t} \, dt$$</p>
<p>where $\tau$ is the time delay (range) and $f_d$ is the Doppler frequency (velocity).</p>
<h3 id="142-properties">14.2 Properties<a class="header-link" href="#142-properties" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Maximum at origin</strong>: $|\chi(0, 0)| = E_s$ (signal energy)</li>
<li><strong>Volume invariance</strong>: $\iint |\chi(\tau, f_d)|^2 \, d\tau \, df_d = E_s^2$</li>
<li><strong>Symmetry</strong>: $|\chi(\tau, f_d)| = |\chi(-\tau, -f_d)|$</li>
</ol>
<p>The volume invariance property means that the ambiguity function is a fixed-volume surface: sharpening in one dimension necessarily broadens another. This is the radar analogue of the uncertainty principle.</p>
<h3 id="143-ambiguity-functions-of-common-waveforms">14.3 Ambiguity Functions of Common Waveforms<a class="header-link" href="#143-ambiguity-functions-of-common-waveforms" title="Permanent link">&para;</a></h3>
<p><strong>CW pulse</strong> (rectangular):
- Thumbtack-like along $\tau$ axis (width $\sim \tau_p$)
- Sinc-like along $f_d$ axis (width $\sim 1/\tau_p$)
- Good Doppler resolution, poor range resolution (for long $\tau_p$)</p>
<p><strong>Linear FM chirp</strong>:
- Narrow along a diagonal ridge (range-Doppler coupling)
- Good range resolution (determined by $B$)
- The ridge means a Doppler shift looks like a range shift -- must be compensated</p>
<p><strong>Phase-coded waveforms</strong> (e.g., Barker codes):
- Thumbtack-like ambiguity function
- Low sidelobes in both range and Doppler
- Limited to specific code lengths</p>
<h3 id="144-waveform-design">14.4 Waveform Design<a class="header-link" href="#144-waveform-design" title="Permanent link">&para;</a></h3>
<p>The ideal ambiguity function would be a single spike at the origin (perfect resolution in both range and velocity), but the volume invariance property forbids this. Waveform design involves choosing the shape that best suits the application:</p>
<ul>
<li><strong>Surveillance radar</strong>: Need good Doppler resolution $\to$ long CW pulse</li>
<li><strong>Tracking radar</strong>: Need good range resolution $\to$ chirp</li>
<li><strong>Pulse-Doppler radar</strong>: Need both $\to$ coherent train of chirp pulses</li>
</ul>
<hr />
<h2 id="15-biomedical-signal-processing-ecg">15. Biomedical Signal Processing: ECG<a class="header-link" href="#15-biomedical-signal-processing-ecg" title="Permanent link">&para;</a></h2>
<h3 id="151-the-ecg-signal">15.1 The ECG Signal<a class="header-link" href="#151-the-ecg-signal" title="Permanent link">&para;</a></h3>
<p>The electrocardiogram (ECG or EKG) records the electrical activity of the heart. A single cardiac cycle produces the characteristic PQRST waveform:</p>
<div class="highlight"><pre><span></span><code>    R
    ‚ñ≤
    ‚îÇ‚ï≤
    ‚îÇ ‚ï≤
    ‚îÇ  ‚ï≤
    ‚îÇ   ‚ï≤      T
P   ‚îÇ    ‚ï≤    ‚ï±‚ï≤
‚ï±‚ï≤  ‚îÇ     ‚ï≤  ‚ï±  ‚ï≤
    ‚îÇ      ‚ï≤‚ï±    ‚ï≤
‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄS‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ baseline
    Q

P wave: Atrial depolarization        (0.08-0.10 s)
QRS:    Ventricular depolarization    (0.06-0.10 s)
T wave: Ventricular repolarization    (0.16 s)
PR interval: AV conduction time       (0.12-0.20 s)
QT interval: Ventricular activity     (0.30-0.44 s)
</code></pre></div>

<h3 id="152-ecg-signal-characteristics">15.2 ECG Signal Characteristics<a class="header-link" href="#152-ecg-signal-characteristics" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Amplitude</td>
<td>0.1 - 5 mV</td>
</tr>
<tr>
<td>Bandwidth</td>
<td>0.05 - 150 Hz</td>
</tr>
<tr>
<td>Typical sampling rate</td>
<td>250 - 1000 Hz</td>
</tr>
<tr>
<td>Heart rate</td>
<td>60-100 bpm (1-1.67 Hz)</td>
</tr>
</tbody>
</table>
<h3 id="153-ecg-noise-sources">15.3 ECG Noise Sources<a class="header-link" href="#153-ecg-noise-sources" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Baseline wander</strong>: Low-frequency drift from respiration, body movement (&lt; 0.5 Hz)</li>
<li><strong>Powerline interference</strong>: 50/60 Hz and harmonics</li>
<li><strong>Muscle noise (EMG)</strong>: Broadband, 20-500 Hz</li>
<li><strong>Motion artifacts</strong>: Electrode movement, broadband</li>
</ol>
<h3 id="154-ecg-preprocessing-pipeline">15.4 ECG Preprocessing Pipeline<a class="header-link" href="#154-ecg-preprocessing-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Raw ECG ‚Üí Baseline removal ‚Üí Notch filter ‚Üí Bandpass filter ‚Üí QRS detection
           (highpass 0.5 Hz)  (50/60 Hz)    (0.5-40 Hz)      (Pan-Tompkins)
</code></pre></div>

<p><strong>Baseline wander removal</strong>: Highpass filter with cutoff 0.5 Hz (or median filter with 200 ms and 600 ms windows).</p>
<p><strong>Powerline interference</strong>: Notch filter at 50 or 60 Hz (narrow bandstop IIR filter).</p>
<h3 id="155-qrs-detection-pan-tompkins-algorithm">15.5 QRS Detection: Pan-Tompkins Algorithm<a class="header-link" href="#155-qrs-detection-pan-tompkins-algorithm" title="Permanent link">&para;</a></h3>
<p>The Pan-Tompkins algorithm (1985) is the standard QRS detector:</p>
<ol>
<li><strong>Bandpass filter</strong> (5-15 Hz): Maximizes QRS energy while suppressing P/T waves and noise</li>
<li><strong>Differentiation</strong>: Emphasizes the steep QRS slopes: $y[n] = \frac{1}{8}(-x[n-2] - 2x[n-1] + 2x[n+1] + x[n+2])$</li>
<li><strong>Squaring</strong>: $z[n] = y[n]^2$ (makes all values positive, emphasizes large slopes)</li>
<li><strong>Moving window integration</strong>: $w[n] = \frac{1}{N}\sum_{k=0}^{N-1} z[n-k]$ with $N \approx 150$ ms</li>
<li><strong>Adaptive thresholding</strong>: Two thresholds that adapt to the signal and noise levels</li>
</ol>
<hr />
<h2 id="16-biomedical-signal-processing-eeg">16. Biomedical Signal Processing: EEG<a class="header-link" href="#16-biomedical-signal-processing-eeg" title="Permanent link">&para;</a></h2>
<h3 id="161-the-eeg-signal">16.1 The EEG Signal<a class="header-link" href="#161-the-eeg-signal" title="Permanent link">&para;</a></h3>
<p>The electroencephalogram (EEG) records brain electrical activity from scalp electrodes. EEG signals are much weaker than ECG.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Amplitude</td>
<td>1 - 200 $\mu$V</td>
</tr>
<tr>
<td>Bandwidth</td>
<td>0.5 - 100 Hz</td>
</tr>
<tr>
<td>Sampling rate</td>
<td>256 - 1024 Hz</td>
</tr>
<tr>
<td>Channels</td>
<td>1-256 (10-20 system)</td>
</tr>
</tbody>
</table>
<h3 id="162-eeg-frequency-bands">16.2 EEG Frequency Bands<a class="header-link" href="#162-eeg-frequency-bands" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Band</th>
<th>Frequency</th>
<th>State</th>
</tr>
</thead>
<tbody>
<tr>
<td>Delta ($\delta$)</td>
<td>0.5-4 Hz</td>
<td>Deep sleep</td>
</tr>
<tr>
<td>Theta ($\theta$)</td>
<td>4-8 Hz</td>
<td>Drowsiness, light sleep, meditation</td>
</tr>
<tr>
<td>Alpha ($\alpha$)</td>
<td>8-13 Hz</td>
<td>Relaxed, eyes closed</td>
</tr>
<tr>
<td>Beta ($\beta$)</td>
<td>13-30 Hz</td>
<td>Active thinking, focus</td>
</tr>
<tr>
<td>Gamma ($\gamma$)</td>
<td>30-100 Hz</td>
<td>Higher cognitive functions, perception</td>
</tr>
</tbody>
</table>
<h3 id="163-eeg-spectral-analysis">16.3 EEG Spectral Analysis<a class="header-link" href="#163-eeg-spectral-analysis" title="Permanent link">&para;</a></h3>
<p>The power spectral density (PSD) of EEG reveals the dominant brain states:</p>
<p>$$S_{xx}(f) = \frac{1}{N}|X(f)|^2$$</p>
<p><strong>Band power</strong> is computed by integrating the PSD over each frequency band:</p>
<p>$$P_{band} = \int_{f_1}^{f_2} S_{xx}(f) \, df$$</p>
<p><strong>Relative band power</strong>: $P_{rel} = P_{band} / P_{total}$ indicates the proportion of total power in each band.</p>
<h3 id="164-event-related-potentials-erps">16.4 Event-Related Potentials (ERPs)<a class="header-link" href="#164-event-related-potentials-erps" title="Permanent link">&para;</a></h3>
<p>ERPs are obtained by averaging many EEG trials time-locked to a stimulus:</p>
<p>$$\text{ERP}[n] = \frac{1}{K}\sum_{k=1}^{K} x_k[n]$$</p>
<p>Averaging reduces the background noise by $\sqrt{K}$ while preserving the time-locked response.</p>
<h3 id="165-spectral-analysis-methods-for-eeg">16.5 Spectral Analysis Methods for EEG<a class="header-link" href="#165-spectral-analysis-methods-for-eeg" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Welch's method</strong>: Averaged periodograms for robust PSD estimation</li>
<li><strong>Multitaper method</strong>: Multiple orthogonal tapers for reduced variance</li>
<li><strong>Short-Time Fourier Transform</strong>: Time-varying spectral content (event-related spectral perturbation)</li>
<li><strong>Wavelet analysis</strong>: Multi-scale time-frequency analysis of transient brain events</li>
</ul>
<hr />
<h2 id="17-heart-rate-variability-hrv">17. Heart Rate Variability (HRV)<a class="header-link" href="#17-heart-rate-variability-hrv" title="Permanent link">&para;</a></h2>
<h3 id="171-what-is-hrv">17.1 What is HRV?<a class="header-link" href="#171-what-is-hrv" title="Permanent link">&para;</a></h3>
<p>Heart Rate Variability is the variation in the time intervals between consecutive heartbeats (RR intervals). HRV is a marker of autonomic nervous system function.</p>
<h3 id="172-time-domain-measures">17.2 Time-Domain Measures<a class="header-link" href="#172-time-domain-measures" title="Permanent link">&para;</a></h3>
<p>From the sequence of RR intervals $\{RR_i\}$:</p>
<table>
<thead>
<tr>
<th>Measure</th>
<th>Formula</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>SDNN</td>
<td>$\sqrt{\frac{1}{N}\sum(RR_i - \overline{RR})^2}$</td>
<td>Overall variability</td>
</tr>
<tr>
<td>RMSSD</td>
<td>$\sqrt{\frac{1}{N-1}\sum(RR_{i+1} - RR_i)^2}$</td>
<td>Short-term variability</td>
</tr>
<tr>
<td>pNN50</td>
<td>$\frac{\#\{|RR_{i+1} - RR_i| > 50\text{ms}\}}{N-1} \times 100\%$</td>
<td>Parasympathetic activity</td>
</tr>
</tbody>
</table>
<h3 id="173-frequency-domain-measures">17.3 Frequency-Domain Measures<a class="header-link" href="#173-frequency-domain-measures" title="Permanent link">&para;</a></h3>
<p>The PSD of the RR interval time series reveals autonomic regulation:</p>
<table>
<thead>
<tr>
<th>Band</th>
<th>Frequency</th>
<th>Origin</th>
</tr>
</thead>
<tbody>
<tr>
<td>VLF</td>
<td>0.003-0.04 Hz</td>
<td>Thermoregulation, RAAS</td>
</tr>
<tr>
<td>LF</td>
<td>0.04-0.15 Hz</td>
<td>Sympathetic + Parasympathetic</td>
</tr>
<tr>
<td>HF</td>
<td>0.15-0.40 Hz</td>
<td>Parasympathetic (respiratory sinus arrhythmia)</td>
</tr>
</tbody>
</table>
<p>The <strong>LF/HF ratio</strong> is a (controversial) marker of sympathovagal balance.</p>
<h3 id="174-hrv-analysis-pipeline">17.4 HRV Analysis Pipeline<a class="header-link" href="#174-hrv-analysis-pipeline" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>QRS detection</strong>: Pan-Tompkins algorithm</li>
<li><strong>RR interval extraction</strong>: Time between consecutive R-peaks</li>
<li><strong>Artifact removal</strong>: Remove ectopic beats and missed detections</li>
<li><strong>Interpolation</strong>: Resample RR intervals to uniform time grid (e.g., 4 Hz, cubic spline)</li>
<li><strong>PSD estimation</strong>: Welch's method or AR model</li>
<li><strong>Band power calculation</strong>: Integrate PSD in VLF, LF, HF bands</li>
</ol>
<hr />
<h2 id="18-python-implementations">18. Python Implementations<a class="header-link" href="#18-python-implementations" title="Permanent link">&para;</a></h2>
<h3 id="181-digital-audio-effects">18.1 Digital Audio Effects<a class="header-link" href="#181-digital-audio-effects" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_audio_signal</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">44100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a test audio signal (guitar-like pluck).&quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
    <span class="c1"># Karplus-Strong synthesis approximation</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="mi">220</span>  <span class="c1"># A3</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="c1"># Harmonics with decay</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
        <span class="n">decay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">signal</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">f0</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">decay</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">signal</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">signal</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">signal</span>


<span class="k">def</span><span class="w"> </span><span class="nf">delay_effect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">delay_ms</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">feedback</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply delay/echo effect.&quot;&quot;&quot;</span>
    <span class="n">delay_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">delay_ms</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">delay_samples</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">y</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delay_samples</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">feedback</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">delay_samples</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">mix</span> <span class="o">*</span> <span class="n">y</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mix</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>


<span class="k">def</span><span class="w"> </span><span class="nf">chorus_effect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">depth_ms</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rate_hz</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply chorus effect with LFO-modulated delay.&quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">base_delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">25</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># 25 ms base delay</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">depth_ms</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">base_delay</span> <span class="o">+</span> <span class="n">depth</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="c1"># LFO modulates the delay</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rate_hz</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">base_delay</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>

        <span class="c1"># Linear interpolation for fractional delay</span>
        <span class="n">d_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">d_frac</span> <span class="o">=</span> <span class="n">delay</span> <span class="o">-</span> <span class="n">d_int</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">-</span> <span class="n">d_int</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">delayed</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d_frac</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">d_int</span><span class="p">]</span> <span class="o">+</span> <span class="n">d_frac</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">d_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delayed</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">d_int</span><span class="p">]</span>

        <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mix</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">mix</span> <span class="o">*</span> <span class="n">delayed</span>

    <span class="k">return</span> <span class="n">y</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compressor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">threshold_db</span><span class="o">=-</span><span class="mi">20</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">attack_ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">release_ms</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply dynamic range compression.&quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">threshold_db</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">alpha_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">fs</span> <span class="o">*</span> <span class="n">attack_ms</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">alpha_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">fs</span> <span class="o">*</span> <span class="n">release_ms</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="c1"># Envelope follower</span>
        <span class="n">abs_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">abs_x</span> <span class="o">&gt;</span> <span class="n">env</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">env</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha_a</span> <span class="o">*</span> <span class="n">env</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_a</span><span class="p">)</span> <span class="o">*</span> <span class="n">abs_x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha_r</span> <span class="o">*</span> <span class="n">env</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_r</span><span class="p">)</span> <span class="o">*</span> <span class="n">abs_x</span>

        <span class="c1"># Compute gain</span>
        <span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">env_db</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
            <span class="n">thresh_db</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="n">gain_db</span> <span class="o">=</span> <span class="n">thresh_db</span> <span class="o">+</span> <span class="p">(</span><span class="n">env_db</span> <span class="o">-</span> <span class="n">thresh_db</span><span class="p">)</span> <span class="o">/</span> <span class="n">ratio</span> <span class="o">-</span> <span class="n">env_db</span>
            <span class="n">gain</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">gain_db</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gain</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">gain</span>


<span class="c1"># Demo</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">44100</span>
<span class="n">t</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">generate_audio_signal</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="c1"># Apply effects</span>
<span class="n">x_delay</span> <span class="o">=</span> <span class="n">delay_effect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">delay_ms</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">feedback</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">x_chorus</span> <span class="o">=</span> <span class="n">chorus_effect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">depth_ms</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rate_hz</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">x_comp</span><span class="p">,</span> <span class="n">gain</span> <span class="o">=</span> <span class="n">compressor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">threshold_db</span><span class="o">=-</span><span class="mi">12</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="n">x</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Signal&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="n">x_delay</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Delay Effect (200ms, feedback=0.4)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="n">x_chorus</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Chorus Effect&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="n">x</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="n">x_comp</span><span class="p">[:</span><span class="mi">4000</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Compressed&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Compressor (threshold=-12dB, ratio=4:1)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;audio_effects.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="182-digital-modulation">18.2 Digital Modulation<a class="header-link" href="#182-digital-modulation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">qpsk_modulate</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="n">samples_per_symbol</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;QPSK modulation.&quot;&quot;&quot;</span>
    <span class="c1"># Ensure even number of bits</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bits</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">n_symbols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_symbols</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

    <span class="c1"># Gray coding: 00-&gt;pi/4, 01-&gt;3pi/4, 11-&gt;5pi/4, 10-&gt;7pi/4</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_symbols</span><span class="p">):</span>
        <span class="n">dibit</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="n">bits</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">dibit</span><span class="p">]</span>

    <span class="c1"># Upsample</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_symbols</span> <span class="o">*</span> <span class="n">samples_per_symbol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">signal</span><span class="p">[::</span><span class="n">samples_per_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbols</span>

    <span class="c1"># Pulse shaping (raised cosine)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">samples_per_symbol</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">samples_per_symbol</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.35</span>
    <span class="n">Ts</span> <span class="o">=</span> <span class="n">samples_per_symbol</span>
    <span class="n">rc_pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">Ts</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">Ts</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">Ts</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">rc_pulse</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rc_pulse</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">rc_pulse</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">signal</span>


<span class="k">def</span><span class="w"> </span><span class="nf">qam16_constellation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate 16-QAM constellation.&quot;&quot;&quot;</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">constellation</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
            <span class="n">constellation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">constellation</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Normalize</span>


<span class="c1"># Generate random bits</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">bits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># QPSK modulation</span>
<span class="n">symbols</span><span class="p">,</span> <span class="n">signal</span> <span class="o">=</span> <span class="n">qpsk_modulate</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>

<span class="c1"># Add AWGN noise at different SNR levels</span>
<span class="n">snr_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">snr_db</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snr_values</span><span class="p">):</span>
    <span class="n">noise_power</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">snr_db</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">noise_power</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>
                                       <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)))</span>
    <span class="n">received</span> <span class="o">=</span> <span class="n">symbols</span> <span class="o">+</span> <span class="n">noise</span>

    <span class="c1"># Constellation diagram</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">received</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">received</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Received&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">symbols</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
               <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ideal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;QPSK: SNR = </span><span class="si">{</span><span class="n">snr_db</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;In-phase (I)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Quadrature (Q)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># 16-QAM constellation</span>
<span class="n">qam_const</span> <span class="o">=</span> <span class="n">qam16_constellation</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">snr_db</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snr_values</span><span class="p">):</span>
    <span class="n">noise_power</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">snr_db</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">n_sym</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="c1"># Random symbols from constellation</span>
    <span class="n">sym_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">n_sym</span><span class="p">)</span>
    <span class="n">tx_symbols</span> <span class="o">=</span> <span class="n">qam_const</span><span class="p">[</span><span class="n">sym_idx</span><span class="p">]</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">noise_power</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_sym</span><span class="p">)</span>
                                       <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_sym</span><span class="p">))</span>
    <span class="n">rx_symbols</span> <span class="o">=</span> <span class="n">tx_symbols</span> <span class="o">+</span> <span class="n">noise</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rx_symbols</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">rx_symbols</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Received&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">qam_const</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">qam_const</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
               <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ideal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;16-QAM: SNR = </span><span class="si">{</span><span class="n">snr_db</span><span class="si">}</span><span class="s1"> dB&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;In-phase (I)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Quadrature (Q)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;digital_modulation.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="183-radar-chirp-pulse-compression">18.3 Radar: Chirp Pulse Compression<a class="header-link" href="#183-radar-chirp-pulse-compression" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_chirp</span><span class="p">(</span><span class="n">tau_p</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a linear FM chirp pulse.&quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tau_p</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">chirp_rate</span> <span class="o">=</span> <span class="n">B</span> <span class="o">/</span> <span class="n">tau_p</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">chirp_rate</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">s</span>


<span class="k">def</span><span class="w"> </span><span class="nf">matched_filter</span><span class="p">(</span><span class="n">received</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply matched filter (cross-correlation).&quot;&quot;&quot;</span>
    <span class="n">mf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">template</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">received</span><span class="p">,</span> <span class="n">mf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>


<span class="c1"># Radar parameters</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">3e8</span>           <span class="c1"># Speed of light (m/s)</span>
<span class="n">fc</span> <span class="o">=</span> <span class="mf">10e9</span>         <span class="c1"># Carrier frequency (10 GHz, X-band)</span>
<span class="n">tau_p</span> <span class="o">=</span> <span class="mf">10e-6</span>     <span class="c1"># Pulse width (10 Œºs)</span>
<span class="n">B</span> <span class="o">=</span> <span class="mf">5e6</span>           <span class="c1"># Bandwidth (5 MHz)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mf">20e6</span>         <span class="c1"># Sampling frequency</span>

<span class="c1"># Range resolution</span>
<span class="n">delta_R</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Range resolution: </span><span class="si">{</span><span class="n">delta_R</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time-bandwidth product: </span><span class="si">{</span><span class="n">B</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tau_p</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing gain: </span><span class="si">{</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">tau_p</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> dB&quot;</span><span class="p">)</span>

<span class="c1"># Generate chirp</span>
<span class="n">t_chirp</span><span class="p">,</span> <span class="n">chirp</span> <span class="o">=</span> <span class="n">generate_chirp</span><span class="p">(</span><span class="n">tau_p</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="c1"># Simulate two targets at different ranges</span>
<span class="n">R1</span> <span class="o">=</span> <span class="mi">5000</span>    <span class="c1"># Target 1 at 5 km</span>
<span class="n">R2</span> <span class="o">=</span> <span class="mi">5060</span>    <span class="c1"># Target 2 at 5.06 km (60 m apart)</span>
<span class="n">A1</span> <span class="o">=</span> <span class="mf">1.0</span>     <span class="c1"># Target 1 amplitude</span>
<span class="n">A2</span> <span class="o">=</span> <span class="mf">0.5</span>     <span class="c1"># Target 2 amplitude (weaker)</span>

<span class="c1"># Convert ranges to time delays</span>
<span class="n">tau1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">R1</span> <span class="o">/</span> <span class="n">c</span>
<span class="n">tau2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">R2</span> <span class="o">/</span> <span class="n">c</span>

<span class="c1"># Create received signal</span>
<span class="n">N_total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">15000</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>  <span class="c1"># Enough samples for 15 km range</span>
<span class="n">received</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_total</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="c1"># Add noise</span>
<span class="n">noise_level</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">received</span> <span class="o">+=</span> <span class="n">noise_level</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N_total</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N_total</span><span class="p">))</span>

<span class="c1"># Add target returns</span>
<span class="n">idx1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tau1</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">idx2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tau2</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
<span class="k">if</span> <span class="n">idx1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">chirp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">N_total</span><span class="p">:</span>
    <span class="n">received</span><span class="p">[</span><span class="n">idx1</span><span class="p">:</span><span class="n">idx1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">chirp</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">A1</span> <span class="o">*</span> <span class="n">chirp</span>
<span class="k">if</span> <span class="n">idx2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">chirp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">N_total</span><span class="p">:</span>
    <span class="n">received</span><span class="p">[</span><span class="n">idx2</span><span class="p">:</span><span class="n">idx2</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">chirp</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">A2</span> <span class="o">*</span> <span class="n">chirp</span>

<span class="c1"># Matched filter output</span>
<span class="n">mf_output</span> <span class="o">=</span> <span class="n">matched_filter</span><span class="p">(</span><span class="n">received</span><span class="p">,</span> <span class="n">chirp</span><span class="p">)</span>

<span class="c1"># Convert to range</span>
<span class="n">range_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mf_output</span><span class="p">))</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># km</span>

<span class="c1"># Plot results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Chirp waveform</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_chirp</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">chirp</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (Œºs)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Linear FM Chirp Pulse (B=</span><span class="si">{</span><span class="n">B</span><span class="o">/</span><span class="mf">1e6</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> MHz, œÑ=</span><span class="si">{</span><span class="n">tau_p</span><span class="o">*</span><span class="mf">1e6</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> Œºs)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Chirp spectrogram</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>
<span class="n">f_stft</span><span class="p">,</span> <span class="n">t_stft</span><span class="p">,</span> <span class="n">Sxx</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span>
    <span class="n">chirp</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="mi">56</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="mi">256</span>
<span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t_stft</span><span class="o">*</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">f_stft</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Sxx</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span>
                   <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (Œºs)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (MHz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Chirp Spectrogram&#39;</span><span class="p">)</span>

<span class="c1"># Matched filter output</span>
<span class="n">mf_db</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mf_output</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mf_output</span><span class="p">))</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">range_axis</span> <span class="o">&gt;</span> <span class="mf">4.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">range_axis</span> <span class="o">&lt;</span> <span class="mf">5.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">range_axis</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">mf_db</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">R1</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Target 1: </span><span class="si">{</span><span class="n">R1</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> km&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">R2</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Target 2: </span><span class="si">{</span><span class="n">R2</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> km&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Range (km)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (dB)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Matched Filter Output (ŒîR = </span><span class="si">{</span><span class="n">delta_R</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1"> m)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;radar_pulse_compression.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<h3 id="184-biomedical-ecg-processing">18.4 Biomedical: ECG Processing<a class="header-link" href="#184-biomedical-ecg-processing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_synthetic_ecg</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">heart_rate</span><span class="o">=</span><span class="mi">72</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a synthetic ECG signal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    duration : float</span>
<span class="sd">        Duration in seconds</span>
<span class="sd">    fs : int</span>
<span class="sd">        Sampling rate</span>
<span class="sd">    heart_rate : int</span>
<span class="sd">        Heart rate in bpm</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    t : ndarray</span>
<span class="sd">        Time axis</span>
<span class="sd">    ecg : ndarray</span>
<span class="sd">        Synthetic ECG signal</span>
<span class="sd">    r_peaks : ndarray</span>
<span class="sd">        Indices of R-peaks</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">ecg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">rr_interval</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">heart_rate</span>  <span class="c1"># seconds</span>
    <span class="n">rr_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rr_interval</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>

    <span class="n">r_peaks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Generate each heartbeat</span>
    <span class="n">beat_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">beat_start</span> <span class="o">+</span> <span class="n">rr_samples</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
        <span class="c1"># P wave</span>
        <span class="n">p_center</span> <span class="o">=</span> <span class="n">beat_start</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.16</span> <span class="o">*</span> <span class="n">rr_samples</span><span class="p">)</span>
        <span class="n">p_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.04</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">t_local</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">p_width</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">p_width</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p_wave</span> <span class="o">=</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_local</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p_width</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_center</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">p_width</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">p_center</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">p_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ecg</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p_wave</span><span class="p">[:</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">]</span>

        <span class="c1"># QRS complex</span>
        <span class="n">r_center</span> <span class="o">=</span> <span class="n">beat_start</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">rr_samples</span><span class="p">)</span>
        <span class="n">r_peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_center</span><span class="p">)</span>

        <span class="c1"># Q wave</span>
        <span class="n">q_center</span> <span class="o">=</span> <span class="n">r_center</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.02</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">q_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">t_local</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">q_width</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">q_width</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">q_wave</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_local</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">q_width</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q_center</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">q_width</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">q_center</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">q_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ecg</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">+=</span> <span class="n">q_wave</span><span class="p">[:</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">]</span>

        <span class="c1"># R wave</span>
        <span class="n">r_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.008</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">t_local</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">r_width</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">r_width</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">r_wave</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_local</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r_width</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r_center</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">r_width</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">r_center</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">r_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ecg</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">+=</span> <span class="n">r_wave</span><span class="p">[:</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">]</span>

        <span class="c1"># S wave</span>
        <span class="n">s_center</span> <span class="o">=</span> <span class="n">r_center</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.02</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">s_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.012</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">t_local</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">s_width</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">s_width</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">s_wave</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_local</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">s_width</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s_center</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">s_width</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">s_center</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">s_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ecg</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s_wave</span><span class="p">[:</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">]</span>

        <span class="c1"># T wave</span>
        <span class="n">t_center</span> <span class="o">=</span> <span class="n">beat_start</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">rr_samples</span><span class="p">)</span>
        <span class="n">t_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.06</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">t_local</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">t_width</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">t_width</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">t_wave</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_local</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t_width</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_center</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">t_width</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">t_center</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">t_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ecg</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">+=</span> <span class="n">t_wave</span><span class="p">[:</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">]</span>

        <span class="c1"># Add some RR variability</span>
        <span class="n">rr_var</span> <span class="o">=</span> <span class="n">rr_samples</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">rr_samples</span><span class="p">)</span>
        <span class="n">beat_start</span> <span class="o">+=</span> <span class="n">rr_var</span>

    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">ecg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r_peaks</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">pan_tompkins_qrs</span><span class="p">(</span><span class="n">ecg</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplified Pan-Tompkins QRS detector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ecg : ndarray</span>
<span class="sd">        ECG signal</span>
<span class="sd">    fs : int</span>
<span class="sd">        Sampling rate</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r_peaks : ndarray</span>
<span class="sd">        Detected R-peak indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Step 1: Bandpass filter (5-15 Hz)</span>
    <span class="n">nyq</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">b_bp</span><span class="p">,</span> <span class="n">a_bp</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="o">/</span><span class="n">nyq</span><span class="p">,</span> <span class="mi">15</span><span class="o">/</span><span class="n">nyq</span><span class="p">],</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;band&#39;</span><span class="p">)</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b_bp</span><span class="p">,</span> <span class="n">a_bp</span><span class="p">,</span> <span class="n">ecg</span><span class="p">)</span>

    <span class="c1"># Step 2: Derivative</span>
    <span class="n">h_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">8</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">h_diff</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>

    <span class="c1"># Step 3: Squaring</span>
    <span class="n">squared</span> <span class="o">=</span> <span class="n">diff</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Step 4: Moving window integration (150 ms)</span>
    <span class="n">win_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.15</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">integrator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">squared</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">win_size</span><span class="p">)</span><span class="o">/</span><span class="n">win_size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>

    <span class="c1"># Step 5: Thresholding</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">integrator</span><span class="p">)</span>
    <span class="n">peaks_mask</span> <span class="o">=</span> <span class="n">integrator</span> <span class="o">&gt;</span> <span class="n">threshold</span>

    <span class="c1"># Find peaks</span>
    <span class="n">r_peaks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">min_distance</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>  <span class="c1"># Minimum 300 ms between beats</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks_mask</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">peaks_mask</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="c1"># Find the actual R-peak (maximum in the raw ECG)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">win_size</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ecg</span><span class="p">),</span> <span class="n">i</span> <span class="o">+</span> <span class="n">win_size</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">r_idx</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ecg</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">r_idx</span> <span class="o">-</span> <span class="n">r_peaks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">min_distance</span><span class="p">:</span>
                <span class="n">r_peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_idx</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">r_idx</span> <span class="o">+</span> <span class="n">min_distance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r_peaks</span><span class="p">)</span>


<span class="c1"># Generate and process ECG</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">t</span><span class="p">,</span> <span class="n">clean_ecg</span><span class="p">,</span> <span class="n">true_r_peaks</span> <span class="o">=</span> <span class="n">generate_synthetic_ecg</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">heart_rate</span><span class="o">=</span><span class="mi">72</span><span class="p">)</span>

<span class="c1"># Add noise</span>
<span class="n">baseline_wander</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.15</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.3</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">powerline</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">muscle_noise</span> <span class="o">=</span> <span class="mf">0.03</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">noisy_ecg</span> <span class="o">=</span> <span class="n">clean_ecg</span> <span class="o">+</span> <span class="n">baseline_wander</span> <span class="o">+</span> <span class="n">powerline</span> <span class="o">+</span> <span class="n">muscle_noise</span>

<span class="c1"># Preprocessing</span>
<span class="c1"># Baseline removal (highpass 0.5 Hz)</span>
<span class="n">b_hp</span><span class="p">,</span> <span class="n">a_hp</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">)</span>
<span class="n">ecg_no_baseline</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b_hp</span><span class="p">,</span> <span class="n">a_hp</span><span class="p">,</span> <span class="n">noisy_ecg</span><span class="p">)</span>

<span class="c1"># Notch filter for 60 Hz</span>
<span class="n">b_notch</span><span class="p">,</span> <span class="n">a_notch</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">iirnotch</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">ecg_notched</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b_notch</span><span class="p">,</span> <span class="n">a_notch</span><span class="p">,</span> <span class="n">ecg_no_baseline</span><span class="p">)</span>

<span class="c1"># Bandpass 0.5-40 Hz</span>
<span class="n">b_bp</span><span class="p">,</span> <span class="n">a_bp</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">40</span><span class="o">/</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;band&#39;</span><span class="p">)</span>
<span class="n">ecg_filtered</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b_bp</span><span class="p">,</span> <span class="n">a_bp</span><span class="p">,</span> <span class="n">noisy_ecg</span><span class="p">)</span>

<span class="c1"># QRS detection</span>
<span class="n">detected_r_peaks</span> <span class="o">=</span> <span class="n">pan_tompkins_qrs</span><span class="p">(</span><span class="n">ecg_filtered</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="c1"># Plot results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">clean_ecg</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">true_r_peaks</span><span class="p">],</span> <span class="n">clean_ecg</span><span class="p">[</span><span class="n">true_r_peaks</span><span class="p">],</span> <span class="s1">&#39;rv&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Clean ECG with True R-peaks&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (mV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">noisy_ecg</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Noisy ECG (baseline wander + 60Hz + muscle noise)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (mV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ecg_filtered</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Filtered ECG (0.5-40 Hz bandpass)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (mV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ecg_filtered</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">detected_r_peaks</span><span class="p">],</span> <span class="n">ecg_filtered</span><span class="p">[</span><span class="n">detected_r_peaks</span><span class="p">],</span>
             <span class="s1">&#39;rv&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detected R-peaks&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;QRS Detection (Pan-Tompkins): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detected_r_peaks</span><span class="p">)</span><span class="si">}</span><span class="s1"> beats detected&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (mV)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;ecg_processing.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># HRV Analysis</span>
<span class="n">rr_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">detected_r_peaks</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Convert to ms</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">HRV Time-Domain Measures:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mean RR: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rr_intervals</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  SDNN:    </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">rr_intervals</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  RMSSD:   </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">rr_intervals</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mean HR: </span><span class="si">{</span><span class="mi">60000</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rr_intervals</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> bpm&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="185-pitch-detection-demo">18.5 Pitch Detection Demo<a class="header-link" href="#185-pitch-detection-demo" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">autocorrelation_pitch</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pitch detection using autocorrelation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : ndarray</span>
<span class="sd">        Signal frame</span>
<span class="sd">    fs : float</span>
<span class="sd">        Sampling rate</span>
<span class="sd">    fmin, fmax : float</span>
<span class="sd">        Min/max expected pitch frequency</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    f0 : float</span>
<span class="sd">        Estimated pitch frequency (0 if unvoiced)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="c1"># Compute autocorrelation</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Take positive lags only</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Normalize</span>

    <span class="c1"># Search range</span>
    <span class="n">lag_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span> <span class="o">/</span> <span class="n">fmax</span><span class="p">)</span>
    <span class="n">lag_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fs</span> <span class="o">/</span> <span class="n">fmin</span><span class="p">),</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Find the first significant peak</span>
    <span class="k">if</span> <span class="n">lag_max</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
        <span class="n">lag_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">r_search</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">lag_min</span><span class="p">:</span><span class="n">lag_max</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_search</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">r_search</span><span class="p">)</span> <span class="o">+</span> <span class="n">lag_min</span>

    <span class="c1"># Voiced/unvoiced decision</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>  <span class="c1"># Threshold</span>
        <span class="k">return</span> <span class="n">fs</span> <span class="o">/</span> <span class="n">peak_idx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="k">def</span><span class="w"> </span><span class="nf">cepstrum_pitch</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pitch detection using cepstrum.&quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="c1"># Compute cepstrum</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
    <span class="n">log_spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">cepstrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">log_spectrum</span><span class="p">))</span>

    <span class="c1"># Search range (quefrency = period in samples)</span>
    <span class="n">q_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span> <span class="o">/</span> <span class="n">fmax</span><span class="p">)</span>
    <span class="n">q_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fs</span> <span class="o">/</span> <span class="n">fmin</span><span class="p">),</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">cep_search</span> <span class="o">=</span> <span class="n">cepstrum</span><span class="p">[</span><span class="n">q_min</span><span class="p">:</span><span class="n">q_max</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cep_search</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cep_search</span><span class="p">)</span> <span class="o">+</span> <span class="n">q_min</span>

    <span class="k">if</span> <span class="n">cepstrum</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fs</span> <span class="o">/</span> <span class="n">peak_idx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="c1"># Generate a test signal with known pitch</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">16000</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>

<span class="c1"># Create a signal with time-varying pitch (glissando)</span>
<span class="n">f0_start</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">f0_end</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">f0_start</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="n">f0_end</span> <span class="o">-</span> <span class="n">f0_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">duration</span><span class="p">))</span>
<span class="n">signal_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
    <span class="n">signal_test</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
<span class="n">signal_test</span> <span class="o">=</span> <span class="n">signal_test</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">signal_test</span><span class="p">))</span>
<span class="n">signal_test</span> <span class="o">+=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>  <span class="c1"># Add noise</span>

<span class="c1"># Frame-by-frame pitch detection</span>
<span class="n">frame_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.04</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>  <span class="c1"># 40 ms</span>
<span class="n">hop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>  <span class="c1"># 10 ms</span>
<span class="n">n_frames</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal_test</span><span class="p">)</span> <span class="o">-</span> <span class="n">frame_length</span><span class="p">)</span> <span class="o">//</span> <span class="n">hop</span>

<span class="n">pitches_ac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
<span class="n">pitches_cep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
<span class="n">frame_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>

<span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hanning</span><span class="p">(</span><span class="n">frame_length</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_frames</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">hop</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">signal_test</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="n">frame_length</span><span class="p">]</span> <span class="o">*</span> <span class="n">window</span>
    <span class="n">frame_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">frame_length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>

    <span class="n">pitches_ac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">autocorrelation_pitch</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">pitches_cep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cepstrum_pitch</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

<span class="c1"># True pitch trajectory</span>
<span class="n">true_pitch</span> <span class="o">=</span> <span class="n">f0_start</span> <span class="o">+</span> <span class="p">(</span><span class="n">f0_end</span> <span class="o">-</span> <span class="n">f0_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">frame_times</span> <span class="o">/</span> <span class="n">duration</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">signal_test</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Test Signal (Glissando 150-300 Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="n">true_pitch</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True pitch&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="n">pitches_ac</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Autocorrelation&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="n">pitches_cep</span><span class="p">,</span> <span class="s1">&#39;bx&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cepstrum&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pitch Detection Comparison&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>

<span class="c1"># Autocorrelation and cepstrum of one frame</span>
<span class="n">frame_idx</span> <span class="o">=</span> <span class="n">n_frames</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">frame_idx</span> <span class="o">*</span> <span class="n">hop</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">signal_test</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="n">frame_length</span><span class="p">]</span> <span class="o">*</span> <span class="n">window</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">frame_length</span><span class="p">)</span>
<span class="n">cepstrum_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)))</span>

<span class="n">lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="o">/</span> <span class="n">fs</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># ms</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lag</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">80</span><span class="p">)],</span> <span class="n">r</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">80</span><span class="p">)],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Autocorrelation&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag (ms)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Autocorrelation&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Autocorrelation of Middle Frame&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;pitch_detection.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="19-exercises">19. Exercises<a class="header-link" href="#19-exercises" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-audio-effects-chain">Exercise 1: Audio Effects Chain<a class="header-link" href="#exercise-1-audio-effects-chain" title="Permanent link">&para;</a></h3>
<p>(a) Implement a Schroeder reverberator using 4 parallel comb filters (with delays 29.7, 37.1, 41.1, 43.7 ms and gains 0.742, 0.733, 0.715, 0.697) and 2 series allpass filters (delays 5.0, 1.7 ms, gain 0.7). Apply to a short impulse and plot the resulting impulse response.</p>
<p>(b) Generate a simple melody (e.g., "Twinkle Twinkle Little Star" using sine waves at the appropriate frequencies). Apply the reverb and listen (save as WAV file if possible).</p>
<p>(c) Implement a flanger effect and demonstrate the characteristic comb-filter sweep by plotting the time-varying magnitude response.</p>
<h3 id="exercise-2-pitch-detection-robustness">Exercise 2: Pitch Detection Robustness<a class="header-link" href="#exercise-2-pitch-detection-robustness" title="Permanent link">&para;</a></h3>
<p>(a) Generate a pure tone at 220 Hz and verify that both autocorrelation and cepstrum methods detect it correctly.</p>
<p>(b) Add harmonic content (1st through 5th harmonics with decreasing amplitude). Do the pitch detectors still find the fundamental?</p>
<p>(c) Add noise at SNR = 20, 10, 5, and 0 dB. Plot the pitch detection accuracy vs SNR for both methods.</p>
<p>(d) Create a signal with missing fundamental (only harmonics 2, 3, 4 of 100 Hz). Can the autocorrelation method still detect 100 Hz? What about the cepstrum?</p>
<h3 id="exercise-3-digital-modulation-ber">Exercise 3: Digital Modulation BER<a class="header-link" href="#exercise-3-digital-modulation-ber" title="Permanent link">&para;</a></h3>
<p>(a) Implement BPSK, QPSK, and 16-QAM modulation and demodulation.</p>
<p>(b) Simulate transmission over an AWGN channel for $E_b/N_0$ from 0 to 20 dB. Plot the BER curves for all three schemes.</p>
<p>(c) Compare with the theoretical BER:
- BPSK: $P_b = Q(\sqrt{2E_b/N_0})$
- QPSK: Same as BPSK (per bit)
- 16-QAM: $P_b \approx \frac{3}{8}Q(\sqrt{4E_b/(5N_0)})$</p>
<p>(d) Implement Gray coding for 16-QAM and show that it improves the BER compared to natural binary mapping.</p>
<h3 id="exercise-4-ofdm-system">Exercise 4: OFDM System<a class="header-link" href="#exercise-4-ofdm-system" title="Permanent link">&para;</a></h3>
<p>(a) Implement a basic OFDM transmitter and receiver with 64 subcarriers, 16-QAM modulation, and a cyclic prefix of length 16.</p>
<p>(b) Simulate transmission through a multipath channel $h = [1, 0, 0.5, 0, 0.2]$ with AWGN.</p>
<p>(c) Show that the cyclic prefix enables simple one-tap equalization. Plot the constellation diagram before and after equalization.</p>
<p>(d) Remove the cyclic prefix and demonstrate the resulting ISI.</p>
<h3 id="exercise-5-radar-waveform-design">Exercise 5: Radar Waveform Design<a class="header-link" href="#exercise-5-radar-waveform-design" title="Permanent link">&para;</a></h3>
<p>(a) Generate chirp pulses with time-bandwidth products of 10, 50, and 200. Apply matched filtering and compare the compressed pulse widths and sidelobe levels.</p>
<p>(b) Apply a Hamming window to the matched filter. How does it affect the mainlobe width and sidelobe level?</p>
<p>(c) Simulate a scenario with two targets at ranges 10 km and 10.03 km. For each TBP, determine whether the targets are resolved.</p>
<p>(d) Compute and plot the 2D ambiguity function $|\chi(\tau, f_d)|$ for a chirp pulse with TBP = 50. Identify the range-Doppler coupling ridge.</p>
<h3 id="exercise-6-ecg-analysis-pipeline">Exercise 6: ECG Analysis Pipeline<a class="header-link" href="#exercise-6-ecg-analysis-pipeline" title="Permanent link">&para;</a></h3>
<p>(a) Generate a synthetic ECG with heart rate 75 bpm and add:
- Baseline wander (0.2 Hz sinusoid, amplitude 0.3 mV)
- 50 Hz powerline noise (amplitude 0.1 mV)
- Random noise (SNR = 20 dB)</p>
<p>(b) Implement the full preprocessing pipeline: highpass filter (0.5 Hz), notch filter (50 Hz), bandpass (1-40 Hz). Show the signal after each stage.</p>
<p>(c) Implement the Pan-Tompkins QRS detector. Count the number of detected beats and compare with ground truth.</p>
<p>(d) Extract RR intervals and compute SDNN, RMSSD, and pNN50. Compare with the known heart rate variability.</p>
<p>(e) Compute the HRV power spectrum and identify the LF and HF bands.</p>
<h3 id="exercise-7-eeg-spectral-analysis">Exercise 7: EEG Spectral Analysis<a class="header-link" href="#exercise-7-eeg-spectral-analysis" title="Permanent link">&para;</a></h3>
<p>(a) Simulate an EEG signal as a sum of:
- Alpha band (10 Hz): dominant when eyes closed
- Beta band (20 Hz): present during concentration
- Background noise (1/f spectrum)</p>
<p>(b) Compute the power spectral density using Welch's method (2-second windows, 50% overlap). Identify the alpha and beta peaks.</p>
<p>(c) Simulate an "eyes open/closed" experiment: alpha power increases from $t = 2$-4 s (eyes closed) and decreases elsewhere. Use the STFT to show the time-varying alpha band power.</p>
<p>(d) Compute the relative band power (alpha/total, beta/total) over time using a sliding window.</p>
<hr />
<h2 id="20-summary">20. Summary<a class="header-link" href="#20-summary" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Domain</th>
<th>Key Technique</th>
<th>Signal Processing Tool</th>
</tr>
</thead>
<tbody>
<tr>
<td>Audio</td>
<td>Delay effects, reverb</td>
<td>Delay lines, comb/allpass filters</td>
</tr>
<tr>
<td>Audio</td>
<td>Pitch detection</td>
<td>Autocorrelation, cepstrum</td>
</tr>
<tr>
<td>Audio</td>
<td>Equalization</td>
<td>Parametric biquad filters</td>
</tr>
<tr>
<td>Audio</td>
<td>Speech coding</td>
<td>Linear prediction (LPC)</td>
</tr>
<tr>
<td>Communications</td>
<td>Analog modulation</td>
<td>AM, FM, PM</td>
</tr>
<tr>
<td>Communications</td>
<td>Digital modulation</td>
<td>PSK, QAM (I-Q processing)</td>
</tr>
<tr>
<td>Communications</td>
<td>Pulse shaping</td>
<td>Raised cosine, matched filter</td>
</tr>
<tr>
<td>Communications</td>
<td>OFDM</td>
<td>FFT/IFFT, cyclic prefix</td>
</tr>
<tr>
<td>Communications</td>
<td>Equalization</td>
<td>ZF, MMSE, adaptive (LMS/RLS)</td>
</tr>
<tr>
<td>Radar</td>
<td>Range detection</td>
<td>Matched filter</td>
</tr>
<tr>
<td>Radar</td>
<td>Pulse compression</td>
<td>Chirp, matched filter</td>
</tr>
<tr>
<td>Radar</td>
<td>Waveform design</td>
<td>Ambiguity function</td>
</tr>
<tr>
<td>Biomedical</td>
<td>ECG preprocessing</td>
<td>Bandpass, notch filter</td>
</tr>
<tr>
<td>Biomedical</td>
<td>QRS detection</td>
<td>Pan-Tompkins algorithm</td>
</tr>
<tr>
<td>Biomedical</td>
<td>EEG analysis</td>
<td>PSD, band power, STFT</td>
</tr>
<tr>
<td>Biomedical</td>
<td>HRV</td>
<td>Time/frequency domain measures</td>
</tr>
</tbody>
</table>
<p><strong>Key takeaways</strong>:
1. Audio effects are built from fundamental building blocks: delay lines, filters, and modulators.
2. Pitch detection reduces to finding periodicity via autocorrelation or spectral analysis via the cepstrum.
3. Digital modulation maps bits to points in the I-Q plane; higher-order schemes trade SNR for spectral efficiency.
4. OFDM converts a frequency-selective channel into parallel flat channels using the FFT.
5. Radar pulse compression achieves both high energy (long pulse) and fine range resolution (wide bandwidth).
6. The ambiguity function completely characterizes a radar waveform's range-velocity resolution.
7. ECG processing combines bandpass filtering, notch filtering, and the Pan-Tompkins algorithm for reliable QRS detection.
8. EEG spectral analysis reveals brain states through the power distribution across frequency bands.
9. Every application in this lesson builds directly on the fundamentals from Lessons 1-15.</p>
<hr />
<h2 id="21-references">21. References<a class="header-link" href="#21-references" title="Permanent link">&para;</a></h2>
<ol>
<li>J.O. Smith III, <em>Physical Audio Signal Processing</em>, W3K Publishing, 2010. (Available online)</li>
<li>J.G. Proakis and M. Salehi, <em>Digital Communications</em>, 5th ed., McGraw-Hill, 2008.</li>
<li>M.A. Richards, <em>Fundamentals of Radar Signal Processing</em>, 2nd ed., McGraw-Hill, 2014.</li>
<li>M.I. Skolnik, <em>Introduction to Radar Systems</em>, 3rd ed., McGraw-Hill, 2001.</li>
<li>J. Pan and W.J. Tompkins, "A real-time QRS detection algorithm," <em>IEEE Trans. Biomedical Engineering</em>, vol. BME-32, no. 3, pp. 230-236, 1985.</li>
<li>R. Rangayyan, <em>Biomedical Signal Analysis</em>, 2nd ed., Wiley-IEEE Press, 2015.</li>
<li>S. Haykin and M. Moher, <em>Communication Systems</em>, 5th ed., Wiley, 2009.</li>
<li>A.V. Oppenheim and R.W. Schafer, <em>Discrete-Time Signal Processing</em>, 3rd ed., Pearson, 2010.</li>
<li>U.R. Acharya et al., "Heart rate variability: a review," <em>Medical and Biological Engineering and Computing</em>, vol. 44, pp. 1031-1051, 2006.</li>
</ol>
<hr />
<p><strong>Previous</strong>: <a href="./15_Image_Signal_Processing.md">15. Image Signal Processing</a> | <a href="./00_Overview.md">Overview</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/Signal_Processing/15_Image_Signal_Processing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">15. Image Signal Processing</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">üîó</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/Signal_Processing/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">üìã</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">‚Üë</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}