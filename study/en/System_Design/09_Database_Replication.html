{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Replication - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">Database Replication</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Database Replication</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/08_Database_Scaling.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Database Scaling</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/System_Design/10_Data_Consistency_Patterns.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Data Consistency Patterns</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#difficulty-intermediate">Difficulty: â­â­â­ (Intermediate)</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-concept-and-purpose-of-replication">1. Concept and Purpose of Replication</a><ul>
<li><a href="#why-replication-is-needed">Why Replication is Needed</a></li>
<li><a href="#types-of-replication-architecture">Types of Replication Architecture</a></li>
</ul>
</li>
<li><a href="#2-single-leader-replication">2. Single-Leader Replication</a><ul>
<li><a href="#how-it-works">How It Works</a></li>
<li><a href="#replication-methods">Replication Methods</a></li>
<li><a href="#postgresql-streaming-replication-example">PostgreSQL Streaming Replication Example</a></li>
<li><a href="#mysql-replication-configuration-example">MySQL Replication Configuration Example</a></li>
</ul>
</li>
<li><a href="#3-multi-leader-replication">3. Multi-Leader Replication</a><ul>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#write-conflict-problem">Write Conflict Problem</a></li>
<li><a href="#conflict-resolution-strategies">Conflict Resolution Strategies</a></li>
<li><a href="#replication-topologies">Replication Topologies</a></li>
</ul>
</li>
<li><a href="#4-leaderless-replication">4. Leaderless Replication</a><ul>
<li><a href="#dynamo-style-replication">Dynamo-Style Replication</a></li>
<li><a href="#read-repair-and-anti-entropy">Read Repair and Anti-Entropy</a></li>
<li><a href="#sloppy-quorum-and-hinted-handoff">Sloppy Quorum and Hinted Handoff</a></li>
</ul>
</li>
<li><a href="#5-synchronousasynchronous-replication">5. Synchronous/Asynchronous Replication</a><ul>
<li><a href="#synchronous-replication">Synchronous Replication</a></li>
<li><a href="#asynchronous-replication">Asynchronous Replication</a></li>
<li><a href="#semi-synchronous-replication">Semi-Synchronous Replication</a></li>
</ul>
</li>
<li><a href="#6-replication-lag-and-consistency-issues">6. Replication Lag and Consistency Issues</a><ul>
<li><a href="#replication-lag">Replication Lag</a></li>
<li><a href="#consistency-guarantee-levels">Consistency Guarantee Levels</a></li>
<li><a href="#replication-lag-monitoring">Replication Lag Monitoring</a></li>
</ul>
</li>
<li><a href="#7-failure-recovery-and-leader-election">7. Failure Recovery and Leader Election</a><ul>
<li><a href="#follower-failure-recovery">Follower Failure Recovery</a></li>
<li><a href="#leader-failure-and-failover">Leader Failure and Failover</a></li>
<li><a href="#failover-problems">Failover Problems</a></li>
<li><a href="#leader-election-algorithm">Leader Election Algorithm</a></li>
</ul>
</li>
<li><a href="#8-quorum-and-consistency-levels">8. Quorum and Consistency Levels</a><ul>
<li><a href="#quorum-concept">Quorum Concept</a></li>
<li><a href="#quorum-configuration-characteristics">Quorum Configuration Characteristics</a></li>
<li><a href="#cassandra-consistency-levels">Cassandra Consistency Levels</a></li>
<li><a href="#consistency-vs-availability-trade-off">Consistency vs Availability Trade-off</a></li>
</ul>
</li>
<li><a href="#9-practice-problems">9. Practice Problems</a><ul>
<li><a href="#practice-1-choosing-replication-strategy">Practice 1: Choosing Replication Strategy</a></li>
<li><a href="#practice-2-quorum-calculation">Practice 2: Quorum Calculation</a></li>
<li><a href="#practice-3-failover-scenario">Practice 3: Failover Scenario</a></li>
<li><a href="#practice-4-conflict-resolution-design">Practice 4: Conflict Resolution Design</a></li>
<li><a href="#practice-5-interview-question">Practice 5: Interview Question</a></li>
</ul>
</li>
<li><a href="#10-next-steps">10. Next Steps</a></li>
<li><a href="#11-references">11. References</a><ul>
<li><a href="#essential-books">Essential Books</a></li>
<li><a href="#database-specific-documentation">Database-Specific Documentation</a></li>
<li><a href="#papers">Papers</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="database-replication">Database Replication<a class="header-link" href="#database-replication" title="Permanent link">&para;</a></h1>
<h2 id="difficulty-intermediate">Difficulty: â­â­â­ (Intermediate)<a class="header-link" href="#difficulty-intermediate" title="Permanent link">&para;</a></h2>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Database replication is a technique that copies identical data to multiple nodes to improve availability, fault tolerance, and read performance. In this document, you will learn about various replication strategies, consistency guarantee mechanisms, and failure recovery methods.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-concept-and-purpose-of-replication">Concept and Purpose of Replication</a></li>
<li><a href="#2-single-leader-replication">Single-Leader Replication</a></li>
<li><a href="#3-multi-leader-replication">Multi-Leader Replication</a></li>
<li><a href="#4-leaderless-replication">Leaderless Replication</a></li>
<li><a href="#5-synchronousasynchronous-replication">Synchronous/Asynchronous Replication</a></li>
<li><a href="#6-replication-lag-and-consistency-issues">Replication Lag and Consistency Issues</a></li>
<li><a href="#7-failure-recovery-and-leader-election">Failure Recovery and Leader Election</a></li>
<li><a href="#8-quorum-and-consistency-levels">Quorum and Consistency Levels</a></li>
<li><a href="#9-practice-problems">Practice Problems</a></li>
<li><a href="#10-next-steps">Next Steps</a></li>
<li><a href="#11-references">References</a></li>
</ol>
<hr />
<h2 id="1-concept-and-purpose-of-replication">1. Concept and Purpose of Replication<a class="header-link" href="#1-concept-and-purpose-of-replication" title="Permanent link">&para;</a></h2>
<h3 id="why-replication-is-needed">Why Replication is Needed<a class="header-link" href="#why-replication-is-needed" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">Main</span><span class="w"> </span><span class="n">Purposes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">Replication</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">High</span><span class="w"> </span><span class="n">Availability</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="k">Primary</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”€â”€</span><span class="n">X</span><span class="err">â”€â”€</span><span class="o">&gt;</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Replica</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="k">When</span><span class="w"> </span><span class="k">Primary</span><span class="w"> </span><span class="n">fails</span><span class="p">,</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">Down</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="n">Active</span><span class="p">)</span><span class="err">â”‚</span><span class="w">    </span><span class="n">Replica</span><span class="w"> </span><span class="n">maintains</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="n">service</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="n">Scalability</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="k">Primary</span><span class="w"> </span><span class="err">â”‚â”€â”€â”€â”€â”¬â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Replica</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">â†â”€â”€â”€</span><span class="w"> </span><span class="k">Read</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="k">Write</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”œâ”€â”€â”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Replica</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">â†â”€â”€â”€</span><span class="w"> </span><span class="k">Read</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Replica</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">â†â”€â”€â”€</span><span class="w"> </span><span class="k">Read</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Geographical</span><span class="w"> </span><span class="n">Distribution</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="n">Seoul</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Tokyo</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="n">US</span><span class="o">-</span><span class="n">West</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">[</span><span class="n">Primary</span><span class="o">]</span><span class="w">            </span><span class="o">[</span><span class="n">Replica</span><span class="o">]</span><span class="w">             </span><span class="o">[</span><span class="n">Replica</span><span class="o">]</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="nl">Latency</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span><span class="w">         </span><span class="nl">Latency</span><span class="p">:</span><span class="w"> </span><span class="o">~</span><span class="mi">30</span><span class="n">ms</span><span class="w">        </span><span class="nl">Latency</span><span class="p">:</span><span class="w"> </span><span class="o">~</span><span class="mi">100</span><span class="n">ms</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="k">Data</span><span class="w"> </span><span class="n">Protection</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Hardware</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">protection</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="k">Data</span><span class="w"> </span><span class="n">center</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">protection</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Disaster</span><span class="w"> </span><span class="n">Recovery</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="types-of-replication-architecture">Types of Replication Architecture<a class="header-link" href="#types-of-replication-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Replication Architecture Comparison               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Single-Leader                                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚     â”‚ Leader â”‚ â”€â”€Writeâ”€â”€&gt;                                      â”‚
â”‚     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                 â”‚
â”‚         â”‚ Replicate                                            â”‚
â”‚     â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚     â–¼       â–¼       â–¼                                          â”‚
â”‚  Follower Follower Follower                                    â”‚
â”‚                                                                 â”‚
â”‚  2. Multi-Leader                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚     â”‚Leader 1â”‚&lt;â”€â”€â”€&gt;â”‚Leader 2â”‚&lt;â”€â”€â”€&gt;â”‚Leader 3â”‚                   â”‚
â”‚     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚              â”‚              â”‚                        â”‚
â”‚      Follower       Follower       Follower                    â”‚
â”‚                                                                 â”‚
â”‚  3. Leaderless                                                  â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚       â”‚Node 1â”‚   â”‚Node 2â”‚   â”‚Node 3â”‚                           â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚           â–²          â–²          â–²                              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚              All nodes are equal                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-single-leader-replication">2. Single-Leader Replication<a class="header-link" href="#2-single-leader-replication" title="Permanent link">&para;</a></h2>
<h3 id="how-it-works">How It Works<a class="header-link" href="#how-it-works" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Single-Leader Replication                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Client                                                         â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”‚ Write Request                                              â”‚
â”‚    â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚              Leader (Primary)            â”‚                    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                    â”‚
â”‚  â”‚  â”‚         Transaction Log          â”‚    â”‚                    â”‚
â”‚  â”‚  â”‚  [1] INSERT INTO users...        â”‚    â”‚                    â”‚
â”‚  â”‚  â”‚  [2] UPDATE orders...            â”‚    â”‚                    â”‚
â”‚  â”‚  â”‚  [3] DELETE from cart...         â”‚    â”‚                    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                    â”‚                                            â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚          â”‚  Replication Log  â”‚                                  â”‚
â”‚          â–¼         â–¼         â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Follower1 â”‚ â”‚ Follower2 â”‚ â”‚ Follower3 â”‚                      â”‚
â”‚  â”‚ (Replica) â”‚ â”‚ (Replica) â”‚ â”‚ (Replica) â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚        â”‚             â”‚             â”‚                            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                      â”‚                                          â”‚
â”‚                Read Requests                                    â”‚
â”‚                      â–²                                          â”‚
â”‚                   Clients                                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="replication-methods">Replication Methods<a class="header-link" href="#replication-methods" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Replication Methods Comparison                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Statement-Based Replication                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚     â”‚  Leader: INSERT INTO users VALUES (...)  â”‚                â”‚
â”‚     â”‚            â”‚                             â”‚                â”‚
â”‚     â”‚            â–¼                             â”‚                â”‚
â”‚     â”‚  Follower: INSERT INTO users VALUES (...) â”‚ â† SQL replay  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚     Problem: Non-deterministic functions like NOW(), RAND()     â”‚
â”‚                                                                 â”‚
â”‚  2. Write-Ahead Log (WAL) Shipping                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚     â”‚  Leader WAL:                             â”‚                â”‚
â”‚     â”‚  [Page 5, Offset 120, Data: 0x45AB...]   â”‚                â”‚
â”‚     â”‚            â”‚                             â”‚                â”‚
â”‚     â”‚            â–¼                             â”‚                â”‚
â”‚     â”‚  Follower: Apply identically byte by byteâ”‚ â† Low-level   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   replication  â”‚
â”‚     Problem: Version compatibility (downtime on upgrade)        â”‚
â”‚                                                                 â”‚
â”‚  3. Row-Based (Logical) Replication                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚     â”‚  Change Log:                             â”‚                â”‚
â”‚     â”‚  {table: &quot;users&quot;,                        â”‚                â”‚
â”‚     â”‚   op: &quot;INSERT&quot;,                          â”‚                â”‚
â”‚     â”‚   new_row: {id:1, name:&quot;Kim&quot;}}           â”‚ â† Logical     â”‚
â”‚     â”‚            â”‚                             â”‚    changes     â”‚
â”‚     â”‚            â–¼                             â”‚                â”‚
â”‚     â”‚  Follower: Apply row data                â”‚                â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚     Advantages: Version compatible, flexible replication        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="postgresql-streaming-replication-example">PostgreSQL Streaming Replication Example<a class="header-link" href="#postgresql-streaming-replication-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Primary configuration (postgresql.conf)</span>
<span class="n">wal_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replica</span>
<span class="n">max_wal_senders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="n">wal_keep_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="n">GB</span>

<span class="c1">-- Primary: Create replication slot</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_create_physical_replication_slot</span><span class="p">(</span><span class="s1">&#39;replica1_slot&#39;</span><span class="p">);</span>

<span class="c1">-- Standby configuration (postgresql.conf)</span>
<span class="n">primary_conninfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;host=primary-host port=5432 user=replicator&#39;</span>
<span class="n">primary_slot_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;replica1_slot&#39;</span>

<span class="c1">-- Check replication status</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">client_addr</span><span class="p">,</span>
<span class="w">    </span><span class="k">state</span><span class="p">,</span>
<span class="w">    </span><span class="n">sent_lsn</span><span class="p">,</span>
<span class="w">    </span><span class="n">write_lsn</span><span class="p">,</span>
<span class="w">    </span><span class="n">flush_lsn</span><span class="p">,</span>
<span class="w">    </span><span class="n">replay_lsn</span><span class="p">,</span>
<span class="w">    </span><span class="n">pg_wal_lsn_diff</span><span class="p">(</span><span class="n">sent_lsn</span><span class="p">,</span><span class="w"> </span><span class="n">replay_lsn</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">replication_lag</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_replication</span><span class="p">;</span>
</code></pre></div>

<h3 id="mysql-replication-configuration-example">MySQL Replication Configuration Example<a class="header-link" href="#mysql-replication-configuration-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Master configuration (my.cnf)</span>
<span class="c1">-- server-id=1</span>
<span class="c1">-- log_bin=mysql-bin</span>
<span class="c1">-- binlog_format=ROW</span>

<span class="c1">-- Master: Create replication user</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;repl&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;repl&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">MASTER</span><span class="w"> </span><span class="n">STATUS</span><span class="p">;</span>

<span class="c1">-- Slave configuration</span>
<span class="n">CHANGE</span><span class="w"> </span><span class="n">MASTER</span><span class="w"> </span><span class="k">TO</span>
<span class="w">    </span><span class="n">MASTER_HOST</span><span class="o">=</span><span class="s1">&#39;master-host&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">MASTER_USER</span><span class="o">=</span><span class="s1">&#39;repl&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">MASTER_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">MASTER_LOG_FILE</span><span class="o">=</span><span class="s1">&#39;mysql-bin.000001&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">MASTER_LOG_POS</span><span class="o">=</span><span class="mi">154</span><span class="p">;</span>

<span class="k">START</span><span class="w"> </span><span class="n">SLAVE</span><span class="p">;</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="n">STATUS</span><span class="err">\</span><span class="k">G</span>
</code></pre></div>

<hr />
<h2 id="3-multi-leader-replication">3. Multi-Leader Replication<a class="header-link" href="#3-multi-leader-replication" title="Permanent link">&para;</a></h2>
<h3 id="architecture">Architecture<a class="header-link" href="#architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">               </span><span class="n">Multi</span><span class="o">-</span><span class="n">Leader</span><span class="w"> </span><span class="n">Replication</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="n">Data</span><span class="w"> </span><span class="n">Center</span><span class="w"> </span><span class="n">A</span><span class="w">              </span><span class="n">Data</span><span class="w"> </span><span class="n">Center</span><span class="w"> </span><span class="n">B</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">        </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="n">Leader</span><span class="w"> </span><span class="n">A</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="o">&lt;</span><span class="err">â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="n">Leader</span><span class="w"> </span><span class="n">B</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">users</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Sync</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">users</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">orders</span><span class="o">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="o">&lt;</span><span class="err">â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">orders</span><span class="o">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”´â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”Œâ”€â”€â”€â”´â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â–¼</span><span class="w">       </span><span class="err">â–¼</span><span class="w">     </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â–¼</span><span class="w">       </span><span class="err">â–¼</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Follower</span><span class="w"> </span><span class="n">Follower</span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Follower</span><span class="w"> </span><span class="n">Follower</span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">        </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">â–²</span><span class="w">                          </span><span class="err">â–²</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                          </span><span class="err">â”‚</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="p">[</span><span class="n">Clients</span><span class="w"> </span><span class="n">A</span><span class="p">]</span><span class="w">                </span><span class="p">[</span><span class="n">Clients</span><span class="w"> </span><span class="n">B</span><span class="p">]</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="n">Latency</span><span class="o">:</span><span class="w"> </span><span class="o">~</span><span class="mi">1</span><span class="n">ms</span><span class="w">              </span><span class="n">Latency</span><span class="o">:</span><span class="w"> </span><span class="o">~</span><span class="mi">1</span><span class="n">ms</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Advantages</span><span class="o">:</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Low</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">center</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Can</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">DC</span><span class="w"> </span><span class="n">failure</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Disadvantages</span><span class="o">:</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Conflict</span><span class="w"> </span><span class="n">resolution</span><span class="w"> </span><span class="n">needed</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Increased</span><span class="w"> </span><span class="n">complexity</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="write-conflict-problem">Write Conflict Problem<a class="header-link" href="#write-conflict-problem" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Write Conflict Scenario                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Time â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;         â”‚
â”‚                                                                 â”‚
â”‚  Leader A:                                                      â”‚
â”‚    T1: UPDATE users SET name=&#39;Kim&#39; WHERE id=1                   â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼ (replicate)                                           â”‚
â”‚                                                                 â”‚
â”‚  Leader B:                                                      â”‚
â”‚    T1: UPDATE users SET name=&#39;Lee&#39; WHERE id=1                   â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼ (replicate)                                           â”‚
â”‚                                                                 â”‚
â”‚  Result:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚  Leader A   â”‚         â”‚  Leader B   â”‚                       â”‚
â”‚  â”‚ name=&#39;Lee&#39;? â”‚   â‰      â”‚ name=&#39;Kim&#39;? â”‚   Conflict!           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="conflict-resolution-strategies">Conflict Resolution Strategies<a class="header-link" href="#conflict-resolution-strategies" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Conflict Resolution Strategies                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Last Write Wins (LWW)                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚  Write A: {value: &quot;Kim&quot;, timestamp: 100}    â”‚            â”‚
â”‚     â”‚  Write B: {value: &quot;Lee&quot;, timestamp: 105}    â”‚            â”‚
â”‚     â”‚                                             â”‚            â”‚
â”‚     â”‚  Result: &quot;Lee&quot; (timestamp 105 &gt; 100)        â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚     Problem: Possible data loss                                 â”‚
â”‚                                                                 â”‚
â”‚  2. Version Vector (Vector Clock)                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚  Node A: {value: &quot;Kim&quot;, version: [A:1, B:0]} â”‚            â”‚
â”‚     â”‚  Node B: {value: &quot;Lee&quot;, version: [A:0, B:1]} â”‚            â”‚
â”‚     â”‚                                             â”‚            â”‚
â”‚     â”‚  Detect concurrent writes â†’ Merge needed     â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  3. CRDT (Conflict-free Replicated Data Type)                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚  G-Counter: Maintain counter per node        â”‚            â”‚
â”‚     â”‚  Node A: +3                                 â”‚            â”‚
â”‚     â”‚  Node B: +2                                 â”‚            â”‚
â”‚     â”‚  Total: 3 + 2 = 5 (automatic merge)         â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  4. Custom Resolution Logic                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚  Example: Shopping cart conflict             â”‚            â”‚
â”‚     â”‚  Cart A: [Item1, Item2]                     â”‚            â”‚
â”‚     â”‚  Cart B: [Item1, Item3]                     â”‚            â”‚
â”‚     â”‚  Merge: [Item1, Item2, Item3] (Union)       â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="replication-topologies">Replication Topologies<a class="header-link" href="#replication-topologies" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Replication Topology Types                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Circular                                                    â”‚
â”‚       â”Œâ”€â”€â”€â”                                                    â”‚
â”‚       â”‚ A â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚       â””â”€â”¬â”€â”˜           â”‚                                        â”‚
â”‚         â”‚           â”Œâ”€â–¼â”€â”                                      â”‚
â”‚         â”‚           â”‚ B â”‚                                      â”‚
â”‚         â”‚           â””â”€â”¬â”€â”˜                                      â”‚
â”‚       â”Œâ”€â–¼â”€â”           â”‚                                        â”‚
â”‚       â”‚ D â”‚ &lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚       â””â”€â”¬â”€â”˜           â”‚                                        â”‚
â”‚         â””â”€â”€&gt; â”Œâ”€â”€â”€â” &lt;â”€â”€â”˜                                        â”‚
â”‚              â”‚ C â”‚                                              â”‚
â”‚              â””â”€â”€â”€â”˜                                              â”‚
â”‚     Risk of entire replication stopping on failure              â”‚
â”‚                                                                 â”‚
â”‚  2. Star                                                        â”‚
â”‚           â”Œâ”€â”€â”€â”                                                â”‚
â”‚           â”‚ B â”‚                                                â”‚
â”‚           â””â”€â”¬â”€â”˜                                                â”‚
â”‚       â”Œâ”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”                                            â”‚
â”‚       â”‚ A â”‚â”€â”¼â”€â”‚ C â”‚                                            â”‚
â”‚       â””â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”˜                                            â”‚
â”‚           â”Œâ”€â–¼â”€â”                                                â”‚
â”‚           â”‚Hubâ”‚  â† Vulnerable when central node fails          â”‚
â”‚           â””â”€â”€â”€â”˜                                                â”‚
â”‚                                                                 â”‚
â”‚  3. All-to-All                                                  â”‚
â”‚       â”Œâ”€â”€â”€â”     â”Œâ”€â”€â”€â”                                          â”‚
â”‚       â”‚ A â”‚ â†â”€â”€â†’â”‚ B â”‚                                          â”‚
â”‚       â””â”€â”¬â”€â”˜     â””â”€â”¬â”€â”˜                                          â”‚
â”‚         â”‚    â•² â•±  â”‚                                            â”‚
â”‚         â”‚     â•³   â”‚                                            â”‚
â”‚         â”‚    â•± â•²  â”‚                                            â”‚
â”‚       â”Œâ”€â–¼â”€â”     â”Œâ”€â–¼â”€â”                                          â”‚
â”‚       â”‚ D â”‚ â†â”€â”€â†’â”‚ C â”‚                                          â”‚
â”‚       â””â”€â”€â”€â”˜     â””â”€â”€â”€â”˜                                          â”‚
â”‚     High fault tolerance, complex management                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="4-leaderless-replication">4. Leaderless Replication<a class="header-link" href="#4-leaderless-replication" title="Permanent link">&para;</a></h2>
<h3 id="dynamo-style-replication">Dynamo-Style Replication<a class="header-link" href="#dynamo-style-replication" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Leaderless Replication                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Characteristics:                                               â”‚
â”‚  - All nodes can read/write                                     â”‚
â”‚  - Client sends requests to multiple nodes simultaneously       â”‚
â”‚  - Used in Amazon Dynamo, Cassandra, Riak, etc.                 â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Client                            â”‚   â”‚
â”‚  â”‚                          â”‚                               â”‚   â”‚
â”‚  â”‚           Write: key=X, value=V                          â”‚   â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚   â”‚
â”‚  â”‚           â–¼              â–¼              â–¼                â”‚   â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚       â”‚Node 1â”‚      â”‚Node 2â”‚      â”‚Node 3â”‚              â”‚   â”‚
â”‚  â”‚       â”‚ X=V  â”‚      â”‚ X=V  â”‚      â”‚(Down)â”‚              â”‚   â”‚
â”‚  â”‚       â”‚ âœ“    â”‚      â”‚ âœ“    â”‚      â”‚  âœ—   â”‚              â”‚   â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚   N=3 (total replicas), W=2 (required write successes)   â”‚   â”‚
â”‚  â”‚   2 nodes succeeded â†’ Write successful!                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="read-repair-and-anti-entropy">Read Repair and Anti-Entropy<a class="header-link" href="#read-repair-and-anti-entropy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Repair Mechanisms                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Read Repair (Repair on Read)                                â”‚
â”‚                                                                 â”‚
â”‚     Client                                                      â”‚
â”‚        â”‚ Read key=X                                             â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚        â–¼              â–¼                     â–¼                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”                â”‚
â”‚    â”‚Node 1â”‚      â”‚Node 2â”‚              â”‚Node 3â”‚                â”‚
â”‚    â”‚X=V2  â”‚      â”‚X=V2  â”‚              â”‚X=V1  â”‚ â† Stale version â”‚
â”‚    â”‚ver:2 â”‚      â”‚ver:2 â”‚              â”‚ver:1 â”‚                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚        â”‚              â”‚                     â”‚                   â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                       â”‚                                         â”‚
â”‚                       â–¼                                         â”‚
â”‚              Client: Compare versions                           â”‚
â”‚              Return latest version V2                           â”‚
â”‚              Request V2 update to Node 3 â†â”€â”€ Read Repair        â”‚
â”‚                                                                 â”‚
â”‚  2. Anti-Entropy Process (Background Sync)                      â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚           Background Anti-Entropy Process            â”‚    â”‚
â”‚    â”‚                                                      â”‚    â”‚
â”‚    â”‚  Node 1          Node 2          Node 3              â”‚    â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”              â”‚    â”‚
â”‚    â”‚  â”‚ A  â”‚         â”‚ A  â”‚          â”‚ A  â”‚              â”‚    â”‚
â”‚    â”‚  â”‚ B  â”‚  &lt;â”€â”€â”€â”€&gt; â”‚ B  â”‚  &lt;â”€â”€â”€â”€&gt;  â”‚ B  â”‚              â”‚    â”‚
â”‚    â”‚  â”‚ C  â”‚ Merkle  â”‚ C  â”‚  Merkle  â”‚ C* â”‚ â† Mismatch   â”‚    â”‚
â”‚    â”‚  â”‚ D  â”‚  Tree   â”‚ D  â”‚   Tree   â”‚ D  â”‚              â”‚    â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”˜ Compare â””â”€â”€â”€â”€â”˜  Compare â””â”€â”€â”€â”€â”˜              â”‚    â”‚
â”‚    â”‚                                                      â”‚    â”‚
â”‚    â”‚  Efficient difference detection and sync via Merkle  â”‚    â”‚
â”‚    â”‚  Tree                                                â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="sloppy-quorum-and-hinted-handoff">Sloppy Quorum and Hinted Handoff<a class="header-link" href="#sloppy-quorum-and-hinted-handoff" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Sloppy Quorum &amp; Hinted Handoff                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Strict Quorum: Read/write only from designated nodes           â”‚
â”‚                                                                 â”‚
â”‚  Sloppy Quorum: Other nodes substitute when some fail           â”‚
â”‚                                                                 â”‚
â”‚  Normal situation:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚Node 1â”‚   â”‚Node 2â”‚   â”‚Node 3â”‚   â† Home nodes for key X       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                 â”‚
â”‚  When Node 3 fails:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚Node 1â”‚   â”‚Node 2â”‚   â”‚(Down)â”‚   â”‚Node 4â”‚                     â”‚
â”‚  â”‚ X=V  â”‚   â”‚ X=V  â”‚   â”‚      â”‚   â”‚ X=V* â”‚ â† Store with Hint   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â”‚  *Hinted Handoff:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Data stored in Node 4:                   â”‚                  â”‚
â”‚  â”‚  {                                        â”‚                  â”‚
â”‚  â”‚    key: &quot;X&quot;,                              â”‚                  â”‚
â”‚  â”‚    value: &quot;V&quot;,                            â”‚                  â”‚
â”‚  â”‚    hint: &quot;Node 3&quot;  â† Original target node â”‚                  â”‚
â”‚  â”‚  }                                        â”‚                  â”‚
â”‚  â”‚                                           â”‚                  â”‚
â”‚  â”‚  When Node 3 recovers â†’ Transfer then     â”‚                  â”‚
â”‚  â”‚  delete                                   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="5-synchronousasynchronous-replication">5. Synchronous/Asynchronous Replication<a class="header-link" href="#5-synchronousasynchronous-replication" title="Permanent link">&para;</a></h2>
<h3 id="synchronous-replication">Synchronous Replication<a class="header-link" href="#synchronous-replication" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">Synchronous</span><span class="w"> </span><span class="nv">Replication</span><span class="w">                       </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Client</span><span class="w">          </span><span class="nv">Leader</span><span class="w">           </span><span class="nv">Follower</span><span class="w"> </span><span class="mi">1</span><span class="w">      </span><span class="nv">Follower</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚<span class="w">                  </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">  </span><span class="nv">Write</span><span class="w"> </span><span class="nv">X</span><span class="o">=</span><span class="nv">V</span><span class="w">    </span>â”‚<span class="w">                  </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="o">&gt;</span>â”‚<span class="w">                  </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚<span class="w">  </span><span class="nv">Replicate</span><span class="w">       </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="o">&gt;</span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="o">&gt;</span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚<span class="w">                  </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚<span class="w">   </span><span class="nv">ACK</span><span class="w">            </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚<span class="o">&lt;</span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚<span class="o">&lt;</span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚<span class="w">                  </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">   </span><span class="nv">ACK</span><span class="w">         </span>â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">After</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">replicated</span><span class="ss">)</span><span class="w">         </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="o">&lt;</span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">                  </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="w">               </span>â”‚<span class="w">                  </span>â”‚<span class="w">               </span>â”‚<span class="w">         </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Advantages</span>:<span class="w">                                                    </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Strong</span><span class="w"> </span><span class="nv">consistency</span><span class="w"> </span><span class="nv">guaranteed</span><span class="w">                                </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">loss</span><span class="w">                                                 </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Disadvantages</span>:<span class="w">                                                 </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Slow</span><span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">latency</span><span class="w"> </span><span class="ss">(</span><span class="k">wait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">replicas</span><span class="ss">)</span><span class="w">                   </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Cannot</span><span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">replica</span><span class="w"> </span><span class="nv">fails</span><span class="w">                              </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="asynchronous-replication">Asynchronous Replication<a class="header-link" href="#asynchronous-replication" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Asynchronous Replication                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Client          Leader           Follower 1      Follower 2    â”‚
â”‚    â”‚               â”‚                  â”‚               â”‚         â”‚
â”‚    â”‚  Write X=V    â”‚                  â”‚               â”‚         â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚                  â”‚               â”‚         â”‚
â”‚    â”‚               â”‚                  â”‚               â”‚         â”‚
â”‚    â”‚   ACK         â”‚  (Immediate response)           â”‚         â”‚
â”‚    â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚         â”‚
â”‚    â”‚               â”‚                  â”‚               â”‚         â”‚
â”‚    â”‚               â”‚  Replicate (background)         â”‚         â”‚
â”‚    â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚               â”‚         â”‚
â”‚    â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚         â”‚
â”‚    â”‚               â”‚                  â”‚               â”‚         â”‚
â”‚                                                                 â”‚
â”‚  Advantages:                                                    â”‚
â”‚  - Fast write response                                          â”‚
â”‚  - Replica failure doesn&#39;t affect writes                        â”‚
â”‚                                                                 â”‚
â”‚  Disadvantages:                                                 â”‚
â”‚  - Possible data loss on leader failure                         â”‚
â”‚  - Read consistency issues (stale read)                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="semi-synchronous-replication">Semi-Synchronous Replication<a class="header-link" href="#semi-synchronous-replication" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="nt">Semi-Synchronous</span><span class="w"> </span><span class="nt">Replication</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Replicate</span><span class="w"> </span><span class="nt">synchronously</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">least</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">replica</span><span class="o">,</span><span class="w"> </span><span class="nt">async</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">rest</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Client</span><span class="w">          </span><span class="nt">Leader</span><span class="w">        </span><span class="nt">Sync</span><span class="w"> </span><span class="nt">Follower</span><span class="w">   </span><span class="nt">Async</span><span class="w"> </span><span class="nt">Followers</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Write</span><span class="w"> </span><span class="nt">X</span><span class="o">=</span><span class="nt">V</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Replicate</span><span class="w">     </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">ACK</span><span class="w">           </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="o">&lt;</span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">   </span><span class="nt">ACK</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="o">&lt;</span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Replicate</span><span class="w"> </span><span class="o">(</span><span class="nt">async</span><span class="o">)</span><span class="w">             </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="o">&gt;</span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">MySQL</span><span class="w"> </span><span class="nt">Semi-Sync</span><span class="w"> </span><span class="nt">Configuration</span><span class="o">:</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Master</span><span class="w">                                                 </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">SET</span><span class="w"> </span><span class="nt">GLOBAL</span><span class="w"> </span><span class="nt">rpl_semi_sync_master_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="o">;</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">SET</span><span class="w"> </span><span class="nt">GLOBAL</span><span class="w"> </span><span class="nt">rpl_semi_sync_master_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">10000</span><span class="o">;</span><span class="w"> </span><span class="nt">--</span><span class="w"> </span><span class="nt">10s</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Slave</span><span class="w">                                                  </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">SET</span><span class="w"> </span><span class="nt">GLOBAL</span><span class="w"> </span><span class="nt">rpl_semi_sync_slave_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="o">;</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="6-replication-lag-and-consistency-issues">6. Replication Lag and Consistency Issues<a class="header-link" href="#6-replication-lag-and-consistency-issues" title="Permanent link">&para;</a></h2>
<h3 id="replication-lag">Replication Lag<a class="header-link" href="#replication-lag" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Replication Lag Scenario                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Time â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;         â”‚
â”‚                                                                 â”‚
â”‚  T0      T1       T2       T3       T4       T5                 â”‚
â”‚  â”‚       â”‚        â”‚        â”‚        â”‚        â”‚                  â”‚
â”‚  Leader: Write    â”‚        â”‚        â”‚        â”‚                  â”‚
â”‚          X=1      â”‚        â”‚        â”‚        â”‚                  â”‚
â”‚           â”‚       â”‚        â”‚        â”‚        â”‚                  â”‚
â”‚           â”‚       â–¼        â”‚        â”‚        â”‚                  â”‚
â”‚  Follower:        X=1      â”‚        â”‚        â”‚                  â”‚
â”‚                   (delay)  â”‚        â”‚        â”‚                  â”‚
â”‚                            â”‚        â”‚        â”‚                  â”‚
â”‚  Client A:        Read from Leader  â”‚        â”‚                  â”‚
â”‚                   X=1 âœ“    â”‚        â”‚        â”‚                  â”‚
â”‚                            â”‚        â”‚        â”‚                  â”‚
â”‚  Client B:                 Read from Followerâ”‚                  â”‚
â”‚                            X=??? â† At T2,                       â”‚
â”‚                                    Follower not yet replicated  â”‚
â”‚                                    â†’ Stale Read!                â”‚
â”‚                                                                 â”‚
â”‚  Replication Lag = T1(Leader Write) ~ T2(Follower Apply) time   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="consistency-guarantee-levels">Consistency Guarantee Levels<a class="header-link" href="#consistency-guarantee-levels" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">Consistency</span><span class="w"> </span><span class="nv">Guarantee</span><span class="w"> </span><span class="nv">Levels</span><span class="w">                  </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Read</span><span class="o">-</span><span class="nv">Your</span><span class="o">-</span><span class="nv">Writes</span><span class="w">                                            </span>â”‚
â”‚<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">User</span><span class="w"> </span><span class="nv">A</span>:<span class="w"> </span><span class="nv">Write</span><span class="w"> </span><span class="nv">profile</span><span class="w"> </span><span class="nv">photo</span><span class="w">                        </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">          </span>â”‚<span class="w">                                          </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">          </span>â–¼<span class="w">                                          </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">User</span><span class="w"> </span><span class="nv">A</span>:<span class="w"> </span><span class="nv">Read</span><span class="w"> </span><span class="nv">profile</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Should</span><span class="w"> </span><span class="nv">see</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">photo</span><span class="w">        </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">                                                     </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">Solutions</span>:<span class="w">                                          </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Always</span><span class="w"> </span><span class="nv">read</span><span class="w"> </span><span class="nv">own</span><span class="w"> </span><span class="nv">changes</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">Leader</span><span class="w">              </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Or</span><span class="w"> </span><span class="nv">timestamp</span><span class="o">-</span><span class="nv">based</span><span class="w"> </span><span class="nv">read</span><span class="w"> </span><span class="nv">position</span><span class="w">                 </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">    </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Monotonic</span><span class="w"> </span><span class="nv">Reads</span><span class="w">                                             </span>â”‚
â”‚<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">T1</span>:<span class="w"> </span><span class="nv">Read</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">Follower</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">X</span><span class="o">=</span><span class="mi">2</span><span class="w">                     </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">T2</span>:<span class="w"> </span><span class="nv">Read</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">Follower</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">X</span><span class="o">=</span><span class="mi">1</span><span class="w">  </span>â†<span class="w"> </span><span class="nv">Problem</span><span class="o">!</span><span class="w">         </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">                                                     </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">Appears</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">went</span><span class="w"> </span><span class="nv">backwards</span><span class="w">                  </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">                                                     </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">Solutions</span>:<span class="w">                                          </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Read</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">replica</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">user</span><span class="w">                  </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Version</span><span class="o">-</span><span class="nv">based</span><span class="w"> </span><span class="nv">reads</span><span class="w">                              </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">    </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">3</span>.<span class="w"> </span><span class="nv">Consistent</span><span class="w"> </span><span class="nv">Prefix</span><span class="w"> </span><span class="nv">Reads</span><span class="w"> </span><span class="ss">(</span><span class="nv">Causality</span><span class="w"> </span><span class="nv">Preservation</span><span class="ss">)</span><span class="w">            </span>â”‚
â”‚<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">Chat</span>:<span class="w">                                              </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">A</span>:<span class="w"> </span><span class="s2">&quot;How&#39;s the weather in Seoul?&quot;</span><span class="w">  </span><span class="ss">(</span><span class="nv">T1</span><span class="ss">)</span><span class="w">             </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">B</span>:<span class="w"> </span><span class="s2">&quot;It&#39;s sunny!&quot;</span><span class="w">                  </span><span class="ss">(</span><span class="nv">T2</span><span class="ss">)</span><span class="w">             </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">                                                     </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">With</span><span class="w"> </span><span class="nv">replication</span><span class="w"> </span><span class="nv">lag</span>:<span class="w">                              </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">What</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">sees</span>:<span class="w">                                       </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">B</span>:<span class="w"> </span><span class="s2">&quot;It&#39;s sunny!&quot;</span><span class="w">  </span>â†<span class="w"> </span><span class="nv">T2</span><span class="w"> </span><span class="nv">arrives</span><span class="w"> </span><span class="nv">first</span><span class="w">               </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">A</span>:<span class="w"> </span><span class="s2">&quot;How&#39;s the weather in Seoul?&quot;</span><span class="w">  </span>â†<span class="w"> </span><span class="nv">T1</span><span class="w"> </span><span class="nv">arrives</span><span class="w">     </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">                                        </span><span class="nv">later</span><span class="w">        </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">                                                     </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">Solutions</span>:<span class="w">                                          </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Store</span><span class="w"> </span><span class="nv">causally</span><span class="w"> </span><span class="nv">related</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">partition</span><span class="w">    </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Causality</span><span class="w"> </span><span class="nv">tracking</span><span class="w">                               </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">    </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="replication-lag-monitoring">Replication Lag Monitoring<a class="header-link" href="#replication-lag-monitoring" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- PostgreSQL replication lag check</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">client_addr</span><span class="p">,</span>
<span class="w">    </span><span class="k">state</span><span class="p">,</span>
<span class="w">    </span><span class="n">pg_wal_lsn_diff</span><span class="p">(</span><span class="n">pg_current_wal_lsn</span><span class="p">(),</span><span class="w"> </span><span class="n">replay_lsn</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">lag_bytes</span><span class="p">,</span>
<span class="w">    </span><span class="k">EXTRACT</span><span class="p">(</span><span class="n">EPOCH</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pg_last_xact_replay_timestamp</span><span class="p">()))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">lag_seconds</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_replication</span><span class="p">;</span>

<span class="c1">-- MySQL replication lag check</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="n">STATUS</span><span class="err">\</span><span class="k">G</span>
<span class="c1">-- Check Seconds_Behind_Master value</span>

<span class="c1">-- Lag-based routing logic (application)</span>
<span class="cm">/*</span>
<span class="cm">def get_connection(query_type, max_lag_seconds=5):</span>
<span class="cm">    if query_type == &#39;write&#39;:</span>
<span class="cm">        return master_connection</span>

<span class="cm">    for replica in replicas:</span>
<span class="cm">        if replica.lag_seconds &lt; max_lag_seconds:</span>
<span class="cm">            return replica.connection</span>

<span class="cm">    # When all replicas have high lag, read from master</span>
<span class="cm">    return master_connection</span>
<span class="cm">*/</span>
</code></pre></div>

<hr />
<h2 id="7-failure-recovery-and-leader-election">7. Failure Recovery and Leader Election<a class="header-link" href="#7-failure-recovery-and-leader-election" title="Permanent link">&para;</a></h2>
<h3 id="follower-failure-recovery">Follower Failure Recovery<a class="header-link" href="#follower-failure-recovery" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">Follower</span><span class="w"> </span><span class="nv">Failure</span><span class="w"> </span><span class="nv">Recovery</span><span class="w">                     </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Catch</span><span class="o">-</span><span class="nv">up</span><span class="w"> </span><span class="nv">Recovery</span><span class="w">                                           </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">     </span><span class="nv">Normal</span><span class="w"> </span><span class="nv">state</span>:<span class="w">                                               </span>â”‚
â”‚<span class="w">     </span><span class="nv">Leader</span>:<span class="w">    </span>[<span class="mi">1</span>]<span class="w"> </span>[<span class="mi">2</span>]<span class="w"> </span>[<span class="mi">3</span>]<span class="w"> </span>[<span class="mi">4</span>]<span class="w"> </span>[<span class="mi">5</span>]<span class="w"> </span>[<span class="mi">6</span>]<span class="w">                          </span>â”‚
â”‚<span class="w">     </span><span class="nv">Follower</span>:<span class="w">  </span>[<span class="mi">1</span>]<span class="w"> </span>[<span class="mi">2</span>]<span class="w"> </span>[<span class="mi">3</span>]<span class="w">                                      </span>â”‚
â”‚<span class="w">                         </span>â–²<span class="w">                                       </span>â”‚
â”‚<span class="w">                         </span>â””â”€â”€<span class="w"> </span><span class="nv">Remembers</span><span class="w"> </span><span class="nv">last</span><span class="w"> </span><span class="nv">applied</span><span class="w"> </span><span class="nv">position</span><span class="w">     </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">     </span><span class="nv">After</span><span class="w"> </span><span class="nv">Follower</span><span class="w"> </span><span class="nv">recovers</span>:<span class="w">                                    </span>â”‚
â”‚<span class="w">     </span><span class="nv">Leader</span>:<span class="w">    </span>[<span class="mi">1</span>]<span class="w"> </span>[<span class="mi">2</span>]<span class="w"> </span>[<span class="mi">3</span>]<span class="w"> </span>[<span class="mi">4</span>]<span class="w"> </span>[<span class="mi">5</span>]<span class="w"> </span>[<span class="mi">6</span>]<span class="w"> </span>[<span class="mi">7</span>]<span class="w"> </span>[<span class="mi">8</span>]<span class="w">                  </span>â”‚
â”‚<span class="w">     </span><span class="nv">Follower</span>:<span class="w">  </span>[<span class="mi">1</span>]<span class="w"> </span>[<span class="mi">2</span>]<span class="w"> </span>[<span class="mi">3</span>]<span class="w"> </span>â†’<span class="w"> </span>[<span class="mi">4</span>]<span class="w"> </span>[<span class="mi">5</span>]<span class="w"> </span>[<span class="mi">6</span>]<span class="w"> </span>[<span class="mi">7</span>]<span class="w"> </span>[<span class="mi">8</span>]<span class="w">               </span>â”‚
â”‚<span class="w">                             </span>â†‘<span class="w">                                   </span>â”‚
â”‚<span class="w">                             </span><span class="nv">Catch</span><span class="o">-</span><span class="nv">up</span><span class="w">                            </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Recovery</span><span class="w"> </span><span class="nv">Process</span><span class="w">                                            </span>â”‚
â”‚<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Follower</span><span class="w"> </span><span class="nv">restarts</span><span class="w">                              </span>â”‚<span class="w">     </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Check</span><span class="w"> </span><span class="nv">last</span><span class="w"> </span><span class="nv">applied</span><span class="w"> </span><span class="nv">LSN</span><span class="o">/</span><span class="nv">binlog</span><span class="w"> </span><span class="nv">position</span><span class="w">         </span>â”‚<span class="w">     </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="mi">3</span>.<span class="w"> </span><span class="nv">Request</span><span class="w"> </span><span class="nv">logs</span><span class="w"> </span><span class="nv">after</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">position</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">Leader</span><span class="w">   </span>â”‚<span class="w">     </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="mi">4</span>.<span class="w"> </span><span class="nv">Catch</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">applying</span><span class="w"> </span><span class="nv">logs</span><span class="w">                   </span>â”‚<span class="w">     </span>â”‚
â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="mi">5</span>.<span class="w"> </span><span class="nv">Resume</span><span class="w"> </span><span class="nv">real</span><span class="o">-</span><span class="nv">time</span><span class="w"> </span><span class="nv">replication</span><span class="w">                   </span>â”‚<span class="w">     </span>â”‚
â”‚<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="leader-failure-and-failover">Leader Failure and Failover<a class="header-link" href="#leader-failure-and-failover" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Leader Failure Recovery (Failover)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Failover Process:                                              â”‚
â”‚                                                                 â”‚
â”‚  Step 1: Failure Detection                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        Heartbeat failure                    â”‚   â”‚
â”‚  â”‚   â”‚ Leader â”‚ â”€â”€â”€â”€Xâ”€â”€â”€â”€ (3 consecutive)                   â”‚   â”‚
â”‚  â”‚   â”‚ (Down) â”‚                                             â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        Timeout: 30 seconds                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚   Followers: &quot;No Leader response!&quot; â†’ Start Failover      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Step 2: New Leader Election                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Follower A: LSN = 1000                                 â”‚   â”‚
â”‚  â”‚   Follower B: LSN = 1050  â† Most up-to-date â†’ New Leader â”‚   â”‚
â”‚  â”‚   Follower C: LSN = 980                                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚   Election criteria:                                     â”‚   â”‚
â”‚  â”‚   1. Node with most up-to-date data                      â”‚   â”‚
â”‚  â”‚   2. Node priority                                       â”‚   â”‚
â”‚  â”‚   3. Consensus algorithm (Raft, Paxos)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Step 3: Client Reconnection                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Clients â”€â”€â”€â”€â”€ (old) Leader: 10.0.0.1                   â”‚   â”‚
â”‚  â”‚           â•²                                              â”‚   â”‚
â”‚  â”‚            â•²â”€â”€â”€ (new) Leader: 10.0.0.2                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚   Methods:                                               â”‚   â”‚
â”‚  â”‚   - DNS update                                           â”‚   â”‚
â”‚  â”‚   - Virtual IP (VIP) transfer                            â”‚   â”‚
â”‚  â”‚   - Proxy/Load Balancer configuration change             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="failover-problems">Failover Problems<a class="header-link" href="#failover-problems" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="n">Failover</span><span class="w"> </span><span class="n">Problems</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">Loss</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">replication</span><span class="p">)</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Old</span><span class="w"> </span><span class="n">Leader</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="w">                       </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                          </span><span class="err">â†‘</span><span class="w"> </span><span class="n">Not</span><span class="w"> </span><span class="n">replicated</span><span class="w">          </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">New</span><span class="w"> </span><span class="n">Leader</span><span class="p">:</span><span class="w">  </span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="w">                         </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Write</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">lost</span><span class="o">!</span><span class="w">                                </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">When</span><span class="w"> </span><span class="n">Old</span><span class="w"> </span><span class="n">Leader</span><span class="w"> </span><span class="n">recovers</span><span class="p">:</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="err">?</span><span class="w">         </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">Typically</span><span class="w"> </span><span class="n">discarded</span><span class="w"> </span><span class="p">(</span><span class="n">conflict</span><span class="w"> </span><span class="n">prevention</span><span class="p">)</span><span class="w">       </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">Split</span><span class="w"> </span><span class="n">Brain</span><span class="w"> </span><span class="p">(</span><span class="n">Two</span><span class="w"> </span><span class="n">Leaders</span><span class="w"> </span><span class="n">problem</span><span class="p">)</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">        </span><span class="n">Network</span><span class="w"> </span><span class="n">Partition</span><span class="w">                           </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">       </span><span class="err">â•³</span><span class="w">        </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">             </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="n">Old</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="n">New</span><span class="w">     </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="n">Leader</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Network</span><span class="w"> </span><span class="n">split</span><span class="w"> </span><span class="err">â”‚</span><span class="n">Leader</span><span class="w">  </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">             </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â–²</span><span class="w">                          </span><span class="err">â–²</span><span class="w">                </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Clients</span><span class="w"> </span><span class="n">A</span><span class="w">                  </span><span class="n">Clients</span><span class="w"> </span><span class="n">B</span><span class="w">             </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="k">continue</span><span class="w"> </span><span class="n">writing</span><span class="p">)</span><span class="w">         </span><span class="p">(</span><span class="k">continue</span><span class="w"> </span><span class="n">writing</span><span class="p">)</span><span class="w">    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">inconsistency</span><span class="w"> </span><span class="n">occurs</span><span class="o">!</span><span class="w">                      </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Solutions</span><span class="p">:</span><span class="w">                                        </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Fencing</span><span class="w"> </span><span class="p">(</span><span class="n">STONITH</span><span class="p">:</span><span class="w"> </span><span class="n">Shoot</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Other</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">Head</span><span class="p">)</span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Force</span><span class="w"> </span><span class="n">shutdown</span><span class="w"> </span><span class="n">Old</span><span class="w"> </span><span class="n">Leader</span><span class="w">                       </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Timeout</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="n">Dilemma</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Timeout</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">short</span><span class="p">:</span><span class="w">                                </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Unnecessary</span><span class="w"> </span><span class="n">failover</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">delay</span><span class="o">/</span><span class="nb">load</span><span class="w">      </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="n">instability</span><span class="w">                              </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Timeout</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">long</span><span class="p">:</span><span class="w">                                 </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Delayed</span><span class="w"> </span><span class="n">recovery</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">failure</span><span class="w">              </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Increased</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="n">downtime</span><span class="w">                      </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="leader-election-algorithm">Leader Election Algorithm<a class="header-link" href="#leader-election-algorithm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">Raft</span><span class="w"> </span><span class="nv">Leader</span><span class="w"> </span><span class="nv">Election</span><span class="w">                          </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">States</span>:<span class="w"> </span><span class="nv">Follower</span>,<span class="w"> </span><span class="nv">Candidate</span>,<span class="w"> </span><span class="nv">Leader</span><span class="w">                            </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                           </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span><span class="nv">Election</span><span class="w">      </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">          </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">          </span>â”‚<span class="w">     </span><span class="nb">Timeout</span><span class="w">       </span>â”‚<span class="w">           </span>â”‚<span class="w">          </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">Follower</span><span class="w"> </span>â”‚<span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="o">&gt;</span>â”‚<span class="w"> </span><span class="nv">Candidate</span><span class="w"> </span>â”‚<span class="w">          </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">          </span>â”‚<span class="w">                   </span>â”‚<span class="w">           </span>â”‚<span class="w">          </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                   </span>â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<span class="w">          </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">         </span>â–²<span class="w">                               </span>â”‚<span class="w">                </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">         </span>â”‚<span class="w"> </span><span class="nv">Discovers</span><span class="w">                     </span>â”‚<span class="w"> </span><span class="nv">Receives</span><span class="w">       </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">         </span>â”‚<span class="w"> </span><span class="nv">current</span><span class="w">                       </span>â”‚<span class="w"> </span><span class="nv">majority</span><span class="w">       </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">         </span>â”‚<span class="w"> </span><span class="nv">leader</span><span class="w">                        </span>â”‚<span class="w"> </span><span class="nv">votes</span><span class="w">          </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">         </span>â”‚<span class="w">                               </span>â–¼<span class="w">                </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">         </span>â”‚<span class="w">                         </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">           </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">         </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">  </span><span class="nv">Leader</span><span class="w">  </span>â”‚<span class="w">           </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                   </span>â”‚<span class="w">          </span>â”‚<span class="w">           </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">           </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">  </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Election</span><span class="w"> </span><span class="nv">Process</span>:<span class="w">                                              </span>â”‚
â”‚<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Follower</span><span class="w"> </span><span class="nv">becomes</span><span class="w"> </span><span class="nv">Candidate</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">heartbeat</span><span class="w"> </span><span class="nv">received</span><span class="w">         </span>â”‚
â”‚<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Increment</span><span class="w"> </span><span class="nv">Term</span><span class="w"> </span><span class="nv">number</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span><span class="mi">3</span>.<span class="w"> </span><span class="nv">Vote</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">self</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">RequestVote</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="nv">nodes</span><span class="w">                  </span>â”‚
â”‚<span class="w">  </span><span class="mi">4</span>.<span class="w"> </span><span class="nv">Leader</span><span class="w"> </span><span class="nv">elected</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">majority</span><span class="w"> </span><span class="nv">votes</span><span class="w"> </span><span class="nv">received</span><span class="w">                 </span>â”‚
â”‚<span class="w">  </span><span class="mi">5</span>.<span class="w"> </span><span class="nv">Leader</span><span class="w"> </span><span class="nv">sends</span><span class="w"> </span><span class="nv">periodic</span><span class="w"> </span><span class="nv">heartbeats</span><span class="w">                            </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Example</span>:<span class="w"> </span><span class="mi">5</span><span class="o">-</span><span class="nv">node</span><span class="w"> </span><span class="nv">cluster</span><span class="w">                                  </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                           </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Node</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="ss">(</span><span class="nv">Candidate</span>,<span class="w"> </span><span class="nv">Term</span><span class="w"> </span><span class="mi">5</span><span class="ss">)</span><span class="w">                               </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">                                                      </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”œâ”€â”€<span class="w"> </span><span class="nv">RequestVote</span><span class="w"> </span>â”€â”€<span class="o">&gt;</span><span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="nv">B</span>:<span class="w"> </span><span class="nv">Vote</span><span class="w"> </span><span class="nv">YES</span><span class="w">                   </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”œâ”€â”€<span class="w"> </span><span class="nv">RequestVote</span><span class="w"> </span>â”€â”€<span class="o">&gt;</span><span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="nv">C</span>:<span class="w"> </span><span class="nv">Vote</span><span class="w"> </span><span class="nv">YES</span><span class="w">                   </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”œâ”€â”€<span class="w"> </span><span class="nv">RequestVote</span><span class="w"> </span>â”€â”€<span class="o">&gt;</span><span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="nv">D</span>:<span class="w"> </span><span class="nv">Vote</span><span class="w"> </span><span class="nv">NO</span><span class="w"> </span><span class="ss">(</span><span class="nv">already</span><span class="w"> </span><span class="nv">voted</span><span class="ss">)</span><span class="w">    </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â””â”€â”€<span class="w"> </span><span class="nv">RequestVote</span><span class="w"> </span>â”€â”€<span class="o">&gt;</span><span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="nv">E</span>:<span class="w"> </span><span class="nv">Vote</span><span class="w"> </span><span class="nv">YES</span><span class="w">                   </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                           </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Majority</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">Leader</span><span class="o">!</span><span class="w">                       </span>â”‚<span class="w">  </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">  </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="8-quorum-and-consistency-levels">8. Quorum and Consistency Levels<a class="header-link" href="#8-quorum-and-consistency-levels" title="Permanent link">&para;</a></h2>
<h3 id="quorum-concept">Quorum Concept<a class="header-link" href="#quorum-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="nv">Quorum</span><span class="w"> </span><span class="nv">Concept</span><span class="w">                                </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">replicas</span><span class="w"> </span><span class="ss">(</span><span class="nv">Total</span><span class="w"> </span><span class="nv">Replicas</span><span class="ss">)</span><span class="w">                        </span>â”‚
â”‚<span class="w">  </span><span class="nv">W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">responses</span><span class="w"> </span><span class="nv">needed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">success</span><span class="w"> </span><span class="ss">(</span><span class="nv">Write</span><span class="w"> </span><span class="nv">Quorum</span><span class="ss">)</span>â”‚
â”‚<span class="w">  </span><span class="nv">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">responses</span><span class="w"> </span><span class="nv">needed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">read</span><span class="w"> </span><span class="nv">success</span><span class="w"> </span><span class="ss">(</span><span class="nv">Read</span><span class="w"> </span><span class="nv">Quorum</span><span class="ss">)</span><span class="w">  </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Strong</span><span class="w"> </span><span class="nv">consistency</span><span class="w"> </span><span class="nv">guarantee</span><span class="w"> </span><span class="nv">condition</span>:<span class="w"> </span><span class="nv">R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">W</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">N</span><span class="w">              </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                        </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">When</span><span class="w"> </span><span class="nv">N</span><span class="o">=</span><span class="mi">3</span>,<span class="w"> </span><span class="nv">W</span><span class="o">=</span><span class="mi">2</span>,<span class="w"> </span><span class="nv">R</span><span class="o">=</span><span class="mi">2</span>:<span class="w">                                  </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                        </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">On</span><span class="w"> </span><span class="nv">write</span>:<span class="w">                                            </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span>[<span class="nv">Node1</span>:<span class="w"> </span><span class="nv">X</span><span class="o">=</span><span class="nv">V</span>]<span class="w">  </span>[<span class="nv">Node2</span>:<span class="w"> </span><span class="nv">X</span><span class="o">=</span><span class="nv">V</span>]<span class="w">  </span>[<span class="nv">Node3</span>:<span class="w"> </span>?]<span class="w">              </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">        </span>âœ“<span class="w">             </span>âœ“<span class="w">           </span><span class="ss">(</span><span class="nv">pending</span><span class="ss">)</span><span class="w">             </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                        </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">On</span><span class="w"> </span><span class="nv">read</span>:<span class="w">                                             </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span>[<span class="nv">Node1</span>:<span class="w"> </span><span class="nv">X</span><span class="o">=</span><span class="nv">V</span>]<span class="w">  </span>[<span class="nv">Node2</span>:<span class="w"> </span>?]<span class="w">  </span>[<span class="nv">Node3</span>:<span class="w"> </span><span class="nv">X</span><span class="o">=</span><span class="nv">V</span>]<span class="w">              </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">        </span>âœ“<span class="w">          </span><span class="ss">(</span><span class="nv">skip</span><span class="ss">)</span><span class="w">         </span>âœ“<span class="w">                    </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                        </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">R</span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">W</span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">N</span><span class="ss">(</span><span class="mi">3</span><span class="ss">)</span><span class="w">                              </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">   </span>â†’<span class="w"> </span><span class="nv">At</span><span class="w"> </span><span class="nv">least</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">latest</span><span class="w"> </span><span class="nv">write</span><span class="o">!</span><span class="w">             </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                        </span>â”‚<span class="w">    </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">    </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">                 </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                            </span>â”‚
â”‚<span class="w">    </span><span class="nv">Write</span><span class="w"> </span><span class="nv">Set</span><span class="w">    </span>â”‚<span class="w">                 </span>â”‚<span class="w">    </span><span class="nv">Read</span><span class="w"> </span><span class="nv">Set</span><span class="w">                </span>â”‚
â”‚<span class="w">    </span><span class="ss">(</span><span class="nv">W</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span><span class="w">        </span>â”‚<span class="w">   </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚<span class="w">    </span><span class="ss">(</span><span class="nv">R</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span><span class="w">                   </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">    </span>â”‚<span class="w">   </span>â”‚<span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span>â”‚<span class="w">   </span>â”‚<span class="w">    </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">            </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span>â”‚â”€â”€â”€â”€â”¼â”€â”€â”€â”‚<span class="w"> </span><span class="ss">(</span><span class="nv">overlap</span><span class="ss">)</span>â”‚â”€â”€â”€â”¼â”€â”€â”€â”€â”‚<span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span>â”‚<span class="w">            </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">   </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">Node</span><span class="w"> </span><span class="mi">3</span><span class="w">  </span>â”‚<span class="w">            </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">    </span>â”‚<span class="w">   </span><span class="ss">(</span><span class="nv">at</span><span class="w"> </span><span class="nv">least</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w">  </span>â”‚<span class="w">    </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">            </span>â”‚
â”‚<span class="w">                 </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">                            </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="quorum-configuration-characteristics">Quorum Configuration Characteristics<a class="header-link" href="#quorum-configuration-characteristics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Quorum Configuration Strategies               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Based on N = 3 replicas                                        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Config 1: W=1, R=3 (Write priority)                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Write: Only 1 node needs to succeed â†’ Fast write   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Read: Must read all 3 â†’ Slow read                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Use case: Log collection, IoT data                 â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Config 2: W=3, R=1 (Read priority)                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Write: All 3 must succeed â†’ Slow write             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Read: Only 1 needed â†’ Fast read                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Use case: Catalogs, reference data                 â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Config 3: W=2, R=2 (Balanced)                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Write: 2 nodes must succeed                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Read: Read from 2 nodes                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Common balanced configuration                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Tolerates 1 node failure                           â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  Fault tolerance: min(N-W, N-R) node failures tolerated         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="cassandra-consistency-levels">Cassandra Consistency Levels<a class="header-link" href="#cassandra-consistency-levels" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                </span><span class="nt">Cassandra</span><span class="w"> </span><span class="nt">Consistency</span><span class="w"> </span><span class="nt">Levels</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Write</span><span class="w"> </span><span class="nt">Consistency</span><span class="w"> </span><span class="nt">Levels</span><span class="o">:</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">ANY</span><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">node</span><span class="w"> </span><span class="o">(</span><span class="nt">including</span><span class="w"> </span><span class="nt">hints</span><span class="o">)</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nt">Lowest</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                </span><span class="nt">consistency</span><span class="w">                                 </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">ONE</span><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">replica</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">TWO</span><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="nt">2</span><span class="w"> </span><span class="nt">replicas</span><span class="w">                                  </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">THREE</span><span class="w">       </span><span class="o">:</span><span class="w"> </span><span class="nt">3</span><span class="w"> </span><span class="nt">replicas</span><span class="w">                                  </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">QUORUM</span><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="o">(</span><span class="nt">RF</span><span class="o">/</span><span class="nt">2</span><span class="o">)+</span><span class="nt">1</span><span class="w"> </span><span class="nt">replicas</span><span class="w">                           </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">LOCAL_QUORUM</span><span class="o">:</span><span class="w"> </span><span class="o">(</span><span class="nt">RF</span><span class="o">/</span><span class="nt">2</span><span class="o">)+</span><span class="nt">1</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">local</span><span class="w"> </span><span class="nt">DC</span><span class="w">                        </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">EACH_QUORUM</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">(</span><span class="nt">RF</span><span class="o">/</span><span class="nt">2</span><span class="o">)+</span><span class="nt">1</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">each</span><span class="w"> </span><span class="nt">DC</span><span class="w">                         </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">ALL</span><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="nt">All</span><span class="w"> </span><span class="nt">replicas</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nt">Highest</span><span class="w"> </span><span class="nt">consistency</span><span class="w">          </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Example</span><span class="o">:</span><span class="w"> </span><span class="nt">RF</span><span class="o">=</span><span class="nt">3</span><span class="w"> </span><span class="nt">cluster</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">QUORUM</span><span class="w"> </span><span class="nt">calculation</span><span class="o">:</span><span class="w"> </span><span class="o">(</span><span class="nt">3</span><span class="o">/</span><span class="nt">2</span><span class="o">)+</span><span class="nt">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">2</span><span class="w">                           </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Write</span><span class="w"> </span><span class="nt">CL</span><span class="o">=</span><span class="nt">QUORUM</span><span class="o">:</span><span class="w">   </span><span class="nt">2</span><span class="w"> </span><span class="nt">node</span><span class="w"> </span><span class="nt">ACKs</span><span class="w"> </span><span class="nt">required</span><span class="w">                   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Read</span><span class="w"> </span><span class="nt">CL</span><span class="o">=</span><span class="nt">QUORUM</span><span class="o">:</span><span class="w">    </span><span class="nt">Read</span><span class="w"> </span><span class="nt">from</span><span class="w"> </span><span class="nt">2</span><span class="w"> </span><span class="nt">nodes</span><span class="w">                      </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">R</span><span class="o">(</span><span class="nt">2</span><span class="o">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">W</span><span class="o">(</span><span class="nt">2</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">4</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nt">N</span><span class="o">(</span><span class="nt">3</span><span class="o">)</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nt">Strong</span><span class="w"> </span><span class="nt">consistency</span><span class="o">!</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Code</span><span class="w"> </span><span class="nt">Example</span><span class="o">:</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">CQL</span><span class="w">                                                    </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">CONSISTENCY</span><span class="w"> </span><span class="nt">QUORUM</span><span class="o">;</span><span class="w">                                       </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">INSERT</span><span class="w"> </span><span class="nt">INTO</span><span class="w"> </span><span class="nt">users</span><span class="w"> </span><span class="o">(</span><span class="nt">id</span><span class="o">,</span><span class="w"> </span><span class="nt">name</span><span class="o">)</span><span class="w"> </span><span class="nt">VALUES</span><span class="w"> </span><span class="o">(</span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;Kim&#39;</span><span class="o">);</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                            </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Or</span><span class="w"> </span><span class="nt">per-query</span><span class="w"> </span><span class="nt">configuration</span><span class="w">                             </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nt">FROM</span><span class="w"> </span><span class="nt">users</span><span class="w"> </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="w">                          </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">USING</span><span class="w"> </span><span class="nt">CONSISTENCY</span><span class="w"> </span><span class="nt">LOCAL_QUORUM</span><span class="o">;</span><span class="w">                           </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="consistency-vs-availability-trade-off">Consistency vs Availability Trade-off<a class="header-link" href="#consistency-vs-availability-trade-off" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Consistency vs Availability Trade-off               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                  Consistency                                    â”‚
â”‚                        â–²                                        â”‚
â”‚                        â”‚                                        â”‚
â”‚        ALL â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚                       â”‚                                        â”‚
â”‚     QUORUM â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     Balance point                       â”‚
â”‚                      â”‚     (Recommended)                       â”‚
â”‚        TWO â—â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                          â”‚
â”‚                     â”‚                                          â”‚
â”‚        ONE â—â”€â”€â”€â”€â”€â”€â”€â”¤                                           â”‚
â”‚                    â”‚                                           â”‚
â”‚        ANY â—â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;          â”‚
â”‚                              Availability                      â”‚
â”‚                                                                 â”‚
â”‚  Recommended settings by scenario:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Financial transactions: W=ALL, R=ALL  (Consistency first) â”‚ â”‚
â”‚  â”‚  Social feeds:          W=ONE, R=ONE   (Availability first)â”‚ â”‚
â”‚  â”‚  E-commerce:            W=QUORUM, R=QUORUM (Balanced)      â”‚ â”‚
â”‚  â”‚  Analytics data:        W=ONE, R=ONE   (Eventual           â”‚ â”‚
â”‚  â”‚                                         consistency OK)    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="9-practice-problems">9. Practice Problems<a class="header-link" href="#9-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="practice-1-choosing-replication-strategy">Practice 1: Choosing Replication Strategy<a class="header-link" href="#practice-1-choosing-replication-strategy" title="Permanent link">&para;</a></h3>
<p>Choose the appropriate replication strategy for the following scenarios and explain your reasoning.</p>
<div class="highlight"><pre><span></span><code><span class="n">Scenarios</span><span class="o">:</span>
<span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="n">Social</span><span class="w"> </span><span class="n">media</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">users</span>
<span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="n">Bank</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">processing</span><span class="w"> </span><span class="n">financial</span><span class="w"> </span><span class="n">transactions</span>
<span class="mi">3</span><span class="o">.</span><span class="w"> </span><span class="n">Real</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">chat</span><span class="w"> </span><span class="n">application</span>
<span class="mi">4</span><span class="o">.</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="n">system</span>

<span class="n">Options</span><span class="o">:</span>
<span class="n">A</span><span class="o">.</span><span class="w"> </span><span class="n">Single</span><span class="o">-</span><span class="n">leader</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Synchronous</span><span class="w"> </span><span class="n">replication</span>
<span class="n">B</span><span class="o">.</span><span class="w"> </span><span class="n">Single</span><span class="o">-</span><span class="n">leader</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Asynchronous</span><span class="w"> </span><span class="n">replication</span>
<span class="n">C</span><span class="o">.</span><span class="w"> </span><span class="n">Multi</span><span class="o">-</span><span class="n">leader</span><span class="w"> </span><span class="n">replication</span>
<span class="n">D</span><span class="o">.</span><span class="w"> </span><span class="n">Leaderless</span><span class="w"> </span><span class="n">replication</span>
</code></pre></div>

<p><strong>Sample Answer:</strong></p>
<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Social</span><span class="w"> </span><span class="n">Media</span><span class="p">:</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">(</span><span class="n">Multi</span><span class="o">-</span><span class="n">leader</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Geographically</span><span class="w"> </span><span class="n">distributed</span><span class="w"> </span><span class="n">users</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Low</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">region</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Slight</span><span class="w"> </span><span class="n">consistency</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="n">acceptable</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Bank</span><span class="w"> </span><span class="kr">Sys</span><span class="n">tem</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">(</span><span class="nb">Sin</span><span class="n">gle</span><span class="o">-</span><span class="n">leader</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Sync</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Strong</span><span class="w"> </span><span class="n">consistency</span><span class="w"> </span><span class="n">required</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="kd">Data</span><span class="w"> </span><span class="n">loss</span><span class="w"> </span><span class="n">unacceptable</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Write</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="kr">to</span><span class="n">lerable</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">Real</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">Chat</span><span class="p">:</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">(</span><span class="nb">Sin</span><span class="n">gle</span><span class="o">-</span><span class="n">leader</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Async</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Fast</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="n">needed</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="ow">or</span><span class="n">der</span><span class="w"> </span><span class="n">important</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Slight</span><span class="w"> </span><span class="kd">data</span><span class="w"> </span><span class="n">loss</span><span class="w"> </span><span class="n">acceptable</span>

<span class="mf">4.</span><span class="w"> </span><span class="nb">Log</span><span class="w"> </span><span class="n">Collection</span><span class="p">:</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="p">(</span><span class="n">Leaderless</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">High</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">throughput</span><span class="w"> </span><span class="n">needed</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Eventual</span><span class="w"> </span><span class="n">consistency</span><span class="w"> </span><span class="n">sufficient</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">High</span><span class="w"> </span><span class="n">availability</span><span class="w"> </span><span class="n">important</span>
</code></pre></div>

<h3 id="practice-2-quorum-calculation">Practice 2: Quorum Calculation<a class="header-link" href="#practice-2-quorum-calculation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Problem</span><span class="o">:</span>
<span class="n">In</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">cluster</span><span class="o">:</span>

<span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="n">W</span><span class="o">,</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">strong</span><span class="w"> </span><span class="n">consistency</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">availability</span><span class="o">?</span>
<span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="n">With</span><span class="w"> </span><span class="n">W</span><span class="o">=</span><span class="mi">3</span><span class="o">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mi">2</span><span class="o">,</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="n">tolerated</span><span class="o">?</span>
<span class="mi">3</span><span class="o">.</span><span class="w"> </span><span class="n">How</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">maximize</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">availability</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">maintaining</span><span class="w"> </span><span class="n">strong</span><span class="w"> </span><span class="n">consistency</span><span class="o">?</span>
</code></pre></div>

<p><strong>Sample Answer:</strong></p>
<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">W</span><span class="o">=</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">3</span><span class="w"> </span><span class="p">(</span><span class="ow">or</span><span class="w"> </span><span class="n">W</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="mf">.</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">W</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="p">(</span><span class="mf">3</span><span class="o">+</span><span class="mf">3</span><span class="o">=</span><span class="mf">6</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="err">âœ“</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Write</span><span class="p">:</span><span class="w"> </span><span class="kr">To</span><span class="n">lerates</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">failures</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="kr">Read</span><span class="p">:</span><span class="w"> </span><span class="kr">To</span><span class="n">lerates</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">failures</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">W</span><span class="o">=</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">2</span><span class="w"> </span><span class="n">analysis</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="p">(</span><span class="ow">Not</span><span class="w"> </span><span class="n">strong</span><span class="w"> </span><span class="n">consistency</span><span class="err">!</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Strictly</span><span class="w"> </span><span class="n">speaking</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">W</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="n">strong</span><span class="w"> </span><span class="n">consistency</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Write</span><span class="w"> </span><span class="n">availability</span><span class="p">:</span><span class="w"> </span><span class="mf">5</span><span class="o">-</span><span class="mf">3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="kr">to</span><span class="n">lerated</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="kr">Read</span><span class="w"> </span><span class="n">availability</span><span class="p">:</span><span class="w"> </span><span class="mf">5</span><span class="o">-</span><span class="mf">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="kr">to</span><span class="n">lerated</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">Maximize</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">availability</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">W</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">=</span><span class="mf">5</span><span class="w"> </span><span class="p">(</span><span class="n">Write</span><span class="p">:</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="kr">to</span><span class="n">lerated</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">However</span><span class="p">,</span><span class="w"> </span><span class="kr">read</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="n">availability</span><span class="p">)</span>
</code></pre></div>

<h3 id="practice-3-failover-scenario">Practice 3: Failover Scenario<a class="header-link" href="#practice-3-failover-scenario" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Problem</span><span class="o">:</span>
<span class="n">In</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">master</span><span class="o">-</span><span class="n">slave</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">asynchronous</span><span class="w"> </span><span class="n">replication</span><span class="o">,</span>
<span class="n">when</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">fails</span><span class="o">:</span>

<span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="n">Slave</span><span class="w"> </span><span class="n">A</span><span class="o">:</span><span class="w"> </span><span class="n">binlog</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="mi">1000</span>
<span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="n">Slave</span><span class="w"> </span><span class="n">B</span><span class="o">:</span><span class="w"> </span><span class="n">binlog</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="mi">950</span>
<span class="mi">3</span><span class="o">.</span><span class="w"> </span><span class="n">Master</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">binlog</span><span class="w"> </span><span class="n">position</span><span class="o">:</span><span class="w"> </span><span class="mi">1020</span>

<span class="n">Answer</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="o">:</span>
<span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="n">Which</span><span class="w"> </span><span class="n">slave</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">promoted</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">master</span><span class="o">?</span>
<span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">lost</span><span class="o">?</span>
<span class="mi">3</span><span class="o">.</span><span class="w"> </span><span class="n">How</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">handled</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">recovered</span><span class="o">?</span>
</code></pre></div>

<p><strong>Sample Answer:</strong></p>
<div class="highlight"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">Promote</span><span class="w"> </span><span class="n">Slave</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="kr">new</span><span class="w"> </span><span class="n">master</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nb">Pos</span><span class="n">ition</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">950</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Has</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">up</span><span class="o">-</span><span class="kr">to</span><span class="o">-</span><span class="n">date</span><span class="w"> </span><span class="kd">data</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="n">lost</span><span class="w"> </span><span class="n">transactions</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mf">1020</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">lost</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">recovers</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Reconfigure</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">slave</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Discard</span><span class="w"> </span><span class="nb">pos</span><span class="n">ition</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="err">~</span><span class="w"> </span><span class="mf">1020</span><span class="w"> </span><span class="kd">data</span><span class="w"> </span><span class="p">(</span><span class="n">conflict</span><span class="w"> </span><span class="n">prevention</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Start</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="kr">new</span><span class="w"> </span><span class="n">master</span>
</code></pre></div>

<h3 id="practice-4-conflict-resolution-design">Practice 4: Conflict Resolution Design<a class="header-link" href="#practice-4-conflict-resolution-design" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Problem</span><span class="o">:</span>
<span class="n">In</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">multi</span><span class="o">-</span><span class="n">leader</span><span class="w"> </span><span class="n">e</span><span class="o">-</span><span class="n">commerce</span><span class="w"> </span><span class="n">system</span><span class="o">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">updating</span>
<span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">product</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">simultaneously</span><span class="o">:</span>

<span class="n">Leader</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">(</span><span class="n">Seoul</span><span class="o">):</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">95</span>
<span class="n">Leader</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">(</span><span class="n">Tokyo</span><span class="o">):</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">97</span>

<span class="n">How</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">conflict</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">resolved</span><span class="o">?</span>
<span class="n">Propose</span><span class="w"> </span><span class="n">several</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">explain</span><span class="w"> </span><span class="n">pros</span><span class="o">/</span><span class="n">cons</span><span class="o">.</span>
</code></pre></div>

<p><strong>Sample Answer:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">Method</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">LWW</span><span class="w"> </span><span class="p">(</span><span class="n">Last</span><span class="w"> </span><span class="n">Write</span><span class="w"> </span><span class="n">Wins</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Apply</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">timestamp</span>
<span class="o">-</span><span class="w"> </span><span class="n">Pros</span><span class="p">:</span><span class="w"> </span><span class="n">Simple</span><span class="w"> </span><span class="n">implementation</span>
<span class="o">-</span><span class="w"> </span><span class="n">Cons</span><span class="p">:</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">loss</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">sales</span><span class="w"> </span><span class="n">missing</span><span class="p">)</span>

<span class="n">Method</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">CRDT</span><span class="w"> </span><span class="p">(</span><span class="n">Counter</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Record</span><span class="w"> </span><span class="n">sales</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">leader</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="o">-</span><span class="w"> </span><span class="n">Final</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">92</span>
<span class="o">-</span><span class="w"> </span><span class="n">Pros</span><span class="p">:</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">loss</span>
<span class="o">-</span><span class="w"> </span><span class="n">Cons</span><span class="p">:</span><span class="w"> </span><span class="n">Inventory</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">go</span><span class="w"> </span><span class="n">negative</span>

<span class="n">Method</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">Distributed</span><span class="w"> </span><span class="n">Lock</span><span class="w"> </span><span class="p">(</span><span class="n">Not</span><span class="w"> </span><span class="n">recommended</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Acquire</span><span class="w"> </span><span class="n">distributed</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">write</span>
<span class="o">-</span><span class="w"> </span><span class="n">Cons</span><span class="p">:</span><span class="w"> </span><span class="n">Increased</span><span class="w"> </span><span class="n">latency</span><span class="p">,</span><span class="w"> </span><span class="n">complexity</span>

<span class="n">Method</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="n">Route</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Single</span><span class="w"> </span><span class="n">Leader</span>
<span class="o">-</span><span class="w"> </span><span class="n">Inventory</span><span class="w"> </span><span class="n">writes</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">leader</span>
<span class="o">-</span><span class="w"> </span><span class="n">Pros</span><span class="p">:</span><span class="w"> </span><span class="n">Prevents</span><span class="w"> </span><span class="n">conflicts</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">source</span>
<span class="o">-</span><span class="w"> </span><span class="n">Cons</span><span class="p">:</span><span class="w"> </span><span class="n">Potential</span><span class="w"> </span><span class="n">overload</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">leader</span>

<span class="n">Recommended</span><span class="p">:</span><span class="w"> </span><span class="n">CRDT</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Inventory</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="n">alerts</span>
<span class="o">-</span><span class="w"> </span><span class="n">Alert</span><span class="o">/</span><span class="n">adjust</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">negative</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">occurs</span>
</code></pre></div>

<h3 id="practice-5-interview-question">Practice 5: Interview Question<a class="header-link" href="#practice-5-interview-question" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Interviewer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;How would you implement Read-Your-Writes consistency?&quot;</span>

<span class="nx">Requirements</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="nx">must</span><span class="w"> </span><span class="nx">always</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">able</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">read</span><span class="w"> </span><span class="nx">their</span><span class="w"> </span><span class="nx">own</span><span class="w"> </span><span class="nx">writes</span>
<span class="o">-</span><span class="w"> </span><span class="nx">Asynchronous</span><span class="w"> </span><span class="nx">replication</span><span class="w"> </span><span class="nx">environment</span>
<span class="o">-</span><span class="w"> </span><span class="nx">Multiple</span><span class="w"> </span><span class="nx">replicas</span><span class="w"> </span><span class="nx">present</span>

<span class="nx">Propose</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">design</span><span class="w"> </span><span class="nx">approach</span><span class="p">.</span>
</code></pre></div>

<p><strong>Sample Answer:</strong></p>
<div class="highlight"><pre><span></span><code>Method 1: Read from Leader
<span class="k">-</span> User reads recently written data from Leader
<span class="k">-</span> Implementation: Use Leader for certain time (e.g., 1 min) after write

Method 2: Timestamp-based
<span class="k">-</span> Client remembers last write timestamp
<span class="k">-</span> Include timestamp in read request
<span class="k">-</span> Wait until replica is caught up to that timestamp

Method 3: Replication Position-based
<span class="k">-</span> Return LSN (Log Sequence Number) after write
<span class="k">-</span> Read from replica that has applied at least that LSN

Implementation Example (Method 2):
```python
class Client:
    def __init__(self):
        self.last_write_timestamp = 0

    def write(self, data):
        result = leader.write(data)
        self.last_write_timestamp = result.timestamp

    def read(self, key):
        return db.read(
            key,
            min_timestamp=self.last_write_timestamp
        )
</code></pre></div>

<hr />
<h2 id="10-next-steps">10. Next Steps<a class="header-link" href="#10-next-steps" title="Permanent link">&para;</a></h2>
<p>Based on what you learned in this document, study the following topics:</p>
<ol>
<li><strong>Distributed Transactions</strong> - 2PC, Saga Pattern</li>
<li><strong>Consensus Algorithms</strong> - Paxos, Raft, ZAB</li>
<li><strong>CDC (Change Data Capture)</strong> - Debezium</li>
<li><strong>Event Sourcing and CQRS</strong> - Alternative approaches to replication</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">Learning</span><span class="w"> </span><span class="k">Path</span><span class="err">:</span>
<span class="o">[</span><span class="n">Current</span><span class="o">]</span><span class="w"> </span><span class="k">Database</span><span class="w"> </span><span class="k">Replication</span>
<span class="w">    </span><span class="err">â”‚</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="k">Distributed</span><span class="w"> </span><span class="n">Transactions</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="n">PC</span><span class="p">,</span><span class="w"> </span><span class="n">Saga</span><span class="p">)</span>
<span class="w">    </span><span class="err">â”‚</span>
<span class="w">    </span><span class="err">â”œâ”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Consensus</span><span class="w"> </span><span class="n">Algorithms</span><span class="w"> </span><span class="p">(</span><span class="n">Raft</span><span class="p">,</span><span class="w"> </span><span class="n">Paxos</span><span class="p">)</span>
<span class="w">    </span><span class="err">â”‚</span>
<span class="w">    </span><span class="err">â””â”€â”€</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CDC</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Event</span><span class="w"> </span><span class="n">Sourcing</span>
</code></pre></div>

<hr />
<h2 id="11-references">11. References<a class="header-link" href="#11-references" title="Permanent link">&para;</a></h2>
<h3 id="essential-books">Essential Books<a class="header-link" href="#essential-books" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Designing Data-Intensive Applications</strong> - Martin Kleppmann</li>
<li>Chapter 5: Replication</li>
<li>
<p>Chapter 9: Consistency and Consensus</p>
</li>
<li>
<p><strong>Database Internals</strong> - Alex Petrov</p>
</li>
<li>Part II: Distributed Systems</li>
</ol>
<h3 id="database-specific-documentation">Database-Specific Documentation<a class="header-link" href="#database-specific-documentation" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>PostgreSQL Streaming Replication</strong></li>
<li>
<p>https://www.postgresql.org/docs/current/warm-standby.html</p>
</li>
<li>
<p><strong>MySQL Replication</strong></p>
</li>
<li>
<p>https://dev.mysql.com/doc/refman/8.0/en/replication.html</p>
</li>
<li>
<p><strong>Cassandra Documentation</strong></p>
</li>
<li>https://cassandra.apache.org/doc/latest/cassandra/architecture/dynamo.html</li>
</ol>
<h3 id="papers">Papers<a class="header-link" href="#papers" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Dynamo: Amazon's Highly Available Key-value Store</strong> (2007)</li>
<li><strong>In Search of an Understandable Consensus Algorithm (Raft)</strong> (2014)</li>
<li><strong>Chain Replication for Supporting High Throughput and Availability</strong> (2004)</li>
</ol>
<hr />
<h2 id="summary">Summary<a class="header-link" href="#summary" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="nx">Key</span><span class="w"> </span><span class="nx">Concepts</span><span class="w"> </span><span class="nx">Summary</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Replication</span><span class="w"> </span><span class="nx">Types</span><span class="p">:</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Single</span><span class="o">-</span><span class="nx">leader</span><span class="p">:</span><span class="w"> </span><span class="nx">Write</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">leader</span><span class="p">,</span><span class="w"> </span><span class="nx">read</span><span class="w"> </span><span class="nx">from</span><span class="w">         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                 </span><span class="nx">followers</span><span class="w"> </span><span class="nx">too</span><span class="w">                            </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Multi</span><span class="o">-</span><span class="nx">leader</span><span class="p">:</span><span class="w"> </span><span class="nx">Write</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">multiple</span><span class="w"> </span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">conflict</span><span class="w">         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                </span><span class="nx">resolution</span><span class="w"> </span><span class="nx">needed</span><span class="w">                         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Leaderless</span><span class="p">:</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">nodes</span><span class="w"> </span><span class="nx">equal</span><span class="p">,</span><span class="w"> </span><span class="nx">quorum</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">consistency</span><span class="w">     </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Sync</span><span class="o">/</span><span class="nx">Async</span><span class="p">:</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Sync</span><span class="p">:</span><span class="w"> </span><span class="nx">Strong</span><span class="w"> </span><span class="nx">consistency</span><span class="p">,</span><span class="w"> </span><span class="nx">slow</span><span class="w"> </span><span class="nx">writes</span><span class="p">,</span><span class="w"> </span><span class="nx">can</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">write</span><span class="w"> </span><span class="nx">on</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">        </span><span class="nx">failure</span><span class="w">                                           </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Async</span><span class="p">:</span><span class="w"> </span><span class="nx">Fast</span><span class="w"> </span><span class="nx">writes</span><span class="p">,</span><span class="w"> </span><span class="nx">possible</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">loss</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Semi</span><span class="o">-</span><span class="nx">sync</span><span class="p">:</span><span class="w"> </span><span class="nx">At</span><span class="w"> </span><span class="nx">least</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nx">sync</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rest</span><span class="w"> </span><span class="nx">async</span><span class="w"> </span><span class="p">(</span><span class="nx">balanced</span><span class="p">)</span><span class="w">      </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Quorum</span><span class="p">:</span><span class="w">                                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">W</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">N</span><span class="w"> </span><span class="nx">guarantees</span><span class="w"> </span><span class="nx">strong</span><span class="w"> </span><span class="nx">consistency</span><span class="w">                 </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Fault</span><span class="w"> </span><span class="nx">tolerance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">min</span><span class="p">(</span><span class="nx">N</span><span class="o">-</span><span class="nx">W</span><span class="p">,</span><span class="w"> </span><span class="nx">N</span><span class="o">-</span><span class="nx">R</span><span class="p">)</span><span class="w">                         </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Interview</span><span class="w"> </span><span class="nx">Key</span><span class="w"> </span><span class="nx">Points</span><span class="p">:</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Trade</span><span class="o">-</span><span class="nx">offs</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">replication</span><span class="w"> </span><span class="k">type</span><span class="w">                       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Failover</span><span class="w"> </span><span class="nx">process</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">problems</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Quorum</span><span class="w"> </span><span class="nx">calculation</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">consistency</span><span class="w"> </span><span class="nx">levels</span><span class="w">            </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Split</span><span class="w"> </span><span class="nx">Brain</span><span class="w"> </span><span class="nx">prevention</span><span class="w"> </span><span class="nx">strategies</span><span class="w">                    </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Read</span><span class="o">-</span><span class="nx">Your</span><span class="o">-</span><span class="nx">Writes</span><span class="w"> </span><span class="nx">implementation</span><span class="w"> </span><span class="nx">methods</span><span class="w">              </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/08_Database_Scaling.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Database Scaling</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/System_Design/10_Data_Consistency_Patterns.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Data Consistency Patterns</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}