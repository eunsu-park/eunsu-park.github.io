{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Consistency Patterns - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">Data Consistency Patterns</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Data Consistency Patterns</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/09_Database_Replication.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Database Replication</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/System_Design/11_Message_Queue_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Message Queue Fundamentals</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-consistency-models-overview">1. Consistency Models Overview</a><ul>
<li><a href="#cap-theorem-review">CAP Theorem Review</a></li>
<li><a href="#consistency-spectrum">Consistency Spectrum</a></li>
</ul>
</li>
<li><a href="#2-strong-vs-eventual-consistency">2. Strong vs Eventual Consistency</a><ul>
<li><a href="#strong-consistency">Strong Consistency</a></li>
<li><a href="#eventual-consistency">Eventual Consistency</a></li>
<li><a href="#trade-off-comparison">Trade-off Comparison</a></li>
<li><a href="#selection-by-use-case">Selection by Use Case</a></li>
</ul>
</li>
<li><a href="#3-read-consistency-patterns">3. Read Consistency Patterns</a><ul>
<li><a href="#read-your-writes">Read-Your-Writes</a></li>
<li><a href="#monotonic-reads">Monotonic Reads</a></li>
<li><a href="#monotonic-writes">Monotonic Writes</a></li>
</ul>
</li>
<li><a href="#4-distributed-transactions-and-2pc">4. Distributed Transactions and 2PC</a><ul>
<li><a href="#two-phase-commit-2pc">Two-Phase Commit (2PC)</a></li>
<li><a href="#2pc-failure-scenarios">2PC Failure Scenarios</a></li>
<li><a href="#limitations-of-2pc">Limitations of 2PC</a></li>
<li><a href="#3pc-three-phase-commit">3PC (Three-Phase Commit)</a></li>
</ul>
</li>
<li><a href="#5-saga-pattern">5. Saga Pattern</a><ul>
<li><a href="#saga-basic-concept">Saga Basic Concept</a></li>
<li><a href="#choreography">Choreography</a></li>
<li><a href="#choreography-pros-and-cons">Choreography Pros and Cons</a></li>
<li><a href="#orchestration">Orchestration</a></li>
<li><a href="#orchestration-pros-and-cons">Orchestration Pros and Cons</a></li>
<li><a href="#saga-pattern-comparison">Saga Pattern Comparison</a></li>
<li><a href="#saga-implementation-example-orchestration">Saga Implementation Example (Orchestration)</a></li>
</ul>
</li>
<li><a href="#6-practical-application-guide">6. Practical Application Guide</a><ul>
<li><a href="#consistency-pattern-selection-checklist">Consistency Pattern Selection Checklist</a></li>
<li><a href="#hybrid-approach">Hybrid Approach</a></li>
</ul>
</li>
<li><a href="#7-practice-problems">7. Practice Problems</a><ul>
<li><a href="#exercise-1-analyze-consistency-requirements">Exercise 1: Analyze Consistency Requirements</a></li>
<li><a href="#exercise-2-saga-design">Exercise 2: Saga Design</a></li>
<li><a href="#exercise-3-read-consistency-implementation">Exercise 3: Read Consistency Implementation</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="data-consistency-patterns">Data Consistency Patterns<a class="header-link" href="#data-consistency-patterns" title="Permanent link">&para;</a></h1>
<p>Difficulty: â­â­â­â­</p>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Data consistency is one of the most challenging problems in distributed systems. This chapter covers the trade-offs between Strong Consistency and Eventual Consistency, read consistency patterns, limitations of distributed transactions, and the Saga pattern.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-consistency-models-overview">Consistency Models Overview</a></li>
<li><a href="#2-strong-vs-eventual-consistency">Strong vs Eventual Consistency</a></li>
<li><a href="#3-read-consistency-patterns">Read Consistency Patterns</a></li>
<li><a href="#4-distributed-transactions-and-2pc">Distributed Transactions and 2PC</a></li>
<li><a href="#5-saga-pattern">Saga Pattern</a></li>
<li><a href="#6-practical-application-guide">Practical Application Guide</a></li>
<li><a href="#7-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-consistency-models-overview">1. Consistency Models Overview<a class="header-link" href="#1-consistency-models-overview" title="Permanent link">&para;</a></h2>
<h3 id="cap-theorem-review">CAP Theorem Review<a class="header-link" href="#cap-theorem-review" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CAP Theorem                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                    Consistency (C)                          â”‚
â”‚                         /\                                  â”‚
â”‚                        /  \                                 â”‚
â”‚                       /    \                                â”‚
â”‚                      / CP   \                               â”‚
â”‚                     /        \                              â”‚
â”‚                    /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\                             â”‚
â”‚      Availability (A)        Partition Tolerance (P)        â”‚
â”‚                    \    AP    /                             â”‚
â”‚                     \        /                              â”‚
â”‚                      \â”€â”€â”€â”€â”€â”€/                               â”‚
â”‚                                                             â”‚
â”‚   When Network Partition Occurs:                           â”‚
â”‚   - Choose CP: Maintain consistency, sacrifice availability â”‚
â”‚   - Choose AP: Maintain availability, sacrifice consistency â”‚
â”‚                (Eventual)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="consistency-spectrum">Consistency Spectrum<a class="header-link" href="#consistency-spectrum" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Consistency Spectrum                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Strong                                              Eventual           â”‚
â”‚  Consistency          â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    Consistency         â”‚
â”‚                                                                         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚          â”‚          â”‚          â”‚          â”‚          â”‚             â”‚
â”‚  Lineariz-  Sequential Causal    Monotonic   Eventual                  â”‚
â”‚  ability    Consistency          Reads       Consistency               â”‚
â”‚                                                                         â”‚
â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ Strong Consistency â”€â”€â”€â”€â”€â”€â–ºâ—„â”€â”€â”€â”€ Weak Consistency â”€â”€â”€â”€â–º     â”‚
â”‚  â—„â”€â”€â”€â”€â”€â”€â”€ Low Availability/Performance â”€â”€â–ºâ—„â”€â”€ High Availability/Perf â”€â”€â–ºâ”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-strong-vs-eventual-consistency">2. Strong vs Eventual Consistency<a class="header-link" href="#2-strong-vs-eventual-consistency" title="Permanent link">&para;</a></h2>
<h3 id="strong-consistency">Strong Consistency<a class="header-link" href="#strong-consistency" title="Permanent link">&para;</a></h3>
<p>All reads return the result of the most recent write.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Strong Consistency                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Time â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º           â”‚
â”‚                                                                         â”‚
â”‚  Client A:  â”€â”€â”€â”€ Write(X=5) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º              â”‚
â”‚                      â”‚                                                  â”‚
â”‚                      â–¼                                                  â”‚
â”‚  Primary:   â•â•â•â•â•â•â•â•[X=5]â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º              â”‚
â”‚                      â”‚                                                  â”‚
â”‚                      â”‚ Synchronous replication                          â”‚
â”‚                      â”‚ (replication completes before write completes)   â”‚
â”‚                      â–¼                                                  â”‚
â”‚  Replica:   â•â•â•â•â•â•â•â•[X=5]â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º              â”‚
â”‚                      â”‚                                                  â”‚
â”‚                      â–¼                                                  â”‚
â”‚  Client B:  â”€â”€â”€â”€â”€â”€â”€â”€ Read() â”€â”€â”€â”€â”€â”€â”€ returns X=5 â”€â”€â”€â”€â”€â”€â”€â”€â–º               â”‚
â”‚                                                                         â”‚
â”‚  Characteristics:                                                       â”‚
â”‚  - All nodes see the same data                                          â”‚
â”‚  - Increased write latency                                              â”‚
â”‚  - Decreased availability (when replica fails)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="eventual-consistency">Eventual Consistency<a class="header-link" href="#eventual-consistency" title="Permanent link">&para;</a></h3>
<p>Given sufficient time, all reads will return the same value.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Eventual Consistency                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Time â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º           â”‚
â”‚                                                                         â”‚
â”‚  Client A:  â”€â”€â”€â”€ Write(X=5) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º              â”‚
â”‚                      â”‚                                                  â”‚
â”‚                      â–¼                                                  â”‚
â”‚  Primary:   â•â•â•â•â•â•â•â•[X=5]â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º              â”‚
â”‚                      â”‚                                                  â”‚
â”‚                      â”‚ Asynchronous replication                         â”‚
â”‚                      â”‚ (write completes immediately, replication later) â”‚
â”‚                      â–¼                                                  â”‚
â”‚  Replica:   â•â•â•[X=0]â•â•â•â•â•â•â•â•[X=5]â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º              â”‚
â”‚                 â”‚              â”‚                                        â”‚
â”‚                 â”‚   replication lag â”‚                                   â”‚
â”‚                 â–¼              â–¼                                        â”‚
â”‚  Client B:  â”€â”€â”€ Read()=0 â”€â”€â”€â”€ Read()=5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º               â”‚
â”‚                 (stale)       (current)                                 â”‚
â”‚                                                                         â”‚
â”‚  Characteristics:                                                       â”‚
â”‚  - Temporary inconsistency allowed                                      â”‚
â”‚  - Reduced write latency                                                â”‚
â”‚  - High availability                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="trade-off-comparison">Trade-off Comparison<a class="header-link" href="#trade-off-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>Strong Consistency</th>
<th>Eventual Consistency</th>
</tr>
</thead>
<tbody>
<tr>
<td>Read consistency</td>
<td>Always latest</td>
<td>Temporary lag</td>
</tr>
<tr>
<td>Write latency</td>
<td>High</td>
<td>Low</td>
</tr>
<tr>
<td>Availability</td>
<td>Low</td>
<td>High</td>
</tr>
<tr>
<td>Implementation complexity</td>
<td>High</td>
<td>Low</td>
</tr>
<tr>
<td>Suitable use cases</td>
<td>Finance, inventory</td>
<td>SNS, like counts</td>
</tr>
</tbody>
</table>
<h3 id="selection-by-use-case">Selection by Use Case<a class="header-link" href="#selection-by-use-case" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Consistency Selection by Use Case                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Strong Consistency Required  â”‚  Eventual Consistency Suitable          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - Bank account balance       â”‚  - SNS timeline                         â”‚
â”‚  - Inventory quantity (preventâ”‚  - Like/follower counts                 â”‚
â”‚    overselling)               â”‚  - Search index                          â”‚
â”‚  - Reservation systems        â”‚  - Log collection                        â”‚
â”‚  - Payment processing         â”‚  - View counters                         â”‚
â”‚  - User authentication state  â”‚  - Recommendation systems                â”‚
â”‚  - Distributed locks          â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="3-read-consistency-patterns">3. Read Consistency Patterns<a class="header-link" href="#3-read-consistency-patterns" title="Permanent link">&para;</a></h2>
<h3 id="read-your-writes">Read-Your-Writes<a class="header-link" href="#read-your-writes" title="Permanent link">&para;</a></h3>
<p>Guarantees that users can always read the data they wrote.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Read-Your-Writes                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Problem Scenario:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  User A  â”‚         â”‚  Primary â”‚         â”‚ Replica  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚
â”‚       â”‚                    â”‚                    â”‚                       â”‚
â”‚       â”‚â”€â”€Write(name=Bob)â”€â”€â–ºâ”‚                    â”‚                       â”‚
â”‚       â”‚â—„â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                       â”‚
â”‚       â”‚                    â”‚â”€â”€ async replicateâ”€â–ºâ”‚                       â”‚
â”‚       â”‚â”€â”€Read(name)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (not replicated yet)  â”‚
â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ name=Alice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
â”‚       â”‚                                         â”‚                       â”‚
â”‚  &quot;I just changed it to Bob, why is it Alice?&quot;                           â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Solution 1: Read from Primary                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚  User A  â”‚         â”‚  Primary â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚       â”‚                    â”‚                                            â”‚
â”‚       â”‚â”€â”€Write(name=Bob)â”€â”€â–ºâ”‚                                            â”‚
â”‚       â”‚â—„â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                            â”‚
â”‚       â”‚â”€â”€Read(name)â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â† After own write, read from Primary      â”‚
â”‚       â”‚â—„â”€â”€â”€ name=Bob â”€â”€â”€â”€â”€â”€â”‚                                            â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Solution 2: Timestamp-based                                            â”‚
â”‚                                                                         â”‚
â”‚  - Record timestamp T on write                                          â”‚
â”‚  - On read, only read from replicas with data after T                   â”‚
â”‚  - Use only if replica&#39;s replication_timestamp &gt;= T                     â”‚
â”‚                                                                         â”‚
â”‚  Write Response: { success: true, timestamp: T1 }                       â”‚
â”‚  Read Request:   { key: &quot;name&quot;, min_timestamp: T1 }                     â”‚
â”‚  â†’ Read only from replicas updated after T1                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Read-Your-Writes implementation example</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReadYourWritesClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="p">,</span> <span class="n">replicas</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primary</span> <span class="o">=</span> <span class="n">primary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span> <span class="o">=</span> <span class="n">replicas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_timestamp</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># key -&gt; timestamp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_timestamp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="k">return</span> <span class="n">timestamp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_write_timestamp</span><span class="p">:</span>
            <span class="c1"># Read recently written keys from Primary</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Read unwritten keys from Replica</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_replica</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div>

<h3 id="monotonic-reads">Monotonic Reads<a class="header-link" href="#monotonic-reads" title="Permanent link">&para;</a></h3>
<p>Guarantees that once a value is read, older values will not be read subsequently.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="n">Monotonic</span><span class="w"> </span><span class="k">Reads</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Problem</span><span class="w"> </span><span class="n">Scenario</span><span class="w"> </span><span class="p">(</span><span class="n">Monotonic</span><span class="w"> </span><span class="k">Reads</span><span class="w"> </span><span class="n">Violation</span><span class="p">)</span><span class="err">:</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nc">Time</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Replica</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">v1</span><span class="o">]</span><span class="err">â”€â”€â”€â”€â”€â”€â”€</span><span class="o">[</span><span class="n">v2</span><span class="o">]</span><span class="err">â”€â”€â”€â”€â”€â”€â”€</span><span class="o">[</span><span class="n">v3</span><span class="o">]</span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Replica</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">v1</span><span class="o">]</span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="o">[</span><span class="n">v2</span><span class="o">]</span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">User</span><span class="err">:</span><span class="w">      </span><span class="k">Read</span><span class="nv">@R1</span><span class="o">=</span><span class="n">v2</span><span class="w">  </span><span class="k">Read</span><span class="nv">@R2</span><span class="o">=</span><span class="n">v1</span><span class="w">  </span><span class="k">Read</span><span class="nv">@R1</span><span class="o">=</span><span class="n">v3</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="ss">&quot;Feels like time went backwards&quot;</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Solution</span><span class="p">:</span><span class="w"> </span><span class="n">Sticky</span><span class="w"> </span><span class="k">Session</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="k">User</span><span class="w"> </span><span class="n">A</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><span class="w"> </span><span class="n">Replica</span><span class="w"> </span><span class="mi">1</span><span class="err">â”‚</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="n">fixed</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="k">User</span><span class="w"> </span><span class="n">B</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><span class="w"> </span><span class="n">Replica</span><span class="w"> </span><span class="mi">2</span><span class="err">â”‚</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="n">fixed</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Same</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="k">reads</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">replica</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Switch</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">goes</span><span class="w"> </span><span class="n">down</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Solution</span><span class="p">:</span><span class="w"> </span><span class="n">Version</span><span class="o">-</span><span class="n">based</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">Read</span><span class="w"> </span><span class="nl">Response</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">value</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;v2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="err">}</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">Next</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="nl">Request</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">key</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">min_version</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="err">}</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">replicas</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">42</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="monotonic-writes">Monotonic Writes<a class="header-link" href="#monotonic-writes" title="Permanent link">&para;</a></h3>
<p>Guarantees that writes from the same session are applied in order.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Monotonic Writes                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Problem Scenario:                                                      â”‚
â”‚                                                                         â”‚
â”‚  User: Write(X=1) â†’ Write(X=2) â†’ Write(X=3)                            â”‚
â”‚                                                                         â”‚
â”‚  Due to network latency:                                                â”‚
â”‚  Replica receive order: X=2 â†’ X=3 â†’ X=1                                â”‚
â”‚  Final result: X=1 (not as intended!)                                   â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Solution: Version/Timestamp-based                                      â”‚
â”‚                                                                         â”‚
â”‚  Write(X=1, ts=100) â†’ Write(X=2, ts=101) â†’ Write(X=3, ts=102)          â”‚
â”‚                                                                         â”‚
â”‚  Receive order: ts=101 â†’ ts=102 â†’ ts=100                               â”‚
â”‚  Apply: X=2 applied â†’ X=3 applied â†’ X=1 ignored (ts=100 &lt; current=102) â”‚
â”‚  Final result: X=3 (correct!)                                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="4-distributed-transactions-and-2pc">4. Distributed Transactions and 2PC<a class="header-link" href="#4-distributed-transactions-and-2pc" title="Permanent link">&para;</a></h2>
<h3 id="two-phase-commit-2pc">Two-Phase Commit (2PC)<a class="header-link" href="#two-phase-commit-2pc" title="Permanent link">&para;</a></h3>
<p>A protocol that guarantees atomicity of distributed transactions.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Two-Phase Commit (2PC)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Phase 1: Prepare (Voting phase)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ Coordinator â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚         â”‚                                                               â”‚
â”‚         â”‚â”€â”€â”€ PREPARE â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚         â”‚                â”‚Participant1â”‚â”€â”€â”€â–º Prepare transaction         â”‚
â”‚         â”‚â—„â”€â”€ VOTE YES â”€â”€â”€â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     (acquire lock, write log)  â”‚
â”‚         â”‚                                                               â”‚
â”‚         â”‚â”€â”€â”€ PREPARE â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚         â”‚                â”‚Participant2â”‚â”€â”€â”€â–º Prepare transaction         â”‚
â”‚         â”‚â—„â”€â”€ VOTE YES â”€â”€â”€â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚         â”‚                                                               â”‚
â”‚  Phase 2: Commit (Decision phase)                                       â”‚
â”‚         â”‚                                                               â”‚
â”‚         â”‚â”€â”€â”€ COMMIT â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚         â”‚                â”‚Participant1â”‚â”€â”€â”€â–º Execute commit              â”‚
â”‚         â”‚â—„â”€â”€â”€ ACK â”€â”€â”€â”€â”€â”€â”€â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚         â”‚                                                               â”‚
â”‚         â”‚â”€â”€â”€ COMMIT â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚         â”‚                â”‚Participant2â”‚â”€â”€â”€â–º Execute commit              â”‚
â”‚         â”‚â—„â”€â”€â”€ ACK â”€â”€â”€â”€â”€â”€â”€â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚         â”‚                                                               â”‚
â”‚         â–¼                                                               â”‚
â”‚  Transaction Complete                                                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="2pc-failure-scenarios">2PC Failure Scenarios<a class="header-link" href="#2pc-failure-scenarios" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="mi">2</span><span class="nv">PC</span><span class="w"> </span><span class="nv">Failure</span><span class="w"> </span><span class="nv">Scenarios</span><span class="w">                               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Scenario</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">Participant</span><span class="w"> </span><span class="nv">votes</span><span class="w"> </span><span class="nv">NO</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Coordinator</span><span class="w"> </span>â”‚<span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜<span class="w">                                                       </span>â”‚
â”‚<span class="w">         </span>â”‚â”€â”€â”€<span class="w"> </span><span class="nv">PREPARE</span><span class="w"> </span>â”€â”€â”€â–ºâ”‚<span class="nv">Participant1</span>â”‚â—„â”€â”€<span class="w"> </span><span class="nv">VOTE</span><span class="w"> </span><span class="nv">YES</span><span class="w">                    </span>â”‚
â”‚<span class="w">         </span>â”‚â”€â”€â”€<span class="w"> </span><span class="nv">PREPARE</span><span class="w"> </span>â”€â”€â”€â–ºâ”‚<span class="nv">Participant2</span>â”‚â—„â”€â”€<span class="w"> </span><span class="nv">VOTE</span><span class="w"> </span><span class="nv">NO</span><span class="w"> </span><span class="ss">(</span><span class="nv">failed</span><span class="ss">)</span><span class="w">            </span>â”‚
â”‚<span class="w">         </span>â”‚<span class="w">                                                               </span>â”‚
â”‚<span class="w">         </span>â”‚â”€â”€â”€<span class="w"> </span><span class="nv">ROLLBACK</span><span class="w"> </span>â”€â”€â–ºâ”‚<span class="nv">Participant1</span>â”‚<span class="w">                                </span>â”‚
â”‚<span class="w">         </span>â”‚â”€â”€â”€<span class="w"> </span><span class="nv">ROLLBACK</span><span class="w"> </span>â”€â”€â–ºâ”‚<span class="nv">Participant2</span>â”‚<span class="w">                                </span>â”‚
â”‚<span class="w">         </span>â–¼<span class="w">                                                               </span>â”‚
â”‚<span class="w">  </span><span class="nv">Transaction</span><span class="w"> </span><span class="nv">Aborted</span><span class="w">                                                    </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">  </span><span class="nv">Scenario</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">Coordinator</span><span class="w"> </span><span class="nv">Failure</span><span class="w"> </span><span class="ss">(</span><span class="nv">Blocking</span><span class="w"> </span><span class="nv">problem</span><span class="ss">)</span><span class="w">                     </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Coordinator</span><span class="w"> </span>â”‚â”€â”€<span class="nv">X</span><span class="w"> </span><span class="ss">(</span><span class="nv">failure</span><span class="ss">)</span><span class="w">                                          </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜<span class="w">                                                       </span>â”‚
â”‚<span class="w">         </span>â”‚â”€â”€â”€<span class="w"> </span><span class="nv">PREPARE</span><span class="w"> </span>â”€â”€â”€â–ºâ”‚<span class="nv">Participant1</span>â”‚â—„â”€â”€<span class="w"> </span><span class="nv">VOTE</span><span class="w"> </span><span class="nv">YES</span><span class="w"> </span><span class="ss">(</span><span class="nv">waiting</span>...<span class="ss">)</span><span class="w">       </span>â”‚
â”‚<span class="w">         </span>â”‚â”€â”€â”€<span class="w"> </span><span class="nv">PREPARE</span><span class="w"> </span>â”€â”€â”€â–ºâ”‚<span class="nv">Participant2</span>â”‚â—„â”€â”€<span class="w"> </span><span class="nv">VOTE</span><span class="w"> </span><span class="nv">YES</span><span class="w"> </span><span class="ss">(</span><span class="nv">waiting</span>...<span class="ss">)</span><span class="w">       </span>â”‚
â”‚<span class="w">         </span>â”‚<span class="w">                                                               </span>â”‚
â”‚<span class="w">         </span><span class="nv">X</span><span class="w">  </span><span class="nv">Coordinator</span><span class="w"> </span><span class="nv">down</span><span class="o">!</span><span class="w">                                            </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">         </span>â”‚<span class="nv">Participant1</span>â”‚:<span class="w"> </span><span class="s2">&quot;Commit? Rollback? Cannot decide...&quot;</span><span class="w">           </span>â”‚
â”‚<span class="w">         </span>â”‚<span class="nv">Participant2</span>â”‚:<span class="w"> </span><span class="s2">&quot;Resources remain locked...&quot;</span><span class="w">                   </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w">    </span>â”‚
â”‚<span class="w">  </span><span class="nv">This</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">biggest</span><span class="w"> </span><span class="nv">problem</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="mi">2</span><span class="nv">PC</span>:<span class="w"> </span><span class="nv">BLOCKING</span><span class="w">                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Participants</span><span class="w"> </span><span class="k">wait</span><span class="w"> </span><span class="nv">indefinitely</span><span class="w"> </span><span class="k">until</span><span class="w"> </span><span class="nv">Coordinator</span><span class="w"> </span><span class="nv">recovers</span><span class="w">              </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="limitations-of-2pc">Limitations of 2PC<a class="header-link" href="#limitations-of-2pc" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Limitation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Blocking</td>
<td>Entire system blocks when Coordinator fails</td>
</tr>
<tr>
<td>Performance</td>
<td>2 network round trips, all participants wait</td>
</tr>
<tr>
<td>Availability</td>
<td>Entire transaction rolls back if one participant fails</td>
</tr>
<tr>
<td>Scalability</td>
<td>Performance degrades rapidly as participants increase</td>
</tr>
</tbody>
</table>
<h3 id="3pc-three-phase-commit">3PC (Three-Phase Commit)<a class="header-link" href="#3pc-three-phase-commit" title="Permanent link">&para;</a></h3>
<p>An attempt to mitigate the blocking problem of 2PC:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     3PC vs 2PC                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  2PC:                          3PC:                                     â”‚
â”‚  1. Prepare                    1. CanCommit (voting)                    â”‚
â”‚  2. Commit/Rollback            2. PreCommit (prepare confirmation)      â”‚
â”‚                                3. DoCommit (actual commit)               â”‚
â”‚                                                                         â”‚
â”‚  3PC Advantages:                                                        â”‚
â”‚  - Participants share state in PreCommit phase                          â”‚
â”‚  - Consensus among participants possible even when Coordinator fails    â”‚
â”‚                                                                         â”‚
â”‚  3PC Limitations:                                                       â”‚
â”‚  - Still possible inconsistency during network partition                â”‚
â”‚  - Increased complexity, rarely used in practice                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="5-saga-pattern">5. Saga Pattern<a class="header-link" href="#5-saga-pattern" title="Permanent link">&para;</a></h2>
<p>A distributed transaction pattern to overcome the limitations of 2PC.</p>
<h3 id="saga-basic-concept">Saga Basic Concept<a class="header-link" href="#saga-basic-concept" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="n">Saga</span><span class="w"> </span><span class="n">Pattern</span><span class="w"> </span><span class="n">Overview</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mi">2</span><span class="n">PC</span><span class="o">:</span><span class="w">  </span><span class="n">One</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="k">atomic</span><span class="w"> </span><span class="n">transaction</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">        </span><span class="p">[</span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w"> </span><span class="n">Entire</span><span class="w"> </span><span class="n">Transaction</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="p">]</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">        </span><span class="n">Rollback</span><span class="w"> </span><span class="n">entire</span><span class="w"> </span><span class="n">transaction</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="p">(</span><span class="n">locks</span><span class="w"> </span><span class="n">held</span><span class="p">)</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Saga</span><span class="o">:</span><span class="w"> </span><span class="n">Sequence</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">transactions</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">        </span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">T2</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">T3</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">T4</span><span class="p">]</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">        </span><span class="n">Execute</span><span class="w"> </span><span class="n">compensating</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">failure</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">        </span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">T2</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">T3</span><span class="o">-</span><span class="n">fail</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">C2</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">C1</span><span class="p">]</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                     </span><span class="n">Compensating</span><span class="w"> </span><span class="n">transactions</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Example</span><span class="o">:</span><span class="w"> </span><span class="n">Travel</span><span class="w"> </span><span class="n">Booking</span><span class="w"> </span><span class="n">Saga</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Normal</span><span class="w"> </span><span class="n">flow</span><span class="o">:</span><span class="w">                                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">Flight</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">Hotel</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">Car</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Payment</span><span class="p">]</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="n">T1</span><span class="w">             </span><span class="n">T2</span><span class="w">            </span><span class="n">T3</span><span class="w">          </span><span class="n">T4</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">T3</span><span class="w"> </span><span class="n">fails</span><span class="o">:</span><span class="w">                                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">Flight</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">Hotel</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Car</span><span class="o">-</span><span class="n">fail</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Cancel</span><span class="w"> </span><span class="n">Hotel</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Cancel</span><span class="w"> </span><span class="n">Flight</span><span class="p">]</span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="n">T1</span><span class="w">             </span><span class="n">T2</span><span class="w">            </span><span class="n">T3</span><span class="w">            </span><span class="n">C2</span><span class="w">             </span><span class="n">C1</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="choreography">Choreography<a class="header-link" href="#choreography" title="Permanent link">&para;</a></h3>
<p>Each service autonomously operates by publishing and subscribing to events.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Choreography Saga                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Order  â”‚    â”‚ Payment â”‚    â”‚  Stock  â”‚    â”‚Shipping â”‚             â”‚
â”‚  â”‚ Service â”‚    â”‚ Service â”‚    â”‚ Service â”‚    â”‚ Service â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â”‚
â”‚       â”‚              â”‚              â”‚              â”‚                    â”‚
â”‚  â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•  Event Bus     â”‚
â”‚       â”‚              â”‚              â”‚              â”‚                    â”‚
â”‚  1.OrderCreated      â”‚              â”‚              â”‚                    â”‚
â”‚  â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚              â”‚                    â”‚
â”‚       â”‚         2.PaymentCompleted  â”‚              â”‚                    â”‚
â”‚       â”‚         â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚                    â”‚
â”‚       â”‚              â”‚       3.StockReserved       â”‚                    â”‚
â”‚       â”‚              â”‚       â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
â”‚       â”‚              â”‚              â”‚    4.ShippingScheduled            â”‚
â”‚       â”‚              â”‚              â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â–º               â”‚
â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€ 5.OrderCompleteâ”‚
â”‚       â”‚              â”‚              â”‚              â”‚                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Compensating events on failure:                                        â”‚
â”‚                                                                         â”‚
â”‚  1.OrderCreated â”€â”€â–º 2.PaymentCompleted â”€â”€â–º 3.StockFailed!              â”‚
â”‚                                                 â”‚                       â”‚
â”‚                     PaymentRefunded â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                          â”‚                                              â”‚
â”‚       OrderCancelled â—„â”€â”€â”€â”˜                                              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="choreography-pros-and-cons">Choreography Pros and Cons<a class="header-link" href="#choreography-pros-and-cons" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td>Loose coupling</td>
<td>Difficult to understand overall flow</td>
</tr>
<tr>
<td>No single point of failure</td>
<td>Risk of circular dependencies</td>
</tr>
<tr>
<td>Services scale independently</td>
<td>Complex debugging</td>
</tr>
<tr>
<td>Simple implementation</td>
<td>Difficult testing</td>
</tr>
</tbody>
</table>
<h3 id="orchestration">Orchestration<a class="header-link" href="#orchestration" title="Permanent link">&para;</a></h3>
<p>A central Orchestrator controls the entire flow.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Orchestration Saga                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                      â”‚   Orchestrator  â”‚                               â”‚
â”‚                      â”‚ (Saga Manager)  â”‚                               â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                               â”‚                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚                     â”‚                     â”‚                  â”‚
â”‚         â–¼                     â–¼                     â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Order    â”‚       â”‚  Payment   â”‚       â”‚   Stock    â”‚             â”‚
â”‚  â”‚  Service   â”‚       â”‚  Service   â”‚       â”‚  Service   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Normal flow:                                                           â”‚
â”‚                                                                         â”‚
â”‚  Orchestrator                                                          â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â”‚â”€â”€â”€â”€ 1. CreateOrder â”€â”€â”€â”€â–ºâ”‚Orderâ”‚                                â”‚
â”‚       â”‚â—„â”€â”€â”€ OrderCreated â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚                                â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â”‚â”€â”€â”€â”€ 2. ProcessPayment â”€â–ºâ”‚Paymentâ”‚                              â”‚
â”‚       â”‚â—„â”€â”€â”€ PaymentDone â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚                               â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â”‚â”€â”€â”€â”€ 3. ReserveStock â”€â”€â”€â–ºâ”‚Stockâ”‚                                â”‚
â”‚       â”‚â—„â”€â”€â”€ StockReserved â”€â”€â”€â”€â”€â”€â”‚     â”‚                                â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â”‚â”€â”€â”€â”€ 4. CompleteOrder â”€â”€â–ºâ”‚Orderâ”‚                                â”‚
â”‚       â–¼                                                                 â”‚
â”‚  Saga Complete                                                         â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Compensation on failure:                                               â”‚
â”‚                                                                         â”‚
â”‚  Orchestrator                                                          â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â”‚â”€â”€â”€â”€ 1. CreateOrder â”€â”€â”€â”€â–ºâ”‚Orderâ”‚ âœ“                              â”‚
â”‚       â”‚â”€â”€â”€â”€ 2. ProcessPayment â”€â–ºâ”‚Paymentâ”‚ âœ“                            â”‚
â”‚       â”‚â”€â”€â”€â”€ 3. ReserveStock â”€â”€â”€â–ºâ”‚Stockâ”‚ âœ— (failed!)                    â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â”‚â”€â”€â”€â”€ 4. RefundPayment â”€â”€â–ºâ”‚Paymentâ”‚ (compensation)               â”‚
â”‚       â”‚â”€â”€â”€â”€ 5. CancelOrder â”€â”€â”€â”€â–ºâ”‚Orderâ”‚ (compensation)                 â”‚
â”‚       â–¼                                                                 â”‚
â”‚  Saga Rolled Back                                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="orchestration-pros-and-cons">Orchestration Pros and Cons<a class="header-link" href="#orchestration-pros-and-cons" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td>Centralized flow management</td>
<td>Single point of failure</td>
</tr>
<tr>
<td>Clear workflow</td>
<td>Increased orchestrator complexity</td>
</tr>
<tr>
<td>Easy debugging/monitoring</td>
<td>Increased coupling</td>
</tr>
<tr>
<td>Easy testing</td>
<td>Orchestrator scalability</td>
</tr>
</tbody>
</table>
<h3 id="saga-pattern-comparison">Saga Pattern Comparison<a class="header-link" href="#saga-pattern-comparison" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="nx">Choreography</span><span class="w"> </span><span class="nx">vs</span><span class="w"> </span><span class="nx">Orchestration</span><span class="w"> </span><span class="nx">Selection</span><span class="w"> </span><span class="nx">Criteria</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Choose</span><span class="w"> </span><span class="nx">Choreography</span><span class="p">:</span><span class="w">                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">When</span><span class="w"> </span><span class="nx">few</span><span class="w"> </span><span class="nx">services</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Simple</span><span class="w"> </span><span class="nx">workflows</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">When</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="nx">independence</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">important</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Want</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">avoid</span><span class="w"> </span><span class="nx">strong</span><span class="w"> </span><span class="nx">coupling</span><span class="w"> </span><span class="nx">between</span><span class="w"> </span><span class="nx">teams</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Choose</span><span class="w"> </span><span class="nx">Orchestration</span><span class="p">:</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Complex</span><span class="w"> </span><span class="nx">business</span><span class="w"> </span><span class="nx">logic</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">When</span><span class="w"> </span><span class="nx">many</span><span class="w"> </span><span class="nx">services</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="o">+</span><span class="p">)</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">When</span><span class="w"> </span><span class="nx">clear</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">handling</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">needed</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">When</span><span class="w"> </span><span class="nx">workflow</span><span class="w"> </span><span class="nx">visibility</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">important</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="saga-implementation-example-orchestration">Saga Implementation Example (Orchestration)<a class="header-link" href="#saga-implementation-example-orchestration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">OrderSaga</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Order Saga Orchestrator&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order_id</span> <span class="o">=</span> <span class="n">order_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;STARTED&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compensations</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Compensation transaction stack</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Step 1: Create order</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_order</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compensations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cancel_order</span><span class="p">)</span>

            <span class="c1"># Step 2: Process payment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_payment</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compensations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refund_payment</span><span class="p">)</span>

            <span class="c1"># Step 3: Reserve stock</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reserve_stock</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compensations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release_stock</span><span class="p">)</span>

            <span class="c1"># Step 4: Schedule shipping</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_shipping</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;COMPLETED&quot;</span>

        <span class="k">except</span> <span class="n">SagaException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compensate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;COMPENSATED&quot;</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compensate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute compensating transactions in reverse order&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">compensations</span><span class="p">:</span>
            <span class="n">compensation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compensations</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">compensation</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Log compensation failure, add to retry queue</span>
                <span class="n">log_compensation_failure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order_id</span><span class="p">,</span> <span class="n">compensation</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Call Order Service</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Order Service - cancel order</span>
        <span class="k">pass</span>

    <span class="c1"># ... other methods</span>
</code></pre></div>

<hr />
<h2 id="6-practical-application-guide">6. Practical Application Guide<a class="header-link" href="#6-practical-application-guide" title="Permanent link">&para;</a></h2>
<h3 id="consistency-pattern-selection-checklist">Consistency Pattern Selection Checklist<a class="header-link" href="#consistency-pattern-selection-checklist" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Consistency</span><span class="w"> </span><span class="nv">Pattern</span><span class="w"> </span><span class="nv">Selection</span><span class="w"> </span><span class="nv">Guide</span><span class="w">                 </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Question</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">What</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">impact</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="nv">inconsistency</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">business</span>?<span class="w">      </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Critical</span><span class="w"> </span><span class="ss">(</span><span class="nv">financial</span><span class="w"> </span><span class="nv">loss</span>,<span class="w"> </span><span class="nv">legal</span><span class="w"> </span><span class="nv">issues</span><span class="ss">)</span><span class="w"> </span>â”€â”€â–º<span class="w"> </span><span class="nv">Strong</span><span class="w"> </span><span class="nv">Consistency</span><span class="w">    </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Acceptable</span><span class="w"> </span><span class="ss">(</span><span class="nv">temporarily</span><span class="w"> </span><span class="nv">stale</span><span class="w"> </span><span class="nv">info</span><span class="ss">)</span><span class="w"> </span>â”€â”€â–º<span class="w"> </span><span class="nv">Eventual</span><span class="w"> </span><span class="nv">Consistency</span><span class="w">      </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Question</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">What</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="nv">system</span><span class="w"> </span><span class="nv">requirements</span>?<span class="w">                     </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Low</span><span class="w"> </span><span class="nv">latency</span><span class="w"> </span>â”€â”€â–º<span class="w"> </span><span class="nv">Eventual</span><span class="w"> </span><span class="nv">Consistency</span><span class="w">                              </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Data</span><span class="w"> </span><span class="nv">accuracy</span><span class="w"> </span>â”€â”€â–º<span class="w"> </span><span class="nv">Strong</span><span class="w"> </span><span class="nv">Consistency</span><span class="w">                              </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Question</span><span class="w"> </span><span class="mi">3</span>:<span class="w"> </span><span class="nv">What</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">system</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">failure</span>?<span class="w">                          </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Allow</span><span class="w"> </span><span class="nv">partial</span><span class="w"> </span><span class="nv">functionality</span><span class="w"> </span><span class="nv">outage</span><span class="w"> </span>â”€â”€â–º<span class="w"> </span><span class="nv">Strong</span><span class="w"> </span><span class="nv">Consistency</span><span class="w"> </span><span class="ss">(</span><span class="nv">CP</span><span class="ss">)</span><span class="w">    </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Always</span><span class="w"> </span><span class="nv">need</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">respond</span><span class="w"> </span>â”€â”€â–º<span class="w"> </span><span class="nv">Eventual</span><span class="w"> </span><span class="nv">Consistency</span><span class="w"> </span><span class="ss">(</span><span class="nv">AP</span><span class="ss">)</span><span class="w">              </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Question</span><span class="w"> </span><span class="mi">4</span>:<span class="w"> </span><span class="nv">What</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">read</span><span class="o">/</span><span class="nv">write</span><span class="w"> </span><span class="nv">ratio</span>?<span class="w">                              </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Read</span><span class="o">-</span><span class="nv">heavy</span><span class="w"> </span><span class="ss">(</span><span class="mi">90</span><span class="o">%+</span><span class="ss">)</span><span class="w"> </span>â”€â”€â–º<span class="w"> </span><span class="nv">Eventual</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">Read</span><span class="w"> </span><span class="nv">Replica</span><span class="w">                     </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Write</span><span class="o">-</span><span class="nv">heavy</span><span class="w"> </span>â”€â”€â–º<span class="w"> </span><span class="nv">Careful</span><span class="o">!</span><span class="w"> </span><span class="nv">Consider</span><span class="w"> </span><span class="nv">replication</span><span class="w"> </span><span class="nv">lag</span><span class="w">                 </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="hybrid-approach">Hybrid Approach<a class="header-link" href="#hybrid-approach" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="nx">Hybrid</span><span class="w"> </span><span class="nx">Consistency</span><span class="w"> </span><span class="nx">Strategy</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Apply</span><span class="w"> </span><span class="nx">different</span><span class="w"> </span><span class="nx">consistency</span><span class="w"> </span><span class="nx">levels</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">within</span><span class="w"> </span><span class="nx">same</span><span class="w"> </span><span class="nx">system</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Example</span><span class="p">:</span><span class="w"> </span><span class="nx">E</span><span class="o">-</span><span class="nx">commerce</span><span class="w"> </span><span class="nx">system</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Data</span><span class="w"> </span><span class="nx">Type</span><span class="w">           </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Consistency</span><span class="w"> </span><span class="nx">Level</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Reason</span><span class="w">           </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Inventory</span><span class="w"> </span><span class="nx">quantity</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Strong</span><span class="w">            </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Prevent</span><span class="w"> </span><span class="nx">oversell</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Payment</span><span class="w"> </span><span class="nx">status</span><span class="w">      </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Strong</span><span class="w">            </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Money</span><span class="w"> </span><span class="nx">accuracy</span><span class="w">   </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Product</span><span class="w"> </span><span class="nx">reviews</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Eventual</span><span class="w">          </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">No</span><span class="w"> </span><span class="nx">immediate</span><span class="w"> </span><span class="nx">need</span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">View</span><span class="w"> </span><span class="nx">counts</span><span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Eventual</span><span class="w">          </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Less</span><span class="w"> </span><span class="nx">important</span><span class="w">   </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Shopping</span><span class="w"> </span><span class="nx">cart</span><span class="w">       </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Session</span><span class="w">           </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Per</span><span class="o">-</span><span class="nx">user</span><span class="w"> </span><span class="nx">consist</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Recommended</span><span class="w"> </span><span class="nx">products</span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Eventual</span><span class="w">          </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Not</span><span class="w"> </span><span class="nx">real</span><span class="o">-</span><span class="nx">time</span><span class="w">    </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="7-practice-problems">7. Practice Problems<a class="header-link" href="#7-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-analyze-consistency-requirements">Exercise 1: Analyze Consistency Requirements<a class="header-link" href="#exercise-1-analyze-consistency-requirements" title="Permanent link">&para;</a></h3>
<p>Choose an appropriate consistency model for the following scenarios and explain why:</p>
<ol>
<li>Bank account balance</li>
<li>Twitter follower count</li>
<li>Online game ranking</li>
<li>Airline seat reservation</li>
<li>News article view count</li>
</ol>
<h3 id="exercise-2-saga-design">Exercise 2: Saga Design<a class="header-link" href="#exercise-2-saga-design" title="Permanent link">&para;</a></h3>
<p>Design an order process for an online shopping mall using the Saga pattern:
- Include steps: order creation, inventory check, payment, shipping reservation
- Define compensating transactions for each step
- Design both Choreography and Orchestration versions</p>
<h3 id="exercise-3-read-consistency-implementation">Exercise 3: Read Consistency Implementation<a class="header-link" href="#exercise-3-read-consistency-implementation" title="Permanent link">&para;</a></h3>
<p>Design a client library that guarantees Read-Your-Writes:
- Guarantee latest data on read after write
- Use timestamp-based approach
- Include caching strategy</p>
<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>In <a href="./11_Message_Queue_Basics.md">11_Message_Queue_Basics.md</a>, let's learn about message queues, the foundation of asynchronous communication!</p>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>"Designing Data-Intensive Applications" - Martin Kleppmann</li>
<li>"Microservices Patterns" - Chris Richardson</li>
<li>Google Cloud Spanner: TrueTime and External Consistency</li>
<li>AWS: Building Distributed Locks with DynamoDB</li>
<li>"Sagas" - Hector Garcia-Molina, Kenneth Salem (1987)</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/09_Database_Replication.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Database Replication</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/System_Design/11_Message_Queue_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Message Queue Fundamentals</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}