{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Queue Fundamentals - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">Message Queue Fundamentals</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Message Queue Fundamentals</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/10_Data_Consistency_Patterns.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Data Consistency Patterns</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/System_Design/12_Message_System_Comparison.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Message Systems Comparison</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-synchronous-vs-asynchronous-communication">1. Synchronous vs Asynchronous Communication</a><ul>
<li><a href="#synchronous-communication">Synchronous Communication</a></li>
<li><a href="#asynchronous-communication">Asynchronous Communication</a></li>
<li><a href="#communication-methods-comparison">Communication Methods Comparison</a></li>
</ul>
</li>
<li><a href="#2-benefits-of-message-queues">2. Benefits of Message Queues</a><ul>
<li><a href="#decoupling">Decoupling</a></li>
<li><a href="#load-leveling">Load Leveling</a></li>
<li><a href="#scalability">Scalability</a></li>
<li><a href="#durability">Durability</a></li>
</ul>
</li>
<li><a href="#3-queue-vs-topic">3. Queue vs Topic</a><ul>
<li><a href="#point-to-point-queue">Point-to-Point (Queue)</a></li>
<li><a href="#publishsubscribe-topic">Publish/Subscribe (Topic)</a></li>
<li><a href="#consumer-group-hybrid">Consumer Group (Hybrid)</a></li>
<li><a href="#pattern-comparison">Pattern Comparison</a></li>
</ul>
</li>
<li><a href="#4-message-delivery-guarantees">4. Message Delivery Guarantees</a><ul>
<li><a href="#at-most-once">At-Most-Once</a></li>
<li><a href="#at-least-once">At-Least-Once</a></li>
<li><a href="#exactly-once">Exactly-Once</a></li>
<li><a href="#delivery-guarantee-comparison">Delivery Guarantee Comparison</a></li>
</ul>
</li>
<li><a href="#5-idempotency">5. Idempotency</a><ul>
<li><a href="#what-is-idempotency">What is Idempotency?</a></li>
<li><a href="#idempotency-implementation-patterns">Idempotency Implementation Patterns</a></li>
<li><a href="#idempotent-consumer-implementation-example">Idempotent Consumer Implementation Example</a></li>
</ul>
</li>
<li><a href="#6-message-queue-patterns">6. Message Queue Patterns</a><ul>
<li><a href="#work-queue-task-queue">Work Queue (Task Queue)</a></li>
<li><a href="#request-reply">Request-Reply</a></li>
<li><a href="#dead-letter-queue-dlq">Dead Letter Queue (DLQ)</a></li>
<li><a href="#priority-queue">Priority Queue</a></li>
</ul>
</li>
<li><a href="#7-practice-problems">7. Practice Problems</a><ul>
<li><a href="#exercise-1-choose-communication-method">Exercise 1: Choose Communication Method</a></li>
<li><a href="#exercise-2-choose-delivery-guarantee">Exercise 2: Choose Delivery Guarantee</a></li>
<li><a href="#exercise-3-design-idempotency">Exercise 3: Design Idempotency</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="message-queue-fundamentals">Message Queue Fundamentals<a class="header-link" href="#message-queue-fundamentals" title="Permanent link">&para;</a></h1>
<p>Difficulty: â­â­â­</p>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Message queues are essential infrastructure enabling asynchronous communication between services in distributed systems. This chapter covers the differences between synchronous and asynchronous communication, queue vs topic concepts, message delivery guarantees, and idempotency.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-synchronous-vs-asynchronous-communication">Synchronous vs Asynchronous Communication</a></li>
<li><a href="#2-benefits-of-message-queues">Benefits of Message Queues</a></li>
<li><a href="#3-queue-vs-topic">Queue vs Topic</a></li>
<li><a href="#4-message-delivery-guarantees">Message Delivery Guarantees</a></li>
<li><a href="#5-idempotency">Idempotency</a></li>
<li><a href="#6-message-queue-patterns">Message Queue Patterns</a></li>
<li><a href="#7-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-synchronous-vs-asynchronous-communication">1. Synchronous vs Asynchronous Communication<a class="header-link" href="#1-synchronous-vs-asynchronous-communication" title="Permanent link">&para;</a></h2>
<h3 id="synchronous-communication">Synchronous Communication<a class="header-link" href="#synchronous-communication" title="Permanent link">&para;</a></h3>
<p>Waiting for a response after making a request.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Synchronous</span><span class="w"> </span><span class="ss">(</span><span class="nv">Request</span><span class="o">-</span><span class="nv">Response</span><span class="ss">)</span><span class="w">                      </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                           </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">A</span>â”‚<span class="w">                           </span>â”‚<span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">B</span>â”‚<span class="w">                   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<span class="w">                           </span>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<span class="w">                   </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                                      </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚â”€â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">HTTP</span><span class="w"> </span><span class="nv">Request</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                                      </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">        </span><span class="ss">(</span><span class="nv">Service</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">blocked</span><span class="ss">)</span><span class="w">           </span>â”‚<span class="w"> </span><span class="nv">Processing</span>...<span class="w">            </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">        </span><span class="nv">Request</span><span class="w"> </span><span class="nv">thread</span><span class="w"> </span><span class="nv">waiting</span><span class="w">        </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                                      </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚â—„â”€â”€â”€â”€â”€â”€<span class="w"> </span><span class="nv">HTTP</span><span class="w"> </span><span class="nv">Response</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                                      </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â–¼<span class="w">                                      </span>â–¼<span class="w">                          </span>â”‚
â”‚<span class="w">  </span><span class="k">Continue</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="nv">task</span><span class="w">                    </span><span class="nv">Processing</span><span class="w"> </span><span class="nv">complete</span><span class="w">              </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Characteristics</span>:<span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Immediate</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="nv">required</span><span class="w">                                          </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Caller</span><span class="w"> </span><span class="nv">waits</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">response</span><span class="w">                                            </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">affected</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">fails</span><span class="w">                              </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="asynchronous-communication">Asynchronous Communication<a class="header-link" href="#asynchronous-communication" title="Permanent link">&para;</a></h3>
<p>Send a message and immediately continue with other tasks.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Asynchronous</span><span class="w"> </span><span class="ss">(</span><span class="nv">Message</span><span class="w"> </span><span class="nv">Queue</span><span class="ss">)</span><span class="w">                        </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">A</span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Message</span><span class="w"> </span><span class="nv">Queue</span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">B</span>â”‚<span class="w">                   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="ss">(</span><span class="nv">Producer</span><span class="ss">)</span>â”‚<span class="w">     </span>â”‚<span class="w">              </span>â”‚<span class="w">     </span>â”‚<span class="ss">(</span><span class="nv">Consumer</span><span class="ss">)</span>â”‚<span class="w">                   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<span class="w">                   </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                  </span>â”‚<span class="w">                  </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚â”€â”€â”€â”€<span class="w"> </span><span class="k">Send</span><span class="w"> </span><span class="nv">Msg</span><span class="w"> </span>â”€â”€â”€â–ºâ”‚<span class="w">                  </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚â—„â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">                  </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                  </span>â”‚<span class="w">                  </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">       </span>â–¼<span class="w">                  </span>â”‚<span class="w">                  </span>â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">  </span><span class="k">Continue</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="nv">task</span><span class="w">      </span>â”‚â—„â”€â”€â”€<span class="w"> </span><span class="nv">Poll</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">no</span><span class="w"> </span><span class="nv">blocking</span><span class="ss">)</span><span class="w">           </span>â”‚â”€â”€â”€â”€<span class="w"> </span><span class="nv">Deliver</span><span class="w"> </span>â”€â”€â”€â”€â–ºâ”‚<span class="w">                          </span>â”‚
â”‚<span class="w">                          </span>â”‚<span class="w">                  </span>â”‚<span class="w"> </span><span class="nv">Processing</span>...<span class="w">            </span>â”‚
â”‚<span class="w">                          </span>â”‚â—„â”€â”€â”€<span class="w"> </span><span class="nv">ACK</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">                          </span>â”‚
â”‚<span class="w">                          </span>â”‚<span class="w">                  </span>â–¼<span class="w">                          </span>â”‚
â”‚<span class="w">                          </span>â”‚<span class="w">             </span><span class="nv">Processing</span><span class="w"> </span><span class="nv">complete</span><span class="w">             </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Characteristics</span>:<span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Sender</span><span class="o">/</span><span class="nv">receiver</span><span class="w"> </span><span class="nv">independent</span><span class="w">                                          </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Loose</span><span class="w"> </span><span class="nv">coupling</span><span class="w">                                                       </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="nv">operates</span><span class="w"> </span><span class="nv">normally</span><span class="w"> </span><span class="nv">even</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">Service</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">fails</span><span class="w">                </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="communication-methods-comparison">Communication Methods Comparison<a class="header-link" href="#communication-methods-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>Synchronous</th>
<th>Asynchronous</th>
</tr>
</thead>
<tbody>
<tr>
<td>Wait for response</td>
<td>Required</td>
<td>Not required</td>
</tr>
<tr>
<td>Coupling</td>
<td>Strong</td>
<td>Loose</td>
</tr>
<tr>
<td>Failure propagation</td>
<td>Immediate</td>
<td>Isolated</td>
</tr>
<tr>
<td>Real-time nature</td>
<td>Immediate</td>
<td>Can be delayed</td>
</tr>
<tr>
<td>Complexity</td>
<td>Low</td>
<td>High</td>
</tr>
<tr>
<td>Throughput</td>
<td>Limited</td>
<td>High</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-benefits-of-message-queues">2. Benefits of Message Queues<a class="header-link" href="#2-benefits-of-message-queues" title="Permanent link">&para;</a></h2>
<h3 id="decoupling">Decoupling<a class="header-link" href="#decoupling" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="n">Tight</span><span class="w"> </span><span class="n">Coupling</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="n">Loose</span><span class="w"> </span><span class="n">Coupling</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Tight</span><span class="w"> </span><span class="n">Coupling</span><span class="w"> </span><span class="p">(</span><span class="n">synchronous</span><span class="p">)</span><span class="err">:</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">A</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â–ºâ”‚</span><span class="w">  </span><span class="n">B</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â–ºâ”‚</span><span class="w">  </span><span class="n">C</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â–ºâ”‚</span><span class="w">  </span><span class="n">D</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”˜</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                       </span><span class="n">X</span><span class="w"> </span><span class="n">Failure</span><span class="err">!</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â–¼</span><span class="w">                                                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">fails</span><span class="err">!</span><span class="w"> </span><span class="p">(</span><span class="n">Wait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">fails</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">entire</span><span class="w"> </span><span class="n">failure</span><span class="p">)</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Loose</span><span class="w"> </span><span class="n">Coupling</span><span class="w"> </span><span class="p">(</span><span class="n">asynchronous</span><span class="p">)</span><span class="err">:</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="err">â”‚</span><span class="w">   </span><span class="n">Message</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”</span><span class="w">            </span><span class="err">â”‚</span><span class="w">    </span><span class="n">Queue</span><span class="w">    </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">A</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€</span><span class="n">publish</span><span class="err">â”€â”€â–ºâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€</span><span class="n">consume</span><span class="err">â”€â”€â”‚</span><span class="w">  </span><span class="n">B</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”˜</span><span class="w">            </span><span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">msg</span><span class="o">][</span><span class="n">msg</span><span class="o">]</span><span class="w"> </span><span class="err">â”‚</span><span class="w">            </span><span class="err">â””â”€â”€â”€â”€â”€â”˜</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">  </span><span class="o">[</span><span class="n">msg</span><span class="o">][</span><span class="n">msg</span><span class="o">]</span><span class="w"> </span><span class="err">â”‚</span><span class="w">               </span><span class="n">X</span><span class="w"> </span><span class="n">Failure</span><span class="err">!</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">     </span><span class="err">â–¼</span><span class="w">               </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">A</span><span class="w"> </span><span class="n">continues</span><span class="err">!</span><span class="w">                                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">Messages</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">recovers</span><span class="p">)</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="load-leveling">Load Leveling<a class="header-link" href="#load-leveling" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="n">Load</span><span class="w"> </span><span class="n">Leveling</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Without</span><span class="w"> </span><span class="n">Queue</span><span class="w"> </span><span class="p">(</span><span class="n">direct</span><span class="w"> </span><span class="n">call</span><span class="p">):</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Request</span><span class="w">    </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆ</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">volume</span><span class="w">     </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆ</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="n">overload</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">peak</span><span class="o">!</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Processing</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”€â”€â”€â–ˆâ–ˆâ–ˆâ–ˆâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">capacity</span><span class="w">   </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆ</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><span class="w"> </span><span class="n">Time</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">With</span><span class="w"> </span><span class="n">Queue</span><span class="w"> </span><span class="p">(</span><span class="n">buffering</span><span class="p">):</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Request</span><span class="w">    </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆ</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">volume</span><span class="w">     </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆ</span><span class="w">                                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Queue</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”€â”€â”€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”€â”€</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">size</span><span class="w">       </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Processing</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="n">Steady</span><span class="w"> </span><span class="n">processing</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">             </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><span class="w"> </span><span class="n">Time</span><span class="w">                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Queue</span><span class="w"> </span><span class="n">acts</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">buffer</span><span class="p">:</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Absorb</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="n">traffic</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Consumer</span><span class="w"> </span><span class="n">processes</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">steady</span><span class="w"> </span><span class="n">rate</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Improved</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">stability</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="scalability">Scalability<a class="header-link" href="#scalability" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="n">Horizontal</span><span class="w"> </span><span class="n">Scaling</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Message</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">   </span><span class="n">Queue</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Producer</span><span class="err">â”€â”€â”€â–ºâ”‚</span><span class="w"> </span><span class="o">[</span><span class="n">m1</span><span class="o">][</span><span class="n">m2</span><span class="o">]</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="o">[</span><span class="n">m3</span><span class="o">][</span><span class="n">m4</span><span class="o">]</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w"> </span><span class="o">[</span><span class="n">m5</span><span class="o">][</span><span class="n">m6</span><span class="o">]</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="err">â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="err">â”‚</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">         </span><span class="err">â–¼</span><span class="w">          </span><span class="err">â–¼</span><span class="w">          </span><span class="err">â–¼</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="n">Consumer1</span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="n">Consumer2</span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="n">Consumer3</span><span class="err">â”‚</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">m3</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">    </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">To</span><span class="w"> </span><span class="n">increase</span><span class="w"> </span><span class="nl">throughput</span><span class="p">:</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">consumers</span><span class="w">                                              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="k">No</span><span class="w"> </span><span class="n">producer</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="n">needed</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Messages</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="k">distributed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">consumers</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="durability">Durability<a class="header-link" href="#durability" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="n">Message</span><span class="w"> </span><span class="n">Persistence</span><span class="w">                                 </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Producer</span><span class="w"> </span><span class="err">â”‚â”€â”€â”€â”€â–ºâ”‚</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Queue</span><span class="w"> </span><span class="p">(</span><span class="n">Durable</span><span class="p">)</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Memory</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="o">[</span><span class="n">msg1</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">msg2</span><span class="o">]</span><span class="w">    </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">           </span><span class="err">â–¼</span><span class="w">              </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">  </span><span class="k">Disk</span><span class="w"> </span><span class="p">(</span><span class="n">WAL</span><span class="p">)</span><span class="w">              </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="n">msg1</span><span class="p">,</span><span class="w"> </span><span class="n">msg2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w">  </span><span class="err">â”‚</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">    </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Failure</span><span class="w"> </span><span class="nl">recovery</span><span class="p">:</span><span class="w">                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">Broker</span><span class="w"> </span><span class="n">restarts</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="k">Restore</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">disk</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="n">Resend</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">consumers</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="n">Prevent</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">loss</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="3-queue-vs-topic">3. Queue vs Topic<a class="header-link" href="#3-queue-vs-topic" title="Permanent link">&para;</a></h2>
<h3 id="point-to-point-queue">Point-to-Point (Queue)<a class="header-link" href="#point-to-point-queue" title="Permanent link">&para;</a></h3>
<p>One message is processed by only one consumer.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Point-to-Point (Queue)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚      Queue        â”‚                          â”‚
â”‚  â”‚Producer 1â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚ A â”‚ B â”‚ C â”‚ D â”‚ â”‚                          â”‚
â”‚                        â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                   â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚Producer 2â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Each message      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Consumer 1â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ processed by only â”‚   A,C    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚ one consumer      â”‚                          â”‚
â”‚                        â”‚                   â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                        â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Consumer 2â”‚    â”‚
â”‚                        â”‚                   â”‚   B,D    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                         â”‚
â”‚  Use cases:                                                             â”‚
â”‚  - Work distribution (Work Queue)                                       â”‚
â”‚  - Order processing                                                     â”‚
â”‚  - Email sending queue                                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="publishsubscribe-topic">Publish/Subscribe (Topic)<a class="header-link" href="#publishsubscribe-topic" title="Permanent link">&para;</a></h3>
<p>One message is delivered to all subscribers.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Publish/Subscribe (Topic)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚      Topic        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Publisher â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Subscriber 1â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚ A â”‚ B â”‚ C â”‚ D â”‚ â”‚  A,B,   â”‚ (all msgs) â”‚   â”‚
â”‚                        â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚  C,D    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                        â”‚                   â”‚                          â”‚
â”‚                        â”‚ All subscribers   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                        â”‚ receive all       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Subscriber 2â”‚   â”‚
â”‚                        â”‚ messages          â”‚  A,B,   â”‚ (all msgs) â”‚   â”‚
â”‚                        â”‚                   â”‚  C,D    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                        â”‚                   â”‚                          â”‚
â”‚                        â”‚                   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                        â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚Subscriber 3â”‚   â”‚
â”‚                        â”‚                   â”‚  A,B,   â”‚ (all msgs) â”‚   â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  C,D    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Use cases:                                                             â”‚
â”‚  - Event broadcast                                                      â”‚
â”‚  - Log collection (multiple systems receive same logs)                  â”‚
â”‚  - Price updates (propagate to all clients)                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="consumer-group-hybrid">Consumer Group (Hybrid)<a class="header-link" href="#consumer-group-hybrid" title="Permanent link">&para;</a></h3>
<p>Kafka style: Topic + distributed processing within group</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Consumer Group                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                        â”‚      Topic        â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚                          â”‚
â”‚  â”‚Publisher â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”‚ A â”‚ B â”‚ C â”‚ D â”‚ â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚                          â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                  â”‚                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚              â–¼                   â–¼                   â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Consumer Group 1 â”‚ â”‚  Consumer Group 2 â”‚ â”‚  Consumer Group 3 â”‚    â”‚
â”‚  â”‚ (Order Service)   â”‚ â”‚ (Analytics)       â”‚ â”‚ (Notification)    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”    â”‚ â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”    â”‚ â”‚ â”Œâ”€â”€â”€â”€â”            â”‚    â”‚
â”‚  â”‚ â”‚C1-1â”‚ â”‚C1-2â”‚    â”‚ â”‚ â”‚C2-1â”‚ â”‚C2-2â”‚    â”‚ â”‚ â”‚C3-1â”‚            â”‚    â”‚
â”‚  â”‚ â”‚A,C â”‚ â”‚B,D â”‚    â”‚ â”‚ â”‚A,C â”‚ â”‚B,D â”‚    â”‚ â”‚ â”‚A,B,C,Dâ”‚         â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜    â”‚ â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜    â”‚ â”‚ â””â”€â”€â”€â”€â”˜            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  Behavior:                                                              â”‚
â”‚  - Each group receives all messages (Pub/Sub)                           â”‚
â”‚  - Within group, messages are distributed (Point-to-Point)              â”‚
â”‚  - Scaling: Add consumers within group                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="pattern-comparison">Pattern Comparison<a class="header-link" href="#pattern-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Characteristic</th>
<th>Queue (P2P)</th>
<th>Topic (Pub/Sub)</th>
<th>Consumer Group</th>
</tr>
</thead>
<tbody>
<tr>
<td>Message copies</td>
<td>1:1</td>
<td>1:N</td>
<td>1 per group</td>
</tr>
<tr>
<td>Load balancing</td>
<td>O</td>
<td>X</td>
<td>O within group</td>
</tr>
<tr>
<td>Broadcast</td>
<td>X</td>
<td>O</td>
<td>O between groups</td>
</tr>
<tr>
<td>Scalability</td>
<td>Add consumers</td>
<td>Limited</td>
<td>Flexible</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4-message-delivery-guarantees">4. Message Delivery Guarantees<a class="header-link" href="#4-message-delivery-guarantees" title="Permanent link">&para;</a></h2>
<h3 id="at-most-once">At-Most-Once<a class="header-link" href="#at-most-once" title="Permanent link">&para;</a></h3>
<p>Messages may be lost, but no duplicates.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">At</span><span class="o">-</span><span class="nv">Most</span><span class="o">-</span><span class="nv">Once</span><span class="w">                                        </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">     </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">                        </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">Producer</span><span class="w"> </span>â”‚<span class="w">     </span>â”‚<span class="w">  </span><span class="nv">Queue</span><span class="w">  </span>â”‚<span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Consumer</span><span class="w"> </span>â”‚<span class="w">                        </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜<span class="w">     </span>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<span class="w">                        </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                </span>â”‚<span class="w">               </span>â”‚<span class="w">                               </span>â”‚
â”‚<span class="w">       </span>â”‚â”€â”€<span class="w"> </span><span class="k">Send</span><span class="ss">(</span><span class="nv">msg</span><span class="ss">)</span><span class="w"> </span>â”€â”€â–ºâ”‚<span class="w">               </span>â”‚<span class="w">                               </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                </span>â”‚â”€â”€<span class="w"> </span><span class="nv">Deliver</span><span class="w"> </span>â”€â”€â”€â–ºâ”‚<span class="w">                               </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                </span>â”‚<span class="w">               </span><span class="nv">X</span><span class="w"> </span><span class="nv">Failure</span><span class="w"> </span><span class="nv">before</span><span class="w"> </span><span class="nv">processing</span><span class="o">!</span><span class="w">    </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                </span>â”‚<span class="w">               </span>â”‚<span class="w">                               </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                </span>â”‚<span class="w"> </span><span class="ss">(</span><span class="nv">delete</span><span class="w"> </span><span class="nv">msg</span><span class="ss">)</span><span class="w">  </span>â”‚<span class="w">                               </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                </span>â”‚<span class="w">               </span>â”‚<span class="w">                               </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                </span>â”‚<span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">resend</span><span class="w">     </span>â”‚<span class="w">                               </span>â”‚
â”‚<span class="w">       </span>â”‚<span class="w">                </span>â”‚<span class="w">               </span>â”‚<span class="w">                               </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Implementation</span>:<span class="w"> </span><span class="nv">Delete</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="nv">before</span><span class="w"> </span><span class="nv">ACK</span><span class="w">                              </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Advantages</span>:<span class="w">                                                            </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">duplicate</span><span class="w"> </span><span class="nv">processing</span><span class="w"> </span><span class="nv">needed</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Fastest</span><span class="w"> </span><span class="nv">performance</span><span class="w">                                                  </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Disadvantages</span>:<span class="w">                                                         </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Possible</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="nv">loss</span><span class="w">                                                </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Use</span><span class="w"> </span><span class="nv">cases</span>:<span class="w">                                                             </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Real</span><span class="o">-</span><span class="nv">time</span><span class="w"> </span><span class="nv">sensor</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="ss">(</span><span class="nv">some</span><span class="w"> </span><span class="nv">loss</span><span class="w"> </span><span class="nv">acceptable</span><span class="ss">)</span><span class="w">                         </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Log</span><span class="w"> </span><span class="nv">collection</span><span class="w"> </span><span class="ss">(</span><span class="nv">performance</span><span class="w"> </span><span class="nv">over</span><span class="w"> </span><span class="nv">completeness</span><span class="ss">)</span><span class="w">                       </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="at-least-once">At-Least-Once<a class="header-link" href="#at-least-once" title="Permanent link">&para;</a></h3>
<p>Messages may be duplicated, but no loss.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="nx">At</span><span class="o">-</span><span class="nx">Least</span><span class="o">-</span><span class="nx">Once</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Producer</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Queue</span><span class="w">  </span><span class="err">â”‚</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Consumer</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚â”€â”€</span><span class="w"> </span><span class="nx">Send</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="err">â”€â”€â–ºâ”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚â”€â”€</span><span class="w"> </span><span class="nx">Deliver</span><span class="w"> </span><span class="err">â”€â”€â”€â–ºâ”‚</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Processing</span><span class="w"> </span><span class="nx">complete</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="nx">X</span><span class="w"> </span><span class="nx">Failure</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">ACK</span><span class="p">!</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w"> </span><span class="p">(</span><span class="nx">no</span><span class="w"> </span><span class="nx">ACK</span><span class="w"> </span><span class="nx">recv</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚â”€â”€</span><span class="w"> </span><span class="nx">Redeliver</span><span class="w"> </span><span class="err">â”€â–ºâ”‚</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="nx">Resend</span><span class="w"> </span><span class="p">(</span><span class="nx">duplicate</span><span class="p">!)</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚â—„â”€â”€</span><span class="w"> </span><span class="nx">ACK</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”‚</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Implementation</span><span class="p">:</span><span class="w"> </span><span class="nx">Delete</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">ACK</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Advantages</span><span class="p">:</span><span class="w">                                                            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="nx">loss</span><span class="w">                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Disadvantages</span><span class="p">:</span><span class="w">                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Need</span><span class="w"> </span><span class="nx">duplicate</span><span class="w"> </span><span class="nx">processing</span><span class="w"> </span><span class="p">(</span><span class="nx">requires</span><span class="w"> </span><span class="nx">idempotency</span><span class="p">)</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Use</span><span class="w"> </span><span class="nx">cases</span><span class="p">:</span><span class="w">                                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Payment</span><span class="w"> </span><span class="nx">processing</span><span class="w"> </span><span class="p">(</span><span class="nx">no</span><span class="w"> </span><span class="nx">loss</span><span class="w"> </span><span class="nx">allowed</span><span class="p">,</span><span class="w"> </span><span class="nx">implement</span><span class="w"> </span><span class="nx">idempotency</span><span class="p">)</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Order</span><span class="w"> </span><span class="nx">processing</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Email</span><span class="w"> </span><span class="nx">sending</span><span class="w">                                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="exactly-once">Exactly-Once<a class="header-link" href="#exactly-once" title="Permanent link">&para;</a></h3>
<p>Theoretically most ideal, but complex to implement.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="nx">Exactly</span><span class="o">-</span><span class="nx">Once</span><span class="w">                                        </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Pure</span><span class="w"> </span><span class="nx">Exactly</span><span class="o">-</span><span class="nx">Once</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">impossible</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">distributed</span><span class="w"> </span><span class="nx">systems</span><span class="p">!</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="nx">Two</span><span class="w"> </span><span class="nx">Generals</span><span class="w"> </span><span class="nx">Problem</span><span class="p">)</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Practical</span><span class="w"> </span><span class="nx">implementation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Effectively Once&quot;</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Method</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nx">At</span><span class="o">-</span><span class="nx">Least</span><span class="o">-</span><span class="nx">Once</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">Idempotent</span><span class="w"> </span><span class="nx">Consumer</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">     </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Producer</span><span class="w"> </span><span class="err">â”‚â”€â”€â”€â”€â–ºâ”‚</span><span class="w">  </span><span class="nx">Queue</span><span class="w">  </span><span class="err">â”‚â”€â”€â”€â”€â–ºâ”‚</span><span class="w"> </span><span class="nx">Idempotent</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Consumer</span><span class="w">         </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="nx">Processed</span><span class="w"> </span><span class="nx">IDs</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="p">{</span><span class="nx">id1</span><span class="p">,</span><span class="w"> </span><span class="nx">id2</span><span class="p">,</span><span class="w"> </span><span class="p">..}</span><span class="err">â”‚</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w"> </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w"> </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Ignore</span><span class="w"> </span><span class="nx">already</span><span class="w">   </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">processed</span><span class="w">        </span><span class="err">â”‚</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Method</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nx">Transaction</span><span class="o">-</span><span class="nx">based</span><span class="w"> </span><span class="p">(</span><span class="nx">Kafka</span><span class="w"> </span><span class="nx">Transactions</span><span class="p">)</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Transaction</span><span class="w">                                             </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">      </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Read</span><span class="w"> </span><span class="nx">from</span><span class="w">   </span><span class="err">â”‚â”€â”€â”‚</span><span class="w"> </span><span class="nx">Process</span><span class="w">     </span><span class="err">â”‚â”€â”€â”‚</span><span class="w"> </span><span class="nx">Write</span><span class="w"> </span><span class="nx">to</span><span class="w">    </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">             </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="nx">topic</span><span class="err">â”‚</span><span class="w">      </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">      </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                          </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">succeed</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">fail</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Use</span><span class="w"> </span><span class="nx">cases</span><span class="p">:</span><span class="w">                                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Financial</span><span class="w"> </span><span class="nx">transactions</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Inventory</span><span class="w"> </span><span class="nx">management</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nx">Stream</span><span class="w"> </span><span class="nx">processing</span><span class="w"> </span><span class="p">(</span><span class="nx">Kafka</span><span class="w"> </span><span class="nx">Streams</span><span class="p">)</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="delivery-guarantee-comparison">Delivery Guarantee Comparison<a class="header-link" href="#delivery-guarantee-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Guarantee Level</th>
<th>Loss</th>
<th>Duplicate</th>
<th>Performance</th>
<th>Complexity</th>
</tr>
</thead>
<tbody>
<tr>
<td>At-Most-Once</td>
<td>Possible</td>
<td>None</td>
<td>Highest</td>
<td>Low</td>
</tr>
<tr>
<td>At-Least-Once</td>
<td>None</td>
<td>Possible</td>
<td>Good</td>
<td>Medium</td>
</tr>
<tr>
<td>Exactly-Once</td>
<td>None</td>
<td>None</td>
<td>Low</td>
<td>High</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5-idempotency">5. Idempotency<a class="header-link" href="#5-idempotency" title="Permanent link">&para;</a></h2>
<h3 id="what-is-idempotency">What is Idempotency?<a class="header-link" href="#what-is-idempotency" title="Permanent link">&para;</a></h3>
<p>The property that performing the same operation multiple times produces the same result.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Idempotency                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Idempotent operation:                                                  â”‚
â”‚  f(f(x)) = f(x)                                                        â”‚
â”‚                                                                         â”‚
â”‚  Examples:                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Operation                â”‚ Idempotent? â”‚ Description         â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  x = 5                    â”‚  O     â”‚ x=5 no matter how many  â”‚    â”‚
â”‚  â”‚  DELETE /users/123        â”‚  O     â”‚ Deleting already deletedâ”‚    â”‚
â”‚  â”‚  PUT /users/123 {name:A}  â”‚  O     â”‚ Overwrite with same val â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  x = x + 1                â”‚  X     â”‚ Increases each time     â”‚    â”‚
â”‚  â”‚  POST /orders             â”‚  X     â”‚ Creates new order each  â”‚    â”‚
â”‚  â”‚  account.balance -= 100   â”‚  X     â”‚ Deducts each time       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="idempotency-implementation-patterns">Idempotency Implementation Patterns<a class="header-link" href="#idempotency-implementation-patterns" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="nt">Idempotency</span><span class="w"> </span><span class="nt">Implementation</span><span class="w"> </span><span class="nt">Methods</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Method</span><span class="w"> </span><span class="nt">1</span><span class="o">:</span><span class="w"> </span><span class="nt">Idempotency</span><span class="w"> </span><span class="nt">Key</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">                         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Client</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                         </span><span class="err">â”‚</span><span class="w">        </span><span class="nt">Server</span><span class="w">          </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><span class="w">                         </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">  </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nt">Processed</span><span class="w"> </span><span class="nt">Keys</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚â”€â”€</span><span class="nt">POST</span><span class="w"> </span><span class="o">/</span><span class="nt">payment</span><span class="w">                </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="p">{</span><span class="err">key1,</span><span class="w"> </span><span class="err">key2,</span><span class="w"> </span><span class="err">...</span><span class="p">}</span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Idempotency-Key</span><span class="o">:</span><span class="w"> </span><span class="nt">abc123</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">  </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">  </span><span class="p">{</span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">}</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">1</span><span class="o">.</span><span class="w"> </span><span class="nt">Check</span><span class="o">:</span><span class="w"> </span><span class="nt">abc123</span><span class="o">?</span><span class="w">    </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">2</span><span class="o">.</span><span class="w"> </span><span class="nt">Not</span><span class="w"> </span><span class="nt">found</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nt">process</span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">3</span><span class="o">.</span><span class="w"> </span><span class="nt">Store</span><span class="w"> </span><span class="nt">abc123</span><span class="w">      </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚â—„â”€</span><span class="w"> </span><span class="nt">200</span><span class="w"> </span><span class="nt">OK</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚â”€â”€</span><span class="nt">POST</span><span class="w"> </span><span class="o">/</span><span class="nt">payment</span><span class="w"> </span><span class="o">(</span><span class="nt">retry</span><span class="o">)</span><span class="w">        </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">Idempotency-Key</span><span class="o">:</span><span class="w"> </span><span class="nt">abc123</span><span class="w">     </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">  </span><span class="p">{</span><span class="n">amount</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">}</span><span class="w">               </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">1</span><span class="o">.</span><span class="w"> </span><span class="nt">Check</span><span class="o">:</span><span class="w"> </span><span class="nt">abc123</span><span class="o">?</span><span class="w">    </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">  </span><span class="nt">2</span><span class="o">.</span><span class="w"> </span><span class="nt">Found</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="nt">return</span><span class="w"> </span><span class="nt">old</span><span class="w"> </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚â—„â”€</span><span class="w"> </span><span class="nt">200</span><span class="w"> </span><span class="nt">OK</span><span class="w"> </span><span class="o">(</span><span class="nt">same</span><span class="w"> </span><span class="nt">response</span><span class="o">)</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span><span class="w">                               </span><span class="err">â”‚</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Method</span><span class="w"> </span><span class="nt">2</span><span class="o">:</span><span class="w"> </span><span class="nt">Version</span><span class="o">/</span><span class="nt">Conditional</span><span class="w"> </span><span class="nt">Update</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Non-idempotent</span><span class="w"> </span><span class="nt">UPDATE</span><span class="w">                                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">UPDATE</span><span class="w"> </span><span class="nt">accounts</span><span class="w"> </span><span class="nt">SET</span><span class="w"> </span><span class="nt">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">balance</span><span class="w"> </span><span class="nt">-</span><span class="w"> </span><span class="nt">100</span><span class="w"> </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="o">;</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Deducts</span><span class="w"> </span><span class="nt">100</span><span class="w"> </span><span class="nt">each</span><span class="w"> </span><span class="nt">execution</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Idempotent</span><span class="w"> </span><span class="nt">UPDATE</span><span class="w"> </span><span class="o">(</span><span class="nt">using</span><span class="w"> </span><span class="nt">version</span><span class="o">)</span><span class="w">                                  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">UPDATE</span><span class="w"> </span><span class="nt">accounts</span><span class="w">                                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">SET</span><span class="w"> </span><span class="nt">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">balance</span><span class="w"> </span><span class="nt">-</span><span class="w"> </span><span class="nt">100</span><span class="o">,</span><span class="w"> </span><span class="nt">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">2</span><span class="w">                               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">WHERE</span><span class="w"> </span><span class="nt">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">AND</span><span class="w"> </span><span class="nt">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="o">;</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Only</span><span class="w"> </span><span class="nt">executes</span><span class="w"> </span><span class="nt">when</span><span class="w"> </span><span class="nt">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="o">(</span><span class="nt">succeeds</span><span class="w"> </span><span class="nt">only</span><span class="w"> </span><span class="nt">once</span><span class="o">)</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">Method</span><span class="w"> </span><span class="nt">3</span><span class="o">:</span><span class="w"> </span><span class="nt">Absolute</span><span class="w"> </span><span class="nt">Value</span><span class="w"> </span><span class="nt">Setting</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Non-idempotent</span><span class="w">                                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">INSERT</span><span class="w"> </span><span class="nt">INTO</span><span class="w"> </span><span class="nt">orders</span><span class="w"> </span><span class="o">(</span><span class="nt">user_id</span><span class="o">,</span><span class="w"> </span><span class="nt">amount</span><span class="o">)</span><span class="w"> </span><span class="nt">VALUES</span><span class="w"> </span><span class="o">(</span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">100</span><span class="o">);</span><span class="w">                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">--</span><span class="w"> </span><span class="nt">Idempotent</span><span class="w"> </span><span class="o">(</span><span class="nt">UPSERT</span><span class="o">)</span><span class="w">                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">INSERT</span><span class="w"> </span><span class="nt">INTO</span><span class="w"> </span><span class="nt">orders</span><span class="w"> </span><span class="o">(</span><span class="nt">order_id</span><span class="o">,</span><span class="w"> </span><span class="nt">user_id</span><span class="o">,</span><span class="w"> </span><span class="nt">amount</span><span class="o">)</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">VALUES</span><span class="w"> </span><span class="o">(</span><span class="s1">&#39;order-abc123&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">100</span><span class="o">)</span><span class="w">                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nt">ON</span><span class="w"> </span><span class="nt">CONFLICT</span><span class="w"> </span><span class="o">(</span><span class="nt">order_id</span><span class="o">)</span><span class="w"> </span><span class="nt">DO</span><span class="w"> </span><span class="nt">NOTHING</span><span class="o">;</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="idempotent-consumer-implementation-example">Idempotent Consumer Implementation Example<a class="header-link" href="#idempotent-consumer-implementation-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">IdempotentConsumer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

        <span class="c1"># 1. Check if already processed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_processed</span><span class="p">(</span><span class="n">message_id</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message </span><span class="si">{</span><span class="n">message_id</span><span class="si">}</span><span class="s2"> already processed, skipping&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># 2. Process business logic</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_business_logic</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

            <span class="c1"># 3. Mark as processed (atomically)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_processed</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Can retry on processing failure</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">):</span>
        <span class="c1"># Use Redis SET (manage memory with TTL)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">sismember</span><span class="p">(</span><span class="s2">&quot;processed_messages&quot;</span><span class="p">,</span> <span class="n">message_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">):</span>
        <span class="c1"># Auto-delete after 24 hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="s2">&quot;processed_messages&quot;</span><span class="p">,</span> <span class="n">message_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="s2">&quot;processed_messages&quot;</span><span class="p">,</span> <span class="mi">86400</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_business_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="c1"># Actual business logic</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;payment&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</code></pre></div>

<hr />
<h2 id="6-message-queue-patterns">6. Message Queue Patterns<a class="header-link" href="#6-message-queue-patterns" title="Permanent link">&para;</a></h2>
<h3 id="work-queue-task-queue">Work Queue (Task Queue)<a class="header-link" href="#work-queue-task-queue" title="Permanent link">&para;</a></h3>
<p>Distribute tasks to multiple workers.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Work Queue Pattern                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                       â”‚   Work Queue    â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Producer â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”‚T1 â”‚T2 â”‚T3 â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Worker 1 â”‚         â”‚
â”‚  â”‚  (Web)   â”‚        â”‚ â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚T4 â”‚T5 â”‚T6 â”‚   â”‚                              â”‚
â”‚                       â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Worker 2 â”‚         â”‚
â”‚                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  Use cases:                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  - Image resizing                           â”€â”€â”€â”€â”€â–ºâ”‚ Worker 3 â”‚         â”‚
â”‚  - PDF generation                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  - Email sending                                                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="request-reply">Request-Reply<a class="header-link" href="#request-reply" title="Permanent link">&para;</a></h3>
<p>Asynchronous request-response pattern.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Request-Reply Pattern                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Requesterâ”‚     â”‚Request Queueâ”‚     â”‚ Replier  â”‚                    â”‚
â”‚  â”‚          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚          â”‚                    â”‚
â”‚  â”‚          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚          â”‚                    â”‚
â”‚  â”‚          â”‚     â”‚Reply Queue  â”‚     â”‚          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚       â”‚                  â”‚                 â”‚                           â”‚
â”‚       â”‚â”€Request(replyTo:Q1,correlationId:C1)â”€â–ºâ”‚                        â”‚
â”‚       â”‚                  â”‚                 â”‚                           â”‚
â”‚       â”‚                  â”‚                 â”‚ Processing                â”‚
â”‚       â”‚                  â”‚                 â”‚                           â”‚
â”‚       â”‚â—„â”€â”€Reply(correlationId:C1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
â”‚       â”‚                  â”‚                 â”‚                           â”‚
â”‚                                                                         â”‚
â”‚  Message structure:                                                     â”‚
â”‚  Request: {                                                             â”‚
â”‚    correlationId: &quot;req-123&quot;,                                           â”‚
â”‚    replyTo: &quot;reply-queue-A&quot;,                                           â”‚
â”‚    body: { ... }                                                       â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â”‚  Reply: {                                                               â”‚
â”‚    correlationId: &quot;req-123&quot;,  // Match request and reply               â”‚
â”‚    body: { ... }                                                       â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="dead-letter-queue-dlq">Dead Letter Queue (DLQ)<a class="header-link" href="#dead-letter-queue-dlq" title="Permanent link">&para;</a></h3>
<p>Store failed messages.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Dead Letter Queue                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   Main Queue    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Producer â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Consumer â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚ A â”‚ B â”‚ C â”‚   â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                       â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜   â”‚              â”‚                â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                â”‚
â”‚                                â”‚                       â”‚                â”‚
â”‚                                â”‚ Processing failed     â”‚                â”‚
â”‚                                â”‚ (retry exceeded)      â”‚                â”‚
â”‚                                â–¼                       â–¼                â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        Failed! (msg B)        â”‚
â”‚                       â”‚ Dead Letter Q   â”‚              â”‚                â”‚
â”‚                       â”‚ â”Œâ”€â”€â”€â”           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                       â”‚ â”‚ B â”‚           â”‚                               â”‚
â”‚                       â”‚ â””â”€â”€â”€â”˜           â”‚                               â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚                       Manual review / reprocess                         â”‚
â”‚                                                                         â”‚
â”‚  DLQ usage:                                                             â”‚
â”‚  - Analyze failure cause                                                â”‚
â”‚  - Manual reprocessing                                                  â”‚
â”‚  - Alerting/monitoring                                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="priority-queue">Priority Queue<a class="header-link" href="#priority-queue" title="Permanent link">&para;</a></h3>
<p>Process messages according to priority.</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Priority Queue                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Producer â”‚     â”‚   Priority Queue    â”‚     â”‚ Consumer â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚                     â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚           â”‚ High   â”Œâ”€â”€â”€â”¬â”€â”€â”€â”    â”‚          â”‚                  â”‚
â”‚       â”‚â”€â”€(P:High)â”€â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ A â”‚ D â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â”‚       â”‚           â”‚        â””â”€â”€â”€â”´â”€â”€â”€â”˜    â”‚          â”‚                  â”‚
â”‚       â”‚â”€â”€(P:Med)â”€â”€â”‚ Medium â”Œâ”€â”€â”€â”¬â”€â”€â”€â”    â”‚          â”‚                  â”‚
â”‚       â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ B â”‚   â”‚    â”‚          â”‚                  â”‚
â”‚       â”‚           â”‚        â””â”€â”€â”€â”´â”€â”€â”€â”˜    â”‚          â”‚                  â”‚
â”‚       â”‚â”€â”€(P:Low)â”€â”€â”‚ Low    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”    â”‚          â”‚                  â”‚
â”‚       â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ C â”‚ E â”‚    â”‚          â”‚                  â”‚
â”‚       â”‚           â”‚        â””â”€â”€â”€â”´â”€â”€â”€â”˜    â”‚          â”‚                  â”‚
â”‚       â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                  â”‚
â”‚       â”‚                                            â”‚                  â”‚
â”‚       â”‚           Processing order: A â†’ D â†’ B â†’ C â†’ E â”‚                  â”‚
â”‚                                                                         â”‚
â”‚  Implementation methods:                                                â”‚
â”‚  1. Separate queues per priority + weighted polling                    â”‚
â”‚  2. Single queue + heap sort                                            â”‚
â”‚  3. RabbitMQ: x-max-priority setting                                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="7-practice-problems">7. Practice Problems<a class="header-link" href="#7-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-choose-communication-method">Exercise 1: Choose Communication Method<a class="header-link" href="#exercise-1-choose-communication-method" title="Permanent link">&para;</a></h3>
<p>Select appropriate synchronous/asynchronous method for the following scenarios:</p>
<ol>
<li>User login authentication</li>
<li>Send confirmation email after order</li>
<li>Payment approval request</li>
<li>Log collection</li>
<li>Real-time chat message</li>
</ol>
<h3 id="exercise-2-choose-delivery-guarantee">Exercise 2: Choose Delivery Guarantee<a class="header-link" href="#exercise-2-choose-delivery-guarantee" title="Permanent link">&para;</a></h3>
<p>Select appropriate delivery guarantee level for the following use cases:</p>
<ol>
<li>IoT sensor temperature data</li>
<li>Bank transfer request</li>
<li>News feed update</li>
<li>Order creation event</li>
<li>Game player position update</li>
</ol>
<h3 id="exercise-3-design-idempotency">Exercise 3: Design Idempotency<a class="header-link" href="#exercise-3-design-idempotency" title="Permanent link">&para;</a></h3>
<p>Design how to make the following operations idempotent:</p>
<ol>
<li>Withdraw 100 from account</li>
<li>Decrease product inventory by 1</li>
<li>Send email</li>
<li>Add points</li>
</ol>
<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>In <a href="./12_Message_System_Comparison.md">12_Message_System_Comparison.md</a>, let's compare major message systems like Kafka, RabbitMQ, AWS SQS/SNS!</p>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>"Enterprise Integration Patterns" - Gregor Hohpe, Bobby Woolf</li>
<li>RabbitMQ Official Documentation</li>
<li>Apache Kafka Documentation</li>
<li>AWS Messaging Services</li>
<li>"Designing Data-Intensive Applications" - Martin Kleppmann</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/10_Data_Consistency_Patterns.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Data Consistency Patterns</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/System_Design/12_Message_System_Comparison.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Message Systems Comparison</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}