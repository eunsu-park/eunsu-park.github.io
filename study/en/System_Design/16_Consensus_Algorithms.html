{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consensus Algorithms - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">Consensus Algorithms</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>Consensus Algorithms</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/15_Distributed_Systems_Concepts.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Distributed Systems Concepts</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/System_Design/17_Design_Example_1.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Practical Design Examples 1</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-defining-the-consensus-problem">1. Defining the Consensus Problem</a><ul>
<li><a href="#what-is-consensus">What is Consensus?</a></li>
<li><a href="#properties-of-consensus">Properties of Consensus</a></li>
<li><a href="#failure-models">Failure Models</a></li>
</ul>
</li>
<li><a href="#2-paxos-algorithm">2. Paxos Algorithm</a><ul>
<li><a href="#paxos-overview">Paxos Overview</a></li>
<li><a href="#basic-paxos-two-phases">Basic Paxos: Two Phases</a></li>
<li><a href="#paxos-conflict-resolution">Paxos Conflict Resolution</a></li>
<li><a href="#multi-paxos">Multi-Paxos</a></li>
</ul>
</li>
<li><a href="#3-raft-algorithm">3. Raft Algorithm</a><ul>
<li><a href="#raft-overview">Raft Overview</a></li>
<li><a href="#term">Term</a></li>
<li><a href="#leader-election">Leader Election</a></li>
<li><a href="#log-replication">Log Replication</a></li>
<li><a href="#log-consistency">Log Consistency</a></li>
<li><a href="#raft-vs-paxos">Raft vs Paxos</a></li>
</ul>
</li>
<li><a href="#4-byzantine-fault-tolerance">4. Byzantine Fault Tolerance</a><ul>
<li><a href="#byzantine-generals-problem">Byzantine Generals Problem</a></li>
<li><a href="#pbft-practical-byzantine-fault-tolerance">PBFT (Practical Byzantine Fault Tolerance)</a></li>
<li><a href="#bft-applications">BFT Applications</a></li>
</ul>
</li>
<li><a href="#5-practical-applications">5. Practical Applications</a><ul>
<li><a href="#zookeeper-zab">ZooKeeper (ZAB)</a></li>
<li><a href="#etcd-raft">etcd (Raft)</a></li>
<li><a href="#consul">Consul</a></li>
<li><a href="#tool-comparison">Tool Comparison</a></li>
</ul>
</li>
<li><a href="#6-practice-problems">6. Practice Problems</a><ul>
<li><a href="#exercise-1-paxos-scenario">Exercise 1: Paxos Scenario</a></li>
<li><a href="#exercise-2-raft-log-recovery">Exercise 2: Raft Log Recovery</a></li>
<li><a href="#exercise-3-consensus-system-design">Exercise 3: Consensus System Design</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="consensus-algorithms">Consensus Algorithms<a class="header-link" href="#consensus-algorithms" title="Permanent link">&para;</a></h1>
<p>Difficulty: â­â­â­â­</p>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Consensus in distributed systems is about multiple nodes agreeing on a single value. In this chapter, we'll learn about the definition of the consensus problem, Paxos and Raft algorithms, Byzantine Fault Tolerance, and practical applications with ZooKeeper and etcd.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-defining-the-consensus-problem">Defining the Consensus Problem</a></li>
<li><a href="#2-paxos-algorithm">Paxos Algorithm</a></li>
<li><a href="#3-raft-algorithm">Raft Algorithm</a></li>
<li><a href="#4-byzantine-fault-tolerance">Byzantine Fault Tolerance</a></li>
<li><a href="#5-practical-applications">Practical Applications</a></li>
<li><a href="#6-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-defining-the-consensus-problem">1. Defining the Consensus Problem<a class="header-link" href="#1-defining-the-consensus-problem" title="Permanent link">&para;</a></h2>
<h3 id="what-is-consensus">What is Consensus?<a class="header-link" href="#what-is-consensus" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Consensus Problem                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Goal: N nodes agree on a single value                                 â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   Node 1: &quot;A&quot;                                                   â”‚   â”‚
â”‚  â”‚   Node 2: &quot;B&quot;        â”€â”€â”€â–º    All nodes: &quot;A&quot; (or &quot;B&quot;)            â”‚   â”‚
â”‚  â”‚   Node 3: &quot;A&quot;                                                   â”‚   â”‚
â”‚  â”‚   Node 4: &quot;C&quot;                                                   â”‚   â”‚
â”‚  â”‚   Node 5: (failed)                                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Use Cases:                                                            â”‚
â”‚  - Leader election: Who is the leader?                                 â”‚
â”‚  - Distributed locks: Who acquired the lock?                           â”‚
â”‚  - Distributed DB: What order to commit transactions?                  â”‚
â”‚  - State machine replication: What command to execute?                 â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="properties-of-consensus">Properties of Consensus<a class="header-link" href="#properties-of-consensus" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Required</span><span class="w"> </span><span class="nv">Properties</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">Consensus</span><span class="w"> </span><span class="nv">Algorithms</span><span class="w">         </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="mi">1</span>.<span class="w"> </span><span class="nv">Safety</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Nothing</span><span class="w"> </span><span class="nv">bad</span><span class="w"> </span><span class="nv">happens</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Agreement</span>:<span class="w">                                                      </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">All</span><span class="w"> </span><span class="nv">correct</span><span class="w"> </span><span class="nv">nodes</span><span class="w"> </span><span class="nv">agree</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">value</span><span class="w">                    </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Two</span><span class="w"> </span><span class="nv">nodes</span><span class="w"> </span><span class="nv">must</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">decide</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">different</span><span class="w"> </span><span class="nv">values</span><span class="w">                </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Validity</span>:<span class="w">                                                       </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">The</span><span class="w"> </span><span class="nv">decided</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">must</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">some</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="nv">proposed</span><span class="w">        </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Cannot</span><span class="w"> </span><span class="nv">select</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">proposed</span><span class="w">                        </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Integrity</span>:<span class="w">                                                      </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Each</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="nv">decides</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">most</span><span class="w"> </span><span class="nv">once</span><span class="w">                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Once</span><span class="w"> </span><span class="nv">decided</span>,<span class="w"> </span><span class="nv">cannot</span><span class="w"> </span><span class="nv">change</span><span class="w">                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="mi">2</span>.<span class="w"> </span><span class="nv">Liveness</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Good</span><span class="w"> </span><span class="nv">things</span><span class="w"> </span><span class="nv">eventually</span><span class="w"> </span><span class="nv">happen</span><span class="w">                           </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Termination</span>:<span class="w">                                                    </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">All</span><span class="w"> </span><span class="nv">correct</span><span class="w"> </span><span class="nv">nodes</span><span class="w"> </span><span class="nv">eventually</span><span class="w"> </span><span class="nv">decide</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">value</span><span class="w">               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Don</span><span class="err">&#39;t wait forever                                           â”‚   â”‚</span>
<span class="err">â”‚  â”‚                                                                  â”‚   â”‚</span>
<span class="err">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span>
<span class="err">â”‚                                                                         â”‚</span>
<span class="err">â”‚  FLP Impossibility (1985):                                             â”‚</span>
<span class="err">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span>
<span class="err">â”‚  â”‚  It is impossible to guarantee both Safety and Liveness in     â”‚   â”‚</span>
<span class="err">â”‚  â”‚  an asynchronous system while tolerating even a single         â”‚   â”‚</span>
<span class="err">â”‚  â”‚  node failure.                                                   â”‚   â”‚</span>
<span class="err">â”‚  â”‚                                                                  â”‚   â”‚</span>
<span class="err">â”‚  â”‚  Real system responses:                                         â”‚   â”‚</span>
<span class="err">â”‚  â”‚  - Sacrifice some Liveness (retry after timeout)                â”‚   â”‚</span>
<span class="err">â”‚  â”‚  - Add synchrony assumptions (partial synchrony)               â”‚   â”‚</span>
<span class="err">â”‚  â”‚  - Safety is always guaranteed                                  â”‚   â”‚</span>
<span class="err">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span>
<span class="err">â”‚                                                                         â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="failure-models">Failure Models<a class="header-link" href="#failure-models" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Model</th>
<th>Description</th>
<th>Required Nodes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Crash Failure</td>
<td>Node stops, can recover</td>
<td>2f + 1</td>
</tr>
<tr>
<td>Omission Failure</td>
<td>Messages can be lost</td>
<td>2f + 1</td>
</tr>
<tr>
<td>Byzantine Failure</td>
<td>Malicious/arbitrary behavior</td>
<td>3f + 1</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2-paxos-algorithm">2. Paxos Algorithm<a class="header-link" href="#2-paxos-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="paxos-overview">Paxos Overview<a class="header-link" href="#paxos-overview" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Paxos</span><span class="w"> </span><span class="nv">Algorithm</span><span class="w">                                     </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Invented</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">Leslie</span><span class="w"> </span><span class="nv">Lamport</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="mi">1989</span><span class="w"> </span><span class="ss">(</span><span class="nv">published</span><span class="w"> </span><span class="mi">1998</span><span class="ss">)</span><span class="w">                   </span>â”‚
â”‚<span class="w">  </span><span class="nv">The</span><span class="w"> </span><span class="nv">foundational</span><span class="w"> </span><span class="nv">algorithm</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">distributed</span><span class="w"> </span><span class="nv">consensus</span><span class="w">                   </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Roles</span>:<span class="w">                                                                </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Proposer</span><span class="w">                                                       </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Proposes</span><span class="w"> </span><span class="nv">values</span><span class="w">                                              </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Handles</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="nv">requests</span><span class="w">                                      </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Acceptor</span><span class="w">                                                       </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Votes</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">proposals</span><span class="w">                                           </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Decision</span><span class="w"> </span><span class="nv">made</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">majority</span><span class="w"> </span><span class="nv">accepts</span><span class="w">                          </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Stores</span><span class="w"> </span><span class="nv">state</span><span class="w">                                                 </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Learner</span><span class="w">                                                        </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Learns</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">decided</span><span class="w"> </span><span class="nv">value</span><span class="w">                                     </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Read</span><span class="o">-</span><span class="nv">only</span><span class="w"> </span><span class="nv">replica</span><span class="w">                                            </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">In</span><span class="w"> </span><span class="nv">practice</span>,<span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">play</span><span class="w"> </span><span class="nv">multiple</span><span class="w"> </span><span class="nv">roles</span><span class="ss">)</span><span class="w">                </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="basic-paxos-two-phases">Basic Paxos: Two Phases<a class="header-link" href="#basic-paxos-two-phases" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Basic Paxos: Phase 1 - Prepare                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Proposer                   Acceptors (majority needed)                â”‚
â”‚      â”‚                    A1      A2      A3                           â”‚
â”‚      â”‚                    â”‚       â”‚       â”‚                            â”‚
â”‚      â”‚â”€â”€â”€Prepare(n=1)â”€â”€â”€â”€â–ºâ”‚       â”‚       â”‚                            â”‚
â”‚      â”‚â”€â”€â”€Prepare(n=1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚       â”‚                            â”‚
â”‚      â”‚â”€â”€â”€Prepare(n=1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
â”‚      â”‚                    â”‚       â”‚       â”‚                            â”‚
â”‚      â”‚                    â”‚       â”‚       â”‚                            â”‚
â”‚      â”‚â—„â”€â”€Promise(n=1)â”€â”€â”€â”€â”‚       â”‚       â”‚                            â”‚
â”‚      â”‚â—„â”€â”€Promise(n=1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚                            â”‚
â”‚      â”‚â—„â”€â”€Promise(n=1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
â”‚      â”‚                    â”‚       â”‚       â”‚                            â”‚
â”‚                                                                         â”‚
â”‚  Prepare(n): &quot;I intend to propose with proposal number n&quot;              â”‚
â”‚  Promise(n): &quot;I will ignore proposals smaller than n&quot;                  â”‚
â”‚              + return any previously accepted value                    â”‚
â”‚                                                                         â”‚
â”‚  Acceptor Rules:                                                       â”‚
â”‚  - If received n &gt; existing promised_n, send Promise                   â”‚
â”‚  - Otherwise ignore/reject                                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Basic Paxos: Phase 2 - Accept                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  After receiving majority Promises:                                    â”‚
â”‚                                                                         â”‚
â”‚  Proposer                   Acceptors                                  â”‚
â”‚      â”‚                    A1      A2      A3                           â”‚
â”‚      â”‚                    â”‚       â”‚       â”‚                            â”‚
â”‚      â”‚â”€â”€Accept(n=1,v=&quot;X&quot;)â”€â–ºâ”‚       â”‚       â”‚                            â”‚
â”‚      â”‚â”€â”€Accept(n=1,v=&quot;X&quot;)â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚       â”‚                            â”‚
â”‚      â”‚â”€â”€Accept(n=1,v=&quot;X&quot;)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
â”‚      â”‚                    â”‚       â”‚       â”‚                            â”‚
â”‚      â”‚â—„â”€â”€Accepted(n=1)â”€â”€â”€â”€â”‚       â”‚       â”‚                            â”‚
â”‚      â”‚â—„â”€â”€Accepted(n=1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚                            â”‚
â”‚      â”‚â—„â”€â”€Accepted(n=1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
â”‚      â”‚                    â”‚       â”‚       â”‚                            â”‚
â”‚      â–¼                                                                  â”‚
â”‚  Majority Accepted â†’ Value &quot;X&quot; decided!                                â”‚
â”‚                                                                         â”‚
â”‚  Accept(n, v): &quot;Please accept value v with proposal number n&quot;          â”‚
â”‚  Accepted(n): &quot;Accepted&quot;                                               â”‚
â”‚                                                                         â”‚
â”‚  Value Selection Rule:                                                 â”‚
â”‚  - If a previous value was received in Promise, use the one with      â”‚
â”‚    the highest n                                                       â”‚
â”‚  - Otherwise propose your own value                                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="paxos-conflict-resolution">Paxos Conflict Resolution<a class="header-link" href="#paxos-conflict-resolution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Paxos: Concurrent Proposal Handling                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Scenario: Two Proposers propose simultaneously                        â”‚
â”‚                                                                         â”‚
â”‚  Proposer1     Proposer2          Acceptors                            â”‚
â”‚      â”‚             â”‚            A1      A2      A3                     â”‚
â”‚      â”‚             â”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚â”€Prepare(1)â”€â–ºâ”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚â”€Prepare(2)â”€â–ºâ”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚â—„â”€Promise(1)â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚       â”‚   A1: n=1          â”‚
â”‚      â”‚             â”‚â—„â”€Promise(2)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚   A2: n=2          â”‚
â”‚      â”‚             â”‚â—„â”€Promise(2)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   A3: n=2          â”‚
â”‚      â”‚             â”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚â”€Accept(1,X)â–ºâ”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚             X NACK! (n=1 &lt; promised n=2)          â”‚
â”‚      â”‚             â”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚â”€Accept(2,Y)â–ºâ”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚â—„â”€Acceptedâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚â—„â”€Acceptedâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
â”‚      â”‚             â”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â–¼             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚         Value &quot;Y&quot; decided â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚             â”‚       â”‚       â”‚                     â”‚
â”‚      â”‚             â”‚             â”‚       â”‚       â”‚                     â”‚
â”‚  Proposer1 needs to retry with higher n                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="multi-paxos">Multi-Paxos<a class="header-link" href="#multi-paxos" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Multi</span><span class="o">-</span><span class="nv">Paxos</span><span class="w">                                         </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Basic</span><span class="w"> </span><span class="nv">Paxos</span><span class="w"> </span><span class="nv">Problem</span>:<span class="w"> </span><span class="nv">Prepare</span><span class="w"> </span><span class="nv">needed</span><span class="w"> </span><span class="nv">every</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="ss">(</span><span class="mi">2</span><span class="w"> </span><span class="nv">RTT</span><span class="ss">)</span><span class="w">                </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Multi</span><span class="o">-</span><span class="nv">Paxos</span><span class="w"> </span><span class="nv">Optimization</span>:<span class="w">                                             </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Elect</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">stable</span><span class="w"> </span><span class="nv">leader</span><span class="w">                                               </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Leader</span><span class="w"> </span><span class="nv">decides</span><span class="w"> </span><span class="nv">consecutive</span><span class="w"> </span><span class="nv">values</span><span class="w">                                   </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Skip</span><span class="w"> </span><span class="nv">Prepare</span><span class="w"> </span><span class="nv">phase</span><span class="w"> </span><span class="ss">(</span><span class="mi">1</span><span class="w"> </span><span class="nv">RTT</span><span class="ss">)</span><span class="w">                                          </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Leader</span><span class="w">           </span><span class="nv">Acceptors</span><span class="w">                                      </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">           </span><span class="nv">A1</span><span class="w">      </span><span class="nv">A2</span><span class="w">      </span><span class="nv">A3</span><span class="w">                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">            </span>â”‚<span class="w">       </span>â”‚<span class="w">       </span>â”‚<span class="w">                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚â”€â”€<span class="nv">Prepare</span><span class="ss">(</span><span class="nv">n</span><span class="o">=</span><span class="mi">1</span><span class="ss">)</span>â”€â”€â”€â”€â–ºâ”‚<span class="w">       </span>â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">only</span><span class="w"> </span><span class="nv">once</span><span class="w"> </span><span class="nv">initially</span><span class="ss">)</span><span class="w">        </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚â—„â”€<span class="nv">Promise</span><span class="ss">(</span><span class="nv">n</span><span class="o">=</span><span class="mi">1</span><span class="ss">)</span>â”€â”€â”€â”€â”€â”‚<span class="w">       </span>â”‚<span class="w">                                </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">            </span>â”‚<span class="w">       </span>â”‚<span class="w">       </span>â”‚<span class="w">                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">            </span>â”‚<span class="w">       </span>â”‚<span class="w">       </span>â”‚<span class="w">                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚â”€â”€<span class="nv">Accept</span><span class="ss">(</span><span class="mi">1</span>,<span class="nv">v1</span><span class="ss">)</span>â”€â”€â”€â”€â–ºâ”‚<span class="w">       </span>â”‚<span class="w">  </span><span class="nv">Log</span><span class="w"> </span><span class="nv">Entry</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚â—„â”€<span class="nv">Accepted</span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">       </span>â”‚<span class="w">                                </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">            </span>â”‚<span class="w">       </span>â”‚<span class="w">       </span>â”‚<span class="w">                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚â”€â”€<span class="nv">Accept</span><span class="ss">(</span><span class="mi">1</span>,<span class="nv">v2</span><span class="ss">)</span>â”€â”€â”€â”€â–ºâ”‚<span class="w">       </span>â”‚<span class="w">  </span><span class="nv">Log</span><span class="w"> </span><span class="nv">Entry</span><span class="w"> </span><span class="mi">2</span><span class="w">                   </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚â—„â”€<span class="nv">Accepted</span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">       </span>â”‚<span class="w">                                </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">            </span>â”‚<span class="w">       </span>â”‚<span class="w">       </span>â”‚<span class="w">                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚â”€â”€<span class="nv">Accept</span><span class="ss">(</span><span class="mi">1</span>,<span class="nv">v3</span><span class="ss">)</span>â”€â”€â”€â”€â–ºâ”‚<span class="w">       </span>â”‚<span class="w">  </span><span class="nv">Log</span><span class="w"> </span><span class="nv">Entry</span><span class="w"> </span><span class="mi">3</span><span class="w">                   </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚â—„â”€<span class="nv">Accepted</span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">       </span>â”‚<span class="w">                                </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">    </span>â”‚<span class="w">            </span>â”‚<span class="w">       </span>â”‚<span class="w">       </span>â”‚<span class="w">                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="k">While</span><span class="w"> </span><span class="nv">leader</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">stable</span>,<span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">Accept</span><span class="w"> </span><span class="nv">repeats</span><span class="w"> </span><span class="ss">(</span><span class="mi">1</span><span class="w"> </span><span class="nv">RTT</span><span class="ss">)</span><span class="w">            </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="3-raft-algorithm">3. Raft Algorithm<a class="header-link" href="#3-raft-algorithm" title="Permanent link">&para;</a></h2>
<h3 id="raft-overview">Raft Overview<a class="header-link" href="#raft-overview" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Raft Algorithm                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  &quot;In Search of an Understandable Consensus Algorithm&quot; (2014)           â”‚
â”‚  Diego Ongaro, John Ousterhout                                         â”‚
â”‚                                                                         â”‚
â”‚  Design Goal: An understandable consensus algorithm                    â”‚
â”‚  - Same performance/safety as Paxos                                    â”‚
â”‚  - Much easier to understand                                           â”‚
â”‚                                                                         â”‚
â”‚  Key Concept Separation:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Leader Election                                              â”‚   â”‚
â”‚  â”‚  2. Log Replication                                              â”‚   â”‚
â”‚  â”‚  3. Safety                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Node States:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚           Timeout           Majority vote                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”€â”€â”€â”€â”€â”€â”€â–º   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”€â”€â”€â”€â”€â”€â–º   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚Followerâ”‚              â”‚ Candidate  â”‚             â”‚ Leader â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â—„â”€â”€â”€â”€â”€â”€â”€   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â—„â”€â”€â”€â”€â”€â”€   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚              Higher Term        Timeout     Higher Term         â”‚   â”‚
â”‚  â”‚                                (re-election)                     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="term">Term<a class="header-link" href="#term" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Raft: Term                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Term: Logical time unit                                               â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   Term 1    â”‚   Term 2    â”‚  Term 3  â”‚    Term 4    â”‚           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚   â”‚
â”‚  â”‚  â”‚Electionâ”‚  â”‚  â”‚Electionâ”‚  â”‚  â”‚Elecâ”‚  â”‚  â”‚Election â”‚ â”‚           â”‚   â”‚
â”‚  â”‚  â”‚       â”‚  â”‚  â”‚       â”‚  â”‚  â”‚failâ”‚  â”‚  â”‚         â”‚ â”‚           â”‚   â”‚
â”‚  â”‚  â”‚Node 1 â”‚  â”‚  â”‚Node 3 â”‚  â”‚  â”‚    â”‚  â”‚  â”‚ Node 2  â”‚ â”‚           â”‚   â”‚
â”‚  â”‚  â”‚Leader â”‚  â”‚  â”‚Leader â”‚  â”‚  â”‚    â”‚  â”‚  â”‚ Leader  â”‚ â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚   â”‚
â”‚  â”‚             â”‚             â”‚          â”‚              â”‚           â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–º      â”‚   â”‚
â”‚  â”‚                                                       Time      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Term Rules:                                                           â”‚
â”‚  - At most one leader per Term                                         â”‚
â”‚  - Term starts: new election begins                                    â”‚
â”‚  - On discovering higher Term, immediately become Follower             â”‚
â”‚  - Ignore messages from older Terms                                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="leader-election">Leader Election<a class="header-link" href="#leader-election" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Raft</span>:<span class="w"> </span><span class="nv">Leader</span><span class="w"> </span><span class="nv">Election</span><span class="w">                               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Step</span><span class="w"> </span><span class="mi">1</span>:<span class="w"> </span><span class="nv">Election</span><span class="w"> </span><span class="nb">Timeout</span><span class="w">                                              </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Node</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="ss">(</span><span class="nv">Follower</span><span class="ss">)</span><span class="w">                                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”‚<span class="w">                                                               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º<span class="w">                 </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”‚<span class="w">           </span><span class="nv">No</span><span class="w"> </span><span class="nv">heartbeat</span><span class="w"> </span><span class="ss">(</span><span class="mi">150</span><span class="o">-</span><span class="mi">300</span><span class="nv">ms</span><span class="ss">)</span><span class="w">         </span>â”‚<span class="w">                 </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”‚<span class="w">                                             </span>â–¼<span class="w">                 </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”‚<span class="w">                                      </span><span class="nb">Timeout</span><span class="o">!</span><span class="w">                </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span>â”‚<span class="w">                                      </span>â†’<span class="w"> </span><span class="nv">Become</span><span class="w"> </span><span class="nv">Candidate</span><span class="w">      </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Step</span><span class="w"> </span><span class="mi">2</span>:<span class="w"> </span><span class="nv">Request</span><span class="w"> </span><span class="nv">Vote</span><span class="w">                                                  </span>â”‚
â”‚<span class="w">  </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Node</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span><span class="ss">(</span><span class="nv">Candidate</span><span class="ss">)</span><span class="w">              </span><span class="nv">Node</span><span class="w"> </span><span class="nv">B</span><span class="w">        </span><span class="nv">Node</span><span class="w"> </span><span class="nv">C</span><span class="w">            </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">term</span>:<span class="w"> </span><span class="mi">2</span><span class="w">                         </span><span class="nv">term</span>:<span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="nv">term</span>:<span class="w"> </span><span class="mi">1</span><span class="w">           </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">       </span>â”‚<span class="w">                            </span>â”‚<span class="w">             </span>â”‚<span class="w">               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">       </span>â”‚â”€â”€<span class="w"> </span><span class="nv">RequestVote</span><span class="ss">(</span><span class="nv">term</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span><span class="w"> </span>â”€â”€â”€â”€â–ºâ”‚<span class="w">             </span>â”‚<span class="w">               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">       </span>â”‚â”€â”€<span class="w"> </span><span class="nv">RequestVote</span><span class="ss">(</span><span class="nv">term</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚<span class="w">               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">       </span>â”‚<span class="w">                            </span>â”‚<span class="w">             </span>â”‚<span class="w">               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">       </span>â”‚â—„â”€â”€<span class="w"> </span><span class="nv">VoteGranted</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">             </span>â”‚<span class="w">               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">       </span>â”‚â—„â”€â”€<span class="w"> </span><span class="nv">VoteGranted</span><span class="w"> </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<span class="w">               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">       </span>â”‚<span class="w">                            </span>â”‚<span class="w">             </span>â”‚<span class="w">               </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">       </span>â–¼<span class="w">                                                          </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">  </span><span class="nv">Majority</span><span class="w"> </span><span class="ss">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="ss">)</span><span class="w"> </span><span class="nv">achieved</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">Leader</span><span class="w"> </span><span class="nv">elected</span><span class="o">!</span><span class="w">                       </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â”‚<span class="w">                                                                  </span>â”‚<span class="w">   </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<span class="w">   </span>â”‚
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Voting</span><span class="w"> </span><span class="nv">Rules</span>:<span class="w">                                                         </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Vote</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">most</span><span class="w"> </span><span class="nv">once</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">Term</span><span class="w">                                          </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Only</span><span class="w"> </span><span class="nv">vote</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">requester</span><span class="err">&#39;s log is at least as up-to-date             â”‚</span>
<span class="err">â”‚  - Reset timer after voting                                            â”‚</span>
<span class="err">â”‚                                                                         â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="log-replication">Log Replication<a class="header-link" href="#log-replication" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                     </span><span class="nv">Raft</span>:<span class="w"> </span><span class="nv">Log</span><span class="w"> </span><span class="nv">Replication</span><span class="w">                               </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">                                                                         </span>â”‚
â”‚<span class="w">  </span><span class="nv">Leader</span><span class="err">&#39;s Log:                                                         â”‚</span>
<span class="err">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span>
<span class="err">â”‚  â”‚  Index:  1       2       3       4       5       6              â”‚   â”‚</span>
<span class="err">â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                   â”‚   â”‚</span>
<span class="err">â”‚  â”‚  Term: â”‚  1  â”‚  1  â”‚  2  â”‚  2  â”‚  2  â”‚  3  â”‚                   â”‚   â”‚</span>
<span class="err">â”‚  â”‚        â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                   â”‚   â”‚</span>
<span class="err">â”‚  â”‚  Cmd:  â”‚ x=1 â”‚ y=2 â”‚ x=3 â”‚ z=1 â”‚ y=4 â”‚ x=5 â”‚                   â”‚   â”‚</span>
<span class="err">â”‚  â”‚        â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚</span>
<span class="err">â”‚  â”‚                                  â–²                              â”‚   â”‚</span>
<span class="err">â”‚  â”‚                              commitIndex                        â”‚   â”‚</span>
<span class="err">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span>
<span class="err">â”‚                                                                         â”‚</span>
<span class="err">â”‚  Replication Process:                                                  â”‚</span>
<span class="err">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span>
<span class="err">â”‚  â”‚                                                                  â”‚   â”‚</span>
<span class="err">â”‚  â”‚  Leader              Follower 1        Follower 2               â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚                     â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚  AppendEntries      â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚  (term, prevLogIdx, â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚   prevLogTerm,      â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚   entries[])        â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚                     â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚â—„â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚â—„â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚                     â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚  Majority replicated                  â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚  â†’ Increment commitIndex              â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚  â†’ Apply to state machine             â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚                     â”‚                 â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚  Next AppendEntries includes commitIndex                   â”‚   â”‚</span>
<span class="err">â”‚  â”‚    â”‚  â†’ Followers also commit              â”‚                    â”‚   â”‚</span>
<span class="err">â”‚  â”‚                                                                  â”‚   â”‚</span>
<span class="err">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span>
<span class="err">â”‚                                                                         â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="log-consistency">Log Consistency<a class="header-link" href="#log-consistency" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Raft: Log Consistency                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Log Matching Property:                                                â”‚
â”‚  - Same index, same term â†’ same command                                â”‚
â”‚  - Same index, same term â†’ all previous entries identical              â”‚
â”‚                                                                         â”‚
â”‚  On Inconsistency:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Leader:   [1,1] [1,2] [2,3] [3,4] [3,5] [3,6]                  â”‚   â”‚
â”‚  â”‚  Follower: [1,1] [1,2] [2,3] [2,4] [2,5]                        â”‚   â”‚
â”‚  â”‚                              â–²                                  â”‚   â”‚
â”‚  â”‚                          Divergence point                       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Resolution: Leader overwrites Follower log to match            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  1. AppendEntries(prevLogIdx=3, prevLogTerm=2) fails            â”‚   â”‚
â”‚  â”‚  2. Decrement nextIndex and retry                               â”‚   â”‚
â”‚  â”‚  3. Find match point (index=3)                                  â”‚   â”‚
â”‚  â”‚  4. Overwrite from index 4 with Leader&#39;s log                    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Result:                                                         â”‚   â”‚
â”‚  â”‚  Follower: [1,1] [1,2] [2,3] [3,4] [3,5] [3,6]                  â”‚   â”‚
â”‚  â”‚            (identical to Leader)                                 â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="raft-vs-paxos">Raft vs Paxos<a class="header-link" href="#raft-vs-paxos" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Raft</th>
<th>Paxos</th>
</tr>
</thead>
<tbody>
<tr>
<td>Understandability</td>
<td>High</td>
<td>Low</td>
</tr>
<tr>
<td>Leader Role</td>
<td>Clear (strong leader)</td>
<td>Flexible</td>
</tr>
<tr>
<td>Log Order</td>
<td>Sequential</td>
<td>Gaps possible</td>
</tr>
<tr>
<td>Implementation Complexity</td>
<td>Low</td>
<td>High</td>
</tr>
<tr>
<td>Paper Clarity</td>
<td>Detailed</td>
<td>Abstract</td>
</tr>
<tr>
<td>Use Cases</td>
<td>etcd, CockroachDB</td>
<td>Chubby, Spanner</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4-byzantine-fault-tolerance">4. Byzantine Fault Tolerance<a class="header-link" href="#4-byzantine-fault-tolerance" title="Permanent link">&para;</a></h2>
<h3 id="byzantine-generals-problem">Byzantine Generals Problem<a class="header-link" href="#byzantine-generals-problem" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Byzantine Generals Problem                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Situation: N generals must decide to attack/retreat                   â”‚
â”‚             Some generals may be traitors                               â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚   â”‚
â”‚  â”‚                    â”‚ General 1â”‚                                  â”‚   â”‚
â”‚  â”‚                    â”‚ (traitor)â”‚                                  â”‚   â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                  â”‚   â”‚
â”‚  â”‚                         â”‚                                        â”‚   â”‚
â”‚  â”‚           &quot;Attack&quot;      â”‚       &quot;Retreat&quot;                        â”‚   â”‚
â”‚  â”‚              â–¼                    â–¼                              â”‚   â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚  â”‚       â”‚ General 2â”‚         â”‚ General 3â”‚                         â”‚   â”‚
â”‚  â”‚       â”‚ (loyal)  â”‚         â”‚ (loyal)  â”‚                         â”‚   â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Gen 2: &quot;#1 said attack&quot; / Gen 3: &quot;#1 said retreat&quot;             â”‚   â”‚
â”‚  â”‚  â†’ Loyal generals can make different decisions!                  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Solution: With 3f + 1 generals, can tolerate f traitors               â”‚
â”‚  Example: 4 generals â†’ tolerate 1 traitor                              â”‚
â”‚           7 generals â†’ tolerate 2 traitors                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="pbft-practical-byzantine-fault-tolerance">PBFT (Practical Byzantine Fault Tolerance)<a class="header-link" href="#pbft-practical-byzantine-fault-tolerance" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PBFT Algorithm                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  3-Phase Protocol: Pre-Prepare â†’ Prepare â†’ Commit                      â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Client     Primary     Replica 1    Replica 2    Replica 3     â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚â”€â”€Requestâ”€â”€â–ºâ”‚            â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚â”€Pre-Prepareâ”€â–ºâ”‚           â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚â”€Pre-Prepareâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚â”€Pre-Prepareâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚â—„â”€â”€Prepareâ”€â”€â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚â”€â”€â”€â”€Prepareâ”€â–ºâ”‚â—„â”€Prepareâ”€â”€â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚â”€â”€â”€â”€Prepareâ”€â”€â–ºâ—„â”€Prepareâ”€â”€â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚            â”‚â”€â”€â”€â”€Prepareâ”€â–ºâ”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚â—„â”€â”€â”€Commitâ”€â”€â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚â”€â”€â”€â”€Commitâ”€â”€â–ºâ”‚â—„â”€â”€Commitâ”€â”€â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚â”€â”€â”€â”€Commitâ”€â”€â”€â–ºâ—„â”€â”€Commitâ”€â”€â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚            â”‚â”€â”€â”€â”€Commitâ”€â”€â–ºâ”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚â—„â”€â”€Replyâ”€â”€â”€â”‚            â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚â—„â”€â”€Replyâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚â—„â”€â”€Replyâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚            â”‚         â”‚   â”‚
â”‚  â”‚    â”‚â—„â”€â”€Replyâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚         â”‚   â”‚
â”‚  â”‚    â”‚           â”‚            â”‚            â”‚            â”‚         â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Client accepts result when receiving f+1 identical Replies     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Complexity: O(nÂ²) messages                                            â”‚
â”‚  Limitation: Low scalability (typically ~20 nodes)                     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="bft-applications">BFT Applications<a class="header-link" href="#bft-applications" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Domain</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td>Blockchain</td>
<td>Tendermint, Hyperledger Fabric</td>
</tr>
<tr>
<td>Aviation/Space</td>
<td>Flight control systems</td>
</tr>
<tr>
<td>Finance</td>
<td>High-availability trading systems</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5-practical-applications">5. Practical Applications<a class="header-link" href="#5-practical-applications" title="Permanent link">&para;</a></h2>
<h3 id="zookeeper-zab">ZooKeeper (ZAB)<a class="header-link" href="#zookeeper-zab" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                     </span><span class="n">ZooKeeper</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ZAB</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">ZAB</span><span class="w"> </span><span class="p">(</span><span class="n">ZooKeeper</span><span class="w"> </span><span class="n">Atomic</span><span class="w"> </span><span class="n">Broadcast</span><span class="p">):</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Paxos</span><span class="w"> </span><span class="n">variant</span><span class="w">                                                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Leader</span><span class="o">-</span><span class="n">based</span><span class="w">                                                        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="n">guaranteed</span><span class="w">                                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Data</span><span class="w"> </span><span class="n">Model</span><span class="p">:</span><span class="w">                                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="o">/</span><span class="w">                        </span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="w">                                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="o">/</span><span class="n">config</span><span class="w">             </span><span class="n">Configuration</span><span class="w"> </span><span class="n">data</span><span class="w">                     </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">db</span><span class="w">      </span><span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhost&quot;</span><span class="p">}</span><span class="w">                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="o">/</span><span class="n">locks</span><span class="w">              </span><span class="n">Distributed</span><span class="w"> </span><span class="n">locks</span><span class="w">                      </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="o">/</span><span class="n">locks</span><span class="o">/</span><span class="n">job1</span><span class="w">     </span><span class="p">(</span><span class="n">ephemeral</span><span class="p">)</span><span class="w">                            </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="o">/</span><span class="n">leader</span><span class="w">             </span><span class="n">Leader</span><span class="w"> </span><span class="n">election</span><span class="w">                        </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">      </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="o">/</span><span class="n">leader</span><span class="o">/</span><span class="n">node</span><span class="o">-</span><span class="mi">1</span><span class="w">  </span><span class="p">(</span><span class="n">ephemeral</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sequential</span><span class="p">)</span><span class="w">               </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Node</span><span class="w"> </span><span class="n">Types</span><span class="p">:</span><span class="w">                                                     </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Persistent</span><span class="p">:</span><span class="w"> </span><span class="n">Remains</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">explicitly</span><span class="w"> </span><span class="n">deleted</span><span class="w">                 </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Ephemeral</span><span class="p">:</span><span class="w"> </span><span class="n">Auto</span><span class="o">-</span><span class="n">deleted</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="n">end</span><span class="w">                       </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Sequential</span><span class="p">:</span><span class="w"> </span><span class="n">Auto</span><span class="o">-</span><span class="n">incrementing</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">assigned</span><span class="w">                </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">                                                                  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Usage</span><span class="p">:</span><span class="w">                                                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Kafka</span><span class="p">:</span><span class="w"> </span><span class="n">Broker</span><span class="w"> </span><span class="n">coordination</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="n">metadata</span><span class="w">                          </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">HBase</span><span class="p">:</span><span class="w"> </span><span class="n">Master</span><span class="w"> </span><span class="n">election</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="n">assignment</span><span class="w">                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Hadoop</span><span class="p">:</span><span class="w"> </span><span class="n">HA</span><span class="w"> </span><span class="n">NameNode</span><span class="w">                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                         </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="etcd-raft">etcd (Raft)<a class="header-link" href="#etcd-raft" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     etcd                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Features:                                                             â”‚
â”‚  - Raft consensus algorithm                                            â”‚
â”‚  - Key-value store                                                     â”‚
â”‚  - gRPC API                                                            â”‚
â”‚  - Watch capability                                                    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Kubernetes Control Plane                                        â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ API Server  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚        etcd Cluster     â”‚            â”‚   â”‚
â”‚  â”‚  â”‚             â”‚         â”‚                         â”‚            â”‚   â”‚
â”‚  â”‚  â”‚             â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ - Pods      â”‚         â”‚  â”‚etcd1â”‚ â”‚etcd2â”‚ â”‚etcd3â”‚â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ - Services  â”‚         â”‚  â”‚Raft â”‚ â”‚Raft â”‚ â”‚Raft â”‚â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ - ConfigMapsâ”‚         â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Usage Examples:                                                       â”‚
â”‚  ```                                                                   â”‚
â”‚  # Store key                                                           â”‚
â”‚  etcdctl put /config/db/host &quot;localhost&quot;                              â”‚
â”‚                                                                         â”‚
â”‚  # Get key                                                             â”‚
â”‚  etcdctl get /config/db/host                                          â”‚
â”‚                                                                         â”‚
â”‚  # Watch (detect changes)                                              â”‚
â”‚  etcdctl watch /config/db/                                            â”‚
â”‚                                                                         â”‚
â”‚  # Check leader                                                        â”‚
â”‚  etcdctl endpoint status                                               â”‚
â”‚  ```                                                                   â”‚
â”‚                                                                         â”‚
â”‚  Applications:                                                         â”‚
â”‚  - Kubernetes: Cluster state storage                                   â”‚
â”‚  - Service Discovery: Consul alternative                               â”‚
â”‚  - Feature Flags: Dynamic configuration                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="consul">Consul<a class="header-link" href="#consul" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Consul                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Features:                                                             â”‚
â”‚  - Raft consensus algorithm                                            â”‚
â”‚  - Service discovery                                                   â”‚
â”‚  - Health checking                                                     â”‚
â”‚  - KV store                                                            â”‚
â”‚  - Multi-datacenter                                                    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   DC1 (Primary)                   DC2 (Secondary)                â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚   â”‚  Consul Servers â”‚â—„â”€â”€WANâ”€â”€â”€â”€â–ºâ”‚  Consul Servers â”‚            â”‚   â”‚
â”‚  â”‚   â”‚  (3 nodes, Raft)â”‚  Gossip    â”‚  (3 nodes, Raft)â”‚            â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚            â”‚                              â”‚                      â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚     â”‚             â”‚                â”‚             â”‚              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”´â”€â”€â”       â”Œâ”€â”€â”´â”€â”€â”          â”Œâ”€â”€â”´â”€â”€â”       â”Œâ”€â”€â”´â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚Agentâ”‚       â”‚Agentâ”‚          â”‚Agentâ”‚       â”‚Agentâ”‚          â”‚   â”‚
â”‚  â”‚  â”‚Svc Aâ”‚       â”‚Svc Bâ”‚          â”‚Svc Aâ”‚       â”‚Svc Câ”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Key Features:                                                         â”‚
â”‚  - DNS-based service discovery: service.consul                         â”‚
â”‚  - Distributed locks: Consul Sessions                                  â”‚
â”‚  - Leader election: consul lock                                        â”‚
â”‚  - Configuration management: Consul KV + Template                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="tool-comparison">Tool Comparison<a class="header-link" href="#tool-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>ZooKeeper</th>
<th>etcd</th>
<th>Consul</th>
</tr>
</thead>
<tbody>
<tr>
<td>Consensus Algorithm</td>
<td>ZAB (Paxos variant)</td>
<td>Raft</td>
<td>Raft</td>
</tr>
<tr>
<td>Data Model</td>
<td>Hierarchical (filesystem)</td>
<td>Flat KV</td>
<td>Flat KV</td>
</tr>
<tr>
<td>Watch</td>
<td>O</td>
<td>O</td>
<td>O</td>
</tr>
<tr>
<td>Service Discovery</td>
<td>Manual implementation</td>
<td>Manual implementation</td>
<td>Built-in</td>
</tr>
<tr>
<td>Health Check</td>
<td>X</td>
<td>X</td>
<td>Built-in</td>
</tr>
<tr>
<td>Multi-DC</td>
<td>X</td>
<td>X</td>
<td>O</td>
</tr>
<tr>
<td>Language</td>
<td>Java</td>
<td>Go</td>
<td>Go</td>
</tr>
<tr>
<td>Primary Use Case</td>
<td>Hadoop, Kafka</td>
<td>Kubernetes</td>
<td>HashiCorp ecosystem</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6-practice-problems">6. Practice Problems<a class="header-link" href="#6-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="exercise-1-paxos-scenario">Exercise 1: Paxos Scenario<a class="header-link" href="#exercise-1-paxos-scenario" title="Permanent link">&para;</a></h3>
<p>Analyze the following scenario in a Paxos system with 5 Acceptors:
- Proposer 1 proposes "A" with n=1
- Proposer 2 proposes "B" with n=2
- Messages get reordered due to network delay
- What value gets selected in the end?</p>
<h3 id="exercise-2-raft-log-recovery">Exercise 2: Raft Log Recovery<a class="header-link" href="#exercise-2-raft-log-recovery" title="Permanent link">&para;</a></h3>
<p>Explain the log consistency recovery process in Raft for the following situation:</p>
<div class="highlight"><pre><span></span><code>Leader:   [1,1] [2,2] [2,3] [3,4] [3,5]
Follower: [1,1] [2,2] [2,3] [2,4]
</code></pre></div>

<h3 id="exercise-3-consensus-system-design">Exercise 3: Consensus System Design<a class="header-link" href="#exercise-3-consensus-system-design" title="Permanent link">&para;</a></h3>
<p>Design a distributed configuration management system with the following requirements:
- Deployed across 3 datacenters
- Continue service even with one DC failure
- Configuration changes propagate within milliseconds
- Optimize read performance</p>
<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>In <a href="./17_Design_Example_1.md">17_Design_Example_1.md</a>, let's practice designing URL shorteners, Pastebin, and Rate Limiters!</p>
<hr />
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>"Paxos Made Simple" - Leslie Lamport</li>
<li>"In Search of an Understandable Consensus Algorithm (Raft)" - Diego Ongaro</li>
<li>"Practical Byzantine Fault Tolerance" - Castro, Liskov</li>
<li>etcd Documentation: etcd.io</li>
<li>ZooKeeper Documentation: zookeeper.apache.org</li>
<li>Consul Documentation: consul.io</li>
<li>Raft Visualization: raft.github.io</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/15_Distributed_Systems_Concepts.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">Distributed Systems Concepts</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/en/System_Design/17_Design_Example_1.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">Practical Design Examples 1</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}