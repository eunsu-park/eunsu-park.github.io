{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20. Search Systems - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/en/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/en/System_Design/">System Design</a>
    <span class="separator">/</span>
    <span class="current">20. Search Systems</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>20. Search Systems</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/19_Observability_Monitoring.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">19. Observability and Monitoring</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-search-engine-fundamentals">1. Search Engine Fundamentals</a><ul>
<li><a href="#11-search-system-components">1.1 Search System Components</a></li>
<li><a href="#12-full-text-search-vs-database-search">1.2 Full-Text Search vs Database Search</a></li>
</ul>
</li>
<li><a href="#2-inverted-index">2. Inverted Index</a><ul>
<li><a href="#21-how-it-works">2.1 How It Works</a></li>
<li><a href="#22-text-analysis-pipeline">2.2 Text Analysis Pipeline</a></li>
<li><a href="#23-posting-list-with-positions">2.3 Posting List with Positions</a></li>
</ul>
</li>
<li><a href="#3-elasticsearch-architecture">3. Elasticsearch Architecture</a><ul>
<li><a href="#31-cluster-architecture">3.1 Cluster Architecture</a></li>
<li><a href="#32-index-shard-and-segment">3.2 Index, Shard, and Segment</a></li>
<li><a href="#33-write-and-read-paths">3.3 Write and Read Paths</a></li>
</ul>
</li>
<li><a href="#4-indexing-and-mapping">4. Indexing and Mapping</a><ul>
<li><a href="#41-index-creation">4.1 Index Creation</a></li>
<li><a href="#42-field-types">4.2 Field Types</a></li>
</ul>
</li>
<li><a href="#5-search-queries">5. Search Queries</a><ul>
<li><a href="#51-match-queries">5.1 Match Queries</a></li>
<li><a href="#52-boolean-queries">5.2 Boolean Queries</a></li>
<li><a href="#53-aggregations">5.3 Aggregations</a></li>
<li><a href="#54-autocomplete-suggestions">5.4 Autocomplete / Suggestions</a></li>
</ul>
</li>
<li><a href="#6-ranking-and-relevance">6. Ranking and Relevance</a><ul>
<li><a href="#61-bm25-scoring">6.1 BM25 Scoring</a></li>
<li><a href="#62-boosting-and-custom-scoring">6.2 Boosting and Custom Scoring</a></li>
<li><a href="#63-explain-api">6.3 Explain API</a></li>
</ul>
</li>
<li><a href="#7-scaling-search-systems">7. Scaling Search Systems</a><ul>
<li><a href="#71-shard-sizing-strategy">7.1 Shard Sizing Strategy</a></li>
<li><a href="#72-index-lifecycle-management-ilm">7.2 Index Lifecycle Management (ILM)</a></li>
<li><a href="#73-search-performance-optimization">7.3 Search Performance Optimization</a></li>
</ul>
</li>
<li><a href="#8-practice-problems">8. Practice Problems</a><ul>
<li><a href="#problem-1-e-commerce-search">Problem 1: E-Commerce Search</a></li>
<li><a href="#problem-2-log-search-platform">Problem 2: Log Search Platform</a></li>
<li><a href="#problem-3-autocomplete-system">Problem 3: Autocomplete System</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="20-search-systems">20. Search Systems<a class="header-link" href="#20-search-systems" title="Permanent link">&para;</a></h1>
<p>Difficulty: â­â­â­â­</p>
<h2 id="overview">Overview<a class="header-link" href="#overview" title="Permanent link">&para;</a></h2>
<p>Search is a fundamental component of most applications. This lesson covers how search engines work internally â€” from inverted indexes and text analysis to distributed search architecture and ranking algorithms. We focus primarily on Elasticsearch as the most widely adopted solution.</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="header-link" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-search-engine-fundamentals">Search Engine Fundamentals</a></li>
<li><a href="#2-inverted-index">Inverted Index</a></li>
<li><a href="#3-elasticsearch-architecture">Elasticsearch Architecture</a></li>
<li><a href="#4-indexing-and-mapping">Indexing and Mapping</a></li>
<li><a href="#5-search-queries">Search Queries</a></li>
<li><a href="#6-ranking-and-relevance">Ranking and Relevance</a></li>
<li><a href="#7-scaling-search-systems">Scaling Search Systems</a></li>
<li><a href="#8-practice-problems">Practice Problems</a></li>
</ol>
<hr />
<h2 id="1-search-engine-fundamentals">1. Search Engine Fundamentals<a class="header-link" href="#1-search-engine-fundamentals" title="Permanent link">&para;</a></h2>
<h3 id="11-search-system-components">1.1 Search System Components<a class="header-link" href="#11-search-system-components" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Search System Architecture                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Crawling / â”‚     â”‚  Indexing   â”‚     â”‚  Query Processing  â”‚   â”‚
â”‚  â”‚  Ingestion  â”‚â”€â”€â”€â”€â–¶â”‚  Pipeline   â”‚â”€â”€â”€â”€â–¶â”‚  &amp; Retrieval       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚                   â”‚                      â”‚              â”‚
â”‚       â–¼                   â–¼                      â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Fetch docs  â”‚     â”‚ Tokenize   â”‚     â”‚ Parse query        â”‚   â”‚
â”‚  â”‚ Extract textâ”‚     â”‚ Analyze    â”‚     â”‚ Match documents    â”‚   â”‚
â”‚  â”‚ Normalize   â”‚     â”‚ Build indexâ”‚     â”‚ Rank results       â”‚   â”‚
â”‚  â”‚ Detect lang â”‚     â”‚ Store      â”‚     â”‚ Highlight          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="12-full-text-search-vs-database-search">1.2 Full-Text Search vs Database Search<a class="header-link" href="#12-full-text-search-vs-database-search" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                      </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Database</span><span class="w"> </span><span class="p">(</span><span class="n">SQL</span><span class="p">)</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Search</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="p">(</span><span class="n">ES</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Primary</span><span class="w"> </span><span class="n">use</span><span class="w">          </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Transactional</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Search</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">analytics</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">model</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Structured</span><span class="w"> </span><span class="n">rows</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Semi</span><span class="o">-</span><span class="n">structured</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">language</span><span class="w">       </span><span class="err">â”‚</span><span class="w"> </span><span class="n">SQL</span><span class="w">                </span><span class="err">â”‚</span><span class="w"> </span><span class="n">DSL</span><span class="w"> </span><span class="p">(</span><span class="n">JSON</span><span class="p">)</span><span class="w">           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Text</span><span class="w"> </span><span class="n">matching</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="n">LIKE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">FTS</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Full</span><span class="o">-</span><span class="n">text</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facets</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Relevance</span><span class="w"> </span><span class="n">scoring</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Limited</span><span class="w">            </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Advanced</span><span class="w"> </span><span class="p">(</span><span class="n">BM25</span><span class="p">)</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Horizontal</span><span class="w"> </span><span class="n">scaling</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Complex</span><span class="w"> </span><span class="p">(</span><span class="n">sharding</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Native</span><span class="w"> </span><span class="p">(</span><span class="n">shards</span><span class="p">)</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Real</span><span class="o">-</span><span class="kt">time</span><span class="w"> </span><span class="n">updates</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ACID</span><span class="w"> </span><span class="n">guarantees</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Near</span><span class="w"> </span><span class="kt">real</span><span class="o">-</span><span class="kt">time</span><span class="w">       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Aggregations</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="n">GROUP</span><span class="w"> </span><span class="n">BY</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Rich</span><span class="w"> </span><span class="n">aggregations</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Consistency</span><span class="w">          </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Strong</span><span class="w">             </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Eventual</span><span class="w">             </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="2-inverted-index">2. Inverted Index<a class="header-link" href="#2-inverted-index" title="Permanent link">&para;</a></h2>
<h3 id="21-how-it-works">2.1 How It Works<a class="header-link" href="#21-how-it-works" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">              </span><span class="n">Inverted</span><span class="w"> </span><span class="k">Index</span><span class="w">                                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Documents</span><span class="p">:</span><span class="w">                                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Doc1</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;the quick brown fox&quot;</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Doc2</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;the lazy brown dog&quot;</span><span class="w">                                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Doc3</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;the quick dog jumps&quot;</span><span class="w">                                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Forward</span><span class="w"> </span><span class="k">Index</span><span class="err">:</span><span class="w">                    </span><span class="n">Inverted</span><span class="w"> </span><span class="k">Index</span><span class="err">:</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Doc1</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">the, quick, brown, fox</span><span class="o">]</span><span class="w">  </span><span class="n">brown</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Doc1, Doc2</span><span class="o">]</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Doc2</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">the, lazy, brown, dog</span><span class="o">]</span><span class="w">   </span><span class="n">dog</span><span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Doc2, Doc3</span><span class="o">]</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">Doc3</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">the, quick, dog, jumps</span><span class="o">]</span><span class="w">  </span><span class="n">fox</span><span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Doc1</span><span class="o">]</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="n">jumps</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Doc3</span><span class="o">]</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="n">lazy</span><span class="w">  </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Doc2</span><span class="o">]</span><span class="w">               </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="n">quick</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Doc1, Doc3</span><span class="o">]</span><span class="w">         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                   </span><span class="n">the</span><span class="w">   </span><span class="err">â†’</span><span class="w"> </span><span class="o">[</span><span class="n">Doc1, Doc2, Doc3</span><span class="o">]</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nl">Query</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;quick brown&quot;</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">quick</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">{</span><span class="n">Doc1</span><span class="p">,</span><span class="w"> </span><span class="n">Doc3</span><span class="err">}</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="n">brown</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="err">{</span><span class="n">Doc1</span><span class="p">,</span><span class="w"> </span><span class="n">Doc2</span><span class="err">}</span><span class="w">                                           </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="k">Intersection</span><span class="err">:</span><span class="w"> </span><span class="err">{</span><span class="n">Doc1</span><span class="err">}</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="k">result</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="ow">Union</span><span class="err">:</span><span class="w"> </span><span class="err">{</span><span class="n">Doc1</span><span class="p">,</span><span class="w"> </span><span class="n">Doc2</span><span class="p">,</span><span class="w"> </span><span class="n">Doc3</span><span class="err">}</span><span class="w"> </span><span class="err">â†</span><span class="w"> </span><span class="ow">OR</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="k">result</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                                                 </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="22-text-analysis-pipeline">2.2 Text Analysis Pipeline<a class="header-link" href="#22-text-analysis-pipeline" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Text Analysis Pipeline                              â”‚
â”‚                                                                 â”‚
â”‚  Input: &quot;The Quick Brown Foxes are JUMPING!&quot;                    â”‚
â”‚                                                                 â”‚
â”‚  1. Character Filters                                           â”‚
â”‚     â”œâ”€â”€ HTML strip: remove &lt;tags&gt;                               â”‚
â”‚     â””â”€â”€ Pattern replace: normalize chars                        â”‚
â”‚     Result: &quot;The Quick Brown Foxes are JUMPING!&quot;                â”‚
â”‚                                                                 â”‚
â”‚  2. Tokenizer                                                   â”‚
â”‚     â”œâ”€â”€ Standard: split on word boundaries                      â”‚
â”‚     â””â”€â”€ Result: [&quot;The&quot;, &quot;Quick&quot;, &quot;Brown&quot;, &quot;Foxes&quot;, &quot;are&quot;,      â”‚
â”‚                  &quot;JUMPING&quot;]                                     â”‚
â”‚                                                                 â”‚
â”‚  3. Token Filters                                               â”‚
â”‚     â”œâ”€â”€ Lowercase: &quot;the&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, ...       â”‚
â”‚     â”œâ”€â”€ Stop words: remove &quot;the&quot;, &quot;are&quot;                         â”‚
â”‚     â”œâ”€â”€ Stemmer: &quot;foxes&quot; â†’ &quot;fox&quot;, &quot;jumping&quot; â†’ &quot;jump&quot;           â”‚
â”‚     â””â”€â”€ Result: [&quot;quick&quot;, &quot;brown&quot;, &quot;fox&quot;, &quot;jump&quot;]              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="23-posting-list-with-positions">2.3 Posting List with Positions<a class="header-link" href="#23-posting-list-with-positions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Posting List with Term Frequency &amp; Positions        â”‚
â”‚                                                                 â”‚
â”‚  Term: &quot;database&quot;                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Doc1: tf=3, positions=[5, 12, 45]                   â”‚        â”‚
â”‚  â”‚ Doc3: tf=1, positions=[8]                           â”‚        â”‚
â”‚  â”‚ Doc7: tf=5, positions=[2, 10, 15, 30, 42]          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  Uses:                                                          â”‚
â”‚  â€¢ tf (term frequency) â†’ relevance scoring                     â”‚
â”‚  â€¢ positions â†’ phrase queries, proximity queries                â”‚
â”‚  â€¢ doc frequency â†’ IDF calculation                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="3-elasticsearch-architecture">3. Elasticsearch Architecture<a class="header-link" href="#3-elasticsearch-architecture" title="Permanent link">&para;</a></h2>
<h3 id="31-cluster-architecture">3.1 Cluster Architecture<a class="header-link" href="#31-cluster-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Elasticsearch Cluster                               â”‚
â”‚                                                                 â”‚
â”‚  Cluster: &quot;production&quot;                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Node 1 (Master + Data)                                â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚     â”‚
â”‚  â”‚  â”‚ Shard 0  â”‚ â”‚ Shard 2  â”‚ â”‚Replica 1 â”‚               â”‚     â”‚
â”‚  â”‚  â”‚ (Primary)â”‚ â”‚ (Primary)â”‚ â”‚          â”‚               â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Node 2 (Data)                                         â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚     â”‚
â”‚  â”‚  â”‚ Shard 1  â”‚ â”‚Replica 0 â”‚ â”‚Replica 2 â”‚               â”‚     â”‚
â”‚  â”‚  â”‚ (Primary)â”‚ â”‚          â”‚ â”‚          â”‚               â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Node 3 (Data)                                         â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚     â”‚
â”‚  â”‚  â”‚Replica 0 â”‚ â”‚Replica 1 â”‚ â”‚Replica 2 â”‚               â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚  Index: &quot;products&quot; â†’ 3 primary shards, 1 replica each          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="32-index-shard-and-segment">3.2 Index, Shard, and Segment<a class="header-link" href="#32-index-shard-and-segment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Index â†’ Shard â†’ Segment                             â”‚
â”‚                                                                 â”‚
â”‚  Index (logical)                                                â”‚
â”‚  â”œâ”€â”€ Shard 0 (Lucene index)                                    â”‚
â”‚  â”‚   â”œâ”€â”€ Segment 1 (immutable)                                 â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Inverted index                                    â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Stored fields                                     â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Doc values (columnar)                             â”‚
â”‚  â”‚   â”œâ”€â”€ Segment 2 (immutable)                                 â”‚
â”‚  â”‚   â””â”€â”€ Segment 3 (immutable)                                 â”‚
â”‚  â”œâ”€â”€ Shard 1                                                   â”‚
â”‚  â”‚   â””â”€â”€ ...                                                   â”‚
â”‚  â””â”€â”€ Shard 2                                                   â”‚
â”‚      â””â”€â”€ ...                                                   â”‚
â”‚                                                                 â”‚
â”‚  New docs â†’ in-memory buffer â†’ refresh (1s) â†’ new segment      â”‚
â”‚  Segments merge periodically (background)                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="33-write-and-read-paths">3.3 Write and Read Paths<a class="header-link" href="#33-write-and-read-paths" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Write Path:                                                    â”‚
â”‚                                                                 â”‚
â”‚  Client â”€â”€â–¶ Coordinating Node â”€â”€â–¶ Primary Shard                â”‚
â”‚                                       â”‚                        â”‚
â”‚                                       â”œâ”€â”€â–¶ In-memory buffer    â”‚
â”‚                                       â”œâ”€â”€â–¶ Translog (WAL)      â”‚
â”‚                                       â””â”€â”€â–¶ Replica Shards      â”‚
â”‚                                                                 â”‚
â”‚  Refresh (every 1s): buffer â†’ searchable segment               â”‚
â”‚  Flush (every 30m):  translog â†’ disk, clear translog           â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Read Path:                                                     â”‚
â”‚                                                                 â”‚
â”‚  Client â”€â”€â–¶ Coordinating Node                                  â”‚
â”‚                    â”‚                                            â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚            â–¼       â–¼       â–¼                                    â”‚
â”‚         Shard 0  Shard 1  Shard 2  (scatter)                   â”‚
â”‚            â”‚       â”‚       â”‚                                    â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â–¼                                            â”‚
â”‚           Merge &amp; rank results (gather)                         â”‚
â”‚                    â”‚                                            â”‚
â”‚                    â–¼                                            â”‚
â”‚                 Client                                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="4-indexing-and-mapping">4. Indexing and Mapping<a class="header-link" href="#4-indexing-and-mapping" title="Permanent link">&para;</a></h2>
<h3 id="41-index-creation">4.1 Index Creation<a class="header-link" href="#41-index-creation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">PUT</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;number_of_shards&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;number_of_replicas&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;analysis&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;analyzer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;product_analyzer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;custom&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;tokenizer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;standard&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;lowercase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;english_stemmer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;english_stop&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;english_stemmer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stemmer&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;english&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;english_stop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stop&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;stopwords&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_english_&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;mappings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;analyzer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;product_analyzer&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;keyword&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;suggest&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;completion&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;analyzer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;product_analyzer&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;float&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;rating&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;float&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;date&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;in_stock&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="42-field-types">4.2 Field Types<a class="header-link" href="#42-field-types" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">Type</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">Case</span><span class="w">                                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">text</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Full</span><span class="o">-</span><span class="n">text</span><span class="w"> </span><span class="n">search</span><span class="w"> </span><span class="p">(</span><span class="n">analyzed</span><span class="p">,</span><span class="w"> </span><span class="n">tokenized</span><span class="p">)</span><span class="w">            </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">keyword</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Exact</span><span class="w"> </span><span class="n">match</span><span class="p">,</span><span class="w"> </span><span class="n">sorting</span><span class="p">,</span><span class="w"> </span><span class="n">aggregations</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="k">integer</span><span class="o">/</span><span class="n">long</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Numeric</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="n">queries</span><span class="w">                     </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">float</span><span class="o">/</span><span class="n">double</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Decimal</span><span class="w"> </span><span class="n">numbers</span><span class="w">                                   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">date</span><span class="w">           </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Timestamps</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="n">math</span><span class="w">                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">boolean</span><span class="w">        </span><span class="err">â”‚</span><span class="w"> </span><span class="n">true</span><span class="o">/</span><span class="n">false</span><span class="w"> </span><span class="n">filters</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">object</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Nested</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="p">(</span><span class="n">flattened</span><span class="w"> </span><span class="n">internally</span><span class="p">)</span><span class="w">                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">nested</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Array</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="p">(</span><span class="n">maintains</span><span class="w"> </span><span class="n">relationships</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">geo_point</span><span class="w">      </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Latitude</span><span class="o">/</span><span class="n">longitude</span><span class="w">                                </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">completion</span><span class="w">     </span><span class="err">â”‚</span><span class="w"> </span><span class="n">Auto</span><span class="o">-</span><span class="n">complete</span><span class="w"> </span><span class="n">suggestions</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="n">dense_vector</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="n">ML</span><span class="w"> </span><span class="n">embeddings</span><span class="p">,</span><span class="w"> </span><span class="n">similarity</span><span class="w"> </span><span class="n">search</span><span class="w">                  </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<hr />
<h2 id="5-search-queries">5. Search Queries<a class="header-link" href="#5-search-queries" title="Permanent link">&para;</a></h2>
<h3 id="51-match-queries">5.1 Match Queries<a class="header-link" href="#51-match-queries" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Full-text match (analyzed)</span>
<span class="err">GET</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wireless bluetooth headphones&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;and&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Multi-match across fields</span>
<span class="err">GET</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;multi_match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sony headphones&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name^3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tags^2&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;best_fields&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="52-boolean-queries">5.2 Boolean Queries<a class="header-link" href="#52-boolean-queries" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Compound boolean query</span>
<span class="err">GET</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wireless headphones&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;term&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;electronics&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;gte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;lte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;term&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;in_stock&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;should&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;term&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;premium&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;rating&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;gte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">4.5</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;must_not&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;term&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;refurbished&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;minimum_should_match&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="53-aggregations">5.3 Aggregations<a class="header-link" href="#53-aggregations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Faceted search with aggregations</span>
<span class="err">GET</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;terms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;price_ranges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;ranges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;budget&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mid-range&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;premium&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;avg_rating&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;avg&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rating&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;top_rated_by_category&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;terms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;category&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;avg_rating&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;avg&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rating&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;top_products&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;top_hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;sort&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nt">&quot;rating&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;desc&quot;</span><span class="w"> </span><span class="p">}],</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rating&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="54-autocomplete-suggestions">5.4 Autocomplete / Suggestions<a class="header-link" href="#54-autocomplete-suggestions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Completion suggester</span>
<span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;suggest&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;product-suggest&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wire&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;completion&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;name.suggest&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;fuzzy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;fuzziness&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AUTO&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Search-as-you-type with match_phrase_prefix</span>
<span class="err">GET</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match_phrase_prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wireless blue&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;max_expansions&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="6-ranking-and-relevance">6. Ranking and Relevance<a class="header-link" href="#6-ranking-and-relevance" title="Permanent link">&para;</a></h2>
<h3 id="61-bm25-scoring">6.1 BM25 Scoring<a class="header-link" href="#61-bm25-scoring" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span><span class="nv">BM25</span><span class="w"> </span><span class="nv">Scoring</span><span class="w"> </span><span class="ss">(</span><span class="nv">Elasticsearch</span><span class="w"> </span><span class="nv">default</span><span class="ss">)</span><span class="w">                </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">score</span><span class="ss">(</span><span class="nv">q</span>,<span class="w"> </span><span class="nv">d</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Î£<span class="w"> </span><span class="nv">IDF</span><span class="ss">(</span><span class="nv">qi</span><span class="ss">)</span><span class="w"> </span>Ã—<span class="w"> </span>[<span class="nv">f</span><span class="ss">(</span><span class="nv">qi</span>,<span class="nv">d</span><span class="ss">)</span><span class="w"> </span>Ã—<span class="w"> </span><span class="ss">(</span><span class="nv">k1</span><span class="o">+</span><span class="mi">1</span><span class="ss">)</span>]<span class="w">                </span>â”‚
â”‚<span class="w">                              </span>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<span class="w">           </span>â”‚
â”‚<span class="w">                              </span><span class="nv">f</span><span class="ss">(</span><span class="nv">qi</span>,<span class="nv">d</span><span class="ss">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">k1</span>Ã—<span class="ss">(</span><span class="mi">1</span><span class="o">-</span><span class="nv">b</span><span class="o">+</span><span class="nv">b</span>Ã—<span class="o">|</span><span class="nv">d</span><span class="o">|/</span><span class="nv">avgdl</span><span class="ss">)</span><span class="w">   </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Where</span>:<span class="w">                                                         </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">IDF</span><span class="ss">(</span><span class="nv">qi</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">inverse</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span><span class="nv">frequency</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">term</span><span class="w"> </span><span class="nv">qi</span><span class="w">              </span>â”‚
â”‚<span class="w">    </span><span class="ss">(</span><span class="nv">rare</span><span class="w"> </span><span class="nv">terms</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">higher</span><span class="w"> </span><span class="nv">score</span><span class="ss">)</span><span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">f</span><span class="ss">(</span><span class="nv">qi</span>,<span class="nv">d</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">term</span><span class="w"> </span><span class="nv">frequency</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">qi</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span><span class="nv">d</span><span class="w">                </span>â”‚
â”‚<span class="w">    </span><span class="ss">(</span><span class="nv">more</span><span class="w"> </span><span class="nv">occurrences</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">higher</span>,<span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">diminishing</span><span class="w"> </span><span class="nv">returns</span><span class="ss">)</span><span class="w">   </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="o">|</span><span class="nv">d</span><span class="o">|</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span><span class="nv">length</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">avgdl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">average</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span><span class="nv">length</span><span class="w">                              </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">term</span><span class="w"> </span><span class="nv">saturation</span><span class="w"> </span><span class="nv">parameter</span><span class="w"> </span><span class="ss">(</span><span class="nv">default</span><span class="w"> </span><span class="mi">1</span>.<span class="mi">2</span><span class="ss">)</span><span class="w">                </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="nv">normalization</span><span class="w"> </span><span class="ss">(</span><span class="nv">default</span><span class="w"> </span><span class="mi">0</span>.<span class="mi">75</span><span class="ss">)</span><span class="w">                      </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Key</span><span class="w"> </span><span class="nv">insight</span>:<span class="w"> </span><span class="nv">BM25</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">diminishing</span><span class="w"> </span><span class="nv">returns</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">term</span><span class="w"> </span><span class="nv">frequency</span><span class="w">   </span>â”‚
â”‚<span class="w">  </span><span class="ss">(</span><span class="nv">unlike</span><span class="w"> </span><span class="nv">TF</span><span class="o">-</span><span class="nv">IDF</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">grows</span><span class="w"> </span><span class="nv">linearly</span><span class="ss">)</span><span class="w">                          </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="62-boosting-and-custom-scoring">6.2 Boosting and Custom Scoring<a class="header-link" href="#62-boosting-and-custom-scoring" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Field boosting</span>
<span class="err">GET</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;multi_match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;headphones&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name^5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;description^2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tags^3&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Function score for custom ranking</span>
<span class="err">GET</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;function_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;headphones&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;functions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;field_value_factor&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rating&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;modifier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;log1p&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;factor&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;gauss&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;origin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;now&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30d&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;decay&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;score_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;multiply&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;boost_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;multiply&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="63-explain-api">6.3 Explain API<a class="header-link" href="#63-explain-api" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Understand why a document scored the way it did</span>
<span class="err">GET</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_explai</span><span class="kc">n</span><span class="err">/doc_id</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wireless headphones&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="7-scaling-search-systems">7. Scaling Search Systems<a class="header-link" href="#7-scaling-search-systems" title="Permanent link">&para;</a></h2>
<h3 id="71-shard-sizing-strategy">7.1 Shard Sizing Strategy<a class="header-link" href="#71-shard-sizing-strategy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span><span class="nv">Shard</span><span class="w"> </span><span class="nv">Sizing</span><span class="w"> </span><span class="nv">Guidelines</span><span class="w">                              </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Rules</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">thumb</span>:<span class="w">                                                </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Target</span><span class="w"> </span><span class="nv">shard</span><span class="w"> </span><span class="nv">size</span>:<span class="w"> </span><span class="mi">10</span><span class="o">-</span><span class="mi">50</span><span class="w"> </span><span class="nv">GB</span><span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Max</span><span class="w"> </span><span class="nv">shards</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">node</span>:<span class="w"> </span><span class="o">~</span><span class="mi">20</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">GB</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">heap</span><span class="w">                      </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Typical</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="nv">heap</span>:<span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="nv">GB</span><span class="w"> </span>â†’<span class="w"> </span><span class="o">~</span><span class="mi">640</span><span class="w"> </span><span class="nv">shards</span><span class="w"> </span><span class="nv">max</span><span class="w">                  </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Example</span><span class="w"> </span><span class="nv">calculation</span>:<span class="w">                                           </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Data</span>:<span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="nv">GB</span>,<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">replica</span><span class="w">                                     </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Total</span>:<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">TB</span><span class="w"> </span><span class="ss">(</span><span class="nv">with</span><span class="w"> </span><span class="nv">replicas</span><span class="ss">)</span><span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Shard</span><span class="w"> </span><span class="nv">size</span><span class="w"> </span><span class="nv">target</span>:<span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="nv">GB</span><span class="w">                                     </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Primary</span><span class="w"> </span><span class="nv">shards</span>:<span class="w"> </span><span class="mi">500</span><span class="o">/</span><span class="mi">25</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Total</span><span class="w"> </span><span class="nv">shards</span>:<span class="w"> </span><span class="mi">20</span><span class="w"> </span>Ã—<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="w">                                   </span>â”‚
â”‚<span class="w">  </span>â€¢<span class="w"> </span><span class="nv">Nodes</span><span class="w"> </span><span class="nv">needed</span>:<span class="w"> </span><span class="mi">40</span><span class="o">/</span><span class="mi">640</span><span class="w"> </span>â‰ˆ<span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">HA</span><span class="w">                     </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="72-index-lifecycle-management-ilm">7.2 Index Lifecycle Management (ILM)<a class="header-link" href="#72-index-lifecycle-management-ilm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">              </span><span class="nv">Index</span><span class="w"> </span><span class="nv">Lifecycle</span><span class="w"> </span><span class="ss">(</span><span class="nv">Hot</span><span class="o">-</span><span class="nv">Warm</span><span class="o">-</span><span class="nv">Cold</span><span class="o">-</span><span class="nv">Delete</span><span class="ss">)</span><span class="w">               </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Hot</span><span class="w"> </span><span class="nv">Phase</span><span class="w"> </span><span class="ss">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">7</span><span class="w"> </span><span class="nv">days</span><span class="ss">)</span><span class="w">                                           </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Fast</span><span class="w"> </span><span class="nv">SSDs</span>,<span class="w"> </span><span class="nv">high</span><span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">throughput</span><span class="w">                           </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Rollover</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="mi">50</span><span class="nv">GB</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="nv">days</span><span class="w">                                </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Primary</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">indexing</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">search</span><span class="w">                              </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Warm</span><span class="w"> </span><span class="nv">Phase</span><span class="w"> </span><span class="ss">(</span><span class="mi">7</span><span class="o">-</span><span class="mi">30</span><span class="w"> </span><span class="nv">days</span><span class="ss">)</span><span class="w">                                         </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Standard</span><span class="w"> </span><span class="nv">disks</span>,<span class="w"> </span><span class="nv">read</span><span class="o">-</span><span class="nv">only</span><span class="w">                                  </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Force</span><span class="w"> </span><span class="nv">merge</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">segment</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">shard</span><span class="w">                         </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Shrink</span><span class="w"> </span><span class="nv">replica</span><span class="w"> </span><span class="nv">count</span><span class="w">                                       </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Cold</span><span class="w"> </span><span class="nv">Phase</span><span class="w"> </span><span class="ss">(</span><span class="mi">30</span><span class="o">-</span><span class="mi">90</span><span class="w"> </span><span class="nv">days</span><span class="ss">)</span><span class="w">                                        </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Object</span><span class="w"> </span><span class="nv">storage</span><span class="w"> </span><span class="ss">(</span><span class="nv">S3</span><span class="ss">)</span><span class="w"> </span><span class="nv">via</span><span class="w"> </span><span class="nv">searchable</span><span class="w"> </span><span class="nv">snapshots</span><span class="w">               </span>â”‚
â”‚<span class="w">  </span>â”œâ”€â”€<span class="w"> </span><span class="nv">Minimal</span><span class="w"> </span><span class="nv">resources</span><span class="w">                                          </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Slower</span><span class="w"> </span><span class="nv">queries</span><span class="w"> </span><span class="nv">acceptable</span><span class="w">                                  </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â”‚<span class="w">  </span><span class="nv">Delete</span><span class="w"> </span><span class="nv">Phase</span><span class="w"> </span><span class="ss">(</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="nv">days</span><span class="ss">)</span><span class="w">                                       </span>â”‚
â”‚<span class="w">  </span>â””â”€â”€<span class="w"> </span><span class="nv">Automatically</span><span class="w"> </span><span class="nv">delete</span><span class="w"> </span><span class="nv">expired</span><span class="w"> </span><span class="nv">indices</span><span class="w">                       </span>â”‚
â”‚<span class="w">                                                                 </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="73-search-performance-optimization">7.3 Search Performance Optimization<a class="header-link" href="#73-search-performance-optimization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Performance</span><span class="w"> </span><span class="nl">checklist:</span>

<span class="mf">1.</span><span class="w"> </span><span class="n">Mapping</span><span class="w"> </span><span class="n">optimization</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">keyword</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">exact</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">(</span><span class="k">not</span><span class="w"> </span><span class="n">text</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Disable</span><span class="w"> </span><span class="n">_source</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">write</span><span class="o">-</span><span class="n">heavy</span><span class="w"> </span><span class="n">indices</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">doc_values</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sorting</span><span class="o">/</span><span class="n">aggregations</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">optimization</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="p">(</span><span class="n">cacheable</span><span class="p">,</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">scoring</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="n">wildcard</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="k">large</span><span class="w"> </span><span class="n">fields</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">routing</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">tenant</span><span class="o">-</span><span class="n">specific</span><span class="w"> </span><span class="n">data</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">Index</span><span class="w"> </span><span class="n">optimization</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Appropriate</span><span class="w"> </span><span class="n">shard</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="p">(</span><span class="n">avoid</span><span class="w"> </span><span class="n">over</span><span class="o">-</span><span class="n">sharding</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Force</span><span class="w"> </span><span class="n">merge</span><span class="w"> </span><span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="w"> </span><span class="n">indices</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="n">sorting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">common</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="n">patterns</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">Hardware</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mh">50</span><span class="o">%</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">cache</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">SSDs</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">hot</span><span class="w"> </span><span class="n">data</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Dedicated</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">production</span>
</code></pre></div>

<hr />
<h2 id="8-practice-problems">8. Practice Problems<a class="header-link" href="#8-practice-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-e-commerce-search">Problem 1: E-Commerce Search<a class="header-link" href="#problem-1-e-commerce-search" title="Permanent link">&para;</a></h3>
<p>Design a search system for an e-commerce platform with 10M products.</p>
<div class="highlight"><pre><span></span><code><span class="nv">Requirements</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">Full</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="nv">search</span><span class="w"> </span><span class="nv">across</span><span class="w"> </span><span class="nv">name</span>,<span class="w"> </span><span class="nv">description</span>,<span class="w"> </span><span class="nv">brand</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Category</span><span class="w"> </span><span class="nv">faceting</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Price</span><span class="w"> </span><span class="nv">range</span><span class="w"> </span><span class="nv">filtering</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Sort</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">relevance</span>,<span class="w"> </span><span class="nv">price</span>,<span class="w"> </span><span class="nv">rating</span>,<span class="w"> </span><span class="nv">newest</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Autocomplete</span><span class="w"> </span><span class="nv">suggestions</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Typo</span><span class="w"> </span><span class="nv">tolerance</span>

<span class="nv">Key</span><span class="w"> </span><span class="nv">decisions</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">Index</span><span class="w"> </span><span class="nv">design</span>:<span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="nv">primary</span><span class="w"> </span><span class="nv">shards</span><span class="w"> </span><span class="ss">(</span><span class="mi">10</span><span class="nv">M</span><span class="w"> </span><span class="nv">docs</span><span class="w"> </span>â‰ˆ<span class="w"> </span><span class="mi">20</span><span class="nv">GB</span><span class="ss">)</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Custom</span><span class="w"> </span><span class="nv">analyzer</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">synonyms</span><span class="w"> </span><span class="ss">(</span><span class="nv">e</span>.<span class="nv">g</span>.,<span class="w"> </span><span class="s2">&quot;phone&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;smartphone&quot;</span><span class="ss">)</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Completion</span><span class="w"> </span><span class="nv">suggester</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">autocomplete</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Function</span><span class="w"> </span><span class="nv">score</span><span class="w"> </span><span class="nv">boosting</span><span class="w"> </span><span class="nv">popular</span><span class="w"> </span><span class="nv">products</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Fuzziness</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">typo</span><span class="w"> </span><span class="nv">tolerance</span>
</code></pre></div>

<h3 id="problem-2-log-search-platform">Problem 2: Log Search Platform<a class="header-link" href="#problem-2-log-search-platform" title="Permanent link">&para;</a></h3>
<p>Design a centralized log search system for 50TB/day of logs.</p>
<div class="highlight"><pre><span></span><code><span class="n">Key</span><span class="w"> </span><span class="n">considerations</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Write</span><span class="o">-</span><span class="n">heavy</span><span class="w"> </span><span class="n">workload</span><span class="w"> </span><span class="p">(</span><span class="mi">50</span><span class="n">TB</span><span class="o">/</span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="mi">580</span><span class="n">MB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Time</span><span class="o">-</span><span class="n">based</span><span class="w"> </span><span class="n">indices</span><span class="w"> </span><span class="p">(</span><span class="n">daily</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">hourly</span><span class="w"> </span><span class="n">rollover</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Hot</span><span class="o">-</span><span class="n">warm</span><span class="o">-</span><span class="n">cold</span><span class="w"> </span><span class="n">architecture</span>
<span class="o">-</span><span class="w"> </span><span class="mi">7</span><span class="o">-</span><span class="n">day</span><span class="w"> </span><span class="n">search</span><span class="w"> </span><span class="n">window</span><span class="w"> </span><span class="p">(</span><span class="n">hot</span><span class="p">),</span><span class="w"> </span><span class="mi">30</span><span class="o">-</span><span class="n">day</span><span class="w"> </span><span class="n">archive</span><span class="w"> </span><span class="p">(</span><span class="n">cold</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Structured</span><span class="w"> </span><span class="n">fields</span><span class="p">:</span><span class="w"> </span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">message</span>

<span class="n">Architecture</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">Kafka</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ingestion</span><span class="w"> </span><span class="n">buffer</span>
<span class="o">-</span><span class="w"> </span><span class="n">Logstash</span><span class="o">/</span><span class="n">Vector</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">parsing</span>
<span class="o">-</span><span class="w"> </span><span class="n">Hot</span><span class="w"> </span><span class="n">nodes</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="err">Ã—</span><span class="w"> </span><span class="p">(</span><span class="mi">32</span><span class="n">GB</span><span class="w"> </span><span class="n">RAM</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">TB</span><span class="w"> </span><span class="n">NVMe</span><span class="w"> </span><span class="n">SSD</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Warm</span><span class="w"> </span><span class="n">nodes</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="err">Ã—</span><span class="w"> </span><span class="p">(</span><span class="mi">32</span><span class="n">GB</span><span class="w"> </span><span class="n">RAM</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="n">TB</span><span class="w"> </span><span class="n">HDD</span><span class="p">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">ILM</span><span class="w"> </span><span class="n">policy</span><span class="p">:</span><span class="w"> </span><span class="n">rollover</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">50</span><span class="n">GB</span><span class="p">,</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">warm</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">24</span><span class="n">h</span>
<span class="o">-</span><span class="w"> </span><span class="n">Estimated</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="n">ELK</span><span class="w"> </span><span class="n">Cloud</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="n">Loki</span><span class="w"> </span><span class="n">comparison</span>
</code></pre></div>

<h3 id="problem-3-autocomplete-system">Problem 3: Autocomplete System<a class="header-link" href="#problem-3-autocomplete-system" title="Permanent link">&para;</a></h3>
<p>Design a search autocomplete that returns results in &lt; 50ms.</p>
<div class="highlight"><pre><span></span><code><span class="n">Approach</span><span class="o">:</span>
<span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="n">Completion</span><span class="w"> </span><span class="n">suggester</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="n">matching</span>
<span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="n">Edge</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">gram</span><span class="w"> </span><span class="n">analyzer</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">partial</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="n">matching</span>
<span class="mi">3</span><span class="o">.</span><span class="w"> </span><span class="n">Separate</span><span class="w"> </span><span class="n">lightweight</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">suggestions</span>
<span class="mi">4</span><span class="o">.</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="n">popular</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="o">(</span><span class="n">TTL</span><span class="o">:</span><span class="w"> </span><span class="mi">5</span><span class="n">min</span><span class="o">)</span>
<span class="mi">5</span><span class="o">.</span><span class="w"> </span><span class="n">Client</span><span class="o">-</span><span class="n">side</span><span class="w"> </span><span class="n">debouncing</span><span class="w"> </span><span class="o">(</span><span class="mi">300</span><span class="n">ms</span><span class="o">)</span>

<span class="n">Index</span><span class="w"> </span><span class="n">design</span><span class="o">:</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;suggest_text&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="o">,</span>
<span class="w">    </span><span class="s2">&quot;analyzer&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;edge_ngram_analyzer&quot;</span><span class="o">,</span>
<span class="w">    </span><span class="s2">&quot;search_analyzer&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;standard&quot;</span><span class="o">,</span>
<span class="w">    </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;suggest&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;completion&quot;</span><span class="w"> </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">},</span>
<span class="w">  </span><span class="s2">&quot;popularity&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="w"> </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">Query</span><span class="w"> </span><span class="n">pipeline</span><span class="o">:</span>
<span class="n">User</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">debounce</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">edge</span><span class="o">-</span><span class="n">ngram</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">completion</span><span class="w"> </span><span class="n">suggest</span>
<span class="err">â†’</span><span class="w"> </span><span class="n">boost</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">popularity</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="mi">10</span>
</code></pre></div>

<hr />
<h2 id="next-steps">Next Steps<a class="header-link" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./19_Observability_Monitoring.md">19. Observability and Monitoring</a></li>
<li><a href="./15_Distributed_Systems_Concepts.md">15. Distributed Systems Concepts</a></li>
</ul>
<h2 id="references">References<a class="header-link" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch: The Definitive Guide</a></li>
<li><a href="https://en.wikipedia.org/wiki/Okapi_BM25">Lucene Scoring (BM25)</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-search-speed.html">Elasticsearch Performance Tuning</a></li>
<li><a href="https://dataintensive.net/">Designing Data-Intensive Applications (Ch. 3)</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/en/System_Design/19_Observability_Monitoring.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">19. Observability and Monitoring</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/en/System_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}