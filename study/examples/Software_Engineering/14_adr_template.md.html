{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14_adr_template.md - Examples</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item active">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/examples/">Examples</a>
    <span class="separator">/</span>
    <a href="/study/examples/Software_Engineering/">Software Engineering</a>
    <span class="separator">/</span>
    <span class="current">14_adr_template.md</span>
</nav>

            </header>

            <div class="content">
                
<article class="example-article">
    <header class="example-header">
        <h1>14_adr_template.md</h1>
        <div class="example-actions">
            <a href="14_adr_template.md" download class="btn">Download</a>
            <button class="btn" id="copy-code-btn">Copy code</button>
        </div>
    </header>

    <div class="example-meta">
        <span>markdown</span>
        <span>176 lines</span>
        <span>8.0 KB</span>
    </div>

    <div class="example-code markdown-body">
        <div class="highlight"><pre><span></span><code><span class="linenos">  1</span><span class="gh"># Architecture Decision Records (ADR)</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span>Architecture Decision Records (ADRs) capture important architectural decisions made
<span class="linenos">  4</span>during a project. Each ADR documents the context, decision, and consequences so that
<span class="linenos">  5</span>future team members understand <span class="ge">*why*</span> the system is built the way it is.
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="gs">**Format**</span>: Michael Nygard&#39;s ADR template (the most widely adopted convention).
<span class="linenos">  8</span>
<span class="linenos">  9</span>---
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="gu">## ADR Template</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="sb">```markdown</span>
<span class="linenos"> 14</span><span class="gh"># ADR-NNN: [Short noun phrase ‚Äî what was decided]</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="gs">**Status**</span>: [Proposed | Accepted | Deprecated | Superseded by ADR-NNN]
<span class="linenos"> 17</span><span class="gs">**Date**</span>: YYYY-MM-DD
<span class="linenos"> 18</span><span class="gs">**Deciders**</span>: [List of people involved in the decision]
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="gu">## Context</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span>What is the issue that motivates this decision?
<span class="linenos"> 23</span>Describe the forces at play ‚Äî technical, political, social, project-related.
<span class="linenos"> 24</span>This section is value-neutral; state facts, not opinions.
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="gu">## Decision</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>What is the change being proposed or that was decided?
<span class="linenos"> 29</span>Write in the active voice: &quot;We will use X&quot; rather than &quot;X will be used&quot;.
<span class="linenos"> 30</span>Include alternatives that were considered and briefly explain why they were rejected.
<span class="linenos"> 31</span>
<span class="linenos"> 32</span><span class="gu">## Consequences</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>What becomes easier or harder after this decision?
<span class="linenos"> 35</span>List positive consequences, negative consequences, and risks.
<span class="linenos"> 36</span>Be honest about trade-offs ‚Äî an ADR with no negative consequences is suspect.
<span class="linenos"> 37</span><span class="sb">```</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>---
<span class="linenos"> 40</span>
<span class="linenos"> 41</span><span class="gu">## Guidelines for Writing Effective ADRs</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span><span class="k">1.</span> <span class="gs">**Write ADRs at decision time.**</span> Don&#39;t reconstruct history months later.
<span class="linenos"> 44</span><span class="k">2.</span> <span class="gs">**Keep each ADR focused.**</span> One significant decision per document.
<span class="linenos"> 45</span><span class="k">3.</span> <span class="gs">**Immutable after acceptance.**</span> Never edit a past ADR; supersede it with a new one.
<span class="linenos"> 46</span><span class="k">4.</span> <span class="gs">**Link related ADRs.**</span> Cross-reference when decisions build on each other.
<span class="linenos"> 47</span><span class="k">5.</span> <span class="gs">**Short title, clear noun phrase.**</span> &quot;Use PostgreSQL as primary database&quot; not &quot;Database&quot;.
<span class="linenos"> 48</span><span class="k">6.</span> <span class="gs">**Include rejected alternatives.**</span> This is the most valuable part for future readers.
<span class="linenos"> 49</span><span class="k">7.</span> <span class="gs">**Store in the repository.**</span> <span class="sb">`docs/adr/`</span> next to the code it describes.
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>---
<span class="linenos"> 52</span>
<span class="linenos"> 53</span><span class="gu">## Example ADR 1</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span><span class="gh"># ADR-001: Use PostgreSQL as Primary Database</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="gs">**Status**</span>: Accepted
<span class="linenos"> 58</span><span class="gs">**Date**</span>: 2025-03-10
<span class="linenos"> 59</span><span class="gs">**Deciders**</span>: Alice Kim (Tech Lead), Bob Park (Backend), Carol Lee (DBA)
<span class="linenos"> 60</span>
<span class="linenos"> 61</span><span class="gu">## Context</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>The e-commerce platform needs a relational database to store users, products, orders,
<span class="linenos"> 64</span>and inventory. We need ACID transactions for order processing, and the team anticipates
<span class="linenos"> 65</span>complex queries with joins across multiple tables. Initial data volume is expected to be
<span class="linenos"> 66</span>~5 million rows across all tables with modest write throughput (~200 writes/second peak).
<span class="linenos"> 67</span>
<span class="linenos"> 68</span>We evaluated three options:
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>| Option         | Pros                                    | Cons                                      |
<span class="linenos"> 71</span>|----------------|-----------------------------------------|-------------------------------------------|
<span class="linenos"> 72</span>| PostgreSQL     | Mature, full ACID, JSONB, full-text     | Vertical scaling limits at extreme load   |
<span class="linenos"> 73</span>| MySQL 8        | Wide hosting support, faster simple reads | Weaker JSONB, less expressive SQL         |
<span class="linenos"> 74</span>| MongoDB        | Flexible schema, horizontal scaling     | No multi-document ACID (without sessions) |
<span class="linenos"> 75</span>
<span class="linenos"> 76</span><span class="gu">## Decision</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span>We will use <span class="gs">**PostgreSQL 16**</span> as the sole primary database for all structured data.
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>Specific choices within this decision:
<span class="linenos"> 81</span><span class="k">-</span><span class="w"> </span>Use <span class="sb">`JSONB`</span> columns for semi-structured product attributes, avoiding a separate NoSQL store.
<span class="linenos"> 82</span><span class="k">-</span><span class="w"> </span>Use row-level security (RLS) to enforce tenant isolation at the database layer.
<span class="linenos"> 83</span><span class="k">-</span><span class="w"> </span>Use a managed instance (AWS RDS) to offload operational concerns (backups, patching).
<span class="linenos"> 84</span>
<span class="linenos"> 85</span>MySQL was rejected because its JSONB support is inferior and our team has stronger
<span class="linenos"> 86</span>PostgreSQL expertise. MongoDB was rejected because order processing requires
<span class="linenos"> 87</span>cross-collection transactions that MongoDB handles less cleanly than PostgreSQL.
<span class="linenos"> 88</span>
<span class="linenos"> 89</span><span class="gu">## Consequences</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="gs">**Positive:**</span>
<span class="linenos"> 92</span><span class="k">-</span><span class="w"> </span>Full ACID guarantees simplify order and payment logic significantly.
<span class="linenos"> 93</span><span class="k">-</span><span class="w"> </span>JSONB support eliminates the need for a separate document store for product attributes.
<span class="linenos"> 94</span><span class="k">-</span><span class="w"> </span>RLS provides a robust second line of defence for multi-tenant isolation.
<span class="linenos"> 95</span><span class="k">-</span><span class="w"> </span>Extensive tooling ecosystem (pgAdmin, Alembic, SQLAlchemy, pg_stat_statements).
<span class="linenos"> 96</span>
<span class="linenos"> 97</span><span class="gs">**Negative / Risks:**</span>
<span class="linenos"> 98</span><span class="k">-</span><span class="w"> </span>PostgreSQL does not scale writes horizontally without significant architectural changes
<span class="linenos"> 99</span>  (e.g., Citus, read replicas). If write throughput grows beyond ~5,000 writes/second,
<span class="linenos">100</span>  this decision must be revisited (see ADR-007: Sharding Strategy).
<span class="linenos">101</span><span class="k">-</span><span class="w"> </span>RDS costs more than a self-hosted instance; budget must account for this.
<span class="linenos">102</span><span class="k">-</span><span class="w"> </span>Team must maintain migration discipline (Alembic) to prevent schema drift.
<span class="linenos">103</span>
<span class="linenos">104</span>---
<span class="linenos">105</span>
<span class="linenos">106</span><span class="gu">## Example ADR 2</span>
<span class="linenos">107</span>
<span class="linenos">108</span><span class="gh"># ADR-012: Adopt Microservices Architecture for Payment Service</span>
<span class="linenos">109</span>
<span class="linenos">110</span><span class="gs">**Status**</span>: Accepted
<span class="linenos">111</span><span class="gs">**Date**</span>: 2025-07-22
<span class="linenos">112</span><span class="gs">**Deciders**</span>: Alice Kim (Tech Lead), David Oh (Platform), Eve Choi (Security)
<span class="linenos">113</span><span class="gs">**Supersedes**</span>: ADR-003 (Monolithic architecture for all services)
<span class="linenos">114</span>
<span class="linenos">115</span><span class="gu">## Context</span>
<span class="linenos">116</span>
<span class="linenos">117</span>The payment service currently lives inside the main Django monolith (see ADR-003).
<span class="linenos">118</span>Three pain points have emerged that the monolith cannot address cleanly:
<span class="linenos">119</span>
<span class="linenos">120</span><span class="k">1.</span> <span class="gs">**Deployment coupling**</span>: A bug fix in the product catalogue requires redeploying
<span class="linenos">121</span>   the entire application, including the payment module. Any deployment carries risk
<span class="linenos">122</span>   for payment processing, which must have 99.95% uptime.
<span class="linenos">123</span><span class="k">2.</span> <span class="gs">**Compliance isolation**</span>: PCI-DSS compliance requires limiting the cardholder data
<span class="linenos">124</span>   environment (CDE) to as few systems as possible. Keeping payment logic in the
<span class="linenos">125</span>   monolith means the entire application is in scope, which triples audit complexity.
<span class="linenos">126</span><span class="k">3.</span> <span class="gs">**Independent scaling**</span>: Checkout traffic spikes (flash sales) require extra payment
<span class="linenos">127</span>   processing capacity without scaling unrelated services.
<span class="linenos">128</span>
<span class="linenos">129</span>Alternatives considered:
<span class="linenos">130</span>
<span class="linenos">131</span>| Option                          | Assessment                                                  |
<span class="linenos">132</span>|---------------------------------|-------------------------------------------------------------|
<span class="linenos">133</span>| Extract payment as a library    | Solves none of the three pain points                        |
<span class="linenos">134</span>| Strangler Fig to full microservices | Too broad; creates risk across the whole platform       |
<span class="linenos">135</span>| Extract <span class="ge">*only*</span> payment service  | Targeted, addresses all three pain points, manageable scope |
<span class="linenos">136</span>
<span class="linenos">137</span><span class="gu">## Decision</span>
<span class="linenos">138</span>
<span class="linenos">139</span>We will extract the payment service into a <span class="gs">**standalone microservice**</span> using the
<span class="linenos">140</span>Strangler Fig pattern, while keeping the rest of the platform as a monolith.
<span class="linenos">141</span>
<span class="linenos">142</span>Implementation decisions:
<span class="linenos">143</span><span class="k">-</span><span class="w"> </span><span class="gs">**Language/Framework**</span>: Python 3.12 + FastAPI (async, matches team skills).
<span class="linenos">144</span><span class="k">-</span><span class="w"> </span><span class="gs">**Communication**</span>: Synchronous REST for checkout flow; async events via RabbitMQ
<span class="linenos">145</span>  for post-payment notifications (receipt emails, inventory deduction).
<span class="linenos">146</span><span class="k">-</span><span class="w"> </span><span class="gs">**Data**</span>: Dedicated PostgreSQL schema, not shared with the monolith (database-per-service).
<span class="linenos">147</span><span class="k">-</span><span class="w"> </span><span class="gs">**Auth**</span>: Service-to-service calls authenticated with short-lived JWTs signed by
<span class="linenos">148</span>  an internal CA (not user-facing OAuth tokens).
<span class="linenos">149</span><span class="k">-</span><span class="w"> </span><span class="gs">**Deployment**</span>: Separate Kubernetes Deployment with HPA; isolated network policy
<span class="linenos">150</span>  limits ingress to the API gateway and the monolith only.
<span class="linenos">151</span>
<span class="linenos">152</span><span class="gu">## Consequences</span>
<span class="linenos">153</span>
<span class="linenos">154</span><span class="gs">**Positive:**</span>
<span class="linenos">155</span><span class="k">-</span><span class="w"> </span>Payment service can be deployed independently ‚Äî zero downtime for product catalogue releases.
<span class="linenos">156</span><span class="k">-</span><span class="w"> </span>PCI-DSS CDE scope reduced from the whole monolith to one small service and its database.
<span class="linenos">157</span><span class="k">-</span><span class="w"> </span>Can scale payment pods independently during flash sales without scaling catalogue services.
<span class="linenos">158</span><span class="k">-</span><span class="w"> </span>Failure in the monolith (e.g., OOM) does not crash in-flight payment transactions.
<span class="linenos">159</span>
<span class="linenos">160</span><span class="gs">**Negative / Risks:**</span>
<span class="linenos">161</span><span class="k">-</span><span class="w"> </span><span class="gs">**Distributed systems complexity**</span>: Network failures between the monolith and payment
<span class="linenos">162</span>  service must be handled explicitly (retries, idempotency keys, circuit breakers).
<span class="linenos">163</span>  The monolith today handles this with a local function call.
<span class="linenos">164</span><span class="k">-</span><span class="w"> </span><span class="gs">**Operational overhead**</span>: Additional Kubernetes Deployment, service, and network policy
<span class="linenos">165</span>  to maintain. Observability must be extended (distributed tracing with OpenTelemetry).
<span class="linenos">166</span><span class="k">-</span><span class="w"> </span><span class="gs">**Data consistency**</span>: Without a shared database, refunds and order status updates require
<span class="linenos">167</span>  event-driven coordination. The team must implement the Saga pattern for the checkout flow.
<span class="linenos">168</span><span class="k">-</span><span class="w"> </span><span class="gs">**Scope creep risk**</span>: Extracting one service is justified. Extracting everything into
<span class="linenos">169</span>  microservices is not ‚Äî this ADR explicitly does not authorise a full decomposition.
<span class="linenos">170</span>  Future extractions require separate ADRs.
<span class="linenos">171</span>
<span class="linenos">172</span><span class="gs">**Follow-up actions:**</span>
<span class="linenos">173</span><span class="k">-</span><span class="w"> </span>ADR-013: Event schema for payment events on RabbitMQ
<span class="linenos">174</span><span class="k">-</span><span class="w"> </span>ADR-014: Saga pattern implementation for checkout/refund flow
<span class="linenos">175</span><span class="k">-</span><span class="w"> </span>Runbook: Payment service on-call playbook (escalation, rollback procedure)
</code></pre></div>

    </div>
</article>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.getElementById('copy-code-btn').addEventListener('click', function() {
        var code = document.querySelector('.example-code .highlight');
        // Extract just the code text, not line numbers
        var lines = code.querySelectorAll('.code pre span.line');
        var text;
        if (lines.length > 0) {
            text = Array.from(lines).map(function(l) { return l.textContent; }).join('\n');
        } else {
            // Fallback: get all code text
            var codeEl = code.querySelector('pre code') || code.querySelector('pre');
            text = codeEl ? codeEl.textContent : code.textContent;
        }
        navigator.clipboard.writeText(text);
        this.textContent = 'Copied!';
        var btn = this;
        setTimeout(function() { btn.textContent = 'Copy code'; }, 2000);
    });
</script>

</body>
</html>
{% endraw %}