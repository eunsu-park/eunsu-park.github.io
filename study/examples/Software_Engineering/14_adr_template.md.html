{% raw %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>14_adr_template.md - Examples</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/en/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/en/" class="nav-item ">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item active">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/en/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" selected>
                        English
                    </option>
                    
                    <option value="ko" >
                        ÌïúÍµ≠Ïñ¥
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">‚òÄÔ∏è</span>
                    <span class="theme-icon dark">üåô</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/examples/">Examples</a>
    <span class="separator">/</span>
    <a href="/study/examples/Software_Engineering/">Software Engineering</a>
    <span class="separator">/</span>
    <span class="current">14_adr_template.md</span>
</nav>

            </header>

            <div class="content">
                
<article class="example-article">
    <header class="example-header">
        <h1>14_adr_template.md</h1>
        <div class="example-actions">
            <a href="14_adr_template.md" download class="btn">Download</a>
            <button class="btn" id="copy-code-btn">Copy code</button>
        </div>
    </header>

    <div class="example-meta">
        <span>markdown</span>
        <span>176 lines</span>
        <span>8.0 KB</span>
    </div>

    <div class="example-code markdown-body">
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Architecture Decision Records (ADR)</span>

Architecture Decision Records (ADRs) capture important architectural decisions made
during a project. Each ADR documents the context, decision, and consequences so that
future team members understand <span class="ge">*why*</span> the system is built the way it is.

<span class="gs">**Format**</span>: Michael Nygard&#39;s ADR template (the most widely adopted convention).

---

<span class="gu">## ADR Template</span>

<span class="sb">```markdown</span>
<span class="gh"># ADR-NNN: [Short noun phrase ‚Äî what was decided]</span>

<span class="gs">**Status**</span>: [Proposed | Accepted | Deprecated | Superseded by ADR-NNN]
<span class="gs">**Date**</span>: YYYY-MM-DD
<span class="gs">**Deciders**</span>: [List of people involved in the decision]

<span class="gu">## Context</span>

What is the issue that motivates this decision?
Describe the forces at play ‚Äî technical, political, social, project-related.
This section is value-neutral; state facts, not opinions.

<span class="gu">## Decision</span>

What is the change being proposed or that was decided?
Write in the active voice: &quot;We will use X&quot; rather than &quot;X will be used&quot;.
Include alternatives that were considered and briefly explain why they were rejected.

<span class="gu">## Consequences</span>

What becomes easier or harder after this decision?
List positive consequences, negative consequences, and risks.
Be honest about trade-offs ‚Äî an ADR with no negative consequences is suspect.
<span class="sb">```</span>

---

<span class="gu">## Guidelines for Writing Effective ADRs</span>

<span class="k">1.</span> <span class="gs">**Write ADRs at decision time.**</span> Don&#39;t reconstruct history months later.
<span class="k">2.</span> <span class="gs">**Keep each ADR focused.**</span> One significant decision per document.
<span class="k">3.</span> <span class="gs">**Immutable after acceptance.**</span> Never edit a past ADR; supersede it with a new one.
<span class="k">4.</span> <span class="gs">**Link related ADRs.**</span> Cross-reference when decisions build on each other.
<span class="k">5.</span> <span class="gs">**Short title, clear noun phrase.**</span> &quot;Use PostgreSQL as primary database&quot; not &quot;Database&quot;.
<span class="k">6.</span> <span class="gs">**Include rejected alternatives.**</span> This is the most valuable part for future readers.
<span class="k">7.</span> <span class="gs">**Store in the repository.**</span> <span class="sb">`docs/adr/`</span> next to the code it describes.

---

<span class="gu">## Example ADR 1</span>

<span class="gh"># ADR-001: Use PostgreSQL as Primary Database</span>

<span class="gs">**Status**</span>: Accepted
<span class="gs">**Date**</span>: 2025-03-10
<span class="gs">**Deciders**</span>: Alice Kim (Tech Lead), Bob Park (Backend), Carol Lee (DBA)

<span class="gu">## Context</span>

The e-commerce platform needs a relational database to store users, products, orders,
and inventory. We need ACID transactions for order processing, and the team anticipates
complex queries with joins across multiple tables. Initial data volume is expected to be
~5 million rows across all tables with modest write throughput (~200 writes/second peak).

We evaluated three options:

| Option         | Pros                                    | Cons                                      |
|----------------|-----------------------------------------|-------------------------------------------|
| PostgreSQL     | Mature, full ACID, JSONB, full-text     | Vertical scaling limits at extreme load   |
| MySQL 8        | Wide hosting support, faster simple reads | Weaker JSONB, less expressive SQL         |
| MongoDB        | Flexible schema, horizontal scaling     | No multi-document ACID (without sessions) |

<span class="gu">## Decision</span>

We will use <span class="gs">**PostgreSQL 16**</span> as the sole primary database for all structured data.

Specific choices within this decision:
<span class="k">-</span><span class="w"> </span>Use <span class="sb">`JSONB`</span> columns for semi-structured product attributes, avoiding a separate NoSQL store.
<span class="k">-</span><span class="w"> </span>Use row-level security (RLS) to enforce tenant isolation at the database layer.
<span class="k">-</span><span class="w"> </span>Use a managed instance (AWS RDS) to offload operational concerns (backups, patching).

MySQL was rejected because its JSONB support is inferior and our team has stronger
PostgreSQL expertise. MongoDB was rejected because order processing requires
cross-collection transactions that MongoDB handles less cleanly than PostgreSQL.

<span class="gu">## Consequences</span>

<span class="gs">**Positive:**</span>
<span class="k">-</span><span class="w"> </span>Full ACID guarantees simplify order and payment logic significantly.
<span class="k">-</span><span class="w"> </span>JSONB support eliminates the need for a separate document store for product attributes.
<span class="k">-</span><span class="w"> </span>RLS provides a robust second line of defence for multi-tenant isolation.
<span class="k">-</span><span class="w"> </span>Extensive tooling ecosystem (pgAdmin, Alembic, SQLAlchemy, pg_stat_statements).

<span class="gs">**Negative / Risks:**</span>
<span class="k">-</span><span class="w"> </span>PostgreSQL does not scale writes horizontally without significant architectural changes
  (e.g., Citus, read replicas). If write throughput grows beyond ~5,000 writes/second,
  this decision must be revisited (see ADR-007: Sharding Strategy).
<span class="k">-</span><span class="w"> </span>RDS costs more than a self-hosted instance; budget must account for this.
<span class="k">-</span><span class="w"> </span>Team must maintain migration discipline (Alembic) to prevent schema drift.

---

<span class="gu">## Example ADR 2</span>

<span class="gh"># ADR-012: Adopt Microservices Architecture for Payment Service</span>

<span class="gs">**Status**</span>: Accepted
<span class="gs">**Date**</span>: 2025-07-22
<span class="gs">**Deciders**</span>: Alice Kim (Tech Lead), David Oh (Platform), Eve Choi (Security)
<span class="gs">**Supersedes**</span>: ADR-003 (Monolithic architecture for all services)

<span class="gu">## Context</span>

The payment service currently lives inside the main Django monolith (see ADR-003).
Three pain points have emerged that the monolith cannot address cleanly:

<span class="k">1.</span> <span class="gs">**Deployment coupling**</span>: A bug fix in the product catalogue requires redeploying
   the entire application, including the payment module. Any deployment carries risk
   for payment processing, which must have 99.95% uptime.
<span class="k">2.</span> <span class="gs">**Compliance isolation**</span>: PCI-DSS compliance requires limiting the cardholder data
   environment (CDE) to as few systems as possible. Keeping payment logic in the
   monolith means the entire application is in scope, which triples audit complexity.
<span class="k">3.</span> <span class="gs">**Independent scaling**</span>: Checkout traffic spikes (flash sales) require extra payment
   processing capacity without scaling unrelated services.

Alternatives considered:

| Option                          | Assessment                                                  |
|---------------------------------|-------------------------------------------------------------|
| Extract payment as a library    | Solves none of the three pain points                        |
| Strangler Fig to full microservices | Too broad; creates risk across the whole platform       |
| Extract <span class="ge">*only*</span> payment service  | Targeted, addresses all three pain points, manageable scope |

<span class="gu">## Decision</span>

We will extract the payment service into a <span class="gs">**standalone microservice**</span> using the
Strangler Fig pattern, while keeping the rest of the platform as a monolith.

Implementation decisions:
<span class="k">-</span><span class="w"> </span><span class="gs">**Language/Framework**</span>: Python 3.12 + FastAPI (async, matches team skills).
<span class="k">-</span><span class="w"> </span><span class="gs">**Communication**</span>: Synchronous REST for checkout flow; async events via RabbitMQ
  for post-payment notifications (receipt emails, inventory deduction).
<span class="k">-</span><span class="w"> </span><span class="gs">**Data**</span>: Dedicated PostgreSQL schema, not shared with the monolith (database-per-service).
<span class="k">-</span><span class="w"> </span><span class="gs">**Auth**</span>: Service-to-service calls authenticated with short-lived JWTs signed by
  an internal CA (not user-facing OAuth tokens).
<span class="k">-</span><span class="w"> </span><span class="gs">**Deployment**</span>: Separate Kubernetes Deployment with HPA; isolated network policy
  limits ingress to the API gateway and the monolith only.

<span class="gu">## Consequences</span>

<span class="gs">**Positive:**</span>
<span class="k">-</span><span class="w"> </span>Payment service can be deployed independently ‚Äî zero downtime for product catalogue releases.
<span class="k">-</span><span class="w"> </span>PCI-DSS CDE scope reduced from the whole monolith to one small service and its database.
<span class="k">-</span><span class="w"> </span>Can scale payment pods independently during flash sales without scaling catalogue services.
<span class="k">-</span><span class="w"> </span>Failure in the monolith (e.g., OOM) does not crash in-flight payment transactions.

<span class="gs">**Negative / Risks:**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Distributed systems complexity**</span>: Network failures between the monolith and payment
  service must be handled explicitly (retries, idempotency keys, circuit breakers).
  The monolith today handles this with a local function call.
<span class="k">-</span><span class="w"> </span><span class="gs">**Operational overhead**</span>: Additional Kubernetes Deployment, service, and network policy
  to maintain. Observability must be extended (distributed tracing with OpenTelemetry).
<span class="k">-</span><span class="w"> </span><span class="gs">**Data consistency**</span>: Without a shared database, refunds and order status updates require
  event-driven coordination. The team must implement the Saga pattern for the checkout flow.
<span class="k">-</span><span class="w"> </span><span class="gs">**Scope creep risk**</span>: Extracting one service is justified. Extracting everything into
  microservices is not ‚Äî this ADR explicitly does not authorise a full decomposition.
  Future extractions require separate ADRs.

<span class="gs">**Follow-up actions:**</span>
<span class="k">-</span><span class="w"> </span>ADR-013: Event schema for payment events on RabbitMQ
<span class="k">-</span><span class="w"> </span>ADR-014: Saga pattern implementation for checkout/refund flow
<span class="k">-</span><span class="w"> </span>Runbook: Payment service on-call playbook (escalation, rollback procedure)
</code></pre></div></td></tr></table></div>

    </div>
</article>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'en';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.getElementById('copy-code-btn').addEventListener('click', function() {
        var code = document.querySelector('.example-code .highlight');
        // Extract just the code text, not line numbers
        var lines = code.querySelectorAll('.code pre span.line');
        var text;
        if (lines.length > 0) {
            text = Array.from(lines).map(function(l) { return l.textContent; }).join('\n');
        } else {
            // Fallback: get all code text
            var codeEl = code.querySelector('pre code') || code.querySelector('pre');
            text = codeEl ? codeEl.textContent : code.textContent;
        }
        navigator.clipboard.writeText(text);
        this.textContent = 'Copied!';
        var btn = this;
        setTimeout(function() { btn.textContent = 'Copy code'; }, 2000);
    });
</script>

</body>
</html>
{% endraw %}