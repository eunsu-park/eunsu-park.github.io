{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë ˆìŠ¨ 7: ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(Abstract Syntax Trees) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Compiler_Design/">Compiler Design</a>
    <span class="separator">/</span>
    <span class="current">ë ˆìŠ¨ 7: ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(Abstract Syntax Trees)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ë ˆìŠ¨ 7: ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(Abstract Syntax Trees)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/06_Bottom_Up_Parsing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë ˆìŠ¨ 6: ìƒí–¥ì‹ íŒŒì‹±(Bottom-Up Parsing)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/08_Semantic_Analysis.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë ˆìŠ¨ 8: ì˜ë¯¸ ë¶„ì„(Semantic Analysis)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#1-ast">1. ì†Œê°œ: ì™œ ASTì¸ê°€?</a><ul>
<li><a href="#11-concrete-syntax-tree-cst">1.1 êµ¬ì²´ì  êµ¬ë¬¸ íŠ¸ë¦¬(Concrete Syntax Tree, CST)</a></li>
<li><a href="#12-abstract-syntax-tree-ast">1.2 ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(Abstract Syntax Tree, AST)</a></li>
<li><a href="#13-cst-vs-ast">1.3 CST vs AST ë¹„êµ</a></li>
<li><a href="#14-ast">1.4 ì¤‘ì‹¬ ë°ì´í„° êµ¬ì¡°ë¡œì„œì˜ AST</a></li>
</ul>
</li>
<li><a href="#2-ast">2. AST ë…¸ë“œ ì„¤ê³„</a><ul>
<li><a href="#21-algebraic-data-types">2.1 ëŒ€ìˆ˜ì  ë°ì´í„° íƒ€ì…(Algebraic Data Types)</a></li>
<li><a href="#22-python-dataclasses">2.2 Python ë°ì´í„°í´ë˜ìŠ¤(Dataclasses)</a></li>
<li><a href="#23">2.3 ì„¤ê³„ ì›ì¹™</a></li>
</ul>
</li>
<li><a href="#3-visitor-pattern">3. ë°©ë¬¸ì íŒ¨í„´(Visitor Pattern)</a><ul>
<li><a href="#31">3.1 ë™ê¸°</a></li>
<li><a href="#32">3.2 í´ë˜ì‹ ë°©ë¬¸ì íŒ¨í„´</a></li>
<li><a href="#33-evaluator">3.3 í‰ê°€ê¸°(Evaluator) ë°©ë¬¸ì</a></li>
<li><a href="#34">3.4 ë¬¸ì¥ ë°©ë¬¸ì (ì™„ì „í•œ ì¸í„°í”„ë¦¬í„°)</a></li>
</ul>
</li>
<li><a href="#4">4. íŠ¸ë¦¬ ìˆœíšŒ ì „ëµ</a><ul>
<li><a href="#41-pre-order-traversal">4.1 ì „ìœ„ ìˆœíšŒ(Pre-Order Traversal)</a></li>
<li><a href="#42-post-order-traversal">4.2 í›„ìœ„ ìˆœíšŒ(Post-Order Traversal)</a></li>
<li><a href="#43-in-order-traversal">4.3 ì¤‘ìœ„ ìˆœíšŒ(In-Order Traversal)</a></li>
<li><a href="#44-generic-tree-walker">4.4 ë²”ìš© íŠ¸ë¦¬ ì›Œì»¤(Generic Tree Walker)</a></li>
</ul>
</li>
<li><a href="#5-pretty-printing">5. í”„ë¦¬í‹° í”„ë¦°íŒ…(Pretty Printing)</a><ul>
<li><a href="#51">5.1 í”„ë¦¬í‹° í”„ë¦°íŒ…ì´ë€?</a></li>
<li><a href="#52">5.2 êµ¬í˜„</a></li>
</ul>
</li>
<li><a href="#6-ast">6. AST ë³€í™˜</a><ul>
<li><a href="#61-constant-folding">6.1 ìƒìˆ˜ í´ë”©(Constant Folding)</a></li>
<li><a href="#62-desugaring">6.2 ë””ìŠˆê°€ë§(Desugaring)</a></li>
</ul>
</li>
<li><a href="#7-source-location-tracking">7. ì†ŒìŠ¤ ìœ„ì¹˜ ì¶”ì (Source Location Tracking)</a><ul>
<li><a href="#71">7.1 ìœ„ì¹˜ë¥¼ ì¶”ì í•˜ëŠ” ì´ìœ ?</a></li>
<li><a href="#72">7.2 ìœ„ì¹˜ ì „íŒŒ</a></li>
<li><a href="#73">7.3 ìœ„ì¹˜ë¥¼ ì´ìš©í•œ ì˜¤ë¥˜ ë³´ê³ </a></li>
</ul>
</li>
<li><a href="#8-ast-pattern-matching">8. ASTì—ì„œì˜ íŒ¨í„´ ë§¤ì¹­(Pattern Matching)</a><ul>
<li><a href="#81-python-310">8.1 Python 3.10+ êµ¬ì¡°ì  íŒ¨í„´ ë§¤ì¹­</a></li>
<li><a href="#82-310-isinstance">8.2 3.10 ì´ì „ ëŒ€ì•ˆ: isinstance ì²´ì¸</a></li>
</ul>
</li>
<li><a href="#9-ast-serialization">9. AST ì§ë ¬í™”(Serialization)</a><ul>
<li><a href="#91-json">9.1 JSON ì§ë ¬í™”</a></li>
<li><a href="#92-s-s-expression">9.2 S-í‘œí˜„ì‹(S-Expression) ì§ë ¬í™”</a></li>
</ul>
</li>
<li><a href="#10-ast">10. ì‹¤ì œ ì„¸ê³„ì˜ AST ì˜ˆì‹œ</a><ul>
<li><a href="#101-python-ast">10.1 Pythonì˜ ast ëª¨ë“ˆ</a></li>
<li><a href="#102-rust-syn-crate">10.2 Rustì˜ syn í¬ë ˆì´íŠ¸(Crate)</a></li>
<li><a href="#103-babel-javascript">10.3 Babel (JavaScript)</a></li>
</ul>
</li>
<li><a href="#11">11. ìš”ì•½</a></li>
<li><a href="#_2">ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-ast_1">ì—°ìŠµ 1: AST ë…¸ë“œ ì„¤ê³„</a></li>
<li><a href="#2">ì—°ìŠµ 2: ì™„ì „í•œ ë°©ë¬¸ì</a></li>
<li><a href="#3">ì—°ìŠµ 3: í”„ë¦¬í‹° í”„ë¦°í„° ê°œì„ </a></li>
<li><a href="#4-constant-propagation">ì—°ìŠµ 4: ìƒìˆ˜ ì „íŒŒ(Constant Propagation)</a></li>
<li><a href="#5-ast-diff">ì—°ìŠµ 5: AST ì°¨ì´(Diff)</a></li>
<li><a href="#6-round-trip-test">ì—°ìŠµ 6: ë¼ìš´ë“œ-íŠ¸ë¦½ í…ŒìŠ¤íŠ¸(Round-Trip Test)</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="7-abstract-syntax-trees">ë ˆìŠ¨ 7: ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(Abstract Syntax Trees)<a class="header-link" href="#7-abstract-syntax-trees" title="Permanent link">&para;</a></h1>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>ì´ ë ˆìŠ¨ì„ ì™„ë£Œí•˜ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<ol>
<li><strong>êµ¬ë¶„</strong>: êµ¬ì²´ì  êµ¬ë¬¸ íŠ¸ë¦¬(Concrete Syntax Tree, CST)ì™€ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(Abstract Syntax Tree, AST)ì˜ ì°¨ì´ êµ¬ë¶„</li>
<li><strong>ì„¤ê³„</strong>: ëŒ€ìˆ˜ì  ë°ì´í„° íƒ€ì…(Algebraic Data Types)ê³¼ Python ë°ì´í„°í´ë˜ìŠ¤(Dataclasses)ë¥¼ ì‚¬ìš©í•œ AST ë…¸ë“œ íƒ€ì… ì„¤ê³„</li>
<li><strong>êµ¬í˜„</strong>: AST ìˆœíšŒ(Traversal)ì™€ ë³€í™˜(Transformation)ì„ ìœ„í•œ ë°©ë¬¸ì íŒ¨í„´(Visitor Pattern) êµ¬í˜„</li>
<li><strong>ì ìš©</strong>: ë‹¤ì–‘í•œ íŠ¸ë¦¬ ìˆœíšŒ ì „ëµ ì ìš© (ì „ìœ„ ìˆœíšŒ(Pre-Order), í›„ìœ„ ìˆœíšŒ(Post-Order), ì¤‘ìœ„ ìˆœíšŒ(In-Order))</li>
<li><strong>êµ¬ì¶•</strong>: ASTë¡œë¶€í„° ì†ŒìŠ¤ ì½”ë“œë¥¼ ì¬êµ¬ì„±í•˜ëŠ” í”„ë¦¬í‹° í”„ë¦°í„°(Pretty Printer) êµ¬ì¶•</li>
<li><strong>ìˆ˜í–‰</strong>: ìƒìˆ˜ í´ë”©(Constant Folding)ê³¼ ë””ìŠˆê°€ë§(Desugaring) ê°™ì€ AST ë³€í™˜ ìˆ˜í–‰</li>
<li><strong>ì¶”ì </strong>: ì˜¤ë¥˜ ë³´ê³ ë¥¼ ìœ„í•´ AST ë…¸ë“œì— ì†ŒìŠ¤ ìœ„ì¹˜(Source Location) ì¶”ì </li>
<li><strong>ì§ë ¬í™”</strong>: ASTë¥¼ JSONê³¼ S-í‘œí˜„ì‹(S-Expression) í˜•ì‹ìœ¼ë¡œ ì§ë ¬í™”</li>
</ol>
<hr />
<h2 id="1-ast">1. ì†Œê°œ: ì™œ ASTì¸ê°€?<a class="header-link" href="#1-ast" title="Permanent link">&para;</a></h2>
<p>íŒŒì„œê°€ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì²˜ë¦¬í•  ë•Œ í”„ë¡œê·¸ë¨ êµ¬ì¡°ì˜ íŠ¸ë¦¬ í‘œí˜„ì„ ìƒì„±í•©ë‹ˆë‹¤. êµ¬ë¶„í•´ì•¼ í•  ë‘ ê°€ì§€ ì¢…ë¥˜ì˜ íŠ¸ë¦¬ê°€ ìˆìŠµë‹ˆë‹¤:</p>
<h3 id="11-concrete-syntax-tree-cst">1.1 êµ¬ì²´ì  êµ¬ë¬¸ íŠ¸ë¦¬(Concrete Syntax Tree, CST)<a class="header-link" href="#11-concrete-syntax-tree-cst" title="Permanent link">&para;</a></h3>
<p><strong>êµ¬ì²´ì  êµ¬ë¬¸ íŠ¸ë¦¬</strong>(CST), ë˜ëŠ” <strong>íŒŒìŠ¤ íŠ¸ë¦¬(Parse Tree)</strong>ëŠ” ë¬¸ë²•ì„ ì¶©ì‹¤í•˜ê²Œ ë°˜ì˜í•©ë‹ˆë‹¤. êµ¬ë¶„ì„ ìœ„í•´ì„œë§Œ ì¡´ì¬í•˜ëŠ” ê´„í˜¸, ì‰¼í‘œ, í‚¤ì›Œë“œ ê°™ì€ êµ¬ë¬¸ì  ë…¸ì´ì¦ˆë¥¼ í¬í•¨í•˜ì—¬ ëª¨ë“  ë¹„í„°ë¯¸ë„ê³¼ í„°ë¯¸ë„ì´ ë…¸ë“œë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>&quot;2 + 3 <span class="gs">* 4&quot;ì— ëŒ€í•œ íŒŒìŠ¤ íŠ¸ë¦¬:</span>

<span class="gs">            E</span>
<span class="gs">           /|\</span>
<span class="gs">          E  +  T</span>
<span class="gs">          |    /|\</span>
<span class="gs">          T  T  *</span>  F
          |  |     |
          F  F     4
          |  |
          2  3
</code></pre></div>

<h3 id="12-abstract-syntax-tree-ast">1.2 ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(Abstract Syntax Tree, AST)<a class="header-link" href="#12-abstract-syntax-tree-ast" title="Permanent link">&para;</a></h3>
<p><strong>ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬</strong>ëŠ” ëª¨ë“  êµ¬ë¬¸ì  ì„¸ë¶€ ì‚¬í•­ì„ ì œê±°í•˜ê³  í”„ë¡œê·¸ë¨ì˜ <strong>ë³¸ì§ˆì ì¸ êµ¬ì¡°</strong>ë§Œ ìœ ì§€í•©ë‹ˆë‹¤. ê´„í˜¸, ì—°ì‚°ì ìš°ì„ ìˆœìœ„ ë¹„ê³„(Scaffolding), ì¤‘ê°„ ë¹„í„°ë¯¸ë„ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>&quot;2 + 3 * 4&quot;ì— ëŒ€í•œ AST:

        Add
       /   \
      2    Mul
          /   \
         3     4
</code></pre></div>

<h3 id="13-cst-vs-ast">1.3 CST vs AST ë¹„êµ<a class="header-link" href="#13-cst-vs-ast" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ì¸¡ë©´</th>
<th>êµ¬ì²´ì  êµ¬ë¬¸ íŠ¸ë¦¬</th>
<th>ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>êµ¬ì¡°</td>
<td>ë¬¸ë²•ì„ ì •í™•íˆ ë°˜ì˜</td>
<td>ì˜ë¯¸ì  êµ¬ì¡°ë¥¼ í¬ì°©</td>
</tr>
<tr>
<td>ë…¸ë“œ</td>
<td>ë¬¸ë²• ì‹¬ë³¼ë§ˆë‹¤ í•˜ë‚˜</td>
<td>ì˜ë¯¸ ìˆëŠ” êµ¬ì¡°ë§ˆë‹¤ í•˜ë‚˜</td>
</tr>
<tr>
<td>ê´„í˜¸</td>
<td>ëª…ì‹œì ìœ¼ë¡œ í‘œí˜„</td>
<td>íŠ¸ë¦¬ êµ¬ì¡°ì— ì•”ì‹œ</td>
</tr>
<tr>
<td>ìš°ì„ ìˆœìœ„</td>
<td>ë¹„í„°ë¯¸ë„ì„ í†µí•´ ì¸ì½”ë”© ($E$, $T$, $F$)</td>
<td>íŠ¸ë¦¬ ê¹Šì´ë¡œ ì¸ì½”ë”©</td>
</tr>
<tr>
<td>í¬ê¸°</td>
<td>ë” í¼ (ë§ì€ ë‚´ë¶€ ë…¸ë“œ)</td>
<td>ë” ì‘ìŒ (í•„ìˆ˜ ë…¸ë“œë§Œ)</td>
</tr>
<tr>
<td>ì‚¬ìš© ì‚¬ë¡€</td>
<td>íŒŒì‹± ì´ë¡ , CST ê¸°ë°˜ ë„êµ¬</td>
<td>ì»´íŒŒì¼ëŸ¬, ì¸í„°í”„ë¦¬í„°, ë¦°í„°</td>
</tr>
</tbody>
</table>
<h3 id="14-ast">1.4 ì¤‘ì‹¬ ë°ì´í„° êµ¬ì¡°ë¡œì„œì˜ AST<a class="header-link" href="#14-ast" title="Permanent link">&para;</a></h3>
<p>ASTëŠ” ì»´íŒŒì¼ëŸ¬ ë‚´ë¶€ì˜ <strong>ê³µí†µ ì–¸ì–´(Lingua Franca)</strong>ì…ë‹ˆë‹¤. ì´í›„ì˜ ê±°ì˜ ëª¨ë“  í˜ì´ì¦ˆê°€ ASTë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>ì†ŒìŠ¤ ì½”ë“œ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lexer  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ í† í°
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Parser  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ AST                    â—„â”€â”€ í˜„ì¬ ì—¬ê¸°
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì˜ë¯¸ ë¶„ì„    â”‚ â”€â”€â–¶ ì£¼ì„ì´ ë‹¬ë¦° AST (íƒ€ì…, ìŠ¤ì½”í”„)
â”‚ (Semantic    â”‚
â”‚  Analysis)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IR           â”‚ â”€â”€â–¶ ì¤‘ê°„ í‘œí˜„(Intermediate Representation)
â”‚ Generation   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Optimization â”‚
â”‚ &amp; Code Gen   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-ast">2. AST ë…¸ë“œ ì„¤ê³„<a class="header-link" href="#2-ast" title="Permanent link">&para;</a></h2>
<h3 id="21-algebraic-data-types">2.1 ëŒ€ìˆ˜ì  ë°ì´í„° íƒ€ì…(Algebraic Data Types)<a class="header-link" href="#21-algebraic-data-types" title="Permanent link">&para;</a></h3>
<p>ëŒ€ìˆ˜ì  ë°ì´í„° íƒ€ì…ì„ ê°€ì§„ ì–¸ì–´(Haskell, OCaml, Rust)ì—ì„œ ASTëŠ” í•© íƒ€ì…(Sum Types, íƒœê·¸ëœ ìœ ë‹ˆì–¸)ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í‘œí˜„ë©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Haskell example</span>
<span class="kr">data</span><span class="w"> </span><span class="kt">Expr</span>
<span class="w">    </span><span class="ow">=</span><span class="w"> </span><span class="kt">IntLit</span><span class="w"> </span><span class="kt">Int</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">BoolLit</span><span class="w"> </span><span class="kt">Bool</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">Var</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">BinOp</span><span class="w"> </span><span class="kt">Op</span><span class="w"> </span><span class="kt">Expr</span><span class="w"> </span><span class="kt">Expr</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">UnaryOp</span><span class="w"> </span><span class="kt">Op</span><span class="w"> </span><span class="kt">Expr</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">Call</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">[</span><span class="kt">Expr</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">IfExpr</span><span class="w"> </span><span class="kt">Expr</span><span class="w"> </span><span class="kt">Expr</span><span class="w"> </span><span class="kt">Expr</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">Op</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Add</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Sub</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Mul</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Div</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Eq</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Lt</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">And</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">Or</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">Stmt</span>
<span class="w">    </span><span class="ow">=</span><span class="w"> </span><span class="kt">ExprStmt</span><span class="w"> </span><span class="kt">Expr</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">LetStmt</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="kt">Expr</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">ReturnStmt</span><span class="w"> </span><span class="p">(</span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">Expr</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">Block</span><span class="w"> </span><span class="p">[</span><span class="kt">Stmt</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">WhileStmt</span><span class="w"> </span><span class="kt">Expr</span><span class="w"> </span><span class="kt">Stmt</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="kt">IfStmt</span><span class="w"> </span><span class="kt">Expr</span><span class="w"> </span><span class="kt">Stmt</span><span class="w"> </span><span class="p">(</span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">Stmt</span><span class="p">)</span>
</code></pre></div>

<h3 id="22-python-dataclasses">2.2 Python ë°ì´í„°í´ë˜ìŠ¤(Dataclasses)<a class="header-link" href="#22-python-dataclasses" title="Permanent link">&para;</a></h3>
<p>Pythonì—ëŠ” ë„¤ì´í‹°ë¸Œ ëŒ€ìˆ˜ì  ë°ì´í„° íƒ€ì…ì´ ì—†ì§€ë§Œ, <code>dataclasses</code>ì™€ ìƒì†ì„ ì‚¬ìš©í•˜ì—¬ ìœ ì‚¬í•œ ì„¤ê³„ë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì´ CPython ìì²´ì˜ <code>ast</code> ëª¨ë“ˆì´ ì‚¬ìš©í•˜ëŠ” ì ‘ê·¼ ë°©ì‹ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AST Node Definitions Using Python Dataclasses</span>

<span class="sd">This module defines a complete AST for a small imperative language</span>
<span class="sd">with expressions, statements, and a simple type system.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="c1"># â”€â”€â”€ Source Location Tracking â”€â”€â”€</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SourceLocation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tracks where in the source code a construct appears.&quot;&quot;&quot;</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">column</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_line</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">end_column</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;unknown&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_line</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_line</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_column</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="c1"># â”€â”€â”€ Base AST Node â”€â”€â”€</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ASTNode</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all AST nodes.&quot;&quot;&quot;</span>
    <span class="n">loc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SourceLocation</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>


<span class="c1"># â”€â”€â”€ Operators â”€â”€â”€</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BinOpKind</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ADD</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span>
    <span class="n">SUB</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
    <span class="n">MUL</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
    <span class="n">DIV</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
    <span class="n">MOD</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span>
    <span class="n">POW</span> <span class="o">=</span> <span class="s2">&quot;**&quot;</span>
    <span class="n">EQ</span> <span class="o">=</span> <span class="s2">&quot;==&quot;</span>
    <span class="n">NE</span> <span class="o">=</span> <span class="s2">&quot;!=&quot;</span>
    <span class="n">LT</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span>
    <span class="n">GT</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span>
    <span class="n">LE</span> <span class="o">=</span> <span class="s2">&quot;&lt;=&quot;</span>
    <span class="n">GE</span> <span class="o">=</span> <span class="s2">&quot;&gt;=&quot;</span>
    <span class="n">AND</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span>
    <span class="n">OR</span> <span class="o">=</span> <span class="s2">&quot;or&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">UnaryOpKind</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">NEG</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
    <span class="n">NOT</span> <span class="o">=</span> <span class="s2">&quot;not&quot;</span>


<span class="c1"># â”€â”€â”€ Type Annotations â”€â”€â”€</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TypeAnnotation</span><span class="p">(</span><span class="n">ASTNode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for type annotations in the AST.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SimpleType</span><span class="p">(</span><span class="n">TypeAnnotation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple named type: int, float, bool, str.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ListType</span><span class="p">(</span><span class="n">TypeAnnotation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list type: list[T].&quot;&quot;&quot;</span>
    <span class="n">element_type</span><span class="p">:</span> <span class="n">TypeAnnotation</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FuncType</span><span class="p">(</span><span class="n">TypeAnnotation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A function type: (T1, T2) -&gt; R.&quot;&quot;&quot;</span>
    <span class="n">param_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TypeAnnotation</span><span class="p">]</span>
    <span class="n">return_type</span><span class="p">:</span> <span class="n">TypeAnnotation</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OptionalType</span><span class="p">(</span><span class="n">TypeAnnotation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An optional type: T?.&quot;&quot;&quot;</span>
    <span class="n">inner_type</span><span class="p">:</span> <span class="n">TypeAnnotation</span>


<span class="c1"># â”€â”€â”€ Expressions â”€â”€â”€</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Expr</span><span class="p">(</span><span class="n">ASTNode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all expression nodes.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IntLiteral</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integer literal: 42.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FloatLiteral</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Floating-point literal: 3.14.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BoolLiteral</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Boolean literal: true, false.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StringLiteral</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;String literal: &quot;hello&quot;.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NilLiteral</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nil/null literal.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Identifier</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Variable reference: x, foo.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BinaryExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Binary operation: a + b, x == y.&quot;&quot;&quot;</span>
    <span class="n">op</span><span class="p">:</span> <span class="n">BinOpKind</span>
    <span class="n">left</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">right</span><span class="p">:</span> <span class="n">Expr</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UnaryExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unary operation: -x, not y.&quot;&quot;&quot;</span>
    <span class="n">op</span><span class="p">:</span> <span class="n">UnaryOpKind</span>
    <span class="n">operand</span><span class="p">:</span> <span class="n">Expr</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CallExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function call: f(a, b, c).&quot;&quot;&quot;</span>
    <span class="n">callee</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">arguments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Expr</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IndexExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Indexing: a[i].&quot;&quot;&quot;</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">index</span><span class="p">:</span> <span class="n">Expr</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MemberExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Member access: a.b.&quot;&quot;&quot;</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">member</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IfExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Conditional expression: if cond then a else b.&quot;&quot;&quot;</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">then_expr</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">else_expr</span><span class="p">:</span> <span class="n">Expr</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ListExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List literal: [1, 2, 3].&quot;&quot;&quot;</span>
    <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Expr</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LambdaExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lambda expression: fn(x, y) =&gt; x + y.&quot;&quot;&quot;</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Expr</span>


<span class="c1"># â”€â”€â”€ Statements â”€â”€â”€</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Stmt</span><span class="p">(</span><span class="n">ASTNode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all statement nodes.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Parameter</span><span class="p">(</span><span class="n">ASTNode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function parameter with optional type annotation.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">type_ann</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TypeAnnotation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExprStmt</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expression used as a statement: f(x);.&quot;&quot;&quot;</span>
    <span class="n">expr</span><span class="p">:</span> <span class="n">Expr</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LetStmt</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Variable declaration: let x: int = 42;.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">type_ann</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TypeAnnotation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">initializer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AssignStmt</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assignment: x = expr;.&quot;&quot;&quot;</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Expr</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReturnStmt</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return statement: return expr;.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IfStmt</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If statement: if (cond) { ... } else { ... }.&quot;&quot;&quot;</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">then_body</span><span class="p">:</span> <span class="n">Block</span>
    <span class="n">else_body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Block</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WhileStmt</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;While loop: while (cond) { ... }.&quot;&quot;&quot;</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Block</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ForStmt</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For loop: for (x in collection) { ... }.&quot;&quot;&quot;</span>
    <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">iterable</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Block</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Block</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Block of statements: { stmt1; stmt2; ... }.&quot;&quot;&quot;</span>
    <span class="n">statements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Stmt</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FuncDecl</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function declaration: fn name(params) -&gt; RetType { body }.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
    <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TypeAnnotation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Block</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PrintStmt</span><span class="p">(</span><span class="n">Stmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print statement: print(expr);.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Expr</span>


<span class="c1"># â”€â”€â”€ Program â”€â”€â”€</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Program</span><span class="p">(</span><span class="n">ASTNode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The top-level AST node representing an entire program.&quot;&quot;&quot;</span>
    <span class="n">statements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Stmt</span><span class="p">]</span>
</code></pre></div>

<h3 id="23">2.3 ì„¤ê³„ ì›ì¹™<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<p><strong>1. ë¶ˆë³€ì„± ì„ í˜¸.</strong> AST ë…¸ë“œëŠ” ìƒì„± í›„ ë¶ˆë³€(Immutable)ìœ¼ë¡œ ì·¨ê¸‰í•´ì•¼ í•©ë‹ˆë‹¤. ë³€í™˜ì€ ê¸°ì¡´ ë…¸ë“œë¥¼ ìˆ˜ì •í•˜ëŠ” ëŒ€ì‹  ìƒˆ ë…¸ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
<p><strong>2. í‘œí˜„ì‹ê³¼ ë¬¸ì¥ ë¶„ë¦¬.</strong> ì¼ë¶€ ì–¸ì–´(Rust, Kotlin)ì—ì„œëŠ” ê²½ê³„ê°€ ëª¨í˜¸í•˜ë”ë¼ë„, ASTì—ì„œëŠ” ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ë¶„ì„ì„ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤.</p>
<p><strong>3. ì†ŒìŠ¤ ìœ„ì¹˜ í¬í•¨.</strong> ëª¨ë“  ë…¸ë“œëŠ” ì˜¤ë¥˜ ë³´ê³ ë¥¼ ìœ„í•´ ì†ŒìŠ¤ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤. <code>field(default=None, repr=False, compare=False)</code>ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„ì¹˜ ì •ë³´ê°€ ì¶œë ¥ê³¼ ë¹„êµë¥¼ ì–´ì§€ëŸ½íˆì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<p><strong>4. ìœ í•œí•œ ì„ íƒì— ì—´ê±°í˜•(Enum) ì‚¬ìš©.</strong> ì—°ì‚°ì, íƒ€ì… ì¢…ë¥˜, ê¸°íƒ€ ìœ í•œí•œ ì§‘í•©ì€ ë¬¸ìì—´ì´ ì•„ë‹Œ ì—´ê±°í˜•ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜¤íƒ€ë¥¼ ë°©ì§€í•˜ê³  ì™„ì „í•œ ë§¤ì¹­ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.</p>
<p><strong>5. ìµœì†Œí™” ìœ ì§€.</strong> ASTì—ëŠ” ë¬¸ë²•ì  ì„¤íƒ•(Syntactic Sugar)ì´ í¬í•¨ë˜ì–´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤. íŒŒì‹± ì¤‘ ë˜ëŠ” ë³„ë„ì˜ íŒ¨ìŠ¤ì—ì„œ ë””ìŠˆê°€ë§í•©ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ì†ŒìŠ¤ ë¬¸ë²•</th>
<th>ë””ìŠˆê°€ë§ëœ AST</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x += 5</code></td>
<td><code>AssignStmt(x, BinaryExpr(ADD, x, 5))</code></td>
</tr>
<tr>
<td><code>for x in range(10)</code></td>
<td><code>WhileStmt(...)</code> (ë˜ëŠ” ì˜ë¯¸ì ìœ¼ë¡œ êµ¬ë³„ëœë‹¤ë©´ ForStmt ìœ ì§€)</td>
</tr>
<tr>
<td><code>a?.b</code></td>
<td><code>IfExpr(a != nil, a.b, nil)</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-visitor-pattern">3. ë°©ë¬¸ì íŒ¨í„´(Visitor Pattern)<a class="header-link" href="#3-visitor-pattern" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ë™ê¸°<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<p>ASTê°€ ìƒê¸°ë©´ íƒ€ì… ê²€ì‚¬, ì½”ë“œ ìƒì„±, í”„ë¦¬í‹° í”„ë¦°íŒ…, ìµœì í™” ë“± ë‹¤ì–‘í•œ ëª©ì ìœ¼ë¡œ ìˆœíšŒí•´ì•¼ í•©ë‹ˆë‹¤. <strong>ë°©ë¬¸ì íŒ¨í„´(Visitor Pattern)</strong>ì€ ìˆœíšŒ ë¡œì§ì„ AST ë…¸ë“œ ì •ì˜ì—ì„œ ë¶„ë¦¬í•˜ì—¬, AST í´ë˜ìŠ¤ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ ì—°ì‚°ì„ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
<h3 id="32">3.2 í´ë˜ì‹ ë°©ë¬¸ì íŒ¨í„´<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Visitor Pattern for AST Traversal</span>

<span class="sd">The visitor pattern allows defining new operations on the AST</span>
<span class="sd">without modifying the node classes. Each visitor class implements</span>
<span class="sd">a visit method for each node type.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Generic</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ASTVisitor</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base visitor class.</span>

<span class="sd">    For each AST node type, define a visit_&lt;NodeType&gt; method.</span>
<span class="sd">    The generic dispatch method routes based on the node&#39;s class name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ASTNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispatch to the appropriate visit method.&quot;&quot;&quot;</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;visit_</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">visitor_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">visitor_method</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generic_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ASTNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when no specific visitor method exists.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No visit_</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> method defined &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;in </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExprVisitor</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visitor specialized for expression nodes.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;visit_</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">visitor_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">visitor_method</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generic_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No visit_</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> method&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IntLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_FloatLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FloatLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BoolLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">BoolLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_StringLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">StringLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BinaryExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">BinaryExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_UnaryExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">UnaryExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_CallExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">CallExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IfExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IfExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></pre></div>

<h3 id="33-evaluator">3.3 í‰ê°€ê¸°(Evaluator) ë°©ë¬¸ì<a class="header-link" href="#33-evaluator" title="Permanent link">&para;</a></h3>
<p>ë…¸ë“œë¥¼ ë°©ë¬¸í•˜ì—¬ í‘œí˜„ì‹ì„ í‰ê°€í•˜ëŠ” ê°„ë‹¨í•œ ì¸í„°í”„ë¦¬í„°:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Evaluator</span><span class="p">(</span><span class="n">ExprVisitor</span><span class="p">[</span><span class="nb">object</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluates expression ASTs to produce values.</span>

<span class="sd">    This is the simplest useful visitor: a tree-walking interpreter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IntLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_FloatLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FloatLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BoolLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">BoolLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_StringLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">StringLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Undefined variable: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BinaryExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">BinaryExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>

        <span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">DIV</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MOD</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">POW</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">**</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">NE</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LT</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">GT</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">AND</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">OR</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">b</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">op_func</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">op_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown operator: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">op_func</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_UnaryExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">UnaryExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
        <span class="n">operand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">operand</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NOT</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">operand</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown unary operator: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IfExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IfExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">then_expr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">else_expr</span><span class="p">)</span>


<span class="c1"># â”€â”€â”€ Demo â”€â”€â”€</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Build AST for: (2 + 3) * 4</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">BinaryExpr</span><span class="p">(</span>
        <span class="n">op</span><span class="o">=</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span>
        <span class="n">left</span><span class="o">=</span><span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">right</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">right</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(2 + 3) * 4 = </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Output: 20</span>

    <span class="c1"># Build AST for: if 3 &gt; 2 then 10 else 20</span>
    <span class="n">ast2</span> <span class="o">=</span> <span class="n">IfExpr</span><span class="p">(</span>
        <span class="n">condition</span><span class="o">=</span><span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">GT</span><span class="p">,</span>
            <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">then_expr</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
        <span class="n">else_expr</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">result2</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">ast2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;if 3 &gt; 2 then 10 else 20 = </span><span class="si">{</span><span class="n">result2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Output: 10</span>
</code></pre></div>

<h3 id="34">3.4 ë¬¸ì¥ ë°©ë¬¸ì (ì™„ì „í•œ ì¸í„°í”„ë¦¬í„°)<a class="header-link" href="#34" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Interpreter</span><span class="p">(</span><span class="n">ASTVisitor</span><span class="p">[</span><span class="kc">None</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tree-walking interpreter that executes statement ASTs.</span>

<span class="sd">    Handles variable declarations, assignments, control flow,</span>
<span class="sd">    and function calls.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr_eval</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr_eval</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FuncDecl</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">eval_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_eval</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Program</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Program</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Block</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_ExprStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ExprStmt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_LetStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">LetStmt</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">initializer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">initializer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_AssignStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">AssignStmt</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Can only assign to identifiers&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_PrintStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">PrintStmt</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IfStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IfStmt</span><span class="p">):</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">then_body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">else_body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_WhileStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">WhileStmt</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_FuncDecl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FuncDecl</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>


<span class="c1"># â”€â”€â”€ Demo â”€â”€â”€</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Build AST for:</span>
    <span class="c1">#   let x = 10;</span>
    <span class="c1">#   let y = 20;</span>
    <span class="c1">#   if (x &lt; y) { print(x + y); } else { print(0); }</span>
    <span class="n">program</span> <span class="o">=</span> <span class="n">Program</span><span class="p">(</span><span class="n">statements</span><span class="o">=</span><span class="p">[</span>
        <span class="n">LetStmt</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
        <span class="n">LetStmt</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">20</span><span class="p">)),</span>
        <span class="n">IfStmt</span><span class="p">(</span>
            <span class="n">condition</span><span class="o">=</span><span class="n">BinaryExpr</span><span class="p">(</span>
                <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span>
                <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
                <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">then_body</span><span class="o">=</span><span class="n">Block</span><span class="p">([</span>
                <span class="n">PrintStmt</span><span class="p">(</span><span class="n">BinaryExpr</span><span class="p">(</span>
                    <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
                    <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
                    <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">),</span>
                <span class="p">))</span>
            <span class="p">]),</span>
            <span class="n">else_body</span><span class="o">=</span><span class="n">Block</span><span class="p">([</span>
                <span class="n">PrintStmt</span><span class="p">(</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="p">]),</span>
        <span class="p">),</span>
    <span class="p">])</span>

    <span class="n">interpreter</span> <span class="o">=</span> <span class="n">Interpreter</span><span class="p">()</span>
    <span class="n">interpreter</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
    <span class="c1"># Output: 30</span>
</code></pre></div>

<hr />
<h2 id="4">4. íŠ¸ë¦¬ ìˆœíšŒ ì „ëµ<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41-pre-order-traversal">4.1 ì „ìœ„ ìˆœíšŒ(Pre-Order Traversal)<a class="header-link" href="#41-pre-order-traversal" title="Permanent link">&para;</a></h3>
<p>ìì‹ë³´ë‹¤ <strong>ë¨¼ì €</strong> ë…¸ë“œë¥¼ ë°©ë¬¸í•©ë‹ˆë‹¤. ì‚¬ìš©ì²˜: í”„ë¦°íŒ…, ì§ë ¬í™”, íŠ¸ë¦¬ ë³µì‚¬.</p>
<p>$$\text{visit}(n) = \text{process}(n); \quad \text{visit}(n.\text{child}_1); \quad \text{visit}(n.\text{child}_2); \quad \ldots$$</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preorder</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">ASTNode</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pre-order traversal: visit node, then children.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="n">depth</span> <span class="o">+</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpr</span><span class="p">):</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">UnaryExpr</span><span class="p">):</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">CallExpr</span><span class="p">):</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">callee</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">arguments</span><span class="p">:</span>
            <span class="n">preorder</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Block</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">:</span>
            <span class="n">preorder</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># ... other node types</span>
</code></pre></div>

<h3 id="42-post-order-traversal">4.2 í›„ìœ„ ìˆœíšŒ(Post-Order Traversal)<a class="header-link" href="#42-post-order-traversal" title="Permanent link">&para;</a></h3>
<p>ë…¸ë“œë³´ë‹¤ <strong>ë¨¼ì €</strong> ìì‹ì„ ë°©ë¬¸í•©ë‹ˆë‹¤. ì‚¬ìš©ì²˜: í‰ê°€, ì½”ë“œ ìƒì„±, í•©ì„± ì†ì„±(Synthesized Attributes) ê³„ì‚°.</p>
<p>$$\text{visit}(n) = \text{visit}(n.\text{child}_1); \quad \text{visit}(n.\text{child}_2); \quad \ldots; \quad \text{process}(n)$$</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">postorder_eval</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Post-order evaluation: evaluate children, then compute node.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpr</span><span class="p">):</span>
        <span class="c1"># Evaluate children first (post-order)</span>
        <span class="n">left_val</span> <span class="o">=</span> <span class="n">postorder_eval</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="n">right_val</span> <span class="o">=</span> <span class="n">postorder_eval</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
        <span class="c1"># Then process this node</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">left_val</span> <span class="o">+</span> <span class="n">right_val</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">left_val</span> <span class="o">*</span> <span class="n">right_val</span>
        <span class="c1"># ... other operators</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot evaluate: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="43-in-order-traversal">4.3 ì¤‘ìœ„ ìˆœíšŒ(In-Order Traversal)<a class="header-link" href="#43-in-order-traversal" title="Permanent link">&para;</a></h3>
<p>ì™¼ìª½ ìì‹, ë…¸ë“œ, ì˜¤ë¥¸ìª½ ìì‹ ìˆœìœ¼ë¡œ ë°©ë¬¸í•©ë‹ˆë‹¤. ì£¼ë¡œ ì‚¬ìš©ì²˜: ì¤‘ìœ„ í‘œí˜„ì‹ í”„ë¦°íŒ…, ì´ì§„ íƒìƒ‰ íŠ¸ë¦¬.</p>
<p>$$\text{visit}(n) = \text{visit}(n.\text{left}); \quad \text{process}(n); \quad \text{visit}(n.\text{right})$$</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inorder_print</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">Expr</span><span class="p">,</span> <span class="n">needs_parens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In-order traversal to produce infix notation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpr</span><span class="p">):</span>
        <span class="n">left_str</span> <span class="o">=</span> <span class="n">inorder_print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">right_str</span> <span class="o">=</span> <span class="n">inorder_print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">right_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">needs_parens</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="s2">&quot;?&quot;</span>
</code></pre></div>

<h3 id="44-generic-tree-walker">4.4 ë²”ìš© íŠ¸ë¦¬ ì›Œì»¤(Generic Tree Walker)<a class="header-link" href="#44-generic-tree-walker" title="Permanent link">&para;</a></h3>
<p>ëª¨ë“  AST ë…¸ë“œì˜ ëª¨ë“  ìì‹ì„ ë°©ë¬¸í•˜ëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì›Œì»¤:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">dataclasses</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TreeWalker</span><span class="p">(</span><span class="n">ASTVisitor</span><span class="p">[</span><span class="kc">None</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic walker that visits all children of every node.</span>

<span class="sd">    Override specific visit methods to add behavior.</span>
<span class="sd">    Default behavior: just recurse into children.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generic_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ASTNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visit all children by inspecting dataclass fields.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">is_dataclass</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;loc&quot;</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ASTNode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ASTNode</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">VariableCollector</span><span class="p">(</span><span class="n">TreeWalker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collects all variable names referenced in the AST.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="c1"># Usage:</span>
<span class="c1"># collector = VariableCollector()</span>
<span class="c1"># collector.visit(program_ast)</span>
<span class="c1"># print(collector.variables)  # {&#39;x&#39;, &#39;y&#39;, &#39;z&#39;, ...}</span>
</code></pre></div>

<hr />
<h2 id="5-pretty-printing">5. í”„ë¦¬í‹° í”„ë¦°íŒ…(Pretty Printing)<a class="header-link" href="#5-pretty-printing" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 í”„ë¦¬í‹° í”„ë¦°íŒ…ì´ë€?<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<p><strong>í”„ë¦¬í‹° í”„ë¦°íŒ…(Pretty Printing)</strong>ì€ ASTë¥¼ ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” ì†ŒìŠ¤ ì½”ë“œë¡œ ë³€í™˜í•©ë‹ˆë‹¤. íŒŒì‹±ì˜ ì—­ê³¼ì •ì…ë‹ˆë‹¤. ì¢‹ì€ í”„ë¦¬í‹° í”„ë¦°í„°ëŠ”:</p>
<ul>
<li>êµ¬ë¬¸ì ìœ¼ë¡œ ìœ íš¨í•œ ì¶œë ¥ ìƒì„±</li>
<li>ë“¤ì—¬ì“°ê¸°(Indentation)ë¥¼ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬</li>
<li>ë¶ˆí•„ìš”í•œ ê´„í˜¸ë¥¼ ìµœì†Œí™”</li>
<li>í”„ë¡œê·¸ë¨ì˜ ì˜ë¯¸ë¡ (Semantics)ì„ ë³´ì¡´</li>
</ul>
<h3 id="52">5.2 êµ¬í˜„<a class="header-link" href="#52" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AST Pretty Printer</span>

<span class="sd">Converts AST nodes back into readable source code.</span>
<span class="sd">Handles indentation, operator precedence (for minimal parentheses),</span>
<span class="sd">and multi-line formatting.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PrettyPrinter</span><span class="p">(</span><span class="n">ASTVisitor</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pretty-prints AST nodes to source code strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;    &quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent_str</span> <span class="o">=</span> <span class="n">indent_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent_level</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">indent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_str</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_level</span>

    <span class="c1"># â”€â”€â”€ Operator precedence for minimal parentheses â”€â”€â”€</span>

    <span class="n">PRECEDENCE</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">OR</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">AND</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">NE</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LT</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">GT</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">DIV</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MOD</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">POW</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_expr_precedence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpr</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRECEDENCE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">100</span>  <span class="c1"># literals, identifiers, calls: never need parens</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_paren_if_needed</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">:</span> <span class="n">Expr</span><span class="p">,</span> <span class="n">parent_prec</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_right</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add parentheses if child has lower precedence than parent.&quot;&quot;&quot;</span>
        <span class="n">child_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="n">child_prec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr_precedence</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="n">needs_parens</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">child_prec</span> <span class="o">&lt;</span> <span class="n">parent_prec</span><span class="p">:</span>
            <span class="n">needs_parens</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">child_prec</span> <span class="o">==</span> <span class="n">parent_prec</span> <span class="ow">and</span> <span class="n">is_right</span><span class="p">:</span>
            <span class="c1"># For left-associative operators, right child at same</span>
            <span class="c1"># precedence needs parens: a - (b - c)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">BinaryExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">BinOpKind</span><span class="o">.</span><span class="n">SUB</span><span class="p">,</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">DIV</span><span class="p">,</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MOD</span>
            <span class="p">):</span>
                <span class="n">needs_parens</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">child_str</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">needs_parens</span> <span class="k">else</span> <span class="n">child_str</span>

    <span class="c1"># â”€â”€â”€ Expressions â”€â”€â”€</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IntLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_FloatLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FloatLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BoolLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">BoolLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_StringLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">StringLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Escape special characters</span>
        <span class="n">escaped</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">value</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">t&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">escaped</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_NilLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">NilLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;nil&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BinaryExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">BinaryExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRECEDENCE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">left_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paren_if_needed</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">right_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paren_if_needed</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">is_right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">right_str</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_UnaryExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">UnaryExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">operand_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="n">BinaryExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;-(</span><span class="si">{</span><span class="n">operand_str</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="n">operand_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NOT</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;not </span><span class="si">{</span><span class="n">operand_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="si">}{</span><span class="n">operand_str</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_CallExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">CallExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">callee_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">callee</span><span class="p">)</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">callee_str</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IndexExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IndexExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">obj_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">idx_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj_str</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx_str</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_MemberExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">MemberExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">obj_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj_str</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">member</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IfExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IfExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
        <span class="n">then</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">then_expr</span><span class="p">)</span>
        <span class="n">els</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">else_expr</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;if </span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s2"> then </span><span class="si">{</span><span class="n">then</span><span class="si">}</span><span class="s2"> else </span><span class="si">{</span><span class="n">els</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_ListExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ListExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">elems</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">elems</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_LambdaExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">LambdaExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_param</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;fn(</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">) =&gt; </span><span class="si">{</span><span class="n">body</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># â”€â”€â”€ Statements â”€â”€â”€</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Program</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Program</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Block</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="se">{{}}</span><span class="s2">&quot;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="se">{{</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent_level</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">stmt</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent_level</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_ExprStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ExprStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span><span class="si">}</span><span class="s2">;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_LetStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">LetStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">let </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">type_ann</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">type_ann</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">initializer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">initializer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_AssignStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">AssignStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}{</span><span class="n">target</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_ReturnStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ReturnStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">return </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">return;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IfStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IfStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
        <span class="n">then_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">then_body</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">if (</span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">then_str</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">else_body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">else_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; else </span><span class="si">{</span><span class="n">else_str</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_WhileStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">WhileStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">while (</span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">body</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_ForStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ForStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">iterable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">iterable</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">for (</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">iterable</span><span class="si">}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">body</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_FuncDecl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FuncDecl</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_param</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">return_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">return_type</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">fn </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">ret</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">body</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">fn </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">ret</span><span class="si">}</span><span class="s2">;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_PrintStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">PrintStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="si">}</span><span class="s2">print(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">);&quot;</span>

    <span class="c1"># â”€â”€â”€ Types â”€â”€â”€</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_SimpleType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SimpleType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_ListType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ListType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">inner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">element_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;list[</span><span class="si">{</span><span class="n">inner</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_FuncType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FuncType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">param_types</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">return_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">) -&gt; </span><span class="si">{</span><span class="n">ret</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_OptionalType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">OptionalType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">inner_type</span><span class="p">)</span><span class="si">}</span><span class="s2">?&quot;</span>

    <span class="c1"># â”€â”€â”€ Helpers â”€â”€â”€</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_format_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">type_ann</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">type_ann</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span>


<span class="c1"># â”€â”€â”€ Demo â”€â”€â”€</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">program</span> <span class="o">=</span> <span class="n">Program</span><span class="p">(</span><span class="n">statements</span><span class="o">=</span><span class="p">[</span>
        <span class="n">FuncDecl</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;factorial&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">SimpleType</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">))],</span>
            <span class="n">return_type</span><span class="o">=</span><span class="n">SimpleType</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">),</span>
            <span class="n">body</span><span class="o">=</span><span class="n">Block</span><span class="p">([</span>
                <span class="n">IfStmt</span><span class="p">(</span>
                    <span class="n">condition</span><span class="o">=</span><span class="n">BinaryExpr</span><span class="p">(</span>
                        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span>
                        <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">),</span>
                        <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="n">then_body</span><span class="o">=</span><span class="n">Block</span><span class="p">([</span><span class="n">ReturnStmt</span><span class="p">(</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">1</span><span class="p">))]),</span>
                    <span class="n">else_body</span><span class="o">=</span><span class="n">Block</span><span class="p">([</span>
                        <span class="n">ReturnStmt</span><span class="p">(</span><span class="n">BinaryExpr</span><span class="p">(</span>
                            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span>
                            <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">),</span>
                            <span class="n">CallExpr</span><span class="p">(</span>
                                <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;factorial&quot;</span><span class="p">),</span>
                                <span class="p">[</span><span class="n">BinaryExpr</span><span class="p">(</span>
                                    <span class="n">BinOpKind</span><span class="o">.</span><span class="n">SUB</span><span class="p">,</span>
                                    <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">),</span>
                                    <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                                <span class="p">)],</span>
                            <span class="p">),</span>
                        <span class="p">))</span>
                    <span class="p">]),</span>
                <span class="p">),</span>
            <span class="p">]),</span>
        <span class="p">),</span>
        <span class="n">LetStmt</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="n">SimpleType</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">),</span>
                <span class="n">CallExpr</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;factorial&quot;</span><span class="p">),</span> <span class="p">[</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">5</span><span class="p">)])),</span>
        <span class="n">PrintStmt</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)),</span>
    <span class="p">])</span>

    <span class="n">printer</span> <span class="o">=</span> <span class="n">PrettyPrinter</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">program</span><span class="p">))</span>
</code></pre></div>

<p><strong>ì¶œë ¥:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">fn</span><span class="w"> </span><span class="nt">factorial</span><span class="o">(</span><span class="nt">n</span><span class="o">:</span><span class="w"> </span><span class="nt">int</span><span class="o">)</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(n</span><span class="w"> </span><span class="err">&lt;=</span><span class="w"> </span><span class="err">1)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="err">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="err">n</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">factorial(n</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">1)</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span>
<span class="nt">let</span><span class="w"> </span><span class="nt">result</span><span class="o">:</span><span class="w"> </span><span class="nt">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">factorial</span><span class="o">(</span><span class="nt">5</span><span class="o">);</span>
<span class="nt">print</span><span class="o">(</span><span class="nt">result</span><span class="o">);</span>
</code></pre></div>

<hr />
<h2 id="6-ast">6. AST ë³€í™˜<a class="header-link" href="#6-ast" title="Permanent link">&para;</a></h2>
<h3 id="61-constant-folding">6.1 ìƒìˆ˜ í´ë”©(Constant Folding)<a class="header-link" href="#61-constant-folding" title="Permanent link">&para;</a></h3>
<p><strong>ìƒìˆ˜ í´ë”©(Constant Folding)</strong>ì€ ì»´íŒŒì¼ íƒ€ì„ì— ì•Œë ¤ì§„ ê°’ì„ ê°€ì§„ í‘œí˜„ì‹ì„ í‰ê°€í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConstantFolder</span><span class="p">(</span><span class="n">ASTVisitor</span><span class="p">[</span><span class="n">ASTNode</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constant folding: evaluate constant expressions at compile time.</span>

<span class="sd">    Examples:</span>
<span class="sd">        2 + 3       =&gt;  5</span>
<span class="sd">        4 * 1       =&gt;  4 (identity)</span>
<span class="sd">        0 * x       =&gt;  0 (zero multiplication)</span>
<span class="sd">        x + 0       =&gt;  x (identity)</span>
<span class="sd">        true and x  =&gt;  x (short-circuit simplification)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IntLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_FloatLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">FloatLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BoolLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">BoolLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_StringLiteral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">StringLiteral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BinaryExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">BinaryExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>

        <span class="c1"># Both operands are integer literals: compute at compile time</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_int_op</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">left</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">BoolLiteral</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">):</span>
                <span class="k">pass</span>  <span class="c1"># Cannot fold; leave as-is</span>

        <span class="c1"># Identity simplifications</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="ow">and</span> <span class="n">left</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">right</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="ow">and</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">left</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="ow">and</span> <span class="n">left</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">right</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="ow">and</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">left</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="ow">and</span> <span class="n">left</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="ow">and</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span> <span class="ow">and</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">left</span>

        <span class="c1"># Return simplified node</span>
        <span class="k">return</span> <span class="n">BinaryExpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_UnaryExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">UnaryExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="n">operand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="o">-</span><span class="n">operand</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NOT</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">BoolLiteral</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">BoolLiteral</span><span class="p">(</span><span class="ow">not</span> <span class="n">operand</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>

        <span class="c1"># Double negation elimination: --x =&gt; x</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">UnaryExpr</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">operand</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">operand</span><span class="o">.</span><span class="n">operand</span>

        <span class="k">return</span> <span class="n">UnaryExpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_eval_int_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">BinOpKind</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">DIV</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">//</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MOD</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">POW</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">**</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">NE</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LT</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">GT</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">,</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ops</span><span class="p">[</span><span class="n">op</span><span class="p">]()</span>

    <span class="c1"># Pass through for other nodes (transform children)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_CallExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">CallExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">callee</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">arguments</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">CallExpr</span><span class="p">(</span><span class="n">callee</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_IfExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IfExpr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">BoolLiteral</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cond</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">then_expr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">else_expr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">IfExpr</span><span class="p">(</span>
            <span class="n">cond</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">then_expr</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">else_expr</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span>
        <span class="p">)</span>


<span class="c1"># â”€â”€â”€ Demo â”€â”€â”€</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># AST for: (2 + 3) * x + 0</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">BinaryExpr</span><span class="p">(</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
        <span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span>
            <span class="n">BinaryExpr</span><span class="p">(</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span>
            <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">printer</span> <span class="o">=</span> <span class="n">PrettyPrinter</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before: </span><span class="si">{</span><span class="n">printer</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Before: (2 + 3) * x + 0</span>

    <span class="n">folder</span> <span class="o">=</span> <span class="n">ConstantFolder</span><span class="p">()</span>
    <span class="n">folded</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After:  </span><span class="si">{</span><span class="n">printer</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">folded</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># After:  5 * x</span>
</code></pre></div>

<h3 id="62-desugaring">6.2 ë””ìŠˆê°€ë§(Desugaring)<a class="header-link" href="#62-desugaring" title="Permanent link">&para;</a></h3>
<p><strong>ë””ìŠˆê°€ë§(Desugaring)</strong>ì€ ë¬¸ë²•ì  ì„¤íƒ•ì„ ë” ê°„ë‹¨í•œ í•µì‹¬ êµ¬ì¡°ë¡œ ë³€í™˜í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Desugarer</span><span class="p">(</span><span class="n">ASTVisitor</span><span class="p">[</span><span class="n">ASTNode</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform syntactic sugar into core language constructs.</span>

<span class="sd">    Examples:</span>
<span class="sd">        for (x in list) { body }</span>
<span class="sd">            =&gt; let _iter = list;</span>
<span class="sd">               let _i = 0;</span>
<span class="sd">               while (_i &lt; len(_iter)) {</span>
<span class="sd">                   let x = _iter[_i];</span>
<span class="sd">                   body;</span>
<span class="sd">                   _i = _i + 1;</span>
<span class="sd">               }</span>

<span class="sd">        x += 5  =&gt;  x = x + 5</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_temp_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fresh_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_tmp&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_temp_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_temp_counter</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_ForStmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ForStmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Block</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Desugar for-in loop to while loop.&quot;&quot;&quot;</span>
        <span class="n">iter_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fresh_name</span><span class="p">(</span><span class="s2">&quot;_iter&quot;</span><span class="p">)</span>
        <span class="n">idx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fresh_name</span><span class="p">(</span><span class="s2">&quot;_i&quot;</span><span class="p">)</span>

        <span class="n">iterable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">iterable</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Block</span><span class="p">(</span><span class="n">statements</span><span class="o">=</span><span class="p">[</span>
            <span class="c1"># let _iter = iterable;</span>
            <span class="n">LetStmt</span><span class="p">(</span><span class="n">iter_name</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="n">iterable</span><span class="p">),</span>
            <span class="c1"># let _i = 0;</span>
            <span class="n">LetStmt</span><span class="p">(</span><span class="n">idx_name</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
            <span class="c1"># while (_i &lt; len(_iter)) { ... }</span>
            <span class="n">WhileStmt</span><span class="p">(</span>
                <span class="n">condition</span><span class="o">=</span><span class="n">BinaryExpr</span><span class="p">(</span>
                    <span class="n">BinOpKind</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span>
                    <span class="n">Identifier</span><span class="p">(</span><span class="n">idx_name</span><span class="p">),</span>
                    <span class="n">CallExpr</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">),</span> <span class="p">[</span><span class="n">Identifier</span><span class="p">(</span><span class="n">iter_name</span><span class="p">)]),</span>
                <span class="p">),</span>
                <span class="n">body</span><span class="o">=</span><span class="n">Block</span><span class="p">(</span><span class="n">statements</span><span class="o">=</span><span class="p">[</span>
                    <span class="c1"># let x = _iter[_i];</span>
                    <span class="n">LetStmt</span><span class="p">(</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span>
                        <span class="n">initializer</span><span class="o">=</span><span class="n">IndexExpr</span><span class="p">(</span>
                            <span class="n">Identifier</span><span class="p">(</span><span class="n">iter_name</span><span class="p">),</span>
                            <span class="n">Identifier</span><span class="p">(</span><span class="n">idx_name</span><span class="p">),</span>
                        <span class="p">),</span>
                    <span class="p">),</span>
                    <span class="c1"># original body</span>
                    <span class="n">body</span><span class="p">,</span>
                    <span class="c1"># _i = _i + 1;</span>
                    <span class="n">AssignStmt</span><span class="p">(</span>
                        <span class="n">Identifier</span><span class="p">(</span><span class="n">idx_name</span><span class="p">),</span>
                        <span class="n">BinaryExpr</span><span class="p">(</span>
                            <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
                            <span class="n">Identifier</span><span class="p">(</span><span class="n">idx_name</span><span class="p">),</span>
                            <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                        <span class="p">),</span>
                    <span class="p">),</span>
                <span class="p">]),</span>
            <span class="p">),</span>
        <span class="p">])</span>

    <span class="c1"># ... other visit methods pass through unchanged</span>
</code></pre></div>

<hr />
<h2 id="7-source-location-tracking">7. ì†ŒìŠ¤ ìœ„ì¹˜ ì¶”ì (Source Location Tracking)<a class="header-link" href="#7-source-location-tracking" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 ìœ„ì¹˜ë¥¼ ì¶”ì í•˜ëŠ” ì´ìœ ?<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<p>ì†ŒìŠ¤ ìœ„ì¹˜ëŠ” ë‹¤ìŒì„ ìœ„í•´ í•„ìˆ˜ì ì…ë‹ˆë‹¤:</p>
<ol>
<li><strong>ì˜¤ë¥˜ ë©”ì‹œì§€</strong>: "42ë²ˆì§¸ ì¤„, 15ë²ˆì§¸ ì—´ì—ì„œ íƒ€ì… ì˜¤ë¥˜"</li>
<li><strong>ë””ë²„ê±° ì§€ì›</strong>: ì»´íŒŒì¼ëœ ì½”ë“œë¥¼ ì†ŒìŠ¤ ë¼ì¸ìœ¼ë¡œ ë§¤í•‘</li>
<li><strong>IDE ê¸°ëŠ¥</strong>: ì •ì˜ë¡œ ì´ë™(Go-to-definition), í˜¸ë²„ ì •ë³´, ë¦¬íŒ©í† ë§</li>
<li><strong>ì†ŒìŠ¤ ë§µ(Source Maps)</strong>: ìƒì„±ëœ JavaScriptë¥¼ TypeScriptë¡œ ë§¤í•‘</li>
</ol>
<h3 id="72">7.2 ìœ„ì¹˜ ì „íŒŒ<a class="header-link" href="#72" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_binary_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a binary expression, tracking source locations.&quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_token</span><span class="o">.</span><span class="n">loc</span>  <span class="c1"># Remember start position</span>

    <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_unary_expr</span><span class="p">()</span>

    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_token</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">TokenType</span><span class="o">.</span><span class="n">PLUS</span><span class="p">,</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">MINUS</span><span class="p">,</span>
        <span class="n">TokenType</span><span class="o">.</span><span class="n">STAR</span><span class="p">,</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">SLASH</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">op_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advance</span><span class="p">()</span>
        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_unary_expr</span><span class="p">()</span>

        <span class="c1"># Create node with location spanning left to right</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">token_to_binop</span><span class="p">(</span><span class="n">op_token</span><span class="p">),</span>
            <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">SourceLocation</span><span class="p">(</span>
                <span class="n">line</span><span class="o">=</span><span class="n">start</span><span class="o">.</span><span class="n">line</span><span class="p">,</span>
                <span class="n">column</span><span class="o">=</span><span class="n">start</span><span class="o">.</span><span class="n">column</span><span class="p">,</span>
                <span class="n">end_line</span><span class="o">=</span><span class="n">right</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">end_line</span> <span class="k">if</span> <span class="n">right</span><span class="o">.</span><span class="n">loc</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">end_column</span><span class="o">=</span><span class="n">right</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">end_column</span> <span class="k">if</span> <span class="n">right</span><span class="o">.</span><span class="n">loc</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">start</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">left</span>
</code></pre></div>

<h3 id="73">7.3 ìœ„ì¹˜ë¥¼ ì´ìš©í•œ ì˜¤ë¥˜ ë³´ê³ <a class="header-link" href="#73" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CompilerError</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A compiler error with source location and context.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">loc</span><span class="p">:</span> <span class="n">SourceLocation</span><span class="p">,</span>
        <span class="n">source_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_lines</span> <span class="o">=</span> <span class="n">source_lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">severity</span> <span class="o">=</span> <span class="n">severity</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the error like Rust/GCC-style diagnostics.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">severity</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;  --&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">line</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_lines</span><span class="p">):</span>
            <span class="n">line_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">line</span>
            <span class="n">source_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_lines</span><span class="p">[</span><span class="n">line_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   |&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line_num</span><span class="si">:</span><span class="s2">&gt;3</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">source_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Underline the error location</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">end_column</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">end_column</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">underline</span> <span class="o">=</span> <span class="s2">&quot;^&quot;</span> <span class="o">*</span> <span class="n">length</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   | </span><span class="si">{</span><span class="n">padding</span><span class="si">}{</span><span class="n">underline</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="c1"># Example output:</span>
<span class="c1">#</span>
<span class="c1"># error: Type mismatch: expected int, found string</span>
<span class="c1">#   --&gt; main.lang:42:15</span>
<span class="c1">#    |</span>
<span class="c1">#  42 |     let x: int = &quot;hello&quot;;</span>
<span class="c1">#    |                ^^^^^^^</span>
</code></pre></div>

<hr />
<h2 id="8-ast-pattern-matching">8. ASTì—ì„œì˜ íŒ¨í„´ ë§¤ì¹­(Pattern Matching)<a class="header-link" href="#8-ast-pattern-matching" title="Permanent link">&para;</a></h2>
<h3 id="81-python-310">8.1 Python 3.10+ êµ¬ì¡°ì  íŒ¨í„´ ë§¤ì¹­<a class="header-link" href="#81-python-310" title="Permanent link">&para;</a></h3>
<p>Python 3.10ì€ ë°ì´í„°í´ë˜ìŠ¤ ê¸°ë°˜ ASTì™€ ì˜ ì–´ìš¸ë¦¬ëŠ” <code>match</code>/<code>case</code> ë¬¸ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simplify</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplify expressions using pattern matching.</span>

<span class="sd">    Python 3.10+ structural pattern matching provides a clean</span>
<span class="sd">    way to match and transform AST nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">match</span> <span class="n">expr</span><span class="p">:</span>
        <span class="c1"># Constant folding: literal + literal</span>
        <span class="k">case</span> <span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">a</span><span class="p">),</span>
            <span class="n">right</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">b</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">case</span> <span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">a</span><span class="p">),</span>
            <span class="n">right</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">b</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>

        <span class="c1"># Identity: x + 0 =&gt; x</span>
        <span class="k">case</span> <span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">simplify</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Identity: 0 + x =&gt; x</span>
        <span class="k">case</span> <span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">right</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">simplify</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Identity: x * 1 =&gt; x</span>
        <span class="k">case</span> <span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">simplify</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Absorbing: x * 0 =&gt; 0</span>
        <span class="k">case</span> <span class="n">BinaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Double negation: --x =&gt; x</span>
        <span class="k">case</span> <span class="n">UnaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span><span class="p">,</span>
            <span class="n">operand</span><span class="o">=</span><span class="n">UnaryExpr</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span><span class="p">,</span> <span class="n">operand</span><span class="o">=</span><span class="n">inner</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">simplify</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>

        <span class="c1"># Not not x =&gt; x</span>
        <span class="k">case</span> <span class="n">UnaryExpr</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NOT</span><span class="p">,</span>
            <span class="n">operand</span><span class="o">=</span><span class="n">UnaryExpr</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NOT</span><span class="p">,</span> <span class="n">operand</span><span class="o">=</span><span class="n">inner</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">simplify</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>

        <span class="c1"># If true =&gt; then branch</span>
        <span class="k">case</span> <span class="n">IfExpr</span><span class="p">(</span>
            <span class="n">condition</span><span class="o">=</span><span class="n">BoolLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">then_expr</span><span class="o">=</span><span class="n">then_e</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">simplify</span><span class="p">(</span><span class="n">then_e</span><span class="p">)</span>

        <span class="c1"># If false =&gt; else branch</span>
        <span class="k">case</span> <span class="n">IfExpr</span><span class="p">(</span>
            <span class="n">condition</span><span class="o">=</span><span class="n">BoolLiteral</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">else_expr</span><span class="o">=</span><span class="n">else_e</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">simplify</span><span class="p">(</span><span class="n">else_e</span><span class="p">)</span>

        <span class="c1"># Default: recurse into children</span>
        <span class="k">case</span> <span class="n">BinaryExpr</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">BinaryExpr</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">simplify</span><span class="p">(</span><span class="n">left</span><span class="p">),</span> <span class="n">simplify</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>

        <span class="k">case</span> <span class="n">UnaryExpr</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">operand</span><span class="o">=</span><span class="n">operand</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">UnaryExpr</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">simplify</span><span class="p">(</span><span class="n">operand</span><span class="p">))</span>

        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expr</span>
</code></pre></div>

<h3 id="82-310-isinstance">8.2 3.10 ì´ì „ ëŒ€ì•ˆ: isinstance ì²´ì¸<a class="header-link" href="#82-310-isinstance" title="Permanent link">&para;</a></h3>
<p>Python 3.10 ì´ì „ ë²„ì „ì—ì„œëŠ” ì „í†µì ì¸ ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simplify_compat</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pattern matching using isinstance (Python &lt; 3.10).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">BinaryExpr</span><span class="p">):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">simplify_compat</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">simplify_compat</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>

        <span class="c1"># Constant folding</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Identity: x + 0 =&gt; x</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">expr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">left</span>

        <span class="k">return</span> <span class="n">BinaryExpr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">UnaryExpr</span><span class="p">):</span>
        <span class="n">operand</span> <span class="o">=</span> <span class="n">simplify_compat</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">expr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">UnaryExpr</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">operand</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">UnaryOpKind</span><span class="o">.</span><span class="n">NEG</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">operand</span><span class="o">.</span><span class="n">operand</span>

        <span class="k">return</span> <span class="n">UnaryExpr</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">operand</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">expr</span>
</code></pre></div>

<hr />
<h2 id="9-ast-serialization">9. AST ì§ë ¬í™”(Serialization)<a class="header-link" href="#9-ast-serialization" title="Permanent link">&para;</a></h2>
<h3 id="91-json">9.1 JSON ì§ë ¬í™”<a class="header-link" href="#91-json" title="Permanent link">&para;</a></h3>
<p>JSONì€ Babel(JavaScript), rustc, ë§ì€ LSP êµ¬í˜„ì²´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ASTì˜ ê°€ì¥ ì¼ë°˜ì ì¸ ì§ë ¬í™” í˜•ì‹ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AST Serialization to JSON and S-expressions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dataclasses</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ASTSerializer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize AST nodes to JSON-compatible dictionaries.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ASTNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an AST node to a JSON-serializable dictionary.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">is_dataclass</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_serialize_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize a field value.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ASTNode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_serialize_value</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">SourceLocation</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">line</span><span class="p">,</span>
                <span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">column</span><span class="p">,</span>
                <span class="s2">&quot;end_line&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">end_line</span><span class="p">,</span>
                <span class="s2">&quot;end_column&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">end_column</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ASTNode</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert an AST node to a JSON string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ASTNode</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct an AST node from a dictionary.&quot;&quot;&quot;</span>
        <span class="c1"># This requires a registry of node types</span>
        <span class="n">node_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;IntLiteral&quot;</span><span class="p">:</span> <span class="n">IntLiteral</span><span class="p">,</span>
            <span class="s2">&quot;FloatLiteral&quot;</span><span class="p">:</span> <span class="n">FloatLiteral</span><span class="p">,</span>
            <span class="s2">&quot;BoolLiteral&quot;</span><span class="p">:</span> <span class="n">BoolLiteral</span><span class="p">,</span>
            <span class="s2">&quot;StringLiteral&quot;</span><span class="p">:</span> <span class="n">StringLiteral</span><span class="p">,</span>
            <span class="s2">&quot;Identifier&quot;</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">,</span>
            <span class="s2">&quot;BinaryExpr&quot;</span><span class="p">:</span> <span class="n">BinaryExpr</span><span class="p">,</span>
            <span class="s2">&quot;UnaryExpr&quot;</span><span class="p">:</span> <span class="n">UnaryExpr</span><span class="p">,</span>
            <span class="s2">&quot;CallExpr&quot;</span><span class="p">:</span> <span class="n">CallExpr</span><span class="p">,</span>
            <span class="s2">&quot;LetStmt&quot;</span><span class="p">:</span> <span class="n">LetStmt</span><span class="p">,</span>
            <span class="s2">&quot;PrintStmt&quot;</span><span class="p">:</span> <span class="n">PrintStmt</span><span class="p">,</span>
            <span class="s2">&quot;Program&quot;</span><span class="p">:</span> <span class="n">Program</span><span class="p">,</span>
            <span class="c1"># ... register all node types</span>
        <span class="p">}</span>

        <span class="n">type_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown AST node type: </span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">cls</span> <span class="o">=</span> <span class="n">node_types</span><span class="p">[</span><span class="n">type_name</span><span class="p">]</span>
        <span class="c1"># Reconstruct fields (simplified -- real implementation</span>
        <span class="c1"># would need recursive deserialization)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;_type&quot;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c1"># â”€â”€â”€ Demo â”€â”€â”€</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">BinaryExpr</span><span class="p">(</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
        <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">BinaryExpr</span><span class="p">(</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">serializer</span> <span class="o">=</span> <span class="n">ASTSerializer</span><span class="p">()</span>
    <span class="n">json_str</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JSON representation:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
</code></pre></div>

<p><strong>ì¶œë ¥:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BinaryExpr&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;op&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;left&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IntLiteral&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;loc&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;right&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BinaryExpr&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;op&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;left&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IntLiteral&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;loc&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;right&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IntLiteral&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;loc&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;loc&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;loc&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="92-s-s-expression">9.2 S-í‘œí˜„ì‹(S-Expression) ì§ë ¬í™”<a class="header-link" href="#92-s-s-expression" title="Permanent link">&para;</a></h3>
<p>S-í‘œí˜„ì‹ì€ ì½ê³  íŒŒì‹±í•˜ê¸° ì‰¬ìš´ Lisp ìŠ¤íƒ€ì¼ì˜ ì»´íŒ©íŠ¸í•œ í‘œí˜„ì„ ì œê³µí•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SExprSerializer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize AST to S-expression format.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_sexpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ASTNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert AST to S-expression string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">FloatLiteral</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BoolLiteral</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;#t&quot;</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;#f&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">StringLiteral</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">NilLiteral</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;nil&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpr</span><span class="p">):</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">left</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">right</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">UnaryExpr</span><span class="p">):</span>
            <span class="n">operand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">operand</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">CallExpr</span><span class="p">):</span>
            <span class="n">callee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">callee</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(call </span><span class="si">{</span><span class="n">callee</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">LetStmt</span><span class="p">):</span>
            <span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">initializer</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">initializer</span> <span class="k">else</span> <span class="s2">&quot;nil&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(let </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">init</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">IfStmt</span><span class="p">):</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
            <span class="n">then</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">then_body</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">:</span>
                <span class="n">els</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">)</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(if </span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">then</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">els</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(if </span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">then</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Block</span><span class="p">):</span>
            <span class="n">stmts</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(block </span><span class="si">{</span><span class="n">stmts</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">PrintStmt</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(print </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Program</span><span class="p">):</span>
            <span class="n">stmts</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">statements</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(program </span><span class="si">{</span><span class="n">stmts</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">FuncDecl</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="k">else</span> <span class="s2">&quot;()&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(fn </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">body</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ReturnStmt</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(return </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">return</span> <span class="s2">&quot;(return)&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">WhileStmt</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;(while </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">AssignStmt</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;(set! </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ExprStmt</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(&lt;unknown&gt; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="c1"># â”€â”€â”€ Demo â”€â”€â”€</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">BinaryExpr</span><span class="p">(</span>
        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span>
        <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">BinaryExpr</span><span class="p">(</span><span class="n">BinOpKind</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">sexpr</span> <span class="o">=</span> <span class="n">SExprSerializer</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sexpr</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">ast</span><span class="p">))</span>
    <span class="c1"># Output: (+ 2 (* 3 x))</span>

    <span class="c1"># A more complex program</span>
    <span class="n">program</span> <span class="o">=</span> <span class="n">Program</span><span class="p">(</span><span class="n">statements</span><span class="o">=</span><span class="p">[</span>
        <span class="n">LetStmt</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="n">IntLiteral</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
        <span class="n">WhileStmt</span><span class="p">(</span>
            <span class="n">condition</span><span class="o">=</span><span class="n">BinaryExpr</span><span class="p">(</span>
                <span class="n">BinOpKind</span><span class="o">.</span><span class="n">GT</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">body</span><span class="o">=</span><span class="n">Block</span><span class="p">([</span>
                <span class="n">PrintStmt</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)),</span>
                <span class="n">AssignStmt</span><span class="p">(</span>
                    <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
                    <span class="n">BinaryExpr</span><span class="p">(</span>
                        <span class="n">BinOpKind</span><span class="o">.</span><span class="n">SUB</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">IntLiteral</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">]),</span>
        <span class="p">),</span>
    <span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">sexpr</span><span class="o">.</span><span class="n">to_sexpr</span><span class="p">(</span><span class="n">program</span><span class="p">))</span>
    <span class="c1"># Output: (program (let x 10) (while (&gt; x 0) (block (print x) (set! x (- x 1)))))</span>
</code></pre></div>

<hr />
<h2 id="10-ast">10. ì‹¤ì œ ì„¸ê³„ì˜ AST ì˜ˆì‹œ<a class="header-link" href="#10-ast" title="Permanent link">&para;</a></h2>
<h3 id="101-python-ast">10.1 Pythonì˜ ast ëª¨ë“ˆ<a class="header-link" href="#101-python-ast" title="Permanent link">&para;</a></h3>
<p>Pythonì€ CPythonì´ ì‚¬ìš©í•˜ëŠ” ASTë¥¼ ë…¸ì¶œí•˜ëŠ” ë‚´ì¥ <code>ast</code> ëª¨ë“ˆì„ ì œê³µí•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>

<span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">def factorial(n):</span>
<span class="s2">    if n &lt;= 1:</span>
<span class="s2">        return 1</span>
<span class="s2">    return n * factorial(n - 1)</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<p><strong>ì¶œë ¥ (ì¶•ì•½):</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">Module</span><span class="p">(</span>
<span class="w">  </span><span class="n">body</span><span class="o">=[</span>
<span class="w">    </span><span class="n">FunctionDef</span><span class="p">(</span>
<span class="w">      </span><span class="n">name</span><span class="o">=</span><span class="c">&#39;factorial&#39;,</span>
<span class="w">      </span><span class="n">args</span><span class="o">=</span><span class="n">arguments</span><span class="p">(</span><span class="n">args</span><span class="o">=[</span><span class="n">arg</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="c">&#39;n&#39;)]),</span>
<span class="w">      </span><span class="n">body</span><span class="o">=[</span>
<span class="w">        </span><span class="k">If</span><span class="p">(</span>
<span class="w">          </span><span class="n">test</span><span class="o">=</span><span class="n">Compare</span><span class="p">(</span>
<span class="w">            </span><span class="n">left</span><span class="o">=</span><span class="n">Name</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="c">&#39;n&#39;),</span>
<span class="w">            </span><span class="n">ops</span><span class="o">=[</span><span class="n">LtE</span><span class="p">()</span><span class="o">]</span><span class="p">,</span>
<span class="w">            </span><span class="n">comparators</span><span class="o">=[</span><span class="n">Constant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">]</span>
<span class="w">          </span><span class="p">),</span>
<span class="w">          </span><span class="n">body</span><span class="o">=[</span><span class="k">Return</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">Constant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">]</span><span class="p">,</span>
<span class="w">          </span><span class="ow">orelse</span><span class="o">=[]</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="k">Return</span><span class="p">(</span>
<span class="w">          </span><span class="n">value</span><span class="o">=</span><span class="n">BinOp</span><span class="p">(</span>
<span class="w">            </span><span class="n">left</span><span class="o">=</span><span class="n">Name</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="c">&#39;n&#39;),</span>
<span class="w">            </span><span class="n">op</span><span class="o">=</span><span class="n">Mult</span><span class="p">(),</span>
<span class="w">            </span><span class="n">right</span><span class="o">=</span><span class="k">Call</span><span class="p">(</span>
<span class="w">              </span><span class="n">func</span><span class="o">=</span><span class="n">Name</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="c">&#39;factorial&#39;),</span>
<span class="w">              </span><span class="n">args</span><span class="o">=[</span><span class="n">BinOp</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">Name</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="c">&#39;n&#39;), op=Sub(), right=Constant(value=1))]</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">          </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">      </span><span class="o">]</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="o">]</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="102-rust-syn-crate">10.2 Rustì˜ syn í¬ë ˆì´íŠ¸(Crate)<a class="header-link" href="#102-rust-syn-crate" title="Permanent link">&para;</a></h3>
<p>Rustì˜ <code>syn</code> í¬ë ˆì´íŠ¸ëŠ” Rust ì†ŒìŠ¤ ì½”ë“œë¥¼ AST íƒ€ì…ìœ¼ë¡œ íŒŒì‹±í•©ë‹ˆë‹¤. ASTëŠ” <code>ExprBinary</code>, <code>ExprIf</code>, <code>ItemFn</code> ë“±ì˜ íƒ€ì…ìœ¼ë¡œ Rust ë¬¸ë²•ì„ ë°€ì ‘í•˜ê²Œ ë°˜ì˜í•©ë‹ˆë‹¤.</p>
<h3 id="103-babel-javascript">10.3 Babel (JavaScript)<a class="header-link" href="#103-babel-javascript" title="Permanent link">&para;</a></h3>
<p>Babelì€ JavaScriptì˜ í‘œì¤€ ë…¸ë“œ íƒ€ì…ì„ ì •ì˜í•˜ëŠ” <strong>ESTree</strong> AST ëª…ì„¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ASTëŠ” <code>type</code> í•„ë“œë¥¼ ê°€ì§„ JSON ê°ì²´ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.</p>
<hr />
<h2 id="11">11. ìš”ì•½<a class="header-link" href="#11" title="Permanent link">&para;</a></h2>
<p>ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ëŠ” ëª¨ë“  ì»´íŒŒì¼ëŸ¬ë‚˜ ì–¸ì–´ ë„êµ¬ì˜ ì¤‘ì‹¬ ë°ì´í„° êµ¬ì¡°ì…ë‹ˆë‹¤. ì†ŒìŠ¤ í”„ë¡œê·¸ë¨ì˜ ê¹”ë”í•˜ê³  êµ¬ì¡°ì ì¸ í‘œí˜„ì„ ì œê³µí•˜ì—¬ ë¶„ì„ê³¼ ë³€í™˜ì— ì í•©í•©ë‹ˆë‹¤.</p>
<p><strong>í•µì‹¬ ê°œë…:</strong></p>
<table>
<thead>
<tr>
<th>ê°œë…</th>
<th>ì„¤ëª…</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>CST vs AST</strong></td>
<td>CSTëŠ” ë¬¸ë²•ì„ ë°˜ì˜; ASTëŠ” ì˜ë¯¸ì  êµ¬ì¡°ë¥¼ í¬ì°©</td>
</tr>
<tr>
<td><strong>ë…¸ë“œ ì„¤ê³„</strong></td>
<td>ëª…í™•í•œ íƒ€ì… ê³„ì¸µì„ ê°€ì§„ ë°ì´í„°í´ë˜ìŠ¤/ëŒ€ìˆ˜ì  íƒ€ì… ì‚¬ìš©</td>
</tr>
<tr>
<td><strong>ë°©ë¬¸ì íŒ¨í„´</strong></td>
<td>ìˆœíšŒ ë¡œì§ì„ ë…¸ë“œ ì •ì˜ì—ì„œ ë¶„ë¦¬</td>
</tr>
<tr>
<td><strong>ì „ìœ„/í›„ìœ„/ì¤‘ìœ„ ìˆœíšŒ</strong></td>
<td>ë‹¤ë¥¸ ëª©ì ì„ ìœ„í•œ ë‹¤ë¥¸ ìˆœíšŒ ìˆœì„œ</td>
</tr>
<tr>
<td><strong>í”„ë¦¬í‹° í”„ë¦°íŒ…</strong></td>
<td>ASTë¥¼ ì½ê¸° ì‰¬ìš´ ì†ŒìŠ¤ ì½”ë“œë¡œ ë³€í™˜</td>
</tr>
<tr>
<td><strong>ìƒìˆ˜ í´ë”©</strong></td>
<td>ì»´íŒŒì¼ íƒ€ì„ì— ì•Œë ¤ì§„ í‘œí˜„ì‹ í‰ê°€</td>
</tr>
<tr>
<td><strong>ë””ìŠˆê°€ë§</strong></td>
<td>ë¬¸ë²•ì  ì„¤íƒ•ì„ í•µì‹¬ êµ¬ì¡°ë¡œ ë‹¨ìˆœí™”</td>
</tr>
<tr>
<td><strong>ì†ŒìŠ¤ ìœ„ì¹˜</strong></td>
<td>ì˜¤ë¥˜ ë³´ê³ ë¥¼ ìœ„í•´ ê° êµ¬ì¡°ê°€ ë‚˜íƒ€ë‚˜ëŠ” ìœ„ì¹˜ ì¶”ì </td>
</tr>
<tr>
<td><strong>ì§ë ¬í™”</strong></td>
<td>ë„êµ¬ ìƒí˜¸ ìš´ìš©ì„±ì„ ìœ„í•œ JSONê³¼ S-í‘œí˜„ì‹</td>
</tr>
</tbody>
</table>
<p><strong>ì„¤ê³„ ê°€ì´ë“œë¼ì¸:</strong></p>
<ol>
<li>AST ë…¸ë“œë¥¼ ìµœì†Œí•œìœ¼ë¡œ ìœ ì§€ -- íŒŒì‹± ì¤‘ ë˜ëŠ” í›„ì— ë””ìŠˆê°€ë§</li>
<li>íƒ€ì… ì•ˆì „ì„±ì„ ìœ„í•´ ëŒ€ìˆ˜ì  ë°ì´í„° íƒ€ì…(ë˜ëŠ” ë°ì´í„°í´ë˜ìŠ¤ + ì—´ê±°í˜•) ì‚¬ìš©</li>
<li>ì¢‹ì€ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ìœ„í•´ í•­ìƒ ì†ŒìŠ¤ ìœ„ì¹˜ í¬í•¨</li>
<li>ë…¸ë“œë¥¼ ë¶ˆë³€ìœ¼ë¡œ ë§Œë“¤ê¸°; ë³€í™˜ì€ ìƒˆë¡œìš´ íŠ¸ë¦¬ ìƒì„±</li>
<li>ë°©ë¬¸ì íŒ¨í„´ì€ ë§ì€ ë¶„ì„ íŒ¨ìŠ¤ì—ì„œ ì˜ í™•ì¥ë¨</li>
<li>ë„êµ¬ì™€ì˜ ìƒí˜¸ ìš´ìš©ì„±ì´ í•„ìš”í•œ ê²½ìš° ì§ë ¬í™”ë¥¼ ì¼ì° ê³ ë ¤</li>
</ol>
<hr />
<h2 id="_2">ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="1-ast_1">ì—°ìŠµ 1: AST ë…¸ë“œ ì„¤ê³„<a class="header-link" href="#1-ast_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ì–¸ì–´ ê¸°ëŠ¥ì— ëŒ€í•œ AST ë…¸ë“œ íƒ€ì…ì„ (Python ë°ì´í„°í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬) ì„¤ê³„í•˜ì„¸ìš”:</p>
<ol>
<li>ë°°ì—´ ë¦¬í„°ëŸ´: <code>[1, 2, 3]</code></li>
<li>ë”•ì…”ë„ˆë¦¬ ë¦¬í„°ëŸ´: <code>{key: value, ...}</code></li>
<li>ìŠ¬ë¼ì´ìŠ¤ í‘œí˜„ì‹: <code>a[1:5]</code>, <code>a[:3]</code>, <code>a[::2]</code></li>
<li>Try-catch: <code>try { ... } catch (e: Error) { ... } finally { ... }</code></li>
<li>íŒ¨í„´ ë§¤ì¹­: <code>match x { 1 =&gt; "one", 2 =&gt; "two", _ =&gt; "other" }</code></li>
</ol>
<h3 id="2">ì—°ìŠµ 2: ì™„ì „í•œ ë°©ë¬¸ì<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<p>í‘œí˜„ì‹ ASTì˜ ìµœëŒ€ ê¹Šì´ë¥¼ ê³„ì‚°í•˜ëŠ” <code>DepthCalculator</code> ë°©ë¬¸ìë¥¼ êµ¬í˜„í•˜ì„¸ìš”. ì˜ˆë¥¼ ë“¤ì–´, <code>IntLiteral(5)</code>ì˜ ê¹Šì´ëŠ” 1ì´ê³ , <code>BinaryExpr(ADD, IntLiteral(2), IntLiteral(3))</code>ì˜ ê¹Šì´ëŠ” 2ì…ë‹ˆë‹¤.</p>
<h3 id="3">ì—°ìŠµ 3: í”„ë¦¬í‹° í”„ë¦°í„° ê°œì„ <a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ì²˜ë¦¬í•˜ë„ë¡ í”„ë¦¬í‹° í”„ë¦°í„°ë¥¼ í™•ì¥í•˜ì„¸ìš”:</p>
<ol>
<li>ì¸ìˆ˜ê°€ ì¤„ ë„ˆë¹„(ì˜ˆ: 80ì)ë¥¼ ì´ˆê³¼í•  ë•Œ ì—¬ëŸ¬ ì¤„ í•¨ìˆ˜ í˜¸ì¶œ</li>
<li>ë¦¬ìŠ¤íŠ¸ ë¦¬í„°ëŸ´ì—ì„œ í›„í–‰ ì‰¼í‘œ(Trailing Comma)</li>
<li>ì£¼ì„ (ì ì ˆí•œ AST ë…¸ë“œì— ì£¼ì„ í•„ë“œë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤)</li>
</ol>
<h3 id="4-constant-propagation">ì—°ìŠµ 4: ìƒìˆ˜ ì „íŒŒ(Constant Propagation)<a class="header-link" href="#4-constant-propagation" title="Permanent link">&para;</a></h3>
<p>ë³€ìˆ˜ ëŒ€ì…ì„ ì¶”ì í•˜ê³  ì•Œë ¤ì§„ ê°’ì„ ëŒ€ì…í•˜ëŠ” <code>ConstantPropagator</code>ë¥¼ êµ¬í˜„í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code>let x = 5;           let x = 5;
let y = x + 3;  =&gt;   let y = 8;
print(y * 2);         print(16);
</code></pre></div>

<p>ì´ë¥¼ ìœ„í•´ ìƒìˆ˜ í´ë”ì™€ ë³€ìˆ˜-ê°’ ë§¤í•‘ì„ ì¶”ì í•˜ëŠ” ê°„ë‹¨í•œ í™˜ê²½ì„ ê²°í•©í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<h3 id="5-ast-diff">ì—°ìŠµ 5: AST ì°¨ì´(Diff)<a class="header-link" href="#5-ast-diff" title="Permanent link">&para;</a></h3>
<p>ë‘ ASTì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ <code>ast_diff(old: ASTNode, new: ASTNode) -&gt; list[Change]</code>ë¥¼ êµ¬í˜„í•˜ì„¸ìš”. ê° <code>Change</code>ëŠ” ì¶”ê°€ë˜ì—ˆê±°ë‚˜, ì œê±°ë˜ì—ˆê±°ë‚˜, ìˆ˜ì •ëœ ê²ƒê³¼ ê·¸ ìœ„ì¹˜(ì†ŒìŠ¤ ìœ„ì¹˜)ë¥¼ ê¸°ë¡í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<p>ì´ëŠ” ì¦ë¶„ ì»´íŒŒì¼(Incremental Compilation)ê³¼ ì§€ëŠ¥í˜• ì½”ë“œ ë¦¬ë·° ë„êµ¬ì— ìœ ìš©í•©ë‹ˆë‹¤.</p>
<h3 id="6-round-trip-test">ì—°ìŠµ 6: ë¼ìš´ë“œ-íŠ¸ë¦½ í…ŒìŠ¤íŠ¸(Round-Trip Test)<a class="header-link" href="#6-round-trip-test" title="Permanent link">&para;</a></h3>
<p><strong>ë¼ìš´ë“œ-íŠ¸ë¦½ ì†ì„±</strong>ì„ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”: ì†ŒìŠ¤ ì½”ë“œë¥¼ ASTë¡œ íŒŒì‹±í•˜ê³ , ASTë¥¼ ë‹¤ì‹œ ì†ŒìŠ¤ ì½”ë“œë¡œ í”„ë¦¬í‹° í”„ë¦°íŠ¸í•˜ê³ , ë‹¤ì‹œ íŒŒì‹±í•˜ì—¬ ë‘ ASTê°€ êµ¬ì¡°ì ìœ¼ë¡œ ë™ì¼í•œì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_round_trip</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">ast1</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">regenerated</span> <span class="o">=</span> <span class="n">pretty_print</span><span class="p">(</span><span class="n">ast1</span><span class="p">)</span>
    <span class="n">ast2</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">regenerated</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ast1</span> <span class="o">==</span> <span class="n">ast2</span><span class="p">,</span> <span class="s2">&quot;Round-trip failed!&quot;</span>
</code></pre></div>

<p>ë¼ìš´ë“œ-íŠ¸ë¦¬í•‘ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆëŠ” ê²½ìš°(ì˜ˆ: ì£¼ì„, ê³µë°±, ê´„í˜¸ ì°¨ì´)ë¥¼ ì‹ë³„í•˜ê³  ì²˜ë¦¬ ë°©ë²•ì„ ë…¼ì˜í•˜ì„¸ìš”.</p>
<hr />
<p><a href="./06_Bottom_Up_Parsing.md">ì´ì „: 06_Bottom_Up_Parsing.md</a> | <a href="./08_Semantic_Analysis.md">ë‹¤ìŒ: 08_Semantic_Analysis.md</a> | <a href="./00_Overview.md">ê°œìš”</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/06_Bottom_Up_Parsing.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë ˆìŠ¨ 6: ìƒí–¥ì‹ íŒŒì‹±(Bottom-Up Parsing)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/08_Semantic_Analysis.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë ˆìŠ¨ 8: ì˜ë¯¸ ë¶„ì„(Semantic Analysis)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}