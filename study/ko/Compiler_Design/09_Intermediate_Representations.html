{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë ˆìŠ¨ 9: ì¤‘ê°„ í‘œí˜„(Intermediate Representations) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Compiler_Design/">Compiler Design</a>
    <span class="separator">/</span>
    <span class="current">ë ˆìŠ¨ 9: ì¤‘ê°„ í‘œí˜„(Intermediate Representations)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ë ˆìŠ¨ 9: ì¤‘ê°„ í‘œí˜„(Intermediate Representations)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/08_Semantic_Analysis.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë ˆìŠ¨ 8: ì˜ë¯¸ ë¶„ì„(Semantic Analysis)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/10_Runtime_Environments.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë ˆìŠ¨ 10: ëŸ°íƒ€ì„ í™˜ê²½(Runtime Environments)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#1">1. ì¤‘ê°„ í‘œí˜„ì´ ì¤‘ìš”í•œ ì´ìœ </a><ul>
<li><a href="#11">1.1 ì»´íŒŒì¼ëŸ¬ì˜ ë‹¤ë¦¬</a></li>
<li><a href="#12">1.2 ìµœì í™” í™œì„±í™”</a></li>
<li><a href="#13">1.3 ì´ì‹ì„±ê³¼ ì¬ì‚¬ìš©ì„±</a></li>
<li><a href="#14-ir">1.4 IRì˜ ì„¤ê³„ ëª©í‘œ</a></li>
</ul>
</li>
<li><a href="#2">2. ì¤‘ê°„ í‘œí˜„ì˜ ìŠ¤í™íŠ¸ëŸ¼</a><ul>
<li><a href="#21-ir">2.1 ê³ ìˆ˜ì¤€ IR</a></li>
<li><a href="#22-ir">2.2 ì¤‘ê°„ ìˆ˜ì¤€ IR</a></li>
<li><a href="#23-ir">2.3 ì €ìˆ˜ì¤€ IR</a></li>
<li><a href="#24-ir">2.4 ë‹¤ì¤‘ ìˆ˜ì¤€ IR ì „ëµ</a></li>
</ul>
</li>
<li><a href="#3-3-three-address-code-tac">3. 3-ì£¼ì†Œ ì½”ë“œ(Three-Address Code, TAC)</a><ul>
<li><a href="#31">3.1 ì •ì˜</a></li>
<li><a href="#32">3.2 ëª…ë ¹ì–´ ìœ í˜•</a></li>
<li><a href="#33-temporaries">3.3 ì„ì‹œ ë³€ìˆ˜(Temporaries)</a></li>
<li><a href="#34-tac">3.4 TACë¥¼ ìœ„í•œ ìë£Œêµ¬ì¡°</a><ul>
<li><a href="#quadruples">ì¿¼ë“œëŸ¬í”Œ(Quadruples)</a></li>
<li><a href="#triples">íŠ¸ë¦¬í”Œ(Triples)</a></li>
<li><a href="#indirect-triples">ê°„ì ‘ íŠ¸ë¦¬í”Œ(Indirect Triples)</a></li>
</ul>
</li>
<li><a href="#35-python-tac">3.5 Python êµ¬í˜„: TAC ìƒì„±ê¸°</a></li>
</ul>
</li>
<li><a href="#4-control-flow-graphs-cfgs">4. ì œì–´ íë¦„ ê·¸ë˜í”„(Control Flow Graphs, CFGs)</a><ul>
<li><a href="#41">4.1 ë™ê¸°</a></li>
<li><a href="#42-basic-blocks">4.2 ê¸°ë³¸ ë¸”ë¡(Basic Blocks)</a></li>
<li><a href="#43-identifying-leaders">4.3 ë¦¬ë” ì‹ë³„(Identifying Leaders)</a></li>
<li><a href="#44-cfg-building-the-cfg">4.4 CFG êµ¬ì„±(Building the CFG)</a></li>
<li><a href="#45-cfg">4.5 ì˜ˆì‹œ: CFG êµ¬ì„±</a></li>
<li><a href="#46-python-cfg">4.6 Python êµ¬í˜„: CFG ë¹Œë”</a></li>
</ul>
</li>
<li><a href="#5-static-single-assignment-ssa">5. ì •ì  ë‹¨ì¼ ëŒ€ì…(Static Single Assignment, SSA) í˜•ì‹</a><ul>
<li><a href="#51-ssa">5.1 SSAë€?</a></li>
<li><a href="#52-the-need-for-phi-functions">5.2 íŒŒì´ í•¨ìˆ˜ì˜ í•„ìš”ì„±(The Need for Phi Functions)</a></li>
<li><a href="#53-ssa">5.3 SSAì˜ ì†ì„±</a></li>
<li><a href="#54-dominance-and-dominance-frontiers">5.4 ì§€ë°°ì™€ ì§€ë°° ê²½ê³„(Dominance and Dominance Frontiers)</a></li>
<li><a href="#55">5.5 ì•Œê³ ë¦¬ì¦˜: ì§€ë°° ê²½ê³„ ê³„ì‚°</a></li>
<li><a href="#56">5.6 ì•Œê³ ë¦¬ì¦˜: íŒŒì´ í•¨ìˆ˜ ë°°ì¹˜</a></li>
<li><a href="#57">5.7 ì•Œê³ ë¦¬ì¦˜: ë³€ìˆ˜ ì´ë¦„ ë°”ê¾¸ê¸°</a></li>
<li><a href="#58-ssa">5.8 ì™„ì „í•œ SSA ì˜ˆì‹œ</a></li>
<li><a href="#59-python-ssa">5.9 Python êµ¬í˜„: SSA êµ¬ì„±</a></li>
</ul>
</li>
<li><a href="#6-directed-acyclic-graphs-dags">6. ë°©í–¥ ë¹„ìˆœí™˜ ê·¸ë˜í”„(Directed Acyclic Graphs, DAGs)</a><ul>
<li><a href="#61-dag">6.1 í‘œí˜„ì‹ì„ ìœ„í•œ DAG</a></li>
<li><a href="#62-dag">6.2 DAG êµ¬ì„±</a></li>
<li><a href="#63-dag">6.3 DAGì˜ í™œìš©</a></li>
<li><a href="#64-python-dag">6.4 Python êµ¬í˜„: í‘œí˜„ì‹ DAG</a></li>
</ul>
</li>
<li><a href="#7-cfg-linearization-from-cfg-back-to-linear-code">7. ì„ í˜•í™”: CFGì—ì„œ ì„ í˜• ì½”ë“œë¡œ(Linearization: From CFG Back to Linear Code)</a><ul>
<li><a href="#71">7.1 ë¬¸ì œ</a></li>
<li><a href="#72-block-ordering-strategies">7.2 ë¸”ë¡ ì •ë ¬ ì „ëµ(Block Ordering Strategies)</a></li>
<li><a href="#73">7.3 ì—­ í›„ìœ„ ìˆœì„œ ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#74-eliminating-redundant-jumps">7.4 ì¤‘ë³µ ì í”„ ì œê±°(Eliminating Redundant Jumps)</a></li>
<li><a href="#75-ssa-deconstructing-ssa">7.5 SSA í•´ì²´(Deconstructing SSA)</a></li>
</ul>
</li>
<li><a href="#8">8. ìš”ì•½</a></li>
<li><a href="#_2">ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1-tac">ì—°ìŠµ 1: TAC ìƒì„±</a></li>
<li><a href="#2_1">ì—°ìŠµ 2: ê¸°ë³¸ ë¸”ë¡ ì‹ë³„</a></li>
<li><a href="#3-ssa">ì—°ìŠµ 3: SSA ë³€í™˜</a></li>
<li><a href="#4-dag">ì—°ìŠµ 4: DAG êµ¬ì„±</a></li>
<li><a href="#5">ì—°ìŠµ 5: ì§€ë°° ê²½ê³„</a></li>
<li><a href="#6">ì—°ìŠµ 6: êµ¬í˜„ ë„ì „</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="9-intermediate-representations">ë ˆìŠ¨ 9: ì¤‘ê°„ í‘œí˜„(Intermediate Representations)<a class="header-link" href="#9-intermediate-representations" title="Permanent link">&para;</a></h1>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>ì´ ë ˆìŠ¨ì„ ì™„ë£Œí•˜ë©´ ë‹¤ìŒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<ol>
<li>í˜„ëŒ€ ì»´íŒŒì¼ëŸ¬ ì„¤ê³„ì—ì„œ ì¤‘ê°„ í‘œí˜„(intermediate representations, IRs)ì´ ì™œ í•„ìˆ˜ì ì¸ì§€ <strong>ì„¤ëª…</strong>í•  ìˆ˜ ìˆë‹¤</li>
<li>ê³ ìˆ˜ì¤€, ì¤‘ê°„ ìˆ˜ì¤€, ì €ìˆ˜ì¤€ IRì˜ ì°¨ì´ì™€ ê·¸ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ <strong>êµ¬ë³„</strong>í•  ìˆ˜ ìˆë‹¤</li>
<li>ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(abstract syntax tree)ë¡œë¶€í„° 3-ì£¼ì†Œ ì½”ë“œ(three-address code, TAC)ë¥¼ <strong>ìƒì„±</strong>í•  ìˆ˜ ìˆë‹¤</li>
<li>ì œì–´ íë¦„ ê·¸ë˜í”„(control flow graphs, CFGs)ë¥¼ <strong>êµ¬ì„±</strong>í•˜ê³  ê¸°ë³¸ ë¸”ë¡(basic blocks)ì„ ì‹ë³„í•  ìˆ˜ ìˆë‹¤</li>
<li>ì½”ë“œë¥¼ ì •ì  ë‹¨ì¼ ëŒ€ì…(Static Single Assignment, SSA) í˜•ì‹ìœ¼ë¡œ <strong>ë³€í™˜</strong>í•˜ê³  íŒŒì´ í•¨ìˆ˜(phi functions)ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤</li>
<li>Pythonìœ¼ë¡œ TAC ìƒì„±ê¸°ì™€ CFG ë¹Œë”ë¥¼ <strong>êµ¬í˜„</strong>í•  ìˆ˜ ìˆë‹¤</li>
<li>DAG í‘œí˜„ê³¼ ìµœì í™”ì—ì„œì˜ ì—­í• ì„ <strong>ì„¤ëª…</strong>í•  ìˆ˜ ìˆë‹¤</li>
</ol>
<hr />
<h2 id="1">1. ì¤‘ê°„ í‘œí˜„ì´ ì¤‘ìš”í•œ ì´ìœ <a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 ì»´íŒŒì¼ëŸ¬ì˜ ë‹¤ë¦¬<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<p>ì»´íŒŒì¼ëŸ¬ëŠ” ê³ ìˆ˜ì¤€ ì–¸ì–´ë¡œ ì‘ì„±ëœ ì†ŒìŠ¤ ì½”ë“œë¥¼ íŠ¹ì • ëŒ€ìƒ ì•„í‚¤í…ì²˜ì˜ ê¸°ê³„ì–´ ì½”ë“œë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì¤‘ê°„ í‘œí˜„ ì—†ì´ëŠ”, (ì†ŒìŠ¤ ì–¸ì–´, ëŒ€ìƒ ê¸°ê³„) ìŒë§ˆë‹¤ ë³„ë„ì˜ ì»´íŒŒì¼ëŸ¬ í”„ë¡ íŠ¸ ì—”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤. $m$ê°œì˜ ì†ŒìŠ¤ ì–¸ì–´ì™€ $n$ê°œì˜ ëŒ€ìƒ ê¸°ê³„ê°€ ìˆë‹¤ë©´, ë‹¨ìˆœí•œ ì ‘ê·¼ ë°©ì‹ì€ $m \times n$ê°œì˜ ë²ˆì—­ê¸°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
<p>IRì€ í”„ë¡ íŠ¸ ì—”ë“œì™€ ë°± ì—”ë“œë¥¼ ë¶„ë¦¬í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>          Front Ends                Back Ends
Source 1 â”€â”€â”                    â”Œâ”€â”€ Target A
Source 2 â”€â”€â”¼â”€â”€â–¶  IR  â”€â”€â–¶â”€â”€â”¼â”€â”€ Target B
Source 3 â”€â”€â”˜                    â””â”€â”€ Target C
</code></pre></div>

<p>IRì„ ì‚¬ìš©í•˜ë©´ $m$ê°œì˜ í”„ë¡ íŠ¸ ì—”ë“œì™€ $n$ê°œì˜ ë°± ì—”ë“œë§Œ í•„ìš”í•˜ì—¬, ì´ ì‘ì—…ì´ $m + n$ìœ¼ë¡œ ì¤„ì–´ë“­ë‹ˆë‹¤.</p>
<h3 id="12">1.2 ìµœì í™” í™œì„±í™”<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<p>IRì€ ìµœì í™”(optimization)ê°€ ìˆ˜í–‰ë˜ëŠ” ê¸°ë°˜ ì—­í• ì„ í•©ë‹ˆë‹¤. ì˜ ì„¤ê³„ëœ IRì€ ë³€í™˜ì„ í‘œí˜„í•˜ê³ , ê²€ì¦í•˜ë©°, êµ¬ì„±í•˜ê¸° ì‰½ê²Œ ë§Œë“­ë‹ˆë‹¤. ì„œë¡œ ë‹¤ë¥¸ IRì€ ì„œë¡œ ë‹¤ë¥¸ ìµœì í™” ê¸°íšŒë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤:</p>
<ul>
<li><strong>ê³ ìˆ˜ì¤€ IR</strong>: ë£¨í”„ ë³€í™˜(loop transformations), ì¸ë¼ì´ë‹(inlining), ê°€ìƒ í•¨ìˆ˜ í•´ì œ(devirtualization)</li>
<li><strong>ì¤‘ê°„ ìˆ˜ì¤€ IR</strong>: ìƒìˆ˜ ì „íŒŒ(constant propagation), ì£½ì€ ì½”ë“œ ì œê±°(dead code elimination), ë ˆì§€ìŠ¤í„° ìŠ¹ê²©(register promotion)</li>
<li><strong>ì €ìˆ˜ì¤€ IR</strong>: ëª…ë ¹ì–´ ì„ íƒ(instruction selection), ë ˆì§€ìŠ¤í„° í• ë‹¹(register allocation), ìŠ¤ì¼€ì¤„ë§(scheduling)</li>
</ul>
<h3 id="13">1.3 ì´ì‹ì„±ê³¼ ì¬ì‚¬ìš©ì„±<a class="header-link" href="#13" title="Permanent link">&para;</a></h3>
<p>ì‹¤ì œ ì‚¬ë¡€ë“¤ì´ ì¢‹ì€ IRì˜ ê°•ë ¥í•¨ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ì»´íŒŒì¼ëŸ¬</th>
<th>IR</th>
<th>ëª©ì </th>
</tr>
</thead>
<tbody>
<tr>
<td>GCC</td>
<td>GIMPLE, RTL</td>
<td>ë‹¤ì¤‘ ì–¸ì–´, ë‹¤ì¤‘ ëŒ€ìƒ</td>
</tr>
<tr>
<td>LLVM</td>
<td>LLVM IR</td>
<td>ì–¸ì–´ ë…ë¦½ì  ìµœì í™”ê¸° ë° ì½”ë“œ ìƒì„±ê¸°</td>
</tr>
<tr>
<td>JVM</td>
<td>Java ë°”ì´íŠ¸ì½”ë“œ</td>
<td>í”Œë«í¼ ë…ë¦½ì  ì‹¤í–‰</td>
</tr>
<tr>
<td>.NET</td>
<td>CIL (Common Intermediate Language)</td>
<td>ë‹¤ì¤‘ ì–¸ì–´ ëŸ°íƒ€ì„</td>
</tr>
<tr>
<td>WebAssembly</td>
<td>Wasm ë°”ì´ë„ˆë¦¬ í˜•ì‹</td>
<td>ì´ì‹ ê°€ëŠ¥í•œ ì›¹ ì‹¤í–‰</td>
</tr>
</tbody>
</table>
<h3 id="14-ir">1.4 IRì˜ ì„¤ê³„ ëª©í‘œ<a class="header-link" href="#14-ir" title="Permanent link">&para;</a></h3>
<p>ì¢‹ì€ IRì€ ë‹¤ìŒê³¼ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤:</p>
<ol>
<li>ì†ŒìŠ¤ ì–¸ì–´ ASTë¡œë¶€í„° <strong>ìƒì„±í•˜ê¸° ì‰¬ì›€</strong></li>
<li>ëŒ€ìƒ ê¸°ê³„ì–´ ì½”ë“œë¡œ <strong>ë²ˆì—­í•˜ê¸° ì‰¬ì›€</strong></li>
<li><strong>ìµœì í™”í•˜ê¸° ì í•©í•¨</strong> -- ê¸°íšŒë¥¼ ëª…í™•í•˜ê²Œ ë…¸ì¶œ</li>
<li><strong>ê°„ê²°í•¨</strong> -- ëŒ€í˜• í”„ë¡œê·¸ë¨ì— ëŒ€í•´ ë©”ëª¨ë¦¬ ë‚­ë¹„ ì—†ìŒ</li>
<li><strong>ëª…í™•í•˜ê²Œ ì •ì˜ë¨</strong> -- ëª¨ë“  êµ¬ì¡°ì— ëŒ€í•œ ëª…í™•í•œ ì˜ë¯¸ë¡ </li>
</ol>
<hr />
<h2 id="2">2. ì¤‘ê°„ í‘œí˜„ì˜ ìŠ¤í™íŠ¸ëŸ¼<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21-ir">2.1 ê³ ìˆ˜ì¤€ IR<a class="header-link" href="#21-ir" title="Permanent link">&para;</a></h3>
<p>ê³ ìˆ˜ì¤€ IRì€ ì†ŒìŠ¤ ì–¸ì–´ì˜ êµ¬ì¡°ë¥¼ ë§ì´ ìœ ì§€í•©ë‹ˆë‹¤: ë£¨í”„, ì¡°ê±´ë¬¸, ì¸ë±ìŠ¤ê°€ ìˆëŠ” ë°°ì—´ ì ‘ê·¼, êµ¬ì¡°í™”ëœ íƒ€ì…. ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬(AST)ë‚˜ ê·¸ê²ƒì˜ ì£¼ì„ëœ ë²„ì „ì— ê°€ê¹ìŠµë‹ˆë‹¤.</p>
<p><strong>ì˜ˆì‹œ</strong>: ê³ ìˆ˜ì¤€ IRì€ <code>for</code> ë£¨í”„ë¥¼ ë‹¨ì¼ ë…¸ë“œë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>ForLoop(
    init = Assign(i, 0),
    cond = LessThan(i, n),
    step = Assign(i, Add(i, 1)),
    body = [
        Assign(ArrayAccess(a, i), Multiply(i, i))
    ]
)
</code></pre></div>

<p><strong>ì¥ì </strong>:
- ê³ ìˆ˜ì¤€ ìµœì í™”ë¥¼ ìœ„í•œ ì†ŒìŠ¤ ìˆ˜ì¤€ ì˜ë¯¸ë¡  ë³´ì¡´ (ë£¨í”„ êµí™˜, ë£¨í”„ ìœµí•©)
- íƒ€ì… ê²€ì‚¬ ë° ì˜ë¯¸ ë¶„ì„ì— ìì—°ìŠ¤ëŸ¬ì›€</p>
<p><strong>ë‹¨ì </strong>:
- ì €ìˆ˜ì¤€ ìµœì í™”ì—ëŠ” ë„ˆë¬´ ì¶”ìƒì  (ë ˆì§€ìŠ¤í„° í• ë‹¹, ëª…ë ¹ì–´ ìŠ¤ì¼€ì¤„ë§)</p>
<h3 id="22-ir">2.2 ì¤‘ê°„ ìˆ˜ì¤€ IR<a class="header-link" href="#22-ir" title="Permanent link">&para;</a></h3>
<p>ì¤‘ê°„ ìˆ˜ì¤€ IR (ë•Œë¡œ "3-ì£¼ì†Œ ì½”ë“œ" ìˆ˜ì¤€ì´ë¼ ë¶ˆë¦¼)ì€ ê³ ìˆ˜ì¤€ ì œì–´ êµ¬ì¡°ë¥¼ ì œê±°í•˜ê³  ë ˆì´ë¸”ê³¼ ì í”„ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤. ë³€ìˆ˜ëŠ” ëª…ì‹œì ì´ì§€ë§Œ ê¸°ê³„ ì„¸ë¶€ ì‚¬í•­(ë ˆì§€ìŠ¤í„°, ì£¼ì†Œ ì§€ì • ëª¨ë“œ)ì€ ì¶”ìƒí™”ë©ë‹ˆë‹¤.</p>
<p><strong>ì˜ˆì‹œ</strong>: ì¤‘ê°„ ìˆ˜ì¤€ IRì—ì„œì˜ ë™ì¼í•œ ë£¨í”„:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="nl">L1</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L2</span>
<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="nl">L1</span>
<span class="nl">L2</span><span class="p">:</span>
</code></pre></div>

<p><strong>ì¥ì </strong>:
- ëŒ€ë¶€ë¶„ì˜ ê³ ì „ì  ìµœì í™”ì— ì´ìƒì  (CSE, ìƒìˆ˜ ì „íŒŒ, DCE)
- ì§ê´€ì  ë¶„ì„ì— ì¶©ë¶„íˆ ë‹¨ìˆœ</p>
<p><strong>ë‹¨ì </strong>:
- ì†ŒìŠ¤ ìˆ˜ì¤€ êµ¬ì¡°ë¥¼ ìƒìŒ (ë£¨í”„ ë³€í™˜ì´ ë” ì–´ë ¤ì›€)</p>
<h3 id="23-ir">2.3 ì €ìˆ˜ì¤€ IR<a class="header-link" href="#23-ir" title="Permanent link">&para;</a></h3>
<p>ì €ìˆ˜ì¤€ IRì€ ê¸°ê³„ì–´ ì½”ë“œì— ê°€ê¹ì§€ë§Œ ì—¬ì „íˆ ë‹¤ì†Œ ì¶”ìƒí™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê°€ìƒ ë ˆì§€ìŠ¤í„°(ë¬´ì œí•œ ê³µê¸‰)ë¥¼ ì‚¬ìš©í•˜ê³  ì£¼ì†Œ ì§€ì • ëª¨ë“œ, ì¡°ê±´ ì½”ë“œ, íŠ¹ì • ëª…ë ¹ì–´ í˜•ì‹ê³¼ ê°™ì€ ê¸°ê³„ë³„ ì—°ì‚°ì„ ë…¸ì¶œí•©ë‹ˆë‹¤.</p>
<p><strong>ì˜ˆì‹œ</strong>: x86 ìœ ì‚¬ ëŒ€ìƒì— ëŒ€í•œ ì €ìˆ˜ì¤€ IRì—ì„œì˜ ë™ì¼í•œ ë£¨í”„:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">mov</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="nl">L1</span><span class="p">:</span><span class="w"> </span><span class="n">cmp</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="w">         </span><span class="p">;</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">n</span>
<span class="w">    </span><span class="n">jge</span><span class="w"> </span><span class="n">L2</span><span class="w">             </span><span class="p">;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L2</span>
<span class="w">    </span><span class="n">mov</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">imul</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="w">        </span><span class="p">;</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="n">mov</span><span class="w"> </span><span class="o">[</span><span class="n">v4 + v1*4</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span>
<span class="w">    </span><span class="k">add</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w">          </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">jmp</span><span class="w"> </span><span class="n">L1</span>
<span class="nl">L2</span><span class="p">:</span>
</code></pre></div>

<p><strong>ì¥ì </strong>:
- ìµœì¢… ì¶œë ¥ì— ê°€ê¹Œì›€ -- ëª…ë ¹ì–´ ì„ íƒ ë° ë ˆì§€ìŠ¤í„° í• ë‹¹ ìš©ì´
- ê¸°ê³„ë³„ ìµœì í™” í‘œí˜„ ê°€ëŠ¥</p>
<p><strong>ë‹¨ì </strong>:
- ê¸°ê³„ ì˜ì¡´ì ì´ì–´ì„œ ì´ì‹ì„± ê°ì†Œ</p>
<h3 id="24-ir">2.4 ë‹¤ì¤‘ ìˆ˜ì¤€ IR ì „ëµ<a class="header-link" href="#24-ir" title="Permanent link">&para;</a></h3>
<p>í˜„ëŒ€ ì»´íŒŒì¼ëŸ¬ëŠ” ì¢…ì¢… ì—¬ëŸ¬ IR ìˆ˜ì¤€ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Source</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="nx">AST</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="nx">High</span><span class="w"> </span><span class="nx">IR</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="nx">Medium</span><span class="w"> </span><span class="nx">IR</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="nx">Low</span><span class="w"> </span><span class="nx">IR</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="nx">Machine</span><span class="w"> </span><span class="nx">Code</span>
<span class="w">             </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="nx">check</span><span class="p">)</span><span class="w">  </span><span class="p">(</span><span class="nx">loop</span><span class="w"> </span><span class="nx">opts</span><span class="p">)</span><span class="w">  </span><span class="p">(</span><span class="nx">scalar</span><span class="w"> </span><span class="nx">opts</span><span class="p">)</span><span class="w">  </span><span class="p">(</span><span class="nx">reg</span><span class="w"> </span><span class="nx">alloc</span><span class="p">)</span>
</code></pre></div>

<p>LLVMì€ ë‹¨ì¼ IR (LLVM IR)ì„ ì‚¬ìš©í•˜ì§€ë§Œ ì ì§„ì ì¸ ì €ìˆ˜ì¤€í™” íŒ¨ìŠ¤ë¥¼ í†µí•´ ì—¬ëŸ¬ ì¶”ìƒí™” ìˆ˜ì¤€ì—ì„œ ì‘ë™í•©ë‹ˆë‹¤. GCCëŠ” GIMPLE (ì¤‘ê°„ ìˆ˜ì¤€)ê³¼ RTL (ì €ìˆ˜ì¤€)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="3-3-three-address-code-tac">3. 3-ì£¼ì†Œ ì½”ë“œ(Three-Address Code, TAC)<a class="header-link" href="#3-3-three-address-code-tac" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ì •ì˜<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<p>3-ì£¼ì†Œ ì½”ë“œ(three-address code)ëŠ” ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì¤‘ê°„ í‘œí˜„ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ê° ëª…ë ¹ì–´ëŠ” ìµœëŒ€ ì„¸ ê°œì˜ í”¼ì—°ì‚°ì(ì£¼ì†Œ)ë¥¼ ê°€ì§‘ë‹ˆë‹¤: ì¼ë°˜ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ê²°ê³¼ì™€ í•˜ë‚˜ ë˜ëŠ” ë‘ ê°œì˜ ì¸ì.</p>
<p>ì¼ë°˜ì ì¸ í˜•íƒœëŠ”:</p>
<p>$$x = y \;\text{op}\; z$$</p>
<p>ì—¬ê¸°ì„œ $x$, $y$, $z$ëŠ” ì´ë¦„(ë³€ìˆ˜, ì„ì‹œ ë³€ìˆ˜, ë˜ëŠ” ìƒìˆ˜)ì´ê³  $\text{op}$ëŠ” ì—°ì‚°ìì…ë‹ˆë‹¤.</p>
<h3 id="32">3.2 ëª…ë ¹ì–´ ìœ í˜•<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<p>TACëŠ” ì—¬ëŸ¬ ëª…ë ¹ì–´ í˜•íƒœë¥¼ í¬í•¨í•©ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ë²”ì£¼</th>
<th>í˜•íƒœ</th>
<th>ì˜ˆì‹œ</th>
</tr>
</thead>
<tbody>
<tr>
<td>í• ë‹¹ (ì´ì§„)</td>
<td><code>x = y op z</code></td>
<td><code>t1 = a + b</code></td>
</tr>
<tr>
<td>í• ë‹¹ (ë‹¨í•­)</td>
<td><code>x = op y</code></td>
<td><code>t2 = -t1</code></td>
</tr>
<tr>
<td>ë³µì‚¬</td>
<td><code>x = y</code></td>
<td><code>t3 = t1</code></td>
</tr>
<tr>
<td>ë¬´ì¡°ê±´ ì í”„</td>
<td><code>goto L</code></td>
<td><code>goto L2</code></td>
</tr>
<tr>
<td>ì¡°ê±´ë¶€ ì í”„</td>
<td><code>if x relop y goto L</code></td>
<td><code>if t1 &lt; n goto L1</code></td>
</tr>
<tr>
<td>ì¸ë±ìŠ¤ í• ë‹¹ (ì €ì¥)</td>
<td><code>x[i] = y</code></td>
<td><code>a[t2] = t3</code></td>
</tr>
<tr>
<td>ì¸ë±ìŠ¤ í• ë‹¹ (ë¡œë“œ)</td>
<td><code>x = y[i]</code></td>
<td><code>t4 = a[t2]</code></td>
</tr>
<tr>
<td>ì£¼ì†Œ/í¬ì¸í„°</td>
<td><code>x = &amp;y</code>, <code>x = *y</code>, <code>*x = y</code></td>
<td><code>t5 = &amp;a</code></td>
</tr>
<tr>
<td>í”„ë¡œì‹œì € í˜¸ì¶œ</td>
<td><code>param x</code>, <code>call p, n</code>, <code>x = call p, n</code></td>
<td><code>param t1</code></td>
</tr>
<tr>
<td>ë°˜í™˜</td>
<td><code>return x</code></td>
<td><code>return t1</code></td>
</tr>
</tbody>
</table>
<h3 id="33-temporaries">3.3 ì„ì‹œ ë³€ìˆ˜(Temporaries)<a class="header-link" href="#33-temporaries" title="Permanent link">&para;</a></h3>
<p>TACëŠ” ì¤‘ê°„ ê²°ê³¼ë¥¼ ë‹´ê¸° ìœ„í•´ ì„ì‹œ ë³€ìˆ˜($t_1, t_2, \ldots$)ë¥¼ ë„ì…í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¶„í•´ëŠ” ëª¨ë“  ë³µì¡í•œ í‘œí˜„ì‹ì´ ê°„ë‹¨í•œ ë‹¨ê³„ë¡œ ë¶„í•´ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.</p>
<p><strong>ì†ŒìŠ¤ í‘œí˜„ì‹</strong>: <code>a + b * c - d / e</code></p>
<p><strong>TAC</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = b * c
t2 = a + t1
t3 = d / e
t4 = t2 - t3
</code></pre></div>

<h3 id="34-tac">3.4 TACë¥¼ ìœ„í•œ ìë£Œêµ¬ì¡°<a class="header-link" href="#34-tac" title="Permanent link">&para;</a></h3>
<p>TAC ëª…ë ¹ì–´ë¥¼ ì €ì¥í•˜ëŠ” ì„¸ ê°€ì§€ ì¼ë°˜ì ì¸ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤:</p>
<h4 id="quadruples">ì¿¼ë“œëŸ¬í”Œ(Quadruples)<a class="header-link" href="#quadruples" title="Permanent link">&para;</a></h4>
<p>ì¿¼ë“œëŸ¬í”Œì€ ë„¤ ê°œì˜ í•„ë“œë¥¼ ê°€ì§‘ë‹ˆë‹¤: <code>(op, arg1, arg2, result)</code>.</p>
<table>
<thead>
<tr>
<th>ì¸ë±ìŠ¤</th>
<th>op</th>
<th>arg1</th>
<th>arg2</th>
<th>result</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td><code>*</code></td>
<td><code>b</code></td>
<td><code>c</code></td>
<td><code>t1</code></td>
</tr>
<tr>
<td>1</td>
<td><code>+</code></td>
<td><code>a</code></td>
<td><code>t1</code></td>
<td><code>t2</code></td>
</tr>
<tr>
<td>2</td>
<td><code>/</code></td>
<td><code>d</code></td>
<td><code>e</code></td>
<td><code>t3</code></td>
</tr>
<tr>
<td>3</td>
<td><code>-</code></td>
<td><code>t2</code></td>
<td><code>t3</code></td>
<td><code>t4</code></td>
</tr>
</tbody>
</table>
<p><strong>ì¥ì </strong>: ë‹¨ìˆœí•˜ê³ , ì§ì ‘ì ì´ë©°, ëª…ë ¹ì–´ ì¬ì •ë ¬ì´ ì‰¬ì›€.</p>
<p><strong>ë‹¨ì </strong>: ëª¨ë“  ì„ì‹œ ë³€ìˆ˜ì— ëŒ€í•œ ëª…ì‹œì  ì´ë¦„ í•„ìš”.</p>
<h4 id="triples">íŠ¸ë¦¬í”Œ(Triples)<a class="header-link" href="#triples" title="Permanent link">&para;</a></h4>
<p>íŠ¸ë¦¬í”Œì€ ì„¸ ê°œì˜ í•„ë“œë¥¼ ê°€ì§‘ë‹ˆë‹¤: <code>(op, arg1, arg2)</code>. ê²°ê³¼ëŠ” ëª…ëª…ëœ ì„ì‹œ ë³€ìˆ˜ê°€ ì•„ë‹Œ íŠ¸ë¦¬í”Œì˜ ì¸ë±ìŠ¤ë¡œ ì‹ë³„ë©ë‹ˆë‹¤.</p>
<table>
<thead>
<tr>
<th>ì¸ë±ìŠ¤</th>
<th>op</th>
<th>arg1</th>
<th>arg2</th>
</tr>
</thead>
<tbody>
<tr>
<td>(0)</td>
<td><code>*</code></td>
<td><code>b</code></td>
<td><code>c</code></td>
</tr>
<tr>
<td>(1)</td>
<td><code>+</code></td>
<td><code>a</code></td>
<td>(0)</td>
</tr>
<tr>
<td>(2)</td>
<td><code>/</code></td>
<td><code>d</code></td>
<td><code>e</code></td>
</tr>
<tr>
<td>(3)</td>
<td><code>-</code></td>
<td>(1)</td>
<td>(2)</td>
</tr>
</tbody>
</table>
<p><strong>ì¥ì </strong>: ëª…ì‹œì  ì„ì‹œ ë³€ìˆ˜ ë¶ˆí•„ìš” -- ë” ê°„ê²°í•¨.</p>
<p><strong>ë‹¨ì </strong>: ì°¸ì¡°ê°€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ëª…ë ¹ì–´ ì¬ì •ë ¬ì´ ì–´ë ¤ì›€.</p>
<h4 id="indirect-triples">ê°„ì ‘ íŠ¸ë¦¬í”Œ(Indirect Triples)<a class="header-link" href="#indirect-triples" title="Permanent link">&para;</a></h4>
<p>ê°„ì ‘ íŠ¸ë¦¬í”Œì€ ëª…ë ¹ì–´ ìœ„ì¹˜ë¥¼ íŠ¸ë¦¬í”Œ ì¸ë±ìŠ¤ì— ë§¤í•‘í•˜ëŠ” ê°„ì ‘ ë°°ì—´ì„ ì¶”ê°€í•©ë‹ˆë‹¤. íŠ¸ë¦¬í”Œ ìì²´ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ê°„ì ‘ ë°°ì—´ì„ ìˆœì—´í•˜ì—¬ ì¬ì •ë ¬ì„ í—ˆìš©í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>Instruction list: [0, 1, 2, 3]   &lt;-- can be reordered
Triple table:     same as above   &lt;-- unchanged
</code></pre></div>

<h3 id="35-python-tac">3.5 Python êµ¬í˜„: TAC ìƒì„±ê¸°<a class="header-link" href="#35-python-tac" title="Permanent link">&para;</a></h3>
<p>ê°„ë‹¨í•œ í‘œí˜„ì‹ ASTë¥¼ 3-ì£¼ì†Œ ì½”ë“œë¡œ ë³€í™˜í•˜ëŠ” TAC ìƒì„±ê¸°ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Three-Address Code (TAC) Generator from AST.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>


<span class="c1"># ---------- AST Nodes ----------</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Num</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Numeric literal.&quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Var</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Variable reference.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BinOp</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Binary operation.&quot;&quot;&quot;</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>          <span class="c1"># &#39;+&#39;, &#39;-&#39;, &#39;*&#39;, &#39;/&#39;</span>
    <span class="n">left</span><span class="p">:</span> <span class="s1">&#39;Expr&#39;</span>
    <span class="n">right</span><span class="p">:</span> <span class="s1">&#39;Expr&#39;</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UnaryOp</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unary operation.&quot;&quot;&quot;</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>          <span class="c1"># &#39;-&#39;, &#39;not&#39;</span>
    <span class="n">operand</span><span class="p">:</span> <span class="s1">&#39;Expr&#39;</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Assign</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assignment statement.&quot;&quot;&quot;</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="s1">&#39;Expr&#39;</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IfElse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If-else statement.&quot;&quot;&quot;</span>
    <span class="n">condition</span><span class="p">:</span> <span class="s1">&#39;Expr&#39;</span>
    <span class="n">then_body</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">else_body</span><span class="p">:</span> <span class="nb">list</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">While</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;While loop.&quot;&quot;&quot;</span>
    <span class="n">condition</span><span class="p">:</span> <span class="s1">&#39;Expr&#39;</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">list</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RelOp</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Relational comparison.&quot;&quot;&quot;</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>          <span class="c1"># &#39;&lt;&#39;, &#39;&gt;&#39;, &#39;&lt;=&#39;, &#39;&gt;=&#39;, &#39;==&#39;, &#39;!=&#39;</span>
    <span class="n">left</span><span class="p">:</span> <span class="s1">&#39;Expr&#39;</span>
    <span class="n">right</span><span class="p">:</span> <span class="s1">&#39;Expr&#39;</span>

<span class="n">Expr</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Num</span><span class="p">,</span> <span class="n">Var</span><span class="p">,</span> <span class="n">BinOp</span><span class="p">,</span> <span class="n">UnaryOp</span><span class="p">,</span> <span class="n">RelOp</span><span class="p">]</span>
<span class="n">Stmt</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Assign</span><span class="p">,</span> <span class="n">IfElse</span><span class="p">,</span> <span class="n">While</span><span class="p">]</span>


<span class="c1"># ---------- TAC Instruction ----------</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TACInstruction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A single TAC instruction.&quot;&quot;&quot;</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">arg1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">arg2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">:&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;goto&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    goto </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;iffalse&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    iffalse </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> goto </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;iftrue&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    iftrue </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> goto </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;copy&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;param&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    param </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = call </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;return&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    return </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="c1"># ---------- TAC Generator ----------</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TACGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates three-address code from an AST.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TACInstruction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_temp_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">new_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a fresh temporary variable name.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_temp_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_temp_counter</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">new_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a fresh label name.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;L</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_label_counter</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">arg2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="n">result</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TACInstruction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Emit a single TAC instruction.&quot;&quot;&quot;</span>
        <span class="n">instr</span> <span class="o">=</span> <span class="n">TACInstruction</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate TAC for a node. Returns the name holding the result.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Num</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinOp</span><span class="p">):</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_temp</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">temp</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">UnaryOp</span><span class="p">):</span>
            <span class="n">operand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_temp</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">temp</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">RelOp</span><span class="p">):</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_temp</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">temp</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Assign</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">target</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">IfElse</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_if_else</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">While</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_while</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown node type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_if_else</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">IfElse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate TAC for an if-else statement.&quot;&quot;&quot;</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
        <span class="n">else_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_label</span><span class="p">()</span>
        <span class="n">end_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_label</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">else_label</span><span class="p">)</span>

        <span class="c1"># Then body</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">then_body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;goto&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">end_label</span><span class="p">)</span>

        <span class="c1"># Else label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">else_label</span><span class="p">)</span>

        <span class="c1"># Else body</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

        <span class="c1"># End label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">end_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_while</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">While</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate TAC for a while loop.&quot;&quot;&quot;</span>
        <span class="n">begin_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_label</span><span class="p">()</span>
        <span class="n">end_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_label</span><span class="p">()</span>

        <span class="c1"># Loop start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">begin_label</span><span class="p">)</span>

        <span class="c1"># Condition</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">end_label</span><span class="p">)</span>

        <span class="c1"># Body</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;goto&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">begin_label</span><span class="p">)</span>

        <span class="c1"># Loop end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">end_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_tac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty-print all generated TAC instructions.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>


<span class="c1"># ---------- Example Usage ----------</span>

<span class="k">def</span><span class="w"> </span><span class="nf">demo_expression</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate TAC for: result = (a + b) * (c - d)&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Expression: result = (a + b) * (c - d) ===&quot;</span><span class="p">)</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">Assign</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">,</span>
        <span class="n">BinOp</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
            <span class="n">BinOp</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)),</span>
            <span class="n">BinOp</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">TACGenerator</span><span class="p">()</span>
    <span class="n">gen</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="n">gen</span><span class="o">.</span><span class="n">print_tac</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demo_if_else</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate TAC for: if (x &lt; y) max = y; else max = x;&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== If-Else: if (x &lt; y) max = y; else max = x; ===&quot;</span><span class="p">)</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">IfElse</span><span class="p">(</span>
        <span class="n">condition</span><span class="o">=</span><span class="n">RelOp</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)),</span>
        <span class="n">then_body</span><span class="o">=</span><span class="p">[</span><span class="n">Assign</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">))],</span>
        <span class="n">else_body</span><span class="o">=</span><span class="p">[</span><span class="n">Assign</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">))]</span>
    <span class="p">)</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">TACGenerator</span><span class="p">()</span>
    <span class="n">gen</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="n">gen</span><span class="o">.</span><span class="n">print_tac</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demo_while</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate TAC for: while (i &lt; n) { s = s + a[i]; i = i + 1; }&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== While: while (i &lt; n) { s = s + i; i = i + 1; } ===&quot;</span><span class="p">)</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">While</span><span class="p">(</span>
        <span class="n">condition</span><span class="o">=</span><span class="n">RelOp</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)),</span>
        <span class="n">body</span><span class="o">=</span><span class="p">[</span>
            <span class="n">Assign</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">BinOp</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">),</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">))),</span>
            <span class="n">Assign</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">BinOp</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">Var</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">),</span> <span class="n">Num</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">TACGenerator</span><span class="p">()</span>
    <span class="n">gen</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
    <span class="n">gen</span><span class="o">.</span><span class="n">print_tac</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo_expression</span><span class="p">()</span>
    <span class="n">demo_if_else</span><span class="p">()</span>
    <span class="n">demo_while</span><span class="p">()</span>
</code></pre></div>

<p><strong><code>demo_expression()</code>ì˜ ì˜ˆìƒ ì¶œë ¥</strong>:</p>
<div class="highlight"><pre><span></span><code>=== Expression: result = (a + b) <span class="gs">* (c - d) ===</span>
<span class="gs">    t1 = a + b</span>
<span class="gs">    t2 = c - d</span>
<span class="gs">    t3 = t1 *</span> t2
    result = t3
</code></pre></div>

<p><strong><code>demo_while()</code>ì˜ ì˜ˆìƒ ì¶œë ¥</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="o">===</span><span class="w"> </span><span class="nt">While</span><span class="o">:</span><span class="w"> </span><span class="nt">while</span><span class="w"> </span><span class="o">(</span><span class="nt">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nt">n</span><span class="o">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">s</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">i</span><span class="p">;</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">===</span>
<span class="nt">L1</span><span class="o">:</span>
<span class="w">    </span><span class="nt">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nt">n</span>
<span class="w">    </span><span class="nt">iffalse</span><span class="w"> </span><span class="nt">t1</span><span class="w"> </span><span class="nt">goto</span><span class="w"> </span><span class="nt">L2</span>
<span class="w">    </span><span class="nt">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">i</span>
<span class="w">    </span><span class="nt">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">t2</span>
<span class="w">    </span><span class="nt">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">1</span>
<span class="w">    </span><span class="nt">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">t3</span>
<span class="w">    </span><span class="nt">goto</span><span class="w"> </span><span class="nt">L1</span>
<span class="nt">L2</span><span class="o">:</span>
</code></pre></div>

<hr />
<h2 id="4-control-flow-graphs-cfgs">4. ì œì–´ íë¦„ ê·¸ë˜í”„(Control Flow Graphs, CFGs)<a class="header-link" href="#4-control-flow-graphs-cfgs" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 ë™ê¸°<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<p>3-ì£¼ì†Œ ì½”ë“œë¥¼ ê°€ì§€ë©´, ëª…ë ¹ì–´ì˜ ì„ í˜• ìˆœì„œëŠ” í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ íë¦„ êµ¬ì¡°ë¥¼ ì¦‰ì‹œ ë“œëŸ¬ë‚´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì œì–´ íë¦„ ê·¸ë˜í”„(control flow graph, CFG)ëŠ” ëª…ë ¹ì–´ë¥¼ <strong>ê¸°ë³¸ ë¸”ë¡(basic blocks)</strong>ìœ¼ë¡œ ì¡°ì§í•˜ê³  ê°€ëŠ¥í•œ ì œì–´ ì´ë™ì„ ë‚˜íƒ€ë‚´ëŠ” <strong>ê°„ì„ (edges)</strong>ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ì´ êµ¬ì¡°ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.</p>
<p>CFGëŠ” ë°©í–¥ ê·¸ë˜í”„ $G = (V, E)$ì…ë‹ˆë‹¤:
- ê° ë…¸ë“œ $v \in V$ëŠ” <strong>ê¸°ë³¸ ë¸”ë¡(basic block)</strong>
- ê° ê°„ì„  $(u, v) \in E$ëŠ” ë¸”ë¡ $u$ì—ì„œ ë¸”ë¡ $v$ë¡œì˜ ê°€ëŠ¥í•œ ì œì–´ íë¦„ì„ ë‚˜íƒ€ëƒ„
- êµ¬ë³„ë˜ëŠ” <strong>ì§„ì…(entry)</strong> ë…¸ë“œì™€ í•˜ë‚˜ ì´ìƒì˜ <strong>ì¶œêµ¬(exit)</strong> ë…¸ë“œê°€ ìˆìŒ</p>
<h3 id="42-basic-blocks">4.2 ê¸°ë³¸ ë¸”ë¡(Basic Blocks)<a class="header-link" href="#42-basic-blocks" title="Permanent link">&para;</a></h3>
<p><strong>ê¸°ë³¸ ë¸”ë¡(basic block)</strong>ì€ ë‹¤ìŒê³¼ ê°™ì€ ìµœëŒ€ ì—°ì† ëª…ë ¹ì–´ ì‹œí€€ìŠ¤ì…ë‹ˆë‹¤:</p>
<ol>
<li><strong>ì œì–´ëŠ” ì²« ë²ˆì§¸ ëª…ë ¹ì–´ë¡œë§Œ ì§„ì…</strong> (ë¦¬ë”)</li>
<li><strong>ì œì–´ëŠ” ë§ˆì§€ë§‰ ëª…ë ¹ì–´ì—ì„œë§Œ ì´íƒˆ</strong> (ì¤‘ê°„ì—ì„œ ì í”„ ì—†ìŒ)</li>
<li><strong>ë¸”ë¡ì´ ì§„ì…ë˜ë©´ ëª¨ë“  ëª…ë ¹ì–´ê°€ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰</strong></li>
</ol>
<p>ì´ëŠ” ê¸°ë³¸ ë¸”ë¡ ë‚´ì—ì„œ, ì²« ë²ˆì§¸ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ë©´ ëª¨ë“  ëª…ë ¹ì–´ê°€ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ë©°, ë¸”ë¡ì´ ë¶„ì„ì˜ ì›ì ë‹¨ìœ„ê°€ ë©ë‹ˆë‹¤.</p>
<h3 id="43-identifying-leaders">4.3 ë¦¬ë” ì‹ë³„(Identifying Leaders)<a class="header-link" href="#43-identifying-leaders" title="Permanent link">&para;</a></h3>
<p>TACë¥¼ ê¸°ë³¸ ë¸”ë¡ìœ¼ë¡œ ë¶„í• í•˜ê¸° ìœ„í•´, ìƒˆë¡œìš´ ë¸”ë¡ì„ ì‹œì‘í•˜ëŠ” ëª…ë ¹ì–´ì¸ <strong>ë¦¬ë”(leaders)</strong>ë¥¼ ì‹ë³„í•©ë‹ˆë‹¤:</p>
<ol>
<li>í”„ë¡œê·¸ë¨ì˜ <strong>ì²« ë²ˆì§¸ ëª…ë ¹ì–´</strong>ëŠ” ë¦¬ë”</li>
<li>ì í”„ì˜ <strong>ëŒ€ìƒì¸ ëª…ë ¹ì–´</strong> (ì¡°ê±´ë¶€ ë˜ëŠ” ë¬´ì¡°ê±´)ëŠ” ë¦¬ë”</li>
<li>ì í”„ <strong>ë°”ë¡œ ë‹¤ìŒì— ì˜¤ëŠ” ëª…ë ¹ì–´</strong>ëŠ” ë¦¬ë”</li>
</ol>
<p><strong>ì•Œê³ ë¦¬ì¦˜: ê¸°ë³¸ ë¸”ë¡ ì‹ë³„</strong></p>
<div class="highlight"><pre><span></span><code><span class="err">ì…ë ¥</span><span class="o">:</span><span class="w">  </span><span class="n">TAC</span><span class="w"> </span><span class="err">ëª…ë ¹ì–´</span><span class="w"> </span><span class="err">ëª©ë¡</span>
<span class="err">ì¶œë ¥</span><span class="o">:</span><span class="w"> </span><span class="err">ê¸°ë³¸</span><span class="w"> </span><span class="err">ë¸”ë¡</span><span class="w"> </span><span class="err">ëª©ë¡</span>

<span class="mi">1</span><span class="o">.</span><span class="w"> </span><span class="err">ë¦¬ë”</span><span class="w"> </span><span class="err">ì§‘í•©</span><span class="w"> </span><span class="err">ê²°ì •</span><span class="o">:</span>
<span class="w">   </span><span class="n">a</span><span class="o">.</span><span class="w"> </span><span class="err">ì²«</span><span class="w"> </span><span class="err">ë²ˆì§¸</span><span class="w"> </span><span class="err">ëª…ë ¹ì–´ëŠ”</span><span class="w"> </span><span class="err">ë¦¬ë”</span>
<span class="w">   </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="n">goto</span><span class="o">/</span><span class="n">branchì˜</span><span class="w"> </span><span class="err">ëŒ€ìƒì€</span><span class="w"> </span><span class="err">ë¦¬ë”</span>
<span class="w">   </span><span class="n">c</span><span class="o">.</span><span class="w"> </span><span class="n">goto</span><span class="o">/</span><span class="n">branch</span><span class="w"> </span><span class="err">ë‹¤ìŒ</span><span class="w"> </span><span class="err">ëª…ë ¹ì–´ëŠ”</span><span class="w"> </span><span class="err">ë¦¬ë”</span>

<span class="mi">2</span><span class="o">.</span><span class="w"> </span><span class="err">ê°</span><span class="w"> </span><span class="err">ë¦¬ë”ì—</span><span class="w"> </span><span class="err">ëŒ€í•´</span><span class="o">,</span><span class="w"> </span><span class="err">ê¸°ë³¸</span><span class="w"> </span><span class="err">ë¸”ë¡ì€</span><span class="w"> </span><span class="err">ë¦¬ë”ì™€</span>
<span class="w">   </span><span class="err">ë‹¤ìŒ</span><span class="w"> </span><span class="err">ë¦¬ë”</span><span class="o">(</span><span class="err">í¬í•¨í•˜ì§€</span><span class="w"> </span><span class="err">ì•ŠìŒ</span><span class="o">)</span><span class="w"> </span><span class="err">ë˜ëŠ”</span><span class="w"> </span><span class="err">í”„ë¡œê·¸ë¨</span><span class="w"> </span><span class="err">ëê¹Œì§€ì˜</span>
<span class="w">   </span><span class="err">ëª¨ë“ </span><span class="w"> </span><span class="err">ëª…ë ¹ì–´ë¡œ</span><span class="w"> </span><span class="err">êµ¬ì„±ë¨</span><span class="o">.</span>
</code></pre></div>

<h3 id="44-cfg-building-the-cfg">4.4 CFG êµ¬ì„±(Building the CFG)<a class="header-link" href="#44-cfg-building-the-cfg" title="Permanent link">&para;</a></h3>
<p>ê¸°ë³¸ ë¸”ë¡ì„ ì‹ë³„í•œ í›„, ê°„ì„ ìœ¼ë¡œ ì—°ê²°í•©ë‹ˆë‹¤:</p>
<ol>
<li>ë¸”ë¡ $B_i$ê°€ ì¡°ê±´ë¶€ ë¶„ê¸° <code>if ... goto L</code>ë¡œ ëë‚˜ëŠ” ê²½ìš°:</li>
<li>$B_i$ì—ì„œ ë ˆì´ë¸” $L$ë¡œ ì‹œì‘í•˜ëŠ” ë¸”ë¡ìœ¼ë¡œ ê°„ì„  ì¶”ê°€ (ì°¸ ë¶„ê¸°)</li>
<li>
<p>$B_i$ì—ì„œ $B_{i+1}$ë¡œ <strong>í´-ìŠ¤ë£¨(fall-through)</strong> ê°„ì„  ì¶”ê°€ (ê±°ì§“ ë¶„ê¸°)</p>
</li>
<li>
<p>ë¸”ë¡ $B_i$ê°€ ë¬´ì¡°ê±´ <code>goto L</code>ë¡œ ëë‚˜ëŠ” ê²½ìš°:</p>
</li>
<li>$B_i$ì—ì„œ ë ˆì´ë¸” $L$ë¡œ ì‹œì‘í•˜ëŠ” ë¸”ë¡ìœ¼ë¡œ ê°„ì„  ì¶”ê°€</li>
<li>
<p>í´-ìŠ¤ë£¨ ê°„ì„  ì—†ìŒ</p>
</li>
<li>
<p>ë¸”ë¡ $B_i$ê°€ ë¶„ê¸°ë‚˜ goto ì—†ì´ ëë‚˜ëŠ” ê²½ìš°:</p>
</li>
<li>$B_i$ì—ì„œ $B_{i+1}$ë¡œ í´-ìŠ¤ë£¨ ê°„ì„  ì¶”ê°€</li>
</ol>
<h3 id="45-cfg">4.5 ì˜ˆì‹œ: CFG êµ¬ì„±<a class="header-link" href="#45-cfg" title="Permanent link">&para;</a></h3>
<p>while ë£¨í”„ ì˜ˆì‹œì˜ TACë¥¼ ê³ ë ¤í•´ ë³´ê² ìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>(0)  L1:                  &lt;-- Block B1 leader (label target)
(1)  t1 = i &lt; n
(2)  iffalse t1 goto L2
(3)  t2 = s + i           &lt;-- Block B2 leader (follows branch)
(4)  s = t2
(5)  t3 = i + 1
(6)  i = t3
(7)  goto L1
(8)  L2:                  &lt;-- Block B3 leader (label target)
</code></pre></div>

<p><strong>ë¦¬ë”</strong>: ëª…ë ¹ì–´ 0 (ì²« ë²ˆì§¸ + ë ˆì´ë¸” ëŒ€ìƒ), ëª…ë ¹ì–´ 3 (ë¶„ê¸° ë‹¤ìŒ), ëª…ë ¹ì–´ 8 (ë ˆì´ë¸” ëŒ€ìƒ)</p>
<p><strong>ê¸°ë³¸ ë¸”ë¡</strong>:
- $B_1$: ëª…ë ¹ì–´ 0-2 (ì¡°ê±´ í…ŒìŠ¤íŠ¸)
- $B_2$: ëª…ë ¹ì–´ 3-7 (ë£¨í”„ ë³¸ë¬¸)
- $B_3$: ëª…ë ¹ì–´ 8 (ë£¨í”„ ì¢…ë£Œ)</p>
<p><strong>CFG</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<span class="w">    </span>â”‚<span class="w">   </span><span class="nv">B1</span><span class="w">    </span>â”‚<span class="w"> </span>â—€â”€â”€â”€â”€â”€â”€â”€â”€â”
<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">L1</span>:<span class="w">     </span>â”‚<span class="w">          </span>â”‚
<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">t1</span><span class="o">=</span><span class="nv">i</span><span class="o">&lt;</span><span class="nv">n</span><span class="w">  </span>â”‚<span class="w">          </span>â”‚
<span class="w">    </span>â”‚<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="nv">t1</span><span class="w">  </span>â”‚<span class="w">          </span>â”‚
<span class="w">    </span>â”‚<span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L2</span><span class="w"> </span>â”‚<span class="w">          </span>â”‚
<span class="w">    </span>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜<span class="w">          </span>â”‚
<span class="w">    </span><span class="nv">true</span><span class="w"> </span>â”‚<span class="w">  </span>\<span class="nv">false</span><span class="w">       </span>â”‚
<span class="w">         </span>â”‚<span class="w">   </span>\<span class="w">           </span>â”‚
<span class="w">         </span>â”‚<span class="w">  </span>â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”<span class="w">  </span>â”‚
<span class="w">         </span>â”‚<span class="w">  </span>â”‚<span class="w">   </span><span class="nv">B2</span><span class="w">    </span>â”‚<span class="w">  </span>â”‚
<span class="w">         </span>â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">t2</span><span class="o">=</span><span class="nv">s</span><span class="o">+</span><span class="nv">i</span><span class="w">  </span>â”‚<span class="w">  </span>â”‚
<span class="w">         </span>â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">s</span><span class="o">=</span><span class="nv">t2</span><span class="w">    </span>â”‚<span class="w">  </span>â”‚
<span class="w">         </span>â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">t3</span><span class="o">=</span><span class="nv">i</span><span class="o">+</span><span class="mi">1</span><span class="w">  </span>â”‚<span class="w">  </span>â”‚
<span class="w">         </span>â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="nv">i</span><span class="o">=</span><span class="nv">t3</span><span class="w">    </span>â”‚<span class="w">  </span>â”‚
<span class="w">         </span>â”‚<span class="w">  </span>â”‚<span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L1</span><span class="w"> </span>â”‚â”€â”€â”˜
<span class="w">         </span>â”‚<span class="w">  </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="w">         </span>â”‚
<span class="w">    </span>â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
<span class="w">    </span>â”‚<span class="w">   </span><span class="nv">B3</span><span class="w">    </span>â”‚
<span class="w">    </span>â”‚<span class="w"> </span><span class="nv">L2</span>:<span class="w">     </span>â”‚
<span class="w">    </span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p>ì°¸ê³ : ê°„ì„  ë ˆì´ë¸”ì€ <code>iffalse</code>ì˜ ì˜ë¯¸ë¡ ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. ì¡°ê±´ì´ ê±°ì§“ì´ë©´ L2 (B3)ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì¡°ê±´ì´ ì°¸ì´ë©´ (ì¦‰, <code>iffalse</code>ê°€ ì í”„í•˜ì§€ ì•Šìœ¼ë©´) B2ë¡œ í´ìŠ¤ë£¨í•©ë‹ˆë‹¤.</p>
<h3 id="46-python-cfg">4.6 Python êµ¬í˜„: CFG ë¹Œë”<a class="header-link" href="#46-python-cfg" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Control Flow Graph (CFG) Builder from TAC instructions.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TACInstr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A TAC instruction for CFG construction.&quot;&quot;&quot;</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">arg1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">arg2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;goto&quot;</span><span class="p">,</span> <span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="s2">&quot;iftrue&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_unconditional_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;goto&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_conditional_jump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="s2">&quot;iftrue&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">jump_target</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the label this instruction jumps to, if any.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_jump</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">:&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;goto&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;  goto </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="s2">&quot;iftrue&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> goto </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;copy&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BasicBlock</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A basic block in the CFG.&quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">successors</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>   <span class="c1"># Block IDs</span>
    <span class="n">predecessors</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># Block IDs</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">leader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The first instruction in the block.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The last instruction in the block.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the label of this block, if it starts with one.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_label</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">result</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Block B</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Predecessors: </span><span class="si">{</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;B</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">predecessors</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Successors:   </span><span class="si">{</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;B</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">successors</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  Instructions:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CFG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Control Flow Graph.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">BasicBlock</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a basic block to the CFG.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">to_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a directed edge between two blocks.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">to_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">from_id</span><span class="p">]</span><span class="o">.</span><span class="n">successors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">from_id</span><span class="p">]</span><span class="o">.</span><span class="n">successors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">from_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">to_id</span><span class="p">]</span><span class="o">.</span><span class="n">predecessors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">to_id</span><span class="p">]</span><span class="o">.</span><span class="n">predecessors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">from_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;=== Control Flow Graph (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span><span class="si">}</span><span class="s2"> blocks) ===&quot;</span><span class="p">]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entry: B</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">entry_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exit:  </span><span class="si">{</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;B</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">exit_ids</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">build_cfg</span><span class="p">(</span><span class="n">instructions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TACInstr</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">CFG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a Control Flow Graph from a list of TAC instructions.</span>

<span class="sd">    Algorithm:</span>
<span class="sd">    1. Identify leaders (first instruction, jump targets, post-jump instructions)</span>
<span class="sd">    2. Partition instructions into basic blocks</span>
<span class="sd">    3. Connect blocks with edges based on control flow</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">instructions</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CFG</span><span class="p">()</span>

    <span class="c1"># Step 1: Identify leader indices</span>
    <span class="n">leaders</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">leaders</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># First instruction is always a leader</span>

    <span class="c1"># Map labels to instruction indices</span>
    <span class="n">label_to_index</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">is_label</span><span class="p">:</span>
            <span class="n">label_to_index</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">index</span>

    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">is_jump</span><span class="p">:</span>
            <span class="c1"># Target of jump is a leader</span>
            <span class="n">target_label</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">jump_target</span>
            <span class="k">if</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="n">label_to_index</span><span class="p">:</span>
                <span class="n">leaders</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">label_to_index</span><span class="p">[</span><span class="n">target_label</span><span class="p">])</span>

            <span class="c1"># Instruction after jump is a leader (if it exists)</span>
            <span class="n">next_idx</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">next_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">):</span>
                <span class="n">leaders</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">next_idx</span><span class="p">)</span>

    <span class="n">sorted_leaders</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">leaders</span><span class="p">)</span>

    <span class="c1"># Step 2: Partition into basic blocks</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">CFG</span><span class="p">()</span>
    <span class="n">block_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">leader_to_block_id</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">leader_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_leaders</span><span class="p">):</span>
        <span class="c1"># Determine the end of this block</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_leaders</span><span class="p">):</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="n">sorted_leaders</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>

        <span class="n">block</span> <span class="o">=</span> <span class="n">BasicBlock</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">block_id</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="n">instructions</span><span class="p">[</span><span class="n">leader_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
        <span class="n">leader_to_block_id</span><span class="p">[</span><span class="n">leader_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_id</span>
        <span class="n">block_id</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Build label -&gt; block_id mapping</span>
    <span class="n">label_to_block_id</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">bid</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">label</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">label_to_block_id</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">bid</span>

    <span class="c1"># Step 3: Add edges</span>
    <span class="n">block_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block_ids</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">terminator</span>

        <span class="k">if</span> <span class="n">term</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">term</span><span class="o">.</span><span class="n">is_unconditional_jump</span><span class="p">:</span>
            <span class="c1"># Edge to jump target only</span>
            <span class="n">target_label</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">jump_target</span>
            <span class="k">if</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="n">label_to_block_id</span><span class="p">:</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">label_to_block_id</span><span class="p">[</span><span class="n">target_label</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">term</span><span class="o">.</span><span class="n">is_conditional_jump</span><span class="p">:</span>
            <span class="c1"># Edge to jump target</span>
            <span class="n">target_label</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">jump_target</span>
            <span class="k">if</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="n">label_to_block_id</span><span class="p">:</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">label_to_block_id</span><span class="p">[</span><span class="n">target_label</span><span class="p">])</span>
            <span class="c1"># Fall-through edge to next block</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_ids</span><span class="p">):</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">block_ids</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No jump: fall through to next block</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_ids</span><span class="p">):</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">block_ids</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Set entry and exit</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">entry_id</span> <span class="o">=</span> <span class="n">block_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">block_ids</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">block_ids</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">successors</span><span class="p">:</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">exit_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cfg</span>


<span class="c1"># ---------- Example: Build CFG for a While Loop ----------</span>

<span class="k">def</span><span class="w"> </span><span class="nf">demo_while_loop_cfg</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build CFG for: while (i &lt; n) { s = s + i; i = i + 1; }&quot;&quot;&quot;</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;L1&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;t1&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;L2&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;t3&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;t3&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;goto&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;L1&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;L2&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">cfg</span> <span class="o">=</span> <span class="n">build_cfg</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demo_if_else_cfg</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build CFG for: if (x &lt; y) max = y; else max = x;&quot;&quot;&quot;</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;t1&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;L1&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;goto&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;L2&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;L1&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">),</span>
        <span class="n">TACInstr</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;L2&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">cfg</span> <span class="o">=</span> <span class="n">build_cfg</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- While Loop CFG ---&quot;</span><span class="p">)</span>
    <span class="n">demo_while_loop_cfg</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- If-Else CFG ---&quot;</span><span class="p">)</span>
    <span class="n">demo_if_else_cfg</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="5-static-single-assignment-ssa">5. ì •ì  ë‹¨ì¼ ëŒ€ì…(Static Single Assignment, SSA) í˜•ì‹<a class="header-link" href="#5-static-single-assignment-ssa" title="Permanent link">&para;</a></h2>
<h3 id="51-ssa">5.1 SSAë€?<a class="header-link" href="#51-ssa" title="Permanent link">&para;</a></h3>
<p>ì •ì  ë‹¨ì¼ ëŒ€ì…(Static Single Assignment, SSA) í˜•ì‹ì€ ëª¨ë“  ë³€ìˆ˜ê°€ ì •í™•íˆ í•œ ë²ˆ í• ë‹¹ë˜ëŠ” IR ì†ì„±ì…ë‹ˆë‹¤. ì›ë˜ í”„ë¡œê·¸ë¨ì—ì„œ ë³€ìˆ˜ê°€ ì—¬ëŸ¬ ê³³ì—ì„œ í• ë‹¹ëœë‹¤ë©´, SSAëŠ” ê°ê° ê³ ìœ í•œ ì´ë¦„ì„ ê°€ì§„ ê·¸ ë³€ìˆ˜ì˜ ë³„ê°œ <strong>ë²„ì „(versions)</strong>ì„ ë§Œë“­ë‹ˆë‹¤.</p>
<p><strong>ì›ë˜ ì½”ë“œ</strong>:</p>
<div class="highlight"><pre><span></span><code>x = 1
x = x + 1
y = x * 2
</code></pre></div>

<p><strong>SSA í˜•ì‹</strong>:</p>
<div class="highlight"><pre><span></span><code>x1 = 1
x2 = x1 + 1
y1 = x2 * 2
</code></pre></div>

<p>ê° ì •ì˜ëŠ” ìƒˆë¡œìš´ ë²„ì „ì„ ë§Œë“­ë‹ˆë‹¤. ì´ ì†ì„±ì€ ëª¨ë“  ë³€ìˆ˜ì˜ ì •ì˜ê°€ ê³ ìœ í•˜ê³  ì°¾ê¸° ì‰½ê¸° ë•Œë¬¸ì— ë§ì€ ìµœì í™”ë¥¼ ë” ë‹¨ìˆœí•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.</p>
<h3 id="52-the-need-for-phi-functions">5.2 íŒŒì´ í•¨ìˆ˜ì˜ í•„ìš”ì„±(The Need for Phi Functions)<a class="header-link" href="#52-the-need-for-phi-functions" title="Permanent link">&para;</a></h3>
<p>ë³µì¡í•œ ìƒí™©ì€ ì œì–´ íë¦„ ê·¸ë˜í”„ì˜ <strong>í•©ë¥˜ ì§€ì (join points)</strong>ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤ -- ë‘ ê°œ ì´ìƒì˜ ê²½ë¡œê°€ ìˆ˜ë ´í•˜ëŠ” ê³³. ë‹¤ìŒì„ ê³ ë ¤í•´ ë³´ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">cond</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="o">//</span><span class="w"> </span><span class="nv">Path</span><span class="w"> </span><span class="nv">A</span>
<span class="k">else</span>
<span class="w">    </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">       </span><span class="o">//</span><span class="w"> </span><span class="nv">Path</span><span class="w"> </span><span class="nv">B</span>
<span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w">       </span><span class="o">//</span><span class="w"> </span><span class="nv">Which</span><span class="w"> </span><span class="nv">x</span>?
</code></pre></div>

<p>if-else ì´í›„, ì–´ë–¤ ë²„ì „ì˜ <code>x</code>ë¥¼ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”? ëŸ°íƒ€ì„ì— ì–´ë–¤ ê²½ë¡œê°€ ì·¨í•´ì¡ŒëŠ”ì§€ ì •ì ìœ¼ë¡œ ê²°ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. SSAëŠ” <strong>íŒŒì´ í•¨ìˆ˜(phi function)</strong> ($\phi$-í•¨ìˆ˜)ë¡œ ì´ë¥¼ í•´ê²°í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">cond</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="o">//</span><span class="w"> </span><span class="nv">Path</span><span class="w"> </span><span class="nv">A</span>
<span class="k">else</span>
<span class="w">    </span><span class="nv">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">       </span><span class="o">//</span><span class="w"> </span><span class="nv">Path</span><span class="w"> </span><span class="nv">B</span>
<span class="nv">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">phi</span><span class="ss">(</span><span class="nv">x1</span>,<span class="w"> </span><span class="nv">x2</span><span class="ss">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nv">Merge</span><span class="w"> </span><span class="nv">point</span>
<span class="nv">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">x3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
</code></pre></div>

<p>íŒŒì´ í•¨ìˆ˜ $x_3 = \phi(x_1, x_2)$ëŠ” "ì œì–´ê°€ ê²½ë¡œ Aì—ì„œ ì™”ìœ¼ë©´ $x_1$ì„ ì‚¬ìš©í•˜ê³ , ê²½ë¡œ Bì—ì„œ ì™”ìœ¼ë©´ $x_2$ë¥¼ ì‚¬ìš©í•œë‹¤"ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
<p><strong>í˜•ì‹ì ìœ¼ë¡œ</strong>: $k$ê°œì˜ ì„ í–‰ì $B_1, B_2, \ldots, B_k$ë¥¼ ê°€ì§„ ë¸”ë¡ $B$ì˜ ì§„ì…ë¶€ì—ì„œ $\phi$-í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤:</p>
<p>$$x_i = \phi(x_{j_1}, x_{j_2}, \ldots, x_{j_k})$$</p>
<p>ì—¬ê¸°ì„œ $x_{j_m}$ì€ ì„ í–‰ì $B_m$ì—ì„œ ë„ë‹¬í•˜ëŠ” $x$ì˜ ë²„ì „ì…ë‹ˆë‹¤.</p>
<h3 id="53-ssa">5.3 SSAì˜ ì†ì„±<a class="header-link" href="#53-ssa" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>ê³ ìœ í•œ ì •ì˜</strong>: ëª¨ë“  ë³€ìˆ˜ëŠ” ì •í™•íˆ í•˜ë‚˜ì˜ ì •ì˜ ì§€ì ì„ ê°€ì§</li>
<li><strong>ì‚¬ìš©-ì •ì˜ ì²´ì¸ì´ ìëª…</strong>: ì‚¬ìš© ì§€ì ì—ì„œ ë³€ìˆ˜ì˜ ì •ì˜ë¥¼ ì°¾ëŠ” ê²ƒì´ ì¦‰ê°ì </li>
<li><strong>ì •ì˜-ì‚¬ìš© ì²´ì¸ì´ ê°„ê²°</strong>: ê° ì •ì˜ëŠ” ëª…í™•í•œ ì‚¬ìš© ì§‘í•©ì„ ê°€ì§</li>
<li><strong>í¬ì†Œ í‘œí˜„</strong>: ë¶„ì„ì´ í”„ë¡œê·¸ë¨ ì§€ì ë³´ë‹¤ ë³€ìˆ˜ì— ëŒ€í•´ ì‘ë™</li>
</ol>
<h3 id="54-dominance-and-dominance-frontiers">5.4 ì§€ë°°ì™€ ì§€ë°° ê²½ê³„(Dominance and Dominance Frontiers)<a class="header-link" href="#54-dominance-and-dominance-frontiers" title="Permanent link">&para;</a></h3>
<p>$\phi$-í•¨ìˆ˜ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ë°°ì¹˜í•˜ê¸° ìœ„í•´ <strong>ì§€ë°°(dominance)</strong> ê°œë…ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<p><strong>ì •ì˜</strong>: CFGì—ì„œ ë…¸ë“œ $d$ê°€ ë…¸ë“œ $n$ì„ <strong>ì§€ë°°(dominates)</strong>í•œë‹¤($d \;\text{dom}\; n$ìœ¼ë¡œ í‘œê¸°)ëŠ” ê²ƒì€ ì§„ì… ë…¸ë“œì—ì„œ $n$ìœ¼ë¡œì˜ ëª¨ë“  ê²½ë¡œê°€ ë°˜ë“œì‹œ $d$ë¥¼ í†µê³¼í•´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
<p><strong>ì¦‰ê° ì§€ë°°ì(Immediate dominator)</strong>: ë…¸ë“œ $d$ê°€ $n$ì˜ <strong>ì¦‰ê° ì§€ë°°ì(immediate dominator)</strong>($\text{idom}(n) = d$ë¡œ í‘œê¸°)ë¼ëŠ” ê²ƒì€ $d$ê°€ $n$ì„ ì§€ë°°í•˜ê³ , $d \neq n$ì´ë©°, $n$ì˜ ë‹¤ë¥¸ ëª¨ë“  ì§€ë°°ìë„ $d$ë¥¼ ì§€ë°°í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
<p><strong>ì§€ë°° íŠ¸ë¦¬(Dominator tree)</strong>: ì¦‰ê° ì§€ë°°ì ê´€ê³„ëŠ” ì§„ì… ë…¸ë“œë¥¼ ë£¨íŠ¸ë¡œ í•˜ëŠ” íŠ¸ë¦¬ë¥¼ í˜•ì„±í•©ë‹ˆë‹¤.</p>
<p><strong>ì§€ë°° ê²½ê³„(Dominance frontier)</strong>: ë…¸ë“œ $d$ì˜ <strong>ì§€ë°° ê²½ê³„(dominance frontier)</strong> $DF(d)$ëŠ” ë‹¤ìŒì„ ë§Œì¡±í•˜ëŠ” ë…¸ë“œ $n$ì˜ ì§‘í•©ì…ë‹ˆë‹¤:
- $d$ê°€ $n$ì˜ ì„ í–‰ìë¥¼ ì§€ë°°í•˜ì§€ë§Œ,
- $d$ê°€ $n$ì„ ì—„ê²©í•˜ê²Œ ì§€ë°°í•˜ì§€ëŠ” ì•ŠìŒ</p>
<p>ì§ê´€ì ìœ¼ë¡œ, $d$ì˜ ì§€ë°° ê²½ê³„ëŠ” $d$ì˜ ì§€ë°°ê°€ "ëë‚˜ëŠ”" ë…¸ë“œë“¤ì˜ ì§‘í•©ì…ë‹ˆë‹¤ -- ì´ê²ƒë“¤ì´ ì •í™•íˆ $d$ì—ì„œ ì •ì˜ëœ ë³€ìˆ˜ì— ëŒ€í•œ $\phi$-í•¨ìˆ˜ê°€ í•„ìš”í•  ìˆ˜ ìˆëŠ” í•©ë¥˜ ì§€ì ì…ë‹ˆë‹¤.</p>
<h3 id="55">5.5 ì•Œê³ ë¦¬ì¦˜: ì§€ë°° ê²½ê³„ ê³„ì‚°<a class="header-link" href="#55" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ Cooper, Harvey, Kennedy (2001)ì˜ ì•Œê³ ë¦¬ì¦˜ì€ ì§€ë°° ê²½ê³„ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">node</span><span class="w"> </span><span class="nv">b</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">multiple</span><span class="w"> </span><span class="nv">predecessors</span>:
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">predecessor</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">b</span>:
<span class="w">            </span><span class="nv">runner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="nv">runner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">idom</span><span class="ss">(</span><span class="nv">b</span><span class="ss">)</span>:
<span class="w">                </span><span class="nv">DF</span><span class="ss">(</span><span class="nv">runner</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">DF</span><span class="ss">(</span><span class="nv">runner</span><span class="ss">)</span><span class="w"> </span>âˆª<span class="w"> </span>{<span class="nv">b</span>}
<span class="w">                </span><span class="nv">runner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">idom</span><span class="ss">(</span><span class="nv">runner</span><span class="ss">)</span>
</code></pre></div>

<h3 id="56">5.6 ì•Œê³ ë¦¬ì¦˜: íŒŒì´ í•¨ìˆ˜ ë°°ì¹˜<a class="header-link" href="#56" title="Permanent link">&para;</a></h3>
<p>$\phi$-í•¨ìˆ˜ë¥¼ ë°°ì¹˜í•˜ëŠ” ê³ ì „ ì•Œê³ ë¦¬ì¦˜ì€ ì§€ë°° ê²½ê³„ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="err">ì…ë ¥</span><span class="o">:</span><span class="w">  </span><span class="err">ì§€ë°°</span><span class="w"> </span><span class="err">ê²½ê³„ê°€</span><span class="w"> </span><span class="err">ìˆëŠ”</span><span class="w"> </span><span class="n">CFG</span><span class="o">,</span><span class="w"> </span><span class="err">ë³€ìˆ˜</span><span class="w"> </span><span class="err">ì§‘í•©</span>
<span class="err">ì¶œë ¥</span><span class="o">:</span><span class="w"> </span><span class="err">íŒŒì´</span><span class="w"> </span><span class="err">í•¨ìˆ˜</span><span class="w"> </span><span class="err">ë°°ì¹˜</span>

<span class="err">ê°</span><span class="w"> </span><span class="err">ë³€ìˆ˜</span><span class="w"> </span><span class="n">vì—</span><span class="w"> </span><span class="err">ëŒ€í•´</span><span class="o">:</span>
<span class="w">    </span><span class="n">worklist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vë¥¼</span><span class="w"> </span><span class="err">ì •ì˜í•˜ëŠ”</span><span class="w"> </span><span class="err">ë¸”ë¡</span><span class="w"> </span><span class="err">ì§‘í•©</span>
<span class="w">    </span><span class="n">ever_on_worklist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">worklistì˜</span><span class="w"> </span><span class="err">ë³µì‚¬ë³¸</span>
<span class="w">    </span><span class="n">has_phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">ë¹ˆ</span><span class="w"> </span><span class="err">ì§‘í•©</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">worklistê°€</span><span class="w"> </span><span class="err">ë¹„ì–´ìˆì§€</span><span class="w"> </span><span class="err">ì•Šì„</span><span class="w"> </span><span class="err">ë•Œ</span><span class="o">:</span>
<span class="w">        </span><span class="n">worklistì—ì„œ</span><span class="w"> </span><span class="err">ë¸”ë¡</span><span class="w"> </span><span class="n">bë¥¼</span><span class="w"> </span><span class="err">ì œê±°</span>
<span class="w">        </span><span class="n">DF</span><span class="o">(</span><span class="n">b</span><span class="o">)</span><span class="err">ì˜</span><span class="w"> </span><span class="err">ê°</span><span class="w"> </span><span class="err">ë¸”ë¡</span><span class="w"> </span><span class="n">dì—</span><span class="w"> </span><span class="err">ëŒ€í•´</span><span class="o">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">dê°€</span><span class="w"> </span><span class="n">has_phiì—</span><span class="w"> </span><span class="err">ì—†ìœ¼ë©´</span><span class="o">:</span>
<span class="w">                </span><span class="n">dì˜</span><span class="w"> </span><span class="err">ì‹œì‘</span><span class="w"> </span><span class="err">ë¶€ë¶„ì—</span><span class="w"> </span><span class="n">vì—</span><span class="w"> </span><span class="err">ëŒ€í•œ</span><span class="w"> </span><span class="n">phi</span><span class="o">-</span><span class="err">í•¨ìˆ˜</span><span class="w"> </span><span class="err">ì‚½ì…</span>
<span class="w">                </span><span class="n">has_phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">has_phi</span><span class="w"> </span><span class="err">âˆª</span><span class="w"> </span><span class="o">{</span><span class="n">d</span><span class="o">}</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">dê°€</span><span class="w"> </span><span class="n">ever_on_worklistì—</span><span class="w"> </span><span class="err">ì—†ìœ¼ë©´</span><span class="o">:</span>
<span class="w">                    </span><span class="n">ever_on_worklist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ever_on_worklist</span><span class="w"> </span><span class="err">âˆª</span><span class="w"> </span><span class="o">{</span><span class="n">d</span><span class="o">}</span>
<span class="w">                    </span><span class="n">dë¥¼</span><span class="w"> </span><span class="n">worklistì—</span><span class="w"> </span><span class="err">ì¶”ê°€</span>
</code></pre></div>

<h3 id="57">5.7 ì•Œê³ ë¦¬ì¦˜: ë³€ìˆ˜ ì´ë¦„ ë°”ê¾¸ê¸°<a class="header-link" href="#57" title="Permanent link">&para;</a></h3>
<p>$\phi$-í•¨ìˆ˜ë¥¼ ë°°ì¹˜í•œ í›„, ì§€ë°° íŠ¸ë¦¬ë¥¼ ìˆœíšŒí•˜ë©° ë³€ìˆ˜ë¥¼ ì´ë¦„ ë°”ê¿‰ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">counter</span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">ëª¨ë“ </span><span class="w"> </span><span class="n">ë³€ìˆ˜</span><span class="w"> </span><span class="n">vì—</span><span class="w"> </span><span class="n">ëŒ€í•´</span><span class="p">)</span>
<span class="n">stack</span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ë¹„ì–´ìˆìŒ</span><span class="w"> </span><span class="p">(</span><span class="n">ëª¨ë“ </span><span class="w"> </span><span class="n">ë³€ìˆ˜</span><span class="w"> </span><span class="n">vì—</span><span class="w"> </span><span class="n">ëŒ€í•´</span><span class="p">)</span>

<span class="k">function</span><span class="w"> </span><span class="n">rename</span><span class="p">(</span><span class="n">block</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">bì—ì„œ</span><span class="w"> </span><span class="n">ê°</span><span class="w"> </span><span class="n">phi</span><span class="o">-</span><span class="n">í•¨ìˆ˜</span><span class="w"> </span><span class="ss">&quot;v = phi(...)&quot;</span><span class="n">ì—</span><span class="w"> </span><span class="nl">ëŒ€í•´</span><span class="p">:</span>
<span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter</span><span class="o">[</span><span class="n">v</span><span class="o">]++</span>
<span class="w">        </span><span class="n">stack</span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="n">ì—</span><span class="w"> </span><span class="n">ië¥¼</span><span class="w"> </span><span class="n">push</span>
<span class="w">        </span><span class="n">phiì—ì„œ</span><span class="w"> </span><span class="n">vë¥¼</span><span class="w"> </span><span class="n">v_ië¡œ</span><span class="w"> </span><span class="n">êµì²´</span>

<span class="w">    </span><span class="n">bì˜</span><span class="w"> </span><span class="n">ê°</span><span class="w"> </span><span class="n">ëª…ë ¹ì–´ì—</span><span class="w"> </span><span class="nl">ëŒ€í•´</span><span class="p">:</span>
<span class="w">        </span><span class="n">ë³€ìˆ˜</span><span class="w"> </span><span class="n">vì˜</span><span class="w"> </span><span class="n">ê°</span><span class="w"> </span><span class="n">ì‚¬ìš©ì—</span><span class="w"> </span><span class="nl">ëŒ€í•´</span><span class="p">:</span>
<span class="w">            </span><span class="n">vë¥¼</span><span class="w"> </span><span class="n">v_</span><span class="err">{</span><span class="k">top</span><span class="p">(</span><span class="n">stack</span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="p">)</span><span class="err">}</span><span class="n">ìœ¼ë¡œ</span><span class="w"> </span><span class="n">êµì²´</span>
<span class="w">        </span><span class="n">ë³€ìˆ˜</span><span class="w"> </span><span class="n">vì˜</span><span class="w"> </span><span class="n">ê°</span><span class="w"> </span><span class="n">ì •ì˜ì—</span><span class="w"> </span><span class="nl">ëŒ€í•´</span><span class="p">:</span>
<span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter</span><span class="o">[</span><span class="n">v</span><span class="o">]++</span>
<span class="w">            </span><span class="n">stack</span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="n">ì—</span><span class="w"> </span><span class="n">ië¥¼</span><span class="w"> </span><span class="n">push</span>
<span class="w">            </span><span class="n">vë¥¼</span><span class="w"> </span><span class="n">v_ië¡œ</span><span class="w"> </span><span class="n">êµì²´</span>

<span class="w">    </span><span class="n">bì˜</span><span class="w"> </span><span class="n">ê°</span><span class="w"> </span><span class="n">í›„ê³„ì</span><span class="w"> </span><span class="n">sì—</span><span class="w"> </span><span class="nl">ëŒ€í•´</span><span class="p">:</span>
<span class="w">        </span><span class="n">sì˜</span><span class="w"> </span><span class="n">ê°</span><span class="w"> </span><span class="n">phi</span><span class="o">-</span><span class="n">í•¨ìˆ˜ì—</span><span class="w"> </span><span class="nl">ëŒ€í•´</span><span class="p">:</span>
<span class="w">            </span><span class="n">jë¥¼</span><span class="w"> </span><span class="n">sì˜</span><span class="w"> </span><span class="n">ì„ í–‰ì</span><span class="w"> </span><span class="n">ëª©ë¡ì—ì„œ</span><span class="w"> </span><span class="n">bì˜</span><span class="w"> </span><span class="n">ì¸ë±ìŠ¤ë¼</span><span class="w"> </span><span class="n">í•˜ì</span>
<span class="w">            </span><span class="n">jë²ˆì§¸</span><span class="w"> </span><span class="n">í”¼ì—°ì‚°ì</span><span class="w"> </span><span class="n">vë¥¼</span><span class="w"> </span><span class="n">v_</span><span class="err">{</span><span class="k">top</span><span class="p">(</span><span class="n">stack</span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="p">)</span><span class="err">}</span><span class="n">ìœ¼ë¡œ</span><span class="w"> </span><span class="n">êµì²´</span>

<span class="w">    </span><span class="n">ì§€ë°°</span><span class="w"> </span><span class="n">íŠ¸ë¦¬ì—ì„œ</span><span class="w"> </span><span class="n">bì˜</span><span class="w"> </span><span class="n">ê°</span><span class="w"> </span><span class="n">ìì‹</span><span class="w"> </span><span class="n">cì—</span><span class="w"> </span><span class="nl">ëŒ€í•´</span><span class="p">:</span>
<span class="w">        </span><span class="n">rename</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="w">    </span><span class="n">bì—ì„œ</span><span class="w"> </span><span class="n">v_ië¥¼</span><span class="w"> </span><span class="n">ì •ì˜í•œ</span><span class="w"> </span><span class="n">ê°</span><span class="w"> </span><span class="n">phi</span><span class="w"> </span><span class="n">ë˜ëŠ”</span><span class="w"> </span><span class="n">ëª…ë ¹ì–´ì—</span><span class="w"> </span><span class="nl">ëŒ€í•´</span><span class="p">:</span>
<span class="w">        </span><span class="n">stack</span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="n">ì—ì„œ</span><span class="w"> </span><span class="n">pop</span>
</code></pre></div>

<h3 id="58-ssa">5.8 ì™„ì „í•œ SSA ì˜ˆì‹œ<a class="header-link" href="#58-ssa" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ í”„ë¡œê·¸ë¨ì„ ê³ ë ¤í•´ ë³´ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="nv">L1</span>:<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L2</span>
<span class="w">    </span><span class="nv">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">b</span>
<span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">b</span>
<span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">c</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="nl">L1</span>
<span class="nv">L2</span>:<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">b</span>
</code></pre></div>

<p><strong>CFG</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">B0</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="mi">1</span>
<span class="w"> </span><span class="err">â”‚</span>
<span class="w"> </span><span class="err">â–¼</span>
<span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">a</span><span class="o">&gt;=</span><span class="n">n</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">L2</span><span class="w">  </span><span class="err">â—€â”€â”€â”</span>
<span class="w"> </span><span class="err">â”‚</span><span class="w">        </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span>
<span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="kc">true</span><span class="w">         </span><span class="err">â”‚</span>
<span class="w"> </span><span class="err">â–¼</span><span class="w">        </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span>
<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="w"> </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="n">b</span><span class="w">   </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span>
<span class="w">    </span><span class="n">b</span><span class="o">=</span><span class="n">c</span><span class="w">   </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">L1</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">          </span><span class="err">â”‚</span>
<span class="w">          </span><span class="err">â–¼</span>
<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">b</span>
</code></pre></div>

<p><strong>SSA í˜•ì‹</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">B0</span><span class="o">:</span><span class="w"> </span><span class="n">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">b0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">B1</span>

<span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="o">(</span><span class="n">a0</span><span class="o">,</span><span class="w"> </span><span class="n">a3</span><span class="o">)</span><span class="w">    </span><span class="c1">// From B0 or B2</span>
<span class="w">    </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="o">(</span><span class="n">b0</span><span class="o">,</span><span class="w"> </span><span class="n">b3</span><span class="o">)</span><span class="w">    </span><span class="c1">// From B0 or B2</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B3</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b2</span>
<span class="w">    </span><span class="n">a3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b2</span>
<span class="w">    </span><span class="n">b3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c1</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">B1</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">b4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phi</span><span class="o">(</span><span class="n">b2</span><span class="o">)</span><span class="w">         </span><span class="c1">// (trivial, single predecessor)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b4</span>
</code></pre></div>

<p>ì°¸ê³ : B1ì´ í•©ë¥˜ ì§€ì ì´ê¸° ë•Œë¬¸ì— (B0ê³¼ B2 ëª¨ë‘ì—ì„œ ë„ë‹¬) $\phi$-í•¨ìˆ˜ê°€ ë°°ì¹˜ë©ë‹ˆë‹¤.</p>
<h3 id="59-python-ssa">5.9 Python êµ¬í˜„: SSA êµ¬ì„±<a class="header-link" href="#59-python-ssa" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Simplified SSA construction for a basic CFG.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SSABlock</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A basic block in SSA form.&quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">phis</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>     <span class="c1"># var -&gt; phi operands</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">predecessors</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">successors</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">idom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Immediate dominator block id</span>
    <span class="n">dom_frontier</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>
    <span class="n">dom_children</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SSABuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build SSA form from a simple CFG.</span>

<span class="sd">    This is a simplified demonstration that illustrates the key ideas:</span>
<span class="sd">    1. Compute dominance (simplified)</span>
<span class="sd">    2. Compute dominance frontiers</span>
<span class="sd">    3. Place phi functions</span>
<span class="sd">    4. Rename variables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">SSABlock</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_defs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>  <span class="c1"># var -&gt; blocks defining it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_vars</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">instructions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                  <span class="n">predecessors</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">successors</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a block with its instructions and connectivity.&quot;&quot;&quot;</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">SSABlock</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">block_id</span><span class="p">,</span>
            <span class="n">instructions</span><span class="o">=</span><span class="n">instructions</span><span class="p">,</span>
            <span class="n">predecessors</span><span class="o">=</span><span class="n">predecessors</span><span class="p">,</span>
            <span class="n">successors</span><span class="o">=</span><span class="n">successors</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span>

        <span class="c1"># Track which blocks define which variables</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">instr</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;if&quot;</span><span class="p">)</span> \
               <span class="ow">and</span> <span class="ow">not</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;goto&quot;</span><span class="p">)</span> \
               <span class="ow">and</span> <span class="ow">not</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;return&quot;</span><span class="p">):</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var_defs</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_vars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_dominators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute immediate dominators using a simplified iterative algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Initialize: entry dominates itself; others dominated by all</span>
        <span class="n">dom</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_ids</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">all_ids</span><span class="p">}</span>
        <span class="n">dom</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">entry</span><span class="p">}</span>

        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">all_ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">entry</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">predecessors</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">preds</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">new_dom</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">dom</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">))</span>
                <span class="n">new_dom</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_dom</span> <span class="o">!=</span> <span class="n">dom</span><span class="p">[</span><span class="n">b</span><span class="p">]:</span>
                    <span class="n">dom</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_dom</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Compute immediate dominators from dominator sets</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">all_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">entry</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">idom</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">continue</span>
            <span class="n">strict_doms</span> <span class="o">=</span> <span class="n">dom</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">b</span><span class="p">}</span>
            <span class="c1"># idom is the dominator closest to b (dominated by all others)</span>
            <span class="n">idom</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">strict_doms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">d</span> <span class="ow">in</span> <span class="n">dom</span><span class="p">[</span><span class="n">other</span><span class="p">]</span> <span class="ow">or</span> <span class="n">other</span> <span class="o">==</span> <span class="n">d</span>
                       <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">strict_doms</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">idom</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dom</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">idom</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span> <span class="ow">or</span> <span class="n">d</span> <span class="o">==</span> <span class="n">idom</span><span class="p">:</span>
                        <span class="c1"># d should be the one dominated by fewest</span>
                        <span class="k">if</span> <span class="n">idom</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">idom</span> <span class="ow">in</span> <span class="n">dom</span><span class="p">[</span><span class="n">d</span><span class="p">]:</span>
                            <span class="n">idom</span> <span class="o">=</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">idom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">idom</span> <span class="o">=</span> <span class="n">idom</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">idom</span><span class="p">]</span><span class="o">.</span><span class="n">dom_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_dominance_frontiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute dominance frontiers using the Cooper-Harvey-Kennedy algorithm.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">b_id</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">predecessors</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">predecessors</span><span class="p">:</span>
                    <span class="n">runner</span> <span class="o">=</span> <span class="n">p</span>
                    <span class="k">while</span> <span class="n">runner</span> <span class="o">!=</span> <span class="n">block</span><span class="o">.</span><span class="n">idom</span> <span class="ow">and</span> <span class="n">runner</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">runner</span><span class="p">]</span><span class="o">.</span><span class="n">dom_frontier</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b_id</span><span class="p">)</span>
                        <span class="n">runner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">runner</span><span class="p">]</span><span class="o">.</span><span class="n">idom</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">place_phi_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert phi functions at dominance frontier nodes.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_vars</span><span class="p">:</span>
            <span class="n">worklist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_defs</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="n">ever_on_worklist</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">worklist</span><span class="p">)</span>
            <span class="n">has_phi</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
                <span class="n">block_id</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">df_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">dom_frontier</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">df_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">has_phi</span><span class="p">:</span>
                        <span class="c1"># Insert phi: var = phi(var, var, ...)</span>
                        <span class="n">n_preds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">df_id</span><span class="p">]</span><span class="o">.</span><span class="n">predecessors</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">df_id</span><span class="p">]</span><span class="o">.</span><span class="n">phis</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_preds</span>
                        <span class="n">has_phi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">df_id</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">df_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ever_on_worklist</span><span class="p">:</span>
                            <span class="n">ever_on_worklist</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">df_id</span><span class="p">)</span>
                            <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rename_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename variables to achieve SSA form.&quot;&quot;&quot;</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">new_name</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">counter</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="n">counter</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">stack</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">name</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">current_name</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stack</span><span class="p">[</span><span class="n">var</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">stack</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">rename</span><span class="p">(</span><span class="n">block_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span>
            <span class="n">push_counts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1"># Rename phi definitions</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">phis</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">new_name</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="n">push_counts</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Store the SSA name for this phi</span>
                <span class="n">block</span><span class="o">.</span><span class="n">phis</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">new</span><span class="p">,</span>
                    <span class="s2">&quot;operands&quot;</span><span class="p">:</span> <span class="n">block</span><span class="o">.</span><span class="n">phis</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>  <span class="c1"># Will rename operands from preds</span>
                <span class="p">}</span>

            <span class="c1"># Rename instructions</span>
            <span class="n">new_instructions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
                <span class="n">new_instr</span> <span class="o">=</span> <span class="n">instr</span>

                <span class="c1"># Handle assignments: replace uses then define</span>
                <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">instr</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;if&quot;</span><span class="p">)</span> \
                   <span class="ow">and</span> <span class="ow">not</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;goto&quot;</span><span class="p">)</span> \
                   <span class="ow">and</span> <span class="ow">not</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;return&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">lhs_var</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">rhs</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                    <span class="c1"># Rename uses in RHS</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_vars</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rhs</span><span class="p">:</span>
                            <span class="n">rhs</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">current_name</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

                    <span class="c1"># Rename definition in LHS</span>
                    <span class="n">new_lhs</span> <span class="o">=</span> <span class="n">new_name</span><span class="p">(</span><span class="n">lhs_var</span><span class="p">)</span>
                    <span class="n">push_counts</span><span class="p">[</span><span class="n">lhs_var</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_lhs</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">rhs</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;return&quot;</span><span class="p">):</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_vars</span><span class="p">:</span>
                            <span class="n">new_instr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;return </span><span class="si">{</span><span class="n">current_name</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;if&quot;</span><span class="p">):</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">instr</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_vars</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_instr</span><span class="p">:</span>
                            <span class="n">new_instr</span> <span class="o">=</span> <span class="n">new_instr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">current_name</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

                <span class="n">new_instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_instr</span><span class="p">)</span>

            <span class="n">block</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="n">new_instructions</span>

            <span class="c1"># Fill in phi operands in successors</span>
            <span class="k">for</span> <span class="n">succ_id</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">successors</span><span class="p">:</span>
                <span class="n">succ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">succ_id</span><span class="p">]</span>
                <span class="n">pred_index</span> <span class="o">=</span> <span class="n">succ</span><span class="o">.</span><span class="n">predecessors</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">phi_info</span> <span class="ow">in</span> <span class="n">succ</span><span class="o">.</span><span class="n">phis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phi_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">phi_info</span><span class="p">[</span><span class="s2">&quot;operands&quot;</span><span class="p">][</span><span class="n">pred_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_name</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

            <span class="c1"># Recurse on dominator tree children</span>
            <span class="k">for</span> <span class="n">child_id</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">dom_children</span><span class="p">:</span>
                <span class="n">rename</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>

            <span class="c1"># Pop stacks</span>
            <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">push_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">stack</span><span class="p">[</span><span class="n">var</span><span class="p">]:</span>
                        <span class="n">stack</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">rename</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the full SSA construction pipeline.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_dominators</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_dominance_frontiers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">place_phi_functions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename_variables</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_ssa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty-print the SSA form.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B</span><span class="si">{</span><span class="n">bid</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

            <span class="c1"># Print phi functions</span>
            <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">phi_info</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">phis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phi_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">operands</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">phi_info</span><span class="p">[</span><span class="s2">&quot;operands&quot;</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">phi_info</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = phi(</span><span class="si">{</span><span class="n">operands</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="c1"># Print instructions</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>


<span class="c1"># ---------- Example ----------</span>

<span class="k">def</span><span class="w"> </span><span class="nf">demo_fibonacci_ssa</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a Fibonacci-like loop to SSA.</span>

<span class="sd">    Original:</span>
<span class="sd">        a = 0</span>
<span class="sd">        b = 1</span>
<span class="sd">    L1: if a &gt;= n goto L2</span>
<span class="sd">        c = a + b</span>
<span class="sd">        a = b</span>
<span class="sd">        b = c</span>
<span class="sd">        goto L1</span>
<span class="sd">    L2: return b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Fibonacci Loop in SSA Form ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">builder</span> <span class="o">=</span> <span class="n">SSABuilder</span><span class="p">()</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">instructions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a = 0&quot;</span><span class="p">,</span> <span class="s2">&quot;b = 1&quot;</span><span class="p">],</span>
        <span class="n">predecessors</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">successors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">instructions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;if a &gt;= n goto L2&quot;</span><span class="p">],</span>
        <span class="n">predecessors</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">successors</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">instructions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;c = a + b&quot;</span><span class="p">,</span> <span class="s2">&quot;a = b&quot;</span><span class="p">,</span> <span class="s2">&quot;b = c&quot;</span><span class="p">,</span> <span class="s2">&quot;goto L1&quot;</span><span class="p">],</span>
        <span class="n">predecessors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">successors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">instructions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;return b&quot;</span><span class="p">],</span>
        <span class="n">predecessors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">successors</span><span class="o">=</span><span class="p">[])</span>

    <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">entry</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">print_ssa</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo_fibonacci_ssa</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="6-directed-acyclic-graphs-dags">6. ë°©í–¥ ë¹„ìˆœí™˜ ê·¸ë˜í”„(Directed Acyclic Graphs, DAGs)<a class="header-link" href="#6-directed-acyclic-graphs-dags" title="Permanent link">&para;</a></h2>
<h3 id="61-dag">6.1 í‘œí˜„ì‹ì„ ìœ„í•œ DAG<a class="header-link" href="#61-dag" title="Permanent link">&para;</a></h3>
<p><strong>ë°©í–¥ ë¹„ìˆœí™˜ ê·¸ë˜í”„(Directed Acyclic Graph, DAG)</strong>ëŠ” ì¤‘ë³µ ê³„ì‚°ì„ ì œê±°í•˜ëŠ” í‘œí˜„ì‹ì˜ ê°„ê²°í•œ í‘œí˜„ì…ë‹ˆë‹¤. íŠ¸ë¦¬ì™€ ë‹¬ë¦¬, DAGëŠ” ê³µí†µ ë¶€ë¶„ í‘œí˜„ì‹(common subexpressions)ì˜ ê³µìœ ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.</p>
<p><strong>í‘œí˜„ì‹</strong>: <code>(a + b) * (a + b) - c</code></p>
<p><strong>íŠ¸ë¦¬ í‘œí˜„</strong> (ì¤‘ë³µ):</p>
<div class="highlight"><pre><span></span><code>        <span class="k">-</span>
       / \
      <span class="k">*</span>   c
     / \
    +   +
   / \ / \
  a  b a  b
</code></pre></div>

<p><strong>DAG í‘œí˜„</strong> (ê³µìœ ):</p>
<div class="highlight"><pre><span></span><code>        <span class="k">-</span>
       / \
      <span class="k">*</span>   c
     /|
    +
   / \
  a   b
</code></pre></div>

<p>DAGì—ì„œ ê³µí†µ ë¶€ë¶„ í‘œí˜„ì‹ <code>a + b</code>ëŠ” í•œ ë²ˆ ê³„ì‚°ë˜ê³  ê·¸ ê²°ê³¼ê°€ ê³µìœ ë©ë‹ˆë‹¤.</p>
<h3 id="62-dag">6.2 DAG êµ¬ì„±<a class="header-link" href="#62-dag" title="Permanent link">&para;</a></h3>
<p>í‘œí˜„ì‹ìœ¼ë¡œë¶€í„° DAGë¥¼ êµ¬ì„±í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì€ í‘œí˜„ì‹ì„ ì•„ë˜ì—ì„œ ìœ„ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span><span class="nf">build_dag</span><span class="p">(</span>expr<span class="p">):</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">leaf</span><span class="w"> </span><span class="p">(</span><span class="n">variable</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">constant</span><span class="p">):</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">exists</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="n">node</span>
<span class="w">        </span><span class="k">else</span><span class="p">:</span>
<span class="w">            </span><span class="n">create</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">leaf</span><span class="w"> </span><span class="n">node</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">it</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="s">&quot;left op right&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="n">left_node</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">build_dag</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
<span class="w">        </span><span class="n">right_node</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">build_dag</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">interior</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="n">left_node</span><span class="p">,</span><span class="w"> </span><span class="n">right_node</span><span class="p">)</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">exists</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="n">node</span>
<span class="w">        </span><span class="k">else</span><span class="p">:</span>
<span class="w">            </span><span class="n">create</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">interior</span><span class="w"> </span><span class="n">node</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">it</span>
</code></pre></div>

<p><strong>í•µì‹¬</strong>: ê°™ì€ (op, left, right) íŠ¸ë¦¬í”Œì„ ê°€ì§„ ê¸°ì¡´ ë…¸ë“œë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ í•´ì‹œ í…Œì´ë¸”ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<h3 id="63-dag">6.3 DAGì˜ í™œìš©<a class="header-link" href="#63-dag" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>ê³µí†µ ë¶€ë¶„ í‘œí˜„ì‹ ì œê±°(Common subexpression elimination)</strong>: ê³µìœ  ë…¸ë“œëŠ” í•œ ë²ˆ ìˆ˜í–‰ë˜ëŠ” ê³„ì‚°ì„ ë‚˜íƒ€ëƒ„</li>
<li><strong>ëª…ë ¹ì–´ ì •ë ¬(Instruction ordering)</strong>: DAG ê°„ì„ ì€ ë¶€ë¶„ ìˆœì„œë¥¼ ì •ì˜í•˜ë©°, ìœ„ìƒ ì •ë ¬ì€ ìœ íš¨í•œ ì‹¤í–‰ ìˆœì„œë¥¼ ì œê³µ</li>
<li><strong>ì£½ì€ ì½”ë“œ íƒì§€(Dead code detection)</strong>: ë‚˜ê°€ëŠ” ì‚¬ìš©ì´ ì—†ëŠ” ë…¸ë“œ(ìµœì¢… ê²°ê³¼ ì œì™¸)ëŠ” ì£½ì€ ì½”ë“œì¼ ìˆ˜ ìˆìŒ</li>
<li><strong>ëŒ€ìˆ˜ì  ìµœì í™”(Algebraic optimization)</strong>: DAG ë…¸ë“œì— ë‹¨ìˆœí™” ê·œì¹™ ì ìš© ê°€ëŠ¥</li>
</ol>
<h3 id="64-python-dag">6.4 Python êµ¬í˜„: í‘œí˜„ì‹ DAG<a class="header-link" href="#64-python-dag" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;DAG construction for common subexpression elimination.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DAGNode</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A node in the expression DAG.&quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># Operator or &quot;leaf&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>   <span class="c1"># For leaf nodes: variable name or constant</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>    <span class="c1"># Left child node id</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>   <span class="c1"># Right child node id</span>
    <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># Variable names assigned to this node</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;leaf&quot;</span><span class="p">:</span>
            <span class="n">label_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; [</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}{</span><span class="n">label_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; [</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="si">}{</span><span class="n">label_str</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExpressionDAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build and manage an expression DAG.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">DAGNode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>         <span class="c1"># value -&gt; node_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interior_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>    <span class="c1"># (op, left, right) -&gt; node_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_new_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">nid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">nid</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_or_create_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find or create a leaf node for a variable/constant.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_map</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="n">nid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_id</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">DAGNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">nid</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s2">&quot;leaf&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_map</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid</span>
        <span class="k">return</span> <span class="n">nid</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_or_create_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">left_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find or create an interior node for an operation.&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">left_id</span><span class="p">,</span> <span class="n">right_id</span><span class="p">)</span>

        <span class="c1"># Check commutativity for + and *</span>
        <span class="k">if</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="n">alt_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">right_id</span><span class="p">,</span> <span class="n">left_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">alt_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interior_map</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interior_map</span><span class="p">[</span><span class="n">alt_key</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interior_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interior_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="n">nid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_id</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">DAGNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">nid</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left_id</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interior_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid</span>
        <span class="k">return</span> <span class="n">nid</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">assign_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign a variable name to a DAG node (for variable tracking).&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="c1"># Update leaf map so future references to this variable use this node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_map</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_tac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instructions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process a sequence of TAC instructions and build the DAG.</span>

<span class="sd">        Each instruction should be of the form:</span>
<span class="sd">            &#39;x = y op z&#39;  or  &#39;x = y&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Copy: x = y</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="n">parts</span>
                <span class="n">source_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_or_create_leaf</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assign_label</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="c1"># Binary: x = y op z</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">parts</span>
                <span class="n">left_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_or_create_leaf</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
                <span class="n">right_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_or_create_leaf</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
                <span class="n">result_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_or_create_op</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">left_id</span><span class="p">,</span> <span class="n">right_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assign_label</span><span class="p">(</span><span class="n">result_id</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_dag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty-print the DAG.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Expression DAG ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_optimized_tac</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate optimized TAC from the DAG using topological order.</span>
<span class="sd">        Common subexpressions are computed only once.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Topological sort (using DFS post-order)</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="n">nid</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">visited</span> <span class="ow">or</span> <span class="n">nid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">dfs</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">dfs</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
            <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span>

        <span class="c1"># Start DFS from all root-like nodes (those not used as children)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">left</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">right</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="p">[</span><span class="n">nid</span> <span class="k">for</span> <span class="n">nid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">nid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">children</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
            <span class="n">dfs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

        <span class="c1"># Generate TAC</span>
        <span class="n">tac</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">node_result_name</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;leaf&quot;</span><span class="p">:</span>
                <span class="c1"># Leaf nodes: the variable/constant itself is the name</span>
                <span class="n">node_result_name</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">left_name</span> <span class="o">=</span> <span class="n">node_result_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
                <span class="n">right_name</span> <span class="o">=</span> <span class="n">node_result_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
                <span class="n">result_name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">labels</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;t</span><span class="si">{</span><span class="n">nid</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">tac</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">left_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">right_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">node_result_name</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_name</span>

        <span class="k">return</span> <span class="n">tac</span>


<span class="c1"># ---------- Example ----------</span>

<span class="k">def</span><span class="w"> </span><span class="nf">demo_cse_dag</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstrate CSE via DAG for:</span>
<span class="sd">        t1 = a + b</span>
<span class="sd">        t2 = a + b    &lt;-- common subexpression</span>
<span class="sd">        t3 = t1 * t2</span>
<span class="sd">        t4 = t3 - c</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original TAC:&quot;</span><span class="p">)</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;t1 = a + b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;t2 = a + b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;t3 = t1 * t2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;t4 = t3 - c&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">dag</span> <span class="o">=</span> <span class="n">ExpressionDAG</span><span class="p">()</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">process_tac</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
    <span class="n">dag</span><span class="o">.</span><span class="n">print_dag</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">optimized</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">generate_optimized_tac</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimized TAC (CSE eliminated):&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">optimized</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo_cse_dag</span><span class="p">()</span>
</code></pre></div>

<p><strong>ì˜ˆìƒ ì¶œë ¥</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">Original</span><span class="w"> </span><span class="nl">TAC</span><span class="p">:</span>
<span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="n">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t2</span>
<span class="w">  </span><span class="n">t4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span>

<span class="o">===</span><span class="w"> </span><span class="n">Expression</span><span class="w"> </span><span class="n">DAG</span><span class="w"> </span><span class="o">===</span>
<span class="w">  </span><span class="nl">n0</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">[</span><span class="n">a</span><span class="o">]</span>
<span class="w">  </span><span class="nl">n1</span><span class="p">:</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">[</span><span class="n">b</span><span class="o">]</span>
<span class="w">  </span><span class="nl">n2</span><span class="p">:</span><span class="w"> </span><span class="n">n0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">[</span><span class="n">t1, t2</span><span class="o">]</span>
<span class="w">  </span><span class="nl">n3</span><span class="p">:</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">[</span><span class="n">t3</span><span class="o">]</span>
<span class="w">  </span><span class="nl">n4</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">[</span><span class="n">c</span><span class="o">]</span>
<span class="w">  </span><span class="nl">n5</span><span class="p">:</span><span class="w"> </span><span class="n">n3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n4</span><span class="w"> </span><span class="o">[</span><span class="n">t4</span><span class="o">]</span>

<span class="n">Optimized</span><span class="w"> </span><span class="n">TAC</span><span class="w"> </span><span class="p">(</span><span class="n">CSE</span><span class="w"> </span><span class="n">eliminated</span><span class="p">)</span><span class="err">:</span>
<span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="n">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t1</span>
<span class="w">  </span><span class="n">t4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span>
</code></pre></div>

<p><code>t2 = a + b</code>ê°€ ì œê±°ëœ ê²ƒì— ì£¼ëª©í•˜ì„¸ìš”. DAGê°€ <code>a + b</code>ê°€ ì´ë¯¸ <code>t1</code>ìœ¼ë¡œ ê³„ì‚°ë˜ì—ˆìŒì„ ì¸ì‹í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>
<hr />
<h2 id="7-cfg-linearization-from-cfg-back-to-linear-code">7. ì„ í˜•í™”: CFGì—ì„œ ì„ í˜• ì½”ë“œë¡œ(Linearization: From CFG Back to Linear Code)<a class="header-link" href="#7-cfg-linearization-from-cfg-back-to-linear-code" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 ë¬¸ì œ<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<p>CFG(ë˜ëŠ” ê·¸ê²ƒì˜ SSA í˜•ì‹)ì— ëŒ€í•œ ìµœì í™”ë¥¼ ìˆ˜í–‰í•œ í›„, ì½”ë“œ ìƒì„±ê¸°ë¥¼ ìœ„í•´ ë‹¤ì‹œ ì„ í˜• ëª…ë ¹ì–´ ì‹œí€€ìŠ¤ë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì„ <strong>ì„ í˜•í™”(linearization)</strong> ë˜ëŠ” <strong>ì½”ë“œ ë ˆì´ì•„ì›ƒ(code layout)</strong>ì´ë¼ê³  í•©ë‹ˆë‹¤.</p>
<h3 id="72-block-ordering-strategies">7.2 ë¸”ë¡ ì •ë ¬ ì „ëµ(Block Ordering Strategies)<a class="header-link" href="#72-block-ordering-strategies" title="Permanent link">&para;</a></h3>
<p>ê¸°ë³¸ ë¸”ë¡ì´ ìµœì¢… ì¶œë ¥ì— ë‚˜íƒ€ë‚˜ëŠ” ìˆœì„œëŠ” ë‹¤ìŒì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤:
- <strong>í´-ìŠ¤ë£¨ íš¨ìœ¨ì„±</strong>: ë¬´ì¡°ê±´ ì í”„ ìµœì†Œí™”
- <strong>ìºì‹œ ë™ì‘</strong>: ìì£¼ ì‹¤í–‰ë˜ëŠ” ê²½ë¡œë¥¼ ì—°ì†ìœ¼ë¡œ ìœ ì§€
- <strong>ë¶„ê¸° ì˜ˆì¸¡</strong>: ê°€ëŠ¥ì„± ë†’ì€ ê²½ë¡œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë°°ì¹˜</p>
<p>ì¼ë°˜ì ì¸ ì „ëµ:</p>
<ol>
<li>
<p><strong>ì—­ í›„ìœ„ ìˆœì„œ(Reverse postorder, RPO)</strong>: CFGì— ëŒ€í•œ DFSë¥¼ ìˆ˜í–‰í•˜ê³  ì—­ í›„ìœ„ ìˆœì„œë¡œ ë¸”ë¡ì„ ë°©ë¬¸í•©ë‹ˆë‹¤. ì´ëŠ” ë¸”ë¡ì˜ ì§€ë°°ìê°€ ê·¸ ì•ì— ë‚˜íƒ€ë‚˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ì¶”ì  ê¸°ë°˜ ë ˆì´ì•„ì›ƒ(Trace-based layout)</strong>: ìì£¼ ì‹¤í–‰ë˜ëŠ” ê²½ë¡œ(ì¶”ì )ë¥¼ ì‹ë³„í•˜ê³  ì—°ì†ìœ¼ë¡œ ë°°ì¹˜í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>í•˜í–¥ì‹ ë ˆì´ì•„ì›ƒ(Bottom-up layout)</strong>: ì¶œêµ¬ ë¸”ë¡ì—ì„œ ì‹œì‘í•˜ì—¬ ì—­ë°©í–¥ìœ¼ë¡œ ì‘ì—…í•©ë‹ˆë‹¤.</p>
</li>
</ol>
<h3 id="73">7.3 ì—­ í›„ìœ„ ìˆœì„œ ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#73" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reverse_postorder</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">entry_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute reverse postorder of CFG blocks.</span>
<span class="sd">    Returns a list of block IDs in RPO.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">postorder</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="n">block_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">succ</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">successors</span><span class="p">:</span>
            <span class="n">dfs</span><span class="p">(</span><span class="n">succ</span><span class="p">)</span>
        <span class="n">postorder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>

    <span class="n">dfs</span><span class="p">(</span><span class="n">entry_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">postorder</span><span class="p">))</span>
</code></pre></div>

<h3 id="74-eliminating-redundant-jumps">7.4 ì¤‘ë³µ ì í”„ ì œê±°(Eliminating Redundant Jumps)<a class="header-link" href="#74-eliminating-redundant-jumps" title="Permanent link">&para;</a></h3>
<p>ì„ í˜•í™” í›„, ëŒ€ìƒ ë¸”ë¡ì´ ì í”„í•˜ëŠ” ë¸”ë¡ ë°”ë¡œ ë‹¤ìŒì— ì˜¤ê¸° ë•Œë¬¸ì— (í´-ìŠ¤ë£¨) ì¼ë¶€ ì í”„ê°€ ë¶ˆí•„ìš”í•´ì§‘ë‹ˆë‹¤. ê°„ë‹¨í•œ íŒ¨ìŠ¤ê°€ ì´ë¥¼ ì œê±°í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eliminate_redundant_jumps</span><span class="p">(</span><span class="n">block_order</span><span class="p">,</span> <span class="n">cfg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove goto instructions when the target is the next block</span>
<span class="sd">    in the linear layout.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block_order</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">last</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">last</span><span class="o">.</span><span class="n">is_unconditional_jump</span><span class="p">:</span>
            <span class="c1"># Check if the next block in layout is the jump target</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_order</span><span class="p">):</span>
                <span class="n">next_block</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_order</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">next_block</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">last</span><span class="o">.</span><span class="n">jump_target</span><span class="p">:</span>
                    <span class="c1"># Remove redundant goto</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</code></pre></div>

<h3 id="75-ssa-deconstructing-ssa">7.5 SSA í•´ì²´(Deconstructing SSA)<a class="header-link" href="#75-ssa-deconstructing-ssa" title="Permanent link">&para;</a></h3>
<p>ì½”ë“œ ìƒì„± ì „ì—, $\phi$-í•¨ìˆ˜ëŠ” í•˜ë“œì›¨ì–´ ëŒ€ì‘ì´ ì—†ê¸° ë•Œë¬¸ì— ì œê±°ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. í‘œì¤€ ì ‘ê·¼ ë°©ì‹ì€ ê° $\phi$-í•¨ìˆ˜ë¥¼ ì„ í–‰ì ë¸”ë¡ì˜ <strong>ë³µì‚¬ ëª…ë ¹ì–´(copy instructions)</strong>ë¡œ êµì²´í•©ë‹ˆë‹¤.</p>
<p>ì£¼ì–´ì§„:</p>
<div class="highlight"><pre><span></span><code>B1: ...
    goto B3

B2: ...
    goto B3

B3: x3 = phi(x1, x2)    // x1 from B1, x2 from B2
</code></pre></div>

<p>í•´ì²´ í›„:</p>
<div class="highlight"><pre><span></span><code>B1: ...
    x3 = x1              // copy added
    goto B3

B2: ...
    x3 = x2              // copy added
    goto B3

B3: // phi removed
</code></pre></div>

<p>ì´ë ‡ê²Œ í•˜ë©´ ë‚˜ì¤‘ì— <strong>ë³µì‚¬ ì „íŒŒ(copy propagation)</strong> ë˜ëŠ” <strong>ë ˆì§€ìŠ¤í„° í•©ì¹˜ê¸°(register coalescing)</strong> íŒ¨ìŠ¤ì— ì˜í•´ ì¢…ì¢… ì œê±°ë  ìˆ˜ ìˆëŠ” ë³µì‚¬ ëª…ë ¹ì–´ê°€ ë„ì…ë©ë‹ˆë‹¤.</p>
<p><strong>ë³µì¡í•œ ê²½ìš°</strong>: ì—¬ëŸ¬ $\phi$-í•¨ìˆ˜ê°€ ì„œë¡œì˜ í”¼ì—°ì‚°ìë¥¼ ì°¸ì¡°í•  ë•Œ ("êµí™˜ ë¬¸ì œ"), ë‹¨ìˆœí•œ ì ‘ê·¼ ë°©ì‹ì€ ì˜ëª»ëœ ê²°ê³¼ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ê²°ì±…ì€ ì‹ ì¤‘í•œ ìˆœì„œë¡œ ë³µì‚¬ë¥¼ ì‚½ì…í•˜ê±°ë‚˜ ì¶”ê°€ ì„ì‹œ ë³€ìˆ˜ë¥¼ ë„ì…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<hr />
<h2 id="8">8. ìš”ì•½<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<p>ì´ ë ˆìŠ¨ì—ì„œ ìš°ë¦¬ëŠ” ì»´íŒŒì¼ëŸ¬ ì„¤ê³„ì—ì„œ ì¤‘ê°„ í‘œí˜„ì˜ ì—­í• ì„ íƒêµ¬í–ˆìŠµë‹ˆë‹¤:</p>
<ol>
<li>
<p><strong>IRì€ í”„ë¡ íŠ¸ ì—”ë“œì™€ ë°± ì—”ë“œë¥¼ ë¶„ë¦¬</strong>í•˜ì—¬ $m \times n$ ë¬¸ì œë¥¼ $m + n$ìœ¼ë¡œ ì¤„ì…ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>3-ì£¼ì†Œ ì½”ë“œ(TAC)</strong>ëŠ” ê° ëª…ë ¹ì–´ê°€ ìµœëŒ€ ì„¸ ê°œì˜ í”¼ì—°ì‚°ìë¥¼ ê°€ì§€ëŠ” ì¤‘ê°„ ìˆ˜ì¤€ IRì…ë‹ˆë‹¤. ì¿¼ë“œëŸ¬í”Œ, íŠ¸ë¦¬í”Œ, ë˜ëŠ” ê°„ì ‘ íŠ¸ë¦¬í”Œë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ì œì–´ íë¦„ ê·¸ë˜í”„(CFG)</strong>ëŠ” TACë¥¼ ì œì–´ íë¦„ ê°„ì„ ìœ¼ë¡œ ì—°ê²°ëœ ê¸°ë³¸ ë¸”ë¡ìœ¼ë¡œ ì¡°ì§í•©ë‹ˆë‹¤. ë¦¬ë”ëŠ” ì í”„ ëŒ€ìƒ ë° ì í”„ í›„ ëª…ë ¹ì–´ë¡œ ì‹ë³„ë©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ì •ì  ë‹¨ì¼ ëŒ€ì…(SSA) í˜•ì‹</strong>ì€ ê° ë³€ìˆ˜ë¥¼ ì •í™•íˆ í•œ ë²ˆ í• ë‹¹í•©ë‹ˆë‹¤. íŒŒì´ í•¨ìˆ˜ëŠ” í•©ë¥˜ ì§€ì ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. êµ¬ì„±ì—ëŠ” ì§€ë°° ê²½ê³„, íŒŒì´ ë°°ì¹˜, ë³€ìˆ˜ ì´ë¦„ ë°”ê¾¸ê¸°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>DAG</strong>ëŠ” ê³µí†µ ë¶€ë¶„ í‘œí˜„ì‹ì„ ìì—°ìŠ¤ëŸ½ê²Œ ë…¸ì¶œí•˜ëŠ” ê°„ê²°í•œ í‘œí˜„ì‹ í‘œí˜„ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ì„ í˜•í™”</strong>ëŠ” CFGë¥¼ ìˆœì°¨ì  ì½”ë“œë¡œ ë‹¤ì‹œ ë³€í™˜í•˜ê³ , SSA í•´ì²´ëŠ” íŒŒì´ í•¨ìˆ˜ë¥¼ ë³µì‚¬ ëª…ë ¹ì–´ë¡œ êµì²´í•©ë‹ˆë‹¤.</p>
</li>
</ol>
<p>ì´ëŸ¬í•œ í‘œí˜„ë“¤ì€ í˜„ëŒ€ ì»´íŒŒì¼ëŸ¬ ì¸í”„ë¼ì˜ ê·¼ê°„ì„ í˜•ì„±í•˜ë©°, ì´í›„ ë ˆìŠ¨ì—ì„œ ê³µë¶€í•  ê°•ë ¥í•œ ìµœì í™” íŒ¨ìŠ¤ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="_2">ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="1-tac">ì—°ìŠµ 1: TAC ìƒì„±<a class="header-link" href="#1-tac" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ì½”ë“œë¥¼ 3-ì£¼ì†Œ ì½”ë“œë¡œ ë²ˆì—­í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code>x = 2 <span class="gs">* a + b</span>
<span class="gs">y = a *</span> a - b <span class="gs">* b</span>
<span class="gs">if (x &gt; y)</span>
<span class="gs">    z = x - y</span>
<span class="gs">else</span>
<span class="gs">    z = y - x</span>
<span class="gs">result = z *</span> z
</code></pre></div>

<p>ì„ì‹œ ë³€ìˆ˜, ë ˆì´ë¸”, ì í”„ë¥¼ í¬í•¨í•œ ì™„ì „í•œ TACë¥¼ ë³´ì—¬ì£¼ì„¸ìš”.</p>
<h3 id="2_1">ì—°ìŠµ 2: ê¸°ë³¸ ë¸”ë¡ ì‹ë³„<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ TACì—ì„œ ë¦¬ë”ë¥¼ ì‹ë³„í•˜ê³  ì½”ë“œë¥¼ ê¸°ë³¸ ë¸”ë¡ìœ¼ë¡œ ë¶„í• í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span>
<span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">iffalse</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L3</span>
<span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w">  </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w">  </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span>
<span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w">  </span><span class="n">iffalse</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L2</span>
<span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w">  </span><span class="n">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span>
<span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="w">  </span><span class="n">t4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span>
<span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="n">t4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L1</span>
<span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="p">(</span><span class="mi">14</span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="nl">L0</span>
<span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
</code></pre></div>

<p>L0ì€ ëª…ë ¹ì–´ 3, L1ì€ ëª…ë ¹ì–´ 6, L2ëŠ” ëª…ë ¹ì–´ 13, L3ëŠ” ëª…ë ¹ì–´ 15ì…ë‹ˆë‹¤.</p>
<h3 id="3-ssa">ì—°ìŠµ 3: SSA ë³€í™˜<a class="header-link" href="#3-ssa" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ì½”ë“œë¥¼ SSA í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì„¸ìš”. ëª¨ë“  íŒŒì´ í•¨ìˆ˜ì™€ ê·¸ í”¼ì—°ì‚°ìë¥¼ ëª…í™•í•˜ê²Œ ë³´ì—¬ì£¼ì„¸ìš”.</p>
<div class="highlight"><pre><span></span><code><span class="n">B0</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">B1</span>

<span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="o">)</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B2</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B3</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">B1</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">z</span>
</code></pre></div>

<h3 id="4-dag">ì—°ìŠµ 4: DAG êµ¬ì„±<a class="header-link" href="#4-dag" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ê¸°ë³¸ ë¸”ë¡ì— ëŒ€í•œ DAGë¥¼ êµ¬ì„±í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code>a = b + c
d = b + c
e = a - d
f = a * e
g = f + e
</code></pre></div>

<p>ê³µìœ ë˜ëŠ” ë¶€ë¶„ í‘œí˜„ì‹ì„ ì‹ë³„í•˜ê³  ìµœì í™”ëœ TACë¥¼ ì‘ì„±í•˜ì„¸ìš”.</p>
<h3 id="5">ì—°ìŠµ 5: ì§€ë°° ê²½ê³„<a class="header-link" href="#5" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ CFGì— ëŒ€í•´ ë‹¤ìŒì„ ê³„ì‚°í•˜ì„¸ìš”:
1. ì§€ë°° íŠ¸ë¦¬
2. ê° ë…¸ë“œì˜ ì§€ë°° ê²½ê³„</p>
<div class="highlight"><pre><span></span><code><span class="nv">Entry</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">B1</span>
<span class="nv">B1</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">B2</span>,<span class="w"> </span><span class="nv">B3</span>
<span class="nv">B2</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">B4</span>
<span class="nv">B3</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">B4</span>
<span class="nv">B4</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">B5</span>,<span class="w"> </span><span class="nv">B6</span>
<span class="nv">B5</span><span class="w"> </span>â†’<span class="w"> </span><span class="nv">B1</span>
<span class="nv">B6</span><span class="w"> </span>â†’<span class="w"> </span><span class="k">Exit</span>
</code></pre></div>

<h3 id="6">ì—°ìŠµ 6: êµ¬í˜„ ë„ì „<a class="header-link" href="#6" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ì²˜ë¦¬í•˜ë„ë¡ Python TAC ìƒì„±ê¸°ë¥¼ í™•ì¥í•˜ì„¸ìš”:
1. <strong>í•¨ìˆ˜ í˜¸ì¶œ</strong>: <code>param x</code>, <code>call f, n</code>, ê·¸ë¦¬ê³  <code>result = call f, n</code>
2. <strong>ë°°ì—´ ì ‘ê·¼</strong>: <code>x = a[i]</code>ì™€ <code>a[i] = x</code></p>
<p>ë°°ì—´ì˜ í•©ì„ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ì— ëŒ€í•œ TACë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ì„¸ìš”.</p>
<hr />
<p><a href="./08_Semantic_Analysis.md">ì´ì „: 08_Semantic_Analysis.md</a> | <a href="./10_Runtime_Environments.md">ë‹¤ìŒ: 10_Runtime_Environments.md</a> | <a href="./00_Overview.md">ê°œìš”</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/08_Semantic_Analysis.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë ˆìŠ¨ 8: ì˜ë¯¸ ë¶„ì„(Semantic Analysis)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/10_Runtime_Environments.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë ˆìŠ¨ 10: ëŸ°íƒ€ì„ í™˜ê²½(Runtime Environments)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}