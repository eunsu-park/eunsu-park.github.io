{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë ˆìŠ¨ 12: ìµœì í™” -- ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™” - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Compiler_Design/">Compiler Design</a>
    <span class="separator">/</span>
    <span class="current">ë ˆìŠ¨ 12: ìµœì í™” -- ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™”</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ë ˆìŠ¨ 12: ìµœì í™” -- ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™”</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/11_Code_Generation.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë ˆìŠ¨ 11: ì½”ë“œ ìƒì„±(Code Generation)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/13_Loop_Optimization.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë£¨í”„ ìµœì í™”</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">í•™ìŠµ ëª©í‘œ</a></li>
<li><a href="#1">1. ìµœì í™” ê°œìš”</a><ul>
<li><a href="#11">1.1 ìµœì í™”ë€ ë¬´ì—‡ì¸ê°€?</a></li>
<li><a href="#12">1.2 ì„¸ ê°€ì§€ ìš”êµ¬ ì‚¬í•­</a></li>
<li><a href="#13">1.3 ìµœì í™” ë¶„ë¥˜</a></li>
<li><a href="#14">1.4 ìµœì í™” ì ìš© ì‹œì </a></li>
<li><a href="#15-phase-ordering-problem">1.5 ë‹¨ê³„ ìˆœì„œ ë¬¸ì œ(Phase-Ordering Problem)</a></li>
</ul>
</li>
<li><a href="#2">2. ì§€ì—­ ìµœì í™”</a><ul>
<li><a href="#21-constant-folding">2.1 ìƒìˆ˜ í´ë”©(Constant Folding)</a></li>
<li><a href="#22-constant-propagation">2.2 ìƒìˆ˜ ì „íŒŒ(Constant Propagation)</a></li>
<li><a href="#23-algebraic-simplification">2.3 ëŒ€ìˆ˜ì  ë‹¨ìˆœí™”(Algebraic Simplification)</a></li>
<li><a href="#24-strength-reduction-">2.4 ê°•ë„ ê°ì†Œ(Strength Reduction) -- ì§€ì—­</a></li>
<li><a href="#25-dead-code-elimination-">2.5 ì£½ì€ ì½”ë“œ ì œê±°(Dead Code Elimination) -- ì§€ì—­</a></li>
<li><a href="#26-common-subexpression-elimination-cse">2.6 ê³µí†µ ë¶€ë¶„ì‹ ì œê±°(Common Subexpression Elimination, CSE)</a></li>
<li><a href="#27-copy-propagation">2.7 ë³µì‚¬ ì „íŒŒ(Copy Propagation)</a></li>
<li><a href="#28-local-value-numbering">2.8 ì§€ì—­ ê°’ ë²ˆí˜¸ ë§¤ê¸°ê¸°(Local Value Numbering)</a></li>
<li><a href="#29-python">2.9 Python êµ¬í˜„: ì§€ì—­ ìµœì í™”ê¸°</a></li>
</ul>
</li>
<li><a href="#3">3. ì „ì—­ ë°ì´í„° íë¦„ ë¶„ì„</a><ul>
<li><a href="#31">3.1 ì „ì—­ ë¶„ì„ì´ í•„ìš”í•œ ì´ìœ </a></li>
<li><a href="#32">3.2 ë„¤ ê°€ì§€ ê³ ì „ì  ë¶„ì„</a></li>
<li><a href="#33-reaching-definitions">3.3 ë„ë‹¬ ì •ì˜(Reaching Definitions)</a><ul>
<li><a href="#_2">ë°ì´í„° íë¦„ ë°©ì •ì‹</a></li>
<li><a href="#_3">ì˜ˆì‹œ</a></li>
</ul>
</li>
<li><a href="#34-available-expressions">3.4 ê°€ìš© í‘œí˜„ì‹(Available Expressions)</a><ul>
<li><a href="#_4">ë°ì´í„° íë¦„ ë°©ì •ì‹</a></li>
</ul>
</li>
<li><a href="#35-live-variables">3.5 í™œì„± ë³€ìˆ˜(Live Variables)</a><ul>
<li><a href="#_5">ë°ì´í„° íë¦„ ë°©ì •ì‹</a></li>
</ul>
</li>
<li><a href="#36-very-busy-expressions">3.6 ë§¤ìš° ë°”ìœ í‘œí˜„ì‹(Very Busy Expressions)</a><ul>
<li><a href="#_6">ë°ì´í„° íë¦„ ë°©ì •ì‹</a></li>
</ul>
</li>
<li><a href="#37">3.7 ë„¤ ê°€ì§€ ë¶„ì„ ìš”ì•½</a></li>
</ul>
</li>
<li><a href="#4">4. ë°ì´í„° íë¦„ ë¶„ì„ í”„ë ˆì„ì›Œí¬</a><ul>
<li><a href="#41">4.1 ê²©ì ì´ë¡  ê¸°ì´ˆ</a><ul>
<li><a href="#_7">ë„ë‹¬ ì •ì˜ë¥¼ ìœ„í•œ ê²©ì</a></li>
<li><a href="#_8">ì¼ë°˜ í”„ë ˆì„ì›Œí¬</a></li>
</ul>
</li>
<li><a href="#42">4.2 ì „ë‹¬ í•¨ìˆ˜</a></li>
<li><a href="#43-meet-over-paths-mop">4.3 ê²½ë¡œ ìœ„ì˜ ë§Œë‚¨(Meet-Over-Paths, MOP) í•´</a></li>
<li><a href="#44">4.4 ê³ ì •ì  ë°˜ë³µ</a></li>
<li><a href="#45">4.5 ì›Œí¬ë¦¬ìŠ¤íŠ¸ ì•Œê³ ë¦¬ì¦˜</a></li>
</ul>
</li>
<li><a href="#5-python">5. Python êµ¬í˜„: ë°ì´í„° íë¦„ ë¶„ì„</a></li>
<li><a href="#6">6. ë¶„ì„ ê²°ê³¼ë¥¼ ìµœì í™”ì— ì ìš©</a><ul>
<li><a href="#61">6.1 ì „ì—­ ìƒìˆ˜ ì „íŒŒ</a></li>
<li><a href="#62">6.2 ì „ì—­ ì£½ì€ ì½”ë“œ ì œê±°</a></li>
<li><a href="#63">6.3 ì „ì—­ ê³µí†µ ë¶€ë¶„ì‹ ì œê±°</a></li>
<li><a href="#64-code-hoisting">6.4 ì½”ë“œ ëŒì–´ì˜¬ë¦¬ê¸°(Code Hoisting)</a></li>
</ul>
</li>
<li><a href="#7">7. ê³ ê¸‰ ì£¼ì œ</a><ul>
<li><a href="#71">7.1 ë°˜ë³µ ë¶„ì„ ìˆœì„œ</a></li>
<li><a href="#72-ssa">7.2 SSA ê¸°ë°˜ ë¶„ì„</a></li>
<li><a href="#73">7.3 í”„ë¡œì‹œì € ê°„ ë¶„ì„</a></li>
<li><a href="#74-widening-and-narrowing">7.4 í™•ì¥ê³¼ ìˆ˜ì¶•(Widening and Narrowing)</a></li>
</ul>
</li>
<li><a href="#8">8. ìµœì í™” ì¡°í•©: ì™„ì „í•œ íŒ¨ìŠ¤</a></li>
<li><a href="#9">9. ìš”ì•½</a></li>
<li><a href="#_9">ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1_1">ì—°ìŠµ 1: ì§€ì—­ ìµœì í™”</a></li>
<li><a href="#2_1">ì—°ìŠµ 2: ë„ë‹¬ ì •ì˜</a></li>
<li><a href="#3_1">ì—°ìŠµ 3: í™œì„± ë³€ìˆ˜</a></li>
<li><a href="#4_1">ì—°ìŠµ 4: ê°€ìš© í‘œí˜„ì‹</a></li>
<li><a href="#5">ì—°ìŠµ 5: ì›Œí¬ë¦¬ìŠ¤íŠ¸ ì•Œê³ ë¦¬ì¦˜ ì¶”ì </a></li>
<li><a href="#6_1">ì—°ìŠµ 6: êµ¬í˜„ ë„ì „</a></li>
</ul>
</li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="12-">ë ˆìŠ¨ 12: ìµœì í™” -- ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™”<a class="header-link" href="#12-" title="Permanent link">&para;</a></h1>
<h2 id="_1">í•™ìŠµ ëª©í‘œ<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>ì´ ë ˆìŠ¨ì„ ì™„ë£Œí•˜ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<ol>
<li><strong>ì„¤ëª…</strong>: ì»´íŒŒì¼ëŸ¬ ìµœì í™”ì˜ ì›ì¹™ -- ì•ˆì „ì„±(safety), ìˆ˜ìµì„±(profitability), ê¸°íšŒ(opportunity)</li>
<li><strong>ì ìš©</strong>: ë‹¨ì¼ ê¸°ë³¸ ë¸”ë¡ ë‚´ ì§€ì—­ ìµœì í™”(ìƒìˆ˜ í´ë”©, CSE, ë³µì‚¬ ì „íŒŒ, ì£½ì€ ì½”ë“œ ì œê±°, ê°•ë„ ê°ì†Œ)</li>
<li><strong>ê³µì‹í™”</strong>: ì „ì—­ ë°ì´í„° íë¦„ ë¶„ì„(ë„ë‹¬ ì •ì˜, ê°€ìš© í‘œí˜„ì‹, í™œì„± ë³€ìˆ˜, ë§¤ìš° ë°”ìœ í‘œí˜„ì‹)</li>
<li><strong>ì„¤ëª…</strong>: ê²©ì(lattice)ì™€ ê³ ì •ì  ë°˜ë³µì„ ì‚¬ìš©í•œ ë°ì´í„° íë¦„ ë¶„ì„ì˜ ìˆ˜í•™ì  í”„ë ˆì„ì›Œí¬</li>
<li><strong>êµ¬í˜„</strong>: ë°˜ë³µì  ë°ì´í„° íë¦„ ë¶„ì„ì„ ìœ„í•œ ì›Œí¬ë¦¬ìŠ¤íŠ¸(worklist) ì•Œê³ ë¦¬ì¦˜</li>
<li><strong>êµ¬ì¶•</strong>: Pythonìœ¼ë¡œ ì™„ì „í•œ ë°ì´í„° íë¦„ ë¶„ì„ ì—”ì§„ êµ¬í˜„</li>
</ol>
<hr />
<h2 id="1">1. ìµœì í™” ê°œìš”<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 ìµœì í™”ë€ ë¬´ì—‡ì¸ê°€?<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<p>ì»´íŒŒì¼ëŸ¬ ìš©ì–´ì—ì„œ <strong>ìµœì í™”(optimization)</strong>ë€ í”„ë¡œê·¸ë¨ì˜ ê´€ì°° ê°€ëŠ¥í•œ ë™ì‘ì„ ë³´ì¡´í•˜ë©´ì„œ ì–´ë–¤ ì§€í‘œ -- ì¼ë°˜ì ìœ¼ë¡œ ì‹¤í–‰ ì†ë„, ì½”ë“œ í¬ê¸°, ë˜ëŠ” ì—ë„ˆì§€ ì†Œë¹„ -- ë¥¼ ê°œì„ í•˜ëŠ” í”„ë¡œê·¸ë¨ ë³€í™˜ì…ë‹ˆë‹¤.</p>
<p>"ìµœì í™”"ë¼ëŠ” ìš©ì–´ëŠ” ë‹¤ì†Œ ì˜¤í•´ì˜ ì†Œì§€ê°€ ìˆìŠµë‹ˆë‹¤: ì»´íŒŒì¼ëŸ¬ê°€ ì§„ì •ìœ¼ë¡œ <em>ìµœì ì˜</em> ì½”ë“œë¥¼ ì°¾ëŠ” ê²½ìš°ëŠ” ê±°ì˜ ì—†ìŠµë‹ˆë‹¤. ë” ì •í™•í•˜ê²ŒëŠ” ì»´íŒŒì¼ëŸ¬ê°€ <strong>ì½”ë“œ ê°œì„ (code improvement)</strong>ì„ ìˆ˜í–‰í•œë‹¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="12">1.2 ì„¸ ê°€ì§€ ìš”êµ¬ ì‚¬í•­<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<p>ëª¨ë“  ìµœì í™”ëŠ” ì„¸ ê°€ì§€ ê¸°ì¤€ì„ ì¶©ì¡±í•´ì•¼ í•©ë‹ˆë‹¤:</p>
<ol>
<li>
<p><strong>ì•ˆì „ì„±(Safety/Correctness)</strong>: ë³€í™˜ì´ í”„ë¡œê·¸ë¨ì˜ ê´€ì°° ê°€ëŠ¥í•œ ë™ì‘ì„ ë³€ê²½í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤. ì•ˆì „í•œ ë³€í™˜ì€ ëª¨ë“  ê°€ëŠ¥í•œ ì…ë ¥ì— ëŒ€í•´ ë™ì¼í•œ ì¶œë ¥ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ìˆ˜ìµì„±(Profitability)</strong>: ë³€í™˜ì´ ì‹¤ì œë¡œ ì½”ë“œë¥¼ ê°œì„ í•´ì•¼ í•©ë‹ˆë‹¤. ë ˆì§€ìŠ¤í„° ì••ë°•(register pressure)ì„ ë†’ì´ê³  ë” ë§ì€ ìŠ¤í•„(spill)ì„ ìœ ë°œí•˜ëŠ” ë³€í™˜ì€ ëª…ë ¹ì–´ ìˆ˜ë¥¼ ì¤„ì„ì—ë„ ë¶ˆêµ¬í•˜ê³  ì½”ë“œë¥¼ ë” ëŠë¦¬ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ê¸°íšŒ(Opportunity)</strong>: ìµœì í™”ê°€ ëª©í‘œë¡œ í•˜ëŠ” íŒ¨í„´ì´ ì‹¤ì œë¡œ ì½”ë“œì— ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤. ì»´íŒŒì¼ëŸ¬ëŠ” ë³€í™˜ì„ ì ìš©í•˜ê¸° ì „ì— ê¸°íšŒë¥¼ <strong>ê°ì§€</strong>í•´ì•¼ í•©ë‹ˆë‹¤.</p>
</li>
</ol>
<h3 id="13">1.3 ìµœì í™” ë¶„ë¥˜<a class="header-link" href="#13" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ë²”ìœ„</th>
<th>ì„¤ëª…</th>
<th>ì˜ˆì‹œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ì§€ì—­(Local)</strong></td>
<td>ë‹¨ì¼ ê¸°ë³¸ ë¸”ë¡ ë‚´</td>
<td>ìƒìˆ˜ í´ë”©, CSE, ë³µì‚¬ ì „íŒŒ</td>
</tr>
<tr>
<td><strong>ì „ì—­(Global)</strong> (í”„ë¡œì‹œì € ë‚´)</td>
<td>í•˜ë‚˜ì˜ í•¨ìˆ˜ ë‚´ ê¸°ë³¸ ë¸”ë¡ ê°„</td>
<td>ë£¨í”„ ë¶ˆë³€ ì½”ë“œ ì´ë™, ì „ì—­ CSE</td>
</tr>
<tr>
<td><strong>í”„ë¡œì‹œì € ê°„(Interprocedural)</strong></td>
<td>í•¨ìˆ˜ ê²½ê³„ ê°„</td>
<td>ì¸ë¼ì´ë‹, í”„ë¡œì‹œì € ê°„ ìƒìˆ˜ ì „íŒŒ</td>
</tr>
<tr>
<td><strong>ê¸°ê³„ ì¢…ì†(Machine-dependent)</strong></td>
<td>ëŒ€ìƒ ê¸°ê³„ íŠ¹ì„± í™œìš©</td>
<td>ëª…ë ¹ì–´ ìŠ¤ì¼€ì¤„ë§, í•í™€(peephole) ìµœì í™”</td>
</tr>
<tr>
<td><strong>ê¸°ê³„ ë…ë¦½(Machine-independent)</strong></td>
<td>ëª¨ë“  ëŒ€ìƒì— ì ìš©</td>
<td>ëŒ€ë¶€ë¶„ì˜ IR ìˆ˜ì¤€ ìµœì í™”</td>
</tr>
</tbody>
</table>
<h3 id="14">1.4 ìµœì í™” ì ìš© ì‹œì <a class="header-link" href="#14" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">Source</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="p">[</span><span class="n">Front</span><span class="w"> </span><span class="n">End</span><span class="p">]</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">IR</span>
<span class="w">                        </span><span class="err">â”‚</span>
<span class="w">                        </span><span class="err">â–¼</span>
<span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Machine</span><span class="o">-</span><span class="n">Independent</span><span class="w"> </span><span class="n">Optimizations</span><span class="w"> </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">operate</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">IR</span><span class="p">)</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Constant</span><span class="w"> </span><span class="n">propagation</span><span class="w">            </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Dead</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">elimination</span><span class="w">           </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Loop</span><span class="w"> </span><span class="n">optimizations</span><span class="w">              </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Inlining</span><span class="w">                        </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">                        </span><span class="err">â”‚</span>
<span class="w">                        </span><span class="err">â–¼</span>
<span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Code</span><span class="w"> </span><span class="n">Generation</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">instruction</span><span class="w"> </span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">alloc</span><span class="p">)</span><span class="w"> </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">                        </span><span class="err">â”‚</span>
<span class="w">                        </span><span class="err">â–¼</span>
<span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="n">Machine</span><span class="o">-</span><span class="n">Dependent</span><span class="w"> </span><span class="n">Optimizations</span><span class="w">   </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">operate</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">machine</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w">         </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Peephole</span><span class="w"> </span><span class="n">optimization</span><span class="w">           </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â”‚</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Instruction</span><span class="w"> </span><span class="n">scheduling</span><span class="w">          </span><span class="err">â”‚</span>
<span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">                        </span><span class="err">â”‚</span>
<span class="w">                        </span><span class="err">â–¼</span>
<span class="w">                    </span><span class="n">Machine</span><span class="w"> </span><span class="n">Code</span>
</code></pre></div>

<h3 id="15-phase-ordering-problem">1.5 ë‹¨ê³„ ìˆœì„œ ë¬¸ì œ(Phase-Ordering Problem)<a class="header-link" href="#15-phase-ordering-problem" title="Permanent link">&para;</a></h3>
<p>ìµœì í™”ë“¤ì€ ì„œë¡œ ìƒí˜¸ ì‘ìš©í•©ë‹ˆë‹¤: í•˜ë‚˜ì˜ ìµœì í™”ê°€ ë‹¤ë¥¸ ìµœì í™”ì˜ ê¸°íšŒë¥¼ ë§Œë“¤ê±°ë‚˜, ì´ì „ ìµœì í™”ì˜ ì‘ì—…ì„ ë˜ëŒë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì í™”ê°€ ì ìš©ë˜ëŠ” ìˆœì„œëŠ” ì¤‘ìš”í•˜ë©°, ìµœì„ ì˜ ìˆœì„œë¥¼ ì°¾ëŠ” ê²ƒì€ ì¼ë°˜ì ìœ¼ë¡œ ê²°ì • ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
<p>ì‹¤ì œ ì»´íŒŒì¼ëŸ¬ëŠ” ì‹ ì¤‘í•˜ê²Œ ì¡°ì •ëœ ìˆœì„œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤ (ì˜ˆ: GCCì˜ <code>-O2</code>ëŠ” íŠ¹ì • ìˆœì„œë¡œ ì•½ 60ê°œì˜ ìµœì í™” íŒ¨ìŠ¤ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤).</p>
<hr />
<h2 id="2">2. ì§€ì—­ ìµœì í™”<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<p>ì§€ì—­ ìµœì í™”ëŠ” <strong>ë‹¨ì¼ ê¸°ë³¸ ë¸”ë¡</strong> -- ì‹œì‘ê³¼ ëì„ ì œì™¸í•˜ê³  ë¶„ê¸°ê°€ ì—†ëŠ” ì§ì„ í˜• ëª…ë ¹ì–´ ì‹œí€€ìŠ¤ -- ë‚´ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤. ê¸°ë³¸ ë¸”ë¡ì—ëŠ” í•˜ë‚˜ì˜ ì‹¤í–‰ ê²½ë¡œë§Œ ìˆìœ¼ë¯€ë¡œ, ì´ëŸ¬í•œ ìµœì í™”ì—ëŠ” ë°ì´í„° íë¦„ ë¶„ì„ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<h3 id="21-constant-folding">2.1 ìƒìˆ˜ í´ë”©(Constant Folding)<a class="header-link" href="#21-constant-folding" title="Permanent link">&para;</a></h3>
<p><strong>ìƒìˆ˜ í´ë”©(constant folding)</strong>ì€ ëŸ°íƒ€ì„ì´ ì•„ë‹Œ ì»´íŒŒì¼ ì‹œê°„ì— ìƒìˆ˜ í‘œí˜„ì‹ì„ í‰ê°€í•©ë‹ˆë‹¤.</p>
<p><strong>ì´ì „</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = 3 + 4
t2 = t1 * 2
</code></pre></div>

<p><strong>ì´í›„</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = 7
t2 = 14
</code></pre></div>

<p><strong>ê·œì¹™</strong>: ì»´íŒŒì¼ëŸ¬ëŠ” $e_1$ê³¼ $e_2$ ëª¨ë‘ ìƒìˆ˜ì¸ ê²½ìš° $e_1 \;\text{op}\; e_2$ í‘œí˜„ì‹ì„ í´ë”©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¬ê·€ì ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤.</p>
<p><strong>ì£¼ì˜ ì‚¬í•­</strong>: ì»´íŒŒì¼ëŸ¬ëŠ” ëŒ€ìƒ ê¸°ê³„ì˜ ì‚°ìˆ  ì˜ë¯¸ë¡ ì„ ì¡´ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤:
- ì •ìˆ˜ ì˜¤ë²„í”Œë¡œìš° ë™ì‘ (ë¶€í˜¸ ìˆëŠ” vs ë¶€í˜¸ ì—†ëŠ”)
- ë¶€ë™ ì†Œìˆ˜ì  ë°˜ì˜¬ë¦¼ ëª¨ë“œ
- 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ì²˜ë¦¬</p>
<h3 id="22-constant-propagation">2.2 ìƒìˆ˜ ì „íŒŒ(Constant Propagation)<a class="header-link" href="#22-constant-propagation" title="Permanent link">&para;</a></h3>
<p><strong>ìƒìˆ˜ ì „íŒŒ(constant propagation)</strong>ëŠ” ë³€ìˆ˜ê°€ ìƒìˆ˜ì¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì§„ ê²½ìš° ë³€ìˆ˜ì˜ ì‚¬ìš©ì„ í•´ë‹¹ ìƒìˆ˜ ê°’ìœ¼ë¡œ êµì²´í•©ë‹ˆë‹¤.</p>
<p><strong>ì´ì „</strong>:</p>
<div class="highlight"><pre><span></span><code>x = 5
y = x + 3
z = x * y
</code></pre></div>

<p><strong>ì´í›„</strong> (ì „íŒŒ + í´ë”©):</p>
<div class="highlight"><pre><span></span><code>x = 5
y = 8       // 5 + 3
z = 40      // 5 * 8
</code></pre></div>

<p>ìƒìˆ˜ ì „íŒŒì™€ ìƒìˆ˜ í´ë”©ì˜ ì¡°í•©ì€ ë§¤ìš° ê°•ë ¥í•©ë‹ˆë‹¤ -- ê°ê°ì´ ì—°ì‡„ì ìœ¼ë¡œ ë‹¤ë¥¸ ê²ƒì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.</p>
<h3 id="23-algebraic-simplification">2.3 ëŒ€ìˆ˜ì  ë‹¨ìˆœí™”(Algebraic Simplification)<a class="header-link" href="#23-algebraic-simplification" title="Permanent link">&para;</a></h3>
<p><strong>ëŒ€ìˆ˜ì  ë‹¨ìˆœí™”(algebraic simplification)</strong>ëŠ” ìˆ˜í•™ì  í•­ë“±ì‹ì„ ì ìš©í•˜ì—¬ í‘œí˜„ì‹ì„ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ì›ë³¸</th>
<th>ë‹¨ìˆœí™”</th>
<th>í•­ë“±ì‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>$x + 0$</td>
<td>$x$</td>
<td>ë§ì…ˆ í•­ë“±ì›</td>
</tr>
<tr>
<td>$x - 0$</td>
<td>$x$</td>
<td>ë§ì…ˆ í•­ë“±ì›</td>
</tr>
<tr>
<td>$x \times 1$</td>
<td>$x$</td>
<td>ê³±ì…ˆ í•­ë“±ì›</td>
</tr>
<tr>
<td>$x \times 0$</td>
<td>$0$</td>
<td>ì˜(zero) ì„±ì§ˆ</td>
</tr>
<tr>
<td>$x / 1$</td>
<td>$x$</td>
<td>ë‚˜ëˆ—ì…ˆ í•­ë“±ì›</td>
</tr>
<tr>
<td>$x - x$</td>
<td>$0$</td>
<td>ìê¸° ëº„ì…ˆ</td>
</tr>
<tr>
<td>$x / x$</td>
<td>$1$</td>
<td>ìê¸° ë‚˜ëˆ—ì…ˆ ($x \neq 0$ì¼ ë•Œ)</td>
</tr>
<tr>
<td>$-(-x)$</td>
<td>$x$</td>
<td>ì´ì¤‘ ë¶€ì •</td>
</tr>
<tr>
<td>$x + x$</td>
<td>$2 \times x$</td>
<td>(ë˜ëŠ” 1ë¹„íŠ¸ ì™¼ìª½ ì‹œí”„íŠ¸)</td>
</tr>
</tbody>
</table>
<p><strong>ë¶ˆë¦¬ì–¸ì˜ ê²½ìš°</strong>:</p>
<table>
<thead>
<tr>
<th>ì›ë³¸</th>
<th>ë‹¨ìˆœí™”</th>
</tr>
</thead>
<tbody>
<tr>
<td>$x \land \text{true}$</td>
<td>$x$</td>
</tr>
<tr>
<td>$x \land \text{false}$</td>
<td>$\text{false}$</td>
</tr>
<tr>
<td>$x \lor \text{true}$</td>
<td>$\text{true}$</td>
</tr>
<tr>
<td>$x \lor \text{false}$</td>
<td>$x$</td>
</tr>
<tr>
<td>$\lnot(\lnot x)$</td>
<td>$x$</td>
</tr>
</tbody>
</table>
<h3 id="24-strength-reduction-">2.4 ê°•ë„ ê°ì†Œ(Strength Reduction) -- ì§€ì—­<a class="header-link" href="#24-strength-reduction-" title="Permanent link">&para;</a></h3>
<p><strong>ê°•ë„ ê°ì†Œ(strength reduction)</strong>ëŠ” ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì—°ì‚°ì„ ë” ì €ë ´í•œ ì—°ì‚°ìœ¼ë¡œ êµì²´í•©ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì—°ì‚°</th>
<th>ì €ë ´í•œ ì—°ì‚°</th>
<th>ì¡°ê±´</th>
</tr>
</thead>
<tbody>
<tr>
<td>$x \times 2^n$</td>
<td>$x \ll n$</td>
<td>ì •ìˆ˜ì— ëŒ€í•´ í•­ìƒ ìœ íš¨</td>
</tr>
<tr>
<td>$x / 2^n$</td>
<td>$x \gg n$</td>
<td>ë¶€í˜¸ ì—†ëŠ” ì •ìˆ˜</td>
</tr>
<tr>
<td>$x \% 2^n$</td>
<td>$x \;\&\; (2^n - 1)$</td>
<td>ë¶€í˜¸ ì—†ëŠ” ì •ìˆ˜</td>
</tr>
<tr>
<td>$x \times 3$</td>
<td>$(x \ll 1) + x$</td>
<td>ì‹œí”„íŠ¸+ë§ì…ˆì´ ë” ì €ë ´í•  ë•Œ</td>
</tr>
<tr>
<td>$x \times 5$</td>
<td>$(x \ll 2) + x$</td>
<td>ì‹œí”„íŠ¸+ë§ì…ˆì´ ë” ì €ë ´í•  ë•Œ</td>
</tr>
<tr>
<td>$x \times 15$</td>
<td>$(x \ll 4) - x$</td>
<td>ì‹œí”„íŠ¸-ëº„ì…ˆì´ ë” ì €ë ´í•  ë•Œ</td>
</tr>
</tbody>
</table>
<p><strong>ì˜ˆì‹œ</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="err">ì´ì „</span><span class="o">:</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span>
<span class="err">ì´í›„</span><span class="o">:</span><span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span>
</code></pre></div>

<h3 id="25-dead-code-elimination-">2.5 ì£½ì€ ì½”ë“œ ì œê±°(Dead Code Elimination) -- ì§€ì—­<a class="header-link" href="#25-dead-code-elimination-" title="Permanent link">&para;</a></h3>
<p><strong>ì£½ì€ ì½”ë“œ(dead code)</strong>ëŠ” ê²°ê³¼ê°€ ì ˆëŒ€ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì½”ë“œì…ë‹ˆë‹¤. ì´ë¥¼ ì œê±°í•˜ë©´ ì½”ë“œ í¬ê¸°ê°€ ì¤„ì–´ë“¤ê³  ìºì‹œ ë™ì‘ì´ ê°œì„ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><strong>ì´ì „</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = a + b      // t1 ì‚¬ìš©ë¨
t2 = c * d      // t2ëŠ” ì´í›„ì— ì ˆëŒ€ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
t3 = t1 - 5     // t3 ì‚¬ìš©ë¨
</code></pre></div>

<p><strong>ì´í›„</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = a + b
t3 = t1 - 5
</code></pre></div>

<p>ê¸°ë³¸ ë¸”ë¡ì—ì„œ, ë³€ìˆ˜ê°€ ì¬ì •ì˜ë˜ê¸° ì „ì´ë‚˜ ë¸”ë¡ ë ì „ì— ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë©´ (ê·¸ë¦¬ê³  ë¸”ë¡ì—ì„œ ë‚˜ê°ˆ ë•Œ í™œì„± ìƒíƒœê°€ ì•„ë‹ˆë©´) ì •ì˜ëŠ” ì£½ì–´ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="26-common-subexpression-elimination-cse">2.6 ê³µí†µ ë¶€ë¶„ì‹ ì œê±°(Common Subexpression Elimination, CSE)<a class="header-link" href="#26-common-subexpression-elimination-cse" title="Permanent link">&para;</a></h3>
<p><strong>CSE</strong>ëŠ” ë‘ ë²ˆ ì´ìƒ ê³„ì‚°ë˜ëŠ” í‘œí˜„ì‹ì„ ì‹ë³„í•˜ê³  ì¤‘ë³µ ê³„ì‚°ì„ ì²« ë²ˆì§¸ ê³„ì‚°ì— ëŒ€í•œ ì°¸ì¡°ë¡œ êµì²´í•©ë‹ˆë‹¤.</p>
<p><strong>ì´ì „</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = a + b
t2 = a + b      // t1ê³¼ ë™ì¼í•œ í‘œí˜„ì‹
t3 = t1 * t2
</code></pre></div>

<p><strong>ì´í›„</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = a + b
t2 = t1          // t1ì˜ ê°’ì„ ì¬ì‚¬ìš©
t3 = t1 * t1
</code></pre></div>

<p><strong>ì•ˆì „ ì¡°ê±´</strong>: <code>a</code>ë„ <code>b</code>ë„ ì²« ë²ˆì§¸ ê³„ì‚°ê³¼ ì¤‘ë³µ ê³„ì‚° ì‚¬ì´ì— ì¬ì •ì˜ë˜ì–´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.</p>
<p>ê¸°ë³¸ ë¸”ë¡ ë‚´ CSEëŠ” <strong>ê°’ ë²ˆí˜¸ ë§¤ê¸°ê¸°(value numbering)</strong> (ì•„ë˜ ì°¸ì¡°) ë˜ëŠ” DAG êµ¬ì„± (ë ˆìŠ¨ 9 ì°¸ì¡°)ì„ ì‚¬ìš©í•˜ì—¬ íš¨ìœ¨ì ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="27-copy-propagation">2.7 ë³µì‚¬ ì „íŒŒ(Copy Propagation)<a class="header-link" href="#27-copy-propagation" title="Permanent link">&para;</a></h3>
<p><strong>ë³µì‚¬ ì „íŒŒ(copy propagation)</strong>ëŠ” ë³µì‚¬ (<code>x = y</code>)ë¡œ í• ë‹¹ëœ ë³€ìˆ˜ì˜ ì‚¬ìš©ì„ ì›ë˜ ë³€ìˆ˜ë¡œ êµì²´í•©ë‹ˆë‹¤.</p>
<p><strong>ì´ì „</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = a + b
t2 = t1          // ë³µì‚¬
t3 = t2 * c      // t2ë¥¼ ì‚¬ìš© (ì‹¤ì œë¡œëŠ” t1)
</code></pre></div>

<p><strong>ì´í›„</strong>:</p>
<div class="highlight"><pre><span></span><code>t1 = a + b
t2 = t1           // ë³µì‚¬ (ì£½ì€ ì½”ë“œê°€ ë  ìˆ˜ ìˆìŒ)
t3 = t1 * c       // t2ë¥¼ t1ë¡œ êµì²´
</code></pre></div>

<p>ë³µì‚¬ ì „íŒŒ í›„, ë³µì‚¬ <code>t2 = t1</code>ì€ ì£½ì€ ì½”ë“œê°€ ë˜ì–´ ì œê±°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="28-local-value-numbering">2.8 ì§€ì—­ ê°’ ë²ˆí˜¸ ë§¤ê¸°ê¸°(Local Value Numbering)<a class="header-link" href="#28-local-value-numbering" title="Permanent link">&para;</a></h3>
<p><strong>ì§€ì—­ ê°’ ë²ˆí˜¸ ë§¤ê¸°ê¸°(local value numbering)</strong>ëŠ” ê¸°ë³¸ ë¸”ë¡ì„ í•œ ë²ˆ í†µê³¼í•˜ë©´ì„œ CSE, ìƒìˆ˜ í´ë”©, ëŒ€ìˆ˜ì  ë‹¨ìˆœí™”ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì²´ê³„ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤.</p>
<p><strong>ì•„ì´ë””ì–´</strong>: ê° ê³„ì‚°ëœ ê°’ì— <strong>ê°’ ë²ˆí˜¸(value number)</strong>ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. ë‘ í‘œí˜„ì‹ì´ ê°™ì€ ê°’ì„ ê³„ì‚°í•˜ë©´ ê°™ì€ ê°’ ë²ˆí˜¸ë¥¼ ì–»ìŠµë‹ˆë‹¤.</p>
<p><strong>ì•Œê³ ë¦¬ì¦˜</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">hash_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Maps</span><span class="w"> </span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="n">vn1</span><span class="p">,</span><span class="w"> </span><span class="n">vn2</span><span class="p">)</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="n">number</span>
<span class="n">var_to_vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="n">Maps</span><span class="w"> </span><span class="k">variable</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="n">number</span>
<span class="n">next_vn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="ss">&quot;x = y op z&quot;</span><span class="err">:</span>
<span class="w">    </span><span class="n">vn_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var_to_vn</span><span class="o">[</span><span class="n">y</span><span class="o">]</span>
<span class="w">    </span><span class="n">vn_z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var_to_vn</span><span class="o">[</span><span class="n">z</span><span class="o">]</span>

<span class="w">    </span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="n">vn_y</span><span class="p">,</span><span class="w"> </span><span class="n">vn_z</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">hash_table</span><span class="p">:</span>
<span class="w">        </span><span class="n">vn_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hash_table</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="n">Same</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">computed</span>
<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nf">Replace</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">representative</span>
<span class="w">    </span><span class="k">else</span><span class="err">:</span>
<span class="w">        </span><span class="n">vn_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_vn</span><span class="o">++</span>
<span class="w">        </span><span class="n">hash_table</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn_x</span>

<span class="w">    </span><span class="n">var_to_vn</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vn_x</span>
</code></pre></div>

<h3 id="29-python">2.9 Python êµ¬í˜„: ì§€ì—­ ìµœì í™”ê¸°<a class="header-link" href="#29-python" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Local optimizations within a single basic block.</span>
<span class="sd">Implements constant folding, constant propagation, algebraic</span>
<span class="sd">simplification, strength reduction, CSE, copy propagation,</span>
<span class="sd">and dead code elimination.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">operator</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TAC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Three-address code instruction.&quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># &#39;+&#39;, &#39;-&#39;, &#39;*&#39;, &#39;/&#39;, &#39;copy&#39;, &#39;nop&#39;</span>
    <span class="n">arg1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">arg2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;copy&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;nop&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;// NOP (eliminated)&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">is_constant</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a string represents an integer constant.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">const_val</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the integer value of a constant string.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LocalOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs local optimizations on a basic block (list of TAC instructions).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instructions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TAC</span><span class="p">],</span> <span class="n">live_out</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">live_out</span> <span class="o">=</span> <span class="n">live_out</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Variables live at exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">TAC</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all local optimizations until convergence.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_passes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constant_folding</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constant_propagation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">algebraic_simplification</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strength_reduction</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy_propagation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">common_subexpression_elimination</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dead_code_elimination</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">changed</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Remove NOP instructions</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">op</span> <span class="o">!=</span> <span class="s2">&quot;nop&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">constant_folding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate constant expressions at compile time.&quot;&quot;&quot;</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;+&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>
            <span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">,</span>
            <span class="s1">&#39;%&#39;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="n">ops</span> <span class="ow">and</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span> \
               <span class="ow">and</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">const_val</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">const_val</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Cannot fold division by zero</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ops</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="p">](</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">constant_propagation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace variable uses with constant values when known.&quot;&quot;&quot;</span>
        <span class="n">constants</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># var -&gt; constant value</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">):</span>
            <span class="c1"># Check if this defines a constant</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;copy&quot;</span> <span class="ow">and</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">):</span>
                <span class="n">constants</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span>

            <span class="c1"># Replace uses with constants</span>
            <span class="n">new_arg1</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span>
            <span class="n">new_arg2</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span>

            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">in</span> <span class="n">constants</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">!=</span> <span class="s2">&quot;copy&quot;</span><span class="p">:</span>
                <span class="n">new_arg1</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">in</span> <span class="n">constants</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;copy&quot;</span><span class="p">:</span>
                <span class="n">new_arg1</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="ow">in</span> <span class="n">constants</span><span class="p">:</span>
                <span class="n">new_arg2</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">new_arg1</span> <span class="o">!=</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">or</span> <span class="n">new_arg2</span> <span class="o">!=</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
                                           <span class="n">new_arg1</span><span class="p">,</span> <span class="n">new_arg2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># If this instruction redefines a variable, invalidate it</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span> <span class="ow">in</span> <span class="n">constants</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">!=</span> <span class="s2">&quot;copy&quot;</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">constants</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span> <span class="ow">in</span> <span class="n">constants</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;copy&quot;</span>
                  <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)):</span>
                <span class="k">del</span> <span class="n">constants</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">algebraic_simplification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply algebraic identities.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span>
            <span class="n">new_instr</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># x + 0 = x, 0 + x = x</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>

            <span class="c1"># x - 0 = x</span>
            <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span>
                <span class="c1"># x - x = 0</span>
                <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="o">==</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

            <span class="c1"># x * 1 = x, 1 * x = x, x * 0 = 0</span>
            <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">or</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

            <span class="c1"># x / 1 = x</span>
            <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span>
                <span class="c1"># x / x = 1 (assume x != 0)</span>
                <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="o">==</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
                    <span class="n">new_instr</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_instr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_instr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">strength_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace expensive operations with cheaper ones.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span> <span class="ow">and</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">const_val</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span>
                        <span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;&lt;&lt;&quot;</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">const_val</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span>
                        <span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy_propagation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace uses of copied variables with the source.&quot;&quot;&quot;</span>
        <span class="n">copies</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># target -&gt; source</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">):</span>
            <span class="c1"># Record copies</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;copy&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">):</span>
                <span class="n">copies</span><span class="p">[</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span>

            <span class="c1"># Propagate copies in uses</span>
            <span class="n">new_arg1</span> <span class="o">=</span> <span class="n">copies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span>
            <span class="n">new_arg2</span> <span class="o">=</span> <span class="n">copies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_arg1</span> <span class="o">!=</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">or</span> <span class="n">new_arg2</span> <span class="o">!=</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
                                           <span class="n">new_arg1</span><span class="p">,</span> <span class="n">new_arg2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Invalidate if source is redefined</span>
            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">copies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span> <span class="ow">or</span> <span class="n">target</span> <span class="o">==</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">:</span>
                    <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span> <span class="ow">or</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">!=</span> <span class="s2">&quot;copy&quot;</span><span class="p">:</span>
                    <span class="n">copies</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">common_subexpression_elimination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Eliminate redundant computations using value numbering.&quot;&quot;&quot;</span>
        <span class="c1"># (op, arg1, arg2) -&gt; result variable</span>
        <span class="n">computed</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>

                <span class="c1"># Check commutative operators</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
                    <span class="n">comm_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">comm_key</span> <span class="ow">in</span> <span class="n">computed</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">comm_key</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">computed</span><span class="p">:</span>
                    <span class="c1"># Replace with copy from previous computation</span>
                    <span class="n">prev_result</span> <span class="o">=</span> <span class="n">computed</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span>
                        <span class="n">instr</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">prev_result</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">computed</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span>

                <span class="c1"># Invalidate entries if arg is redefined</span>
                <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">computed</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                             <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span> <span class="ow">in</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">computed</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dead_code_elimination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove instructions whose results are never used.&quot;&quot;&quot;</span>
        <span class="c1"># Find all used variables (scan backward)</span>
        <span class="n">used</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_out</span><span class="p">)</span>

        <span class="c1"># Scan backward to find used variables</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;nop&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">):</span>
                <span class="n">used</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_constant</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">):</span>
                <span class="n">used</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>

        <span class="c1"># Mark instructions as dead if result is not used</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;nop&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">result</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_out</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;nop&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demo_local_optimizations</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate local optimizations on a basic block.&quot;&quot;&quot;</span>

    <span class="n">instructions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">),</span>         <span class="c1"># t1 = 5</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">),</span>         <span class="c1"># t2 = 3</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t3&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">),</span>     <span class="c1"># t3 = t1 + t2 â†’ fold to 8</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t4&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;t3&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">),</span>      <span class="c1"># t4 = t3 * 0 â†’ simplify to 0</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t5&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">),</span>       <span class="c1"># t5 = a + b</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t6&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">),</span>       <span class="c1"># t6 = a + b  (CSE)</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t7&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;t5&quot;</span><span class="p">,</span> <span class="s2">&quot;t6&quot;</span><span class="p">),</span>     <span class="c1"># t7 = t5 * t6 â†’ t5 * t5</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t8&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;t7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">),</span>      <span class="c1"># t8 = t7 * 8 â†’ strength reduce</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t9&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;t8&quot;</span><span class="p">),</span>        <span class="c1"># t9 = t8 (copy)</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;t10&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;t9&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">),</span>     <span class="c1"># t10 = t9 + 0 â†’ simplify</span>
        <span class="n">TAC</span><span class="p">(</span><span class="s2">&quot;unused&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">),</span> <span class="c1"># dead code (unused not live-out)</span>
    <span class="p">]</span>

    <span class="n">live_out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;t8&quot;</span><span class="p">,</span> <span class="s2">&quot;t10&quot;</span><span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Before Optimization ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">LocalOptimizer</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">live_out</span><span class="p">)</span>
    <span class="n">optimized</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== After Optimization ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">optimized</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo_local_optimizations</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="3">3. ì „ì—­ ë°ì´í„° íë¦„ ë¶„ì„<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ì „ì—­ ë¶„ì„ì´ í•„ìš”í•œ ì´ìœ <a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<p>ì§€ì—­ ìµœì í™”ëŠ” ë‹¨ì¼ ê¸°ë³¸ ë¸”ë¡ìœ¼ë¡œ ì œí•œë©ë‹ˆë‹¤. ë¸”ë¡ ê²½ê³„ë¥¼ ë„˜ì–´ ìµœì í™”í•˜ë ¤ë©´ ì „ì²´ ì œì–´ íë¦„ ê·¸ë˜í”„(CFG)ë¥¼ í†µí•œ ë°ì´í„° íë¦„ì„ ì¶”ë¡ í•˜ëŠ” <strong>ì „ì—­</strong>(í”„ë¡œì‹œì € ë‚´) ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<p><strong>ì˜ˆì‹œ</strong>: íŠ¹ì • ì§€ì ì—ì„œ ë³€ìˆ˜ê°€ ìƒìˆ˜ ê°’ì„ ê°€ì§€ëŠ”ì§€ ê²°ì •í•˜ë ¤ë©´, í•´ë‹¹ ì§€ì ì— ë„ë‹¬í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ê²½ë¡œë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤ -- ì´ëŠ” ì „ì²´ CFG ë¶„ì„ì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.</p>
<h3 id="32">3.2 ë„¤ ê°€ì§€ ê³ ì „ì  ë¶„ì„<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<p>ë„¤ ê°€ì§€ ê¸°ë°˜ì´ ë˜ëŠ” ë°ì´í„° íë¦„ ë¶„ì„ì€ ì¶”ì í•˜ëŠ” ê²ƒê³¼ ì •ë³´ê°€ íë¥´ëŠ” ë°©í–¥ì´ ë‹¤ë¦…ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ë¶„ì„</th>
<th>ë°©í–¥</th>
<th>í•©ë¥˜ ì—°ì‚°ì</th>
<th>ì§ˆë¬¸</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ë„ë‹¬ ì •ì˜(Reaching Definitions)</strong></td>
<td>ìˆœë°©í–¥</td>
<td>í•©ë¥˜ì  ($\cup$)</td>
<td>$x$ì˜ ì–´ë–¤ ì •ì˜ê°€ ì´ ì§€ì ì— ë„ë‹¬í•  ìˆ˜ ìˆëŠ”ê°€?</td>
</tr>
<tr>
<td><strong>ê°€ìš© í‘œí˜„ì‹(Available Expressions)</strong></td>
<td>ìˆœë°©í–¥</td>
<td>í•©ë¥˜ì  ($\cap$)</td>
<td>ì–´ë–¤ í‘œí˜„ì‹ì´ ê³„ì‚°ë˜ì—ˆë‹¤ê³  ë³´ì¥ë˜ëŠ”ê°€?</td>
</tr>
<tr>
<td><strong>í™œì„± ë³€ìˆ˜(Live Variables)</strong></td>
<td>ì—­ë°©í–¥</td>
<td>í•©ë¥˜ì  ($\cup$)</td>
<td>ì–´ë–¤ ë³€ìˆ˜ê°€ ì¬ì •ì˜ ì „ì— ì‚¬ìš©ë  ìˆ˜ ìˆëŠ”ê°€?</td>
</tr>
<tr>
<td><strong>ë§¤ìš° ë°”ìœ í‘œí˜„ì‹(Very Busy Expressions)</strong></td>
<td>ì—­ë°©í–¥</td>
<td>í•©ë¥˜ì  ($\cap$)</td>
<td>ì–´ë–¤ í‘œí˜„ì‹ì´ ëª¨ë“  ê²½ë¡œì—ì„œ ë°˜ë“œì‹œ í‰ê°€ë˜ëŠ”ê°€?</td>
</tr>
</tbody>
</table>
<h3 id="33-reaching-definitions">3.3 ë„ë‹¬ ì •ì˜(Reaching Definitions)<a class="header-link" href="#33-reaching-definitions" title="Permanent link">&para;</a></h3>
<p><strong>ì •ì˜(definition)</strong>ëŠ” ë³€ìˆ˜ì— ê°’ì„ í• ë‹¹í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤ (ì˜ˆ: <code>d: x = ...</code>).</p>
<p>ë³€ìˆ˜ $x$ì˜ ì •ì˜ $d$ê°€ ì§€ì  $p$ì— <strong>ë„ë‹¬(reaches)</strong>í•˜ëŠ” ê²½ìš°:
- $d$ì—ì„œ $p$ê¹Œì§€ì˜ ê²½ë¡œê°€ ì¡´ì¬í•˜ê³ ,
- ê·¸ ê²½ë¡œë¥¼ ë”°ë¼ $x$ê°€ ì¬ì •ì˜ë˜ì§€ ì•Šì€ ê²½ìš°</p>
<p><strong>ì‚¬ìš©ì²˜</strong>: ìƒìˆ˜ ì „íŒŒ (ë„ë‹¬ ì •ì˜ê°€ í•˜ë‚˜ë¿ì´ê³  ìƒìˆ˜ë¥¼ í• ë‹¹í•˜ëŠ” ê²½ìš° ì „íŒŒ ê°€ëŠ¥).</p>
<h4 id="_2">ë°ì´í„° íë¦„ ë°©ì •ì‹<a class="header-link" href="#_2" title="Permanent link">&para;</a></h4>
<p>ê° ê¸°ë³¸ ë¸”ë¡ $B$ì— ëŒ€í•´:</p>
<p>$$\text{Out}(B) = \text{Gen}(B) \cup (\text{In}(B) - \text{Kill}(B))$$</p>
<p>$$\text{In}(B) = \bigcup_{P \in \text{pred}(B)} \text{Out}(P)$$</p>
<p>ì—¬ê¸°ì„œ:
- $\text{Gen}(B)$ = $B$ì—ì„œ ìƒì„±ë˜ì–´ $B$ì˜ ëê¹Œì§€ ì‚´ì•„ë‚¨ëŠ” ì •ì˜
- $\text{Kill}(B)$ = $B$ê°€ ì œê±°í•˜ëŠ” ì •ì˜ ($B$ê°€ ì¬ì •ì˜í•˜ëŠ” ë³€ìˆ˜ì˜ ì •ì˜)</p>
<p><strong>ë°©í–¥</strong>: ìˆœë°©í–¥ (ì •ë³´ê°€ ì„ í–‰ ë¸”ë¡ì—ì„œ í›„ì† ë¸”ë¡ìœ¼ë¡œ íë¦„)</p>
<p><strong>í•©ë¥˜ ì—°ì‚°ì</strong>: í•©ì§‘í•©($\cup$) -- ì •ì˜ê°€ <em>ì„ì˜ì˜</em> ê²½ë¡œë¥¼ í†µí•´ ë„ë‹¬í•˜ë©´ ë„ë‹¬í•¨</p>
<p><strong>ì´ˆê¸°í™”</strong>: ëª¨ë“  ë¸”ë¡ì— ëŒ€í•´ $\text{Out}(B) = \text{Gen}(B)$; $\text{In}(\text{entry}) = \emptyset$</p>
<h4 id="_3">ì˜ˆì‹œ<a class="header-link" href="#_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="n">d1</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="n">d2</span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="n">B2</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">d3</span><span class="o">:</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">B3</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="err">â†’</span><span class="w"> </span><span class="n">B4</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">d4</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">d5</span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="err">â†’</span><span class="w"> </span><span class="n">B2</span>

<span class="n">B4</span><span class="o">:</span><span class="w"> </span><span class="n">print</span><span class="w"> </span><span class="n">z</span>
</code></pre></div>

<p><strong>Genê³¼ Kill ì§‘í•©</strong>:</p>
<table>
<thead>
<tr>
<th>ë¸”ë¡</th>
<th>Gen</th>
<th>Kill</th>
</tr>
</thead>
<tbody>
<tr>
<td>B1</td>
<td>{d1, d2}</td>
<td>{d4, d5} (x, yì˜ ë‹¤ë¥¸ ì •ì˜)</td>
</tr>
<tr>
<td>B2</td>
<td>{d3}</td>
<td>{} (zì˜ ë‹¤ë¥¸ ì •ì˜ ì—†ìŒ)</td>
</tr>
<tr>
<td>B3</td>
<td>{d4, d5}</td>
<td>{d1, d2} (x, yì˜ ë‹¤ë¥¸ ì •ì˜)</td>
</tr>
<tr>
<td>B4</td>
<td>{}</td>
<td>{}</td>
</tr>
</tbody>
</table>
<p><strong>ë°˜ë³µ</strong>:</p>
<table>
<thead>
<tr>
<th>ë°˜ë³µ</th>
<th>In(B1)</th>
<th>Out(B1)</th>
<th>In(B2)</th>
<th>Out(B2)</th>
<th>In(B3)</th>
<th>Out(B3)</th>
<th>In(B4)</th>
<th>Out(B4)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Init</td>
<td>{}</td>
<td>{d1,d2}</td>
<td>{}</td>
<td>{d3}</td>
<td>{}</td>
<td>{d4,d5}</td>
<td>{}</td>
<td>{}</td>
</tr>
<tr>
<td>1</td>
<td>{}</td>
<td>{d1,d2}</td>
<td>{d1,d2,d4,d5}</td>
<td>{d1,d2,d3,d4,d5}</td>
<td>{d1,d2,d3,d4,d5}</td>
<td>{d3,d4,d5}</td>
<td>{d1,d2,d3,d4,d5}</td>
<td>{d1,d2,d3,d4,d5}</td>
</tr>
<tr>
<td>2</td>
<td>{}</td>
<td>{d1,d2}</td>
<td>{d1,d2,d3,d4,d5}</td>
<td>{d1,d2,d3,d4,d5}</td>
<td>{d1,d2,d3,d4,d5}</td>
<td>{d3,d4,d5}</td>
<td>{d1,d2,d3,d4,d5}</td>
<td>{d1,d2,d3,d4,d5}</td>
</tr>
</tbody>
</table>
<p>B2ì—ì„œ $d_1$ê³¼ $d_4$ ëª¨ë‘ $x$ë¥¼ ì •ì˜í•˜ë¯€ë¡œ, $x$ì— ëŒ€í•œ ë‹¨ì¼ ìƒìˆ˜ë¥¼ ì „íŒŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
<h3 id="34-available-expressions">3.4 ê°€ìš© í‘œí˜„ì‹(Available Expressions)<a class="header-link" href="#34-available-expressions" title="Permanent link">&para;</a></h3>
<p>í‘œí˜„ì‹ $e$ê°€ ì§€ì  $p$ì—ì„œ <strong>ê°€ìš©(available)</strong>í•œ ê²½ìš°:
- ì§„ì…ì ì—ì„œ $p$ê¹Œì§€ì˜ <strong>ëª¨ë“ </strong> ê²½ë¡œì—ì„œ $e$ê°€ ê³„ì‚°ë˜ê³ ,
- $e$ì˜ ë§ˆì§€ë§‰ ê³„ì‚° ì´í›„ì— $e$ì˜ í”¼ì—°ì‚°ìê°€ ì¬ì •ì˜ë˜ì§€ ì•Šì€ ê²½ìš°</p>
<p><strong>ì‚¬ìš©ì²˜</strong>: ì „ì—­ ê³µí†µ ë¶€ë¶„ì‹ ì œê±°. $e$ê°€ $p$ì—ì„œ ê°€ìš©í•˜ê³  $p$ê°€ $e$ë¥¼ ê³„ì‚°í•˜ë©´, $p$ì˜ ê³„ì‚°ì„ ì´ì „ì— ê³„ì‚°ëœ ê°’ìœ¼ë¡œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h4 id="_4">ë°ì´í„° íë¦„ ë°©ì •ì‹<a class="header-link" href="#_4" title="Permanent link">&para;</a></h4>
<p>$$\text{Out}(B) = \text{Gen}(B) \cup (\text{In}(B) - \text{Kill}(B))$$</p>
<p>$$\text{In}(B) = \bigcap_{P \in \text{pred}(B)} \text{Out}(P)$$</p>
<p><strong>ë°©í–¥</strong>: ìˆœë°©í–¥</p>
<p><strong>í•©ë¥˜ ì—°ì‚°ì</strong>: êµì§‘í•©($\cap$) -- í‘œí˜„ì‹ì€ <em>ëª¨ë“ </em> ê²½ë¡œì—ì„œ ê°€ìš©í•  ë•Œë§Œ ê°€ìš©í•¨</p>
<p><strong>ì´ˆê¸°í™”</strong>: $\text{Out}(\text{entry}) = \emptyset$; $B \neq \text{entry}$ì¸ ê²½ìš° $\text{Out}(B) = U$ (ëª¨ë“  í‘œí˜„ì‹)</p>
<p>êµì§‘í•© ì‚¬ìš©ì´ í•µì‹¬ì…ë‹ˆë‹¤: í‘œí˜„ì‹ì€ <em>ëª¨ë“ </em> ì§„ì… ê²½ë¡œë¥¼ ë”°ë¼ ê³„ì‚°ëœ ê²½ìš°ì—ë§Œ ê°€ìš©í•©ë‹ˆë‹¤. ì´ëŠ” "must" ë¶„ì„ (ëª¨ë“  ê²½ë¡œì—ì„œ ì°¸ì´ì–´ì•¼ í•¨)ìœ¼ë¡œ, ë„ë‹¬ ì •ì˜ì˜ "may" ë¶„ì„ (ì„ì˜ì˜ ê²½ë¡œë¥¼ í†µí•´ ë„ë‹¬í•  ìˆ˜ ìˆìŒ)ê³¼ ëŒ€ì¡°ë©ë‹ˆë‹¤.</p>
<h3 id="35-live-variables">3.5 í™œì„± ë³€ìˆ˜(Live Variables)<a class="header-link" href="#35-live-variables" title="Permanent link">&para;</a></h3>
<p>ë³€ìˆ˜ $v$ê°€ ì§€ì  $p$ì—ì„œ <strong>í™œì„±(live)</strong>ì¸ ê²½ìš°:
- $p$ì—ì„œ $v$ì˜ ì‚¬ìš©ê¹Œì§€ ê²½ë¡œê°€ ì¡´ì¬í•˜ê³ ,
- ê·¸ ê²½ë¡œë¥¼ ë”°ë¼ $v$ê°€ ì¬ì •ì˜ë˜ì§€ ì•Šì€ ê²½ìš°</p>
<p><strong>ì‚¬ìš©ì²˜</strong>: ë ˆì§€ìŠ¤í„° í• ë‹¹ (í™œì„± ë³€ìˆ˜ëŠ” ë ˆì§€ìŠ¤í„°ê°€ í•„ìš”), ì£½ì€ ì½”ë“œ ì œê±° (ì •ì˜ ì´í›„ ë³€ìˆ˜ê°€ í™œì„±ì´ ì•„ë‹ˆë©´ ì •ì˜ëŠ” ì£½ì€ ì½”ë“œ).</p>
<h4 id="_5">ë°ì´í„° íë¦„ ë°©ì •ì‹<a class="header-link" href="#_5" title="Permanent link">&para;</a></h4>
<p>$$\text{In}(B) = \text{Use}(B) \cup (\text{Out}(B) - \text{Def}(B))$$</p>
<p>$$\text{Out}(B) = \bigcup_{S \in \text{succ}(B)} \text{In}(S)$$</p>
<p>ì—¬ê¸°ì„œ:
- $\text{Use}(B)$ = $B$ì—ì„œ ì •ì˜ë˜ê¸° ì „ì— ì‚¬ìš©ë˜ëŠ” ë³€ìˆ˜
- $\text{Def}(B)$ = $B$ì—ì„œ ì •ì˜ë˜ëŠ” ë³€ìˆ˜</p>
<p><strong>ë°©í–¥</strong>: ì—­ë°©í–¥ (ì •ë³´ê°€ í›„ì† ë¸”ë¡ì—ì„œ ì„ í–‰ ë¸”ë¡ìœ¼ë¡œ íë¦„)</p>
<p><strong>í•©ë¥˜ ì—°ì‚°ì</strong>: í•©ì§‘í•©($\cup$) -- ë³€ìˆ˜ê°€ <em>ì„ì˜ì˜</em> ì•ìœ¼ë¡œì˜ ê²½ë¡œì—ì„œ í•„ìš”í•˜ë©´ í™œì„±</p>
<p><strong>ì´ˆê¸°í™”</strong>: ëª¨ë“  ë¸”ë¡ì— ëŒ€í•´ $\text{In}(B) = \emptyset$; $\text{Out}(\text{exit}) = \emptyset$ (ë˜ëŠ” í•¨ìˆ˜ê°€ ë°˜í™˜ëœ í›„ í•„ìš”í•œ ë³€ìˆ˜ ì§‘í•©)</p>
<h3 id="36-very-busy-expressions">3.6 ë§¤ìš° ë°”ìœ í‘œí˜„ì‹(Very Busy Expressions)<a class="header-link" href="#36-very-busy-expressions" title="Permanent link">&para;</a></h3>
<p>í‘œí˜„ì‹ $e$ê°€ ì§€ì  $p$ì—ì„œ <strong>ë§¤ìš° ë°”ìœ(very busy)</strong> ê²½ìš°:
- $p$ì—ì„œ ì¶œêµ¬ê¹Œì§€ì˜ <strong>ëª¨ë“ </strong> ê²½ë¡œì—ì„œ, í”¼ì—°ì‚°ìê°€ ì¬ì •ì˜ë˜ê¸° ì „ì— $e$ê°€ í‰ê°€ë˜ëŠ” ê²½ìš°</p>
<p><strong>ì‚¬ìš©ì²˜</strong>: ì½”ë“œ ëŒì–´ì˜¬ë¦¬ê¸°(code hoisting) -- $e$ê°€ $p$ì—ì„œ ë§¤ìš° ë°”ì˜ë‹¤ë©´, $e$ì˜ ê³„ì‚°ì„ $p$ë¡œ (ë” ì´ë¥´ê²Œ) ì•ˆì „í•˜ê²Œ ì´ë™í•  ìˆ˜ ìˆì–´ ì½”ë“œ í¬ê¸°ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h4 id="_6">ë°ì´í„° íë¦„ ë°©ì •ì‹<a class="header-link" href="#_6" title="Permanent link">&para;</a></h4>
<p>$$\text{In}(B) = \text{Gen}(B) \cup (\text{Out}(B) - \text{Kill}(B))$$</p>
<p>$$\text{Out}(B) = \bigcap_{S \in \text{succ}(B)} \text{In}(S)$$</p>
<p><strong>ë°©í–¥</strong>: ì—­ë°©í–¥</p>
<p><strong>í•©ë¥˜ ì—°ì‚°ì</strong>: êµì§‘í•©($\cap$) -- í‘œí˜„ì‹ì€ <em>ëª¨ë“ </em> ê²½ë¡œì—ì„œ í‰ê°€ë  ë•Œë§Œ ë§¤ìš° ë°”ì¨</p>
<h3 id="37">3.7 ë„¤ ê°€ì§€ ë¶„ì„ ìš”ì•½<a class="header-link" href="#37" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th></th>
<th>ë„ë‹¬ ì •ì˜</th>
<th>ê°€ìš© í‘œí˜„ì‹</th>
<th>í™œì„± ë³€ìˆ˜</th>
<th>ë§¤ìš° ë°”ìœ í‘œí˜„ì‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ë„ë©”ì¸</strong></td>
<td>ì •ì˜ ì§‘í•©</td>
<td>í‘œí˜„ì‹ ì§‘í•©</td>
<td>ë³€ìˆ˜ ì§‘í•©</td>
<td>í‘œí˜„ì‹ ì§‘í•©</td>
</tr>
<tr>
<td><strong>ë°©í–¥</strong></td>
<td>ìˆœë°©í–¥</td>
<td>ìˆœë°©í–¥</td>
<td>ì—­ë°©í–¥</td>
<td>ì—­ë°©í–¥</td>
</tr>
<tr>
<td><strong>í•©ë¥˜</strong></td>
<td>$\cup$ (may)</td>
<td>$\cap$ (must)</td>
<td>$\cup$ (may)</td>
<td>$\cap$ (must)</td>
</tr>
<tr>
<td><strong>ì „ë‹¬ í•¨ìˆ˜</strong></td>
<td>$\text{Gen} \cup (\text{In} - \text{Kill})$</td>
<td>$\text{Gen} \cup (\text{In} - \text{Kill})$</td>
<td>$\text{Use} \cup (\text{Out} - \text{Def})$</td>
<td>$\text{Gen} \cup (\text{Out} - \text{Kill})$</td>
</tr>
<tr>
<td><strong>ì´ˆê¸°ê°’ (ê²½ê³„)</strong></td>
<td>$\text{Out}(\text{entry}) = \emptyset$</td>
<td>$\text{Out}(\text{entry}) = \emptyset$</td>
<td>$\text{In}(\text{exit}) = \emptyset$</td>
<td>$\text{In}(\text{exit}) = \emptyset$</td>
</tr>
<tr>
<td><strong>ì´ˆê¸°ê°’ (ê¸°íƒ€)</strong></td>
<td>$\emptyset$</td>
<td>$U$ (ëª¨ë“  í‘œí˜„ì‹)</td>
<td>$\emptyset$</td>
<td>$U$ (ëª¨ë“  í‘œí˜„ì‹)</td>
</tr>
<tr>
<td><strong>ì‚¬ìš©</strong></td>
<td>ìƒìˆ˜ ì „íŒŒ</td>
<td>ì „ì—­ CSE</td>
<td>ë ˆì§€ìŠ¤í„° í• ë‹¹, DCE</td>
<td>ì½”ë“œ ëŒì–´ì˜¬ë¦¬ê¸°</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4">4. ë°ì´í„° íë¦„ ë¶„ì„ í”„ë ˆì„ì›Œí¬<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 ê²©ì ì´ë¡  ê¸°ì´ˆ<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<p>ë°ì´í„° íë¦„ ë¶„ì„ì€ <strong>ê²©ì ì´ë¡ (lattice theory)</strong>ì— ê¸°ë°˜í•œ ìˆ˜í•™ì  í”„ë ˆì„ì›Œí¬ë¡œ í†µí•©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><strong>ì •ì˜</strong>: <strong>ê²©ì(lattice)</strong> $(L, \sqsubseteq)$ëŠ” ëª¨ë“  ì›ì†Œ ìŒì´ <strong>ë§Œë‚¨(meet)</strong> ($\sqcap$, ìµœëŒ€ í•˜í•œ) ê³¼ <strong>ê²°í•©(join)</strong> ($\sqcup$, ìµœì†Œ ìƒí•œ)ì„ ê°€ì§€ëŠ” ë¶€ë¶„ ìˆœì„œ ì§‘í•©ì…ë‹ˆë‹¤.</p>
<p>ë°ì´í„° íë¦„ ë¶„ì„ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ëª¨ë“  ë¶€ë¶„ì§‘í•©ì´ ë§Œë‚¨ê³¼ ê²°í•©ì„ ê°€ì§€ëŠ” <strong>ì™„ì „ ê²©ì(complete lattice)</strong>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì£¼ìš” ì›ì†Œ:</p>
<ul>
<li>$\top$ (top): ìµœëŒ€ ì›ì†Œ -- "ì•„ì§ ì •ë³´ ì—†ìŒ" ë˜ëŠ” "ëª¨ë“  ê°€ëŠ¥ì„±"ì„ ë‚˜íƒ€ëƒ„</li>
<li>$\bot$ (bottom): ìµœì†Œ ì›ì†Œ -- "ë„ë‹¬ ë¶ˆê°€" ë˜ëŠ” "ëª¨ìˆœ"ì„ ë‚˜íƒ€ëƒ„</li>
</ul>
<h4 id="_7">ë„ë‹¬ ì •ì˜ë¥¼ ìœ„í•œ ê²©ì<a class="header-link" href="#_7" title="Permanent link">&para;</a></h4>
<p>ê²©ìëŠ” ëª¨ë“  ì •ì˜ì˜ <strong>ë©±ì§‘í•©(powerset)</strong>ìœ¼ë¡œ, ë¶€ë¶„ì§‘í•© í¬í•¨ ê´€ê³„ë¡œ ìˆœì„œí™”ë©ë‹ˆë‹¤:</p>
<p>$$L = 2^{\text{Defs}}, \quad A \sqsubseteq B \iff A \subseteq B$$</p>
<ul>
<li>$\top = \text{Defs}$ (ëª¨ë“  ì •ì˜ -- ì „ì²´ ì§‘í•©)</li>
<li>$\bot = \emptyset$ (ì •ì˜ ì—†ìŒ)</li>
<li>ë§Œë‚¨($\sqcap$) = í•©ì§‘í•©($\cup$): may ë¶„ì„ ì‚¬ìš© (ì„ì˜ì˜ ê²½ë¡œ)</li>
</ul>
<p>ì ê¹ -- í‘œì¤€ ê³µì‹í™”ì—ì„œ ê·œì•½ì€ ê²©ì ë°©í–¥ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
<p><strong>may ë¶„ì„</strong> (ë„ë‹¬ ì •ì˜ ë“±)ì—ì„œ ê²©ìëŠ” $\bot = \emptyset$ (ì •ë³´ ì—†ìŒ)ì—ì„œ ìœ„ë¡œ ì˜¬ë¼ê°€ê³ , ë§Œë‚¨ì€ $\cup$ (í•©ì§‘í•©)ì…ë‹ˆë‹¤. ê°€ì¥ ë‚™ê´€ì ì¸ ê°’($\bot = \emptyset$: "ì—¬ê¸°ì— ì•„ë¬´ê²ƒë„ ë„ë‹¬í•˜ì§€ ì•ŠìŒ")ì—ì„œ ì‹œì‘í•˜ì—¬ ê³ ì •ì ì— ë„ë‹¬í•  ë•Œê¹Œì§€ ì •ë³´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
<p><strong>must ë¶„ì„</strong> (ê°€ìš© í‘œí˜„ì‹ ë“±)ì—ì„œ ê²©ìëŠ” $\top = U$ (ëª¨ë“  í‘œí˜„ì‹ì´ ê°€ìš©)ì—ì„œ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ê³ , ë§Œë‚¨ì€ $\cap$ (êµì§‘í•©)ì…ë‹ˆë‹¤. ê°€ì¥ ë‚™ê´€ì ì¸ ê°’($\top = U$: "ëª¨ë“  ê²ƒì´ ê°€ìš©í•¨")ì—ì„œ ì‹œì‘í•˜ì—¬ ê³ ì •ì ì— ë„ë‹¬í•  ë•Œê¹Œì§€ ì •ë³´ë¥¼ ì œê±°í•©ë‹ˆë‹¤.</p>
<h4 id="_8">ì¼ë°˜ í”„ë ˆì„ì›Œí¬<a class="header-link" href="#_8" title="Permanent link">&para;</a></h4>
<p>ë°ì´í„° íë¦„ ë¶„ì„ì€ ë‹¤ìŒìœ¼ë¡œ ì •ì˜ë©ë‹ˆë‹¤:</p>
<ol>
<li>ë§Œë‚¨ $\sqcap$ì„ ê°€ì§„ <strong>ê²©ì</strong> $(L, \sqsubseteq)$</li>
<li>ê° ë¸”ë¡ $B$ì— ëŒ€í•œ <strong>ì „ë‹¬ í•¨ìˆ˜(transfer function)</strong> $f_B : L \to L$</li>
<li><strong>ë°©í–¥</strong> (ìˆœë°©í–¥ ë˜ëŠ” ì—­ë°©í–¥)</li>
<li><strong>ê²½ê³„ ì¡°ê±´</strong> (ì§„ì…/ì¶œêµ¬ ë¸”ë¡ì˜ ì´ˆê¸°ê°’)</li>
<li>ë‹¤ë¥¸ ëª¨ë“  ë¸”ë¡ì˜ <strong>ì´ˆê¸°ê°’</strong></li>
</ol>
<p>í•´ëŠ” ë°©ì •ì‹ ì‹œìŠ¤í…œì˜ <strong>ìµœëŒ€ ê³ ì •ì (greatest fixed point)</strong>ì…ë‹ˆë‹¤.</p>
<h3 id="42">4.2 ì „ë‹¬ í•¨ìˆ˜<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<p>ì „ë‹¬ í•¨ìˆ˜ $f_B$ëŠ” ë¸”ë¡ $B$ë¥¼ í†µê³¼í•  ë•Œ ì •ë³´ê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ë°ì´í„° íë¦„ ë¶„ì„ì€ ë‹¤ìŒ í˜•ì‹ì˜ ì „ë‹¬ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<p>$$f_B(X) = \text{Gen}(B) \cup (X - \text{Kill}(B))$$</p>
<p>ì´ê²ƒì€ <strong>ë‹¨ì¡°(monotone)</strong> í•¨ìˆ˜ì…ë‹ˆë‹¤: $X \sqsubseteq Y$ì´ë©´ $f_B(X) \sqsubseteq f_B(Y)$.</p>
<p><strong>ë‹¨ì¡°ì„±ì€ í•„ìˆ˜ì ì…ë‹ˆë‹¤</strong>: ë°˜ë³µ ì•Œê³ ë¦¬ì¦˜ì˜ ìˆ˜ë ´ì„ ë³´ì¥í•©ë‹ˆë‹¤.</p>
<h3 id="43-meet-over-paths-mop">4.3 ê²½ë¡œ ìœ„ì˜ ë§Œë‚¨(Meet-Over-Paths, MOP) í•´<a class="header-link" href="#43-meet-over-paths-mop" title="Permanent link">&para;</a></h3>
<p><strong>ì´ìƒì ì¸</strong> í•´ëŠ” <strong>ëª¨ë“  ê²½ë¡œ ìœ„ì˜ ë§Œë‚¨(Meet-Over-All-Paths, MOP)</strong> í•´ì…ë‹ˆë‹¤. ìˆœë°©í–¥ ë¶„ì„ì—ì„œ ë¸”ë¡ $B$ì˜ ì§„ì…ì ì˜ MOP í•´ëŠ”:</p>
<p>$$\text{MOP}(B) = \bigsqcap_{\text{path } p : \text{entry} \to B} f_p(\text{boundary\_value})$$</p>
<p>ì—¬ê¸°ì„œ $f_p$ëŠ” ê²½ë¡œ $p$ë¥¼ ë”°ë¥¸ ì „ë‹¬ í•¨ìˆ˜ì˜ í•©ì„±ì…ë‹ˆë‹¤.</p>
<p>MOPë¥¼ ì§ì ‘ ê³„ì‚°í•˜ëŠ” ê²ƒì€ ì¼ë°˜ì ìœ¼ë¡œ ê²°ì • ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤ (ë£¨í”„ ë•Œë¬¸ì— ë¬´í•œíˆ ë§ì€ ê²½ë¡œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤). ëŒ€ì‹  <strong>ìµœëŒ€ ê³ ì •ì (Maximum Fixed Point, MFP)</strong>ì„ ê³„ì‚°í•˜ëŠ”ë°, ì´ëŠ” MOPë³´ë‹¤ ë³´ìˆ˜ì ì„ì´ ë³´ì¥ë©ë‹ˆë‹¤ (ì¦‰, ì ì ˆí•œ ìˆœì„œì—ì„œ $\text{MFP} \sqsubseteq \text{MOP}$).</p>
<p>$f(X) = \text{Gen} \cup (X - \text{Kill})$ í˜•ì‹ì˜ ì „ë‹¬ í•¨ìˆ˜ (<strong>ë¶„ë°°ì (distributive)</strong>)ì˜ ê²½ìš°, MFP = MOPê°€ ì •í™•íˆ ì„±ë¦½í•©ë‹ˆë‹¤.</p>
<h3 id="44">4.4 ê³ ì •ì  ë°˜ë³µ<a class="header-link" href="#44" title="Permanent link">&para;</a></h3>
<p><strong>ì •ë¦¬ (íƒ€ë¥´ìŠ¤í‚¤, Tarski)</strong>: $f$ê°€ ì™„ì „ ê²©ì ìœ„ì˜ ë‹¨ì¡° í•¨ìˆ˜ì´ë©´, $f$ëŠ” ìµœì†Œ ê³ ì •ì ì„ ê°€ì§€ë©°, ì´ëŠ” $\bot$ì—ì„œ ë°˜ë³µí•˜ì—¬ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<p>$$\bot, f(\bot), f^2(\bot), \ldots$$</p>
<p>ë°ì´í„° íë¦„ ë¶„ì„ì—ì„œëŠ” ì–´ë–¤ ê°’ë„ ë³€í•˜ì§€ ì•Šì„ ë•Œê¹Œì§€ ëª¨ë“  ë¸”ë¡ì— ëŒ€í•´ ë™ì‹œì— ë°˜ë³µí•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">Algorithm</span><span class="o">:</span><span class="w"> </span><span class="n">Iterative</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="n">Analysis</span><span class="w"> </span><span class="o">(</span><span class="n">Forward</span><span class="o">)</span>

<span class="n">Initialize</span><span class="o">:</span>
<span class="w">    </span><span class="n">Out</span><span class="o">(</span><span class="n">entry</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boundary_value</span>
<span class="w">    </span><span class="n">Out</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initial_value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="err">â‰ </span><span class="w"> </span><span class="n">entry</span>

<span class="n">Repeat</span><span class="o">:</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">(</span><span class="k">in</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">order</span><span class="o">):</span>
<span class="w">        </span><span class="n">In</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Meet</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">predecessors</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Out</span><span class="o">(</span><span class="n">P</span><span class="o">)</span>
<span class="w">        </span><span class="n">Out</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f_B</span><span class="o">(</span><span class="n">In</span><span class="o">(</span><span class="n">B</span><span class="o">))</span>
<span class="n">until</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">Out</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="n">changed</span>
</code></pre></div>

<p><strong>ìˆ˜ë ´</strong>: ë‹¤ìŒìœ¼ë¡œ ë³´ì¥ë©ë‹ˆë‹¤:
1. ê²©ìì˜ ë†’ì´ê°€ ìœ í•œí•©ë‹ˆë‹¤ (ì •ì˜/í‘œí˜„ì‹ì˜ ìœ í•œí•œ ìˆ˜)
2. ì „ë‹¬ í•¨ìˆ˜ê°€ ë‹¨ì¡°ì…ë‹ˆë‹¤
3. ê° ë°˜ë³µì—ì„œ ê°’ì´ í•œ ë°©í–¥ìœ¼ë¡œ (ê²©ìì—ì„œ ìœ„ ë˜ëŠ” ì•„ë˜ë¡œ) ì´ë™í•©ë‹ˆë‹¤</p>
<p><strong>ìµœì•…ì˜ ê²½ìš° ë°˜ë³µ íšŸìˆ˜</strong>: ìµœëŒ€ $h \times |V|$ (ì—¬ê¸°ì„œ $h$ëŠ” ê²©ì ë†’ì´, $|V|$ëŠ” CFG ë…¸ë“œ ìˆ˜). ì‹¤ì œë¡œëŠ” ë³´í†µ 2--3ë²ˆì˜ ë°˜ë³µìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.</p>
<h3 id="45">4.5 ì›Œí¬ë¦¬ìŠ¤íŠ¸ ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#45" title="Permanent link">&para;</a></h3>
<p>ë‹¨ìˆœí•œ ë°˜ë³µ ì•Œê³ ë¦¬ì¦˜ì€ ëŒ€ë¶€ë¶„ì´ ë³€í•˜ì§€ ì•Šì•˜ì–´ë„ ëª¨ë“  ë¸”ë¡ì„ ë°˜ë³µì ìœ¼ë¡œ ìŠ¤ìº”í•©ë‹ˆë‹¤. <strong>ì›Œí¬ë¦¬ìŠ¤íŠ¸ ì•Œê³ ë¦¬ì¦˜(worklist algorithm)</strong>ì€ ì…ë ¥ì´ ë³€í•œ ë¸”ë¡ë§Œ ì²˜ë¦¬í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">Algorithm</span><span class="o">:</span><span class="w"> </span><span class="n">Worklist</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">Flow</span><span class="w"> </span><span class="n">Analysis</span><span class="w"> </span><span class="o">(</span><span class="n">Forward</span><span class="o">)</span>

<span class="n">Initialize</span><span class="o">:</span>
<span class="w">    </span><span class="n">Out</span><span class="o">(</span><span class="n">entry</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boundary_value</span>
<span class="w">    </span><span class="n">Out</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initial_value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="err">â‰ </span><span class="w"> </span><span class="n">entry</span>
<span class="w">    </span><span class="n">worklist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">blocks</span><span class="w"> </span><span class="n">except</span><span class="w"> </span><span class="n">entry</span>

<span class="n">While</span><span class="w"> </span><span class="n">worklist</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">empty</span><span class="o">:</span>
<span class="w">    </span><span class="n">Remove</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">worklist</span>
<span class="w">    </span><span class="n">In</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Meet</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">predecessors</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Out</span><span class="o">(</span><span class="n">P</span><span class="o">)</span>
<span class="w">    </span><span class="n">new_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f_B</span><span class="o">(</span><span class="n">In</span><span class="o">(</span><span class="n">B</span><span class="o">))</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">new_out</span><span class="w"> </span><span class="err">â‰ </span><span class="w"> </span><span class="n">Out</span><span class="o">(</span><span class="n">B</span><span class="o">):</span>
<span class="w">        </span><span class="n">Out</span><span class="o">(</span><span class="n">B</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_out</span>
<span class="w">        </span><span class="n">Add</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">successors</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">worklist</span>
</code></pre></div>

<p><strong>íš¨ìœ¨ì„±</strong>: ì›Œí¬ë¦¬ìŠ¤íŠ¸ ì•Œê³ ë¦¬ì¦˜ì€ ì¤‘ë³µ ì‘ì—…ì„ í”¼í•©ë‹ˆë‹¤. ìˆœë°©í–¥ ë¶„ì„ì— ì—­í›„ìœ„ ìˆœì„œ(reverse postorder)ë¥¼ (ë˜ëŠ” ì—­ë°©í–¥ ë¶„ì„ì— í›„ìœ„ ìˆœì„œë¥¼) ì´ˆê¸° ì›Œí¬ë¦¬ìŠ¤íŠ¸ ìˆœì„œë¡œ ì‚¬ìš©í•˜ë©´ ìˆ˜ë ´ì´ í–¥ìƒë©ë‹ˆë‹¤.</p>
<hr />
<h2 id="5-python">5. Python êµ¬í˜„: ë°ì´í„° íë¦„ ë¶„ì„<a class="header-link" href="#5-python" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generic Data Flow Analysis Framework.</span>

<span class="sd">Implements the worklist algorithm for forward and backward analyses.</span>
<span class="sd">Includes implementations of all four classic analyses.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">deque</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>


<span class="c1"># ============================================================</span>
<span class="c1"># CFG Data Structures</span>
<span class="c1"># ============================================================</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Instruction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A three-address code instruction.&quot;&quot;&quot;</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">arg1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">arg2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">defined_var</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Variable defined by this instruction.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;goto&quot;</span><span class="p">,</span> <span class="s2">&quot;iffalse&quot;</span><span class="p">,</span>
                                                        <span class="s2">&quot;iftrue&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
                                                        <span class="s2">&quot;return&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">used_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Variables used by this instruction.&quot;&quot;&quot;</span>
        <span class="n">used</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span> \
               <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                <span class="n">used</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">used</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">:&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;copy&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;goto&quot;</span><span class="p">,</span> <span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="s2">&quot;iftrue&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;return&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;return </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BasicBlock</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A basic block in the CFG.&quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">successors</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">predecessors</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;B</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CFG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Control flow graph.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">BasicBlock</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">to_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">to_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">from_id</span><span class="p">]</span><span class="o">.</span><span class="n">successors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">from_id</span><span class="p">]</span><span class="o">.</span><span class="n">successors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">from_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">to_id</span><span class="p">]</span><span class="o">.</span><span class="n">predecessors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">to_id</span><span class="p">]</span><span class="o">.</span><span class="n">predecessors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">from_id</span><span class="p">)</span>


<span class="c1"># ============================================================</span>
<span class="c1"># Data Flow Analysis Framework</span>
<span class="c1"># ============================================================</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Direction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">FORWARD</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">BACKWARD</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MeetOp</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">UNION</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>        <span class="c1"># May analysis</span>
    <span class="n">INTERSECTION</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Must analysis</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DataFlowAnalysis</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for data flow analyses.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">CFG</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">,</span> <span class="n">meet_op</span><span class="p">:</span> <span class="n">MeetOp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meet_op</span> <span class="o">=</span> <span class="n">meet_op</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">set</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">set</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the Gen set for a block.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the Kill set for a block.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the universal set for must-analyses.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">boundary_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the boundary value (for entry/exit block).&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">meet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">set</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the meet operator to a list of sets.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sets</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meet_op</span> <span class="o">==</span> <span class="n">MeetOp</span><span class="o">.</span><span class="n">UNION</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meet_op</span> <span class="o">==</span> <span class="n">MeetOp</span><span class="o">.</span><span class="n">UNION</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">|</span> <span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">&amp;</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">,</span> <span class="n">input_set</span><span class="p">:</span> <span class="nb">set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the transfer function: Gen âˆª (input - Kill).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">input_set</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initial_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initial value for non-boundary blocks.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meet_op</span> <span class="o">==</span> <span class="n">MeetOp</span><span class="o">.</span><span class="n">UNION</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>       <span class="c1"># Most optimistic for may-analyses</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="p">()</span>  <span class="c1"># Most optimistic for must-analyses</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solve the data flow equations using the worklist algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">block_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">Direction</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solve_forward</span><span class="p">(</span><span class="n">block_ids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solve_backward</span><span class="p">(</span><span class="n">block_ids</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_solve_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Forward worklist algorithm.&quot;&quot;&quot;</span>
        <span class="n">entry_id</span> <span class="o">=</span> <span class="n">block_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Initialize</span>
        <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">block_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bid</span> <span class="o">==</span> <span class="n">entry_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_value</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_value</span><span class="p">()</span>

        <span class="c1"># Worklist (use reverse postorder for efficiency)</span>
        <span class="n">worklist</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">block_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>  <span class="c1"># Exclude entry initially</span>
        <span class="n">in_worklist</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">worklist</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
            <span class="n">bid</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">in_worklist</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span>
            <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span>

            <span class="c1"># Compute In</span>
            <span class="n">pred_outs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">predecessors</span><span class="p">]</span>
            <span class="n">new_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meet</span><span class="p">(</span><span class="n">pred_outs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_in</span>

            <span class="c1"># Compute Out via transfer function</span>
            <span class="n">new_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">new_in</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_out</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_out</span>
                <span class="k">for</span> <span class="n">succ</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">successors</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">succ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">in_worklist</span><span class="p">:</span>
                        <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">succ</span><span class="p">)</span>
                        <span class="n">in_worklist</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">succ</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_solve_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Backward worklist algorithm.&quot;&quot;&quot;</span>
        <span class="c1"># Find exit blocks (no successors)</span>
        <span class="n">exit_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">bid</span> <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">block_ids</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span><span class="o">.</span><span class="n">successors</span><span class="p">]</span>

        <span class="c1"># Initialize</span>
        <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">block_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">exit_ids</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_value</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_value</span><span class="p">()</span>

        <span class="c1"># Worklist</span>
        <span class="n">worklist</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">bid</span> <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">block_ids</span> <span class="k">if</span> <span class="n">bid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exit_ids</span><span class="p">)</span>
        <span class="n">in_worklist</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">worklist</span><span class="p">)</span>

        <span class="c1"># Also add exit blocks to process their predecessors</span>
        <span class="k">for</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">exit_ids</span><span class="p">:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">[</span><span class="n">eid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">eid</span><span class="p">])</span>

        <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
            <span class="n">bid</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">in_worklist</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span>
            <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span>

            <span class="c1"># Compute Out from successors</span>
            <span class="n">succ_ins</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">successors</span><span class="p">]</span>
            <span class="n">new_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meet</span><span class="p">(</span><span class="n">succ_ins</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_out</span>

            <span class="c1"># Compute In via transfer function</span>
            <span class="n">new_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">new_out</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_in</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_in</span>
                <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">predecessors</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pred</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">in_worklist</span><span class="p">:</span>
                        <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
                        <span class="n">in_worklist</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty-print the analysis results.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== </span><span class="si">{</span><span class="n">analysis_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">in_s</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_sets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="nb">set</span><span class="p">()))</span>
            <span class="n">out_s</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_sets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="nb">set</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  B</span><span class="si">{</span><span class="n">bid</span><span class="si">}</span><span class="s2">: In = </span><span class="se">{{</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">in_s</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;       Out = </span><span class="se">{{</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">out_s</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># ============================================================</span>
<span class="c1"># Concrete Analyses</span>
<span class="c1"># ============================================================</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReachingDefinitions</span><span class="p">(</span><span class="n">DataFlowAnalysis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reaching Definitions analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">CFG</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">Direction</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">,</span> <span class="n">MeetOp</span><span class="o">.</span><span class="n">UNION</span><span class="p">)</span>
        <span class="c1"># Pre-compute all definitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_defs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>  <span class="c1"># var -&gt; {def labels}</span>
        <span class="k">for</span> <span class="n">bid</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
                <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
                <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                    <span class="n">def_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;d</span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">dvar</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_defs</span><span class="p">[</span><span class="n">dvar</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">def_label</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="n">gen_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">killed_in_block</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Track vars defined in this block</span>
        <span class="c1"># Process in order; last def of each var survives</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
            <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="c1"># Kill previous defs of this var in this block</span>
                <span class="n">gen_set</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">gen_set</span>
                           <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">dvar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)}</span>
                <span class="n">gen_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;d</span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">dvar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gen_set</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="n">kill_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
            <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="c1"># Kill all other defs of this var</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_defs</span><span class="p">[</span><span class="n">dvar</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;d</span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">):</span>
                        <span class="n">kill_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kill_set</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">all_defs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_defs</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">boundary_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LiveVariables</span><span class="p">(</span><span class="n">DataFlowAnalysis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Live Variables analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">CFG</span><span class="p">,</span> <span class="n">exit_live</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">Direction</span><span class="o">.</span><span class="n">BACKWARD</span><span class="p">,</span> <span class="n">MeetOp</span><span class="o">.</span><span class="n">UNION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_live</span> <span class="o">=</span> <span class="n">exit_live</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use set: variables used before being defined in this block.&quot;&quot;&quot;</span>
        <span class="n">use_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">defined</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="c1"># Uses that haven&#39;t been defined yet in this block</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">instr</span><span class="o">.</span><span class="n">used_vars</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defined</span><span class="p">:</span>
                    <span class="n">use_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="c1"># Definition</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
            <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="n">defined</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">use_set</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Def set: variables defined in this block.&quot;&quot;&quot;</span>
        <span class="n">def_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
            <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="n">def_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">def_set</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="n">all_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
                <span class="n">all_vars</span> <span class="o">|=</span> <span class="n">instr</span><span class="o">.</span><span class="n">used_vars</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span><span class="p">:</span>
                    <span class="n">all_vars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_vars</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">boundary_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_live</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AvailableExpressions</span><span class="p">(</span><span class="n">DataFlowAnalysis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Available Expressions analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">CFG</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">Direction</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">,</span> <span class="n">MeetOp</span><span class="o">.</span><span class="n">INTERSECTION</span><span class="p">)</span>
        <span class="c1"># Collect all expressions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_exprs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_exprs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="n">gen_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">killed_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Variables defined so far</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="c1"># Add expression if operands haven&#39;t been killed</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">killed_vars</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">killed_vars</span><span class="p">:</span>
                    <span class="n">gen_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
            <span class="c1"># Kill expressions involving the defined variable</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
            <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="n">gen_set</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">gen_set</span>
                           <span class="k">if</span> <span class="n">dvar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">()}</span>
                <span class="n">killed_vars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gen_set</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="n">kill_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
            <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_exprs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dvar</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                        <span class="n">kill_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kill_set</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_exprs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">boundary_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">VeryBusyExpressions</span><span class="p">(</span><span class="n">DataFlowAnalysis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Very Busy Expressions analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">CFG</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">Direction</span><span class="o">.</span><span class="n">BACKWARD</span><span class="p">,</span> <span class="n">MeetOp</span><span class="o">.</span><span class="n">INTERSECTION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_exprs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_exprs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Expressions computed in this block before any operand is redefined.&quot;&quot;&quot;</span>
        <span class="n">gen_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">killed_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="c1"># Check if this computes an expression with unkilled operands</span>
            <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="p">:</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">arg1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">arg2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">killed_vars</span> <span class="ow">and</span> <span class="n">instr</span><span class="o">.</span><span class="n">arg2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">killed_vars</span><span class="p">:</span>
                    <span class="n">gen_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
            <span class="c1"># Track defined variables</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
            <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="n">killed_vars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gen_set</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="n">BasicBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="n">kill_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="n">dvar</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">defined_var</span>
            <span class="k">if</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_exprs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dvar</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                        <span class="n">kill_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kill_set</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_exprs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">boundary_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>


<span class="c1"># ============================================================</span>
<span class="c1"># Example</span>
<span class="c1"># ============================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_example_cfg</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CFG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build example CFG:</span>

<span class="sd">    B0: d0: x = 5</span>
<span class="sd">        d1: y = 1</span>

<span class="sd">    B1: d2: z = x + y</span>
<span class="sd">        if z &lt; 10 goto B2</span>

<span class="sd">    B2: d3: x = x + 1</span>
<span class="sd">        d4: y = y * 2</span>
<span class="sd">        goto B1</span>

<span class="sd">    B3: d5: w = x + y</span>
<span class="sd">        return w</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">CFG</span><span class="p">()</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="n">BasicBlock</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Instruction</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">),</span>
        <span class="n">Instruction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="n">b1</span> <span class="o">=</span> <span class="n">BasicBlock</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Instruction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span>
        <span class="n">Instruction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;iffalse&quot;</span><span class="p">,</span> <span class="s2">&quot;z &lt; 10&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s2">&quot;B3&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="n">b2</span> <span class="o">=</span> <span class="n">BasicBlock</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Instruction</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">),</span>
        <span class="n">Instruction</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="n">b3</span> <span class="o">=</span> <span class="n">BasicBlock</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Instruction</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">),</span>
        <span class="n">Instruction</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;return&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">),</span>
    <span class="p">])</span>

    <span class="n">cfg</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="n">b0</span><span class="p">)</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">add_block</span><span class="p">(</span><span class="n">b3</span><span class="p">)</span>

    <span class="n">cfg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># z &lt; 10</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># z &gt;= 10</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># loop back</span>

    <span class="k">return</span> <span class="n">cfg</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demo_all_analyses</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run all four data flow analyses on the example CFG.&quot;&quot;&quot;</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">build_example_cfg</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Control Flow Graph ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">B</span><span class="si">{</span><span class="n">bid</span><span class="si">}</span><span class="s2">: (pred=</span><span class="si">{</span><span class="n">block</span><span class="o">.</span><span class="n">predecessors</span><span class="si">}</span><span class="s2">, succ=</span><span class="si">{</span><span class="n">block</span><span class="o">.</span><span class="n">successors</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  d</span><span class="si">{</span><span class="n">instr</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 1. Reaching Definitions</span>
    <span class="n">rd</span> <span class="o">=</span> <span class="n">ReachingDefinitions</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
    <span class="n">rd</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
    <span class="n">rd</span><span class="o">.</span><span class="n">print_results</span><span class="p">(</span><span class="s2">&quot;Reaching Definitions&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Live Variables</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="n">LiveVariables</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">exit_live</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;w&quot;</span><span class="p">})</span>
    <span class="n">lv</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
    <span class="n">lv</span><span class="o">.</span><span class="n">print_results</span><span class="p">(</span><span class="s2">&quot;Live Variables&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Available Expressions</span>
    <span class="n">ae</span> <span class="o">=</span> <span class="n">AvailableExpressions</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
    <span class="n">ae</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
    <span class="n">ae</span><span class="o">.</span><span class="n">print_results</span><span class="p">(</span><span class="s2">&quot;Available Expressions&quot;</span><span class="p">)</span>

    <span class="c1"># 4. Very Busy Expressions</span>
    <span class="n">vb</span> <span class="o">=</span> <span class="n">VeryBusyExpressions</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
    <span class="n">vb</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
    <span class="n">vb</span><span class="o">.</span><span class="n">print_results</span><span class="p">(</span><span class="s2">&quot;Very Busy Expressions&quot;</span><span class="p">)</span>

    <span class="c1"># Print Gen/Kill sets for each analysis</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Gen/Kill Sets ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">B</span><span class="si">{</span><span class="n">bid</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  RD:  Gen=</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="si">}</span><span class="s2">, Kill=</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  LV:  Use=</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">lv</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="si">}</span><span class="s2">, Def=</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">lv</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  AE:  Gen=</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ae</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="si">}</span><span class="s2">, Kill=</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ae</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  VBE: Gen=</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">vb</span><span class="o">.</span><span class="n">gen</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="si">}</span><span class="s2">, Kill=</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">vb</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo_all_analyses</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="6">6. ë¶„ì„ ê²°ê³¼ë¥¼ ìµœì í™”ì— ì ìš©<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 ì „ì—­ ìƒìˆ˜ ì „íŒŒ<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<p><strong>ë„ë‹¬ ì •ì˜</strong>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì—­ ìƒìˆ˜ ì „íŒŒë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">For</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">p</span><span class="p">:</span>
<span class="w">    </span><span class="n">Let</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">reaching</span><span class="w"> </span><span class="n">definitions</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">p</span>
<span class="w">    </span><span class="n">If</span><span class="w"> </span><span class="o">|</span><span class="n">D</span><span class="o">|</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">definition</span><span class="w"> </span><span class="n">assigns</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">c</span><span class="p">:</span>
<span class="w">        </span><span class="n">Replace</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">p</span>
</code></pre></div>

<p><strong>ì˜ˆì‹œ</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w">         </span><span class="c1">// d1</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">     </span><span class="c1">// xì˜ ë„ë‹¬ ì •ì˜: {d1}</span>
<span class="w">                   </span><span class="c1">// d1ì€ ìƒìˆ˜ 5ë¥¼ í• ë‹¹</span>
<span class="w">                   </span><span class="c1">// â†’ y = 5 + 1 â†’ y = 6</span>
</code></pre></div>

<h3 id="62">6.2 ì „ì—­ ì£½ì€ ì½”ë“œ ì œê±°<a class="header-link" href="#62" title="Permanent link">&para;</a></h3>
<p><strong>í™œì„± ë³€ìˆ˜</strong>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì˜ ì´í›„ í™œì„± ìƒíƒœê°€ ì•„ë‹Œ ë³€ìˆ˜ì˜ ì •ì˜ë¥¼ ì œê±°í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">For</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">definition</span><span class="w"> </span><span class="nv">d</span>:<span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">expr</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">point</span><span class="w"> </span><span class="nv">p</span>:
<span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">NOT</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">LiveOut</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">point</span><span class="w"> </span><span class="nv">p</span>:
<span class="w">        </span><span class="nv">Remove</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="ss">(</span><span class="nv">it</span><span class="err">&#39;s dead code)</span>
</code></pre></div>

<h3 id="63">6.3 ì „ì—­ ê³µí†µ ë¶€ë¶„ì‹ ì œê±°<a class="header-link" href="#63" title="Permanent link">&para;</a></h3>
<p><strong>ê°€ìš© í‘œí˜„ì‹</strong>ì„ ì‚¬ìš©í•˜ì—¬ ì¤‘ë³µ ê³„ì‚°ì„ ì œê±°í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">For</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">computation</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">expression</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">point</span><span class="w"> </span><span class="nv">p</span>:
<span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">Available</span><span class="w"> </span><span class="nv">set</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">p</span>:
<span class="w">        </span><span class="nv">Replace</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">computation</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">reference</span><span class="w"> </span><span class="nv">to</span>
<span class="w">        </span><span class="nv">the</span><span class="w"> </span><span class="nv">previously</span><span class="w"> </span><span class="nv">computed</span><span class="w"> </span><span class="nv">value</span>

<span class="nv">Note</span>:<span class="w"> </span><span class="nv">We</span><span class="w"> </span><span class="nv">need</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">insert</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">temporary</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">original</span><span class="w"> </span><span class="nv">computation</span>
<span class="w">      </span><span class="nv">to</span><span class="w"> </span><span class="nv">store</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">later</span><span class="w"> </span><span class="nv">use</span>.
</code></pre></div>

<p><strong>ì´ì „</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">      </span><span class="c1">// a + b ê³„ì‚°</span>
<span class="w">    </span><span class="o">...</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="o">...</span><span class="w">              </span><span class="c1">// a ë˜ëŠ” bì˜ ì¬ì •ì˜ ì—†ìŒ</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">      </span><span class="c1">// a + bëŠ” ì—¬ê¸°ì„œ ê°€ìš© (B1ì—ì„œ)</span>
</code></pre></div>

<p><strong>ì´í›„</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">      </span><span class="c1">// a + bê°€ t1ì— ì €ì¥</span>
<span class="w">    </span><span class="o">...</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="w">         </span><span class="c1">// ì´ì „ì— ê³„ì‚°ëœ ê°’ ì¬ì‚¬ìš©</span>
</code></pre></div>

<h3 id="64-code-hoisting">6.4 ì½”ë“œ ëŒì–´ì˜¬ë¦¬ê¸°(Code Hoisting)<a class="header-link" href="#64-code-hoisting" title="Permanent link">&para;</a></h3>
<p><strong>ë§¤ìš° ë°”ìœ í‘œí˜„ì‹</strong>ì„ ì‚¬ìš©í•˜ì—¬ ê³„ì‚°ì„ ë” ì´ë¥¸ ì§€ì ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">If</span><span class="w"> </span><span class="nv">expression</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">very</span><span class="w"> </span><span class="nv">busy</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">entry</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">block</span><span class="w"> </span><span class="nv">B</span>:
<span class="w">    </span><span class="nv">Compute</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">entry</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="ss">(</span><span class="nv">or</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">B</span><span class="err">&#39;s predecessors)</span>
<span class="err">    Store the result in a temporary</span>
<span class="err">    Replace all subsequent computations of e with the temporary</span>
</code></pre></div>

<p><strong>ì´ì „</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">B1</span><span class="o">:</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">cond</span><span class="o">)</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B2</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B3</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">      </span><span class="c1">// ì´ ê²½ë¡œì—ì„œ a + b ê³„ì‚°</span>
<span class="w">    </span><span class="o">...</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">      </span><span class="c1">// ì´ ê²½ë¡œì—ì„œë„ a + b ê³„ì‚°</span>
<span class="w">    </span><span class="o">...</span>
</code></pre></div>

<p><code>a + b</code>ê°€ B1ì˜ ì¶œêµ¬ì—ì„œ ë§¤ìš° ë°”ì˜ë‹¤ë©´ (ëª¨ë“  ê²½ë¡œì—ì„œ í‰ê°€ë¨), ëŒì–´ì˜¬ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<p><strong>ì´í›„</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">      </span><span class="c1">// ëŒì–´ì˜¬ë¦¼</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">cond</span><span class="o">)</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B2</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B3</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t0</span><span class="w">         </span><span class="c1">// ì¬ì‚¬ìš©</span>
<span class="w">    </span><span class="o">...</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t0</span><span class="w">         </span><span class="c1">// ì¬ì‚¬ìš©</span>
<span class="w">    </span><span class="o">...</span>
</code></pre></div>

<hr />
<h2 id="7">7. ê³ ê¸‰ ì£¼ì œ<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 ë°˜ë³µ ë¶„ì„ ìˆœì„œ<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<p>ë¸”ë¡ì´ ì²˜ë¦¬ë˜ëŠ” ìˆœì„œëŠ” ë°˜ë³µ íšŸìˆ˜ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ë°©í–¥</th>
<th>ìµœì„ ì˜ ìˆœì„œ</th>
<th>ì´ìœ </th>
</tr>
</thead>
<tbody>
<tr>
<td>ìˆœë°©í–¥</td>
<td>ì—­í›„ìœ„ ìˆœì„œ</td>
<td>í›„ë°© ì—£ì§€ë¥¼ ì œì™¸í•œ í›„ì† ë¸”ë¡ë³´ë‹¤ ì„ í–‰ ë¸”ë¡ì´ ë¨¼ì € ì²˜ë¦¬ë¨</td>
</tr>
<tr>
<td>ì—­ë°©í–¥</td>
<td>í›„ìœ„ ìˆœì„œ</td>
<td>í›„ë°© ì—£ì§€ë¥¼ ì œì™¸í•œ ì„ í–‰ ë¸”ë¡ë³´ë‹¤ í›„ì† ë¸”ë¡ì´ ë¨¼ì € ì²˜ë¦¬ë¨</td>
</tr>
</tbody>
</table>
<p>ìµœì  ìˆœì„œë¥¼ ì‚¬ìš©í•˜ë©´ ëŒ€ë¶€ë¶„ì˜ ë¶„ì„ì´ 2--3ë²ˆì˜ íŒ¨ìŠ¤ë¡œ ìˆ˜ë ´í•©ë‹ˆë‹¤ (í•œ íŒ¨ìŠ¤ê°€ ë¹„ìˆœí™˜ ë¶€ë¶„ì„ ì²˜ë¦¬í•˜ê³ , ì¶”ê°€ íŒ¨ìŠ¤ê°€ ë£¨í”„ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤).</p>
<h3 id="72-ssa">7.2 SSA ê¸°ë°˜ ë¶„ì„<a class="header-link" href="#72-ssa" title="Permanent link">&para;</a></h3>
<p>SSA í˜•ì‹ì—ì„œëŠ” ë§ì€ ë°ì´í„° íë¦„ ë¶„ì„ì´ ë‹¨ìˆœí•´ì§‘ë‹ˆë‹¤:</p>
<ul>
<li><strong>ë„ë‹¬ ì •ì˜</strong>: ìëª…í•¨ -- ê° ë³€ìˆ˜ëŠ” ì •í™•íˆ í•˜ë‚˜ì˜ ì •ì˜ë¥¼ ê°€ì§‘ë‹ˆë‹¤</li>
<li><strong>ì •ì˜-ì‚¬ìš© ì²´ì¸(Def-use chains)</strong>: SSA êµ¬ì¡°ì—ì„œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥</li>
<li><strong>ìƒìˆ˜ ì „íŒŒ</strong>: í¬ì†Œ ì¡°ê±´ë¶€ ìƒìˆ˜ ì „íŒŒ(Sparse Conditional Constant Propagation, SCCP)ê°€ SSAì—ì„œ ì§ì ‘ ë™ì‘</li>
</ul>
<h3 id="73">7.3 í”„ë¡œì‹œì € ê°„ ë¶„ì„<a class="header-link" href="#73" title="Permanent link">&para;</a></h3>
<p>í•¨ìˆ˜ ê²½ê³„ë¥¼ ë„˜ì–´ ë¶„ì„ì„ í™•ì¥í•˜ë ¤ë©´ ë‹¤ìŒì´ í•„ìš”í•©ë‹ˆë‹¤:</p>
<ol>
<li><strong>í˜¸ì¶œ ê·¸ë˜í”„(call graph) êµ¬ì„±</strong>: ì–´ë–¤ í•¨ìˆ˜ê°€ ì–´ë–¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ”ê°€?</li>
<li><strong>ë¬¸ë§¥ ê°ìˆ˜ì„±(Context sensitivity)</strong>: ì„œë¡œ ë‹¤ë¥¸ í˜¸ì¶œ ë¬¸ë§¥ êµ¬ë³„</li>
<li><strong>ìš”ì•½ í•¨ìˆ˜(Summary functions)</strong>: ë§¤ë²ˆ í•¨ìˆ˜ ë³¸ë¬¸ì„ ë¶„ì„í•˜ì§€ ì•Šê³  í•¨ìˆ˜ í˜¸ì¶œì˜ íš¨ê³¼ë¥¼ ê³„ì‚°</li>
</ol>
<p>í”„ë¡œì‹œì € ê°„ ë¶„ì„ì´ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê²ƒ:
- í•¨ìˆ˜ í˜¸ì¶œ ê°„ ì „ì—­ ìƒìˆ˜ ì „íŒŒ
- ë³„ì¹­ ë¶„ì„(Alias analysis) (ì–´ë–¤ í¬ì¸í„°ê°€ ê°™ì€ ë©”ëª¨ë¦¬ë¥¼ ê°€ë¦¬í‚¬ ìˆ˜ ìˆëŠ”ê°€?)
- ì´íƒˆ ë¶„ì„(Escape analysis) (ê°ì²´ê°€ ìƒì„± í•¨ìˆ˜ë¥¼ ë²—ì–´ë‚˜ëŠ”ê°€?)</p>
<h3 id="74-widening-and-narrowing">7.4 í™•ì¥ê³¼ ìˆ˜ì¶•(Widening and Narrowing)<a class="header-link" href="#74-widening-and-narrowing" title="Permanent link">&para;</a></h3>
<p>ë¬´í•œ ê²©ì(ì˜ˆ: ìˆ˜ì¹˜ ë²”ìœ„)ì— ëŒ€í•œ ë¶„ì„ì—ì„œëŠ” ë°˜ë³µì´ ìˆ˜ë ´í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <strong>í™•ì¥(widening)</strong>ì€ ë” ë†’ì€ ê²©ì ì›ì†Œë¡œ ì í”„í•˜ì—¬ ìˆ˜ë ´ì„ ê°€ì†í•©ë‹ˆë‹¤:</p>
<p>$$X_{n+1} = X_n \nabla f(X_n)$$</p>
<p>ì—¬ê¸°ì„œ $\nabla$ëŠ” í™•ì¥ ì—°ì‚°ìì…ë‹ˆë‹¤. ìˆ˜ë ´ í›„ <strong>ìˆ˜ì¶•(narrowing)</strong>ì´ ê²°ê³¼ë¥¼ ì •ì œí•©ë‹ˆë‹¤:</p>
<p>$$X_{n+1} = X_n \Delta f(X_n)$$</p>
<p>ì´ëŠ” AstrÃ©e ì •ì  ë¶„ì„ê¸° ë’¤ì˜ ì¶”ìƒ í•´ì„(abstract interpretation) í”„ë ˆì„ì›Œí¬ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
<hr />
<h2 id="8">8. ìµœì í™” ì¡°í•©: ì™„ì „í•œ íŒ¨ìŠ¤<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<p>ë‹¤ìŒì€ ì»´íŒŒì¼ëŸ¬ê°€ ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™”ë¥¼ ì–´ë–»ê²Œ ì—°ê²°í•  ìˆ˜ ìˆëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example optimization pipeline combining local and global passes.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">optimization_pipeline</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a sequence of optimization passes on a CFG.</span>

<span class="sd">    Pipeline:</span>
<span class="sd">    1. Global constant propagation (using reaching definitions)</span>
<span class="sd">    2. Local constant folding (within each block)</span>
<span class="sd">    3. Global CSE (using available expressions)</span>
<span class="sd">    4. Local copy propagation (within each block)</span>
<span class="sd">    5. Global DCE (using live variables)</span>
<span class="sd">    6. Local algebraic simplification</span>
<span class="sd">    7. Repeat if anything changed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Optimization Pass </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>

        <span class="c1"># 1. Global: Reaching definitions â†’ constant propagation</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">ReachingDefinitions</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">apply_global_constant_propagation</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">rd</span><span class="p">):</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Applied global constant propagation&quot;</span><span class="p">)</span>

        <span class="c1"># 2. Local: Constant folding in each block</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">apply_local_constant_folding</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Applied constant folding in B</span><span class="si">{</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 3. Global: Available expressions â†’ CSE</span>
        <span class="n">ae</span> <span class="o">=</span> <span class="n">AvailableExpressions</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="n">ae</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">apply_global_cse</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ae</span><span class="p">):</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Applied global CSE&quot;</span><span class="p">)</span>

        <span class="c1"># 4. Local: Copy propagation in each block</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">apply_local_copy_propagation</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Applied copy propagation in B</span><span class="si">{</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># 5. Global: Live variables â†’ DCE</span>
        <span class="n">lv</span> <span class="o">=</span> <span class="n">LiveVariables</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">apply_global_dce</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">lv</span><span class="p">):</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Applied global DCE&quot;</span><span class="p">)</span>

        <span class="c1"># 6. Local: Algebraic simplification</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">apply_local_algebraic_simplification</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Applied algebraic simplification in B</span><span class="si">{</span><span class="n">block</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Optimization converged after </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> iterations&quot;</span><span class="p">)</span>
</code></pre></div>

<p>ì°¸ê³ : <code>apply_global_constant_propagation</code> ë“±ì˜ í•¨ìˆ˜ëŠ” ì„¹ì…˜ 6ì—ì„œ ì„¤ëª…ëœ ë³€í™˜ì„ êµ¬í˜„í•˜ì—¬ ë¶„ì„ ê²°ê³¼ë¥¼ ì‚¬ìš©í•´ ì–´ë””ì— ë³€ê²½ì„ ì ìš©í• ì§€ ê²°ì •í•©ë‹ˆë‹¤. ìœ„ ì½”ë“œëŠ” ìµœì í™” íŒŒì´í”„ë¼ì¸ì˜ ì „ë°˜ì ì¸ êµ¬ì¡°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
<hr />
<h2 id="9">9. ìš”ì•½<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<p>ì´ ë ˆìŠ¨ì—ì„œëŠ” ì»´íŒŒì¼ëŸ¬ ìµœì í™”ì˜ ì´ë¡ ê³¼ ì‹¤ì œë¥¼ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤:</p>
<ol>
<li>
<p><strong>ìµœì í™” ì›ì¹™</strong>: ëª¨ë“  ìµœì í™”ëŠ” ì•ˆì „í•´ì•¼ í•˜ê³  (ì˜ë¯¸ë¡  ë³´ì¡´), ìˆ˜ìµì„±ì´ ìˆì–´ì•¼ í•˜ë©° (ì½”ë“œ ê°œì„ ), ì ìš© ê¸°íšŒë¥¼ ê°ì§€í•´ì•¼ í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ì§€ì—­ ìµœì í™”</strong>ëŠ” ë‹¨ì¼ ê¸°ë³¸ ë¸”ë¡ ë‚´ì—ì„œ ë™ì‘í•˜ë©° ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:</p>
</li>
<li><strong>ìƒìˆ˜ í´ë”©(Constant folding)</strong>: ì»´íŒŒì¼ ì‹œê°„ì— ìƒìˆ˜ í‘œí˜„ì‹ í‰ê°€</li>
<li><strong>ìƒìˆ˜ ì „íŒŒ(Constant propagation)</strong>: ë³€ìˆ˜ë¥¼ ìƒìˆ˜ ê°’ìœ¼ë¡œ êµì²´</li>
<li><strong>ëŒ€ìˆ˜ì  ë‹¨ìˆœí™”(Algebraic simplification)</strong>: ìˆ˜í•™ì  í•­ë“±ì‹ ì ìš©</li>
<li><strong>ê°•ë„ ê°ì†Œ(Strength reduction)</strong>: ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì—°ì‚°ì„ ë” ì €ë ´í•œ ê²ƒìœ¼ë¡œ êµì²´</li>
<li><strong>CSE</strong>: ì¤‘ë³µ ê³„ì‚° ì œê±°</li>
<li><strong>ë³µì‚¬ ì „íŒŒ(Copy propagation)</strong>: ë³µì‚¬ë¥¼ ì›ë˜ ê°’ìœ¼ë¡œ êµì²´</li>
<li>
<p><strong>ì£½ì€ ì½”ë“œ ì œê±°(Dead code elimination)</strong>: ë¯¸ì‚¬ìš© ê³„ì‚° ì œê±°</p>
</li>
<li>
<p><strong>ì „ì—­ ë°ì´í„° íë¦„ ë¶„ì„</strong>ì€ ì „ì²´ CFGë¥¼ í†µí•œ ì •ë³´ íë¦„ì„ ì¶”ë¡ í•©ë‹ˆë‹¤:</p>
</li>
<li><strong>ë„ë‹¬ ì •ì˜</strong> (ìˆœë°©í–¥, í•©ì§‘í•©): ì–´ë–¤ ì •ì˜ê°€ í•œ ì§€ì ì— ë„ë‹¬í•˜ëŠ”ê°€?</li>
<li><strong>ê°€ìš© í‘œí˜„ì‹</strong> (ìˆœë°©í–¥, êµì§‘í•©): ì–´ë–¤ í‘œí˜„ì‹ì´ ëª¨ë“  ê²½ë¡œì—ì„œ ê³„ì‚°ë˜ëŠ”ê°€?</li>
<li><strong>í™œì„± ë³€ìˆ˜</strong> (ì—­ë°©í–¥, í•©ì§‘í•©): ì–´ë–¤ ë³€ìˆ˜ê°€ ë‚˜ì¤‘ì— í•„ìš”í•œê°€?</li>
<li>
<p><strong>ë§¤ìš° ë°”ìœ í‘œí˜„ì‹</strong> (ì—­ë°©í–¥, êµì§‘í•©): ì–´ë–¤ í‘œí˜„ì‹ì´ ëª¨ë“  ê²½ë¡œì—ì„œ í‰ê°€ë˜ëŠ”ê°€?</p>
</li>
<li>
<p><strong>ë°ì´í„° íë¦„ í”„ë ˆì„ì›Œí¬</strong>ëŠ” ê²©ì ì´ë¡ , ë‹¨ì¡° ì „ë‹¬ í•¨ìˆ˜, ê³ ì •ì  ë°˜ë³µì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ë¶„ì„ì„ í†µí•©í•©ë‹ˆë‹¤. <strong>ì›Œí¬ë¦¬ìŠ¤íŠ¸ ì•Œê³ ë¦¬ì¦˜</strong>ì€ íš¨ìœ¨ì ì¸ êµ¬í˜„ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ë¶„ì„ ê²°ê³¼ëŠ” ì „ì—­ ìµœì í™”ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤: ì „ì—­ ìƒìˆ˜ ì „íŒŒ, ì „ì—­ CSE, ì „ì—­ DCE, ì½”ë“œ ëŒì–´ì˜¬ë¦¬ê¸°.</p>
</li>
</ol>
<p>ì´ëŸ¬í•œ ê¸°ìˆ ë“¤ì€ ì»´íŒŒì¼ëŸ¬ì˜ "ë¯¸ë“¤ ì—”ë“œ" í•µì‹¬ì„ í˜•ì„±í•˜ì—¬, ë°±ì—”ë“œê°€ ê¸°ê³„ ëª…ë ¹ì–´ë¥¼ ìƒì„±í•˜ê¸° ì „ì— IRì„ ë³€í™˜í•˜ì—¬ ë” ë¹ ë¥´ê³  ì‘ì€ ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="_9">ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#_9" title="Permanent link">&para;</a></h2>
<h3 id="1_1">ì—°ìŠµ 1: ì§€ì—­ ìµœì í™”<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ê¸°ë³¸ ë¸”ë¡ì— ëª¨ë“  ì§€ì—­ ìµœì í™”ë¥¼ (ìˆœì„œ: ìƒìˆ˜ ì „íŒŒ, ìƒìˆ˜ í´ë”©, ëŒ€ìˆ˜ì  ë‹¨ìˆœí™”, ë³µì‚¬ ì „íŒŒ, ì£½ì€ ì½”ë“œ ì œê±°) ì ìš©í•˜ì„¸ìš”. ê° íŒ¨ìŠ¤ ì´í›„ì˜ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ì„¸ìš”.</p>
<div class="highlight"><pre><span></span><code>t1 = 4
t2 = 8
t3 = t1 <span class="gs">* t2</span>
<span class="gs">t4 = t3 + 0</span>
<span class="gs">t5 = t4</span>
<span class="gs">t6 = t5 *</span> 1
t7 = t6 / 2
t8 = t7 + t7
unused = t1 + t2
result = t8
</code></pre></div>

<p><code>result</code>ê°€ live outì´ë¼ê³  ê°€ì •í•©ë‹ˆë‹¤.</p>
<h3 id="2_1">ì—°ìŠµ 2: ë„ë‹¬ ì •ì˜<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ CFGì˜ ê° ë¸”ë¡ì— ëŒ€í•´ ë„ë‹¬ ì •ì˜ë¥¼ ê³„ì‚°í•˜ì„¸ìš”. Gen, Kill, In, Out ì§‘í•©ì„ ë³´ì—¬ì£¼ì„¸ìš”.</p>
<div class="highlight"><pre><span></span><code><span class="n">B0</span><span class="o">:</span><span class="w"> </span><span class="n">d0</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">d1</span><span class="o">:</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>

<span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="n">d2</span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B3</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">d3</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">d4</span><span class="o">:</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">B1</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">d5</span><span class="o">:</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">d</span>
</code></pre></div>

<h3 id="3_1">ì—°ìŠµ 3: í™œì„± ë³€ìˆ˜<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>ì—°ìŠµ 2ì˜ CFGì— ëŒ€í•´ ê° ë¸”ë¡ì˜ ì§„ì…ì ê³¼ ì¶œêµ¬ì ì—ì„œì˜ í™œì„± ë³€ìˆ˜ë¥¼ ê³„ì‚°í•˜ì„¸ìš”. B3ì˜ ì¶œêµ¬ì—ì„œ <code>d</code>ê°€ í™œì„±ì´ë¼ê³  ê°€ì •í•©ë‹ˆë‹¤.</p>
<h3 id="4_1">ì—°ìŠµ 4: ê°€ìš© í‘œí˜„ì‹<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ CFGì— ëŒ€í•´ ê° ë¸”ë¡ ì§„ì…ì ì—ì„œì˜ ê°€ìš© í‘œí˜„ì‹ì„ ê³„ì‚°í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="n">B0</span><span class="o">:</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d</span>

<span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="n">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">      </span><span class="o">(</span><span class="n">a</span><span class="o">+</span><span class="n">bê°€</span><span class="w"> </span><span class="err">ì—¬ê¸°ì„œ</span><span class="w"> </span><span class="err">ê°€ìš©í•œê°€</span><span class="o">?)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">t3</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">)</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B2</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B3</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">        </span><span class="o">(</span><span class="n">a</span><span class="o">+</span><span class="n">bë¥¼</span><span class="w"> </span><span class="err">ì œê±°</span><span class="o">)</span>
<span class="w">    </span><span class="n">t4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">B4</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">t5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="w">    </span><span class="n">t6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">B4</span>

<span class="n">B4</span><span class="o">:</span><span class="w"> </span><span class="n">t7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">       </span><span class="o">(</span><span class="n">a</span><span class="o">+</span><span class="n">bê°€</span><span class="w"> </span><span class="err">ì—¬ê¸°ì„œ</span><span class="w"> </span><span class="err">ê°€ìš©í•œê°€</span><span class="o">?)</span>
<span class="w">    </span><span class="n">t8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d</span><span class="w">       </span><span class="o">(</span><span class="n">c</span><span class="o">+</span><span class="n">dê°€</span><span class="w"> </span><span class="err">ì—¬ê¸°ì„œ</span><span class="w"> </span><span class="err">ê°€ìš©í•œê°€</span><span class="o">?)</span>
</code></pre></div>

<h3 id="5">ì—°ìŠµ 5: ì›Œí¬ë¦¬ìŠ¤íŠ¸ ì•Œê³ ë¦¬ì¦˜ ì¶”ì <a class="header-link" href="#5" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ CFGì— ëŒ€í•´ í™œì„± ë³€ìˆ˜ ë¶„ì„ì˜ ì›Œí¬ë¦¬ìŠ¤íŠ¸ ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰ì„ ì¶”ì í•˜ì„¸ìš”. ê° ë‹¨ê³„ì—ì„œ ì›Œí¬ë¦¬ìŠ¤íŠ¸ ë‚´ìš©ê³¼ In/Out ì§‘í•©ì„ ë³´ì—¬ì£¼ì„¸ìš”.</p>
<div class="highlight"><pre><span></span><code><span class="n">B0</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="o">()</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="o">()</span>

<span class="n">B1</span><span class="o">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">)</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B2</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">B3</span>

<span class="n">B2</span><span class="o">:</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">goto</span><span class="w"> </span><span class="n">B1</span>

<span class="n">B3</span><span class="o">:</span><span class="w"> </span><span class="n">print</span><span class="w"> </span><span class="n">z</span>
</code></pre></div>

<h3 id="6_1">ì—°ìŠµ 6: êµ¬í˜„ ë„ì „<a class="header-link" href="#6_1" title="Permanent link">&para;</a></h3>
<p>ë°ì´í„° íë¦„ ë¶„ì„ í”„ë ˆì„ì›Œí¬ë¥¼ í™•ì¥í•˜ì—¬ ë‹¤ìŒì„ êµ¬í˜„í•˜ì„¸ìš”:</p>
<ol>
<li>
<p><strong>ìƒìˆ˜ ì „íŒŒ ë¶„ì„(Constant propagation analysis)</strong>: ê° ë³€ìˆ˜ì˜ ê²©ì ì›ì†Œê°€ {$\top$, ìƒìˆ˜ $c$, $\bot$} ì¤‘ í•˜ë‚˜ì¸ ìˆœë°©í–¥ ë¶„ì„. ë‘ ê°œì˜ ë‹¤ë¥¸ ìƒìˆ˜ì˜ ë§Œë‚¨ì€ $\bot$ì…ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ë³µì‚¬ ì „íŒŒ ë¶„ì„(Copy propagation analysis)</strong>: ì–´ë–¤ ë³µì‚¬ <code>x = y</code>ê°€ ê° í”„ë¡œê·¸ë¨ ì§€ì ì—ì„œ ì•„ì§ ìœ íš¨í•œì§€ (ì œê±°ë˜ì§€ ì•Šì•˜ëŠ”ì§€) ê²°ì •í•©ë‹ˆë‹¤.</p>
</li>
</ol>
<p>ë‘ ë¶„ì„ì„ ì—°ìŠµ 2ì˜ CFGì—ì„œ í…ŒìŠ¤íŠ¸í•˜ê³  ì–´ë–»ê²Œ ì¶”ê°€ ìµœì í™”ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ”ì§€ ë³´ì—¬ì£¼ì„¸ìš”.</p>
<hr />
<p><a href="./11_Code_Generation.md">Previous: 11_Code_Generation.md</a> | <a href="./13_Loop_Optimization.md">Next: 13_Loop_Optimization.md</a> | <a href="./00_Overview.md">Overview</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/11_Code_Generation.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë ˆìŠ¨ 11: ì½”ë“œ ìƒì„±(Code Generation)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/13_Loop_Optimization.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ë£¨í”„ ìµœì í™”</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}