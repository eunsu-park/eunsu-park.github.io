{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë£¨í”„ ìµœì í™” - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Compiler_Design/">Compiler Design</a>
    <span class="separator">/</span>
    <span class="current">ë£¨í”„ ìµœì í™”</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ë£¨í”„ ìµœì í™”</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/12_Optimization_Local_and_Global.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë ˆìŠ¨ 12: ìµœì í™” -- ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™”</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/14_Garbage_Collection.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(Garbage Collection)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1">1. ë£¨í”„ ìµœì í™”ê°€ ì¤‘ìš”í•œ ì´ìœ </a><ul>
<li><a href="#_3">ìµœì í™” ì§€í˜•</a></li>
</ul>
</li>
<li><a href="#2">2. ì§€ë°°ìì™€ ì§€ë°°ì íŠ¸ë¦¬</a><ul>
<li><a href="#21-dominance">2.1 ì§€ë°°(Dominance)</a></li>
<li><a href="#22">2.2 ì§€ë°°ì ê³„ì‚°</a></li>
<li><a href="#23">2.3 ì§€ë°°ì íŠ¸ë¦¬</a></li>
<li><a href="#24-cooper-harvey-kennedy">2.4 Cooper-Harvey-Kennedy ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#25-dominance-frontiers">2.5 ì§€ë°° ê²½ê³„(Dominance Frontiers)</a></li>
</ul>
</li>
<li><a href="#3">3. ìì—° ë£¨í”„ ê°ì§€</a><ul>
<li><a href="#31-back-edges">3.1 í›„ë°© ì—£ì§€(Back Edges)</a></li>
<li><a href="#32-natural-loops">3.2 ìì—° ë£¨í”„(Natural Loops)</a></li>
<li><a href="#33">3.3 ë£¨í”„ ì¤‘ì²©ê³¼ ë£¨í”„ íŠ¸ë¦¬</a></li>
<li><a href="#34-preheader">3.4 í”„ë¦¬í—¤ë”(Preheader) ì‚½ì…</a></li>
</ul>
</li>
<li><a href="#4-licm">4. ë£¨í”„ ë¶ˆë³€ ì½”ë“œ ì´ë™ (LICM)</a><ul>
<li><a href="#41">4.1 ë£¨í”„ ë¶ˆë³€ ê³„ì‚° ì‹ë³„</a></li>
<li><a href="#42">4.2 ì•ˆì „í•œ ì½”ë“œ ì´ë™ ì¡°ê±´</a></li>
<li><a href="#43-licm">4.3 ì‹¤ì œ LICM</a></li>
</ul>
</li>
<li><a href="#5">5. ê·€ë‚© ë³€ìˆ˜ ë¶„ì„</a><ul>
<li><a href="#51-basic-induction-variables">5.1 ê¸°ë³¸ ê·€ë‚© ë³€ìˆ˜(Basic Induction Variables)</a></li>
<li><a href="#52-derived-induction-variables">5.2 íŒŒìƒ ê·€ë‚© ë³€ìˆ˜(Derived Induction Variables)</a></li>
</ul>
</li>
<li><a href="#6">6. ê°•ë„ ê°ì†Œ</a><ul>
<li><a href="#61">6.1 ì•„ì´ë””ì–´</a></li>
<li><a href="#62-allen-cocke-kennedy">6.2 Allen-Cocke-Kennedy ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#63">6.3 ì„ í˜• í…ŒìŠ¤íŠ¸ êµì²´</a></li>
</ul>
</li>
<li><a href="#7">7. ë£¨í”„ ì–¸ë¡¤ë§</a><ul>
<li><a href="#71">7.1 ì™„ì „ ì–¸ë¡¤ë§</a></li>
<li><a href="#72">7.2 ë¶€ë¶„ ì–¸ë¡¤ë§</a></li>
<li><a href="#73">7.3 ì–¸ë¡¤ë§ê³¼ ì†Œí”„íŠ¸ì›¨ì–´ íŒŒì´í”„ë¼ì´ë‹</a></li>
<li><a href="#74">7.4 êµ¬í˜„ ê³ ë ¤ ì‚¬í•­</a></li>
</ul>
</li>
<li><a href="#8">8. ë£¨í”„ ê²°í•©ê³¼ ë¶„ë¦¬</a><ul>
<li><a href="#81-loop-fusion-jamming">8.1 ë£¨í”„ ê²°í•©(Loop Fusion, Jamming)</a></li>
<li><a href="#82-loop-fission-distribution">8.2 ë£¨í”„ ë¶„ë¦¬(Loop Fission, Distribution)</a></li>
</ul>
</li>
<li><a href="#9">9. ë£¨í”„ íƒ€ì¼ë§ (ë¸”ë¡œí‚¹)</a><ul>
<li><a href="#91">9.1 ìºì‹œ ë¬¸ì œ</a></li>
<li><a href="#92">9.2 íƒ€ì¼ë§ ë³€í™˜</a></li>
<li><a href="#93">9.3 íƒ€ì¼ í¬ê¸° ì„ íƒ</a></li>
<li><a href="#94">9.4 ë‹¤ì¤‘ ìˆ˜ì¤€ íƒ€ì¼ë§</a></li>
</ul>
</li>
<li><a href="#10">10. ë£¨í”„ êµí™˜</a><ul>
<li><a href="#101">10.1 ë™ê¸°</a></li>
<li><a href="#102">10.2 ë£¨í”„ êµí™˜ì˜ í•©ë²•ì„±</a></li>
</ul>
</li>
<li><a href="#11">11. ë²¡í„°í™”</a><ul>
<li><a href="#111-simd">11.1 SIMD ê°œìš”</a></li>
<li><a href="#112">11.2 ìë™ ë²¡í„°í™”</a></li>
<li><a href="#113-numpy">11.3 NumPyë¥¼ ì‚¬ìš©í•œ ë²¡í„°í™”</a></li>
<li><a href="#114-strip-mining">11.4 ìŠ¤íŠ¸ë¦½ ë§ˆì´ë‹(Strip Mining)</a></li>
<li><a href="#115-peeling">11.5 ì •ë ¬ê³¼ í•„ë§(Peeling)</a></li>
</ul>
</li>
<li><a href="#12">12. ë‹¤ë©´ì²´ ëª¨ë¸</a><ul>
<li><a href="#121">12.1 ê°œìš”</a></li>
<li><a href="#122">12.2 ë°˜ë³µ ë„ë©”ì¸</a></li>
<li><a href="#123">12.3 ì ‘ê·¼ í•¨ìˆ˜</a></li>
<li><a href="#124">12.4 ì˜ì¡´ì„± ë‹¤ë©´ì²´</a></li>
<li><a href="#125">12.5 ìŠ¤ì¼€ì¤„ê³¼ ë³€í™˜</a></li>
<li><a href="#126">12.6 ë„êµ¬</a></li>
</ul>
</li>
<li><a href="#13">13. ë£¨í”„ ë³‘ë ¬í™”</a><ul>
<li><a href="#131">13.1 ì˜ì¡´ì„±ì´ ì—†ëŠ” ë£¨í”„</a></li>
<li><a href="#132">13.2 ì˜ì¡´ì„± ìœ í˜•</a></li>
<li><a href="#133">13.3 ë¦¬ë•ì…˜ ë³‘ë ¬í™”</a></li>
<li><a href="#134-doall-doacross-dopipe">13.4 DOALL, DOACROSS, DOPIPE</a></li>
<li><a href="#135-openmp">13.5 OpenMP ìŠ¤íƒ€ì¼ ë³‘ë ¬í™”</a></li>
<li><a href="#136">13.6 ë³‘ë ¬í™”ë¥¼ ìœ„í•œ ì»´íŒŒì¼ëŸ¬ ë¶„ì„</a></li>
</ul>
</li>
<li><a href="#14">14. ìš”ì•½</a></li>
<li><a href="#15">15. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1_1">ì—°ìŠµ 1: ì§€ë°°ì ê³„ì‚°</a></li>
<li><a href="#2_1">ì—°ìŠµ 2: ë£¨í”„ ë¶ˆë³€ ì½”ë“œ ì´ë™</a></li>
<li><a href="#3_1">ì—°ìŠµ 3: ê°•ë„ ê°ì†Œ</a></li>
<li><a href="#4">ì—°ìŠµ 4: ë£¨í”„ íƒ€ì¼ë§</a></li>
<li><a href="#5_1">ì—°ìŠµ 5: ë²¡í„°í™” ë¶„ì„</a></li>
<li><a href="#6_1">ì—°ìŠµ 6: ë‹¤ë©´ì²´ ë³€í™˜</a></li>
</ul>
</li>
<li><a href="#16">16. ì°¸ê³  ë¬¸í—Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="_1">ë£¨í”„ ìµœì í™”<a class="header-link" href="#_1" title="Permanent link">&para;</a></h1>
<p><strong>ì´ì „</strong>: <a href="./12_Optimization_Local_and_Global.md">12. ìµœì í™” -- ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™”</a> | <strong>ë‹¤ìŒ</strong>: <a href="./14_Garbage_Collection.md">14. ê°€ë¹„ì§€ ì»¬ë ‰ì…˜</a></p>
<hr />
<p>í”„ë¡œê·¸ë¨ì€ ì‹¤í–‰ ì‹œê°„ì˜ ëŒ€ë¶€ë¶„ì„ ë£¨í”„ ë‚´ë¶€ì—ì„œ ë³´ëƒ…ë‹ˆë‹¤. "90/10 ê·œì¹™"ì´ë¼ê³ ë„ ë¶ˆë¦¬ëŠ” ê²½í—˜ì  ë²•ì¹™ì— ë”°ë¥´ë©´ ì‹¤í–‰ ì‹œê°„ì˜ 90%ëŠ” ì½”ë“œì˜ 10%ì—ì„œ ì†Œë¹„ë˜ë©° -- ê·¸ 10%ëŠ” ê±°ì˜ í•­ìƒ ë£¨í”„ ì•ˆì…ë‹ˆë‹¤. ì´ ë•Œë¬¸ì— ë£¨í”„ ìµœì í™”ëŠ” ì»´íŒŒì¼ëŸ¬ ìµœì í™” ë²”ì£¼ ì¤‘ ê°€ì¥ í° ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ë°±ë§Œ ë²ˆ ì‹¤í–‰ë˜ëŠ” ë£¨í”„ëŠ” ëª¨ë“  ê°œì„ ì„ ë°±ë§Œ ë°°ë¡œ ì¦í­í•©ë‹ˆë‹¤.</p>
<p>ì´ ë ˆìŠ¨ì€ ë£¨í”„ ìµœì í™”ì˜ ì „ì²´ ìŠ¤í™íŠ¸ëŸ¼ì„ ë‹¤ë£¹ë‹ˆë‹¤: ì œì–´ íë¦„ ê·¸ë˜í”„ì—ì„œ ë£¨í”„ë¥¼ ê°ì§€í•˜ëŠ” ê²ƒë¶€í„°, ë£¨í”„ ë¶ˆë³€ ì½”ë“œ ì´ë™(loop-invariant code motion)ê³¼ ê°•ë„ ê°ì†Œ(strength reduction)ì™€ ê°™ì€ ê³ ì „ì ì¸ ë³€í™˜, ë²¡í„°í™”(vectorization)ì™€ ë‹¤ë©´ì²´ ëª¨ë¸(polyhedral model)ê³¼ ê°™ì€ í˜„ëŒ€ì ì¸ ê¸°ë²•ê¹Œì§€.</p>
<p><strong>ë‚œì´ë„</strong>: â­â­â­â­</p>
<p><strong>ì „ì œ ì¡°ê±´</strong>: <a href="./09_Intermediate_Representations.md">09. ì¤‘ê°„ í‘œí˜„</a>, <a href="./12_Optimization_Local_and_Global.md">12. ìµœì í™” -- ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™”</a></p>
<p><strong>í•™ìŠµ ëª©í‘œ</strong>:
- ì§€ë°° ë¶„ì„(dominance analysis)ê³¼ í›„ë°© ì—£ì§€(back edge)ë¥¼ ì‚¬ìš©í•˜ì—¬ ìì—° ë£¨í”„(natural loop) ì‹ë³„
- ì§€ë°°ì íŠ¸ë¦¬(dominator tree) êµ¬ì„± ë° ì§€ë°° ê²½ê³„(dominance frontier) ê³„ì‚°
- ë£¨í”„ ë¶ˆë³€ ì½”ë“œ ì´ë™(LICM)ì„ ì ìš©í•˜ì—¬ ê³„ì‚°ì„ ë£¨í”„ ë°–ìœ¼ë¡œ ëŒì–´ì˜¬ë¦¬ê¸°
- ê°•ë„ ê°ì†Œë¥¼ í†µí•œ ê·€ë‚© ë³€ìˆ˜(induction variable) ì¸ì‹ ë° ìµœì í™”
- ë£¨í”„ ì–¸ë¡¤ë§(loop unrolling)ê³¼ ê·¸ íŠ¸ë ˆì´ë“œì˜¤í”„ ì´í•´
- ë£¨í”„ ë³€í™˜ ì ìš©: ê²°í•©(fusion), ë¶„ë¦¬(fission), êµí™˜(interchange), íƒ€ì¼ë§(tiling)
- ë²¡í„°í™”ì˜ ê¸°ì´ˆì™€ ë‹¤ë©´ì²´ ëª¨ë¸ ì„¤ëª…
- ë£¨í”„ ë³‘ë ¬í™” ê¸°íšŒ ì¶”ë¡ </p>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-ë£¨í”„-ìµœì í™”ê°€-ì¤‘ìš”í•œ-ì´ìœ ">ë£¨í”„ ìµœì í™”ê°€ ì¤‘ìš”í•œ ì´ìœ </a></li>
<li><a href="#2-ì§€ë°°ìì™€-ì§€ë°°ì-íŠ¸ë¦¬">ì§€ë°°ìì™€ ì§€ë°°ì íŠ¸ë¦¬</a></li>
<li><a href="#3-ìì—°-ë£¨í”„-ê°ì§€">ìì—° ë£¨í”„ ê°ì§€</a></li>
<li><a href="#4-ë£¨í”„-ë¶ˆë³€-ì½”ë“œ-ì´ë™-licm">ë£¨í”„ ë¶ˆë³€ ì½”ë“œ ì´ë™ (LICM)</a></li>
<li><a href="#5-ê·€ë‚©-ë³€ìˆ˜-ë¶„ì„">ê·€ë‚© ë³€ìˆ˜ ë¶„ì„</a></li>
<li><a href="#6-ê°•ë„-ê°ì†Œ">ê°•ë„ ê°ì†Œ</a></li>
<li><a href="#7-ë£¨í”„-ì–¸ë¡¤ë§">ë£¨í”„ ì–¸ë¡¤ë§</a></li>
<li><a href="#8-ë£¨í”„-ê²°í•©ê³¼-ë¶„ë¦¬">ë£¨í”„ ê²°í•©ê³¼ ë¶„ë¦¬</a></li>
<li><a href="#9-ë£¨í”„-íƒ€ì¼ë§-ë¸”ë¡œí‚¹">ë£¨í”„ íƒ€ì¼ë§ (ë¸”ë¡œí‚¹)</a></li>
<li><a href="#10-ë£¨í”„-êµí™˜">ë£¨í”„ êµí™˜</a></li>
<li><a href="#11-ë²¡í„°í™”">ë²¡í„°í™”</a></li>
<li><a href="#12-ë‹¤ë©´ì²´-ëª¨ë¸">ë‹¤ë©´ì²´ ëª¨ë¸</a></li>
<li><a href="#13-ë£¨í”„-ë³‘ë ¬í™”">ë£¨í”„ ë³‘ë ¬í™”</a></li>
<li><a href="#14-ìš”ì•½">ìš”ì•½</a></li>
<li><a href="#15-ì—°ìŠµ-ë¬¸ì œ">ì—°ìŠµ ë¬¸ì œ</a></li>
<li><a href="#16-ì°¸ê³ -ë¬¸í—Œ">ì°¸ê³  ë¬¸í—Œ</a></li>
</ol>
<hr />
<h2 id="1">1. ë£¨í”„ ìµœì í™”ê°€ ì¤‘ìš”í•œ ì´ìœ <a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<p>ê°„ë‹¨í•œ ë£¨í”„ë¥¼ ìƒê°í•´ë´…ì‹œë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Before optimization</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>        <span class="c1"># Invariant: same result every iteration</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span>
</code></pre></div>

<p><code>a * b + c</code> í‘œí˜„ì‹ì€ ì ˆëŒ€ ë³€í•˜ì§€ ì•ŠëŠ”ë°ë„ ë°±ë§Œ ë²ˆ ì¬ê³„ì‚°ë©ë‹ˆë‹¤. ì´ë¥¼ ë£¨í”„ ë°–ìœ¼ë¡œ ì´ë™í•˜ë©´:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># After optimization</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>            <span class="c1"># Computed once</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span>
</code></pre></div>

<p>ì´ë¡œì¨ 999,999ë²ˆì˜ ì¤‘ë³µ ê³±ì…ˆê³¼ ë§ì…ˆì´ ì œê±°ë©ë‹ˆë‹¤. ì´ëŸ° ì ˆê°ì´ ì¤‘ì²© ë£¨í”„ì— ê±¸ì³ ê³±í•´ì§€ë©´ ì˜í–¥ì€ ì—„ì²­ë‚©ë‹ˆë‹¤.</p>
<h3 id="_3">ìµœì í™” ì§€í˜•<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ ìµœì í™”ëŠ” ì—¬ëŸ¬ ë²”ì£¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">                    </span><span class="k">Loop</span><span class="w"> </span><span class="nv">Optimizations</span><span class="w">                            </span>â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w">  </span><span class="nv">Reduce</span><span class="w"> </span><span class="nv">Work</span><span class="w">        </span>â”‚<span class="w">  </span><span class="nv">Improve</span><span class="w"> </span><span class="nv">Locality</span><span class="w">    </span>â”‚<span class="w">  </span><span class="nv">Exploit</span><span class="w"> </span><span class="nv">Hardware</span><span class="w">  </span>â”‚
â”‚<span class="w">                     </span>â”‚<span class="w">                      </span>â”‚<span class="w">                    </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">LICM</span><span class="w">             </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="k">Loop</span><span class="w"> </span><span class="nv">tiling</span><span class="w">       </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Vectorization</span><span class="w">   </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Strength</span><span class="w">         </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="k">Loop</span><span class="w"> </span><span class="nv">interchange</span><span class="w">  </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Parallelization</span><span class="w"> </span>â”‚
â”‚<span class="w">    </span><span class="nv">reduction</span><span class="w">        </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="k">Loop</span><span class="w"> </span><span class="nv">fusion</span><span class="w">       </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Software</span><span class="w">        </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Dead</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">in</span><span class="w">     </span>â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nv">Data</span><span class="w"> </span><span class="nv">prefetching</span><span class="w">  </span>â”‚<span class="w">    </span><span class="nv">pipelining</span><span class="w">      </span>â”‚
â”‚<span class="w">    </span><span class="nv">loops</span><span class="w">            </span>â”‚<span class="w">                      </span>â”‚<span class="w">                    </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="k">Loop</span><span class="w"> </span><span class="nv">unrolling</span><span class="w">   </span>â”‚<span class="w">                      </span>â”‚<span class="w">                    </span>â”‚
â”‚<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="k">Loop</span><span class="w"> </span><span class="nv">unswitching</span><span class="w"> </span>â”‚<span class="w">                      </span>â”‚<span class="w">                    </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p>ë£¨í”„ë¥¼ ìµœì í™”í•˜ê¸° ì „ì— ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë ¤ë©´ ì§€ë°°ìë¥¼ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="2">2. ì§€ë°°ìì™€ ì§€ë°°ì íŠ¸ë¦¬<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21-dominance">2.1 ì§€ë°°(Dominance)<a class="header-link" href="#21-dominance" title="Permanent link">&para;</a></h3>
<p>ì§„ì… ë…¸ë“œ $\text{entry}$ê°€ ìˆëŠ” ì œì–´ íë¦„ ê·¸ë˜í”„(CFG)ì—ì„œ, $\text{entry}$ì—ì„œ $n$ê¹Œì§€ì˜ ëª¨ë“  ê²½ë¡œê°€ $d$ë¥¼ í†µê³¼í•´ì•¼ í•˜ë©´, ë…¸ë“œ $d$ê°€ ë…¸ë“œ $n$ì„ <strong>ì§€ë°°(dominates)</strong>í•œë‹¤ê³  í•©ë‹ˆë‹¤ ($d \;\text{dom}\; n$ìœ¼ë¡œ í‘œê¸°).</p>
<p>ì£¼ìš” ì„±ì§ˆ:</p>
<ul>
<li><strong>ë°˜ì‚¬ì„±(Reflexivity)</strong>: ëª¨ë“  ë…¸ë“œëŠ” ìê¸° ìì‹ ì„ ì§€ë°°í•©ë‹ˆë‹¤: $n \;\text{dom}\; n$.</li>
<li><strong>ì¶”ì´ì„±(Transitivity)</strong>: $a \;\text{dom}\; b$ì´ê³  $b \;\text{dom}\; c$ì´ë©´ $a \;\text{dom}\; c$.</li>
<li><strong>ë°˜ëŒ€ì¹­ì„±(Antisymmetry)</strong>: $a \;\text{dom}\; b$ì´ê³  $b \;\text{dom}\; a$ì´ë©´ $a = b$.</li>
</ul>
<p>$n$ì˜ <strong>ì§ì ‘ ì§€ë°°ì(immediate dominator)</strong> ($\text{idom}(n)$ìœ¼ë¡œ í‘œê¸°)ëŠ” $n$ì˜ ê°€ì¥ ê°€ê¹Œìš´ ì§„ì„± ì§€ë°°ì(strict dominator)ì…ë‹ˆë‹¤: $d \neq n$ì´ë©´ì„œ $n$ì˜ ë‹¤ë¥¸ ëª¨ë“  ì§€ë°°ìê°€ $d$ë¥¼ ì§€ë°°í•˜ëŠ” ì§€ë°°ì $d$.</p>
<h3 id="22">2.2 ì§€ë°°ì ê³„ì‚°<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<p>ê³ ì „ì ì¸ ë°˜ë³µ ì•Œê³ ë¦¬ì¦˜ì€ ëª¨ë“  ë…¸ë“œì˜ ì§€ë°°ì ì§‘í•©ì„ ëª¨ë“  ë…¸ë“œë¥¼ í¬í•¨í•˜ë„ë¡ ì´ˆê¸°í™”í•œ í›„, êµì§‘í•©ìœ¼ë¡œ ë°˜ë³µì ìœ¼ë¡œ ì •ì œí•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_dominators</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute dominator sets for each node in a CFG.</span>

<span class="sd">    cfg: dict mapping node -&gt; list of predecessor nodes</span>
<span class="sd">    entry: the entry node of the CFG</span>
<span class="sd">    Returns: dict mapping node -&gt; set of dominator nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Initialize</span>
    <span class="n">dom</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">entry</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">!=</span> <span class="n">entry</span><span class="p">:</span>
            <span class="n">dom</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_nodes</span><span class="p">)</span>  <span class="c1"># Start with all nodes</span>

    <span class="c1"># Iterate until fixed point</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">entry</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">predecessors</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">predecessors</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># New dom set = intersection of all predecessors&#39; dom sets, plus self</span>
            <span class="n">new_dom</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">dom</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predecessors</span><span class="p">))</span>
            <span class="n">new_dom</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_dom</span> <span class="o">!=</span> <span class="n">dom</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                <span class="n">dom</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_dom</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">dom</span>
</code></pre></div>

<p><strong>ì˜ˆì‹œ</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nl">CFG</span><span class="p">:</span>
<span class="w">    </span><span class="n">entry</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">D</span>
<span class="w">                  </span><span class="o">^</span><span class="w">         </span><span class="o">|</span>
<span class="w">                  </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">                  </span><span class="o">+</span><span class="c1">----E----+</span>

<span class="nl">Predecessors</span><span class="p">:</span>
<span class="w">  </span><span class="nl">entry</span><span class="p">:</span><span class="w"> </span><span class="err">[]</span>
<span class="w">  </span><span class="nl">A</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">entry</span><span class="o">]</span>
<span class="w">  </span><span class="nl">B</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">A, E</span><span class="o">]</span>
<span class="w">  </span><span class="nl">C</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">B</span><span class="o">]</span>
<span class="w">  </span><span class="nl">D</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">C</span><span class="o">]</span>
<span class="w">  </span><span class="nl">E</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">D</span><span class="o">]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">],</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">dom</span> <span class="o">=</span> <span class="n">compute_dominators</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="s1">&#39;entry&#39;</span><span class="p">)</span>

<span class="c1"># Result:</span>
<span class="c1"># dom[&#39;entry&#39;] = {&#39;entry&#39;}</span>
<span class="c1"># dom[&#39;A&#39;]     = {&#39;entry&#39;, &#39;A&#39;}</span>
<span class="c1"># dom[&#39;B&#39;]     = {&#39;entry&#39;, &#39;A&#39;, &#39;B&#39;}</span>
<span class="c1"># dom[&#39;C&#39;]     = {&#39;entry&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;}</span>
<span class="c1"># dom[&#39;D&#39;]     = {&#39;entry&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;}</span>
<span class="c1"># dom[&#39;E&#39;]     = {&#39;entry&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;}</span>
</code></pre></div>

<h3 id="23">2.3 ì§€ë°°ì íŠ¸ë¦¬<a class="header-link" href="#23" title="Permanent link">&para;</a></h3>
<p>ì§€ë°°ì íŠ¸ë¦¬ëŠ” ì§ì ‘ ì§€ë°° ê´€ê³„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. íŠ¸ë¦¬ì—ì„œ ê° ë…¸ë“œì˜ ë¶€ëª¨ëŠ” ì§ì ‘ ì§€ë°°ìì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_dominator_tree</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build the dominator tree from dominator sets.</span>

<span class="sd">    Returns: dict mapping node -&gt; immediate dominator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idom</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dom</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">entry</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># Immediate dominator is the closest strict dominator</span>
        <span class="n">strict_doms</span> <span class="o">=</span> <span class="n">dom</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">node</span><span class="p">}</span>
        <span class="c1"># idom is the one that is dominated by all others</span>
        <span class="c1"># (i.e., has the largest dominator set among strict dominators)</span>
        <span class="n">idom_node</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">strict_doms</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">dom</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
        <span class="n">idom</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">idom_node</span>
    <span class="k">return</span> <span class="n">idom</span>


<span class="k">def</span><span class="w"> </span><span class="nf">print_dominator_tree</span><span class="p">(</span><span class="n">idom</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print the dominator tree.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">entry</span><span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">idom</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">entry</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
        <span class="n">print_dominator_tree</span><span class="p">(</span><span class="n">idom</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<p>ìœ„ ì˜ˆì‹œì— ëŒ€í•´:</p>
<div class="highlight"><pre><span></span><code>Dominator Tree:
entry
  A
    B
      C
        D
          E
</code></pre></div>

<h3 id="24-cooper-harvey-kennedy">2.4 Cooper-Harvey-Kennedy ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#24-cooper-harvey-kennedy" title="Permanent link">&para;</a></h3>
<p>ì‹¤ì œë¡œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì€ ì—­í›„ìœ„ ìˆœì„œ ìˆœíšŒë¥¼ ì‚¬ìš©í•˜ì—¬ ê±°ì˜ ì„ í˜• ì‹œê°„ì— ì§€ë°°ìë¥¼ ê³„ì‚°í•˜ëŠ” Cooper-Harvey-Kennedy(CHK) ì•Œê³ ë¦¬ì¦˜ì…ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_rpo</span><span class="p">(</span><span class="n">cfg_successors</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute reverse postorder of CFG nodes.&quot;&quot;&quot;</span>
    <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">postorder</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">succ</span> <span class="ow">in</span> <span class="n">cfg_successors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">succ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="n">dfs</span><span class="p">(</span><span class="n">succ</span><span class="p">)</span>
        <span class="n">postorder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="n">dfs</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="n">postorder</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">postorder</span>


<span class="k">def</span><span class="w"> </span><span class="nf">intersect</span><span class="p">(</span><span class="n">idom</span><span class="p">,</span> <span class="n">rpo_number</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find common dominator using the finger-moving technique.&quot;&quot;&quot;</span>
    <span class="n">finger1</span> <span class="o">=</span> <span class="n">b1</span>
    <span class="n">finger2</span> <span class="o">=</span> <span class="n">b2</span>
    <span class="k">while</span> <span class="n">finger1</span> <span class="o">!=</span> <span class="n">finger2</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">rpo_number</span><span class="p">[</span><span class="n">finger1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rpo_number</span><span class="p">[</span><span class="n">finger2</span><span class="p">]:</span>
            <span class="n">finger1</span> <span class="o">=</span> <span class="n">idom</span><span class="p">[</span><span class="n">finger1</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">rpo_number</span><span class="p">[</span><span class="n">finger2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rpo_number</span><span class="p">[</span><span class="n">finger1</span><span class="p">]:</span>
            <span class="n">finger2</span> <span class="o">=</span> <span class="n">idom</span><span class="p">[</span><span class="n">finger2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">finger1</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_idom_chk</span><span class="p">(</span><span class="n">cfg_preds</span><span class="p">,</span> <span class="n">cfg_succs</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cooper-Harvey-Kennedy dominator algorithm.</span>

<span class="sd">    cfg_preds: dict node -&gt; list of predecessors</span>
<span class="sd">    cfg_succs: dict node -&gt; list of successors</span>
<span class="sd">    entry: entry node</span>
<span class="sd">    Returns: dict node -&gt; immediate dominator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rpo</span> <span class="o">=</span> <span class="n">compute_rpo</span><span class="p">(</span><span class="n">cfg_succs</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
    <span class="n">rpo_number</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rpo</span><span class="p">)}</span>

    <span class="n">idom</span> <span class="o">=</span> <span class="p">{</span><span class="n">entry</span><span class="p">:</span> <span class="n">entry</span><span class="p">}</span>

    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">rpo</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">entry</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">preds</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cfg_preds</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">idom</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">preds</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">new_idom</span> <span class="o">=</span> <span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">new_idom</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">idom</span><span class="p">,</span> <span class="n">rpo_number</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">new_idom</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">idom</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">!=</span> <span class="n">new_idom</span><span class="p">:</span>
                <span class="n">idom</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_idom</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">idom</span>
</code></pre></div>

<h3 id="25-dominance-frontiers">2.5 ì§€ë°° ê²½ê³„(Dominance Frontiers)<a class="header-link" href="#25-dominance-frontiers" title="Permanent link">&para;</a></h3>
<p>ë…¸ë“œ $n$ì˜ <strong>ì§€ë°° ê²½ê³„(dominance frontier)</strong>ëŠ” $n$ì˜ ì§€ë°°ê°€ ë§‰ "ë©ˆì¶”ëŠ”" ë…¸ë“œë“¤ì˜ ì§‘í•©ì…ë‹ˆë‹¤ -- $n$ì´ ì—„ê²©í•˜ê²Œ ì§€ë°°í•˜ì§€ ì•Šì§€ë§Œ $n$ì´ ì§€ë°°í•˜ëŠ” ì„ í–‰ ë¸”ë¡ì„ ê°€ì§€ëŠ” ì²« ë²ˆì§¸ ë…¸ë“œë“¤.</p>
<p>$$DF(n) = \{ y \mid \exists\, x \in \text{pred}(y) : n \;\text{dom}\; x \land n \not\text{sdom}\; y \}$$</p>
<p>ì—¬ê¸°ì„œ $\text{sdom}$ì€ "ì—„ê²©í•˜ê²Œ ì§€ë°°" (ì§€ë°°í•˜ê³  ê°™ì§€ ì•ŠìŒ)ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
<p>ì§€ë°° ê²½ê³„ëŠ” SSA í˜•ì‹ êµ¬ì„± ì‹œ $\phi$-í•¨ìˆ˜ë¥¼ ë°°ì¹˜í•˜ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤ (ë ˆìŠ¨ 9 ì°¸ì¡°).</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_dominance_frontiers</span><span class="p">(</span><span class="n">cfg_preds</span><span class="p">,</span> <span class="n">idom</span><span class="p">,</span> <span class="n">all_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute dominance frontiers for all nodes.</span>

<span class="sd">    Returns: dict mapping node -&gt; set of nodes in its dominance frontier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">all_nodes</span><span class="p">:</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">cfg_preds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Join point</span>
            <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">:</span>
                <span class="n">runner</span> <span class="o">=</span> <span class="n">pred</span>
                <span class="k">while</span> <span class="n">runner</span> <span class="o">!=</span> <span class="n">idom</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">runner</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="n">runner</span> <span class="o">=</span> <span class="n">idom</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>

<hr />
<h2 id="3">3. ìì—° ë£¨í”„ ê°ì§€<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31-back-edges">3.1 í›„ë°© ì—£ì§€(Back Edges)<a class="header-link" href="#31-back-edges" title="Permanent link">&para;</a></h3>
<p>CFGì˜ <strong>í›„ë°© ì—£ì§€(back edge)</strong>ëŠ” $h$ê°€ $n$ì„ ì§€ë°°í•˜ëŠ” ì—£ì§€ $n \to h$ì…ë‹ˆë‹¤. í›„ë°© ì—£ì§€ëŠ” ë£¨í”„ì˜ ì¡´ì¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_back_edges</span><span class="p">(</span><span class="n">cfg_succs</span><span class="p">,</span> <span class="n">idom_sets</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all back edges in the CFG.</span>

<span class="sd">    cfg_succs: dict node -&gt; list of successors</span>
<span class="sd">    idom_sets: dict node -&gt; set of all dominators of that node</span>
<span class="sd">    Returns: list of (tail, head) tuples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">back_edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cfg_succs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">succ</span> <span class="ow">in</span> <span class="n">cfg_succs</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">succ</span> <span class="ow">in</span> <span class="n">idom_sets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
                <span class="c1"># succ dominates node, so node -&gt; succ is a back edge</span>
                <span class="n">back_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">succ</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">back_edges</span>
</code></pre></div>

<h3 id="32-natural-loops">3.2 ìì—° ë£¨í”„(Natural Loops)<a class="header-link" href="#32-natural-loops" title="Permanent link">&para;</a></h3>
<p>í›„ë°© ì—£ì§€ $n \to h$ê°€ ì£¼ì–´ì§€ë©´, <strong>ìì—° ë£¨í”„(natural loop)</strong>ëŠ” <strong>í—¤ë”(header)</strong> $h$ì™€ $h$ë¥¼ í†µí•˜ì§€ ì•Šê³  $n$ì— ë„ë‹¬í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ë…¸ë“œë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_natural_loop</span><span class="p">(</span><span class="n">back_edge_tail</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">cfg_preds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the natural loop for a back edge tail -&gt; header.</span>

<span class="sd">    Returns: set of nodes in the loop (including header)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="p">{</span><span class="n">header</span><span class="p">}</span>
    <span class="n">worklist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">back_edge_tail</span> <span class="o">!=</span> <span class="n">header</span><span class="p">:</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">back_edge_tail</span><span class="p">)</span>
        <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">back_edge_tail</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">cfg_preds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">pred</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
                <span class="n">loop</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
                <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">loop</span>
</code></pre></div>

<p><strong>ì˜ˆì‹œ -- CFGì—ì„œ ë£¨í”„ ê°ì§€</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example CFG with two loops</span>
<span class="c1">#</span>
<span class="c1">#  entry -&gt; A -&gt; B -&gt; C -&gt; D -&gt; exit</span>
<span class="c1">#                ^    |</span>
<span class="c1">#                |    v</span>
<span class="c1">#                +--- E</span>
<span class="c1">#           and D -&gt; B (outer loop)</span>

<span class="n">cfg_succs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">],</span>  <span class="c1"># D-&gt;B is a back edge (B dom D)</span>
    <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span>           <span class="c1"># E-&gt;B is a back edge (B dom E)</span>
    <span class="s1">&#39;exit&#39;</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">}</span>

<span class="n">cfg_preds</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">],</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;exit&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># After computing dominators, we find:</span>
<span class="c1"># Back edges: (D, B) and (E, B)</span>
<span class="c1"># Natural loop for D-&gt;B: {B, C, D, E}</span>
<span class="c1"># Natural loop for E-&gt;B: {B, C, E}</span>
</code></pre></div>

<h3 id="33">3.3 ë£¨í”„ ì¤‘ì²©ê³¼ ë£¨í”„ íŠ¸ë¦¬<a class="header-link" href="#33" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ëŠ” ì¤‘ì²©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <strong>ë£¨í”„ íŠ¸ë¦¬(loop tree)</strong> (ë˜ëŠ” <strong>ë£¨í”„ í¬ë ˆìŠ¤íŠ¸</strong>)ëŠ” ë£¨í”„ë¥¼ ì¤‘ì²©ìœ¼ë¡œ êµ¬ì„±í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">Loop</span><span class="w"> </span><span class="n">Tree</span><span class="o">:</span>
<span class="w">  </span><span class="n">Function</span>
<span class="w">  </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">Loop</span><span class="w"> </span><span class="n">L1</span><span class="w"> </span><span class="p">(</span><span class="n">header</span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">})</span>
<span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">Loop</span><span class="w"> </span><span class="n">L2</span><span class="w"> </span><span class="p">(</span><span class="n">header</span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">})</span><span class="w">  </span><span class="p">[</span><span class="n">inner</span><span class="w"> </span><span class="n">loop</span><span class="p">]</span>
<span class="w">  </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">top</span><span class="o">-</span><span class="n">level</span><span class="w"> </span><span class="n">loops</span><span class="p">)</span>
</code></pre></div>

<p>ë‘ ë£¨í”„ê°€ í—¤ë”ë¥¼ ê³µìœ í•˜ë©´, ë³¸ë¬¸ì´ ê²¹ì¹˜ëŠ” ê²½ìš° í•˜ë‚˜ì˜ ë£¨í”„ë¡œ ë³‘í•©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Loop</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a natural loop in the CFG.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">back_edges</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>           <span class="c1"># Set of nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">back_edges</span> <span class="o">=</span> <span class="n">back_edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>         <span class="c1"># Enclosing loop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>         <span class="c1"># Nested loops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>             <span class="c1"># Nesting depth (0 = outermost)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Loop(header=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="si">}</span><span class="s2">, body=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="s2">, depth=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">build_loop_tree</span><span class="p">(</span><span class="n">loops</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a loop nesting tree from a list of loops.</span>

<span class="sd">    Loops are sorted by body size; smaller loops are children of larger ones.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sorted_loops</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">loops</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">body</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">inner</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_loops</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">outer</span> <span class="ow">in</span> <span class="n">sorted_loops</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">inner</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">outer</span><span class="o">.</span><span class="n">body</span><span class="p">):</span>
                <span class="n">inner</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">outer</span>
                <span class="n">outer</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="c1"># Compute depths</span>
    <span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="n">sorted_loops</span><span class="p">:</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">loop</span>
        <span class="k">while</span> <span class="n">current</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>

    <span class="c1"># Return top-level loops (those with no parent)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">sorted_loops</span> <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</code></pre></div>

<h3 id="34-preheader">3.4 í”„ë¦¬í—¤ë”(Preheader) ì‚½ì…<a class="header-link" href="#34-preheader" title="Permanent link">&para;</a></h3>
<p>ë§ì€ ë£¨í”„ ìµœì í™”ëŠ” ë£¨í”„ ì§ì „ì— ì •í™•íˆ í•œ ë²ˆ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ëŠ” ì½”ë“œë¥¼ ë„£ì„ ìœ„ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. <strong>í”„ë¦¬í—¤ë”(preheader)</strong>ëŠ” ë£¨í”„ì˜ ë¹„í›„ë°© ì—£ì§€(non-back-edge) ì„ í–‰ ë¸”ë¡ê³¼ í—¤ë” ì‚¬ì´ì— ì‚½ì…ë˜ëŠ” ì „ìš© ë¸”ë¡ì…ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">Before</span><span class="o">:</span><span class="w">                       </span><span class="n">After</span><span class="o">:</span>

<span class="w">  </span><span class="n">A</span><span class="w"> </span><span class="err">â”€â”€â”</span><span class="w">                        </span><span class="n">A</span><span class="w"> </span><span class="err">â”€â”€â”</span>
<span class="w">       </span><span class="err">â”œâ”€â”€â–¶</span><span class="w"> </span><span class="n">Header</span><span class="w">                  </span><span class="err">â”œâ”€â”€â–¶</span><span class="w"> </span><span class="n">Preheader</span><span class="w"> </span><span class="err">â”€â”€â–¶</span><span class="w"> </span><span class="n">Header</span>
<span class="w">  </span><span class="n">B</span><span class="w"> </span><span class="err">â”€â”€â”˜</span><span class="w">     </span><span class="err">â–²</span><span class="w">                  </span><span class="n">B</span><span class="w"> </span><span class="err">â”€â”€â”˜</span><span class="w">                   </span><span class="err">â–²</span>
<span class="w">             </span><span class="err">â”‚</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="w">         </span><span class="n">back</span><span class="w"> </span><span class="n">edge</span><span class="w">                                  </span><span class="n">back</span><span class="w"> </span><span class="n">edge</span>
<span class="w">             </span><span class="err">â”‚</span><span class="w">                                          </span><span class="err">â”‚</span>
<span class="w">           </span><span class="n">Latch</span><span class="w">                                      </span><span class="n">Latch</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">insert_preheader</span><span class="p">(</span><span class="n">cfg_preds</span><span class="p">,</span> <span class="n">cfg_succs</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">loop_body</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert a preheader block for a loop.</span>

<span class="sd">    Modifies cfg_preds and cfg_succs in place.</span>
<span class="sd">    Returns the name of the new preheader node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preheader</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pre_</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Find non-back-edge predecessors of header</span>
    <span class="n">external_preds</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cfg_preds</span><span class="p">[</span><span class="n">header</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loop_body</span><span class="p">]</span>

    <span class="c1"># Redirect external predecessors to preheader</span>
    <span class="n">cfg_preds</span><span class="p">[</span><span class="n">preheader</span><span class="p">]</span> <span class="o">=</span> <span class="n">external_preds</span>
    <span class="n">cfg_succs</span><span class="p">[</span><span class="n">preheader</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>

    <span class="c1"># Update header&#39;s predecessors</span>
    <span class="n">cfg_preds</span><span class="p">[</span><span class="n">header</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cfg_preds</span><span class="p">[</span><span class="n">header</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">loop_body</span><span class="p">]</span>
    <span class="n">cfg_preds</span><span class="p">[</span><span class="n">header</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preheader</span><span class="p">)</span>

    <span class="c1"># Update external predecessors&#39; successors</span>
    <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">external_preds</span><span class="p">:</span>
        <span class="n">cfg_succs</span><span class="p">[</span><span class="n">pred</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">preheader</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">header</span> <span class="k">else</span> <span class="n">s</span>
                           <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cfg_succs</span><span class="p">[</span><span class="n">pred</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">preheader</span>
</code></pre></div>

<hr />
<h2 id="4-licm">4. ë£¨í”„ ë¶ˆë³€ ì½”ë“œ ì´ë™ (LICM)<a class="header-link" href="#4-licm" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 ë£¨í”„ ë¶ˆë³€ ê³„ì‚° ì‹ë³„<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ ë‚´ë¶€ì˜ ê³„ì‚°ì´ ë°˜ë³µ ê°„ì— ê²°ê³¼ê°€ ë³€í•˜ì§€ ì•Šìœ¼ë©´ <strong>ë£¨í”„ ë¶ˆë³€(loop-invariant)</strong>ì´ë¼ê³  í•©ë‹ˆë‹¤. í˜•ì‹ì ìœ¼ë¡œ, ëª…ë ¹ì–´ <code>x = op(a, b)</code>ëŠ” ë‹¤ìŒ ê²½ìš° ë£¨í”„ ë¶ˆë³€ì…ë‹ˆë‹¤:</p>
<ol>
<li>ëª¨ë“  í”¼ì—°ì‚°ìê°€ ìƒìˆ˜ì¸ ê²½ìš°, ë˜ëŠ”</li>
<li>ê° í”¼ì—°ì‚°ìì˜ ì´ ëª…ë ¹ì–´ì— ë„ë‹¬í•˜ëŠ” ëª¨ë“  ì •ì˜ê°€ ë£¨í”„ ì™¸ë¶€ì— ìˆëŠ” ê²½ìš°, ë˜ëŠ”</li>
<li>ê° í”¼ì—°ì‚°ìì— ëŒ€í•´ ì •í™•íˆ í•˜ë‚˜ì˜ ë„ë‹¬ ì •ì˜ê°€ ìˆê³ , ê·¸ ì •ì˜ ìì²´ê°€ ë£¨í”„ ë¶ˆë³€ì¸ ê²½ìš°</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_loop_invariant_instructions</span><span class="p">(</span><span class="n">loop_body</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">reaching_defs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all loop-invariant instructions.</span>

<span class="sd">    loop_body: set of basic blocks in the loop</span>
<span class="sd">    instructions: dict block -&gt; list of (target, op, operands)</span>
<span class="sd">    reaching_defs: dict (block, var) -&gt; set of defining blocks</span>

<span class="sd">    Returns: set of loop-invariant instructions (block, index)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Collect all variables defined inside the loop</span>
    <span class="n">loop_defs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">loop_body</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">operands</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="p">[])):</span>
            <span class="n">loop_defs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="n">invariant</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">loop_body</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">operands</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="p">[])):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="n">invariant</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Check if all operands are loop-invariant</span>
                <span class="n">all_invariant</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">operand</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loop_defs</span><span class="p">:</span>
                        <span class="c1"># Defined outside the loop -- invariant</span>
                        <span class="k">continue</span>

                    <span class="c1"># Check if operand has a single reaching def that is invariant</span>
                    <span class="n">defs</span> <span class="o">=</span> <span class="n">reaching_defs</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">block</span><span class="p">,</span> <span class="n">operand</span><span class="p">),</span> <span class="nb">set</span><span class="p">())</span>
                    <span class="n">loop_local_defs</span> <span class="o">=</span> <span class="n">defs</span> <span class="o">&amp;</span> <span class="n">loop_body</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">loop_local_defs</span><span class="p">:</span>
                        <span class="k">continue</span>  <span class="c1"># All defs outside loop</span>

                    <span class="c1"># Must have exactly one loop-local def, and it must be invariant</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop_local_defs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">all_invariant</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>

                    <span class="n">def_block</span> <span class="o">=</span> <span class="n">loop_local_defs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="c1"># Find the instruction index in def_block</span>
                    <span class="n">found_invariant</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">di</span><span class="p">,</span> <span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">def_block</span><span class="p">,</span> <span class="p">[])):</span>
                        <span class="k">if</span> <span class="n">dt</span> <span class="o">==</span> <span class="n">operand</span> <span class="ow">and</span> <span class="p">(</span><span class="n">def_block</span><span class="p">,</span> <span class="n">di</span><span class="p">)</span> <span class="ow">in</span> <span class="n">invariant</span><span class="p">:</span>
                            <span class="n">found_invariant</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_invariant</span><span class="p">:</span>
                        <span class="n">all_invariant</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">all_invariant</span><span class="p">:</span>
                    <span class="n">invariant</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">block</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">invariant</span>
</code></pre></div>

<h3 id="42">4.2 ì•ˆì „í•œ ì½”ë“œ ì´ë™ ì¡°ê±´<a class="header-link" href="#42" title="Permanent link">&para;</a></h3>
<p>ëª¨ë“  ë£¨í”„ ë¶ˆë³€ ëª…ë ¹ì–´ë¥¼ í”„ë¦¬í—¤ë”ë¡œ ì•ˆì „í•˜ê²Œ ì´ë™í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ëª…ë ¹ì–´ <code>s: x = op(a, b)</code>ëŠ” ë‹¤ìŒ ê²½ìš° ëŒì–´ì˜¬ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<ol>
<li><strong>ì§€ë°° ì¡°ê±´</strong>: $s$ë¥¼ í¬í•¨í•˜ëŠ” ë¸”ë¡ì´ ë£¨í”„ì˜ ëª¨ë“  ì¶œêµ¬ë¥¼ ì§€ë°°í•©ë‹ˆë‹¤ (ëª…ë ¹ì–´ê°€ ì¶œêµ¬ì— ë„ë‹¬í•˜ëŠ” ëª¨ë“  ë°˜ë³µì—ì„œ ì‹¤í–‰ë˜ì—ˆì„ ê²ƒì…ë‹ˆë‹¤).</li>
<li><strong>ìœ ì¼ì„± ì¡°ê±´</strong>: ë£¨í”„ ë‚´ì— $x$ì˜ ë‹¤ë¥¸ ì •ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
<li><strong>í™œì„±ì„± ì¡°ê±´</strong>: ë³€ìˆ˜ $x$ê°€ ë£¨í”„ ë‚´ $x$ì˜ ì–´ë–¤ ì •ì˜ì—ì„œë„ í™œì„±ì´ ì•„ë‹™ë‹ˆë‹¤ (ë‹¤ë¥¸ ì •ì˜ $x$ì˜ ë‹¤ë¥¸ ì‚¬ìš© ì—†ìŒ).</li>
</ol>
<p>ëŒ€ì•ˆìœ¼ë¡œ, ëª…ë ¹ì–´ì— ë¶€ì‘ìš©ì´ ì—†ê³  ê·¸ ê²°ê³¼ê°€ ë£¨í”„ ë‚´ì—ì„œë§Œ ì‚¬ìš©ëœë‹¤ë©´ í•­ìƒ íˆ¬ê¸°ì ìœ¼ë¡œ ëŒì–´ì˜¬ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ìµœì•…ì˜ ê²½ìš° ë¯¸ì‚¬ìš© ê³„ì‚°ì„ í•©ë‹ˆë‹¤).</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">can_hoist</span><span class="p">(</span><span class="n">instr_block</span><span class="p">,</span> <span class="n">instr_target</span><span class="p">,</span> <span class="n">loop_body</span><span class="p">,</span> <span class="n">loop_exits</span><span class="p">,</span> <span class="n">dom_sets</span><span class="p">,</span>
              <span class="n">all_defs_in_loop</span><span class="p">,</span> <span class="n">live_at_defs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a loop-invariant instruction can be safely hoisted.</span>

<span class="sd">    instr_block: the block containing the instruction</span>
<span class="sd">    instr_target: the variable being defined</span>
<span class="sd">    loop_body: set of blocks in the loop</span>
<span class="sd">    loop_exits: set of blocks that are loop exits</span>
<span class="sd">    dom_sets: dict block -&gt; set of blocks it dominates</span>
<span class="sd">    all_defs_in_loop: dict variable -&gt; set of defining blocks in loop</span>
<span class="sd">    live_at_defs: dict (block, variable) -&gt; bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Condition 1: Block dominates all loop exits</span>
    <span class="k">for</span> <span class="n">exit_block</span> <span class="ow">in</span> <span class="n">loop_exits</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exit_block</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dom_sets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instr_block</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Condition 2: Unique definition in loop</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_defs_in_loop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instr_target</span><span class="p">,</span> <span class="nb">set</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Condition 3: No interference with other defs</span>
    <span class="k">for</span> <span class="n">def_block</span> <span class="ow">in</span> <span class="n">all_defs_in_loop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instr_target</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">def_block</span> <span class="o">!=</span> <span class="n">instr_block</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">live_at_defs</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">def_block</span><span class="p">,</span> <span class="n">instr_target</span><span class="p">),</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>

<h3 id="43-licm">4.3 ì‹¤ì œ LICM<a class="header-link" href="#43-licm" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì€ ê°„ë‹¨í•œ ë£¨í”„ì—ì„œ LICMì„ ì‹œì—°í•˜ëŠ” ì™„ì „í•œ ì˜ˆì‹œì…ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimpleInstruction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a three-address instruction.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">operands</span><span class="p">,</span> <span class="n">is_side_effect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">op</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operands</span> <span class="o">=</span> <span class="n">operands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_side_effect</span> <span class="o">=</span> <span class="n">is_side_effect</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;copy&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_licm</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstrate LICM on a simple loop.</span>

<span class="sd">    Original code:</span>
<span class="sd">        i = 0</span>
<span class="sd">        while i &lt; n:</span>
<span class="sd">            x = a * b        # invariant</span>
<span class="sd">            y = x + c        # invariant (depends on x which is invariant)</span>
<span class="sd">            arr[i] = y + i</span>
<span class="sd">            i = i + 1</span>

<span class="sd">    After LICM:</span>
<span class="sd">        x = a * b            # hoisted</span>
<span class="sd">        y = x + c            # hoisted</span>
<span class="sd">        i = 0</span>
<span class="sd">        while i &lt; n:</span>
<span class="sd">            arr[i] = y + i</span>
<span class="sd">            i = i + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Before LICM ===&quot;</span><span class="p">)</span>
    <span class="n">preheader</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">SimpleInstruction</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]),</span>
    <span class="p">]</span>
    <span class="n">loop_body</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">SimpleInstruction</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]),</span>
        <span class="n">SimpleInstruction</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]),</span>
        <span class="n">SimpleInstruction</span><span class="p">(</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">]),</span>
        <span class="n">SimpleInstruction</span><span class="p">(</span><span class="s1">&#39;arr[i]&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]),</span>
        <span class="n">SimpleInstruction</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]),</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preheader:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">preheader</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loop body:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">loop_body</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Identify invariant instructions</span>
    <span class="c1"># x = a * b  -- a, b not defined in loop -&gt; invariant</span>
    <span class="c1"># y = x + c  -- x is invariant, c not defined in loop -&gt; invariant</span>
    <span class="c1"># t1, arr[i], i are NOT invariant (depend on i which changes)</span>

    <span class="n">hoisted</span> <span class="o">=</span> <span class="p">[</span><span class="n">loop_body</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loop_body</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">remaining</span> <span class="o">=</span> <span class="n">loop_body</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== After LICM ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preheader:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">preheader</span> <span class="o">+</span> <span class="n">hoisted</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loop body:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">remaining</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_licm</span><span class="p">()</span>
</code></pre></div>

<p>ì¶œë ¥:</p>
<div class="highlight"><pre><span></span><code><span class="o">===</span><span class="w"> </span><span class="k">Before</span><span class="w"> </span><span class="n">LICM</span><span class="w"> </span><span class="o">===</span>
<span class="nl">Preheader</span><span class="p">:</span>
<span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="n">Loop</span><span class="w"> </span><span class="nl">body</span><span class="p">:</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span>
<span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span>
<span class="w">  </span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span>
<span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="o">===</span><span class="w"> </span><span class="k">After</span><span class="w"> </span><span class="n">LICM</span><span class="w"> </span><span class="o">===</span>
<span class="nl">Preheader</span><span class="p">:</span>
<span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span>
<span class="n">Loop</span><span class="w"> </span><span class="nl">body</span><span class="p">:</span>
<span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span>
<span class="w">  </span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span>
<span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>

<hr />
<h2 id="5">5. ê·€ë‚© ë³€ìˆ˜ ë¶„ì„<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51-basic-induction-variables">5.1 ê¸°ë³¸ ê·€ë‚© ë³€ìˆ˜(Basic Induction Variables)<a class="header-link" href="#51-basic-induction-variables" title="Permanent link">&para;</a></h3>
<p><strong>ê¸°ë³¸ ê·€ë‚© ë³€ìˆ˜(basic induction variable, BIV)</strong>ëŠ” ë£¨í”„ ë‚´ë¶€ì—ì„œì˜ ìœ ì¼í•œ ì •ì˜ê°€ ë‹¤ìŒ í˜•ì‹ì¸ ë³€ìˆ˜ $i$ì…ë‹ˆë‹¤:</p>
<p>$$i = i + c \quad \text{or} \quad i = i - c$$</p>
<p>ì—¬ê¸°ì„œ $c$ëŠ” ë£¨í”„ ë¶ˆë³€ ì–‘ì…ë‹ˆë‹¤. ì „í˜•ì ì¸ ì˜ˆëŠ” ë£¨í”„ ì¹´ìš´í„°ì…ë‹ˆë‹¤.</p>
<h3 id="52-derived-induction-variables">5.2 íŒŒìƒ ê·€ë‚© ë³€ìˆ˜(Derived Induction Variables)<a class="header-link" href="#52-derived-induction-variables" title="Permanent link">&para;</a></h3>
<p><strong>íŒŒìƒ ê·€ë‚© ë³€ìˆ˜(derived induction variable, DIV)</strong> $j$ëŠ” ê¸°ë³¸ ê·€ë‚© ë³€ìˆ˜ì˜ ì„ í˜• í•¨ìˆ˜ë¡œ ì •ì˜ë˜ëŠ” ë³€ìˆ˜ì…ë‹ˆë‹¤:</p>
<p>$$j = a \cdot i + b$$</p>
<p>ì—¬ê¸°ì„œ $a$ì™€ $b$ëŠ” ë£¨í”„ ë¶ˆë³€ì…ë‹ˆë‹¤. <strong>ê·€ë‚© ì‚¼ì¤‘ìŒ(induction triple)</strong>ì„ $(i, a, b)$ë¡œ í‘œê¸°í•˜ë©°, ì´ëŠ” $j = a \cdot i + b$ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">InductionVariable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an induction variable as a triple (base_iv, multiplier, offset).&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">base_iv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_iv</span> <span class="o">=</span> <span class="n">base_iv</span> <span class="ow">or</span> <span class="n">name</span>  <span class="c1"># Basic IV it derives from</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">multiplier</span>     <span class="c1"># a in j = a*i + b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>             <span class="c1"># b in j = a*i + b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_basic</span> <span class="o">=</span> <span class="p">(</span><span class="n">base_iv</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">base_iv</span> <span class="o">==</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">value_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the value of this IV when the base IV has value i_value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">i_value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_basic</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;BIV(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DIV(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span><span class="si">}</span><span class="s2">*</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_iv</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">detect_induction_variables</span><span class="p">(</span><span class="n">loop_instructions</span><span class="p">,</span> <span class="n">loop_invariants</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect basic and derived induction variables in a loop.</span>

<span class="sd">    loop_instructions: list of (target, op, operands)</span>
<span class="sd">    loop_invariants: set of variable names that are loop-invariant</span>

<span class="sd">    Returns: dict name -&gt; InductionVariable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Phase 1: Find basic induction variables</span>
    <span class="c1"># A variable i is a BIV if its only definition is i = i +/- c (c invariant)</span>
    <span class="n">definitions</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># var -&gt; list of (op, operands)</span>
    <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">operands</span> <span class="ow">in</span> <span class="n">loop_instructions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">definitions</span><span class="p">:</span>
            <span class="n">definitions</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">definitions</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">op</span><span class="p">,</span> <span class="n">operands</span><span class="p">))</span>

    <span class="n">bivs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">defs</span> <span class="ow">in</span> <span class="n">definitions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">op</span><span class="p">,</span> <span class="n">operands</span> <span class="o">=</span> <span class="n">defs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">operands</span> <span class="k">if</span> <span class="n">o</span> <span class="o">!=</span> <span class="n">var</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loop_invariants</span> <span class="ow">or</span>
                                         <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">bivs</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">InductionVariable</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">bivs</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>

    <span class="c1"># Phase 2: Find derived induction variables</span>
    <span class="c1"># j = a * i + b where i is BIV and a, b are loop-invariant</span>
    <span class="n">divs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">operands</span> <span class="ow">in</span> <span class="n">loop_instructions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">bivs</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="c1"># Check if one operand is a BIV and the other is invariant</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">operands</span><span class="p">):</span>
                <span class="n">other_idx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">bivs</span> <span class="ow">and</span> <span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="n">other_idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loop_invariants</span> <span class="ow">or</span>
                                   <span class="n">operands</span><span class="p">[</span><span class="n">other_idx</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
                    <span class="n">mult</span> <span class="o">=</span> <span class="n">operands</span><span class="p">[</span><span class="n">other_idx</span><span class="p">]</span>
                    <span class="n">divs</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">InductionVariable</span><span class="p">(</span>
                        <span class="n">target</span><span class="p">,</span> <span class="n">base_iv</span><span class="o">=</span><span class="n">o</span><span class="p">,</span>
                        <span class="n">multiplier</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mult</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span>
                    <span class="p">)</span>

        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
            <span class="c1"># Check if one operand is a DIV/BIV and the other is invariant</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">operands</span><span class="p">):</span>
                <span class="n">other_idx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">bivs</span> <span class="ow">and</span> <span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="n">other_idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loop_invariants</span> <span class="ow">or</span>
                                   <span class="n">operands</span><span class="p">[</span><span class="n">other_idx</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
                    <span class="n">off</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">operands</span><span class="p">[</span><span class="n">other_idx</span><span class="p">])</span>
                    <span class="n">divs</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">InductionVariable</span><span class="p">(</span>
                        <span class="n">target</span><span class="p">,</span> <span class="n">base_iv</span><span class="o">=</span><span class="n">o</span><span class="p">,</span>
                        <span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">off</span>
                    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bivs</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">divs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># Example</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Induction Variable Detection ===&quot;</span><span class="p">)</span>
<span class="n">instructions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]),</span>        <span class="c1"># i = i + 1  (BIV)</span>
    <span class="p">(</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">]),</span>       <span class="c1"># t1 = 4*i   (DIV: base=i, mult=4, off=0)</span>
    <span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">]),</span>   <span class="c1"># t2 = t1 + base (not simple IV -- base is invariant</span>
                                   <span class="c1">#   but t1 is a DIV, so t2 = 4*i + base)</span>
    <span class="p">(</span><span class="s1">&#39;arr_t2&#39;</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]),</span>    <span class="c1"># memory load</span>
<span class="p">]</span>

<span class="n">invariants</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>

<span class="n">ivs</span> <span class="o">=</span> <span class="n">detect_induction_variables</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">invariants</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">iv</span> <span class="ow">in</span> <span class="n">ivs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">iv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6">6. ê°•ë„ ê°ì†Œ<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61">6.1 ì•„ì´ë””ì–´<a class="header-link" href="#61" title="Permanent link">&para;</a></h3>
<p>ê°•ë„ ê°ì†Œ(strength reduction)ëŠ” ê·€ë‚© ë³€ìˆ˜ì˜ ê·œì¹™ì ì¸ ì§„í–‰ì„ ì´ìš©í•˜ì—¬ ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì—°ì‚° (ê³±ì…ˆ ë“±)ì„ ë” ì €ë ´í•œ ì—°ì‚° (ë§ì…ˆ ë“±)ìœ¼ë¡œ êµì²´í•©ë‹ˆë‹¤.</p>
<p>$j = a \cdot i + b$ì´ê³  $i$ê°€ ê° ë°˜ë³µì—ì„œ $s$ì”© ì¦ê°€í•˜ë©´:</p>
<p>$$j_{\text{new}} = j_{\text{old}} + a \cdot s$$</p>
<p>ë§¤ ë°˜ë³µë§ˆë‹¤ $a \cdot i$ë¥¼ ê³„ì‚°í•˜ëŠ” ëŒ€ì‹ , $j = j + a \cdot s$ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤ -- ê³±ì…ˆì„ ë§ì…ˆìœ¼ë¡œ êµì²´.</p>
<h3 id="62-allen-cocke-kennedy">6.2 Allen-Cocke-Kennedy ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#62-allen-cocke-kennedy" title="Permanent link">&para;</a></h3>
<p>ê³ ì „ì ì¸ ê°•ë„ ê°ì†Œ ì•Œê³ ë¦¬ì¦˜ì€ ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤:</p>
<ol>
<li>ëª¨ë“  ê¸°ë³¸ ê·€ë‚© ë³€ìˆ˜ì™€ ê·¸ ë‹¨ê³„(step) ì°¾ê¸°</li>
<li>ëª¨ë“  íŒŒìƒ ê·€ë‚© ë³€ìˆ˜ ì°¾ê¸°</li>
<li>ê° DIV $j = a \cdot i + b$ì— ëŒ€í•´:</li>
<li>ìƒˆ ë³€ìˆ˜ $j'$ ìƒì„±</li>
<li>í”„ë¦¬í—¤ë”ì—ì„œ $j' = a \cdot i_0 + b$ ì´ˆê¸°í™”</li>
<li>$i$ê°€ $s$ì”© ì¦ê°€í•  ë•Œë§ˆë‹¤ $j' = j' + a \cdot s$ ì¶”ê°€</li>
<li>$j$ì˜ ì‚¬ìš©ì„ $j'$ë¡œ êµì²´</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">strength_reduce</span><span class="p">(</span><span class="n">loop_code</span><span class="p">,</span> <span class="n">preheader_code</span><span class="p">,</span> <span class="n">bivs</span><span class="p">,</span> <span class="n">divs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply strength reduction to derived induction variables.</span>

<span class="sd">    Demonstrates the transformation on a simple example.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Before Strength Reduction ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preheader:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">preheader_code</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loop body:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">loop_code</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">new_preheader</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">preheader_code</span><span class="p">)</span>
    <span class="n">new_loop</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># For each derived IV, create strength-reduced version</span>
    <span class="n">reduced</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># original var -&gt; new var</span>

    <span class="k">for</span> <span class="n">div_name</span><span class="p">,</span> <span class="n">div_info</span> <span class="ow">in</span> <span class="n">divs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">div_info</span><span class="p">[</span><span class="s1">&#39;base_iv&#39;</span><span class="p">]</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">div_info</span><span class="p">[</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">div_info</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">bivs</span><span class="p">[</span><span class="n">base</span><span class="p">][</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>

        <span class="n">new_var</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">div_name</span><span class="si">}</span><span class="s2">_sr&quot;</span>
        <span class="n">reduced</span><span class="p">[</span><span class="n">div_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_var</span>

        <span class="c1"># Initialize in preheader: new_var = mult * base_init + offset</span>
        <span class="n">init_val</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">*</span> <span class="n">bivs</span><span class="p">[</span><span class="n">base</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="n">new_preheader</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_var</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">init_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Increment in loop: new_var = new_var + mult * step</span>
        <span class="n">increment</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">*</span> <span class="n">step</span>
        <span class="n">new_loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_var</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">new_var</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">increment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Copy non-reduced instructions</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">loop_code</span><span class="p">:</span>
        <span class="c1"># Replace references to reduced variables</span>
        <span class="n">replaced</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">orig</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">reduced</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orig</span><span class="si">}</span><span class="s2"> =&quot;</span><span class="p">):</span>
                <span class="n">replaced</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Skip original computation</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">orig</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replaced</span><span class="p">:</span>
            <span class="n">new_loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== After Strength Reduction ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preheader:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">new_preheader</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loop body:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">new_loop</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># Example: Array indexing</span>
<span class="c1">#   for i in range(n):</span>
<span class="c1">#       addr = base + i * 4    # addr is a DIV of i</span>
<span class="c1">#       arr[addr] = 0</span>

<span class="n">strength_reduce</span><span class="p">(</span>
    <span class="n">loop_code</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;t1 = i * 4&quot;</span><span class="p">,</span>          <span class="c1"># DIV: t1 = 4*i</span>
        <span class="s2">&quot;addr = t1 + base&quot;</span><span class="p">,</span>    <span class="c1"># addr = 4*i + base (also a DIV)</span>
        <span class="s2">&quot;store 0, addr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;i = i + 1&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">preheader_code</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;i = 0&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">bivs</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;i&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="n">divs</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;t1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;base_iv&#39;</span><span class="p">:</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<p>ì¶œë ¥:</p>
<div class="highlight"><pre><span></span><code><span class="o">==</span><span class="p">=</span><span class="w"> </span><span class="nx">Before</span><span class="w"> </span><span class="nx">Strength</span><span class="w"> </span><span class="nx">Reduction</span><span class="w"> </span><span class="o">==</span><span class="p">=</span>
<span class="nx">Preheader</span><span class="p">:</span>
<span class="w">  </span><span class="nx">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="nx">Loop</span><span class="w"> </span><span class="nx">body</span><span class="p">:</span>
<span class="w">  </span><span class="nx">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span>
<span class="w">  </span><span class="kd">addr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">t1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kd">base</span>
<span class="w">  </span><span class="nx">store</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kd">addr</span>
<span class="w">  </span><span class="nx">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="o">==</span><span class="p">=</span><span class="w"> </span><span class="nx">After</span><span class="w"> </span><span class="nx">Strength</span><span class="w"> </span><span class="nx">Reduction</span><span class="w"> </span><span class="o">==</span><span class="p">=</span>
<span class="nx">Preheader</span><span class="p">:</span>
<span class="w">  </span><span class="nx">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="nx">t1_sr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="nx">Loop</span><span class="w"> </span><span class="nx">body</span><span class="p">:</span>
<span class="w">  </span><span class="nx">t1_sr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">t1_sr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span>
<span class="w">  </span><span class="kd">addr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">t1_sr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kd">base</span>
<span class="w">  </span><span class="nx">store</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kd">addr</span>
<span class="w">  </span><span class="nx">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>

<p>ê³±ì…ˆ <code>i * 4</code>ê°€ ë§ì…ˆ <code>t1_sr + 4</code>ë¡œ êµì²´ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
<h3 id="63">6.3 ì„ í˜• í…ŒìŠ¤íŠ¸ êµì²´<a class="header-link" href="#63" title="Permanent link">&para;</a></h3>
<p>ê°•ë„ ê°ì†Œ í›„, ì›ë˜ ê¸°ë³¸ ê·€ë‚© ë³€ìˆ˜ê°€ ë£¨í”„ì˜ ì¶œêµ¬ í…ŒìŠ¤íŠ¸ì—ì„œë§Œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°•ë„ ê°ì†Œëœ ë³€ìˆ˜ì— ê¸°ë°˜í•œ í…ŒìŠ¤íŠ¸ë¡œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="err">ì´ì „</span><span class="o">:</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">loop</span><span class="w">     </span><span class="err">ì´í›„</span><span class="o">:</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">t1_sr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">loop</span>
</code></pre></div>

<p>ì´ë¥¼ í†µí•´ ì£½ì€ ì½”ë“œ ì œê±°ë¡œ ì›ë˜ BIVë¥¼ ì™„ì „íˆ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<hr />
<h2 id="7">7. ë£¨í”„ ì–¸ë¡¤ë§<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 ì™„ì „ ì–¸ë¡¤ë§<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<p>íŠ¸ë¦½ ì¹´ìš´íŠ¸(ë°˜ë³µ íšŸìˆ˜)ê°€ ì»´íŒŒì¼ ì‹œê°„ì— ì•Œë ¤ì ¸ ìˆê³  ì‘ìœ¼ë©´, ë£¨í”„ë¥¼ ìˆœì°¨ì  ì½”ë“œë¡œ ì™„ì „íˆ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_full_unrolling</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Full unrolling: replace loop with sequential statements.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Before Full Unrolling ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    sum = 0</span>
<span class="s2">    for i in range(4):</span>
<span class="s2">        sum += arr[i]</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== After Full Unrolling ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    sum = 0</span>
<span class="s2">    sum += arr[0]</span>
<span class="s2">    sum += arr[1]</span>
<span class="s2">    sum += arr[2]</span>
<span class="s2">    sum += arr[3]</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">demonstrate_full_unrolling</span><span class="p">()</span>
</code></pre></div>

<p>ì´ì :
- ë£¨í”„ ì˜¤ë²„í—¤ë“œ ì œê±° (ë¶„ê¸°, ì¹´ìš´í„° ì¦ê°€, ë¹„êµ)
- ì¶”ê°€ ìµœì í™” ê°€ëŠ¥ (ì¸ë±ìŠ¤ì— ëŒ€í•œ ìƒìˆ˜ í´ë”©, ëª…ë ¹ì–´ ìŠ¤ì¼€ì¤„ë§)</p>
<p>ë¹„ìš©:
- ì½”ë“œ í¬ê¸° ì¦ê°€
- ì‘ì€ ì•Œë ¤ì§„ íŠ¸ë¦½ ì¹´ìš´íŠ¸ì—ë§Œ ì‹¤ìš©ì </p>
<h3 id="72">7.2 ë¶€ë¶„ ì–¸ë¡¤ë§<a class="header-link" href="#72" title="Permanent link">&para;</a></h3>
<p>ë” ì¼ë°˜ì ìœ¼ë¡œ, ë£¨í”„ëŠ” ì¸ìˆ˜ $k$ë¡œ <strong>ë¶€ë¶„ì ìœ¼ë¡œ ì–¸ë¡¤ë§</strong>ë©ë‹ˆë‹¤: ìƒˆ ë£¨í”„ì˜ ê° ë°˜ë³µì´ $k$ë²ˆ ë°˜ë³µ ë¶„ëŸ‰ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
<p>íŠ¸ë¦½ ì¹´ìš´íŠ¸ $n$ê³¼ ì–¸ë¡¤ë§ ì¸ìˆ˜ $k$ì— ëŒ€í•œ ë£¨í”„:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_partial_unrolling</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partial unrolling by factor k.</span>

<span class="sd">    Original: for i in range(n): body(i)</span>
<span class="sd">    Unrolled:</span>
<span class="sd">        for i in range(0, n - n%k, k):</span>
<span class="sd">            body(i)</span>
<span class="sd">            body(i+1)</span>
<span class="sd">            body(i+2)</span>
<span class="sd">            body(i+3)</span>
<span class="sd">        # Cleanup loop for remainder</span>
<span class="sd">        for i in range(n - n%k, n):</span>
<span class="sd">            body(i)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Partial Unrolling (factor </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>

    <span class="c1"># Original loop</span>
    <span class="n">total_orig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iterations_orig</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">total_orig</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span>
        <span class="n">iterations_orig</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Unrolled loop</span>
    <span class="n">total_unrolled</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iterations_unrolled</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">main_limit</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">main_limit</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">total_unrolled</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span>
        <span class="n">total_unrolled</span> <span class="o">+=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">total_unrolled</span> <span class="o">+=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">total_unrolled</span> <span class="o">+=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">iterations_unrolled</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Cleanup</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">main_limit</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">total_unrolled</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span>
        <span class="n">iterations_unrolled</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original:  </span><span class="si">{</span><span class="n">iterations_orig</span><span class="si">}</span><span class="s2"> loop iterations, sum = </span><span class="si">{</span><span class="n">total_orig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrolled:  </span><span class="si">{</span><span class="n">iterations_unrolled</span><span class="si">}</span><span class="s2"> loop iterations, sum = </span><span class="si">{</span><span class="n">total_unrolled</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results match: </span><span class="si">{</span><span class="n">total_orig</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">total_unrolled</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Branch reduction: </span><span class="si">{</span><span class="n">iterations_orig</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">iterations_unrolled</span><span class="si">}</span><span class="s2"> fewer branches&quot;</span><span class="p">)</span>

<span class="n">demonstrate_partial_unrolling</span><span class="p">()</span>
</code></pre></div>

<h3 id="73">7.3 ì–¸ë¡¤ë§ê³¼ ì†Œí”„íŠ¸ì›¨ì–´ íŒŒì´í”„ë¼ì´ë‹<a class="header-link" href="#73" title="Permanent link">&para;</a></h3>
<p>ì–¸ë¡¤ë§ì€ <strong>ì†Œí”„íŠ¸ì›¨ì–´ íŒŒì´í”„ë¼ì´ë‹(software pipelining)</strong>ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤ -- ì„œë¡œ ë‹¤ë¥¸ ë°˜ë³µì˜ ì—°ì‚°ì„ ê²¹ì³ ì§€ì—°ì„ ìˆ¨ê¹ë‹ˆë‹¤. 3ì‚¬ì´í´ ê³±ì…ˆê³¼ 1ì‚¬ì´í´ ë§ì…ˆì„ ê°€ì§„ í”„ë¡œì„¸ì„œì—ì„œ:</p>
<div class="highlight"><pre><span></span><code><span class="n">Iteration</span><span class="o">:</span><span class="w">   </span><span class="n">Body</span><span class="w"> </span><span class="mi">1</span><span class="w">      </span><span class="n">Body</span><span class="w"> </span><span class="mi">2</span><span class="w">      </span><span class="n">Body</span><span class="w"> </span><span class="mi">3</span><span class="w">      </span><span class="n">Body</span><span class="w"> </span><span class="mi">4</span>
<span class="n">Cycle</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w">     </span><span class="n">MUL</span><span class="w"> </span><span class="n">a1</span><span class="w">      </span><span class="o">---</span><span class="w">         </span><span class="o">---</span><span class="w">         </span><span class="o">---</span>
<span class="n">Cycle</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w">     </span><span class="o">---</span><span class="w">          </span><span class="n">MUL</span><span class="w"> </span><span class="n">a2</span><span class="w">     </span><span class="o">---</span><span class="w">         </span><span class="o">---</span>
<span class="n">Cycle</span><span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w">     </span><span class="o">---</span><span class="w">          </span><span class="o">---</span><span class="w">         </span><span class="n">MUL</span><span class="w"> </span><span class="n">a3</span><span class="w">     </span><span class="o">---</span>
<span class="n">Cycle</span><span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w">     </span><span class="n">ADD</span><span class="w"> </span><span class="n">r1</span><span class="w">       </span><span class="o">---</span><span class="w">         </span><span class="o">---</span><span class="w">         </span><span class="n">MUL</span><span class="w"> </span><span class="n">a4</span>
<span class="n">Cycle</span><span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w">     </span><span class="o">---</span><span class="w">          </span><span class="n">ADD</span><span class="w"> </span><span class="n">r2</span><span class="w">     </span><span class="o">---</span><span class="w">         </span><span class="o">---</span>
<span class="o">...</span>
</code></pre></div>

<p>ì–¸ë¡¤ë§ ì—†ì´ëŠ” ê³±ì…ˆì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ë²„ë¸” (ìŠ¤í†¨)ì´ ë°œìƒí•©ë‹ˆë‹¤.</p>
<h3 id="74">7.4 êµ¬í˜„ ê³ ë ¤ ì‚¬í•­<a class="header-link" href="#74" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unroll_loop</span><span class="p">(</span><span class="n">original_body</span><span class="p">,</span> <span class="n">trip_count</span><span class="p">,</span> <span class="n">unroll_factor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate an unrolled loop.</span>

<span class="sd">    original_body: function(i) -&gt; list of instructions</span>
<span class="sd">    trip_count: number of iterations (may be symbolic)</span>
<span class="sd">    unroll_factor: k</span>

<span class="sd">    Returns: (main_loop, cleanup_loop)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trip_count</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">trip_count</span> <span class="o">&lt;=</span> <span class="n">unroll_factor</span><span class="p">:</span>
        <span class="c1"># Full unroll</span>
        <span class="n">full_body</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trip_count</span><span class="p">):</span>
            <span class="n">full_body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">original_body</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">full_body</span><span class="p">,</span> <span class="p">[]</span>

    <span class="c1"># Partial unroll</span>
    <span class="n">main_body</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unroll_factor</span><span class="p">):</span>
        <span class="n">main_body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">original_body</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;i+</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;i&quot;</span><span class="p">))</span>

    <span class="n">cleanup_body</span> <span class="o">=</span> <span class="n">original_body</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">main_body</span><span class="p">,</span> <span class="n">cleanup_body</span>


<span class="c1"># Decision heuristics</span>
<span class="k">def</span><span class="w"> </span><span class="nf">should_unroll</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">unroll_factor</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Heuristic: decide whether to unroll a loop.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Don&#39;t unroll loops with function calls (code bloat)</span>
    <span class="k">if</span> <span class="n">loop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;has_calls&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Don&#39;t unroll loops with many instructions (code bloat)</span>
    <span class="k">if</span> <span class="n">loop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;body_size&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Don&#39;t unroll deeply nested inner loops (already many iterations)</span>
    <span class="k">if</span> <span class="n">loop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nesting_depth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Unroll small inner loops</span>
    <span class="k">if</span> <span class="n">loop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_innermost&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">loop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;body_size&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>

<hr />
<h2 id="8">8. ë£¨í”„ ê²°í•©ê³¼ ë¶„ë¦¬<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="81-loop-fusion-jamming">8.1 ë£¨í”„ ê²°í•©(Loop Fusion, Jamming)<a class="header-link" href="#81-loop-fusion-jamming" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ ê²°í•©ì€ ë™ì¼í•œ ë°˜ë³µ ê³µê°„ì„ ê°€ì§„ ë‘ ì¸ì ‘ ë£¨í”„ë¥¼ í•˜ë‚˜ë¡œ ê²°í•©í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_loop_fusion</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show loop fusion combining two loops into one.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">1_000_000</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>

    <span class="c1"># Before fusion: two separate loops</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Before Fusion (Two Loops) ===&quot;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">time_separate</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time: </span><span class="si">{</span><span class="n">time_separate</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

    <span class="c1"># After fusion: one loop</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== After Fusion (Single Loop) ===&quot;</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">c2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">time_fused</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time: </span><span class="si">{</span><span class="n">time_fused</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speedup: </span><span class="si">{</span><span class="n">time_separate</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time_fused</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results correct: </span><span class="si">{</span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># demonstrate_loop_fusion()  # Uncomment to run</span>
</code></pre></div>

<p><strong>ê²°í•©ì˜ ì´ì </strong>:
- ë£¨í”„ ì˜¤ë²„í—¤ë“œ ê°ì†Œ (í•˜ë‚˜ì˜ ë£¨í”„ ëŒ€ì‹  ë‘ ê°œ)
- ë°ì´í„° ì§€ì—­ì„±(data locality) í–¥ìƒ (ë°°ì—´ <code>a</code>ì— ë‘ ë²ˆ ëŒ€ì‹  í•œ ë²ˆ ì ‘ê·¼)
- ì¶”ê°€ ìµœì í™” ê°€ëŠ¥ (ë³‘í•©ëœ ë³¸ë¬¸ì— ê±¸ì³ ê³µí†µ ë¶€ë¶„ì‹ ì œê±°)</p>
<p><strong>í•©ë²•ì„±(Legality)</strong>: ë‘ ë£¨í”„ ê°„ì— ê²°í•©ì„ ë°©í•´í•˜ëŠ” ë°ì´í„° ì˜ì¡´ì„±ì´ ì—†ì„ ë•Œ ê²°í•©ì€ í•©ë²•ì ì…ë‹ˆë‹¤. êµ¬ì²´ì ìœ¼ë¡œ, <strong>ê²°í•© ë°©ì§€ ì˜ì¡´ì„±(fusion-preventing dependency)</strong> -- ë£¨í”„ 2ì˜ ë°˜ë³µ $i$ì—ì„œ ìƒì„±ëœ ì›ì†Œë¥¼ ë£¨í”„ 1ì˜ ë°˜ë³µ $j > i$ì—ì„œ ì†Œë¹„í•˜ëŠ” ì˜ì¡´ì„± -- ì´ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤.</p>
<h3 id="82-loop-fission-distribution">8.2 ë£¨í”„ ë¶„ë¦¬(Loop Fission, Distribution)<a class="header-link" href="#82-loop-fission-distribution" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ ë¶„ë¦¬ëŠ” ê·¸ ë°˜ëŒ€ì…ë‹ˆë‹¤: í•˜ë‚˜ì˜ ë£¨í”„ë¥¼ ì—¬ëŸ¬ ë£¨í”„ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_loop_fission</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show loop fission splitting one loop into two.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Before Fission (Single Loop) ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    for i in range(n):</span>
<span class="s2">        b[i] = a[i] * 2        # Vectorizable</span>
<span class="s2">        c[i] = c[i-1] + b[i]   # Sequential dependency</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== After Fission (Two Loops) ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # Loop 1: vectorizable</span>
<span class="s2">    for i in range(n):</span>
<span class="s2">        b[i] = a[i] * 2</span>

<span class="s2">    # Loop 2: sequential</span>
<span class="s2">    for i in range(n):</span>
<span class="s2">        c[i] = c[i-1] + b[i]</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loop 1 can now be vectorized independently!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loop 2 carries a dependency that prevents vectorization.&quot;</span><span class="p">)</span>

<span class="n">demonstrate_loop_fission</span><span class="p">()</span>
</code></pre></div>

<p><strong>ë¶„ë¦¬ì˜ ì´ì </strong>:
- ë‹¤ë¥¸ ë¶€ë¶„ì— ì˜ì¡´ì„±ì´ ìˆì–´ë„ í•œ ë¶€ë¶„ì˜ ë²¡í„°í™” ê°€ëŠ¥
- ê° ë£¨í”„ê°€ ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„°ì— ì ‘ê·¼í•  ë•Œ ìºì‹œ ë™ì‘ ê°œì„ 
- ì¶”ê°€ ìµœì í™”ë¥¼ ìœ„í•œ ë¶„ì„ ë‹¨ìˆœí™”</p>
<hr />
<h2 id="9">9. ë£¨í”„ íƒ€ì¼ë§ (ë¸”ë¡œí‚¹)<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="91">9.1 ìºì‹œ ë¬¸ì œ<a class="header-link" href="#91" title="Permanent link">&para;</a></h3>
<p>í° 2D ë°°ì—´ì„ ì—´ ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•  ë•Œ, ë©”ëª¨ë¦¬ì—ì„œ ì¸ì ‘ ì ‘ê·¼ì´ ë©€ë¦¬ ë–¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤ (ìŠ¤íŠ¸ë¼ì´ë“œ $= n$, í–‰ í¬ê¸°). ì´ëŠ” <strong>ìºì‹œ ìŠ¤ë˜ì‹±(cache thrashing)</strong>ì„ ìœ ë°œí•©ë‹ˆë‹¤.</p>
<h3 id="92">9.2 íƒ€ì¼ë§ ë³€í™˜<a class="header-link" href="#92" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ íƒ€ì¼ë§ì€ ë°˜ë³µì„ ìºì‹œì— ë§ëŠ” ì‘ì€ ë¸”ë¡ ("íƒ€ì¼")ìœ¼ë¡œ ë¶„í• í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_loop_tiling</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstrate the effect of loop tiling on matrix multiplication.</span>

<span class="sd">    Standard: O(n^3) with poor cache behavior</span>
<span class="sd">    Tiled: O(n^3) same work, but much better cache locality</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Create matrices</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="c1"># Standard matrix multiply (ijk order)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Matrix Multiply </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">C1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
    <span class="n">time_standard</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard (ijk): </span><span class="si">{</span><span class="n">time_standard</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

    <span class="c1"># Tiled matrix multiply</span>
    <span class="n">TILE</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># Tile size -- should fit in L1 cache</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">TILE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">TILE</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">TILE</span><span class="p">):</span>
                <span class="c1"># Multiply tile</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="n">TILE</span><span class="p">,</span> <span class="n">n</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">jj</span> <span class="o">+</span> <span class="n">TILE</span><span class="p">,</span> <span class="n">n</span><span class="p">)):</span>
                        <span class="n">total</span> <span class="o">=</span> <span class="n">C2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">kk</span> <span class="o">+</span> <span class="n">TILE</span><span class="p">,</span> <span class="n">n</span><span class="p">)):</span>
                            <span class="n">total</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">C2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
    <span class="n">time_tiled</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tiled (tile=</span><span class="si">{</span><span class="n">TILE</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">time_tiled</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speedup: </span><span class="si">{</span><span class="n">time_standard</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time_tiled</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>

    <span class="c1"># Verify correctness</span>
    <span class="n">max_diff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">C1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">C2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max difference: </span><span class="si">{</span><span class="n">max_diff</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># demonstrate_loop_tiling(500)  # Uncomment to run (may take a while)</span>
</code></pre></div>

<h3 id="93">9.3 íƒ€ì¼ í¬ê¸° ì„ íƒ<a class="header-link" href="#93" title="Permanent link">&para;</a></h3>
<p>íƒ€ì¼ í¬ê¸° $T$ëŠ” ì‘ì—… ì§‘í•©(working set)ì´ ìºì‹œì— ë§ë„ë¡ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤. í–‰ë ¬ ê³±ì…ˆì—ì„œ ì ‘ê·¼ë˜ëŠ” $A$, $B$, $C$ì˜ íƒ€ì¼ì€ ê°ê° $T \times T$ì´ë¯€ë¡œ:</p>
<p>$$3 \cdot T^2 \cdot \text{sizeof(element)} \leq \text{L1 cache size}$$</p>
<p>8ë°”ì´íŠ¸ ë°°ì •ë°€ë„ ì‹¤ìˆ˜ì™€ 32 KBì˜ L1 ìºì‹œì—ì„œ:</p>
<p>$$T \leq \sqrt{\frac{32768}{3 \times 8}} = \sqrt{1365} \approx 36$$</p>
<p>ì¼ë°˜ì ì¸ ì„ íƒì€ $T = 32$ì…ë‹ˆë‹¤.</p>
<h3 id="94">9.4 ë‹¤ì¤‘ ìˆ˜ì¤€ íƒ€ì¼ë§<a class="header-link" href="#94" title="Permanent link">&para;</a></h3>
<p>ì—¬ëŸ¬ ìºì‹œ ìˆ˜ì¤€ (L1, L2, L3)ì´ ìˆëŠ” ë¨¸ì‹ ì—ì„œëŠ” ì—¬ëŸ¬ ìˆ˜ì¤€ì—ì„œ íƒ€ì¼ë§ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="nl">Original</span><span class="p">:</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="err">:</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="err">:</span>
<span class="w">          </span><span class="n">C</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="o">[</span><span class="n">k</span><span class="o">][</span><span class="n">j</span><span class="o">]</span>

<span class="n">Two</span><span class="o">-</span><span class="k">level</span><span class="w"> </span><span class="nl">tiled</span><span class="p">:</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="p">)</span><span class="err">:</span><span class="w">          </span><span class="err">#</span><span class="w"> </span><span class="n">L2</span><span class="w"> </span><span class="n">tile</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="p">)</span><span class="err">:</span>
<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="n">kk</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="p">)</span><span class="err">:</span>
<span class="w">              </span><span class="k">for</span><span class="w"> </span><span class="n">iii</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="o">+</span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="n">T1</span><span class="p">)</span><span class="err">:</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">L1</span><span class="w"> </span><span class="n">tile</span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="n">jjj</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="o">+</span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="n">T1</span><span class="p">)</span><span class="err">:</span>
<span class="w">                      </span><span class="k">for</span><span class="w"> </span><span class="n">kkk</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="w"> </span><span class="n">kk</span><span class="o">+</span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="n">T1</span><span class="p">)</span><span class="err">:</span>
<span class="w">                          </span><span class="err">#</span><span class="w"> </span><span class="n">Micro</span><span class="o">-</span><span class="n">kernel</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">T1</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">T1</span><span class="w"> </span><span class="n">tile</span>
<span class="w">                          </span><span class="p">...</span>
</code></pre></div>

<hr />
<h2 id="10">10. ë£¨í”„ êµí™˜<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="101">10.1 ë™ê¸°<a class="header-link" href="#101" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ êµí™˜(loop interchange)ì€ ì¤‘ì²© ë£¨í”„ì˜ ìˆœì„œë¥¼ ë°”ê¾¸ì–´ ë©”ëª¨ë¦¬ ì ‘ê·¼ íŒ¨í„´ì„ ê°œì„ í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_loop_interchange</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Show how loop interchange improves cache behavior.</span>

<span class="sd">    Row-major arrays: A[i][j] is stored next to A[i][j+1] in memory.</span>
<span class="sd">    Accessing A[i][j] with j as the inner loop gives stride-1 access (good).</span>
<span class="sd">    Accessing with i as the inner loop gives stride-n access (bad).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">2000</span>

    <span class="c1"># Create a 2D array (list of lists in Python, simulating row-major)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

    <span class="c1"># Bad order: column-major traversal (i inner, j outer)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Loop Interchange Demo (</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>          <span class="c1"># Outer</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>      <span class="c1"># Inner -- stride-n access to A[i][j]</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
    <span class="n">time_bad</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column-major (j outer, i inner): </span><span class="si">{</span><span class="n">time_bad</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

    <span class="c1"># Good order: row-major traversal (j inner, i outer)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>          <span class="c1"># Outer</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>      <span class="c1"># Inner -- stride-1 access to A[i][j]</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
    <span class="n">time_good</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Row-major (i outer, j inner): </span><span class="si">{</span><span class="n">time_good</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speedup: </span><span class="si">{</span><span class="n">time_bad</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time_good</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>

<span class="c1"># demonstrate_loop_interchange()  # Uncomment to run</span>
</code></pre></div>

<h3 id="102">10.2 ë£¨í”„ êµí™˜ì˜ í•©ë²•ì„±<a class="header-link" href="#102" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ êµí™˜ì€ ë°ì´í„° ì˜ì¡´ì„±ì„ ìœ„ë°˜í•˜ì§€ ì•Šì„ ë•Œë§Œ í•©ë²•ì ì…ë‹ˆë‹¤. ë£¨í”„ $i$ì™€ $j$ì— ëŒ€í•œ ê±°ë¦¬ ë²¡í„° $(d_1, d_2)$ë¥¼ ê°€ì§„ ì˜ì¡´ì„±ì´ ìˆì„ ë•Œ:</p>
<ul>
<li>êµí™˜ì€ ê²°ê³¼ ê±°ë¦¬ ë²¡í„° $(d_2, d_1)$ì´ <strong>ì‚¬ì „ ìˆœì„œìƒ ì–‘ìˆ˜(lexicographically positive)</strong> (ê°€ì¥ ì™¼ìª½ì˜ 0ì´ ì•„ë‹Œ ì„±ë¶„ì´ ì–‘ìˆ˜)ì´ë©´ í•©ë²•ì ì…ë‹ˆë‹¤.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">can_interchange</span><span class="p">(</span><span class="n">distance_vectors</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if loop interchange is legal given dependency distance vectors.</span>

<span class="sd">    A distance vector (d1, d2) becomes (d2, d1) after interchange.</span>
<span class="sd">    All resulting vectors must be lexicographically positive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="ow">in</span> <span class="n">distance_vectors</span><span class="p">:</span>
        <span class="c1"># After interchange: (d2, d1)</span>
        <span class="n">new_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">d1</span><span class="p">)</span>

        <span class="c1"># Check lexicographic positivity</span>
        <span class="k">if</span> <span class="n">new_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">new_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">new_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>


<span class="c1"># Examples</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dependency (1, 0):&quot;</span><span class="p">,</span> <span class="n">can_interchange</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]))</span>   <span class="c1"># True: becomes (0, 1)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dependency (0, 1):&quot;</span><span class="p">,</span> <span class="n">can_interchange</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]))</span>   <span class="c1"># True: becomes (1, 0)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dependency (1, -1):&quot;</span><span class="p">,</span> <span class="n">can_interchange</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]))</span> <span class="c1"># False: becomes (-1, 1)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dependency (1, 1):&quot;</span><span class="p">,</span> <span class="n">can_interchange</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]))</span>   <span class="c1"># True: becomes (1, 1)</span>
</code></pre></div>

<hr />
<h2 id="11">11. ë²¡í„°í™”<a class="header-link" href="#11" title="Permanent link">&para;</a></h2>
<h3 id="111-simd">11.1 SIMD ê°œìš”<a class="header-link" href="#111-simd" title="Permanent link">&para;</a></h3>
<p><strong>SIMD</strong>(Single Instruction, Multiple Data, ë‹¨ì¼ ëª…ë ¹ì–´ ë‹¤ì¤‘ ë°ì´í„°)ëŠ” ì—¬ëŸ¬ ë°ì´í„° ì›ì†Œë¥¼ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. í˜„ëŒ€ CPUì—ëŠ” í•œ ë²ˆì— 128, 256, ë˜ëŠ” 512ë¹„íŠ¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” SIMD ìœ ë‹› (x86ì˜ SSE, AVX, AVX-512; ARMì˜ NEON)ì´ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="n">Scalar</span><span class="o">:</span><span class="w">                    </span><span class="n">SIMD</span><span class="w"> </span><span class="o">(</span><span class="mi">4</span><span class="o">-</span><span class="n">wide</span><span class="o">):</span>
<span class="w">  </span><span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w">        </span><span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">4</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">4</span><span class="o">]</span>
<span class="w">  </span><span class="n">a</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w">        </span><span class="o">(</span><span class="n">single</span><span class="w"> </span><span class="n">instruction</span><span class="o">)</span>
<span class="w">  </span><span class="n">a</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
<span class="w">  </span><span class="n">a</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
<span class="w">  </span><span class="o">(</span><span class="mi">4</span><span class="w"> </span><span class="n">instructions</span><span class="o">)</span>
</code></pre></div>

<p>256ë¹„íŠ¸ AVXì™€ 32ë¹„íŠ¸ ë¶€ë™ ì†Œìˆ˜ì ì—ì„œ í•˜ë‚˜ì˜ ëª…ë ¹ì–´ê°€ $256 / 32 = 8$ê°œì˜ ì›ì†Œë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
<h3 id="112">11.2 ìë™ ë²¡í„°í™”<a class="header-link" href="#112" title="Permanent link">&para;</a></h3>
<p>ì»´íŒŒì¼ëŸ¬ëŠ” ë£¨í”„ë¥¼ ìë™ìœ¼ë¡œ ë²¡í„°í™”í•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤. í•µì‹¬ ìš”êµ¬ ì‚¬í•­ì€ <strong>ë£¨í”„ ì „ì´ ì˜ì¡´ì„±(loop-carried dependencies)ì´ ì—†ìŒ</strong> -- ê° ë°˜ë³µì´ ë…ë¦½ì ì´ì–´ì•¼ í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">vectorization_analysis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze loops for vectorizability.&quot;&quot;&quot;</span>

    <span class="n">examples</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Simple element-wise&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;c[i] = a[i] + b[i]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vectorizable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;No loop-carried dependency&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Reduction&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;sum += a[i]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vectorizable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Reduction pattern -- compiler uses horizontal add&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Prefix sum&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;a[i] = a[i-1] + b[i]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vectorizable&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Loop-carried dependency: a[i] depends on a[i-1]&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Conditional&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;if a[i] &gt; 0: b[i] = a[i]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vectorizable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Predicated execution with masking&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Indirect access&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;b[idx[i]] = a[i]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vectorizable&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Usually</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Scatter -- possible with AVX-512 but slow&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Function call&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;b[i] = expensive_func(a[i])&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vectorizable&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Function calls prevent vectorization (unless intrinsic)&#39;</span>
        <span class="p">},</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Vectorization Analysis ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;YES&quot;</span> <span class="k">if</span> <span class="n">ex</span><span class="p">[</span><span class="s1">&#39;vectorizable&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;NO&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">ex</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Vectorizable: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Reason: </span><span class="si">{</span><span class="n">ex</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">vectorization_analysis</span><span class="p">()</span>
</code></pre></div>

<h3 id="113-numpy">11.3 NumPyë¥¼ ì‚¬ìš©í•œ ë²¡í„°í™”<a class="header-link" href="#113-numpy" title="Permanent link">&para;</a></h3>
<p>Pythonì—ì„œ NumPyëŠ” ë‚´ë¶€ì ìœ¼ë¡œ SIMDë¥¼ í™œìš©í•˜ëŠ” ë²¡í„°í™” ì—°ì‚°ì„ ì œê³µí•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">numpy_vectorization_demo</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate NumPy vectorization vs pure Python loops.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">10_000_000</span>

    <span class="c1"># Pure Python</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">c_python</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="n">time_python</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># NumPy vectorized</span>
    <span class="n">a_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">b_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">c_np</span> <span class="o">=</span> <span class="n">a_np</span> <span class="o">+</span> <span class="n">b_np</span>  <span class="c1"># Single vectorized operation</span>
    <span class="n">time_numpy</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Python loop: </span><span class="si">{</span><span class="n">time_python</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NumPy vectorized: </span><span class="si">{</span><span class="n">time_numpy</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speedup: </span><span class="si">{</span><span class="n">time_python</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time_numpy</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>

<span class="c1"># numpy_vectorization_demo()  # Uncomment to run</span>
</code></pre></div>

<h3 id="114-strip-mining">11.4 ìŠ¤íŠ¸ë¦½ ë§ˆì´ë‹(Strip Mining)<a class="header-link" href="#114-strip-mining" title="Permanent link">&para;</a></h3>
<p>ìŠ¤íŠ¸ë¦½ ë§ˆì´ë‹(strip mining)ì€ SIMDë¥¼ ìœ„í•´ ë£¨í”„ë¥¼ ë³€í™˜í•˜ì—¬ ë²¡í„° ê¸¸ì´ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">strip_mine</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">vector_length</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Strip mine a loop for vectorization.</span>

<span class="sd">    Before: for i in range(n): body(i)</span>
<span class="sd">    After:  for i in range(0, n, VL):</span>
<span class="sd">                for ii in range(i, min(i+VL, n)):</span>
<span class="sd">                    body(ii)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Strip Mining (VL=</span><span class="si">{</span><span class="n">vector_length</span><span class="si">}</span><span class="s2">) ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original: for i in range(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">): body(i)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Strip-mined:&quot;</span><span class="p">)</span>

    <span class="n">iteration_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">vector_length</span><span class="p">):</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">vector_length</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">vec_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Vector op: body(</span><span class="si">{</span><span class="n">vec_indices</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">iteration_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Outer iterations: </span><span class="si">{</span><span class="n">iteration_count</span><span class="si">}</span><span class="s2"> (was </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">strip_mine</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</code></pre></div>

<p>ì¶œë ¥:</p>
<div class="highlight"><pre><span></span><code><span class="o">===</span><span class="w"> </span><span class="nv">Strip</span><span class="w"> </span><span class="nv">Mining</span><span class="w"> </span><span class="ss">(</span><span class="nv">VL</span><span class="o">=</span><span class="mi">4</span><span class="ss">)</span><span class="w"> </span><span class="o">===</span>
<span class="nv">Original</span>:<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">14</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">body</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span>
<span class="nv">Strip</span><span class="o">-</span><span class="nv">mined</span>:
<span class="w">  </span><span class="nv">Vector</span><span class="w"> </span><span class="nv">op</span>:<span class="w"> </span><span class="nv">body</span><span class="ss">(</span>[<span class="mi">0</span>,<span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="mi">2</span>,<span class="w"> </span><span class="mi">3</span>]<span class="ss">)</span>
<span class="w">  </span><span class="nv">Vector</span><span class="w"> </span><span class="nv">op</span>:<span class="w"> </span><span class="nv">body</span><span class="ss">(</span>[<span class="mi">4</span>,<span class="w"> </span><span class="mi">5</span>,<span class="w"> </span><span class="mi">6</span>,<span class="w"> </span><span class="mi">7</span>]<span class="ss">)</span>
<span class="w">  </span><span class="nv">Vector</span><span class="w"> </span><span class="nv">op</span>:<span class="w"> </span><span class="nv">body</span><span class="ss">(</span>[<span class="mi">8</span>,<span class="w"> </span><span class="mi">9</span>,<span class="w"> </span><span class="mi">10</span>,<span class="w"> </span><span class="mi">11</span>]<span class="ss">)</span>
<span class="w">  </span><span class="nv">Vector</span><span class="w"> </span><span class="nv">op</span>:<span class="w"> </span><span class="nv">body</span><span class="ss">(</span>[<span class="mi">12</span>,<span class="w"> </span><span class="mi">13</span>]<span class="ss">)</span>
<span class="nv">Outer</span><span class="w"> </span><span class="nv">iterations</span>:<span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="ss">(</span><span class="nv">was</span><span class="w"> </span><span class="mi">14</span><span class="ss">)</span>
</code></pre></div>

<h3 id="115-peeling">11.5 ì •ë ¬ê³¼ í•„ë§(Peeling)<a class="header-link" href="#115-peeling" title="Permanent link">&para;</a></h3>
<p>SIMD ëª…ë ¹ì–´ëŠ” ì¢…ì¢… íŠ¹ì • ê²½ê³„ì— ë°ì´í„°ê°€ ì •ë ¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ (SSEëŠ” 16ë°”ì´íŠ¸, AVXëŠ” 32ë°”ì´íŠ¸). <strong>ë£¨í”„ í•„ë§(loop peeling)</strong>ì€ ì²« ëª‡ ë²ˆì˜ ë°˜ë³µ (ì •ë ¬ì— ë„ë‹¬í•  ë•Œê¹Œì§€)ì„ ìŠ¤ì¹¼ë¼ ì—°ì‚°ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>í•„ë§ëœ ë°˜ë³µ:       i = 0, 1  (ìŠ¤ì¹¼ë¼, ì •ë ¬ë  ë•Œê¹Œì§€)
ì£¼ìš” ë²¡í„°í™” ë£¨í”„:  i = 2, 3, 4, 5 | 6, 7, 8, 9 | ...  (SIMD)
ì •ë¦¬ ë°˜ë³µ:         i = n-2, n-1  (ìŠ¤ì¹¼ë¼, ë‚˜ë¨¸ì§€)
</code></pre></div>

<hr />
<h2 id="12">12. ë‹¤ë©´ì²´ ëª¨ë¸<a class="header-link" href="#12" title="Permanent link">&para;</a></h2>
<h3 id="121">12.1 ê°œìš”<a class="header-link" href="#121" title="Permanent link">&para;</a></h3>
<p><strong>ë‹¤ë©´ì²´ ëª¨ë¸(polyhedral model)</strong> (ë˜ëŠ” <strong>í´ë¦¬í† í”„ ëª¨ë¸(polytope model)</strong>)ì€ ë£¨í”„ ì¤‘ì²© ìµœì í™”ë¥¼ ìœ„í•œ ê°•ë ¥í•œ ìˆ˜í•™ì  í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ë£¨í”„ ë°˜ë³µì„ ë‹¤ë©´ì²´ ë‚´ì˜ ì •ìˆ˜ ì ìœ¼ë¡œ í‘œí˜„í•˜ê³ , ë£¨í”„ ë³€í™˜ì„ ì´ ì ë“¤ì— ëŒ€í•œ ì•„í•€(affine) í•¨ìˆ˜ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.</p>
<h3 id="122">12.2 ë°˜ë³µ ë„ë©”ì¸<a class="header-link" href="#122" title="Permanent link">&para;</a></h3>
<p>ì´ì¤‘ ì¤‘ì²© ë£¨í”„ë¥¼ ìƒê°í•´ë´…ì‹œë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</code></pre></div>

<p><strong>ë°˜ë³µ ë„ë©”ì¸(iteration domain)</strong>ì€ ì‹¤í–‰ë˜ëŠ” ëª¨ë“  $(i, j)$ ìŒì˜ ì§‘í•©ì…ë‹ˆë‹¤:</p>
<p>$$\mathcal{D} = \{ (i, j) \in \mathbb{Z}^2 \mid 0 \leq i < N, \; 0 \leq j < M \}$$</p>
<p>ì´ê²ƒì€ 2D ì§ì‚¬ê°í˜• ë‹¤ë©´ì²´(í´ë¦¬í† í”„)ì…ë‹ˆë‹¤.</p>
<h3 id="123">12.3 ì ‘ê·¼ í•¨ìˆ˜<a class="header-link" href="#123" title="Permanent link">&para;</a></h3>
<p>ê° ë©”ëª¨ë¦¬ ì ‘ê·¼ì€ <strong>ì ‘ê·¼ í•¨ìˆ˜(access function)</strong> -- ë°˜ë³µ ì¢Œí‘œì—ì„œ ë°°ì—´ ì¸ë±ìŠ¤ë¡œì˜ ì•„í•€ ë§¤í•‘ -- ìœ¼ë¡œ ì„¤ëª…ë©ë‹ˆë‹¤:</p>
<ul>
<li><code>A[i][j]</code>: ì ‘ê·¼ í•¨ìˆ˜ $f_A(i, j) = (i, j)$</li>
<li><code>B[i][j-1]</code>: ì ‘ê·¼ í•¨ìˆ˜ $f_{B1}(i, j) = (i, j-1)$</li>
<li><code>B[i-1][j]</code>: ì ‘ê·¼ í•¨ìˆ˜ $f_{B2}(i, j) = (i-1, j)$</li>
</ul>
<h3 id="124">12.4 ì˜ì¡´ì„± ë‹¤ë©´ì²´<a class="header-link" href="#124" title="Permanent link">&para;</a></h3>
<p>ë¬¸ì¥ ì¸ìŠ¤í„´ìŠ¤ ê°„ì˜ ì˜ì¡´ì„±ì€ <strong>ì˜ì¡´ì„± ë‹¤ë©´ì²´(dependence polyhedra)</strong>ë¡œ í¬ì°©ë©ë‹ˆë‹¤. ë°˜ë³µ $(i_1, j_1)$ì—ì„œ $(i_2, j_2)$ë¡œì˜ ì˜ì¡´ì„±ì€ ë™ì¼í•œ ë©”ëª¨ë¦¬ ìœ„ì¹˜ì— ì ‘ê·¼í•˜ê³  ì†ŒìŠ¤ê°€ ì‹±í¬ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë  ë•Œ ì¡´ì¬í•©ë‹ˆë‹¤.</p>
<p>ì½ê¸° <code>B[i][j-1]</code>ê³¼ ê·¸ê²ƒì„ ìƒì„±í•œ ì“°ê¸°ì— ëŒ€í•´:</p>
<p>$$i_2 = i_1, \quad j_2 - 1 = j_1 \implies j_2 = j_1 + 1$$</p>
<p>ì˜ì¡´ì„±ì€ $(i, j) \to (i, j+1)$ì´ë©° ê±°ë¦¬ ë²¡í„°ëŠ” $(0, 1)$ì…ë‹ˆë‹¤.</p>
<h3 id="125">12.5 ìŠ¤ì¼€ì¤„ê³¼ ë³€í™˜<a class="header-link" href="#125" title="Permanent link">&para;</a></h3>
<p><strong>ìŠ¤ì¼€ì¤„(schedule)</strong>ì€ ê° ë°˜ë³µ ì ì„ íƒ€ì„ ìŠ¤í…ì— ë§¤í•‘í•©ë‹ˆë‹¤. ìœ íš¨í•œ ìŠ¤ì¼€ì¤„ì€ ëª¨ë“  ì˜ì¡´ì„±ì„ ì¡´ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤. ìŠ¤ì¼€ì¤„ì€ ì¢…ì¢… ì•„í•€ í•¨ìˆ˜ë¡œ í‘œí˜„ë©ë‹ˆë‹¤:</p>
<p>$$\theta(i, j) = \alpha_1 i + \alpha_2 j + \alpha_0$$</p>
<p>ë‹¤ë©´ì²´ ëª¨ë¸ì€ ì •ìˆ˜ ì„ í˜• í”„ë¡œê·¸ë˜ë°(ILP)ì„ í’€ì–´ ìµœì  ìŠ¤ì¼€ì¤„ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">polyhedral_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple demonstration of polyhedral iteration domain and scheduling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Polyhedral Model Example ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration domain: 0 &lt;= i &lt; </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">, 0 &lt;= j &lt; </span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Statement: A[i][j] = B[i][j-1] + B[i-1][j]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dependencies: (0,1) and (1,0)&quot;</span><span class="p">)</span>

    <span class="c1"># Original schedule: theta(i,j) = (i, j) -- lexicographic order</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Original schedule (row by row):&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  t=</span><span class="si">{</span><span class="n">i</span><span class="o">*</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="si">}</span><span class="s2">: S(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="c1"># Skewed schedule: theta(i,j) = (i+j, j) -- enables wavefront parallelism</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Skewed schedule (wavefront):&quot;</span><span class="p">)</span>
    <span class="n">schedule</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
            <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">schedule</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

    <span class="n">schedule</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">schedule</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  t=</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">: S(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Wavefront parallelism:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iterations on the same diagonal (same i+j) can execute in parallel!&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">wave</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">parallel</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">wave</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">wave</span> <span class="o">-</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Wave </span><span class="si">{</span><span class="n">wave</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">parallel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">polyhedral_example</span><span class="p">()</span>
</code></pre></div>

<h3 id="126">12.6 ë„êµ¬<a class="header-link" href="#126" title="Permanent link">&para;</a></h3>
<p>ì‹¤ì œ ë‹¤ë©´ì²´ ìµœì í™”ê¸°ì—ëŠ” ë‹¤ìŒì´ í¬í•¨ë©ë‹ˆë‹¤:
- <strong>ISL</strong> (Integer Set Library): ìˆ˜í•™ì  ê¸°ë°˜
- <strong>Pluto</strong>: ìë™ ë³‘ë ¬í™”ê¸° ë° ì§€ì—­ì„± ìµœì í™”ê¸°
- <strong>Polly</strong>: LLVMì˜ ë‹¤ë©´ì²´ ìµœì í™” íŒ¨ìŠ¤
- <strong>PPCG</strong>: ë‹¤ë©´ì²´ ë³‘ë ¬ ì½”ë“œ ìƒì„±ê¸° (GPUìš©)</p>
<hr />
<h2 id="13">13. ë£¨í”„ ë³‘ë ¬í™”<a class="header-link" href="#13" title="Permanent link">&para;</a></h2>
<h3 id="131">13.1 ì˜ì¡´ì„±ì´ ì—†ëŠ” ë£¨í”„<a class="header-link" href="#131" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ ì „ì´ ì˜ì¡´ì„±ì´ ì—†ëŠ” ë£¨í”„ëŠ” <strong>ìëª…í•˜ê²Œ ë³‘ë ¬í™” ê°€ëŠ¥(trivially parallelizable)</strong> (ë˜ëŠ” "ë‹¹í˜¹ìŠ¤ëŸ½ê²Œ ë³‘ë ¬(embarrassingly parallel)")í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Parallelizable: each iteration is independent</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># NOT parallelizable: iteration i depends on i-1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div>

<h3 id="132">13.2 ì˜ì¡´ì„± ìœ í˜•<a class="header-link" href="#132" title="Permanent link">&para;</a></h3>
<p>ë£¨í”„ ì „ì´ ì˜ì¡´ì„±ì˜ ì„¸ ê°€ì§€ ìœ í˜•:</p>
<table>
<thead>
<tr>
<th>ìœ í˜•</th>
<th>ì´ë¦„</th>
<th>ì˜ˆì‹œ</th>
<th>ë³‘ë ¬í™” ë°©í•´?</th>
</tr>
</thead>
<tbody>
<tr>
<td>RAW</td>
<td>ì°¸/íë¦„(True/Flow)</td>
<td><code>a[i] = ...; ... = a[i-1]</code></td>
<td>ì˜ˆ</td>
</tr>
<tr>
<td>WAR</td>
<td>ì—­(Anti)</td>
<td><code>... = a[i-1]; a[i] = ...</code></td>
<td>ì´ë¦„ ë³€ê²½ ê°€ëŠ¥</td>
</tr>
<tr>
<td>WAW</td>
<td>ì¶œë ¥(Output)</td>
<td><code>a[i] = ...; a[i] = ...</code></td>
<td>ì´ë¦„ ë³€ê²½ ê°€ëŠ¥</td>
</tr>
</tbody>
</table>
<p>WARì™€ WAW ì˜ì¡´ì„±ì€ <strong>í”„ë¼ì´ë¹—í™”(privatization)</strong> (ê° ìŠ¤ë ˆë“œì— ìì²´ ë³µì‚¬ë³¸ ì œê³µ) ë˜ëŠ” ì´ë¦„ ë³€ê²½ìœ¼ë¡œ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="133">13.3 ë¦¬ë•ì…˜ ë³‘ë ¬í™”<a class="header-link" href="#133" title="Permanent link">&para;</a></h3>
<p>ë¦¬ë•ì…˜(í•©, ê³±, ìµœì†Ÿê°’, ìµœëŒ“ê°’)ì€ ë³‘ë ¬ ì‹¤í–‰ì„ í—ˆìš©í•˜ëŠ” íŠ¹ë³„í•œ íŒ¨í„´ì„ ê°€ì§‘ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Sequential reduction</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># RAW dependency on total</span>

<span class="c1"># Parallel reduction</span>
<span class="c1"># Each thread computes a partial sum, then combine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>

<span class="k">def</span><span class="w"> </span><span class="nf">parallel_sum</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel reduction using thread pool.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">num_threads</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">num_threads</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">partial_sum</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">num_threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_threads</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">chunk_size</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">partial_sum</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>

        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">total</span>
</code></pre></div>

<h3 id="134-doall-doacross-dopipe">13.4 DOALL, DOACROSS, DOPIPE<a class="header-link" href="#134-doall-doacross-dopipe" title="Permanent link">&para;</a></h3>
<p>ì„¸ ê°€ì§€ ë³‘ë ¬í™” ì „ëµ:</p>
<p><strong>DOALL</strong>: ëª¨ë“  ë°˜ë³µì´ ë…ë¦½ì  -- ëª¨ë‘ ë³‘ë ¬ë¡œ ì‹¤í–‰.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># DOALL parallelism</span>
<span class="c1"># for i in range(n):</span>
<span class="c1">#     c[i] = f(a[i])</span>
<span class="c1"># All iterations can execute simultaneously</span>
</code></pre></div>

<p><strong>DOACROSS</strong>: ë°˜ë³µë“¤ì´ ì˜ì¡´ì„±ì„ ê°€ì§€ì§€ë§Œ, ë™ê¸°í™”ë¥¼ í†µí•´ ì‹¤í–‰ì„ ê²¹ì¹  ìˆ˜ ìˆìŒ.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># DOACROSS parallelism</span>
<span class="c1"># for i in range(n):</span>
<span class="c1">#     a[i] = a[i-1] + b[i]    # depends on previous iteration</span>
<span class="c1">#     c[i] = expensive(a[i])   # expensive independent computation</span>
<span class="c1">#</span>
<span class="c1"># Thread 1 computes a[0], starts expensive(a[0])</span>
<span class="c1"># Thread 2 waits for a[0], then computes a[1], starts expensive(a[1])</span>
<span class="c1"># Overlap the expensive computation</span>
</code></pre></div>

<p><strong>DOPIPE</strong>: íŒŒì´í”„ë¼ì¸ ë³‘ë ¬ì„± -- ê³„ì‚°ì˜ ê° ë‹¨ê³„ê°€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë¨.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># DOPIPE parallelism</span>
<span class="c1"># Stage 1 (Thread 1): for i: a[i] = input[i] * 2</span>
<span class="c1"># Stage 2 (Thread 2): for i: b[i] = a[i] + offset  (wait for a[i] from Stage 1)</span>
<span class="c1"># Stage 3 (Thread 3): for i: output[i] = transform(b[i])</span>
</code></pre></div>

<h3 id="135-openmp">13.5 OpenMP ìŠ¤íƒ€ì¼ ë³‘ë ¬í™”<a class="header-link" href="#135-openmp" title="Permanent link">&para;</a></h3>
<p>OpenMPë¥¼ ì§€ì›í•˜ëŠ” ì»´íŒŒì¼ëŸ¬ëŠ” í”„ë¼ê·¸ë§ˆ(pragma)ë¡œ ë£¨í”„ë¥¼ ë³‘ë ¬í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Pythonì—ì„œ ë™ë“±í•œ ì½”ë“œ:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span>

<span class="k">def</span><span class="w"> </span><span class="nf">openmp_style_parallel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate parallel loop execution (Python equivalent of OpenMP).&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">1_000_000</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="n">num_workers</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">4</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_chunk</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]]</span>

    <span class="n">chunk_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">num_workers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">num_workers</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="nb">min</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">process_chunk</span><span class="p">,</span> <span class="n">chunks</span><span class="p">)</span>

    <span class="c1"># Flatten results</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">chunk_result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunk_result</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="si">}</span><span class="s2"> elements using </span><span class="si">{</span><span class="n">num_workers</span><span class="si">}</span><span class="s2"> workers&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First 5: </span><span class="si">{</span><span class="n">c</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last 5: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># openmp_style_parallel()  # Uncomment to run</span>
</code></pre></div>

<h3 id="136">13.6 ë³‘ë ¬í™”ë¥¼ ìœ„í•œ ì»´íŒŒì¼ëŸ¬ ë¶„ì„<a class="header-link" href="#136" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_parallelizability</span><span class="p">(</span><span class="n">loop_deps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze whether a loop can be parallelized and suggest strategy.</span>

<span class="sd">    loop_deps: list of dependency dicts with &#39;type&#39;, &#39;distance&#39;, &#39;variable&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">loop_deps</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;DOALL&quot;</span><span class="p">,</span> <span class="s2">&quot;No dependencies -- fully parallel&quot;</span>

    <span class="n">has_true_dep</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RAW&#39;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">loop_deps</span><span class="p">)</span>
    <span class="n">has_reduction</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_reduction&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">loop_deps</span><span class="p">)</span>
    <span class="n">only_renamable</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;WAR&#39;</span><span class="p">,</span> <span class="s1">&#39;WAW&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">loop_deps</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">has_reduction</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_true_dep</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;DOALL + Reduction&quot;</span><span class="p">,</span> <span class="s2">&quot;Reduction pattern detected -- use parallel reduction&quot;</span>

    <span class="k">if</span> <span class="n">only_renamable</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;DOALL (after privatization)&quot;</span><span class="p">,</span> <span class="s2">&quot;Only anti/output deps -- privatize variables&quot;</span>

    <span class="k">if</span> <span class="n">has_true_dep</span><span class="p">:</span>
        <span class="n">min_distance</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">loop_deps</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RAW&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_distance</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;DOACROSS&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;True dep with distance </span><span class="si">{</span><span class="n">min_distance</span><span class="si">}</span><span class="s2"> -- overlap possible&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Sequential&quot;</span><span class="p">,</span> <span class="s2">&quot;True dependency with distance 1 -- cannot parallelize&quot;</span>

    <span class="k">return</span> <span class="s2">&quot;DOALL&quot;</span><span class="p">,</span> <span class="s2">&quot;Safe to parallelize&quot;</span>


<span class="c1"># Examples</span>
<span class="n">examples</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;c[i] = a[i] + b[i]&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">(</span><span class="s2">&quot;sum += a[i]&quot;</span><span class="p">,</span> <span class="p">[{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;RAW&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;is_reduction&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}]),</span>
    <span class="p">(</span><span class="s2">&quot;a[i] = a[i-1] + 1&quot;</span><span class="p">,</span> <span class="p">[{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;RAW&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">}]),</span>
    <span class="p">(</span><span class="s2">&quot;a[i] = a[i-4] + 1&quot;</span><span class="p">,</span> <span class="p">[{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;RAW&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">}]),</span>
<span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Parallelizability Analysis ===&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">deps</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
    <span class="n">strategy</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">analyze_parallelizability</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Strategy: </span><span class="si">{</span><span class="n">strategy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Reason: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="14">14. ìš”ì•½<a class="header-link" href="#14" title="Permanent link">&para;</a></h2>
<p>ë£¨í”„ ìµœì í™”ëŠ” í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ ì‹œê°„ì˜ ì••ë„ì ì¸ ëŒ€ë¶€ë¶„ì„ ë£¨í”„ì—ì„œ ë³´ë‚´ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ëŸ¬ ìµœì í™” ì¤‘ ê°€ì¥ í° ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ë²”ì£¼ì…ë‹ˆë‹¤. ë‹¤ìŒì„ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ìµœì í™”</th>
<th>íš¨ê³¼</th>
<th>í•µì‹¬ ìš”êµ¬ ì‚¬í•­</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ì§€ë°°ì ë¶„ì„(Dominator analysis)</strong></td>
<td>ë£¨í”„ ê°ì§€ì˜ ê¸°ë°˜</td>
<td>CFG ì‚¬ìš© ê°€ëŠ¥</td>
</tr>
<tr>
<td><strong>ë£¨í”„ ê°ì§€(Loop detection)</strong></td>
<td>í›„ë°© ì—£ì§€ë¡œ ìì—° ë£¨í”„ ì‹ë³„</td>
<td>ì§€ë°°ì ê³„ì‚°ë¨</td>
</tr>
<tr>
<td><strong>LICM</strong></td>
<td>ë¶ˆë³€ ì½”ë“œë¥¼ ë£¨í”„ ë°–ìœ¼ë¡œ ëŒì–´ì˜¬ë¦¼</td>
<td>ì§€ë°° + í™œì„±ì„±</td>
</tr>
<tr>
<td><strong>ê°•ë„ ê°ì†Œ(Strength reduction)</strong></td>
<td>IVì—ì„œ ê³±ì…ˆì„ ë§ì…ˆìœ¼ë¡œ êµì²´</td>
<td>ê·€ë‚© ë³€ìˆ˜ ë¶„ì„</td>
</tr>
<tr>
<td><strong>ë£¨í”„ ì–¸ë¡¤ë§(Loop unrolling)</strong></td>
<td>ë¶„ê¸° ì˜¤ë²„í—¤ë“œ ê°ì†Œ, ILP ê°€ëŠ¥</td>
<td>íŠ¸ë¦½ ì¹´ìš´íŠ¸ ì§€ì‹</td>
</tr>
<tr>
<td><strong>ë£¨í”„ ê²°í•©(Loop fusion)</strong></td>
<td>ì§€ì—­ì„± í–¥ìƒ, ì˜¤ë²„í—¤ë“œ ê°ì†Œ</td>
<td>ê²°í•© ë°©ì§€ ì˜ì¡´ì„± ì—†ìŒ</td>
</tr>
<tr>
<td><strong>ë£¨í”„ ë¶„ë¦¬(Loop fission)</strong></td>
<td>ì„œë¸Œë£¨í”„ì˜ ë²¡í„°í™” ê°€ëŠ¥</td>
<td>ì˜ì¡´ì„± ë¶„í• </td>
</tr>
<tr>
<td><strong>ë£¨í”„ íƒ€ì¼ë§(Loop tiling)</strong></td>
<td>ì‘ì—… ì§‘í•©ì„ ìºì‹œì— ë§ì¶¤</td>
<td>ì•Œë ¤ì§„ ê²½ê³„</td>
</tr>
<tr>
<td><strong>ë£¨í”„ êµí™˜(Loop interchange)</strong></td>
<td>ì ‘ê·¼ íŒ¨í„´ì„ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì— ë§ì¶¤</td>
<td>í•©ë²•ì  ê±°ë¦¬ ë²¡í„°</td>
</tr>
<tr>
<td><strong>ë²¡í„°í™”(Vectorization)</strong></td>
<td>SIMD í•˜ë“œì›¨ì–´ í™œìš©</td>
<td>ë£¨í”„ ì „ì´ ì˜ì¡´ì„± ì—†ìŒ</td>
</tr>
<tr>
<td><strong>ë‹¤ë©´ì²´ ëª¨ë¸(Polyhedral model)</strong></td>
<td>ëª¨ë“  ë³€í™˜ì„ ìœ„í•œ í†µí•© í”„ë ˆì„ì›Œí¬</td>
<td>ì•„í•€ ë£¨í”„</td>
</tr>
<tr>
<td><strong>ë³‘ë ¬í™”(Parallelization)</strong></td>
<td>ë‹¤ì¤‘ ì½”ì–´ í™œìš©</td>
<td>ì˜ì¡´ì„± ë¶„ì„</td>
</tr>
</tbody>
</table>
<p>ì´ ëª¨ë“  ìµœì í™”ë¥¼ í†µí•©í•˜ëŠ” í•µì‹¬ í†µì°°ì€ <strong>ì˜ì¡´ì„± ë¶„ì„(dependency analysis)</strong>ì…ë‹ˆë‹¤: ëª¨ë“  ë³€í™˜ì€ ì›ë˜ í”„ë¡œê·¸ë¨ì˜ ë°ì´í„° ì˜ì¡´ì„±ì„ ë³´ì¡´í•´ì•¼ í•©ë‹ˆë‹¤. ì–´ë–¤ ê³„ì‚°ì´ ë¬´ì—‡ì— ì˜ì¡´í•˜ëŠ”ì§€ -- ê·¸ë¦¬ê³  ë¬´ì—‡ì„ ì•ˆì „í•˜ê²Œ ì¬ì •ë ¬, ëŒì–´ì˜¬ë¦¬ê¸°, ë˜ëŠ” ë³‘ë ¬í™”í•  ìˆ˜ ìˆëŠ”ì§€ -- ì´í•´í•˜ëŠ” ê²ƒì´ ëª¨ë“  ë£¨í”„ ìµœì í™”ì˜ ê¸°ë°˜ì…ë‹ˆë‹¤.</p>
<hr />
<h2 id="15">15. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#15" title="Permanent link">&para;</a></h2>
<h3 id="1_1">ì—°ìŠµ 1: ì§€ë°°ì ê³„ì‚°<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ CFGì— ëŒ€í•´ ê° ë…¸ë“œì˜ ì§€ë°°ì ì§‘í•©ì„ ê³„ì‚°í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="n">Entry</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span>
<span class="w">         </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">         </span><span class="n">v</span><span class="w">         </span><span class="n">v</span>
<span class="w">         </span><span class="n">D</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Exit</span>
<span class="w">              </span><span class="o">^</span>
<span class="w">              </span><span class="o">|</span>
<span class="w">              </span><span class="n">G</span><span class="w"> </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">F</span>
</code></pre></div>

<p>ì—£ì§€: Entry-&gt;A, A-&gt;B, A-&gt;D, B-&gt;C, C-&gt;F, D-&gt;E, E-&gt;F, F-&gt;Exit, F-&gt;G, G-&gt;E</p>
<p>(a) ê° ë…¸ë“œì˜ ì§€ë°°ì ì§‘í•©ì„ ê³„ì‚°í•˜ì„¸ìš”.
(b) ì§€ë°°ì íŠ¸ë¦¬ë¥¼ ê·¸ë¦¬ì„¸ìš”.
(c) ëª¨ë“  í›„ë°© ì—£ì§€ì™€ ìì—° ë£¨í”„ë¥¼ ì‹ë³„í•˜ì„¸ìš”.</p>
<h3 id="2_1">ì—°ìŠµ 2: ë£¨í”„ ë¶ˆë³€ ì½”ë“œ ì´ë™<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ë£¨í”„ (ì˜ì‚¬ ì½”ë“œ)ë¥¼ ê³ ë ¤í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">while</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">n</span><span class="p">:</span>
<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span>
<span class="w">    </span><span class="n">t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t2</span>
<span class="w">    </span><span class="n">t4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t1</span>
<span class="w">    </span><span class="n">e</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t4</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>

<p>(a) ëª¨ë“  ë£¨í”„ ë¶ˆë³€ ê³„ì‚°ì„ ì‹ë³„í•˜ì„¸ìš”.
(b) ì–´ë–¤ ë¶ˆë³€ ê³„ì‚°ì„ ì•ˆì „í•˜ê²Œ ëŒì–´ì˜¬ë¦´ ìˆ˜ ìˆë‚˜ìš”? ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?
(c) LICM ì ìš© í›„ ìµœì í™”ëœ ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.</p>
<h3 id="3_1">ì—°ìŠµ 3: ê°•ë„ ê°ì†Œ<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ë£¨í”„ë¥¼ ê³ ë ¤í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">addr1</span> <span class="o">=</span> <span class="n">base1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="n">addr2</span> <span class="o">=</span> <span class="n">base2</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">12</span>
    <span class="n">mem</span><span class="p">[</span><span class="n">addr1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">addr2</span><span class="p">]</span>
</code></pre></div>

<p>(a) ëª¨ë“  ê¸°ë³¸ ë° íŒŒìƒ ê·€ë‚© ë³€ìˆ˜ë¥¼ ì‹ë³„í•˜ì„¸ìš”.
(b) ê°•ë„ ê°ì†Œë¥¼ ì ìš©í•˜ì„¸ìš”. ê²°ê³¼ ì½”ë“œë¥¼ ë³´ì—¬ì£¼ì„¸ìš”.
(c) ê°€ëŠ¥í•˜ë‹¤ë©´ ì›ë˜ ì¹´ìš´í„°ë¥¼ ì œê±°í•˜ê¸° ìœ„í•´ ì„ í˜• í…ŒìŠ¤íŠ¸ êµì²´ë¥¼ ì ìš©í•˜ì„¸ìš”.</p>
<h3 id="4">ì—°ìŠµ 4: ë£¨í”„ íƒ€ì¼ë§<a class="header-link" href="#4" title="Permanent link">&para;</a></h3>
<p>í–‰ë ¬ ì „ì¹˜(matrix transposition)ë¥¼ ê³ ë ¤í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</code></pre></div>

<p>(a) ì´ ì½”ë“œì˜ ìºì‹œ ë™ì‘ì„ ë¶„ì„í•˜ì„¸ìš” (í–‰ ìš°ì„  ì €ì¥ ê°€ì •).
(b) íƒ€ì¼ í¬ê¸° $T = 32$ë¡œ ë£¨í”„ íƒ€ì¼ë§ì„ ì ìš©í•˜ì„¸ìš”. íƒ€ì¼ë§ëœ ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
(c) 32 KBì˜ L1 ìºì‹œì™€ 8ë°”ì´íŠ¸ ì›ì†Œì— ëŒ€í•´ ìµœì  íƒ€ì¼ í¬ê¸°ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</p>
<h3 id="5_1">ì—°ìŠµ 5: ë²¡í„°í™” ë¶„ì„<a class="header-link" href="#5_1" title="Permanent link">&para;</a></h3>
<p>ì•„ë˜ì˜ ê° ë£¨í”„ì— ëŒ€í•´ ë²¡í„°í™” ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ì„¸ìš”. ë¶ˆê°€ëŠ¥í•˜ë‹¤ë©´ ì´ìœ ë¥¼ ì„¤ëª…í•˜ê³  ë„ì›€ì´ ë  ìˆ˜ ìˆëŠ” ë³€í™˜ì„ ì œì•ˆí•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># (a)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># (b)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># (c)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># (d)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>

<h3 id="6_1">ì—°ìŠµ 6: ë‹¤ë©´ì²´ ë³€í™˜<a class="header-link" href="#6_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ë£¨í”„ ì¤‘ì²©ì„ ê³ ë ¤í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>

<p>(a) ë°˜ë³µ ë„ë©”ì¸ì„ 2D ê²©ìë¡œ ê·¸ë¦¬ì„¸ìš”.
(b) ëª¨ë“  ë°ì´í„° ì˜ì¡´ì„±ê³¼ ê±°ë¦¬ ë²¡í„°ë¥¼ ì‹ë³„í•˜ì„¸ìš”.
(c) ë£¨í”„ êµí™˜ì´ í•©ë²•ì ì¸ê°€ìš”? ê·¼ê±°ë¥¼ ì œì‹œí•˜ì„¸ìš”.
(d) ê¸°ìš¸ì„(skewing) ë³€í™˜ $\theta(i, j) = (i + j, j)$ë¥¼ ì œì•ˆí•˜ê³  ì˜ì¡´ì„±ì„ ì¡´ì¤‘í•˜ëŠ”ì§€ ê²€ì¦í•˜ì„¸ìš”.
(e) ê¸°ìš¸ì¸ ìŠ¤ì¼€ì¤„ì´ ì–´ë–»ê²Œ íŒŒë©´(wavefront) ë³‘ë ¬ì„±ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ”ê°€?</p>
<hr />
<h2 id="16">16. ì°¸ê³  ë¬¸í—Œ<a class="header-link" href="#16" title="Permanent link">&para;</a></h2>
<ol>
<li>Aho, A. V., Lam, M. S., Sethi, R., &amp; Ullman, J. D. (2006). <em>Compilers: Principles, Techniques, and Tools</em> (2nd ed.), Chapters 9-10.</li>
<li>Cooper, K. D., &amp; Torczon, L. (2011). <em>Engineering a Compiler</em> (2nd ed.), Chapters 8-10.</li>
<li>Muchnick, S. S. (1997). <em>Advanced Compiler Design and Implementation</em>, Chapters 14-18.</li>
<li>Allen, R., &amp; Kennedy, K. (2001). <em>Optimizing Compilers for Modern Architectures</em>.</li>
<li>Wolfe, M. (1996). <em>High Performance Compilers for Parallel Computing</em>.</li>
<li>Bondhugula, U., et al. (2008). "A Practical Automatic Polyhedral Parallelizer and Locality Optimizer." <em>PLDI</em>.</li>
<li>Cooper, K. D., Harvey, T. J., &amp; Kennedy, K. (2001). "A Simple, Fast Dominance Algorithm." <em>Software Practice and Experience</em>.</li>
</ol>
<hr />
<p><a href="./12_Optimization_Local_and_Global.md">Previous: 12. Optimization -- Local and Global</a> | <a href="./14_Garbage_Collection.md">Next: 14. Garbage Collection</a> | <a href="./00_Overview.md">Overview</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/12_Optimization_Local_and_Global.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë ˆìŠ¨ 12: ìµœì í™” -- ì§€ì—­ ìµœì í™”ì™€ ì „ì—­ ìµœì í™”</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/14_Garbage_Collection.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(Garbage Collection)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}