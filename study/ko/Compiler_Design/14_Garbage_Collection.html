{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(Garbage Collection) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Compiler_Design/">Compiler Design</a>
    <span class="separator">/</span>
    <span class="current">ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(Garbage Collection)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(Garbage Collection)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/13_Loop_Optimization.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë£¨í”„ ìµœì í™”</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/15_Interpreters_and_Virtual_Machines.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì¸í„°í”„ë¦¬í„°ì™€ ê°€ìƒ ë¨¸ì‹ (Interpreters and Virtual Machines)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ëª©ì°¨</a></li>
<li><a href="#1">1. ë©”ëª¨ë¦¬ ê´€ë¦¬ ê°œìš”</a><ul>
<li><a href="#11-heap">1.1 í™(Heap)</a></li>
<li><a href="#12">1.2 ìˆ˜ë™ ë©”ëª¨ë¦¬ ê´€ë¦¬</a></li>
<li><a href="#13">1.3 ìë™ ë©”ëª¨ë¦¬ ê´€ë¦¬</a></li>
<li><a href="#14-vs">1.4 íŠ¸ë ˆì´ë“œì˜¤í”„: ìˆ˜ë™ vs ìë™</a></li>
<li><a href="#15-conservative-vs-precise-gc">1.5 ë³´ìˆ˜ì (Conservative) vs ì •ë°€(Precise) GC</a></li>
</ul>
</li>
<li><a href="#2">2. ì°¸ì¡° ê³„ìˆ˜</a><ul>
<li><a href="#21">2.1 ê¸°ë³¸ ì°¸ì¡° ê³„ìˆ˜</a></li>
<li><a href="#22">2.2 ì¥ì ê³¼ ë‹¨ì </a></li>
<li><a href="#23-deferred-reference-counting">2.3 ì§€ì—° ì°¸ì¡° ê³„ìˆ˜(Deferred Reference Counting)</a></li>
<li><a href="#24-coalesced-reference-counting">2.4 ë³‘í•© ì°¸ì¡° ê³„ìˆ˜(Coalesced Reference Counting)</a></li>
</ul>
</li>
<li><a href="#3">3. ì‚¬ì´í´ ê°ì§€</a><ul>
<li><a href="#31">3.1 ì‚¬ì´í´ ë¬¸ì œ</a></li>
<li><a href="#32-trial-deletion-">3.2 ì‹œí—˜ì  ì‚­ì œ(Trial Deletion) - ì¬í™œìš©ê¸° ì•Œê³ ë¦¬ì¦˜</a></li>
</ul>
</li>
<li><a href="#4-">4. ë§ˆí¬-ìŠ¤ìœ• ì»¬ë ‰ì…˜</a><ul>
<li><a href="#41">4.1 ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#42-free-list-management">4.2 ììœ  ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬(Free List Management)</a></li>
<li><a href="#43-">4.3 ë§ˆí¬-ìŠ¤ìœ• ë³µì¡ë„</a></li>
</ul>
</li>
<li><a href="#5-">5. ë§ˆí¬-ì»´íŒ©íŠ¸ ì»¬ë ‰ì…˜</a><ul>
<li><a href="#51">5.1 ë™ê¸°</a></li>
<li><a href="#52">5.2 ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#53">5.3 íŠ¸ë ˆì´ë“œì˜¤í”„</a></li>
</ul>
</li>
<li><a href="#6">6. ë³µì‚¬ ì»¬ë ‰í„°</a><ul>
<li><a href="#61-semi-space">6.1 ì„¸ë¯¸-ìŠ¤í˜ì´ìŠ¤(Semi-Space) ì»¬ë ‰í„°</a></li>
<li><a href="#62-cheney">6.2 ì²´ë‹ˆ(Cheney)ì˜ ì•Œê³ ë¦¬ì¦˜</a></li>
<li><a href="#63">6.3 ë³µì‚¬ ì»¬ë ‰ì…˜ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„</a></li>
</ul>
</li>
<li><a href="#7">7. ì„¸ëŒ€ë³„ ì»¬ë ‰ì…˜</a><ul>
<li><a href="#71">7.1 ì„¸ëŒ€ë³„ ê°€ì„¤</a></li>
<li><a href="#72-gc">7.2 ì„¸ëŒ€ë³„ GC ì„¤ê³„</a></li>
<li><a href="#73-write-barriers">7.3 ì“°ê¸° ë°°ë¦¬ì–´(Write Barriers)</a></li>
<li><a href="#74">7.4 ë‹¤ì¤‘ ì„¸ëŒ€ ë°©ì‹</a></li>
</ul>
</li>
<li><a href="#8-gc">8. ì¦ë¶„ ë° ë™ì‹œ GC</a><ul>
<li><a href="#81">8.1 ì¼ì‹œ ì •ì§€ ë¬¸ì œ</a></li>
<li><a href="#82-incremental-collection">8.2 ì¦ë¶„ ì»¬ë ‰ì…˜(Incremental Collection)</a></li>
<li><a href="#83-concurrent-collection">8.3 ë™ì‹œ ì»¬ë ‰ì…˜(Concurrent Collection)</a></li>
</ul>
</li>
<li><a href="#9">9. ì‚¼ìƒ‰ ë§ˆí‚¹</a><ul>
<li><a href="#91">9.1 ì‚¼ìƒ‰ ì¶”ìƒí™”</a></li>
<li><a href="#92">9.2 ìƒì–´ë²„ë¦° ê°ì²´ ë¬¸ì œ</a></li>
<li><a href="#93">9.3 ì“°ê¸° ë°°ë¦¬ì–´ í•´ê²°ì±…</a></li>
<li><a href="#94-yuasa-snapshot-at-the-beginning">9.4 Yuasaì˜ ì²˜ìŒë¶€í„° ìŠ¤ëƒ…ìƒ·(Snapshot-at-the-Beginning)</a></li>
</ul>
</li>
<li><a href="#10-gc">10. ì‹¤ì œ ì‹œìŠ¤í…œì˜ GC</a><ul>
<li><a href="#101-jvm">10.1 JVM ê°€ë¹„ì§€ ì»¬ë ‰í„°</a></li>
<li><a href="#102-go">10.2 Go ê°€ë¹„ì§€ ì»¬ë ‰í„°</a></li>
<li><a href="#103-cpython">10.3 CPython ê°€ë¹„ì§€ ì»¬ë ‰í„°</a></li>
<li><a href="#104-rust-gc-ownership">10.4 Rust: GC ëŒ€ì‹  ì†Œìœ ê¶Œ(Ownership)</a></li>
<li><a href="#105">10.5 ë¹„êµ</a></li>
</ul>
</li>
<li><a href="#11-gc">11. GC íŠœë‹ê³¼ ë©”íŠ¸ë¦­</a><ul>
<li><a href="#111">11.1 í•µì‹¬ ë©”íŠ¸ë¦­</a></li>
<li><a href="#112-gc">11.2 GC íŠœë‹ ì‚¼ê°í˜•</a></li>
<li><a href="#113-gc">11.3 GC íŠœë‹ ì˜ˆì œ</a></li>
<li><a href="#114-gc">11.4 ê³µí†µ GC íŠœë‹ ì „ëµ</a></li>
</ul>
</li>
<li><a href="#12_1">12. ìš”ì•½</a></li>
<li><a href="#13_1">13. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1_1">ì—°ìŠµ 1: ì°¸ì¡° ê³„ìˆ˜ ì‹œë®¬ë ˆì´ì…˜</a></li>
<li><a href="#2-">ì—°ìŠµ 2: ë§ˆí¬-ìŠ¤ìœ• êµ¬í˜„</a></li>
<li><a href="#3_1">ì—°ìŠµ 3: ë³µì‚¬ ì»¬ë ‰í„°</a></li>
<li><a href="#4-gc">ì—°ìŠµ 4: ì„¸ëŒ€ë³„ GC</a></li>
<li><a href="#5">ì—°ìŠµ 5: ì‚¼ìƒ‰ ë§ˆí‚¹ ì•ˆì „ì„±</a></li>
<li><a href="#6-gc">ì—°ìŠµ 6: GC ë¹„êµ</a></li>
</ul>
</li>
<li><a href="#14">14. ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="garbage-collection">ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(Garbage Collection)<a class="header-link" href="#garbage-collection" title="Permanent link">&para;</a></h1>
<p><strong>ì´ì „</strong>: <a href="./13_Loop_Optimization.md">13. ë£¨í”„ ìµœì í™”</a> | <strong>ë‹¤ìŒ</strong>: <a href="./15_Interpreters_and_Virtual_Machines.md">15. ì¸í„°í”„ë¦¬í„°ì™€ ê°€ìƒ ë¨¸ì‹ </a></p>
<hr />
<p>ë©”ëª¨ë¦¬ ê´€ë¦¬ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ êµ¬í˜„ì—ì„œ ê°€ì¥ ê·¼ë³¸ì ì¸ ê³¼ì œ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ëª¨ë“  í”„ë¡œê·¸ë¨ì€ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³ , ê·¸ ë©”ëª¨ë¦¬ëŠ” ê²°êµ­ íšŒìˆ˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ìˆ˜ë™ ë©”ëª¨ë¦¬ ê´€ë¦¬(Cë‚˜ C++ì—ì„œì²˜ëŸ¼)ëŠ” í”„ë¡œê·¸ë˜ë¨¸ì—ê²Œ ì™„ì „í•œ ì œì–´ê¶Œì„ ì£¼ì§€ë§Œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê¸° ì‰½ê¸°ë¡œ ì•…ëª… ë†’ìŠµë‹ˆë‹¤. í—ˆìƒ í¬ì¸í„°(dangling pointer), ì´ì¤‘ í•´ì œ(double free), ë©”ëª¨ë¦¬ ëˆ„ìˆ˜(memory leak)ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ì—­ì‚¬ì—ì„œ ê°€ì¥ í”í•˜ê³  ìœ„í—˜í•œ ë²„ê·¸ë“¤ì…ë‹ˆë‹¤. ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(GC)ì€ ì´ ê³¼ì •ì„ ìë™í™”í•˜ì—¬ í”„ë¡œê·¸ë˜ë¨¸ë¥¼ ê°ì²´ ìˆ˜ëª… ì¶”ì ìœ¼ë¡œë¶€í„° í•´ë°©ì‹œì¼œ ì¤ë‹ˆë‹¤ -- ë‹¨, ëŸ°íƒ€ì„ ì˜¤ë²„í—¤ë“œì™€ ì œì–´ê¶Œ ê°ì†Œë¼ëŠ” ë¹„ìš©ì„ ì¹˜ë¦…ë‹ˆë‹¤.</p>
<p>ì´ ë ˆìŠ¨ì€ ì£¼ìš” ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì•Œê³ ë¦¬ì¦˜ê³¼ ê·¸ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤. ê°€ì¥ ë‹¨ìˆœí•œ ì°¸ì¡° ê³„ìˆ˜(reference counting) ë°©ì‹ë¶€í„° í”„ë¡œë•ì…˜ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ë˜ëŠ” ì •êµí•œ ì„¸ëŒ€ë³„(generational) ë° ë™ì‹œ(concurrent) ì»¬ë ‰í„°ê¹Œì§€ ì‚´í´ë´…ë‹ˆë‹¤.</p>
<p><strong>ë‚œì´ë„</strong>: â­â­â­</p>
<p><strong>ì„ ìˆ˜ ì§€ì‹</strong>: <a href="./10_Runtime_Environments.md">10. ëŸ°íƒ€ì„ í™˜ê²½</a></p>
<p><strong>í•™ìŠµ ëª©í‘œ</strong>:
- ìˆ˜ë™ ë° ìë™ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë°©ì‹ì„ ë¹„êµí•œë‹¤
- ì‚¬ì´í´ ê°ì§€ê°€ í¬í•¨ëœ ì°¸ì¡° ê³„ìˆ˜ë¥¼ êµ¬í˜„í•œë‹¤
- ì¶”ì (tracing) ì»¬ë ‰í„°ë¥¼ ì´í•´í•œë‹¤: ë§ˆí¬-ìŠ¤ìœ•, ë§ˆí¬-ì»´íŒ©íŠ¸, ë³µì‚¬(copying)
- ì„¸ëŒ€ë³„ GCì™€ ê·¸ê²ƒì´ ì‘ë™í•˜ëŠ” ì´ìœ (ì„¸ëŒ€ë³„ ê°€ì„¤)ë¥¼ ì„¤ëª…í•œë‹¤
- ì‚¼ìƒ‰ ë§ˆí‚¹(tri-color marking)ì„ ì´ìš©í•œ ì¦ë¶„(incremental) ë° ë™ì‹œ(concurrent) GC ì•Œê³ ë¦¬ì¦˜ì„ ê¸°ìˆ í•œë‹¤
- ì‹¤ì œ ì‹œìŠ¤í…œ(JVM, Go, Python, Rust)ì˜ GC ì „ëµì„ ë¶„ì„í•œë‹¤
- GC íŠœë‹ê³¼ ì„±ëŠ¥ íŠ¸ë ˆì´ë“œì˜¤í”„ì— ëŒ€í•´ ì¶”ë¡ í•œë‹¤</p>
<hr />
<h2 id="_1">ëª©ì°¨<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-ë©”ëª¨ë¦¬-ê´€ë¦¬-ê°œìš”">ë©”ëª¨ë¦¬ ê´€ë¦¬ ê°œìš”</a></li>
<li><a href="#2-ì°¸ì¡°-ê³„ìˆ˜">ì°¸ì¡° ê³„ìˆ˜</a></li>
<li><a href="#3-ì‚¬ì´í´-ê°ì§€">ì‚¬ì´í´ ê°ì§€</a></li>
<li><a href="#4-ë§ˆí¬-ìŠ¤ìœ•-ì»¬ë ‰ì…˜">ë§ˆí¬-ìŠ¤ìœ• ì»¬ë ‰ì…˜</a></li>
<li><a href="#5-ë§ˆí¬-ì»´íŒ©íŠ¸-ì»¬ë ‰ì…˜">ë§ˆí¬-ì»´íŒ©íŠ¸ ì»¬ë ‰ì…˜</a></li>
<li><a href="#6-ë³µì‚¬-ì»¬ë ‰í„°">ë³µì‚¬ ì»¬ë ‰í„°</a></li>
<li><a href="#7-ì„¸ëŒ€ë³„-ì»¬ë ‰ì…˜">ì„¸ëŒ€ë³„ ì»¬ë ‰ì…˜</a></li>
<li><a href="#8-ì¦ë¶„-ë°-ë™ì‹œ-gc">ì¦ë¶„ ë° ë™ì‹œ GC</a></li>
<li><a href="#9-ì‚¼ìƒ‰-ë§ˆí‚¹">ì‚¼ìƒ‰ ë§ˆí‚¹</a></li>
<li><a href="#10-ì‹¤ì œ-ì‹œìŠ¤í…œì˜-gc">ì‹¤ì œ ì‹œìŠ¤í…œì˜ GC</a></li>
<li><a href="#11-gc-íŠœë‹ê³¼-ë©”íŠ¸ë¦­">GC íŠœë‹ê³¼ ë©”íŠ¸ë¦­</a></li>
<li><a href="#12-ìš”ì•½">ìš”ì•½</a></li>
<li><a href="#13-ì—°ìŠµ-ë¬¸ì œ">ì—°ìŠµ ë¬¸ì œ</a></li>
<li><a href="#14-ì°¸ê³ -ìë£Œ">ì°¸ê³  ìë£Œ</a></li>
</ol>
<hr />
<h2 id="1">1. ë©”ëª¨ë¦¬ ê´€ë¦¬ ê°œìš”<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="11-heap">1.1 í™(Heap)<a class="header-link" href="#11-heap" title="Permanent link">&para;</a></h3>
<p>ë™ì  ë©”ëª¨ë¦¬ í• ë‹¹ì€ <strong>í™(heap)</strong>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤ -- ëŸ°íƒ€ì„ì— ê´€ë¦¬ë˜ëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ì…ë‹ˆë‹¤. ê°ì²´ì˜ í¬ê¸°ë‚˜ ìˆ˜ëª…ì„ ì»´íŒŒì¼ ì‹œì ì— ì•Œ ìˆ˜ ì—†ì„ ë•Œ í™ì— í• ë‹¹ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="n">Stack</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">automatic</span><span class="p">:</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">vars</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">addresses</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="err">â†“</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="p">(</span><span class="n">grows</span><span class="w"> </span><span class="n">down</span><span class="p">)</span><span class="w">                    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                                             </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">              </span><span class="p">(</span><span class="n">grows</span><span class="w"> </span><span class="n">up</span><span class="p">)</span><span class="w">                      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">                    </span><span class="err">â†‘</span><span class="w">                         </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                   </span><span class="n">Heap</span><span class="w">                       </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="n">dynamic</span><span class="p">:</span><span class="w"> </span><span class="n">malloc</span><span class="o">/</span><span class="n">new</span><span class="p">,</span><span class="w"> </span><span class="n">managed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">GC</span><span class="p">)</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">              </span><span class="n">Static</span><span class="o">/</span><span class="n">Global</span><span class="w"> </span><span class="n">Data</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span><span class="w">                  </span><span class="n">Code</span><span class="o">/</span><span class="n">Text</span><span class="w">                   </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div>

<h3 id="12">1.2 ìˆ˜ë™ ë©”ëª¨ë¦¬ ê´€ë¦¬<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<p>C ê°™ì€ ì–¸ì–´ì—ì„œëŠ” í”„ë¡œê·¸ë˜ë¨¸ê°€ ë©”ëª¨ë¦¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// C manual memory management</span>
<span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span><span class="w">  </span><span class="c1">// Allocate</span>
<span class="c1">// ... use arr ...</span>
<span class="n">free</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span><span class="w">  </span><span class="c1">// Deallocate -- programmer&#39;s responsibility</span>
<span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"> </span><span class="c1">// Avoid dangling pointer</span>
</code></pre></div>

<p>ìˆ˜ë™ ë©”ëª¨ë¦¬ ê´€ë¦¬ì˜ í”í•œ ë¬¸ì œì :</p>
<table>
<thead>
<tr>
<th>ë¬¸ì œ</th>
<th>ì„¤ëª…</th>
<th>ê²°ê³¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ë©”ëª¨ë¦¬ ëˆ„ìˆ˜</strong></td>
<td><code>free</code> í˜¸ì¶œì„ ìŠì–´ë²„ë¦¼</td>
<td>ë©”ëª¨ë¦¬ ë¬´í•œ ì¦ê°€</td>
</tr>
<tr>
<td><strong>í—ˆìƒ í¬ì¸í„°</strong></td>
<td><code>free</code> í›„ ë©”ëª¨ë¦¬ ì‚¬ìš©</td>
<td>ì •ì˜ë˜ì§€ ì•Šì€ ë™ì‘, ì¶©ëŒ</td>
</tr>
<tr>
<td><strong>ì´ì¤‘ í•´ì œ</strong></td>
<td><code>free</code>ë¥¼ ë‘ ë²ˆ í˜¸ì¶œ</td>
<td>í™ ì†ìƒ</td>
</tr>
<tr>
<td><strong>ë²„í¼ ì˜¤ë²„í”Œë¡œìš°</strong></td>
<td>í• ë‹¹ ê²½ê³„ë¥¼ ë„˜ì–´ ì“°ê¸°</td>
<td>ë³´ì•ˆ ì·¨ì•½ì </td>
</tr>
<tr>
<td><strong>í•´ì œ í›„ ì‚¬ìš©</strong></td>
<td>í•´ì œëœ ë©”ëª¨ë¦¬ ì ‘ê·¼</td>
<td>ë°ì´í„° ì†ìƒ</td>
</tr>
</tbody>
</table>
<h3 id="13">1.3 ìë™ ë©”ëª¨ë¦¬ ê´€ë¦¬<a class="header-link" href="#13" title="Permanent link">&para;</a></h3>
<p>ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì€ í”„ë¡œê·¸ë¨ì´ ë” ì´ìƒ ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ê°ì²´ë¥¼ ìë™ìœ¼ë¡œ ì‹ë³„í•˜ê³  íšŒìˆ˜í•©ë‹ˆë‹¤. í•µì‹¬ í†µì°°: <strong>ë£¨íŠ¸ ì§‘í•©(root set)ì—ì„œ ì‹œì‘í•˜ëŠ” í¬ì¸í„° ì—­ì°¸ì¡° ì‹œí€€ìŠ¤ë¡œ ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ê°ì²´ëŠ” ê°€ë¹„ì§€ì…ë‹ˆë‹¤</strong>.</p>
<p><strong>ë£¨íŠ¸ ì§‘í•©(root set)</strong>ì€ ë‹¤ìŒìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:
- ì „ì—­ ë³€ìˆ˜
- ìŠ¤íƒì˜ ì§€ì—­ ë³€ìˆ˜
- í¬ì¸í„°ë¥¼ í¬í•¨í•˜ëŠ” CPU ë ˆì§€ìŠ¤í„°
- ëŸ°íƒ€ì„ì´ ê´€ë¦¬í•˜ëŠ” ê¸°íƒ€ ì°¸ì¡°</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GCObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for garbage-collected objects.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">references</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Pointers to other objects</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="p">]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Object(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, refs=</span><span class="si">{</span><span class="n">refs</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="c1"># Example: reachability</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">GCObject</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">GCObject</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">GCObject</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">GCObject</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>    <span class="c1"># Unreachable -- garbage!</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">GCObject</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>

<span class="n">root</span><span class="o">.</span><span class="n">add_reference</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">add_reference</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">add_reference</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="c1"># Reachable from root: root -&gt; A -&gt; B -&gt; D</span>
<span class="c1"># Unreachable: C (garbage)</span>
</code></pre></div>

<h3 id="14-vs">1.4 íŠ¸ë ˆì´ë“œì˜¤í”„: ìˆ˜ë™ vs ìë™<a class="header-link" href="#14-vs" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ì¸¡ë©´</th>
<th>ìˆ˜ë™</th>
<th>ì°¸ì¡° ê³„ìˆ˜</th>
<th>ì¶”ì  GC</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ì²˜ë¦¬ëŸ‰</strong></td>
<td>ìµœì„  (GC ì˜¤ë²„í—¤ë“œ ì—†ìŒ)</td>
<td>ì–‘í˜¸ (ì¦ë¶„ ë¹„ìš©)</td>
<td>ì–‘í˜¸ (ìƒê°)</td>
</tr>
<tr>
<td><strong>ì§€ì—° ì‹œê°„</strong></td>
<td>ì˜ˆì¸¡ ê°€ëŠ¥</td>
<td>ì˜ˆì¸¡ ê°€ëŠ¥</td>
<td>ì¼ì‹œ ì •ì§€ (ë™ì‹œ ë°©ì‹ ì•„ë‹ˆë©´)</td>
</tr>
<tr>
<td><strong>ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ</strong></td>
<td>ì—†ìŒ</td>
<td>ê°ì²´ë‹¹ ì¹´ìš´íŠ¸</td>
<td>ë©”íƒ€ë°ì´í„° + ë³µì‚¬ ê³µê°„</td>
</tr>
<tr>
<td><strong>ì•ˆì „ì„±</strong></td>
<td>ë¶ˆì•ˆì „</td>
<td>ì•ˆì „ (ì‚¬ì´í´ ì œì™¸)</td>
<td>ì•ˆì „</td>
</tr>
<tr>
<td><strong>í”„ë¡œê·¸ë˜ë¨¸ ë…¸ë ¥</strong></td>
<td>ë†’ìŒ</td>
<td>ë‚®ìŒ</td>
<td>ë‚®ìŒ</td>
</tr>
<tr>
<td><strong>ë‹¨í¸í™”</strong></td>
<td>í• ë‹¹ê¸°ì— ë”°ë¼ ë‹¤ë¦„</td>
<td>ìˆìŒ</td>
<td>ì»´íŒ©íŠ¸/ë³µì‚¬ë¡œ í•´ê²°</td>
</tr>
</tbody>
</table>
<h3 id="15-conservative-vs-precise-gc">1.5 ë³´ìˆ˜ì (Conservative) vs ì •ë°€(Precise) GC<a class="header-link" href="#15-conservative-vs-precise-gc" title="Permanent link">&para;</a></h3>
<p><strong>ì •ë°€(exact) GC</strong>ëŠ” ìŠ¤íƒê³¼ ê°ì²´ì—ì„œ ì–´ë–¤ ê°’ì´ í¬ì¸í„°ì¸ì§€ ì •í™•íˆ ì•Œê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì»´íŒŒì¼ëŸ¬ì˜ í˜‘ë ¥(ìŠ¤íƒ ë§µ, íƒ€ì… ì •ë³´)ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<p><strong>ë³´ìˆ˜ì  GC</strong>ëŠ” ìŠ¤íƒì˜ ìœ íš¨í•œ í™ í¬ì¸í„°ì²˜ëŸ¼ ë³´ì´ëŠ” ëª¨ë“  ì›Œë“œ(word)ë¥¼ ì ì¬ì  í¬ì¸í„°ë¡œ ì·¨ê¸‰í•©ë‹ˆë‹¤. êµ¬í˜„ì´ ë” ë‹¨ìˆœí•˜ì§€ë§Œ ê°€ë¹„ì§€ë¥¼ ë³´ìœ í•  ìˆ˜ ìˆê³ (ê±°ì§“ í¬ì¸í„°) ê°ì²´ë¥¼ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤(í¬ì¸í„°ê°€ ì•„ë‹Œ ê°’ì„ "ìˆ˜ì •"í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ).</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_conservative_scan</span><span class="p">(</span><span class="n">stack_words</span><span class="p">,</span> <span class="n">heap_start</span><span class="p">,</span> <span class="n">heap_end</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate conservative stack scanning.</span>

<span class="sd">    Any value that looks like a heap address is treated as a pointer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">potential_roots</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stack_words</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">heap_start</span> <span class="o">&lt;=</span> <span class="n">word</span> <span class="o">&lt;</span> <span class="n">heap_end</span><span class="p">:</span>
            <span class="n">potential_roots</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">word</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Stack[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] = 0x</span><span class="si">{</span><span class="n">word</span><span class="si">:</span><span class="s2">08x</span><span class="si">}</span><span class="s2"> -- potential pointer (in heap range)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Stack[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] = 0x</span><span class="si">{</span><span class="n">word</span><span class="si">:</span><span class="s2">08x</span><span class="si">}</span><span class="s2"> -- not a pointer&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">potential_roots</span>


<span class="c1"># Example</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Conservative Stack Scan ===&quot;</span><span class="p">)</span>
<span class="n">stack</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mh">0x00000042</span><span class="p">,</span>   <span class="c1"># Integer 66 -- not a pointer</span>
    <span class="mh">0x08001000</span><span class="p">,</span>   <span class="c1"># In heap range -- potential pointer!</span>
    <span class="mh">0x00000000</span><span class="p">,</span>   <span class="c1"># NULL -- not in heap</span>
    <span class="mh">0x08003000</span><span class="p">,</span>   <span class="c1"># In heap range -- potential pointer!</span>
    <span class="mh">0x0800CAFE</span><span class="p">,</span>   <span class="c1"># In heap range but actually an integer -- false positive!</span>
<span class="p">]</span>

<span class="n">roots</span> <span class="o">=</span> <span class="n">demonstrate_conservative_scan</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="mh">0x08000000</span><span class="p">,</span> <span class="mh">0x08100000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Potential roots found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Note: 0x0800CAFE might be a false positive (an integer that happens&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;to look like a heap address). Conservative GC cannot tell the difference.&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="2">2. ì°¸ì¡° ê³„ìˆ˜<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 ê¸°ë³¸ ì°¸ì¡° ê³„ìˆ˜<a class="header-link" href="#21" title="Permanent link">&para;</a></h3>
<p>ìë™ ë©”ëª¨ë¦¬ ê´€ë¦¬ì˜ ê°€ì¥ ë‹¨ìˆœí•œ í˜•íƒœ: ê° ê°ì²´ëŠ” ëª‡ ê°œì˜ ì°¸ì¡°ê°€ ìì‹ ì„ ê°€ë¦¬í‚¤ëŠ”ì§€ ì¹´ìš´íŠ¸ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. ì¹´ìš´íŠ¸ê°€ 0ì´ ë˜ë©´ ê°ì²´ëŠ” ì¦‰ì‹œ í•´ì œë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RefCountedObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Object with reference counting.&quot;&quot;&quot;</span>

    <span class="n">_all_objects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Track all allocated objects for debugging</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">references</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># field_name -&gt; RefCountedObject</span>
        <span class="n">RefCountedObject</span><span class="o">.</span><span class="n">_all_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">inc_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dec_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_count</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_free</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_free</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Free this object and decrement refs to children.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Freeing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="c1"># Decrement reference counts of all referenced objects</span>
        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">dec_ref</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">RefCountedObject</span><span class="o">.</span><span class="n">_all_objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">new_obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a field to point to new_obj, updating ref counts.&quot;&quot;&quot;</span>
        <span class="c1"># Decrement old reference</span>
        <span class="n">old_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">old_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">old_obj</span><span class="o">.</span><span class="n">dec_ref</span><span class="p">()</span>

        <span class="c1"># Set new reference</span>
        <span class="k">if</span> <span class="n">new_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">inc_ref</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_obj</span>
        <span class="k">elif</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;RC(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, rc=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_ref_counting</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate reference counting in action.&quot;&quot;&quot;</span>
    <span class="n">RefCountedObject</span><span class="o">.</span><span class="n">_all_objects</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Reference Counting Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Create root (simulate stack reference)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">inc_ref</span><span class="p">()</span>  <span class="c1"># Stack reference</span>

    <span class="c1"># Allocate objects</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>

    <span class="c1"># Build object graph: root -&gt; A -&gt; B, root -&gt; C</span>
    <span class="n">root</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object graph: root -&gt; A -&gt; B, root -&gt; C&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objects: </span><span class="si">{</span><span class="n">RefCountedObject</span><span class="o">.</span><span class="n">_all_objects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ref counts: root=</span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">, A=</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">, &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;B=</span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">, C=</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Remove reference root -&gt; A</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Removing root -&gt; A...&quot;</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objects after removal: </span><span class="si">{</span><span class="n">RefCountedObject</span><span class="o">.</span><span class="n">_all_objects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># A&#39;s ref count drops to 0, A is freed, which drops B&#39;s ref count to 0, B is freed</span>

    <span class="c1"># Remove reference root -&gt; C</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Removing root -&gt; C...&quot;</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objects after removal: </span><span class="si">{</span><span class="n">RefCountedObject</span><span class="o">.</span><span class="n">_all_objects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_ref_counting</span><span class="p">()</span>
</code></pre></div>

<p>ì¶œë ¥:</p>
<div class="highlight"><pre><span></span><code><span class="o">===</span><span class="w"> </span><span class="n">Reference</span><span class="w"> </span><span class="n">Counting</span><span class="w"> </span><span class="n">Demo</span><span class="w"> </span><span class="o">===</span>

<span class="n">Object</span><span class="w"> </span><span class="nf">graph</span><span class="o">:</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span>
<span class="n">Objects</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">RC</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">RC</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">RC</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">Ref</span><span class="w"> </span><span class="n">counts</span><span class="o">:</span><span class="w"> </span><span class="n">root</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">=</span><span class="mi">1</span>

<span class="n">Removing</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">A</span><span class="p">...</span>
<span class="w">  </span><span class="n">Freeing</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="n">Freeing</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Objects</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">removal</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">RC</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">Removing</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">...</span>
<span class="w">  </span><span class="n">Freeing</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Objects</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">removal</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</code></pre></div>

<h3 id="22">2.2 ì¥ì ê³¼ ë‹¨ì <a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<p><strong>ì¥ì </strong>:
- <strong>ì¦‰ì‹œ íšŒìˆ˜</strong>: ê°ì²´ê°€ ê°€ë¹„ì§€ê°€ ë˜ëŠ” ì¦‰ì‹œ í•´ì œë¨
- <strong>ì¦ë¶„</strong>: ë¹„ìš©ì´ í”„ë¡œê·¸ë¨ ì‹¤í–‰ì— ê±¸ì³ ë¶„ì‚°ë¨ (ì¼ì‹œ ì •ì§€ ì—†ìŒ)
- <strong>ì§€ì—­ì„±</strong>: í•´ì œëœ ë©”ëª¨ë¦¬ê°€ ìµœê·¼ì— ì‚¬ìš©ë¨ (ìºì‹œì— ìˆì„ ê°€ëŠ¥ì„±)
- <strong>ë‹¨ìˆœì„±</strong>: ì´í•´í•˜ê³  êµ¬í˜„í•˜ê¸° ì‰¬ì›€</p>
<p><strong>ë‹¨ì </strong>:
- <strong>ì‚¬ì´í´</strong>: ìˆœí™˜ ê°€ë¹„ì§€ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ì—†ìŒ (3ì ˆ ì°¸ì¡°)
- <strong>ê³µê°„ ì˜¤ë²„í—¤ë“œ</strong>: ëª¨ë“  ê°ì²´ì— ì°¸ì¡° ì¹´ìš´íŠ¸ í•„ë“œ í•„ìš”
- <strong>ì‹œê°„ ì˜¤ë²„í—¤ë“œ</strong>: ëª¨ë“  í¬ì¸í„° í• ë‹¹ì— inc/dec ì—°ì‚° í•„ìš”
- <strong>ìŠ¤ë ˆë“œ ì•ˆì „ì„±</strong>: ë™ì‹œ í”„ë¡œê·¸ë¨ì—ì„œ ì°¸ì¡° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ì— ì›ì ì—°ì‚° í•„ìš”
- <strong>ìºì‹œ ë¹„ì¹œí™”ì </strong>: ì°¸ì¡° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ê°€ ê´€ë ¨ ì—†ëŠ” ê°ì²´ì˜ ìºì‹œ ë¼ì¸ì„ ë”ëŸ½í˜</p>
<h3 id="23-deferred-reference-counting">2.3 ì§€ì—° ì°¸ì¡° ê³„ìˆ˜(Deferred Reference Counting)<a class="header-link" href="#23-deferred-reference-counting" title="Permanent link">&para;</a></h3>
<p>ë§¤ìš° ìì£¼ ë³€ê²½ë˜ëŠ” ìŠ¤íƒ ì°¸ì¡° ì¶”ì ì˜ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì´ê¸° ìœ„í•´, <strong>ì§€ì—° ì°¸ì¡° ê³„ìˆ˜</strong>ëŠ” í™-í™ ì°¸ì¡°ë§Œ ì¶”ì í•©ë‹ˆë‹¤. ìŠ¤íƒ ì°¸ì¡°ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ìŠ¤íƒì„ ìŠ¤ìº”í•˜ì—¬ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DeferredRefCounting</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deferred reference counting: only count heap-to-heap references.</span>
<span class="sd">    Stack references are ignored in ref counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zero_count_table</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Objects with rc=0 (potential garbage)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack_roots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>       <span class="c1"># Current stack roots</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="c1"># Don&#39;t increment for stack reference</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">heap_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record heap-to-heap pointer write.&quot;&quot;&quot;</span>
        <span class="n">source</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stack_root_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">added</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">removed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Track stack root changes (deferred -- no ref count update).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">added</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack_roots</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">added</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">removed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack_roots</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">removed</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Periodic collection: scan stack roots to find true garbage.</span>
<span class="sd">        Objects with rc=0 that are NOT stack roots are garbage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Deferred RC Collection ---&quot;</span><span class="p">)</span>
        <span class="n">garbage</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap_objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">ref_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_roots</span><span class="p">:</span>
                <span class="n">garbage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Garbage: </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">garbage</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heap_objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Freed: </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">garbage</span><span class="p">)</span>
</code></pre></div>

<h3 id="24-coalesced-reference-counting">2.4 ë³‘í•© ì°¸ì¡° ê³„ìˆ˜(Coalesced Reference Counting)<a class="header-link" href="#24-coalesced-reference-counting" title="Permanent link">&para;</a></h3>
<p><strong>ë³‘í•© ì°¸ì¡° ê³„ìˆ˜</strong>ëŠ” ì°¸ì¡° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ë¥¼ ë²„í¼ì— ë‹´ì•„ ì ìš© ì „ì— í•©ì¹©ë‹ˆë‹¤. ì»¬ë ‰ì…˜ ì‚¬ì´ì— í¬ì¸í„° í•„ë“œê°€ ì—¬ëŸ¬ ë²ˆ ì“°ì´ë©´ ìˆœ íš¨ê³¼ë§Œ ê¸°ë¡ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CoalescedRefCounting</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coalesced reference counting: buffer ref count updates.</span>

<span class="sd">    Instead of updating counts on every pointer write, log</span>
<span class="sd">    the old and new values. At collection time, compute net changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="p">{}</span>      <span class="c1"># name -&gt; object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list of (old_target, new_target)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_field</span><span class="p">,</span> <span class="n">old_target</span><span class="p">,</span> <span class="n">new_target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log a pointer update instead of immediately changing ref counts.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">old_target</span><span class="p">,</span> <span class="n">new_target</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process buffered updates, computing net ref count changes.&quot;&quot;&quot;</span>
        <span class="c1"># Net changes per object</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">old_target</span><span class="p">,</span> <span class="n">new_target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">old_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">old_target</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">old_target</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">new_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">new_target</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_target</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coalesced updates:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">changes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="s1">&#39;+&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}{</span><span class="n">delta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">changes</span>
</code></pre></div>

<hr />
<h2 id="3">3. ì‚¬ì´í´ ê°ì§€<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ì‚¬ì´í´ ë¬¸ì œ<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<p>ì°¸ì¡° ê³„ìˆ˜ëŠ” ì‚¬ì´í´ì„ ìˆ˜ì§‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ì„œë¡œë¥¼ ì°¸ì¡°í•˜ì§€ë§Œ ë£¨íŠ¸ì—ì„œ ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ê°ì²´ë“¤ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_cycle_leak</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show how reference counting fails with cycles.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Cycle Leak Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>

    <span class="c1"># Both referenced from stack</span>
    <span class="n">a</span><span class="o">.</span><span class="n">inc_ref</span><span class="p">()</span>  <span class="c1"># stack ref</span>
    <span class="n">b</span><span class="o">.</span><span class="n">inc_ref</span><span class="p">()</span>  <span class="c1"># stack ref</span>

    <span class="c1"># Create cycle: A -&gt; B -&gt; A</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>   <span class="c1"># A.ref=1(stack), B.ref=1(stack)+1(A)=2</span>
    <span class="n">b</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>   <span class="c1"># A.ref=1(stack)+1(B)=2, B.ref=2</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before removing stack refs: A.rc=</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">, B.rc=</span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Remove stack references</span>
    <span class="n">a</span><span class="o">.</span><span class="n">dec_ref</span><span class="p">()</span>  <span class="c1"># A.rc = 2-1 = 1</span>
    <span class="n">b</span><span class="o">.</span><span class="n">dec_ref</span><span class="p">()</span>  <span class="c1"># B.rc = 2-1 = 1</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After removing stack refs: A.rc=</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">, B.rc=</span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Neither is freed! Both have rc=1 due to the cycle.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a memory leak.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># demonstrate_cycle_leak()</span>
</code></pre></div>

<h3 id="32-trial-deletion-">3.2 ì‹œí—˜ì  ì‚­ì œ(Trial Deletion) - ì¬í™œìš©ê¸° ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#32-trial-deletion-" title="Permanent link">&para;</a></h3>
<p>ì‹œí—˜ì  ì‚­ì œ ì•Œê³ ë¦¬ì¦˜(CPythonì—ì„œ ì‚¬ìš©)ì€ ë‚´ë¶€ ì°¸ì¡°ë¥¼ ì„ì‹œë¡œ ì œê±°í•˜ì—¬ ì‚¬ì´í´ì„ ì‹ë³„í•©ë‹ˆë‹¤:</p>
<ol>
<li>í›„ë³´ ì§‘í•©ì˜ ê° ê°ì²´ì— ëŒ€í•´, í•´ë‹¹ ê°ì²´ê°€ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  ê°ì²´ì˜ ì°¸ì¡° ì¹´ìš´íŠ¸ë¥¼ ì„ì‹œë¡œ ê°ì†Œì‹œí‚µë‹ˆë‹¤.</li>
<li>ì„ì‹œ ì¹´ìš´íŠ¸ê°€ 0ìœ¼ë¡œ ë–¨ì–´ì§€ëŠ” ê°ì²´ëŠ” ê°€ë¹„ì§€ì…ë‹ˆë‹¤.</li>
<li>ì™¸ë¶€ ì°¸ì¡°ì—ì„œ ì—¬ì „íˆ ë„ë‹¬ ê°€ëŠ¥í•œ ê°ì²´ëŠ” ì‚´ì•„ë‚¨ìŠµë‹ˆë‹¤.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CycleDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cycle detector using trial deletion algorithm.</span>
<span class="sd">    Based on the approach used in CPython&#39;s gc module.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Objects that might be in cycles</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an object to cycle detection tracking.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect_cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detect and collect cyclic garbage.</span>

<span class="sd">        Phase 1: Trial deletion -- tentatively decrement ref counts</span>
<span class="sd">                 for all internal references</span>
<span class="sd">        Phase 2: Scan -- objects with tentative rc &gt; 0 are reachable</span>
<span class="sd">                 (mark them and their transitive closure as alive)</span>
<span class="sd">        Phase 3: Collect -- remaining objects with tentative rc = 0 are garbage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Cycle Collection ===&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No tracked objects.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Phase 1: Compute tentative ref counts</span>
        <span class="n">tentative_rc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
            <span class="n">tentative_rc</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">ref_count</span>

        <span class="c1"># Subtract internal references</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tentative_rc</span><span class="p">:</span>
                    <span class="n">tentative_rc</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)]</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Phase 1 - Trial deletion (tentative ref counts):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">ref_count</span>
            <span class="n">tent</span> <span class="o">=</span> <span class="n">tentative_rc</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: original_rc=</span><span class="si">{</span><span class="n">orig</span><span class="si">}</span><span class="s2">, tentative_rc=</span><span class="si">{</span><span class="n">tent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Phase 2: Scan -- find objects reachable from roots or external refs</span>
        <span class="n">alive</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Objects with tentative_rc &gt; 0 have external references</span>
        <span class="n">worklist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tentative_rc</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="n">alive</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

        <span class="c1"># Also add objects reachable from root set</span>
        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">root_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alive</span><span class="p">:</span>
                <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="n">alive</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>

        <span class="c1"># Propagate reachability</span>
        <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alive</span> <span class="ow">and</span> <span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tentative_rc</span><span class="p">:</span>
                    <span class="n">alive</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>
                    <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Phase 2 - Reachability scan:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ALIVE&quot;</span> <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">alive</span> <span class="k">else</span> <span class="s2">&quot;GARBAGE&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Phase 3: Collect garbage</span>
        <span class="n">garbage</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span>
                   <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alive</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Phase 3 - Collection:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">garbage</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Collecting </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">garbage</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_cycle_detection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate cycle detection with trial deletion.&quot;&quot;&quot;</span>
    <span class="n">RefCountedObject</span><span class="o">.</span><span class="n">_all_objects</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Cycle Detection Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">detector</span> <span class="o">=</span> <span class="n">CycleDetector</span><span class="p">()</span>

    <span class="c1"># Create objects</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">inc_ref</span><span class="p">()</span>  <span class="c1"># stack reference</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>  <span class="c1"># Not in cycle, reachable from root</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>  <span class="c1"># In cycle but unreachable</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">RefCountedObject</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)</span>  <span class="c1"># In cycle but unreachable</span>

    <span class="c1"># Build graph</span>
    <span class="n">root</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;child&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="c1"># Create unreachable cycle: D &lt;-&gt; E</span>
    <span class="n">d</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;partner&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">e</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;partner&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

    <span class="c1"># Track potentially cyclic objects</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">]:</span>
        <span class="n">detector</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object graph:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  root -&gt; C -&gt; A&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  D &lt;-&gt; E  (unreachable cycle)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">garbage</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">collect_cycles</span><span class="p">(</span><span class="n">root_set</span><span class="o">=</span><span class="p">[</span><span class="n">root</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Garbage collected: </span><span class="si">{</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">garbage</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_cycle_detection</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="4-">4. ë§ˆí¬-ìŠ¤ìœ• ì»¬ë ‰ì…˜<a class="header-link" href="#4-" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#41" title="Permanent link">&para;</a></h3>
<p>ë§ˆí¬-ìŠ¤ìœ•ì€ ê°€ì¥ ê¸°ë³¸ì ì¸ ì¶”ì  ì»¬ë ‰í„°ì…ë‹ˆë‹¤. ë‘ ë‹¨ê³„ë¡œ ì‘ë™í•©ë‹ˆë‹¤:</p>
<ol>
<li><strong>ë§ˆí¬ ë‹¨ê³„</strong>: ë£¨íŠ¸ ì§‘í•©ì—ì„œ ì‹œì‘í•˜ì—¬ ë„ë‹¬ ê°€ëŠ¥í•œ ëª¨ë“  ê°ì²´ë¥¼ ìˆœíšŒí•˜ê³  í‘œì‹œí•©ë‹ˆë‹¤.</li>
<li><strong>ìŠ¤ìœ• ë‹¨ê³„</strong>: ì „ì²´ í™ì„ ìŠ¤ìº”í•˜ê³ , í‘œì‹œë˜ì§€ ì•Šì€ ê°ì²´ëŠ” ê°€ë¹„ì§€ì´ë¯€ë¡œ í•´ì œí•©ë‹ˆë‹¤.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MarkSweepGC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mark-Sweep garbage collector implementation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heap_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span> <span class="o">=</span> <span class="n">heap_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># All allocated objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># Root references</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_freed</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allocate a new object on the heap.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span><span class="p">:</span>
            <span class="c1"># Trigger GC</span>
            <span class="n">freed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Out of memory: need </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">, &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;have </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">used</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
            <span class="s1">&#39;marked&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="p">[],</span>  <span class="c1"># List of referenced objects</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">+=</span> <span class="n">size</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an object to the root set.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove an object from the root set.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a reference from source to target.&quot;&quot;&quot;</span>
        <span class="n">source</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run mark-sweep collection.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- GC #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collections</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">used</span><span class="si">}</span><span class="s2"> bytes used&quot;</span><span class="p">)</span>

        <span class="c1"># Mark phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mark</span><span class="p">()</span>

        <span class="c1"># Sweep phase</span>
        <span class="n">freed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweep</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">used</span><span class="si">}</span><span class="s2"> bytes used&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Freed: </span><span class="si">{</span><span class="n">freed</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_freed</span> <span class="o">+=</span> <span class="n">freed</span>
        <span class="k">return</span> <span class="n">freed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_mark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark all reachable objects starting from the root set.&quot;&quot;&quot;</span>
        <span class="c1"># Clear all marks</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># DFS from roots</span>
        <span class="n">worklist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                    <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sweep the heap, freeing unmarked objects.&quot;&quot;&quot;</span>
        <span class="n">freed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">surviving</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                <span class="n">surviving</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">freed</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="o">-=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Swept: </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> bytes)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">surviving</span>
        <span class="k">return</span> <span class="n">freed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print heap status.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Heap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">used</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span><span class="si">}</span><span class="s2"> bytes used &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">used</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objects: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Roots: </span><span class="si">{</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">reachable</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                <span class="n">reachable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reachable: </span><span class="si">{</span><span class="n">reachable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_mark_sweep</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Full demonstration of mark-sweep GC.&quot;&quot;&quot;</span>
    <span class="n">gc</span> <span class="o">=</span> <span class="n">MarkSweepGC</span><span class="p">(</span><span class="n">heap_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Mark-Sweep GC Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Allocate objects</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_root</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

    <span class="c1"># Build object graph</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_reference</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_reference</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_reference</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="c1"># D and E are unreachable</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>

    <span class="c1"># Run collection</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>

    <span class="c1"># Allocate more (into freed space)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_reference</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="c1"># Remove root -&gt; B (makes B, F unreachable)</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>

<span class="n">demonstrate_mark_sweep</span><span class="p">()</span>
</code></pre></div>

<h3 id="42-free-list-management">4.2 ììœ  ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬(Free List Management)<a class="header-link" href="#42-free-list-management" title="Permanent link">&para;</a></h3>
<p>ìŠ¤ìœ• í›„, í•´ì œëœ ë©”ëª¨ë¦¬ ë¸”ë¡ì€ <strong>ììœ  ë¦¬ìŠ¤íŠ¸(free list)</strong>ì— ë°°ì¹˜ë©ë‹ˆë‹¤. ë¯¸ë˜ì˜ í• ë‹¹ì€ ì´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì í•©í•œ ë¸”ë¡ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FreeListAllocator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Free list memory allocator used with mark-sweep GC.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heap_size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span> <span class="o">=</span> <span class="n">heap_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">heap_size</span><span class="p">)</span>
        <span class="c1"># Free list: list of (start, size) sorted by address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_list</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">heap_size</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># start_addr -&gt; (size, name)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allocate using first-fit strategy.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">block_size</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">block_size</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">:</span>
                <span class="c1"># Allocate from this block</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">block_size</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
                    <span class="c1"># Shrink the free block</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">size</span><span class="p">,</span> <span class="n">block_size</span> <span class="o">-</span> <span class="n">size</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Remove the free block entirely</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">start</span>

        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Out of memory</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">free</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Free a block and coalesce adjacent free blocks.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">addr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Address </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2"> not allocated&quot;</span><span class="p">)</span>

        <span class="n">size</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>

        <span class="c1"># Insert into free list (maintaining sorted order)</span>
        <span class="n">new_block</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">inserted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">addr</span> <span class="o">&lt;</span> <span class="n">start</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">new_block</span><span class="p">)</span>
                <span class="n">inserted</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inserted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_block</span><span class="p">)</span>

        <span class="c1"># Coalesce adjacent free blocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coalesce</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_coalesce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge adjacent free blocks.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">merged</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">prev_start</span><span class="p">,</span> <span class="n">prev_size</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">prev_start</span> <span class="o">+</span> <span class="n">prev_size</span> <span class="o">==</span> <span class="n">start</span><span class="p">:</span>
                <span class="c1"># Adjacent -- merge</span>
                <span class="n">merged</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">prev_start</span><span class="p">,</span> <span class="n">prev_size</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">free_list</span> <span class="o">=</span> <span class="n">merged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print heap layout.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Heap layout:&quot;</span><span class="p">)</span>
        <span class="c1"># Combine allocated and free blocks, sort by address</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">addr</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">addr</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_list</span><span class="p">:</span>
            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s2">&quot;[FREE]&quot;</span><span class="p">))</span>
        <span class="n">blocks</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
            <span class="n">bar</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">addr</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">addr</span><span class="o">+</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">bar</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes)&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_free_list</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show free list management and fragmentation.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Free List Allocator ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">alloc</span> <span class="o">=</span> <span class="n">FreeListAllocator</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Allocate several blocks</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">alloc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">alloc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">alloc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">alloc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">alloc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

    <span class="n">alloc</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>

    <span class="c1"># Free B and D (creates fragmentation)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Freeing B and D...&quot;</span><span class="p">)</span>
    <span class="n">alloc</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">alloc</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="n">alloc</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>

    <span class="c1"># Try to allocate 25 bytes -- no single free block is large enough!</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Trying to allocate 25 bytes...&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">alloc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  FAILED: External fragmentation!&quot;</span><span class="p">)</span>
        <span class="n">total_free</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">size</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">alloc</span><span class="o">.</span><span class="n">free_list</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total free: </span><span class="si">{</span><span class="n">total_free</span><span class="si">}</span><span class="s2"> bytes, but no contiguous block &gt;= 25&quot;</span><span class="p">)</span>

<span class="n">demonstrate_free_list</span><span class="p">()</span>
</code></pre></div>

<h3 id="43-">4.3 ë§ˆí¬-ìŠ¤ìœ• ë³µì¡ë„<a class="header-link" href="#43-" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ì‹œê°„</strong>: $O(L + H)$ (ë§ˆí¬ ë‹¨ê³„ì˜ ë¼ì´ë¸Œ ê°ì²´ $L$, ìŠ¤ìœ• ë‹¨ê³„ì˜ í™ í¬ê¸° $H$). ìŠ¤ìœ•ì€ ì „ì²´ í™ì„ ìŠ¤ìº”í•´ì•¼ í•©ë‹ˆë‹¤.</li>
<li><strong>ê³µê°„</strong>: ê°ì²´ë‹¹ ë§ˆí¬ ë¹„íŠ¸ 1ê°œ (ê°ì²´ í—¤ë”ì— ì €ì¥ ê°€ëŠ¥).</li>
<li><strong>ì¼ì‹œ ì •ì§€ ì‹œê°„</strong>: í™ í¬ê¸°ì— ë¹„ë¡€ (ë§ˆí¬ì™€ ìŠ¤ìœ• ë‹¨ê³„ ëª¨ë‘ í”„ë¡œê·¸ë¨ ì¬ê°œ ì „ì— ì™„ë£Œë˜ì–´ì•¼ í•¨).</li>
</ul>
<hr />
<h2 id="5-">5. ë§ˆí¬-ì»´íŒ©íŠ¸ ì»¬ë ‰ì…˜<a class="header-link" href="#5-" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 ë™ê¸°<a class="header-link" href="#51" title="Permanent link">&para;</a></h3>
<p>ë§ˆí¬-ìŠ¤ìœ•ì€ í™ì„ ë‹¨í¸í™”ëœ ìƒíƒœë¡œ ë‚¨ê¹ë‹ˆë‹¤: ë¼ì´ë¸Œ ê°ì²´ë“¤ì´ ììœ  ë¸”ë¡ë“¤ ì‚¬ì´ì— í©ì–´ì ¸ ìˆìŠµë‹ˆë‹¤. <strong>ë§ˆí¬-ì»´íŒ©íŠ¸</strong>ëŠ” ë¼ì´ë¸Œ ê°ì²´ë“¤ì„ ëª¨ë‘ í™ì˜ í•œìª½ ëìœ¼ë¡œ ë°€ì–´ë„£ì–´ ë‹¨í¸í™”ë¥¼ ì œê±°í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">Before</span><span class="w"> </span><span class="nl">compaction</span><span class="p">:</span>
<span class="w">  </span><span class="o">[</span><span class="n">A</span><span class="o">][</span><span class="n">FREE</span><span class="o">][</span><span class="n">B</span><span class="o">][</span><span class="n">FREE</span><span class="o">][</span><span class="n">FREE</span><span class="o">][</span><span class="n">C</span><span class="o">][</span><span class="n">D</span><span class="o">][</span><span class="n">FREE</span><span class="o">][</span><span class="n">E</span><span class="o">][</span><span class="n">FREE</span><span class="o">]</span>

<span class="k">After</span><span class="w"> </span><span class="nl">compaction</span><span class="p">:</span>
<span class="w">  </span><span class="o">[</span><span class="n">A</span><span class="o">][</span><span class="n">B</span><span class="o">][</span><span class="n">C</span><span class="o">][</span><span class="n">D</span><span class="o">][</span><span class="n">E</span><span class="o">][</span><span class="n">FREE FREE FREE FREE FREE...</span><span class="o">]</span>
</code></pre></div>

<h3 id="52">5.2 ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#52" title="Permanent link">&para;</a></h3>
<p>ë§ˆí¬-ì»´íŒ©íŠ¸ëŠ” ì„¸ ë²ˆ(ë˜ëŠ” ë„¤ ë²ˆ)ì˜ íŒ¨ìŠ¤ë¡œ ì‘ë™í•©ë‹ˆë‹¤:</p>
<ol>
<li><strong>ë§ˆí¬</strong>: ë§ˆí¬-ìŠ¤ìœ•ê³¼ ë™ì¼ -- ë„ë‹¬ ê°€ëŠ¥í•œ ëª¨ë“  ê°ì²´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</li>
<li><strong>ì „ë‹¬ ì£¼ì†Œ ê³„ì‚°</strong>: í™ì„ ìŠ¤ìº”í•˜ì—¬ ê° ë¼ì´ë¸Œ ê°ì²´ì˜ ìƒˆ ì£¼ì†Œ(ì´ë™í•  ìœ„ì¹˜)ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.</li>
<li><strong>ì°¸ì¡° ì—…ë°ì´íŠ¸</strong>: ëª¨ë“  ê°ì²´ë¥¼ ìŠ¤ìº”í•˜ì—¬ ê° í¬ì¸í„°ë¥¼ ì „ë‹¬ ì£¼ì†Œë¡œ êµì²´í•©ë‹ˆë‹¤.</li>
<li><strong>ì»´íŒ©íŠ¸</strong>: ê° ê°ì²´ë¥¼ ì „ë‹¬ ì£¼ì†Œë¡œ ì´ë™í•©ë‹ˆë‹¤.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MarkCompactGC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mark-Compact garbage collector.</span>

<span class="sd">    Eliminates fragmentation by compacting live objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heap_size</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span> <span class="o">=</span> <span class="n">heap_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list of dicts with &#39;name&#39;, &#39;size&#39;, &#39;addr&#39;, &#39;references&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_addr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_addr</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_addr</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span><span class="s2">&quot;Out of memory after compaction&quot;</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
            <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_addr</span><span class="p">,</span>
            <span class="s1">&#39;marked&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;forward&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>      <span class="c1"># Forwarding address</span>
            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_addr</span> <span class="o">+=</span> <span class="n">size</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Mark-Compact GC ---&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_heap</span><span class="p">(</span><span class="s2">&quot;Before&quot;</span><span class="p">)</span>

        <span class="c1"># Phase 1: Mark</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">worklist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                    <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="c1"># Phase 2: Compute forwarding addresses</span>
        <span class="n">compact_addr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;forward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compact_addr</span>
                <span class="n">compact_addr</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;forward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Garbage: </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> at addr </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;addr&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Phase 3: Update references</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ref</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]</span>
                <span class="p">]</span>

        <span class="c1"># Phase 4: Compact (move objects)</span>
        <span class="n">live_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]:</span>
                <span class="n">old_addr</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;addr&#39;</span><span class="p">]</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;addr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;forward&#39;</span><span class="p">]</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;forward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;marked&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">live_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">old_addr</span> <span class="o">!=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;addr&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Moved </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">old_addr</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;addr&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">live_objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_addr</span> <span class="o">=</span> <span class="n">compact_addr</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_print_heap</span><span class="p">(</span><span class="s2">&quot;After&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_print_heap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">bar</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;addr&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">5s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">bar</span><span class="si">}</span><span class="s2"> &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;(size=</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, refs=</span><span class="si">{</span><span class="n">refs</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Next free address: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">next_addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Free space: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">next_addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_mark_compact</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate mark-compact GC.&quot;&quot;&quot;</span>
    <span class="n">gc</span> <span class="o">=</span> <span class="n">MarkCompactGC</span><span class="p">(</span><span class="n">heap_size</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Mark-Compact GC Demo ===&quot;</span><span class="p">)</span>

    <span class="c1"># Allocate objects</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">root_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>

    <span class="c1"># root -&gt; A -&gt; C, root -&gt; E</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">]</span>
    <span class="n">a</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="c1"># B and D are unreachable</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

<span class="n">demonstrate_mark_compact</span><span class="p">()</span>
</code></pre></div>

<h3 id="53">5.3 íŠ¸ë ˆì´ë“œì˜¤í”„<a class="header-link" href="#53" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ì¸¡ë©´</th>
<th>ë§ˆí¬-ìŠ¤ìœ•</th>
<th>ë§ˆí¬-ì»´íŒ©íŠ¸</th>
</tr>
</thead>
<tbody>
<tr>
<td>ë‹¨í¸í™”</td>
<td>ìˆìŒ</td>
<td>ì—†ìŒ</td>
</tr>
<tr>
<td>í• ë‹¹ ì†ë„</td>
<td>ëŠë¦¼ (ììœ  ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰)</td>
<td>ë¹ ë¦„ (ë²”í”„ í¬ì¸í„°)</td>
</tr>
<tr>
<td>ì»¬ë ‰ì…˜ íŒ¨ìŠ¤</td>
<td>2</td>
<td>3-4</td>
</tr>
<tr>
<td>ê°ì²´ ì´ë™</td>
<td>ì—†ìŒ</td>
<td>ìˆìŒ (ëª¨ë“  í¬ì¸í„° ì—…ë°ì´íŠ¸ í•„ìš”)</td>
</tr>
<tr>
<td>ìºì‹œ ì§€ì—­ì„±</td>
<td>ë‚˜ì¨ (ë¶„ì‚°)</td>
<td>ì¢‹ìŒ (ì»´íŒ©íŠ¸)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6">6. ë³µì‚¬ ì»¬ë ‰í„°<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61-semi-space">6.1 ì„¸ë¯¸-ìŠ¤í˜ì´ìŠ¤(Semi-Space) ì»¬ë ‰í„°<a class="header-link" href="#61-semi-space" title="Permanent link">&para;</a></h3>
<p><strong>ì„¸ë¯¸-ìŠ¤í˜ì´ìŠ¤</strong> ë³µì‚¬ ì»¬ë ‰í„°ëŠ” í™ì„ ë‘ ì ˆë°˜ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤: <strong>from-space</strong>ì™€ <strong>to-space</strong>. í• ë‹¹ì€ ë²”í”„ í¬ì¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ from-spaceì—ì„œ ì¼ì–´ë‚©ë‹ˆë‹¤. ì»¬ë ‰ì…˜ ì¤‘ì— ë¼ì´ë¸Œ ê°ì²´ëŠ” to-spaceë¡œ ë³µì‚¬ë˜ê³ , ê³µê°„ì´ êµí™˜ë©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">Before</span><span class="w"> </span><span class="nl">collection</span><span class="p">:</span>
<span class="w">  </span><span class="k">From</span><span class="o">-</span><span class="nf">space</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">A</span><span class="o">][</span><span class="n">B</span><span class="o">][</span><span class="n">C</span><span class="o">][</span><span class="n">D</span><span class="o">][</span><span class="n">E</span><span class="o">]</span><span class="w">  </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">live</span><span class="p">)</span>
<span class="w">  </span><span class="k">To</span><span class="o">-</span><span class="nf">space</span><span class="err">:</span><span class="w">   </span><span class="o">[</span><span class="n">empty..........</span><span class="o">]</span>

<span class="k">After</span><span class="w"> </span><span class="nl">collection</span><span class="p">:</span>
<span class="w">  </span><span class="k">To</span><span class="o">-</span><span class="nf">space</span><span class="err">:</span><span class="w">   </span><span class="o">[</span><span class="n">A</span><span class="o">][</span><span class="n">C</span><span class="o">][</span><span class="n">E</span><span class="o">][</span><span class="n">free..</span><span class="o">]</span><span class="w">   </span><span class="p">(</span><span class="n">now</span><span class="w"> </span><span class="n">becomes</span><span class="w"> </span><span class="k">from</span><span class="o">-</span><span class="nf">space</span><span class="p">)</span>
<span class="w">  </span><span class="k">From</span><span class="o">-</span><span class="nf">space</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">abandoned.........</span><span class="o">]</span><span class="w">  </span><span class="p">(</span><span class="n">now</span><span class="w"> </span><span class="n">becomes</span><span class="w"> </span><span class="k">to</span><span class="o">-</span><span class="nf">space</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SemiSpaceGC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Semi-space copying garbage collector.</span>

<span class="sd">    Key idea: Copy live objects from &#39;from-space&#39; to &#39;to-space&#39;,</span>
<span class="sd">    then swap the spaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heap_size</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space_size</span> <span class="o">=</span> <span class="n">heap_size</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="c1"># Each space is a list of objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_space</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_used</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allocate in from-space using bump pointer.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_used</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">space_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_used</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">space_size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span><span class="s2">&quot;Out of memory&quot;</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;forwarding&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Points to copy in to-space</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_used</span> <span class="o">+=</span> <span class="n">size</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cheney&#39;s breadth-first copying collection.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Copying GC #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">collections</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From-space: </span><span class="si">{</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">from_space</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">to_used</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">scan_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Copy roots</span>
        <span class="n">new_roots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">:</span>
            <span class="n">copied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
            <span class="n">new_roots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copied</span><span class="p">)</span>
            <span class="n">to_used</span> <span class="o">+=</span> <span class="n">copied</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>

        <span class="c1"># Cheney&#39;s scanning: breadth-first traversal</span>
        <span class="k">while</span> <span class="n">scan_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_space</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span><span class="p">[</span><span class="n">scan_index</span><span class="p">]</span>
            <span class="n">new_refs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]:</span>
                <span class="n">copied_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
                <span class="n">new_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copied_ref</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">copied_ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copied_ref</span><span class="p">)</span>
                    <span class="n">to_used</span> <span class="o">+=</span> <span class="n">copied_ref</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
            <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_refs</span>
            <span class="n">scan_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Swap spaces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_used</span> <span class="o">=</span> <span class="n">to_used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span> <span class="o">=</span> <span class="n">new_roots</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;To-space (new from): </span><span class="si">{</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">from_space</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_space</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_used</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy an object to to-space (if not already copied).</span>
<span class="sd">        Uses forwarding pointer to avoid duplicate copies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forwarding&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;forwarding&#39;</span><span class="p">]</span>

        <span class="c1"># Create copy in to-space</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">],</span>
            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]),</span>  <span class="c1"># Will be updated</span>
            <span class="s1">&#39;forwarding&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Set forwarding pointer in original</span>
        <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;forwarding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span>

        <span class="c1"># Add to to-space</span>
        <span class="k">if</span> <span class="n">copy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Copied: </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copy</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_copying_gc</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate semi-space copying GC.&quot;&quot;&quot;</span>
    <span class="n">gc</span> <span class="o">=</span> <span class="n">SemiSpaceGC</span><span class="p">(</span><span class="n">heap_size</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Copying GC Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">root_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>   <span class="c1"># Will be garbage</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>   <span class="c1"># Will be garbage</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>

    <span class="c1"># root -&gt; A -&gt; C, root -&gt; E</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">]</span>
    <span class="n">a</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allocated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gc</span><span class="o">.</span><span class="n">from_space</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects, </span><span class="si">{</span><span class="n">gc</span><span class="o">.</span><span class="n">from_used</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Live: root, A, C, E  |  Garbage: B, D&quot;</span><span class="p">)</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">After GC: </span><span class="si">{</span><span class="n">gc</span><span class="o">.</span><span class="n">from_used</span><span class="si">}</span><span class="s2"> bytes in use &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;(freed </span><span class="si">{</span><span class="mi">120</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gc</span><span class="o">.</span><span class="n">from_used</span><span class="si">}</span><span class="s2"> bytes from B and D)&quot;</span><span class="p">)</span>

<span class="n">demonstrate_copying_gc</span><span class="p">()</span>
</code></pre></div>

<h3 id="62-cheney">6.2 ì²´ë‹ˆ(Cheney)ì˜ ì•Œê³ ë¦¬ì¦˜<a class="header-link" href="#62-cheney" title="Permanent link">&para;</a></h3>
<p><strong>ì²´ë‹ˆ ì•Œê³ ë¦¬ì¦˜</strong>(1970)ì˜ í•µì‹¬ í†µì°°ì€ ë„ˆë¹„ ìš°ì„  ë³µì‚¬ê°€ to-space ìì²´ë¥¼ ì‘ì—… íë¡œ ì‚¬ìš©í•˜ì—¬ <strong>ì¶”ê°€ ë©”ëª¨ë¦¬ ì—†ì´</strong> ìˆ˜í–‰ë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">To</span><span class="o">-</span><span class="nf">space</span><span class="err">:</span>
<span class="w">  </span><span class="o">[</span><span class="n">root</span><span class="o">][</span><span class="n">A</span><span class="o">]</span><span class="p">...</span><span class="o">[</span><span class="n">E</span><span class="o">]</span><span class="p">...</span><span class="o">[</span><span class="n">C</span><span class="o">]</span><span class="p">...</span>
<span class="w">   </span><span class="o">^</span><span class="n">scan</span><span class="w">      </span><span class="o">^</span><span class="k">free</span>

<span class="n">scan</span><span class="w"> </span><span class="nl">pointer</span><span class="p">:</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="p">(</span><span class="n">scan</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="k">references</span><span class="p">)</span>
<span class="k">free</span><span class="w"> </span><span class="nl">pointer</span><span class="p">:</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">free</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="p">(</span><span class="k">where</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">object</span><span class="p">)</span>

<span class="k">When</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">catches</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">free</span><span class="p">,</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">complete</span><span class="p">.</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cheneys_algorithm_detailed</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detailed simulation of Cheney&#39;s algorithm showing scan/free pointers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Cheney&#39;s Algorithm Trace ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Simulate objects as (name, size, references)</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">]},</span>
        <span class="s1">&#39;A&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]},</span>
        <span class="s1">&#39;B&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="p">[]},</span>          <span class="c1"># Garbage</span>
        <span class="s1">&#39;C&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="p">[]},</span>
        <span class="s1">&#39;D&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="p">[]},</span>          <span class="c1"># Garbage</span>
        <span class="s1">&#39;E&#39;</span><span class="p">:</span>    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]},</span>       <span class="c1"># Note: E -&gt; A</span>
    <span class="p">}</span>

    <span class="c1"># To-space: flat array with scan and free pointers</span>
    <span class="n">to_space</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">copied</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># old name -&gt; to-space index</span>
    <span class="n">scan</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">free</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy_object</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">free</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">copied</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copied</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_space</span><span class="p">)</span>
        <span class="n">to_space</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">],</span> <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">])})</span>
        <span class="n">copied</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">free</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Copy </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> to to-space[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">] (free=</span><span class="si">{</span><span class="n">free</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">idx</span>

    <span class="c1"># Step 1: Copy root</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 1: Copy root to to-space&quot;</span><span class="p">)</span>
    <span class="n">copy_object</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>

    <span class="c1"># Step 2: Scan loop</span>
    <span class="n">step</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">scan_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">scan_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_space</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">to_space</span><span class="p">[</span><span class="n">scan_idx</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">: Scan </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (scan_idx=</span><span class="si">{</span><span class="n">scan_idx</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="n">new_refs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ref_name</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">]:</span>
            <span class="n">to_idx</span> <span class="o">=</span> <span class="n">copy_object</span><span class="p">(</span><span class="n">ref_name</span><span class="p">)</span>
            <span class="n">new_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">to_space</span><span class="p">[</span><span class="n">to_idx</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

        <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_refs</span>
        <span class="n">scan_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Done! scan=</span><span class="si">{</span><span class="n">scan_idx</span><span class="si">}</span><span class="s2">, to-space has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">to_space</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To-space contents:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">to_space</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (size=</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, refs=</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Garbage not copied: B, D&quot;</span><span class="p">)</span>

<span class="n">cheneys_algorithm_detailed</span><span class="p">()</span>
</code></pre></div>

<h3 id="63">6.3 ë³µì‚¬ ì»¬ë ‰ì…˜ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„<a class="header-link" href="#63" title="Permanent link">&para;</a></h3>
<p><strong>ì¥ì </strong>:
- ë¹ ë¥¸ í• ë‹¹ (ë²”í”„ í¬ì¸í„° -- ì¹´ìš´í„°ë§Œ ì¦ê°€)
- ë‹¨í¸í™” ì—†ìŒ (ë³µì‚¬ ì¤‘ì— ê°ì²´ê°€ ì»´íŒ©íŠ¸ë¨)
- ì»¬ë ‰ì…˜ ì‹œê°„ì´ ë¼ì´ë¸Œ ë°ì´í„°ì—ë§Œ ë¹„ë¡€ (ì£½ì€ ê°ì²´ëŠ” ë‹¨ìˆœíˆ ë¬´ì‹œë¨)
- ìºì‹œ ì§€ì—­ì„± í–¥ìƒ (ìˆœíšŒ ìˆœì„œë¡œ ë³µì‚¬ë¨)</p>
<p><strong>ë‹¨ì </strong>:
- í™ì˜ ì ˆë°˜ ë‚­ë¹„ (í•œ ë²ˆì— í•œ ì„¸ë¯¸-ìŠ¤í˜ì´ìŠ¤ë§Œ ì‚¬ìš© ê°€ëŠ¥)
- ëª¨ë“  ë¼ì´ë¸Œ ê°ì²´ë¥¼ ë§¤ ì»¬ë ‰ì…˜ë§ˆë‹¤ ë³µì‚¬í•´ì•¼ í•¨ (ì¥ê¸° ë°ì´í„°ê°€ ë§ìœ¼ë©´ ë¹„ìŒˆ)
- ì´ë™ëœ ê°ì²´ë¡œì˜ ëª¨ë“  í¬ì¸í„°ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•¨</p>
<p><strong>í•µì‹¬ ë³µì¡ë„</strong>: ì»¬ë ‰ì…˜ ì‹œê°„ì€ $O(L)$ ($L$ì€ ë¼ì´ë¸Œ ë°ì´í„° í¬ê¸°), ë§ˆí¬-ìŠ¤ìœ•ì˜ $O(L + H)$($H$ = ì „ì²´ í™ í¬ê¸°)ì™€ ë¹„êµë©ë‹ˆë‹¤.</p>
<hr />
<h2 id="7">7. ì„¸ëŒ€ë³„ ì»¬ë ‰ì…˜<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 ì„¸ëŒ€ë³„ ê°€ì„¤<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<p><strong>ì„¸ëŒ€ë³„ ê°€ì„¤</strong>(ìœ ì•„ ì‚¬ë§ë¥  ë˜ëŠ” ì•½í•œ ì„¸ëŒ€ë³„ ê°€ì„¤ì´ë¼ê³ ë„ í•¨)ì€ ë‹¤ìŒì„ ì£¼ì¥í•©ë‹ˆë‹¤:</p>
<blockquote>
<p>ëŒ€ë¶€ë¶„ì˜ ê°ì²´ëŠ” ì Šì–´ì„œ ì£½ëŠ”ë‹¤.</p>
</blockquote>
<p>ë§ì€ ì–¸ì–´ì— ê±¸ì¹œ ì‹¤ì¦ì  ì—°êµ¬ëŠ” í• ë‹¹ì˜ ëŒ€ë¶€ë¶„ì´ ë§¤ìš° ë¹¨ë¦¬ ê°€ë¹„ì§€ê°€ ëœë‹¤ëŠ” ê²ƒì„ ì¼ê´€ë˜ê²Œ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ ë¶„í¬ëŠ” ì¼ë°˜ì ìœ¼ë¡œ "ìš•ì¡° ê³¡ì„ "ì„ ë”°ë¦…ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">Object</span><span class="w"> </span><span class="n">Survival</span><span class="w"> </span><span class="n">Rate</span>
<span class="w">     </span><span class="o">^</span>
<span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="o">|*</span>
<span class="w">     </span><span class="o">|</span><span class="w">  </span><span class="o">*</span>
<span class="w">     </span><span class="o">|</span><span class="w">    </span><span class="o">*</span>
<span class="w">     </span><span class="o">|</span><span class="w">      </span><span class="o">**</span>
<span class="w">     </span><span class="o">|</span><span class="w">         </span><span class="o">****</span>
<span class="w">     </span><span class="o">|</span><span class="w">              </span><span class="o">********************</span><span class="w">  </span><span class="p">(</span><span class="n">long</span><span class="o">-</span><span class="n">lived</span><span class="w"> </span><span class="n">objects</span><span class="p">)</span>
<span class="w">     </span><span class="o">+------------------------------------&gt;</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">Age</span>
<span class="w">       </span><span class="n">Young</span><span class="w">                    </span><span class="n">Old</span>
</code></pre></div>

<h3 id="72-gc">7.2 ì„¸ëŒ€ë³„ GC ì„¤ê³„<a class="header-link" href="#72-gc" title="Permanent link">&para;</a></h3>
<p>ì´ ê°€ì„¤ì„ ê¸°ë°˜ìœ¼ë¡œ, ì„¸ëŒ€ë³„ GCëŠ” í™ì„ ì„¸ëŒ€ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Heap                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Young Gen  â”‚                Old Generation                 â”‚
â”‚   (Nursery)  â”‚               (Tenured)                       â”‚
â”‚              â”‚                                               â”‚
â”‚  Small, fast â”‚  Large, collected infrequently                â”‚
â”‚  collected   â”‚                                               â”‚
â”‚  frequently  â”‚                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ~10%      â”‚                    ~90%                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<ul>
<li>ìƒˆ ê°ì²´ëŠ” <strong>Young ì„¸ëŒ€(nursery)</strong>ì— í• ë‹¹ë©ë‹ˆë‹¤.</li>
<li>ë„ˆì„œë¦¬ëŠ” ìì£¼ ìˆ˜ì§‘ë©ë‹ˆë‹¤ (ë§ˆì´ë„ˆ GC) -- ëŒ€ë¶€ë¶„ì˜ ê°ì²´ê°€ ì£½ì–´ìˆìŒ.</li>
<li>ëª‡ ë²ˆì˜ ë„ˆì„œë¦¬ ì»¬ë ‰ì…˜ì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ëŠ” <strong>ìŠ¹ì§„(tenured)</strong>ë˜ì–´ Old ì„¸ëŒ€ë¡œ ì´ë™í•©ë‹ˆë‹¤.</li>
<li>Old ì„¸ëŒ€ëŠ” ë“œë¬¼ê²Œ ìˆ˜ì§‘ë©ë‹ˆë‹¤ (ë©”ì´ì € GC).</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GenerationalGC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Two-generation garbage collector.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nursery_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">old_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">promotion_threshold</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nursery_size</span> <span class="o">=</span> <span class="n">nursery_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_size</span> <span class="o">=</span> <span class="n">old_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">promotion_threshold</span> <span class="o">=</span> <span class="n">promotion_threshold</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nursery_used</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_used</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Write barrier: track old-to-young pointers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remembered_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minor_collections</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major_collections</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allocate in nursery (young generation).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery_used</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minor_gc</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery_used</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery_size</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">major_gc</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery_used</span> <span class="o">+</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery_size</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span><span class="s2">&quot;Out of memory&quot;</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
            <span class="s1">&#39;generation&#39;</span><span class="p">:</span> <span class="s1">&#39;young&#39;</span><span class="p">,</span>
            <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>          <span class="c1"># Number of GCs survived</span>
            <span class="s1">&#39;marked&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nursery_used</span> <span class="o">+=</span> <span class="n">size</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_barrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write barrier: called when source.field = target.</span>

<span class="sd">        If source is in old gen and target is in nursery,</span>
<span class="sd">        record source in the remembered set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">source</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;old&#39;</span> <span class="ow">and</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;young&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remembered_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
            <span class="c1"># In practice, we&#39;d store the actual object reference</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">minor_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect the nursery (young generation).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minor_collections</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Minor GC #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">minor_collections</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nursery: </span><span class="si">{</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">nursery</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Roots for nursery collection:</span>
        <span class="c1"># 1. Program roots that point into nursery</span>
        <span class="c1"># 2. Old-to-young references (remembered set)</span>
        <span class="n">nursery_roots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">root</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;young&#39;</span><span class="p">:</span>
                <span class="n">nursery_roots</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
            <span class="c1"># Also trace from roots into nursery</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">root</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;young&#39;</span><span class="p">:</span>
                    <span class="n">nursery_roots</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>

        <span class="c1"># Trace from old gen (via remembered set)</span>
        <span class="k">for</span> <span class="n">old_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">old_obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;young&#39;</span><span class="p">:</span>
                    <span class="n">nursery_roots</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>

        <span class="c1"># Mark reachable nursery objects</span>
        <span class="n">marked</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">worklist</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span> <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nursery_roots</span><span class="p">]</span>

        <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">marked</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;young&#39;</span> <span class="ow">and</span> <span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">:</span>
                    <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="c1"># Process nursery objects</span>
        <span class="n">survivors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">promoted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">freed</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">:</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">promotion_threshold</span><span class="p">:</span>
                    <span class="c1"># Promote to old generation</span>
                    <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;generation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;old&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">old_used</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
                    <span class="n">promoted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">survivors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">freed</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Freed: </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span> <span class="o">=</span> <span class="n">survivors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nursery_used</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">promoted</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Promoted to old gen: </span><span class="si">{</span><span class="n">promoted</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Freed </span><span class="si">{</span><span class="n">freed</span><span class="si">}</span><span class="s2"> bytes, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nursery</span><span class="p">)</span><span class="si">}</span><span class="s2"> nursery objects remain&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">major_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Full heap collection (both generations).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major_collections</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Major GC #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">major_collections</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>

        <span class="n">all_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span>

        <span class="c1"># Mark from roots</span>
        <span class="n">marked</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">worklist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">marked</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">:</span>
                    <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="c1"># Sweep both generations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span> <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span> <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marked</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nursery_used</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_used</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span><span class="p">)</span>

        <span class="n">freed_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_objects</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nursery</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Freed </span><span class="si">{</span><span class="n">freed_count</span><span class="si">}</span><span class="s2"> objects&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Nursery: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nursery_used</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nursery_size</span><span class="si">}</span><span class="s2"> &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nursery</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Old gen: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">old_used</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">old_size</span><span class="si">}</span><span class="s2"> &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_gen</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects)&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_generational_gc</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate generational GC with promotions.&quot;&quot;&quot;</span>
    <span class="n">gc</span> <span class="o">=</span> <span class="n">GenerationalGC</span><span class="p">(</span><span class="n">nursery_size</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">old_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">promotion_threshold</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Generational GC Demo ===&quot;</span><span class="p">)</span>

    <span class="c1"># Create a long-lived root</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">root_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="c1"># Simulate workload: allocate temporary objects with some long-lived</span>
    <span class="k">for</span> <span class="n">wave</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Allocation wave </span><span class="si">{</span><span class="n">wave</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---&quot;</span><span class="p">)</span>

        <span class="c1"># Long-lived object (will eventually be promoted)</span>
        <span class="n">long_lived</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L</span><span class="si">{</span><span class="n">wave</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">root</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">long_lived</span><span class="p">)</span>

        <span class="c1"># Short-lived temporaries</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T</span><span class="si">{</span><span class="n">wave</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="c1"># temp is not referenced by anything persistent -&gt; garbage</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total minor GCs: </span><span class="si">{</span><span class="n">gc</span><span class="o">.</span><span class="n">minor_collections</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total major GCs: </span><span class="si">{</span><span class="n">gc</span><span class="o">.</span><span class="n">major_collections</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_generational_gc</span><span class="p">()</span>
</code></pre></div>

<h3 id="73-write-barriers">7.3 ì“°ê¸° ë°°ë¦¬ì–´(Write Barriers)<a class="header-link" href="#73-write-barriers" title="Permanent link">&para;</a></h3>
<p>ì„¸ëŒ€ë³„ GCì˜ í•µì‹¬ ê³¼ì œ: Old ì„¸ëŒ€ ê°ì²´ê°€ ë„ˆì„œë¦¬ ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? ë§ˆì´ë„ˆ GC ì¤‘ì—ëŠ” ë„ˆì„œë¦¬ë§Œ ìŠ¤ìº”í•©ë‹ˆë‹¤ -- ì´ ì°¸ì¡°ë¥¼ ë†“ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
<p><strong>ì“°ê¸° ë°°ë¦¬ì–´(write barrier)</strong>ëŠ” ëª¨ë“  í¬ì¸í„° ì €ì¥ì„ ê°€ë¡œì±„ì–´ ì´ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤. Old ê°ì²´ê°€ Young ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ìˆ˜ì •ë˜ë©´, Old ê°ì²´ë¥¼ <strong>ê¸°ì–µ ì§‘í•©(remembered set)</strong>(ì¹´ë“œ í…Œì´ë¸”ì´ë¼ê³ ë„ í•¨)ì— ì¶”ê°€í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CardTable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Card table write barrier implementation.</span>

<span class="sd">    The heap is divided into &#39;cards&#39; (e.g., 512-byte blocks).</span>
<span class="sd">    When a pointer in a card is modified, the card is marked dirty.</span>
<span class="sd">    During minor GC, only dirty cards are scanned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heap_size</span><span class="p">,</span> <span class="n">card_size</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">card_size</span> <span class="o">=</span> <span class="n">card_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cards</span> <span class="o">=</span> <span class="p">(</span><span class="n">heap_size</span> <span class="o">+</span> <span class="n">card_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">card_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cards</span>  <span class="c1"># False = clean, True = dirty</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_dirty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark the card containing this address as dirty.&quot;&quot;&quot;</span>
        <span class="n">card_index</span> <span class="o">=</span> <span class="n">address</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">card_size</span>
        <span class="k">if</span> <span class="n">card_index</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cards</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="n">card_index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dirty_cards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return indices of all dirty cards.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dirty</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">)</span> <span class="k">if</span> <span class="n">dirty</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all dirty bits after scanning.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cards</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;D&#39;</span> <span class="k">if</span> <span class="n">d</span> <span class="k">else</span> <span class="s1">&#39;.&#39;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">)</span>


<span class="c1"># Example</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Card Table Write Barrier ===&quot;</span><span class="p">)</span>
<span class="n">ct</span> <span class="o">=</span> <span class="n">CardTable</span><span class="p">(</span><span class="n">heap_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">card_size</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Card table (</span><span class="si">{</span><span class="n">ct</span><span class="o">.</span><span class="n">num_cards</span><span class="si">}</span><span class="s2"> cards): </span><span class="si">{</span><span class="n">ct</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Simulate pointer writes at various addresses</span>
<span class="n">writes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">3500</span><span class="p">]</span>
<span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">writes</span><span class="p">:</span>
    <span class="n">ct</span><span class="o">.</span><span class="n">mark_dirty</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Write at addr </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2"> -&gt; card </span><span class="si">{</span><span class="n">addr</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">512</span><span class="si">}</span><span class="s2"> dirty&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Card table: </span><span class="si">{</span><span class="n">ct</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dirty cards to scan: </span><span class="si">{</span><span class="n">ct</span><span class="o">.</span><span class="n">get_dirty_cards</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="74">7.4 ë‹¤ì¤‘ ì„¸ëŒ€ ë°©ì‹<a class="header-link" href="#74" title="Permanent link">&para;</a></h3>
<p>ë§ì€ í”„ë¡œë•ì…˜ ì»¬ë ‰í„°ëŠ” ë‘ ì„¸ëŒ€ ì´ìƒì„ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="nv">JVM</span><span class="w"> </span><span class="nv">Generational</span><span class="w"> </span><span class="nv">Layout</span>:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">   </span><span class="nv">Young</span><span class="w"> </span><span class="nv">Gen</span><span class="w">    </span>â”‚<span class="w">          </span><span class="nv">Old</span><span class="w"> </span><span class="nv">Generation</span><span class="w">               </span>â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¤<span class="w">                                       </span>â”‚
â”‚<span class="nv">Eden</span>â”‚<span class="w"> </span><span class="nv">S0</span><span class="w">  </span>â”‚<span class="w"> </span><span class="nv">S1</span><span class="w">  </span>â”‚<span class="w">                                       </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="ss">(</span><span class="nv">from</span>â”‚<span class="ss">(</span><span class="nv">to</span><span class="ss">)</span><span class="w"> </span>â”‚<span class="w">                                       </span>â”‚
â”‚<span class="w">    </span>â”‚<span class="nv">surv</span><span class="ss">)</span>â”‚<span class="nv">surv</span><span class="ss">)</span>â”‚<span class="w">                                       </span>â”‚
â”œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚<span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">objects</span><span class="w">     </span>â”‚<span class="w"> </span><span class="nv">Objects</span><span class="w"> </span><span class="nv">surviving</span><span class="w"> </span><span class="nv">multiple</span><span class="w">            </span>â”‚
â”‚<span class="w"> </span><span class="nv">allocated</span><span class="w"> </span><span class="nv">here</span><span class="w">  </span>â”‚<span class="w"> </span><span class="nv">minor</span><span class="w"> </span><span class="nv">GCs</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">promoted</span><span class="w"> </span><span class="nv">here</span><span class="w">           </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">Eden</span>:<span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">allocations</span>
<span class="nv">S0</span><span class="o">/</span><span class="nv">S1</span>:<span class="w"> </span><span class="nv">Survivor</span><span class="w"> </span><span class="nv">spaces</span><span class="w"> </span><span class="ss">(</span><span class="nv">semi</span><span class="o">-</span><span class="nv">space</span><span class="w"> </span><span class="nv">copying</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">young</span><span class="w"> </span><span class="nv">gen</span><span class="ss">)</span>
<span class="nv">Old</span>:<span class="w"> </span><span class="nv">Long</span><span class="o">-</span><span class="nv">lived</span><span class="w"> </span><span class="nv">objects</span>
</code></pre></div>

<hr />
<h2 id="8-gc">8. ì¦ë¶„ ë° ë™ì‹œ GC<a class="header-link" href="#8-gc" title="Permanent link">&para;</a></h2>
<h3 id="81">8.1 ì¼ì‹œ ì •ì§€ ë¬¸ì œ<a class="header-link" href="#81" title="Permanent link">&para;</a></h3>
<p>STW(Stop-the-World) GCëŠ” ì»¬ë ‰ì…˜ ì¤‘ì— ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤ë ˆë“œ(<strong>ë®¤í…Œì´í„°</strong> ìŠ¤ë ˆë“œ)ë¥¼ ë©ˆì¶¥ë‹ˆë‹¤. ì¸í„°ë™í‹°ë¸Œ ë˜ëŠ” ì‹¤ì‹œê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì´ëŸ¬í•œ ì¼ì‹œ ì •ì§€ëŠ” ë¬¸ì œê°€ ë©ë‹ˆë‹¤.</p>
<table>
<thead>
<tr>
<th>ì• í”Œë¦¬ì¼€ì´ì…˜</th>
<th>í—ˆìš© ê°€ëŠ¥í•œ ì¼ì‹œ ì •ì§€</th>
</tr>
</thead>
<tbody>
<tr>
<td>ë°°ì¹˜ ì²˜ë¦¬</td>
<td>ìˆ˜ ì´ˆ</td>
</tr>
<tr>
<td>ì›¹ ì„œë²„</td>
<td>100ms</td>
</tr>
<tr>
<td>ì¸í„°ë™í‹°ë¸Œ UI</td>
<td>16ms (60 FPS)</td>
</tr>
<tr>
<td>íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ</td>
<td>&lt; 1ms</td>
</tr>
<tr>
<td>í•˜ë“œ ì‹¤ì‹œê°„</td>
<td>ì ˆëŒ€ ë¶ˆê°€</td>
</tr>
</tbody>
</table>
<h3 id="82-incremental-collection">8.2 ì¦ë¶„ ì»¬ë ‰ì…˜(Incremental Collection)<a class="header-link" href="#82-incremental-collection" title="Permanent link">&para;</a></h3>
<p><strong>ì¦ë¶„ GC</strong>ëŠ” ì»¬ë ‰ì…˜ì„ ì‘ì€ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ë®¤í…Œì´í„° ì‹¤í–‰ê³¼ êµëŒ€ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>Stop-the-world:
  Mutator â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  GC                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Incremental:
  Mutator â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  GC            â–‘      â–‘      â–‘      â–‘
              (small increments)
</code></pre></div>

<p>ê³¼ì œ: ì»¬ë ‰í„°ê°€ ì‘ë™í•˜ëŠ” ë™ì•ˆ ë®¤í…Œì´í„°ê°€ ê°ì²´ ê·¸ë˜í”„ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h3 id="83-concurrent-collection">8.3 ë™ì‹œ ì»¬ë ‰ì…˜(Concurrent Collection)<a class="header-link" href="#83-concurrent-collection" title="Permanent link">&para;</a></h3>
<p><strong>ë™ì‹œ GC</strong>ëŠ” ë®¤í…Œì´í„°ì™€ ë™ì‹œì— ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ ì»¬ë ‰í„°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">Concurrent</span><span class="o">:</span>
<span class="w">  </span><span class="n">Mutator</span><span class="w"> </span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span>
<span class="w">  </span><span class="n">GC</span><span class="w">      </span><span class="err">â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘</span>
<span class="w">          </span><span class="o">(</span><span class="n">runs</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">separate</span><span class="w"> </span><span class="n">thread</span><span class="o">)</span>
</code></pre></div>

<p>ì´ëŠ” ë™ì‹œ ìˆ˜ì •ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ì‹ ì¤‘í•œ ë™ê¸°í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="9">9. ì‚¼ìƒ‰ ë§ˆí‚¹<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="91">9.1 ì‚¼ìƒ‰ ì¶”ìƒí™”<a class="header-link" href="#91" title="Permanent link">&para;</a></h3>
<p>ì‚¼ìƒ‰ ë§ˆí‚¹(tri-color marking)ì€ ì¦ë¶„ ë° ë™ì‹œ GCì— ëŒ€í•œ ì¶”ë¡ ì„ ìœ„í•œ í”„ë ˆì„ì›Œí¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê°ì²´ëŠ” ì„¸ ê°€ì§€ ìƒ‰ìœ¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤:</p>
<ul>
<li><strong>í°ìƒ‰(White)</strong>: ì•„ì§ ë°©ë¬¸í•˜ì§€ ì•ŠìŒ (ì ì¬ì  ê°€ë¹„ì§€).</li>
<li><strong>íšŒìƒ‰(Grey)</strong>: ë°©ë¬¸í–ˆì§€ë§Œ ì°¸ì¡°ê°€ ì•„ì§ ìŠ¤ìº”ë˜ì§€ ì•ŠìŒ.</li>
<li><strong>ê²€ì€ìƒ‰(Black)</strong>: ë°©ë¬¸í–ˆê³  ëª¨ë“  ì°¸ì¡°ê°€ ìŠ¤ìº”ë¨.</li>
</ul>
<div class="highlight"><pre><span></span><code>ë¶ˆë³€ ì¡°ê±´: ê²€ì€ìƒ‰ ê°ì²´ê°€ í°ìƒ‰ ê°ì²´ë¥¼ ì§ì ‘ ê°€ë¦¬í‚¤ì§€ ì•ŠìŒ.
           (ê²€ì€ìƒ‰ ê°ì²´ì˜ ëª¨ë“  ì°¸ì¡°ëŠ” ê²€ì€ìƒ‰ ë˜ëŠ” íšŒìƒ‰ ê°ì²´ë¡œ í–¥í•¨.)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">WHITE</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>
    <span class="n">GREY</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span>
    <span class="n">BLACK</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TriColorGC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tri-color marking garbage collector.</span>

<span class="sd">    Demonstrates incremental collection using the tri-color abstraction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># name -&gt; {&#39;color&#39;: Color, &#39;refs&#39;: [names]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grey_set</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>  <span class="c1"># Worklist of grey objects</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">refs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">,</span>
            <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="n">refs</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_marking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize marking: color all roots grey.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Initialize Marking ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREY</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grey_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Root </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> -&gt; GREY&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_print_state</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One incremental marking step: process one grey object.</span>

<span class="sd">        Returns True if there is more work to do.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grey_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Pick a grey object</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grey_set</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mark step: Processing </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Scan its references</span>
        <span class="k">for</span> <span class="n">ref_name</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ref_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">ref_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">ref_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ref_obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                    <span class="n">ref_obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREY</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grey_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_name</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">ref_name</span><span class="si">}</span><span class="s2">: WHITE -&gt; GREY&quot;</span><span class="p">)</span>

        <span class="c1"># Mark this object black</span>
        <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: GREY -&gt; BLACK&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_print_state</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grey_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sweep: collect all white objects.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Sweep ===&quot;</span><span class="p">)</span>
        <span class="n">garbage</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                   <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">garbage</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Collected: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Reset colors for next cycle</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span>

        <span class="k">return</span> <span class="n">garbage</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_print_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">white</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">]</span>
        <span class="n">grey</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREY</span><span class="p">]</span>
        <span class="n">black</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  State: WHITE=</span><span class="si">{</span><span class="n">white</span><span class="si">}</span><span class="s2">, GREY=</span><span class="si">{</span><span class="n">grey</span><span class="si">}</span><span class="s2">, BLACK=</span><span class="si">{</span><span class="n">black</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_tricolor</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate incremental tri-color marking.&quot;&quot;&quot;</span>
    <span class="n">gc</span> <span class="o">=</span> <span class="n">TriColorGC</span><span class="p">()</span>

    <span class="c1"># Create object graph</span>
    <span class="c1">#   root -&gt; A -&gt; C</span>
    <span class="c1">#        -&gt; B -&gt; D</span>
    <span class="c1">#   E (unreachable)</span>
    <span class="c1">#   F -&gt; G (both unreachable)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">])</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="p">[])</span>           <span class="c1"># Unreachable</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">])</span>        <span class="c1"># Unreachable</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">[])</span>           <span class="c1"># Unreachable</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">add_root</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Tri-Color Marking Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object graph: root -&gt; {A -&gt; C, B -&gt; D}, E, F -&gt; G&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">init_marking</span><span class="p">()</span>

    <span class="c1"># Incremental marking steps</span>
    <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">gc</span><span class="o">.</span><span class="n">mark_step</span><span class="p">():</span>
        <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Final step (returns False)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Marking complete after </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2"> steps&quot;</span><span class="p">)</span>

    <span class="c1"># Sweep</span>
    <span class="n">garbage</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Garbage collected: </span><span class="si">{</span><span class="n">garbage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Surviving objects: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">gc</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_tricolor</span><span class="p">()</span>
</code></pre></div>

<h3 id="92">9.2 ìƒì–´ë²„ë¦° ê°ì²´ ë¬¸ì œ<a class="header-link" href="#92" title="Permanent link">&para;</a></h3>
<p>ë®¤í…Œì´í„°ê°€ ì¦ë¶„ ë§ˆí‚¹ ì¤‘ì— ê°ì²´ ê·¸ë˜í”„ë¥¼ ìˆ˜ì •í•˜ë©´, ë¼ì´ë¸Œ ê°ì²´ê°€ ëˆ„ë½ë˜ì–´ ê°€ë¹„ì§€ë¡œ ìˆ˜ì§‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‹¤ìŒ ê²½ìš°ì— ë°œìƒí•©ë‹ˆë‹¤:</p>
<ol>
<li>ë®¤í…Œì´í„°ê°€ ê²€ì€ìƒ‰ ê°ì²´ì—ì„œ í°ìƒ‰ ê°ì²´ë¡œì˜ ì°¸ì¡°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.</li>
<li>ë®¤í…Œì´í„°ê°€ ê·¸ í°ìƒ‰ ê°ì²´ë¡œì˜ ëª¨ë“  íšŒìƒ‰-í°ìƒ‰ ê²½ë¡œë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.</li>
</ol>
<p>ì´ì œ í°ìƒ‰ ê°ì²´ëŠ” ë„ë‹¬ ê°€ëŠ¥í•˜ì§€ë§Œ íšŒìƒ‰ ì„ í–‰ìê°€ ì—†ì–´ ìˆ˜ì§‘ë  ê²ƒì…ë‹ˆë‹¤!</p>
<div class="highlight"><pre><span></span><code><span class="kr">Before</span><span class="w"> </span><span class="n">mutator</span><span class="w"> </span><span class="n">action</span><span class="o">:</span>
<span class="w">  </span><span class="p">[</span><span class="n">BLACK</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">GREY</span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">WHITE</span><span class="o">:</span><span class="w"> </span><span class="n">C</span><span class="p">]</span>

<span class="n">Mutator</span><span class="w"> </span><span class="n">does</span><span class="o">:</span>
<span class="w">  </span><span class="n">A</span><span class="p">.</span><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="w">     </span><span class="p">(</span><span class="n">black</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">white</span><span class="o">!</span><span class="p">)</span>
<span class="w">  </span><span class="n">B</span><span class="p">.</span><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">null</span><span class="w">  </span><span class="p">(</span><span class="n">removes</span><span class="w"> </span><span class="n">grey</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">white</span><span class="w"> </span><span class="n">path</span><span class="p">)</span>

<span class="n">After</span><span class="o">:</span>
<span class="w">  </span><span class="p">[</span><span class="n">BLACK</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">WHITE</span><span class="o">:</span><span class="w"> </span><span class="n">C</span><span class="p">]</span><span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">reachable</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">missed</span><span class="o">!</span>
<span class="w">  </span><span class="p">[</span><span class="n">GREY</span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="p">]</span>
</code></pre></div>

<h3 id="93">9.3 ì“°ê¸° ë°°ë¦¬ì–´ í•´ê²°ì±…<a class="header-link" href="#93" title="Permanent link">&para;</a></h3>
<p>ìƒì–´ë²„ë¦° ê°ì²´ ë¬¸ì œë¥¼ ë°©ì§€í•˜ëŠ” ë‘ ê°€ì§€ ì ‘ê·¼ ë°©ì‹:</p>
<p><strong>Dijkstraì˜ ì“°ê¸° ë°°ë¦¬ì–´</strong> (ì²˜ìŒë¶€í„° ìŠ¤ëƒ…ìƒ·): ë®¤í…Œì´í„°ê°€ í°ìƒ‰ ê°ì²´ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì €ì¥í•  ë•Œ, ëŒ€ìƒì„ íšŒìƒ‰ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dijkstra_write_barrier</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">new_target</span><span class="p">,</span> <span class="n">gc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dijkstra&#39;s insertion barrier.</span>
<span class="sd">    When writing a reference, if the target is white, mark it grey.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">new_target</span> <span class="ow">and</span> <span class="n">gc</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">new_target</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">new_target</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREY</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">grey_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_target</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Barrier: </span><span class="si">{</span><span class="n">new_target</span><span class="si">}</span><span class="s2"> WHITE -&gt; GREY (insertion barrier)&quot;</span><span class="p">)</span>

    <span class="c1"># Perform the actual write</span>
    <span class="n">source_obj</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">source</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">field</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">]):</span>
        <span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_target</span>
</code></pre></div>

<p><strong>Steeleì˜ ì“°ê¸° ë°°ë¦¬ì–´</strong> (ì¦ë¶„ ì—…ë°ì´íŠ¸): ê²€ì€ìƒ‰ ê°ì²´ê°€ ìˆ˜ì •ë  ë•Œ, ì†ŒìŠ¤ë¥¼ íšŒìƒ‰ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤ (ì¬ìŠ¤ìº”).</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">steele_write_barrier</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">new_target</span><span class="p">,</span> <span class="n">gc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Steele&#39;s write barrier.</span>
<span class="sd">    When a black object gets a new reference, mark it grey (rescan it).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_obj</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">source</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">:</span>
        <span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREY</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">grey_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Barrier: </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> BLACK -&gt; GREY (rescan)&quot;</span><span class="p">)</span>

    <span class="c1"># Perform the actual write</span>
    <span class="k">if</span> <span class="n">field</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">]):</span>
        <span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_target</span>
</code></pre></div>

<h3 id="94-yuasa-snapshot-at-the-beginning">9.4 Yuasaì˜ ì²˜ìŒë¶€í„° ìŠ¤ëƒ…ìƒ·(Snapshot-at-the-Beginning)<a class="header-link" href="#94-yuasa-snapshot-at-the-beginning" title="Permanent link">&para;</a></h3>
<p>Yuasaì˜ ì‚­ì œ ë°°ë¦¬ì–´ëŠ” í°ìƒ‰ ê°ì²´ê°€ ë§ˆì§€ë§‰ íšŒìƒ‰ ì„ í–‰ìë¥¼ ìƒì§€ ì•Šë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ì°¸ì¡°ë¥¼ ì‚­ì œí•  ë•Œ, ì´ì „ ëŒ€ìƒì´ í°ìƒ‰ì´ë©´ íšŒìƒ‰ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">yuasa_write_barrier</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">new_target</span><span class="p">,</span> <span class="n">gc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yuasa&#39;s deletion barrier (snapshot-at-the-beginning).</span>
<span class="sd">    When overwriting a reference, grey the OLD target if it&#39;s white.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_obj</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">source</span><span class="p">]</span>
    <span class="n">old_target</span> <span class="o">=</span> <span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="k">if</span> <span class="n">field</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">old_target</span> <span class="ow">and</span> <span class="n">gc</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">old_target</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">old_target</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREY</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">grey_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">old_target</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Barrier: </span><span class="si">{</span><span class="n">old_target</span><span class="si">}</span><span class="s2"> WHITE -&gt; GREY (deletion barrier)&quot;</span><span class="p">)</span>

    <span class="c1"># Perform the actual write</span>
    <span class="k">if</span> <span class="n">field</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">]):</span>
        <span class="n">source_obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_target</span>
</code></pre></div>

<hr />
<h2 id="10-gc">10. ì‹¤ì œ ì‹œìŠ¤í…œì˜ GC<a class="header-link" href="#10-gc" title="Permanent link">&para;</a></h2>
<h3 id="101-jvm">10.1 JVM ê°€ë¹„ì§€ ì»¬ë ‰í„°<a class="header-link" href="#101-jvm" title="Permanent link">&para;</a></h3>
<p>JVMì€ ì—¬ëŸ¬ GC êµ¬í˜„ì„ ì œê³µí•©ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ì»¬ë ‰í„°</th>
<th>ìœ í˜•</th>
<th>ì„¸ëŒ€</th>
<th>ì¼ì‹œ ì •ì§€ ëª©í‘œ</th>
<th>ìµœì  ì‚¬ìš©ì²˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Serial GC</strong></td>
<td>STW</td>
<td>Young + Old</td>
<td>ì—†ìŒ</td>
<td>ì†Œí˜• í™, ë‹¨ì¼ ì½”ì–´</td>
</tr>
<tr>
<td><strong>Parallel GC</strong></td>
<td>STW, ë³‘ë ¬</td>
<td>Young + Old</td>
<td>ì²˜ë¦¬ëŸ‰</td>
<td>ë°°ì¹˜, ë°±ê·¸ë¼ìš´ë“œ</td>
</tr>
<tr>
<td><strong>CMS</strong> (deprecated)</td>
<td>ë™ì‹œ ë§ˆí¬-ìŠ¤ìœ•</td>
<td>Young + Old</td>
<td>ë‚®ì€ ì§€ì—°</td>
<td>JDK 14ì—ì„œ deprecated</td>
</tr>
<tr>
<td><strong>G1</strong></td>
<td>ë¦¬ì „ ê¸°ë°˜, ë™ì‹œ</td>
<td>Young + Old</td>
<td>ì„¤ì • ê°€ëŠ¥</td>
<td>ë²”ìš© (ê¸°ë³¸ê°’)</td>
</tr>
<tr>
<td><strong>ZGC</strong></td>
<td>ë™ì‹œ, ë¦¬ì „ ê¸°ë°˜</td>
<td>ì„¸ëŒ€ ì—†ìŒ*</td>
<td>&lt; 10ms</td>
<td>ëŒ€í˜• í™ (TB ê·œëª¨)</td>
</tr>
<tr>
<td><strong>Shenandoah</strong></td>
<td>ë™ì‹œ, ì»´íŒ©íŠ¸</td>
<td>ì„¸ëŒ€ ì—†ìŒ*</td>
<td>&lt; 10ms</td>
<td>ì €ì§€ì—°</td>
</tr>
</tbody>
</table>
<p><strong>G1(Garbage First) ì»¬ë ‰í„°</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">G1</span><span class="w"> </span><span class="n">Heap</span><span class="w"> </span><span class="n">Layout</span><span class="w"> </span><span class="p">(</span><span class="n">region</span><span class="o">-</span><span class="n">based</span><span class="p">)</span><span class="o">:</span>

<span class="err">â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”</span>
<span class="err">â”‚</span><span class="n">E</span><span class="w"> </span><span class="err">â”‚</span><span class="n">E</span><span class="w"> </span><span class="err">â”‚</span><span class="n">S</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="n">O</span><span class="w"> </span><span class="err">â”‚</span><span class="n">O</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="n">O</span><span class="w"> </span><span class="err">â”‚</span><span class="n">H</span><span class="w"> </span><span class="err">â”œâ”€â”€â”¤</span><span class="w">  </span><span class="err">â”‚</span><span class="n">E</span><span class="w"> </span><span class="err">â”‚</span><span class="n">O</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="n">S</span><span class="w"> </span><span class="err">â”‚</span><span class="n">O</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜</span>

<span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eden</span><span class="w"> </span><span class="p">(</span><span class="n">young</span><span class="p">)</span><span class="w">       </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Survivor</span><span class="w"> </span><span class="p">(</span><span class="n">young</span><span class="p">)</span>
<span class="n">O</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Old</span><span class="w">                </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Humongous</span><span class="w"> </span><span class="p">(</span><span class="k">large</span><span class="w"> </span><span class="n">objects</span><span class="p">,</span><span class="w"> </span><span class="n">spans</span><span class="w"> </span><span class="n">regions</span><span class="p">)</span>
<span class="p">(</span><span class="n">empty</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Free</span><span class="w"> </span><span class="n">region</span>

<span class="n">Key</span><span class="w"> </span><span class="nl">idea:</span><span class="w"> </span><span class="n">Collect</span><span class="w"> </span><span class="n">regions</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">garbage</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;garbage first&quot;</span><span class="p">).</span>
<span class="w">          </span><span class="n">Pause</span><span class="w"> </span><span class="kt">time</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">controlled</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">collecting</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">subset</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">regions</span><span class="p">.</span>
</code></pre></div>

<p><strong>ZGC</strong> í•µì‹¬ ê¸°ë²•:
- <strong>ì»¬ëŸ¬ í¬ì¸í„°(Colored pointers)</strong>: 64ë¹„íŠ¸ í¬ì¸í„°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¹„íŠ¸ë¥¼ GC ë©”íƒ€ë°ì´í„°ë¡œ ì‚¬ìš©
- <strong>ë¡œë“œ ë°°ë¦¬ì–´(Load barriers)</strong>: ëª¨ë“  ë¡œë“œ ì‹œ í¬ì¸í„°ë¥¼ í™•ì¸í•˜ê³  ìˆ˜ì • (ì €ì¥ì´ ì•„ë‹Œ)
- <strong>ë™ì‹œ ì¬ë°°ì¹˜(Concurrent relocation)</strong>: ë®¤í…Œì´í„° ì‹¤í–‰ ì¤‘ì— ê°ì²´ ì´ë™
- í™ í¬ê¸°ì— ê´€ê³„ì—†ì´ 10ms ë¯¸ë§Œì˜ ì¼ì‹œ ì •ì§€ ì‹œê°„</p>
<h3 id="102-go">10.2 Go ê°€ë¹„ì§€ ì»¬ë ‰í„°<a class="header-link" href="#102-go" title="Permanent link">&para;</a></h3>
<p>GoëŠ” <strong>ë™ì‹œ, ì‚¼ìƒ‰ ë§ˆí¬-ìŠ¤ìœ•</strong> ì»¬ë ‰í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<ul>
<li>ë¹„ì„¸ëŒ€ì  (ëª¨ë“  ê°ì²´ê°€ í•˜ë‚˜ì˜ ê³µê°„ì—)</li>
<li>Dijkstraì˜ ì“°ê¸° ë°°ë¦¬ì–´ë¥¼ ì‚¬ìš©í•œ ë™ì‹œ ë§ˆí‚¹</li>
<li>ë£¨íŠ¸ ìŠ¤ìº”ì—ë§Œ STW ì¼ì‹œ ì •ì§€ (ì¼ë°˜ì ìœ¼ë¡œ &lt; 1ms)</li>
<li>ëª©í‘œ: ì²˜ë¦¬ëŸ‰ ìµœëŒ€í™”ê°€ ì•„ë‹Œ ì§€ì—° ìµœì†Œí™”</li>
<li>í˜ì´ì‹±: í™ì´ ë¼ì´ë¸Œ ì„¸íŠ¸ì˜ 2ë°°ë¡œ ì»¤ì§ˆ ë•Œ GC ì‹œì‘</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">Go</span><span class="w"> </span><span class="n">GC</span><span class="w"> </span><span class="nl">Phases</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="nl">STW</span><span class="p">:</span><span class="w"> </span><span class="n">Scan</span><span class="w"> </span><span class="n">stacks</span><span class="p">,</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="n">barrier</span><span class="w">  </span><span class="p">(</span><span class="o">~</span><span class="mi">100</span><span class="n">Î¼s</span><span class="p">)</span>
<span class="mf">2.</span><span class="w"> </span><span class="nl">Concurrent</span><span class="p">:</span><span class="w"> </span><span class="n">Mark</span><span class="w"> </span><span class="n">phase</span><span class="w"> </span><span class="p">(</span><span class="n">mutators</span><span class="w"> </span><span class="n">run</span><span class="p">,</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="n">barrier</span><span class="w"> </span><span class="n">active</span><span class="p">)</span>
<span class="mf">3.</span><span class="w"> </span><span class="nl">STW</span><span class="p">:</span><span class="w"> </span><span class="n">Rescan</span><span class="p">,</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="n">barrier</span><span class="w">      </span><span class="p">(</span><span class="o">~</span><span class="mi">100</span><span class="n">Î¼s</span><span class="p">)</span>
<span class="mf">4.</span><span class="w"> </span><span class="nl">Concurrent</span><span class="p">:</span><span class="w"> </span><span class="n">Sweep</span><span class="w"> </span><span class="n">phase</span>
</code></pre></div>

<h3 id="103-cpython">10.3 CPython ê°€ë¹„ì§€ ì»¬ë ‰í„°<a class="header-link" href="#103-cpython" title="Permanent link">&para;</a></h3>
<p>CPythonì€ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<ul>
<li><strong>ê¸°ë³¸</strong>: ì°¸ì¡° ê³„ìˆ˜ (ì¦‰ì‹œ íšŒìˆ˜)</li>
<li><strong>ë³´ì¡°</strong>: ì„¸ëŒ€ë³„ ì‚¬ì´í´ ê°ì§€ê¸° (ì„¸ ì„¸ëŒ€)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="k">def</span><span class="w"> </span><span class="nf">cpython_gc_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show CPython GC configuration and statistics.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== CPython GC Info ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># GC thresholds (generation 0, 1, 2)</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_threshold</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thresholds: Gen0=</span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, Gen1=</span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, Gen2=</span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Gen0: collected after </span><span class="si">{0}</span><span class="s2"> new allocations&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Gen1: collected after </span><span class="si">{0}</span><span class="s2"> Gen0 collections&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Gen2: collected after </span><span class="si">{0}</span><span class="s2"> Gen1 collections&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="c1"># Current counts</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_count</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Current counts: Gen0=</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, Gen1=</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, Gen2=</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Reference count example</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reference count of a list: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Note: getrefcount itself creates a temporary reference, so it&#39;s always +1</span>

    <span class="c1"># Demonstrate cycle detection</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cycle detection demo:&quot;</span><span class="p">)</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>  <span class="c1"># Clean slate</span>

    <span class="c1"># Create a cycle</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Node</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Node(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">y</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># Cycle!</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Created cycle: X -&gt; Y -&gt; X&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Ref count of X: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Subtract our ref</span>

    <span class="c1"># Delete local references</span>
    <span class="k">del</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="c1"># Objects are NOT freed (cycle keeps them alive)</span>
    <span class="c1"># Run cycle detector</span>
    <span class="n">collected</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  After gc.collect(): </span><span class="si">{</span><span class="n">collected</span><span class="si">}</span><span class="s2"> objects collected&quot;</span><span class="p">)</span>

<span class="n">cpython_gc_info</span><span class="p">()</span>
</code></pre></div>

<h3 id="104-rust-gc-ownership">10.4 Rust: GC ëŒ€ì‹  ì†Œìœ ê¶Œ(Ownership)<a class="header-link" href="#104-rust-gc-ownership" title="Permanent link">&para;</a></h3>
<p>RustëŠ” ê·¼ë³¸ì ìœ¼ë¡œ ë‹¤ë¥¸ ì ‘ê·¼ ë°©ì‹ì„ ì·¨í•©ë‹ˆë‹¤: <strong>ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ì „í˜€ ì—†ìŠµë‹ˆë‹¤</strong>. ëŒ€ì‹  ì»´íŒŒì¼ íƒ€ì„ ì†Œìœ ê¶Œ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>Rust Ownership Rules:
1. Each value has exactly one owner
2. When the owner goes out of scope, the value is dropped (freed)
3. References can borrow values (immutably or mutably, but not both)
4. The borrow checker enforces these rules at compile time
</code></pre></div>

<p>ì´ëŠ” GC ì¼ì‹œ ì •ì§€ë¥¼ ì™„ì „íˆ ì œê±°í•˜ì§€ë§Œ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì†Œìœ ê¶Œì— ëŒ€í•´ ìƒê°í•´ì•¼ í•©ë‹ˆë‹¤. ì†Œìœ ê¶Œì´ ë¶ˆë¶„ëª…í•œ ê²½ìš°ë¥¼ ìœ„í•´ RustëŠ” ë‹¤ìŒì„ ì œê³µí•©ë‹ˆë‹¤:</p>
<ul>
<li><code>Rc&lt;T&gt;</code>: ì°¸ì¡° ê³„ìˆ˜ (ë‹¨ì¼ ìŠ¤ë ˆë“œ)</li>
<li><code>Arc&lt;T&gt;</code>: ì›ìì  ì°¸ì¡° ê³„ìˆ˜ (ë‹¤ì¤‘ ìŠ¤ë ˆë“œ)</li>
<li>ì´ë“¤ì€ ì‚¬ì´í´ì„ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, <code>Weak&lt;T&gt;</code> ì°¸ì¡°ë¡œ ì²˜ë¦¬</li>
</ul>
<h3 id="105">10.5 ë¹„êµ<a class="header-link" href="#105" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gc_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare GC characteristics across languages/runtimes.&quot;&quot;&quot;</span>
    <span class="n">collectors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="s1">&#39;JVM G1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Generational, region-based&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mostly concurrent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pause&#39;</span><span class="p">:</span> <span class="s1">&#39;~10-200ms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;throughput&#39;</span><span class="p">:</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span>
            <span class="s1">&#39;heap_overhead&#39;</span><span class="p">:</span> <span class="s1">&#39;~10-20%&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="s1">&#39;JVM ZGC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Region-based, load barrier&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrent&#39;</span><span class="p">:</span> <span class="s1">&#39;Fully concurrent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pause&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;10ms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;throughput&#39;</span><span class="p">:</span> <span class="s1">&#39;Good&#39;</span><span class="p">,</span>
            <span class="s1">&#39;heap_overhead&#39;</span><span class="p">:</span> <span class="s1">&#39;~15%&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="s1">&#39;Go&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Tri-color mark-sweep&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mostly concurrent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pause&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;1ms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;throughput&#39;</span><span class="p">:</span> <span class="s1">&#39;Moderate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;heap_overhead&#39;</span><span class="p">:</span> <span class="s1">&#39;~25-50%&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="s1">&#39;CPython&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Ref counting + generational&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrent&#39;</span><span class="p">:</span> <span class="s1">&#39;No (GIL)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pause&#39;</span><span class="p">:</span> <span class="s1">&#39;~1-50ms&#39;</span><span class="p">,</span>
            <span class="s1">&#39;throughput&#39;</span><span class="p">:</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span>
            <span class="s1">&#39;heap_overhead&#39;</span><span class="p">:</span> <span class="s1">&#39;Per-object refcount&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="s1">&#39;Rust&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Ownership (no GC)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrent&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pause&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
            <span class="s1">&#39;throughput&#39;</span><span class="p">:</span> <span class="s1">&#39;Best&#39;</span><span class="p">,</span>
            <span class="s1">&#39;heap_overhead&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== GC Comparison ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;System&#39;</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Type&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Pause&#39;</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Throughput&#39;</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">collectors</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;pause&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;throughput&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">gc_comparison</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="11-gc">11. GC íŠœë‹ê³¼ ë©”íŠ¸ë¦­<a class="header-link" href="#11-gc" title="Permanent link">&para;</a></h2>
<h3 id="111">11.1 í•µì‹¬ ë©”íŠ¸ë¦­<a class="header-link" href="#111" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ë©”íŠ¸ë¦­</th>
<th>ì •ì˜</th>
<th>ëª©í‘œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ì²˜ë¦¬ëŸ‰</strong></td>
<td>ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì— ì†Œë¹„ë˜ëŠ” ì‹œê°„ ë¹„ìœ¨ (GC ì œì™¸)</td>
<td>ìµœëŒ€í™” (&gt;95%)</td>
</tr>
<tr>
<td><strong>ì¼ì‹œ ì •ì§€ ì‹œê°„</strong></td>
<td>GCë¡œ ì¸í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¼ì‹œ ì •ì§€ ì§€ì† ì‹œê°„</td>
<td>ìµœì†Œí™”</td>
</tr>
<tr>
<td><strong>í’‹í”„ë¦°íŠ¸</strong></td>
<td>ì‚¬ìš©ë˜ëŠ” ì´ ë©”ëª¨ë¦¬ (í™ + GC ë©”íƒ€ë°ì´í„°)</td>
<td>ìµœì†Œí™”</td>
</tr>
<tr>
<td><strong>ì¦‰ì‹œì„±</strong></td>
<td>ê°ì²´ ì‚¬ë§ê³¼ ë©”ëª¨ë¦¬ íšŒìˆ˜ ì‚¬ì´ì˜ ì‹œê°„</td>
<td>ìµœì†Œí™”</td>
</tr>
<tr>
<td><strong>í• ë‹¹ ì†ë„</strong></td>
<td>ì´ˆë‹¹ í• ë‹¹ë˜ëŠ” ë°”ì´íŠ¸</td>
<td>ì§ì ‘ ì œì–´ ë¶ˆê°€</td>
</tr>
<tr>
<td><strong>ìŠ¹ì§„ ì†ë„</strong></td>
<td>Young ì„¸ëŒ€ì—ì„œ Old ì„¸ëŒ€ë¡œ ì´ˆë‹¹ ìŠ¹ì§„ë˜ëŠ” ë°”ì´íŠ¸</td>
<td>ìµœì†Œí™”</td>
</tr>
</tbody>
</table>
<h3 id="112-gc">11.2 GC íŠœë‹ ì‚¼ê°í˜•<a class="header-link" href="#112-gc" title="Permanent link">&para;</a></h3>
<p>ëª¨ë“  ë©”íŠ¸ë¦­ì„ ë™ì‹œì— ìµœì í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code>                Throughput
                    /\
                   /  \
                  /    \
                 /      \
                /  Pick  \
               /   Two    \
              /            \
             /              \
            /______________\
        Pause Time      Footprint
</code></pre></div>

<ul>
<li><strong>ë†’ì€ ì²˜ë¦¬ëŸ‰ + ë‚®ì€ ì¼ì‹œ ì •ì§€</strong> = ëŒ€í˜• í™ (ë†’ì€ í’‹í”„ë¦°íŠ¸)</li>
<li><strong>ë‚®ì€ ì¼ì‹œ ì •ì§€ + ì‘ì€ í’‹í”„ë¦°íŠ¸</strong> = ë” ì¦ì€ ì»¬ë ‰ì…˜ (ë‚®ì€ ì²˜ë¦¬ëŸ‰)</li>
<li><strong>ë†’ì€ ì²˜ë¦¬ëŸ‰ + ì‘ì€ í’‹í”„ë¦°íŠ¸</strong> = ë” ê¸´ ì¼ì‹œ ì •ì§€ (ì¼ê´„ ì»¬ë ‰ì…˜)</li>
</ul>
<h3 id="113-gc">11.3 GC íŠœë‹ ì˜ˆì œ<a class="header-link" href="#113-gc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GCSimulator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate GC behavior under different configurations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heap_size</span><span class="p">,</span> <span class="n">nursery_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">gc_overhead_factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap_size</span> <span class="o">=</span> <span class="n">heap_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nursery_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">heap_size</span> <span class="o">*</span> <span class="n">nursery_ratio</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gc_overhead_factor</span> <span class="o">=</span> <span class="n">gc_overhead_factor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_allocated</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_gc_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_app_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gc_events</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">simulate_workload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alloc_rate_mb_s</span><span class="p">,</span> <span class="n">live_set_mb</span><span class="p">,</span> <span class="n">duration_s</span><span class="p">,</span>
                          <span class="n">survival_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate a workload and report GC metrics.</span>

<span class="sd">        alloc_rate_mb_s: MB allocated per second</span>
<span class="sd">        live_set_mb: MB of long-lived data</span>
<span class="sd">        duration_s: simulation duration in seconds</span>
<span class="sd">        survival_rate: fraction of nursery objects that survive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nursery_used</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">time_elapsed</span> <span class="o">&lt;</span> <span class="n">duration_s</span><span class="p">:</span>
            <span class="c1"># Simulate allocation</span>
            <span class="n">alloc_per_tick</span> <span class="o">=</span> <span class="n">alloc_rate_mb_s</span> <span class="o">*</span> <span class="mf">0.001</span>  <span class="c1"># 1ms ticks</span>
            <span class="n">nursery_used</span> <span class="o">+=</span> <span class="n">alloc_per_tick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_allocated</span> <span class="o">+=</span> <span class="n">alloc_per_tick</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_app_time</span> <span class="o">+=</span> <span class="mf">0.001</span>

            <span class="k">if</span> <span class="n">nursery_used</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nursery_size</span><span class="p">:</span>
                <span class="c1"># Minor GC</span>
                <span class="n">survivors</span> <span class="o">=</span> <span class="n">nursery_used</span> <span class="o">*</span> <span class="n">survival_rate</span>
                <span class="n">gc_time</span> <span class="o">=</span> <span class="n">nursery_used</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc_overhead_factor</span> <span class="o">*</span> <span class="mf">0.001</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">gc_events</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time_elapsed</span><span class="p">,</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;pause_ms&#39;</span><span class="p">:</span> <span class="n">gc_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="s1">&#39;freed_mb&#39;</span><span class="p">:</span> <span class="n">nursery_used</span> <span class="o">-</span> <span class="n">survivors</span><span class="p">,</span>
                <span class="p">})</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">total_gc_time</span> <span class="o">+=</span> <span class="n">gc_time</span>
                <span class="n">nursery_used</span> <span class="o">=</span> <span class="n">survivors</span>

            <span class="n">time_elapsed</span> <span class="o">+=</span> <span class="mf">0.001</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print GC performance report.&quot;&quot;&quot;</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_app_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_gc_time</span>
        <span class="n">throughput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_app_time</span> <span class="o">/</span> <span class="n">total_time</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">minor_gcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc_events</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minor&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">minor_gcs</span><span class="p">:</span>
            <span class="n">pauses</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;pause_ms&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">minor_gcs</span><span class="p">]</span>
            <span class="n">avg_pause</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pauses</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">pauses</span><span class="p">)</span>
            <span class="n">max_pause</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pauses</span><span class="p">)</span>
            <span class="n">p99_pause</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pauses</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pauses</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.99</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avg_pause</span> <span class="o">=</span> <span class="n">max_pause</span> <span class="o">=</span> <span class="n">p99_pause</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== GC Performance Report ===&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total allocated: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_allocated</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GC collections: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gc_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Throughput: </span><span class="si">{</span><span class="n">throughput</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Avg pause: </span><span class="si">{</span><span class="n">avg_pause</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max pause: </span><span class="si">{</span><span class="n">max_pause</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P99 pause: </span><span class="si">{</span><span class="n">p99_pause</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total GC time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_gc_time</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>


<span class="c1"># Compare different heap configurations</span>
<span class="k">for</span> <span class="n">heap_mb</span><span class="p">,</span> <span class="n">nursery_pct</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">256</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config: heap=</span><span class="si">{</span><span class="n">heap_mb</span><span class="si">}</span><span class="s2">MB, nursery=</span><span class="si">{</span><span class="n">nursery_pct</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">GCSimulator</span><span class="p">(</span><span class="n">heap_mb</span><span class="p">,</span> <span class="n">nursery_ratio</span><span class="o">=</span><span class="n">nursery_pct</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">simulate_workload</span><span class="p">(</span>
        <span class="n">alloc_rate_mb_s</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>   <span class="c1"># 500 MB/s allocation rate</span>
        <span class="n">live_set_mb</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>       <span class="c1"># 100 MB long-lived data</span>
        <span class="n">duration_s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>         <span class="c1"># 10 second simulation</span>
        <span class="n">survival_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>    <span class="c1"># 5% of nursery objects survive</span>
    <span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</code></pre></div>

<h3 id="114-gc">11.4 ê³µí†µ GC íŠœë‹ ì „ëµ<a class="header-link" href="#114-gc" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>í™ í¬ê¸° ì¦ê°€</strong>: GC ë¹ˆë„ë¥¼ ì¤„ì´ì§€ë§Œ ì¼ì‹œ ì •ì§€ ì‹œê°„ì´ ëŠ˜ì–´ë‚¨.</li>
<li><strong>ë„ˆì„œë¦¬ í¬ê¸° ì¡°ì •</strong>: ë” í° ë„ˆì„œë¦¬ = ë” ì ì€ ë§ˆì´ë„ˆ GC, ë” ê¸´ ì¼ì‹œ ì •ì§€.</li>
<li><strong>ìŠ¹ì§„ ì„ê³„ê°’ ì¡°ì •</strong>: ë” ë†’ì€ ì„ê³„ê°’ì€ ê°ì²´ë¥¼ ë„ˆì„œë¦¬ì— ë” ì˜¤ë˜ ìœ ì§€ (ê³§ ì£½ì„ ê²½ìš° ì¢‹ìŒ).</li>
<li><strong>ì˜¬ë°”ë¥¸ ì»¬ë ‰í„° ì„ íƒ</strong>: ì»¬ë ‰í„°ë¥¼ ì§€ì—°/ì²˜ë¦¬ëŸ‰ ìš”êµ¬ì‚¬í•­ì— ë§ì¶¤.</li>
<li><strong>í• ë‹¹ ì†ë„ ì¤„ì´ê¸°</strong>: ê°€ì¥ íš¨ê³¼ì ì¸ ì „ëµ -- ë‹¨ê¸° ê°ì²´ë¥¼ ë” ì ê²Œ í• ë‹¹.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tuning_checklist</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GC tuning decision checklist.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== GC Tuning Checklist ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;High GC frequency?&quot;</span><span class="p">,</span> <span class="s2">&quot;Increase heap/nursery size&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Long GC pauses?&quot;</span><span class="p">,</span> <span class="s2">&quot;Use concurrent collector (G1/ZGC/Shenandoah)&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;High promotion rate?&quot;</span><span class="p">,</span> <span class="s2">&quot;Increase nursery size or promotion threshold&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Full GC happening?&quot;</span><span class="p">,</span> <span class="s2">&quot;Old gen too small or memory leak&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Low throughput (&lt;95%)?&quot;</span><span class="p">,</span> <span class="s2">&quot;Reduce allocation rate or increase heap&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;OOM errors?&quot;</span><span class="p">,</span> <span class="s2">&quot;Memory leak, or genuinely need more heap&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">symptom</span><span class="p">,</span> <span class="n">remedy</span> <span class="ow">in</span> <span class="n">checks</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Symptom: </span><span class="si">{</span><span class="n">symptom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Remedy:  </span><span class="si">{</span><span class="n">remedy</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">tuning_checklist</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="12_1">12. ìš”ì•½<a class="header-link" href="#12_1" title="Permanent link">&para;</a></h2>
<p>ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì€ í˜„ëŒ€ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ëŸ°íƒ€ì„ì˜ ê·¼ë³¸ì ì¸ ì¸¡ë©´ì…ë‹ˆë‹¤. ë‹¤ìŒ ì ‘ê·¼ ë°©ì‹ë“¤ì„ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ì•Œê³ ë¦¬ì¦˜</th>
<th>íšŒìˆ˜ íƒ€ì´ë°</th>
<th>ì‚¬ì´í´ ì²˜ë¦¬</th>
<th>ë‹¨í¸í™”</th>
<th>ë³µì‚¬ ë¹„ìš©</th>
<th>ì¼ì‹œ ì •ì§€</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ì°¸ì¡° ê³„ìˆ˜</strong></td>
<td>ì¦‰ì‹œ</td>
<td>ì•„ë‹ˆì˜¤</td>
<td>ìˆìŒ</td>
<td>ì—†ìŒ</td>
<td>ì¦ë¶„</td>
</tr>
<tr>
<td><strong>ë§ˆí¬-ìŠ¤ìœ•</strong></td>
<td>ì¼ê´„</td>
<td>ì˜ˆ</td>
<td>ìˆìŒ</td>
<td>ì—†ìŒ</td>
<td>STW</td>
</tr>
<tr>
<td><strong>ë§ˆí¬-ì»´íŒ©íŠ¸</strong></td>
<td>ì¼ê´„</td>
<td>ì˜ˆ</td>
<td>ì—†ìŒ</td>
<td>ìŠ¬ë¼ì´ë“œ</td>
<td>STW</td>
</tr>
<tr>
<td><strong>ë³µì‚¬</strong></td>
<td>ì¼ê´„</td>
<td>ì˜ˆ</td>
<td>ì—†ìŒ</td>
<td>ë¼ì´ë¸Œ ëª¨ë‘ ë³µì‚¬</td>
<td>STW</td>
</tr>
<tr>
<td><strong>ì„¸ëŒ€ë³„</strong></td>
<td>í˜¼í•©</td>
<td>ì˜ˆ</td>
<td>ë‹¤ì–‘</td>
<td>Youngë§Œ</td>
<td>ì§§ì€ ë§ˆì´ë„ˆ</td>
</tr>
<tr>
<td><strong>ë™ì‹œ</strong></td>
<td>ì¼ê´„</td>
<td>ì˜ˆ</td>
<td>ë‹¤ì–‘</td>
<td>ë‹¤ì–‘</td>
<td>ìµœì†Œ</td>
</tr>
</tbody>
</table>
<p>í•µì‹¬ ì›ì¹™:</p>
<ol>
<li><strong>ì„¸ëŒ€ë³„ ê°€ì„¤</strong>ì€ ëŒ€ë¶€ë¶„ì˜ í˜„ëŒ€ ì»¬ë ‰í„° ì„¤ê³„ë¥¼ ì´ë•ë‹ˆë‹¤: Young ê°ì²´ëŠ” ìì£¼, Old ê°ì²´ëŠ” ë“œë¬¼ê²Œ ìˆ˜ì§‘.</li>
<li><strong>ì“°ê¸° ë°°ë¦¬ì–´</strong>ëŠ” ì„¸ëŒ€ë³„ ë° ë™ì‹œ GC ëª¨ë‘ì— í•„ìˆ˜ì ì´ë©°, ì„¸ëŒ€ ê°„ ë˜ëŠ” ë™ì‹œ ìˆ˜ì •ì„ ì¶”ì í•©ë‹ˆë‹¤.</li>
<li><strong>ì‚¼ìƒ‰ ë§ˆí‚¹</strong>ì€ ë™ì‹œ ë° ì¦ë¶„ ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì¶”ë¡ ì„ ìœ„í•œ ê¹”ë”í•œ í”„ë ˆì„ì›Œí¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</li>
<li><strong>ëª¨ë“  ì›Œí¬ë¡œë“œì— ìµœì„ ì¸ GCëŠ” ì—†ìŠµë‹ˆë‹¤</strong> -- ì˜¬ë°”ë¥¸ ì„ íƒì€ ì§€ì—°, ì²˜ë¦¬ëŸ‰, í’‹í”„ë¦°íŠ¸ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.</li>
<li><strong>Rustì˜ ì†Œìœ ê¶Œ ëª¨ë¸</strong>ì€ ì˜¬ë°”ë¥¸ íƒ€ì… ì‹œìŠ¤í…œìœ¼ë¡œ GCë¥¼ ì™„ì „íˆ í”¼í•  ìˆ˜ ìˆìŒì„ ë³´ì—¬ì£¼ì§€ë§Œ, í”„ë¡œê·¸ë˜ë° ë³µì¡ì„±ì´ ì¦ê°€í•©ë‹ˆë‹¤.</li>
</ol>
<hr />
<h2 id="13_1">13. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#13_1" title="Permanent link">&para;</a></h2>
<h3 id="1_1">ì—°ìŠµ 1: ì°¸ì¡° ê³„ìˆ˜ ì‹œë®¬ë ˆì´ì…˜<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ì§€ì›í•˜ëŠ” ì°¸ì¡° ê³„ìˆ˜ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ì„¸ìš”:
- ê°ì²´ í• ë‹¹ ë° í•´ì œ
- ìë™ ì°¸ì¡° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ê°€ ìˆëŠ” í¬ì¸í„° í• ë‹¹
- ê°ì²´ê°€ ê°€ë¹„ì§€ê°€ ë  ë•Œ ê°ì§€</p>
<p>ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span>
<span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">D</span>
<span class="n">Remove</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="w">  </span><span class="p">(</span><span class="n">should</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">C</span><span class="p">)</span>
<span class="n">Remove</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">D</span><span class="w">  </span><span class="p">(</span><span class="n">should</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">D</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-">ì—°ìŠµ 2: ë§ˆí¬-ìŠ¤ìœ• êµ¬í˜„<a class="header-link" href="#2-" title="Permanent link">&para;</a></h3>
<p>ë§ˆí¬-ìŠ¤ìœ• êµ¬í˜„ì„ ë‹¤ìŒì„ ì²˜ë¦¬í•˜ë„ë¡ í™•ì¥í•˜ì„¸ìš”:
(a) ë‹¤ì¤‘ ë£¨íŠ¸ ì§‘í•© (ìŠ¤íƒ ë£¨íŠ¸, ê¸€ë¡œë²Œ ë£¨íŠ¸, ë ˆì§€ìŠ¤í„° ë£¨íŠ¸).
(b) ì²« ë²ˆì§¸ ì í•©(first-fit), ìµœì„  ì í•©(best-fit), ìµœì•… ì í•©(worst-fit) ì „ëµì„ ê°€ì§„ ììœ  ë¦¬ìŠ¤íŠ¸ í• ë‹¹ê¸°. ê° ì „ëµì—ì„œ ë‹¨í¸í™”ë¥¼ ë¹„êµ.
(c) ì´ ì¼ì‹œ ì •ì§€ ì‹œê°„, í•´ì œëœ ê°ì²´, ë‹¨í¸í™” ë¹„ìœ¨ì„ ì¸¡ì •í•˜ê³  ë³´ê³ .</p>
<h3 id="3_1">ì—°ìŠµ 3: ë³µì‚¬ ì»¬ë ‰í„°<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>ì²´ë‹ˆ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œ ì™„ì „í•œ ì„¸ë¯¸-ìŠ¤í˜ì´ìŠ¤ ë³µì‚¬ ì»¬ë ‰í„°ë¥¼ êµ¬í˜„í•˜ì„¸ìš”:
(a) í™ìœ¼ë¡œ í‰íƒ„ ë°”ì´íŠ¸ ë°°ì—´ ì‚¬ìš© (Python ê°ì²´ ì•„ë‹˜).
(b) ì´ë™ëœ ê°ì²´ì˜ ì „ë‹¬ í¬ì¸í„° êµ¬í˜„.
(c) ë¼ì´ë¸Œ ì„¸íŠ¸ê°€ í™ ì ˆë°˜ì„ ì´ˆê³¼í•˜ëŠ” ê²½ìš° ì²˜ë¦¬ (ë©”ëª¨ë¦¬ ë¶€ì¡± ì—ëŸ¬ ë°œìƒ).
(d) í• ë‹¹ ì†ë„(ë²”í”„ í¬ì¸í„°) vs ììœ  ë¦¬ìŠ¤íŠ¸ í• ë‹¹ì„ ì¸¡ì •.</p>
<h3 id="4-gc">ì—°ìŠµ 4: ì„¸ëŒ€ë³„ GC<a class="header-link" href="#4-gc" title="Permanent link">&para;</a></h3>
<p>ì„¸ëŒ€ë³„ GCë¥¼ ë‹¤ìŒìœ¼ë¡œ í™•ì¥í•˜ì„¸ìš”:
(a) ì„¸ ì„¸ëŒ€ (ë„ˆì„œë¦¬, ì¤‘ê°„, ë…¸ì¸).
(b) ì¹´ë“œ í…Œì´ë¸” ì“°ê¸° ë°°ë¦¬ì–´ êµ¬í˜„.
(c) ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ìŠ¹ì§„ ì†ë„ë¥¼ ì¶”ì í•˜ê³  ë³´ê³ .
(d) ì‹¤í—˜: ìŠ¹ì§„ ì„ê³„ê°’ì„ ë„ˆë¬´ ë†’ê²Œ ì„¤ì •í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”? ë„ˆë¬´ ë‚®ìœ¼ë©´?</p>
<h3 id="5">ì—°ìŠµ 5: ì‚¼ìƒ‰ ë§ˆí‚¹ ì•ˆì „ì„±<a class="header-link" href="#5" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒ ê°ì²´ ê·¸ë˜í”„ì™€ GC ìƒíƒœë¥¼ ê³ ë ¤í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code><span class="n">Objects</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="o">(</span><span class="n">BLACK</span><span class="o">),</span><span class="w"> </span><span class="n">B</span><span class="o">(</span><span class="n">GREY</span><span class="o">),</span><span class="w"> </span><span class="n">C</span><span class="o">(</span><span class="n">WHITE</span><span class="o">),</span><span class="w"> </span><span class="n">D</span><span class="o">(</span><span class="n">WHITE</span><span class="o">),</span><span class="w"> </span><span class="n">E</span><span class="o">(</span><span class="n">BLACK</span><span class="o">)</span>
<span class="n">References</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="o">-&gt;{</span><span class="n">B</span><span class="o">},</span><span class="w"> </span><span class="n">B</span><span class="o">-&gt;{</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">},</span><span class="w"> </span><span class="n">E</span><span class="o">-&gt;{}</span>
<span class="n">Roots</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="o">,</span><span class="w"> </span><span class="n">E</span>
</code></pre></div>

<p>(a) ë®¤í…Œì´í„° ê°„ì„­ ì—†ì´ ë§ˆí‚¹ì´ ì˜¬ë°”ë¥´ê²Œ ì™„ë£Œë¨ì„ ë³´ì´ì„¸ìš”.
(b) ë®¤í…Œì´í„°ê°€ <code>A.ref = C; B.ref = null</code> (B-&gt;C ì œê±°)ì„ ìˆ˜í–‰í•œë‹¤ê³  ê°€ì •í•˜ì„¸ìš”. ì“°ê¸° ë°°ë¦¬ì–´ ì—†ì´ Cê°€ ìƒì–´ë²„ë ¤ì§ì„ ë³´ì´ì„¸ìš”.
(c) Dijkstraì˜ ë°°ë¦¬ì–´ê°€ ìƒì–´ë²„ë¦° ê°ì²´ë¥¼ ë°©ì§€í•˜ëŠ” ë°©ë²•ì„ ë³´ì´ì„¸ìš”.
(d) Yuasaì˜ ë°°ë¦¬ì–´ê°€ ìƒì–´ë²„ë¦° ê°ì²´ë¥¼ ë°©ì§€í•˜ëŠ” ë°©ë²•ì„ ë³´ì´ì„¸ìš”.</p>
<h3 id="6-gc">ì—°ìŠµ 6: GC ë¹„êµ<a class="header-link" href="#6-gc" title="Permanent link">&para;</a></h3>
<p>ë‹¤ì–‘í•œ íŒ¨í„´ìœ¼ë¡œ ê°ì²´ë¥¼ í• ë‹¹í•˜ê³  ì‹œë®¬ë ˆì´ì…˜ëœ GC ì „ëµì—ì„œ ì„±ëŠ¥ì„ ì¸¡ì •í•˜ëŠ” ë²¤ì¹˜ë§ˆí¬ë¥¼ ì‘ì„±í•˜ì„¸ìš”:
(a) ë‹¨ê¸° ë²„ìŠ¤íŠ¸: ë°±ë§Œ ê°œì˜ ì‘ì€ ê°ì²´ë¥¼ í• ë‹¹í•˜ê³  ëª¨ë‘ ë²„ë¦¬ê¸°.
(b) ì¥ê¸°: 10,000ê°œì˜ ê°ì²´ë¥¼ í• ë‹¹í•˜ê³  ìœ ì§€í•œ ë‹¤ìŒ ì„ì‹œ ê°ì²´ ë°±ë§Œ ê°œ í• ë‹¹.
(c) ìˆœí™˜: ì‚¬ì´í´ì„ í˜•ì„±í•˜ëŠ” ì—°ê²° ë¦¬ìŠ¤íŠ¸ ìƒì„±.</p>
<p>ì´ ì‹œê°„ê³¼ ìµœëŒ€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¸¡ë©´ì—ì„œ ì°¸ì¡° ê³„ìˆ˜, ë§ˆí¬-ìŠ¤ìœ•, ë³µì‚¬, ì„¸ëŒ€ë³„ ì»¬ë ‰í„°ë¥¼ ë¹„êµí•˜ì„¸ìš”.</p>
<hr />
<h2 id="14">14. ì°¸ê³  ìë£Œ<a class="header-link" href="#14" title="Permanent link">&para;</a></h2>
<ol>
<li>Jones, R., Hosking, A., &amp; Moss, E. (2012). <em>The Garbage Collection Handbook: The Art of Automatic Memory Management</em>. CRC Press.</li>
<li>Wilson, P. R. (1992). "Uniprocessor Garbage Collection Techniques." <em>International Workshop on Memory Management</em>, Springer.</li>
<li>Cheney, C. J. (1970). "A Nonrecursive List Compacting Algorithm." <em>Communications of the ACM</em>, 13(11).</li>
<li>Dijkstra, E. W., Lamport, L., Martin, A. J., Scholten, C. S., &amp; Steffens, E. F. M. (1978). "On-the-fly Garbage Collection: An Exercise in Cooperation." <em>Communications of the ACM</em>, 21(11).</li>
<li>Lieberman, H., &amp; Hewitt, C. (1983). "A Real-Time Garbage Collector Based on the Lifetimes of Objects." <em>Communications of the ACM</em>, 26(6).</li>
<li>Bacon, D. F., &amp; Rajan, V. T. (2001). "Concurrent Cycle Collection in Reference Counted Systems." <em>ECOOP</em>.</li>
<li>Tene, G., Iyengar, B., &amp; Wolf, M. (2011). "C4: The Continuously Concurrent Compacting Collector." <em>ISMM</em>.</li>
</ol>
<hr />
<p><a href="./13_Loop_Optimization.md">ì´ì „: 13. ë£¨í”„ ìµœì í™”</a> | <a href="./15_Interpreters_and_Virtual_Machines.md">ë‹¤ìŒ: 15. ì¸í„°í”„ë¦¬í„°ì™€ ê°€ìƒ ë¨¸ì‹ </a> | <a href="./00_Overview.md">ê°œìš”</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/13_Loop_Optimization.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë£¨í”„ ìµœì í™”</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/15_Interpreters_and_Virtual_Machines.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì¸í„°í”„ë¦¬í„°ì™€ ê°€ìƒ ë¨¸ì‹ (Interpreters and Virtual Machines)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}