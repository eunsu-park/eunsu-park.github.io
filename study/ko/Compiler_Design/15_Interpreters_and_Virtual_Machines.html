{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸í„°í”„ë¦¬í„°ì™€ ê°€ìƒ ë¨¸ì‹ (Interpreters and Virtual Machines) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Compiler_Design/">Compiler Design</a>
    <span class="separator">/</span>
    <span class="current">ì¸í„°í”„ë¦¬í„°ì™€ ê°€ìƒ ë¨¸ì‹ (Interpreters and Virtual Machines)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ì¸í„°í”„ë¦¬í„°ì™€ ê°€ìƒ ë¨¸ì‹ (Interpreters and Virtual Machines)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/14_Garbage_Collection.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(Garbage Collection)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/16_Modern_Compiler_Infrastructure.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">í˜„ëŒ€ ì»´íŒŒì¼ëŸ¬ ì¸í”„ë¼(Modern Compiler Infrastructure)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ëª©ì°¨</a></li>
<li><a href="#1-vs">1. ì¸í„°í”„ë¦¬í„° vs ì»´íŒŒì¼ëŸ¬</a><ul>
<li><a href="#11">1.1 ì‹¤í–‰ ìŠ¤í™íŠ¸ëŸ¼</a></li>
<li><a href="#12">1.2 íŠ¸ë ˆì´ë“œì˜¤í”„</a></li>
<li><a href="#13">1.3 í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼</a></li>
</ul>
</li>
<li><a href="#2">2. íŠ¸ë¦¬ ìˆœíšŒ ì¸í„°í”„ë¦¬í„°</a><ul>
<li><a href="#21">2.1 ê°€ì¥ ë‹¨ìˆœí•œ ì¸í„°í”„ë¦¬í„°</a></li>
<li><a href="#22">2.2 ì¥ì ê³¼ ë‹¨ì </a></li>
</ul>
</li>
<li><a href="#3">3. ë°”ì´íŠ¸ì½”ë“œì™€ ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼</a><ul>
<li><a href="#31">3.1 ë°”ì´íŠ¸ì½”ë“œë€?</a></li>
<li><a href="#32">3.2 ë°”ì´íŠ¸ì½”ë“œ ì„¤ê³„ ì›ì¹™</a></li>
<li><a href="#33">3.3 ëª…ë ¹ì–´ ì¸ì½”ë”©</a></li>
<li><a href="#34">3.4 ëª…ë ¹ì–´ ì§‘í•© ì •ì˜</a></li>
</ul>
</li>
<li><a href="#4">4. ìŠ¤íƒ ê¸°ë°˜ ê°€ìƒ ë¨¸ì‹ </a><ul>
<li><a href="#41-vm">4.1 ìŠ¤íƒ VM ì‘ë™ ë°©ì‹</a></li>
<li><a href="#42-vm">4.2 ìŠ¤íƒ VMì˜ ì¥ì </a></li>
<li><a href="#43">4.3 ë‹¨ì </a></li>
<li><a href="#44-vm">4.4 ê¸°ë³¸ ìŠ¤íƒ VM êµ¬í˜„</a></li>
</ul>
</li>
<li><a href="#5">5. ë ˆì§€ìŠ¤í„° ê¸°ë°˜ ê°€ìƒ ë¨¸ì‹ </a><ul>
<li><a href="#51-vm">5.1 ë ˆì§€ìŠ¤í„° VM ì„¤ê³„</a></li>
<li><a href="#52-vm">5.2 ë ˆì§€ìŠ¤í„° VM ì˜ˆì œ</a></li>
<li><a href="#53-vs">5.3 ìŠ¤íƒ vs ë ˆì§€ìŠ¤í„° ë¹„êµ</a></li>
</ul>
</li>
<li><a href="#6">6. ëª…ë ¹ì–´ ë””ìŠ¤íŒ¨ì¹˜ ê¸°ë²•</a><ul>
<li><a href="#61-switch-dispatch">6.1 ìŠ¤ìœ„ì¹˜ ë””ìŠ¤íŒ¨ì¹˜(Switch Dispatch)</a></li>
<li><a href="#62-direct-threaded-code">6.2 ì§ì ‘ ìŠ¤ë ˆë“œ ì½”ë“œ(Direct Threaded Code)</a></li>
<li><a href="#63-computed-goto-gcc">6.3 Computed Goto (GCC í™•ì¥)</a></li>
<li><a href="#64-subroutine-threading">6.4 ì„œë¸Œë£¨í‹´ ìŠ¤ë ˆë”©(Subroutine Threading)</a></li>
<li><a href="#65">6.5 ë””ìŠ¤íŒ¨ì¹˜ ì„±ëŠ¥ ë¹„êµ</a></li>
</ul>
</li>
<li><a href="#7-vm">7. ì™„ì „í•œ ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬ì™€ VM</a><ul>
<li><a href="#71">7.1 ì–¸ì–´</a></li>
<li><a href="#72">7.2 ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬</a></li>
<li><a href="#73">7.3 ê°€ìƒ ë¨¸ì‹ </a></li>
<li><a href="#74">7.4 ëª¨ë‘ í•©ì¹˜ê¸°</a></li>
</ul>
</li>
<li><a href="#8-jit">8. JIT ì»´íŒŒì¼</a><ul>
<li><a href="#81-jit">8.1 ì™œ JITì¸ê°€?</a></li>
<li><a href="#82-jitmethod-jit">8.2 ë©”ì„œë“œ JIT(Method JIT)</a></li>
<li><a href="#83-jittracing-jit">8.3 ì¶”ì  JIT(Tracing JIT)</a></li>
<li><a href="#84">8.4 íŠ¸ë ˆì´ìŠ¤ ì»´íŒŒì¼ ì„¸ë¶€ ì‚¬í•­</a></li>
<li><a href="#85-on-stack-replacement-osr">8.5 ì˜¨-ìŠ¤íƒ ëŒ€ì²´(On-Stack Replacement, OSR)</a></li>
</ul>
</li>
<li><a href="#9">9. ëŸ°íƒ€ì„ ìµœì í™” ê¸°ë²•</a><ul>
<li><a href="#91-inline-caching">9.1 ì¸ë¼ì¸ ìºì‹±(Inline Caching)</a></li>
<li><a href="#92-type-specialization">9.2 íƒ€ì… íŠ¹ìˆ˜í™”(Type Specialization)</a></li>
<li><a href="#93-deoptimization">9.3 ì—­ìµœì í™”(Deoptimization)</a></li>
<li><a href="#94-hidden-classes-shapes">9.4 ìˆ¨ê²¨ì§„ í´ë˜ìŠ¤(Hidden Classes) / í˜•íƒœ(Shapes)</a></li>
</ul>
</li>
<li><a href="#10">10. ì‹¤ì œ ê°€ìƒ ë¨¸ì‹ </a><ul>
<li><a href="#101-jvm-java-virtual-machine">10.1 JVM (Java Virtual Machine)</a></li>
<li><a href="#102-cpython-vm">10.2 CPython VM</a></li>
<li><a href="#103-v8-javascript">10.3 V8 (JavaScript)</a></li>
<li><a href="#104-beam-erlang-vm">10.4 BEAM (Erlang VM)</a></li>
<li><a href="#105-vm">10.5 VM ë¹„êµ</a></li>
</ul>
</li>
<li><a href="#11_1">11. ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°</a><ul>
<li><a href="#111">11.1 ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°ë€?</a></li>
<li><a href="#112">11.2 ê°„ë‹¨í•œ ë©”íƒ€ìˆœí™˜ í‰ê°€ê¸°</a></li>
<li><a href="#113">11.3 ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°ê°€ ì¤‘ìš”í•œ ì´ìœ </a></li>
</ul>
</li>
<li><a href="#12_1">12. ìš”ì•½</a></li>
<li><a href="#13_1">13. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1">ì—°ìŠµ 1: íŠ¸ë¦¬ ìˆœíšŒ í™•ì¥</a></li>
<li><a href="#2_1">ì—°ìŠµ 2: ë°”ì´íŠ¸ì½”ë“œ ìµœì í™”</a></li>
<li><a href="#3-vm">ì—°ìŠµ 3: ë ˆì§€ìŠ¤í„° VMì„ ìœ„í•œ ë ˆì§€ìŠ¤í„° í• ë‹¹</a></li>
<li><a href="#4-jit">ì—°ìŠµ 4: ê°„ë‹¨í•œ JIT ì»´íŒŒì¼ëŸ¬</a></li>
<li><a href="#5-vm">ì—°ìŠµ 5: VM ë””ë²„ê±°</a></li>
<li><a href="#6-vm">ì—°ìŠµ 6: VM ì„±ëŠ¥ ë¶„ì„</a></li>
</ul>
</li>
<li><a href="#14">14. ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="interpreters-and-virtual-machines">ì¸í„°í”„ë¦¬í„°ì™€ ê°€ìƒ ë¨¸ì‹ (Interpreters and Virtual Machines)<a class="header-link" href="#interpreters-and-virtual-machines" title="Permanent link">&para;</a></h1>
<p><strong>ì´ì „</strong>: <a href="./14_Garbage_Collection.md">14. ê°€ë¹„ì§€ ì»¬ë ‰ì…˜</a> | <strong>ë‹¤ìŒ</strong>: <a href="./16_Modern_Compiler_Infrastructure.md">16. í˜„ëŒ€ ì»´íŒŒì¼ëŸ¬ ì¸í”„ë¼</a></p>
<hr />
<p>ëª¨ë“  ì–¸ì–´ êµ¬í˜„ì´ ë„¤ì´í‹°ë¸Œ ê¸°ê³„ ì½”ë“œë¡œ ì»´íŒŒì¼ë˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. Python, Java, JavaScript, Ruby, Erlang, Lua ê°™ì´ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ë§ì€ ì–¸ì–´ë“¤ì€ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì¸í„°í”„ë¦¬í„° ë˜ëŠ” ê°€ìƒ ë¨¸ì‹ (ë˜ëŠ” ë‘˜ì˜ ì¡°í•©)ì— ì˜ì¡´í•©ë‹ˆë‹¤. ì¸í„°í”„ë¦¬í„°ì™€ VMì´ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ì´í•´í•˜ëŠ” ê²ƒì€ ì–¸ì–´ êµ¬í˜„ìì™€ ì½”ë“œê°€ ì‹¤í–‰ë  ë•Œ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ëŠ”ì§€ ì´í•´í•˜ê³  ì‹¶ì€ ëª¨ë“  í”„ë¡œê·¸ë˜ë¨¸ì—ê²Œ í•„ìˆ˜ì ì…ë‹ˆë‹¤.</p>
<p>ì´ ë ˆìŠ¨ì€ ë‹¨ìˆœí•œ íŠ¸ë¦¬ ìˆœíšŒ ì¸í„°í”„ë¦¬í„°ë¶€í„° ì •êµí•œ JIT ì»´íŒŒì¼ ê°€ìƒ ë¨¸ì‹ ê¹Œì§€ ì‹¤í–‰ ì „ëµì˜ ìŠ¤í™íŠ¸ëŸ¼ì„ ë‹¤ë£¹ë‹ˆë‹¤. ê°„ë‹¨í•œ ì–¸ì–´ë¥¼ ìœ„í•œ ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬ì™€ ìŠ¤íƒ ê¸°ë°˜ VMì„ Pythonìœ¼ë¡œ êµ¬í˜„í•˜ì—¬ í”„ë¡œë•ì…˜ VMì´ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ì´í•´í•˜ê¸° ìœ„í•œ êµ¬ì²´ì ì¸ ê¸°ë°˜ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
<p><strong>ë‚œì´ë„</strong>: â­â­â­â­</p>
<p><strong>ì„ ìˆ˜ ì§€ì‹</strong>: <a href="./07_Abstract_Syntax_Trees.md">07. ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬</a>, <a href="./09_Intermediate_Representations.md">09. ì¤‘ê°„ í‘œí˜„</a>, <a href="./11_Code_Generation.md">11. ì½”ë“œ ìƒì„±</a></p>
<p><strong>í•™ìŠµ ëª©í‘œ</strong>:
- ì—¬ëŸ¬ ì¶•(ì†ë„, ì´ì‹ì„±, ê°œë°œ ì‚¬ì´í´)ì—ì„œ ì¸í„°í”„ë¦¬í„°ì™€ ì»´íŒŒì¼ëŸ¬ë¥¼ ë¹„êµí•œë‹¤
- ê°„ë‹¨í•œ ì–¸ì–´ë¥¼ ìœ„í•œ íŠ¸ë¦¬ ìˆœíšŒ ì¸í„°í”„ë¦¬í„°ë¥¼ êµ¬í˜„í•œë‹¤
- ë°”ì´íŠ¸ì½”ë“œ ëª…ë ¹ ì§‘í•©ì„ ì„¤ê³„í•˜ê³  ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬ë¥¼ êµ¬í˜„í•œë‹¤
- ìŠ¤íƒ ê¸°ë°˜ ê°€ìƒ ë¨¸ì‹ ì„ ì²˜ìŒë¶€í„° ë§Œë“ ë‹¤
- ë ˆì§€ìŠ¤í„° ê¸°ë°˜ VM ì„¤ê³„ì™€ ê·¸ ì¥ì ì„ ì´í•´í•œë‹¤
- ëª…ë ¹ ë””ìŠ¤íŒ¨ì¹˜ ê¸°ë²•ê³¼ ì„±ëŠ¥ ì˜í–¥ì„ ì„¤ëª…í•œë‹¤
- JIT ì»´íŒŒì¼ ì „ëµ(ë©”ì„œë“œ JIT, ì¶”ì  JIT)ì„ ê¸°ìˆ í•œë‹¤
- ëŸ°íƒ€ì„ ìµœì í™” ê¸°ë²•(ì¸ë¼ì¸ ìºì‹±, íƒ€ì… íŠ¹ìˆ˜í™”)ì„ ì„¤ëª…í•œë‹¤
- ì‹¤ì œ VM(JVM, CPython, V8, BEAM)ì˜ ì„¤ê³„ë¥¼ ë¶„ì„í•œë‹¤
- ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°ë¥¼ ì´í•´í•œë‹¤</p>
<hr />
<h2 id="_1">ëª©ì°¨<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-ì¸í„°í”„ë¦¬í„°-vs-ì»´íŒŒì¼ëŸ¬">ì¸í„°í”„ë¦¬í„° vs ì»´íŒŒì¼ëŸ¬</a></li>
<li><a href="#2-íŠ¸ë¦¬-ìˆœíšŒ-ì¸í„°í”„ë¦¬í„°">íŠ¸ë¦¬ ìˆœíšŒ ì¸í„°í”„ë¦¬í„°</a></li>
<li><a href="#3-ë°”ì´íŠ¸ì½”ë“œì™€-ë°”ì´íŠ¸ì½”ë“œ-ì»´íŒŒì¼">ë°”ì´íŠ¸ì½”ë“œì™€ ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼</a></li>
<li><a href="#4-ìŠ¤íƒ-ê¸°ë°˜-ê°€ìƒ-ë¨¸ì‹ ">ìŠ¤íƒ ê¸°ë°˜ ê°€ìƒ ë¨¸ì‹ </a></li>
<li><a href="#5-ë ˆì§€ìŠ¤í„°-ê¸°ë°˜-ê°€ìƒ-ë¨¸ì‹ ">ë ˆì§€ìŠ¤í„° ê¸°ë°˜ ê°€ìƒ ë¨¸ì‹ </a></li>
<li><a href="#6-ëª…ë ¹-ë””ìŠ¤íŒ¨ì¹˜-ê¸°ë²•">ëª…ë ¹ ë””ìŠ¤íŒ¨ì¹˜ ê¸°ë²•</a></li>
<li><a href="#7-ì™„ì „í•œ-ë°”ì´íŠ¸ì½”ë“œ-ì»´íŒŒì¼ëŸ¬ì™€-vm">ì™„ì „í•œ ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬ì™€ VM</a></li>
<li><a href="#8-jit-ì»´íŒŒì¼">JIT ì»´íŒŒì¼</a></li>
<li><a href="#9-ëŸ°íƒ€ì„-ìµœì í™”-ê¸°ë²•">ëŸ°íƒ€ì„ ìµœì í™” ê¸°ë²•</a></li>
<li><a href="#10-ì‹¤ì œ-ê°€ìƒ-ë¨¸ì‹ ">ì‹¤ì œ ê°€ìƒ ë¨¸ì‹ </a></li>
<li><a href="#11-ë©”íƒ€ìˆœí™˜-ì¸í„°í”„ë¦¬í„°">ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°</a></li>
<li><a href="#12-ìš”ì•½">ìš”ì•½</a></li>
<li><a href="#13-ì—°ìŠµ-ë¬¸ì œ">ì—°ìŠµ ë¬¸ì œ</a></li>
<li><a href="#14-ì°¸ê³ -ìë£Œ">ì°¸ê³  ìë£Œ</a></li>
</ol>
<hr />
<h2 id="1-vs">1. ì¸í„°í”„ë¦¬í„° vs ì»´íŒŒì¼ëŸ¬<a class="header-link" href="#1-vs" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 ì‹¤í–‰ ìŠ¤í™íŠ¸ëŸ¼<a class="header-link" href="#11" title="Permanent link">&para;</a></h3>
<p>ì–¸ì–´ êµ¬í˜„ì€ ìˆœìˆ˜ í•´ì„ë¶€í„° ìˆœìˆ˜ ì»´íŒŒì¼ê¹Œì§€ì˜ ìŠ¤í™íŠ¸ëŸ¼ì— ì¡´ì¬í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Pure</span><span class="w"> </span><span class="nx">Interpreter</span><span class="w">                                    </span><span class="nx">Native</span><span class="w"> </span><span class="nx">Compiler</span>
<span class="w">     </span><span class="o">|</span><span class="w">                                                    </span><span class="o">|</span>
<span class="w">     </span><span class="nx">v</span><span class="w">                                                    </span><span class="nx">v</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Tree</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Bytecode</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Bytecode</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">AOT</span><span class="w">     </span><span class="err">â”‚</span><span class="w">    </span><span class="nx">Static</span><span class="w">    </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Walking</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Interp</span><span class="p">.</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">JIT</span><span class="w">    </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">Compile</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">Compiler</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">              </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Ruby</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">CPython</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">JVM</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">GraalVM</span><span class="w"> </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">GCC</span><span class="o">/</span><span class="nx">LLVM</span><span class="w">  </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="p">(</span><span class="nx">old</span><span class="p">)</span><span class="w">   </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Lua</span><span class="w">     </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">V8</span><span class="w">      </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Native</span><span class="w">  </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">Rust</span><span class="w">      </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w">  </span><span class="nx">Bash</span><span class="w">    </span><span class="err">â”‚</span><span class="w">          </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">PyPy</span><span class="w">    </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">Image</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">Go</span><span class="w">        </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">   </span><span class="nx">Slow</span><span class="w">                                            </span><span class="nx">Fast</span>
<span class="w">   </span><span class="nx">Portable</span><span class="w">                                        </span><span class="nx">Platform</span><span class="o">-</span><span class="nx">specific</span>
<span class="w">   </span><span class="nx">Quick</span><span class="w"> </span><span class="nx">startup</span><span class="w">                                   </span><span class="nx">Slow</span><span class="w"> </span><span class="nx">startup</span>
<span class="w">   </span><span class="nx">Easy</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">implement</span><span class="w">                               </span><span class="nx">Complex</span><span class="w"> </span><span class="nx">implementation</span>
</code></pre></div>

<h3 id="12">1.2 íŠ¸ë ˆì´ë“œì˜¤í”„<a class="header-link" href="#12" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ì¸¡ë©´</th>
<th>ì¸í„°í”„ë¦¬í„°</th>
<th>ì»´íŒŒì¼ëŸ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ì‹¤í–‰ ì†ë„</strong></td>
<td>ëŠë¦¼ (10-100ë°° ëŠë¦¼)</td>
<td>ë¹ ë¦„ (í•˜ë“œì›¨ì–´ ì†ë„ì— ê·¼ì ‘)</td>
</tr>
<tr>
<td><strong>ì‹œì‘ ì‹œê°„</strong></td>
<td>ë¹ ë¦„ (ì»´íŒŒì¼ ë‹¨ê³„ ì—†ìŒ)</td>
<td>ëŠë¦¼ (ë¨¼ì € ì»´íŒŒì¼í•´ì•¼ í•¨)</td>
</tr>
<tr>
<td><strong>ë©”ëª¨ë¦¬ ì‚¬ìš©</strong></td>
<td>ë‚®ìŒ (ìƒì„±ëœ ì½”ë“œ ì—†ìŒ)</td>
<td>ë†’ìŒ (ìƒì„±ëœ ì½”ë“œ + ë°ì´í„°)</td>
</tr>
<tr>
<td><strong>ì´ì‹ì„±</strong></td>
<td>ë†’ìŒ (VMì´ í•˜ë“œì›¨ì–´ ì¶”ìƒí™”)</td>
<td>ë‚®ìŒ (ëŒ€ìƒ íŠ¹í™”)</td>
</tr>
<tr>
<td><strong>ì—ëŸ¬ ë©”ì‹œì§€</strong></td>
<td>ë” ì¢‹ìŒ (ì†ŒìŠ¤ ì •ë³´ ìˆìŒ)</td>
<td>ì¢…ì¢… ë‚œí•´í•¨</td>
</tr>
<tr>
<td><strong>ë””ë²„ê¹…</strong></td>
<td>ì‰¬ì›€ (ë¼ì´ë¸Œ ìƒíƒœ ê²€ì‚¬)</td>
<td>ì–´ë ¤ì›€ (ìµœì í™”ë˜ì–´ ì—†ì–´ì§)</td>
</tr>
<tr>
<td><strong>ê°œë°œ ì‚¬ì´í´</strong></td>
<td>ë¹ ë¦„ (í¸ì§‘-ì‹¤í–‰)</td>
<td>ëŠë¦¼ (í¸ì§‘-ì»´íŒŒì¼-ì‹¤í–‰)</td>
</tr>
<tr>
<td><strong>ë™ì  ê¸°ëŠ¥</strong></td>
<td>ì‰¬ì›€ (<code>eval</code>, ë©”íƒ€í”„ë¡œê·¸ë˜ë°)</td>
<td>ì–´ë µê±°ë‚˜ ë¶ˆê°€ëŠ¥</td>
</tr>
<tr>
<td><strong>ìµœì í™”</strong></td>
<td>ì œí•œì </td>
<td>ê´‘ë²”ìœ„</td>
</tr>
</tbody>
</table>
<h3 id="13">1.3 í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼<a class="header-link" href="#13" title="Permanent link">&para;</a></h3>
<p>ëŒ€ë¶€ë¶„ì˜ í˜„ëŒ€ ì‹œìŠ¤í…œì€ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<ul>
<li><strong>Java</strong>: ë°”ì´íŠ¸ì½”ë“œë¡œ ì»´íŒŒì¼(AOT), ê·¸ëŸ° ë‹¤ìŒ ëŸ°íƒ€ì„ì— í•« ë©”ì„œë“œë¥¼ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ JIT ì»´íŒŒì¼.</li>
<li><strong>JavaScript (V8)</strong>: ASTë¡œ íŒŒì‹±, ë°”ì´íŠ¸ì½”ë“œë¡œ ì»´íŒŒì¼, TurboFanìœ¼ë¡œ í•« í•¨ìˆ˜ë¥¼ JIT ì»´íŒŒì¼.</li>
<li><strong>Python (PyPy)</strong>: ë°”ì´íŠ¸ì½”ë“œ í•´ì„, í•« ë£¨í”„ ì¶”ì , ì¶”ì ì„ JIT ì»´íŒŒì¼.</li>
<li><strong>.NET</strong>: CIL ë°”ì´íŠ¸ì½”ë“œë¡œ ì»´íŒŒì¼, ë¡œë“œ ì‹œ ë˜ëŠ” ì§€ì—°ìœ¼ë¡œ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ JIT ì»´íŒŒì¼.</li>
</ul>
<hr />
<h2 id="2">2. íŠ¸ë¦¬ ìˆœíšŒ ì¸í„°í”„ë¦¬í„°<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 ê°€ì¥ ë‹¨ìˆœí•œ ì¸í„°í”„ë¦¬í„°<a class="header-link" href="#21" title="Permanent link">&para;</a></h3>
<p>íŠ¸ë¦¬ ìˆœíšŒ ì¸í„°í”„ë¦¬í„°ëŠ” ASTë¥¼ ìˆœíšŒí•˜ì—¬ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ê° ë…¸ë“œ ìœ í˜•ì—ëŠ” ê´€ë ¨ëœ í‰ê°€ ê·œì¹™ì´ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span>


<span class="c1"># AST node definitions</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NumberLit</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StringLit</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BoolLit</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Identifier</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BinOp</span><span class="p">:</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">left</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">right</span><span class="p">:</span> <span class="n">Any</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UnaryOp</span><span class="p">:</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">operand</span><span class="p">:</span> <span class="n">Any</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Assign</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">If</span><span class="p">:</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">then_body</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">else_body</span><span class="p">:</span> <span class="nb">list</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">While</span><span class="p">:</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">list</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FuncDef</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">body</span><span class="p">:</span> <span class="nb">list</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FuncCall</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">args</span><span class="p">:</span> <span class="nb">list</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Return</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Print</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ReturnException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used to implement return from functions.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Environment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Variable scope with lexical scoping.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Undefined variable: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update existing binding (search up scope chain).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># If not found anywhere, create in current scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TreeWalkInterpreter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tree-walking interpreter that directly executes AST nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Captured output for testing</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">interpret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpret a list of statements.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">program</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_env</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a single AST node.&quot;&quot;&quot;</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;exec_</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown node type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_NumberLit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_StringLit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_BoolLit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_Identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_BinOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>

        <span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;+&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;-&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;/&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;%&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;!=&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;or&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">b</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown operator: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ops</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">](</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_UnaryOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">operand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">operand</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;not&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">operand</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown unary operator: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_If</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">then_body</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_While</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_FuncDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="c1"># Store function as closure (captures defining environment)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_FuncCall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a function&quot;</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">closure_env</span> <span class="o">=</span> <span class="n">func</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> expects </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2"> args, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create new scope for function body</span>
        <span class="n">func_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">closure_env</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="n">func_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

        <span class="c1"># Execute function body</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">body</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">func_env</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ReturnException</span> <span class="k">as</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_Return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="n">ReturnException</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exec_Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_tree_walker</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate the tree-walking interpreter.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Tree-Walking Interpreter Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">interp</span> <span class="o">=</span> <span class="n">TreeWalkInterpreter</span><span class="p">()</span>

    <span class="c1"># Program: compute factorial</span>
    <span class="n">program</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FuncDef</span><span class="p">(</span><span class="s1">&#39;factorial&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">If</span><span class="p">(</span>
                <span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
                <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span>
                              <span class="n">FuncCall</span><span class="p">(</span><span class="s1">&#39;factorial&#39;</span><span class="p">,</span>
                                       <span class="p">[</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span>
                                               <span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">))])))]</span>
            <span class="p">)</span>
        <span class="p">]),</span>
        <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">FuncCall</span><span class="p">(</span><span class="s1">&#39;factorial&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">NumberLit</span><span class="p">(</span><span class="mi">10</span><span class="p">)])),</span>
        <span class="n">Print</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)),</span>
    <span class="p">]</span>

    <span class="n">interp</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>

    <span class="c1"># Program: Fibonacci</span>
    <span class="n">program2</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FuncDef</span><span class="p">(</span><span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">If</span><span class="p">(</span>
                <span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                              <span class="n">FuncCall</span><span class="p">(</span><span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span>
                                                     <span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">))]),</span>
                              <span class="n">FuncCall</span><span class="p">(</span><span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span>
                                                     <span class="n">NumberLit</span><span class="p">(</span><span class="mi">2</span><span class="p">))])))]</span>
            <span class="p">)</span>
        <span class="p">]),</span>
        <span class="c1"># Print first 10 Fibonacci numbers</span>
        <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
        <span class="n">While</span><span class="p">(</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">),</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span> <span class="p">[</span>
            <span class="n">Print</span><span class="p">(</span><span class="n">FuncCall</span><span class="p">(</span><span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)])),</span>
            <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">),</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">))),</span>
        <span class="p">]),</span>
    <span class="p">]</span>

    <span class="n">interp2</span> <span class="o">=</span> <span class="n">TreeWalkInterpreter</span><span class="p">()</span>
    <span class="n">interp2</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">program2</span><span class="p">)</span>

<span class="n">demonstrate_tree_walker</span><span class="p">()</span>
</code></pre></div>

<h3 id="22">2.2 ì¥ì ê³¼ ë‹¨ì <a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<p><strong>ì¥ì </strong>:
- êµ¬í˜„ì´ ê°„ë‹¨í•¨ (ìˆ˜ë°± ì¤„)
- ASTì— ì§ì ‘ ì ‘ê·¼ (ë””ë²„ê¹…, ì—ëŸ¬ ë©”ì‹œì§€ì— í›Œë¥­)
- ê¸°ëŠ¥ ì¶”ê°€ê°€ ì‰¬ì›€ (ìƒˆ <code>exec_</code> ë©”ì„œë“œë§Œ ì¶”ê°€)
- ë³µì¡í•œ ì˜ë¯¸ë¡ ì˜ ì–¸ì–´ì— ìì—°ìŠ¤ëŸ¬ì›€</p>
<p><strong>ë‹¨ì </strong>:
- <strong>ëŠë¦¼</strong>: ê° ë…¸ë“œì— ê°€ìƒ ë””ìŠ¤íŒ¨ì¹˜(ë©”ì„œë“œ ì¡°íšŒ) í•„ìš”
- <strong>ê¹Šì€ ì¬ê·€</strong>: ê¹Šì´ ì¤‘ì²©ëœ í‘œí˜„ì‹ì€ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° ìœ ë°œ
- <strong>ìµœì í™” ì—†ìŒ</strong>: ëª¨ë“  í‘œí˜„ì‹ì´ ë§¤ë²ˆ ì¬í‰ê°€ë¨
- <strong>ìºì‹œ ë¹„ì¹œí™”ì </strong>: AST ë…¸ë“œê°€ ë©”ëª¨ë¦¬ì— ë¶„ì‚°</p>
<p>íŠ¸ë¦¬ ìˆœíšŒ ì¸í„°í”„ë¦¬í„°ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì»´íŒŒì¼ëœ ì½”ë“œë³´ë‹¤ 50-200ë°° ëŠë¦½ë‹ˆë‹¤.</p>
<hr />
<h2 id="3">3. ë°”ì´íŠ¸ì½”ë“œì™€ ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ë°”ì´íŠ¸ì½”ë“œë€?<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<p><strong>ë°”ì´íŠ¸ì½”ë“œ(bytecode)</strong>ëŠ” ì‹¤ì œ í•˜ë“œì›¨ì–´ê°€ ì•„ë‹Œ ê°€ìƒ ë¨¸ì‹ ì— ì˜í•´ ì‹¤í–‰ë˜ë„ë¡ ì„¤ê³„ëœ í”„ë¡œê·¸ë¨ì˜ ì»´íŒ©íŠ¸í•œ ì´ì§„ í‘œí˜„ì…ë‹ˆë‹¤. ì†ŒìŠ¤ ì½”ë“œì™€ ê¸°ê³„ ì½”ë“œ ì‚¬ì´ì— ìœ„ì¹˜í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">Source</span><span class="w"> </span><span class="n">Code</span><span class="w">       </span><span class="n">AST</span><span class="w">          </span><span class="n">Bytecode</span><span class="w">         </span><span class="n">Machine</span><span class="w"> </span><span class="n">Code</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="o">--&gt;</span><span class="w">  </span><span class="n">Assign</span><span class="w">  </span><span class="o">--&gt;</span><span class="w">  </span><span class="n">LOAD_VAR</span><span class="w"> </span><span class="n">a</span><span class="w">   </span><span class="o">--&gt;</span><span class="w">  </span><span class="n">mov</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">rbp</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
<span class="w">                   </span><span class="o">/</span><span class="w"> </span><span class="err">\</span><span class="w">          </span><span class="n">LOAD_VAR</span><span class="w"> </span><span class="n">b</span><span class="w">       </span><span class="n">add</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">rbp</span><span class="o">-</span><span class="mi">16</span><span class="p">]</span>
<span class="w">                  </span><span class="n">x</span><span class="w">   </span><span class="o">+</span><span class="w">         </span><span class="n">ADD</span><span class="w">              </span><span class="n">mov</span><span class="w"> </span><span class="p">[</span><span class="n">rbp</span><span class="o">-</span><span class="mi">24</span><span class="p">],</span><span class="w"> </span><span class="n">eax</span>
<span class="w">                     </span><span class="o">/</span><span class="w"> </span><span class="err">\</span><span class="w">        </span><span class="n">STORE_VAR</span><span class="w"> </span><span class="n">x</span>
<span class="w">                    </span><span class="n">a</span><span class="w">   </span><span class="n">b</span>
</code></pre></div>

<h3 id="32">3.2 ë°”ì´íŠ¸ì½”ë“œ ì„¤ê³„ ì›ì¹™<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<p>ì¢‹ì€ ë°”ì´íŠ¸ì½”ë“œ ì„¤ê³„ëŠ” ì—¬ëŸ¬ ëª©í‘œì˜ ê· í˜•ì„ ë§ì¶¥ë‹ˆë‹¤:</p>
<ol>
<li><strong>ì»´íŒ©íŠ¸ì„±</strong>: ë” ì ì€ ë°”ì´íŠ¸ = ë” ë¹ ë¥¸ ë¡œë”©, ë” ì ì€ ë©”ëª¨ë¦¬, ë” ì¢‹ì€ ìºì‹œ í™œìš©</li>
<li><strong>ë‹¨ìˆœì„±</strong>: ë‹¨ìˆœí•œ ëª…ë ¹ì–´ëŠ” ë””ì½”ë”©ê³¼ ì‹¤í–‰ì´ ì‰¬ì›€</li>
<li><strong>ì™„ì „ì„±</strong>: ëª¨ë“  ì–¸ì–´ ê¸°ëŠ¥ì„ í‘œí˜„ ê°€ëŠ¥í•´ì•¼ í•¨</li>
<li><strong>ì„±ëŠ¥</strong>: ê³µí†µ ì—°ì‚°ì´ íš¨ìœ¨ì ì´ì–´ì•¼ í•¨</li>
<li><strong>ê²€ì¦ ê°€ëŠ¥ì„±</strong>: ì‹¤í–‰ ì „ì— ìœ íš¨ì„± ê²€ì‚¬ê°€ ê°€ëŠ¥í•´ì•¼ í•¨</li>
</ol>
<h3 id="33">3.3 ëª…ë ¹ì–´ ì¸ì½”ë”©<a class="header-link" href="#33" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">Fixed</span><span class="o">-</span><span class="nx">width</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.,</span><span class="w"> </span><span class="mi">32</span><span class="o">-</span><span class="nx">bit</span><span class="p">):</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">opcode</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">arg1</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">arg2</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">arg3</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nx">bits</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nx">bits</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nx">bits</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nx">bits</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">  </span><span class="nx">Simple</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">decode</span><span class="p">,</span><span class="w"> </span><span class="nx">wastes</span><span class="w"> </span><span class="nx">space</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">simple</span><span class="w"> </span><span class="nx">instructions</span>

<span class="nx">Variable</span><span class="o">-</span><span class="nx">width</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.,</span><span class="w"> </span><span class="nx">CPython</span><span class="p">):</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">         </span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span><span class="w"> </span><span class="nx">opcode</span><span class="w"> </span><span class="err">â”‚</span><span class="w">    </span><span class="k">or</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">opcode</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">arg</span><span class="w">   </span><span class="err">â”‚</span>
<span class="err">â”‚</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nx">bits</span><span class="w"> </span><span class="err">â”‚</span><span class="w">         </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nx">bits</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="nx">bits</span><span class="w"> </span><span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">         </span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">  </span><span class="nx">Compact</span><span class="p">,</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="nx">harder</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">decode</span>
</code></pre></div>

<h3 id="34">3.4 ëª…ë ¹ì–´ ì§‘í•© ì •ì˜<a class="header-link" href="#34" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">IntEnum</span><span class="p">,</span> <span class="n">auto</span>


<span class="k">class</span><span class="w"> </span><span class="nc">OpCode</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bytecode instruction opcodes for our simple VM.&quot;&quot;&quot;</span>

    <span class="c1"># Stack operations</span>
    <span class="n">CONST</span> <span class="o">=</span> <span class="mi">0</span>        <span class="c1"># Push constant: CONST &lt;index&gt;</span>
    <span class="n">POP</span> <span class="o">=</span> <span class="mi">1</span>          <span class="c1"># Pop top of stack</span>

    <span class="c1"># Arithmetic</span>
    <span class="n">ADD</span> <span class="o">=</span> <span class="mi">2</span>          <span class="c1"># Pop two, push sum</span>
    <span class="n">SUB</span> <span class="o">=</span> <span class="mi">3</span>          <span class="c1"># Pop two, push difference</span>
    <span class="n">MUL</span> <span class="o">=</span> <span class="mi">4</span>          <span class="c1"># Pop two, push product</span>
    <span class="n">DIV</span> <span class="o">=</span> <span class="mi">5</span>          <span class="c1"># Pop two, push quotient</span>
    <span class="n">MOD</span> <span class="o">=</span> <span class="mi">6</span>          <span class="c1"># Pop two, push remainder</span>
    <span class="n">NEG</span> <span class="o">=</span> <span class="mi">7</span>          <span class="c1"># Negate top of stack</span>

    <span class="c1"># Comparison</span>
    <span class="n">EQ</span> <span class="o">=</span> <span class="mi">8</span>           <span class="c1"># Equal</span>
    <span class="n">NE</span> <span class="o">=</span> <span class="mi">9</span>           <span class="c1"># Not equal</span>
    <span class="n">LT</span> <span class="o">=</span> <span class="mi">10</span>          <span class="c1"># Less than</span>
    <span class="n">GT</span> <span class="o">=</span> <span class="mi">11</span>          <span class="c1"># Greater than</span>
    <span class="n">LE</span> <span class="o">=</span> <span class="mi">12</span>          <span class="c1"># Less or equal</span>
    <span class="n">GE</span> <span class="o">=</span> <span class="mi">13</span>          <span class="c1"># Greater or equal</span>

    <span class="c1"># Logical</span>
    <span class="n">NOT</span> <span class="o">=</span> <span class="mi">14</span>         <span class="c1"># Logical not</span>

    <span class="c1"># Variables</span>
    <span class="n">LOAD</span> <span class="o">=</span> <span class="mi">15</span>        <span class="c1"># Push variable value: LOAD &lt;slot&gt;</span>
    <span class="n">STORE</span> <span class="o">=</span> <span class="mi">16</span>       <span class="c1"># Pop and store to variable: STORE &lt;slot&gt;</span>
    <span class="n">LOAD_GLOBAL</span> <span class="o">=</span> <span class="mi">17</span> <span class="c1"># Push global value: LOAD_GLOBAL &lt;index&gt;</span>
    <span class="n">STORE_GLOBAL</span> <span class="o">=</span> <span class="mi">18</span><span class="c1"># Store global: STORE_GLOBAL &lt;index&gt;</span>

    <span class="c1"># Control flow</span>
    <span class="n">JUMP</span> <span class="o">=</span> <span class="mi">19</span>        <span class="c1"># Unconditional jump: JUMP &lt;offset&gt;</span>
    <span class="n">JUMP_IF_FALSE</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Conditional jump: JUMP_IF_FALSE &lt;offset&gt;</span>
    <span class="n">JUMP_IF_TRUE</span> <span class="o">=</span> <span class="mi">21</span>   <span class="c1"># Conditional jump: JUMP_IF_TRUE &lt;offset&gt;</span>

    <span class="c1"># Functions</span>
    <span class="n">CALL</span> <span class="o">=</span> <span class="mi">22</span>        <span class="c1"># Call function: CALL &lt;num_args&gt;</span>
    <span class="n">RETURN</span> <span class="o">=</span> <span class="mi">23</span>      <span class="c1"># Return from function</span>

    <span class="c1"># I/O</span>
    <span class="n">PRINT</span> <span class="o">=</span> <span class="mi">24</span>       <span class="c1"># Print top of stack</span>

    <span class="c1"># Special</span>
    <span class="n">HALT</span> <span class="o">=</span> <span class="mi">25</span>        <span class="c1"># Stop execution</span>

    <span class="c1"># Constants</span>
    <span class="n">TRUE</span> <span class="o">=</span> <span class="mi">26</span>        <span class="c1"># Push True</span>
    <span class="n">FALSE</span> <span class="o">=</span> <span class="mi">27</span>       <span class="c1"># Push False</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="mi">28</span>        <span class="c1"># Push None</span>


<span class="c1"># Instruction metadata</span>
<span class="n">INSTRUCTION_INFO</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;CONST&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>          <span class="c1"># 1 argument (constant index)</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">POP</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;POP&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;SUB&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;MUL&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">DIV</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;DIV&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">MOD</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;MOD&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">NEG</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;NEG&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;EQ&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">NE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;NE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">LT</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;LT&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">GT</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;GT&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;LE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;GE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">NOT</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;NOT&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">LOAD</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;LOAD&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">STORE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;STORE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">LOAD_GLOBAL</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;LOAD_GLOBAL&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">STORE_GLOBAL</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;STORE_GLOBAL&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;JUMP&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_FALSE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;JUMP_IF_FALSE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_TRUE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;JUMP_IF_TRUE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">CALL</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;CALL&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">RETURN</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;RETURN&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">PRINT</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;PRINT&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">HALT</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;HALT&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">TRUE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TRUE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">FALSE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;FALSE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">OpCode</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="4">4. ìŠ¤íƒ ê¸°ë°˜ ê°€ìƒ ë¨¸ì‹ <a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41-vm">4.1 ìŠ¤íƒ VM ì‘ë™ ë°©ì‹<a class="header-link" href="#41-vm" title="Permanent link">&para;</a></h3>
<p>ìŠ¤íƒ ê¸°ë°˜ VMì€ ëª¨ë“  ê³„ì‚°ì„ ìœ„í•´ í”¼ì—°ì‚°ì ìŠ¤íƒì„ ì‚¬ìš©í•©ë‹ˆë‹¤. í”¼ì—°ì‚°ìëŠ” ìŠ¤íƒì— í‘¸ì‹œë˜ê³ , ì—°ì‚°ì€ ì¸ìˆ˜ë¥¼ íŒí•˜ê³  ê²°ê³¼ë¥¼ í‘¸ì‹œí•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>Computing x = a + b <span class="gs">* c:</span>

<span class="gs">Instructions:          Stack (grows right â†’)</span>
<span class="gs">                       []</span>
<span class="gs">LOAD a                 [3]</span>
<span class="gs">LOAD b                 [3, 4]</span>
<span class="gs">LOAD c                 [3, 4, 5]</span>
<span class="gs">MUL                    [3, 20]      (4 *</span> 5 = 20)
ADD                    [23]         (3 + 20 = 23)
STORE x                []           (x = 23)
</code></pre></div>

<h3 id="42-vm">4.2 ìŠ¤íƒ VMì˜ ì¥ì <a class="header-link" href="#42-vm" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>ë‹¨ìˆœí•œ ì½”ë“œ ìƒì„±</strong>: ë ˆì§€ìŠ¤í„° í• ë‹¹ ë¶ˆí•„ìš”</li>
<li><strong>ì»´íŒ©íŠ¸ ë°”ì´íŠ¸ì½”ë“œ</strong>: ëª…ë ¹ì–´ê°€ í”¼ì—°ì‚°ì ìœ„ì¹˜ë¥¼ ì§€ì •í•  í•„ìš” ì—†ìŒ</li>
<li><strong>êµ¬í˜„ ìš©ì´</strong>: ìŠ¤íƒì´ ìì—°ìŠ¤ëŸ¬ìš´ í‰ê°€ ìˆœì„œ ì œê³µ</li>
<li><strong>ì´ì‹ì„±</strong>: í•˜ë“œì›¨ì–´ ë ˆì§€ìŠ¤í„° ìˆ˜ì— ëŒ€í•œ ê°€ì • ì—†ìŒ</li>
</ol>
<h3 id="43">4.3 ë‹¨ì <a class="header-link" href="#43" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>ë” ë§ì€ ëª…ë ¹ì–´</strong>: <code>LOAD a; LOAD b; ADD</code> vs <code>ADD r1, r2, r3</code></li>
<li><strong>ë©”ëª¨ë¦¬ íŠ¸ë˜í”½</strong>: ëª¨ë“  ì—°ì‚°ì´ ìŠ¤íƒì„ ì½ê³  ì”€ (ë ˆì§€ìŠ¤í„°ê°€ ì•„ë‹Œ ë©”ëª¨ë¦¬)</li>
<li><strong>ìµœì í™” ì–´ë ¤ì›€</strong>: ìŠ¤íƒ ìœ„ì¹˜ê°€ ì•”ë¬µì ì´ì–´ì„œ ë¶„ì„ì´ ì–´ë ¤ì›€</li>
</ol>
<h3 id="44-vm">4.4 ê¸°ë³¸ ìŠ¤íƒ VM êµ¬í˜„<a class="header-link" href="#44-vm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CodeObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compiled code object (like Python&#39;s code object).</span>
<span class="sd">    Contains bytecode, constants, and metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&lt;module&gt;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># List of (opcode, arg) tuples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constants</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># Constant pool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_names</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># Local variable names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_locals</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Emit a bytecode instruction.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">opcode</span><span class="p">,</span> <span class="n">arg</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Return instruction index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a constant to the pool, return its index.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a local variable, return its slot index.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_locals</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disassemble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print human-readable bytecode.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Disassembly of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Constants: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Locals: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">local_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Instructions:&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bytecode</span><span class="p">):</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">num_args</span> <span class="o">=</span> <span class="n">INSTRUCTION_INFO</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;???&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Add human-readable annotation</span>
                <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">:</span>
                    <span class="n">extra</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="k">elif</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">LOAD</span><span class="p">,</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">STORE</span><span class="p">):</span>
                    <span class="n">extra</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">local_names</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">arg</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_names</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="k">elif</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP</span><span class="p">,</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_FALSE</span><span class="p">,</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_TRUE</span><span class="p">):</span>
                    <span class="n">extra</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (-&gt; </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">extra</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;20s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">arg</span><span class="si">}{</span><span class="n">extra</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="5">5. ë ˆì§€ìŠ¤í„° ê¸°ë°˜ ê°€ìƒ ë¨¸ì‹ <a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51-vm">5.1 ë ˆì§€ìŠ¤í„° VM ì„¤ê³„<a class="header-link" href="#51-vm" title="Permanent link">&para;</a></h3>
<p>ë ˆì§€ìŠ¤í„° ê¸°ë°˜ VMì€ ìŠ¤íƒ ëŒ€ì‹  ê°€ìƒ ë ˆì§€ìŠ¤í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ëª…ë ¹ì–´ëŠ” ì†ŒìŠ¤ì™€ ëŒ€ìƒ ë ˆì§€ìŠ¤í„°ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>Computing x = a + b <span class="gs">* c:</span>

<span class="gs">Stack VM:              Register VM:</span>
<span class="gs">  LOAD a                 MUL  r2, r1, r2    (r2 = b *</span> c)
  LOAD b                 ADD  r0, r0, r2    (r0 = a + r2)
  LOAD c
  MUL
  ADD
  STORE x

  6 instructions         2 instructions
</code></pre></div>

<h3 id="52-vm">5.2 ë ˆì§€ìŠ¤í„° VM ì˜ˆì œ<a class="header-link" href="#52-vm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RegisterVM</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple register-based VM.</span>

<span class="sd">    Instructions: (opcode, dest, src1, src2)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_registers</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_registers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">constants</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute register-based instructions.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">pc</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">):</span>
            <span class="n">instr</span> <span class="o">=</span> <span class="n">instructions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pc</span><span class="p">]</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;LOADK&#39;</span><span class="p">:</span>     <span class="c1"># Load constant: LOADK dest, const_idx</span>
                <span class="n">dest</span><span class="p">,</span> <span class="n">const_idx</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="n">const_idx</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;MOVE&#39;</span><span class="p">:</span>     <span class="c1"># Move: MOVE dest, src</span>
                <span class="n">dest</span><span class="p">,</span> <span class="n">src</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;ADD&#39;</span><span class="p">:</span>      <span class="c1"># Add: ADD dest, src1, src2</span>
                <span class="n">dest</span><span class="p">,</span> <span class="n">src1</span><span class="p">,</span> <span class="n">src2</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src2</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;MUL&#39;</span><span class="p">:</span>
                <span class="n">dest</span><span class="p">,</span> <span class="n">src1</span><span class="p">,</span> <span class="n">src2</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src2</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;SUB&#39;</span><span class="p">:</span>
                <span class="n">dest</span><span class="p">,</span> <span class="n">src1</span><span class="p">,</span> <span class="n">src2</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src2</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;LT&#39;</span><span class="p">:</span>       <span class="c1"># Less than: LT dest, src1, src2</span>
                <span class="n">dest</span><span class="p">,</span> <span class="n">src1</span><span class="p">,</span> <span class="n">src2</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">src2</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;JMP&#39;</span><span class="p">:</span>      <span class="c1"># Jump: JMP offset</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pc</span> <span class="o">+=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;JMPF&#39;</span><span class="p">:</span>     <span class="c1"># Jump if false: JMPF test, offset</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pc</span> <span class="o">+=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;PRINT&#39;</span><span class="p">:</span>    <span class="c1"># Print: PRINT src</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Output: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="s1">&#39;HALT&#39;</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_register_vm</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate register-based VM computing sum 1..10.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Register VM Demo ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing sum of 1 to 10:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">vm</span> <span class="o">=</span> <span class="n">RegisterVM</span><span class="p">()</span>

    <span class="c1"># sum = 0; i = 1; while i &lt;= 10: sum += i; i += 1</span>
    <span class="n">constants</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>  <span class="c1"># 0: zero, 1: one, 2: ten</span>

    <span class="n">instructions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;LOADK&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>        <span class="c1"># r0 = 0 (sum)</span>
        <span class="p">(</span><span class="s1">&#39;LOADK&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>        <span class="c1"># r1 = 1 (i)</span>
        <span class="p">(</span><span class="s1">&#39;LOADK&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>        <span class="c1"># r2 = 10 (limit)</span>
        <span class="p">(</span><span class="s1">&#39;LOADK&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>        <span class="c1"># r3 = 1 (increment)</span>
        <span class="c1"># Loop start (pc=4):</span>
        <span class="p">(</span><span class="s1">&#39;LT&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>       <span class="c1"># r4 = (10 &lt; i), i.e., i &gt; 10</span>
        <span class="p">(</span><span class="s1">&#39;JMPF&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>        <span class="c1"># if not (i &gt; 10), skip next</span>
        <span class="p">(</span><span class="s1">&#39;JMP&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>             <span class="c1"># jump to end (pc=10)</span>
        <span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>       <span class="c1"># sum += i</span>
        <span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>       <span class="c1"># i += 1</span>
        <span class="p">(</span><span class="s1">&#39;JMP&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">),</span>            <span class="c1"># jump back to loop start (pc=4)</span>
        <span class="c1"># End (pc=10):</span>
        <span class="p">(</span><span class="s1">&#39;PRINT&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>           <span class="c1"># print sum</span>
        <span class="p">(</span><span class="s1">&#39;HALT&#39;</span><span class="p">,),</span>
    <span class="p">]</span>

    <span class="n">vm</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">constants</span><span class="p">)</span>

<span class="n">demonstrate_register_vm</span><span class="p">()</span>
</code></pre></div>

<h3 id="53-vs">5.3 ìŠ¤íƒ vs ë ˆì§€ìŠ¤í„° ë¹„êµ<a class="header-link" href="#53-vs" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ì¸¡ë©´</th>
<th>ìŠ¤íƒ ê¸°ë°˜</th>
<th>ë ˆì§€ìŠ¤í„° ê¸°ë°˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ëª…ë ¹ì–´ ìˆ˜</strong></td>
<td>ë§ìŒ (ì•”ë¬µì  í”¼ì—°ì‚°ì)</td>
<td>ì ìŒ (ëª…ì‹œì  í”¼ì—°ì‚°ì)</td>
</tr>
<tr>
<td><strong>ëª…ë ¹ì–´ í¬ê¸°</strong></td>
<td>ì‘ìŒ (ë ˆì§€ìŠ¤í„° í•„ë“œ ì—†ìŒ)</td>
<td>í¼ (2-3 ë ˆì§€ìŠ¤í„° í”¼ì—°ì‚°ì)</td>
</tr>
<tr>
<td><strong>ì½”ë“œ í¬ê¸°</strong></td>
<td>ì¢…ì¢… ë” ì‘ìŒ</td>
<td>ì¢…ì¢… ë” í¼</td>
</tr>
<tr>
<td><strong>ë””ìŠ¤íŒ¨ì¹˜ íšŸìˆ˜</strong></td>
<td>ë” ë§ìŒ (ë” ë§ì€ ëª…ë ¹ì–´)</td>
<td>ë” ì ìŒ</td>
</tr>
<tr>
<td><strong>êµ¬í˜„</strong></td>
<td>ë” ë‹¨ìˆœ</td>
<td>ë” ë³µì¡</td>
</tr>
<tr>
<td><strong>ìµœì í™”</strong></td>
<td>ì–´ë ¤ì›€ (ìŠ¤íƒì´ ì•”ë¬µì )</td>
<td>ì‰¬ì›€ (ë ˆì§€ìŠ¤í„°ê°€ ëª…ì‹œì )</td>
</tr>
<tr>
<td><strong>ì˜ˆì‹œ</strong></td>
<td>JVM, CPython, CLR, WASM</td>
<td>Lua 5, Dalvik, BEAM</td>
</tr>
</tbody>
</table>
<p>Shi et al. (2008)ì˜ ì—°êµ¬ì— ë”°ë¥´ë©´ ë ˆì§€ìŠ¤í„° ê¸°ë°˜ VMì€ ì•½ 47% ë” ì ì€ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©°, ë” í° ì½”ë“œ í¬ê¸°ì—ë„ ë¶ˆêµ¬í•˜ê³  ì¼ë°˜ì ìœ¼ë¡œ 20-30% ë” ë¹ ë¦…ë‹ˆë‹¤.</p>
<hr />
<h2 id="6">6. ëª…ë ¹ì–´ ë””ìŠ¤íŒ¨ì¹˜ ê¸°ë²•<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61-switch-dispatch">6.1 ìŠ¤ìœ„ì¹˜ ë””ìŠ¤íŒ¨ì¹˜(Switch Dispatch)<a class="header-link" href="#61-switch-dispatch" title="Permanent link">&para;</a></h3>
<p>ê°€ì¥ ë‹¨ìˆœí•œ ë””ìŠ¤íŒ¨ì¹˜ ë©”ì»¤ë‹ˆì¦˜: í° <code>switch</code> (ë˜ëŠ” <code>if/elif</code>) ë¬¸.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">switch_dispatch</span><span class="p">(</span><span class="n">bytecode</span><span class="p">,</span> <span class="n">constants</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute bytecode using switch dispatch.</span>
<span class="sd">    This is the simplest but slowest dispatch method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">pc</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytecode</span><span class="p">):</span>
        <span class="n">opcode</span><span class="p">,</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">:</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constants</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">PRINT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">HALT</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="c1"># ... more cases</span>

        <span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>

<p><strong>ë¬¸ì œ</strong>: CPUì˜ ë¶„ê¸° ì˜ˆì¸¡ê¸°ëŠ” ëª¨ë“  ì˜µì½”ë“œì— ëŒ€í•´ í•˜ë‚˜ì˜ ë¶„ê¸° ì§€ì ì„ ë´…ë‹ˆë‹¤. ì´ì „ ì˜µì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œë§Œ ë‹¤ìŒ ì˜µì½”ë“œë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë‚®ì€ ì •í™•ë„).</p>
<h3 id="62-direct-threaded-code">6.2 ì§ì ‘ ìŠ¤ë ˆë“œ ì½”ë“œ(Direct Threaded Code)<a class="header-link" href="#62-direct-threaded-code" title="Permanent link">&para;</a></h3>
<p>ì˜µì½”ë“œ ê°’ì„ í•¸ë“¤ëŸ¬ ì½”ë“œì— ëŒ€í•œ ì§ì ‘ í¬ì¸í„°ë¡œ êµì²´í•©ë‹ˆë‹¤. ê° í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ëœ í›„ ë‹¤ìŒ í•¸ë“¤ëŸ¬ë¡œ ì§ì ‘ ì í”„í•©ë‹ˆë‹¤(ì¤‘ì•™ ë””ìŠ¤íŒ¨ì¹˜ ë£¨í”„ ì—†ìŒ).</p>
<p>Cë¡œ ì‘ì„± (ìˆœìˆ˜ Pythonì—ì„œëŠ” ì–¸ì–´ ì œí•œìœ¼ë¡œ ë¶ˆê°€):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// C implementation of direct threading</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">dispatch_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="n">op_const</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">op_add</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">op_sub</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">op_mul</span><span class="p">,</span><span class="w"> </span><span class="cm">/* ... */</span>
<span class="p">};</span>

<span class="c1">// Initial dispatch</span>
<span class="k">goto</span><span class="w"> </span><span class="o">*</span><span class="n">dispatch_table</span><span class="p">[</span><span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="p">]];</span>

<span class="nl">op_const</span><span class="p">:</span>
<span class="w">    </span><span class="n">stack</span><span class="p">[</span><span class="n">sp</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">constants</span><span class="p">[</span><span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="o">+</span><span class="mi">1</span><span class="p">]];</span>
<span class="w">    </span><span class="n">pc</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="o">*</span><span class="n">dispatch_table</span><span class="p">[</span><span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="p">]];</span><span class="w">  </span><span class="c1">// Direct jump to next handler</span>

<span class="nl">op_add</span><span class="p">:</span>
<span class="w">    </span><span class="n">sp</span><span class="o">--</span><span class="p">;</span>
<span class="w">    </span><span class="n">stack</span><span class="p">[</span><span class="n">sp</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">stack</span><span class="p">[</span><span class="n">sp</span><span class="p">];</span>
<span class="w">    </span><span class="n">pc</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="o">*</span><span class="n">dispatch_table</span><span class="p">[</span><span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="p">]];</span>
</code></pre></div>

<p><strong>ì¥ì </strong>: ê° í•¸ë“¤ëŸ¬ì—ëŠ” ìì²´ ê°„ì ‘ ë¶„ê¸°ê°€ ìˆì–´ CPU ë¶„ê¸° ì˜ˆì¸¡ê¸°ì— ë” ë§ì€ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìŠ¤ìœ„ì¹˜ ë””ìŠ¤íŒ¨ì¹˜ë³´ë‹¤ 15-25% ì†ë„ í–¥ìƒì„ ì œê³µí•©ë‹ˆë‹¤.</p>
<h3 id="63-computed-goto-gcc">6.3 Computed Goto (GCC í™•ì¥)<a class="header-link" href="#63-computed-goto-gcc" title="Permanent link">&para;</a></h3>
<p>GCCì˜ <code>&amp;&amp;label</code> í™•ì¥ì€ Cì—ì„œ ì§ì ‘ ìŠ¤ë ˆë”©ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. CPythonì€ ê°€ëŠ¥í•  ë•Œ ì´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Python simulation of computed goto dispatch</span>
<span class="c1"># (In practice, this is done in C with goto *dispatch_table[opcode])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">computed_goto_simulation</span><span class="p">(</span><span class="n">bytecode</span><span class="p">,</span> <span class="n">constants</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate computed goto dispatch in Python.</span>

<span class="sd">    In real C implementations, this uses GCC&#39;s &amp;&amp;label extension</span>
<span class="sd">    for indirect branches, which enables better branch prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Handler functions (simulate goto targets)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_const</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">pc</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constants</span><span class="p">[</span><span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_add</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">pc</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_mul</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">pc</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_print</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">pc</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Output: </span><span class="si">{</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_halt</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">pc</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytecode</span><span class="p">)</span>  <span class="c1"># Exit</span>

    <span class="c1"># Dispatch table (simulates array of goto labels)</span>
    <span class="n">dispatch</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">:</span> <span class="n">handle_const</span><span class="p">,</span>
        <span class="n">OpCode</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span> <span class="n">handle_add</span><span class="p">,</span>
        <span class="n">OpCode</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span> <span class="n">handle_mul</span><span class="p">,</span>
        <span class="n">OpCode</span><span class="o">.</span><span class="n">PRINT</span><span class="p">:</span> <span class="n">handle_print</span><span class="p">,</span>
        <span class="n">OpCode</span><span class="o">.</span><span class="n">HALT</span><span class="p">:</span> <span class="n">handle_halt</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">while</span> <span class="n">pc</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytecode</span><span class="p">):</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dispatch</span><span class="p">[</span><span class="n">opcode</span><span class="p">]()</span>  <span class="c1"># &quot;Computed goto&quot;</span>
</code></pre></div>

<h3 id="64-subroutine-threading">6.4 ì„œë¸Œë£¨í‹´ ìŠ¤ë ˆë”©(Subroutine Threading)<a class="header-link" href="#64-subroutine-threading" title="Permanent link">&para;</a></h3>
<p>ê° ë°”ì´íŠ¸ì½”ë“œ ëª…ë ¹ì–´ê°€ í•´ë‹¹ í•¸ë“¤ëŸ¬ ì„œë¸Œë£¨í‹´ì— ëŒ€í•œ í˜¸ì¶œë¡œ ì»´íŒŒì¼ë©ë‹ˆë‹¤. ìŠ¤ìœ„ì¹˜ë³´ë‹¤ ë¹ ë¥´ê³ , ì§ì ‘ ìŠ¤ë ˆë”©ë³´ë‹¤ ëŠë¦½ë‹ˆë‹¤ (call/return ì˜¤ë²„í—¤ë“œ).</p>
<h3 id="65">6.5 ë””ìŠ¤íŒ¨ì¹˜ ì„±ëŠ¥ ë¹„êµ<a class="header-link" href="#65" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">benchmark_dispatch</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare dispatch techniques (simplified Python benchmark).</span>
<span class="sd">    Real-world differences are more pronounced in C/C++.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a simple program: push 1, push 2, add, repeated 1M times</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">100_000</span>

    <span class="n">bytecode</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">constants</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">bytecode</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">bytecode</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">bytecode</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">OpCode</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">bytecode</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">OpCode</span><span class="o">.</span><span class="n">POP</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">bytecode</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">OpCode</span><span class="o">.</span><span class="n">HALT</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># Method 1: if/elif chain</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">pc</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytecode</span><span class="p">):</span>
        <span class="n">op</span><span class="p">,</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">:</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constants</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">POP</span><span class="p">:</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">HALT</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">time_switch</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># Method 2: Dictionary dispatch</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_const</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_add</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="n">b</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">();</span> <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a2</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_pop</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="n">dispatch_table</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">:</span> <span class="n">do_const</span><span class="p">,</span>
        <span class="n">OpCode</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span> <span class="n">do_add</span><span class="p">,</span>
        <span class="n">OpCode</span><span class="o">.</span><span class="n">POP</span><span class="p">:</span> <span class="n">do_pop</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">pc</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytecode</span><span class="p">):</span>
        <span class="n">op</span><span class="p">,</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">bytecode</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">HALT</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">dispatch_table</span><span class="p">[</span><span class="n">op</span><span class="p">](</span><span class="n">stack</span><span class="p">,</span> <span class="n">constants</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
        <span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">time_dict</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Dispatch Benchmark (</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> iterations) ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;if/elif chain: </span><span class="si">{</span><span class="n">time_switch</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dict dispatch: </span><span class="si">{</span><span class="n">time_dict</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ratio: </span><span class="si">{</span><span class="n">time_dict</span><span class="o">/</span><span class="n">time_switch</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>

<span class="c1"># benchmark_dispatch()  # Uncomment to run</span>
</code></pre></div>

<hr />
<h2 id="7-vm">7. ì™„ì „í•œ ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬ì™€ VM<a class="header-link" href="#7-vm" title="Permanent link">&para;</a></h2>
<p>ì´ ì ˆì—ì„œëŠ” ê°„ë‹¨í•œ ì–¸ì–´ë¥¼ ìœ„í•œ ì™„ì „í•œ ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬ì™€ ìŠ¤íƒ ê¸°ë°˜ VMì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>
<h3 id="71">7.1 ì–¸ì–´<a class="header-link" href="#71" title="Permanent link">&para;</a></h3>
<p>ìš°ë¦¬ì˜ ì–¸ì–´("Mini"ë¼ê³  ë¶ˆë¦¼)ëŠ” ë‹¤ìŒì„ ì§€ì›í•©ë‹ˆë‹¤:
- ì •ìˆ˜, ë¶€ë™ì†Œìˆ˜ì , ë¶ˆë¦¬ì–¸, ë¬¸ìì—´
- ì‚°ìˆ  ë° ë¹„êµ ì—°ì‚°ì
- ë³€ìˆ˜ì™€ í• ë‹¹
- <code>if</code>/<code>else</code> ì¡°ê±´ë¬¸
- <code>while</code> ë£¨í”„
- ë§¤ê°œë³€ìˆ˜ì™€ ë°˜í™˜ê°’ì´ ìˆëŠ” í•¨ìˆ˜
- Print ë¬¸</p>
<h3 id="72">7.2 ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬<a class="header-link" href="#72" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Compiler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bytecode compiler: AST -&gt; CodeObject.</span>
<span class="sd">    Walks the AST and emits bytecode instructions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">CodeObject</span><span class="p">(</span><span class="s1">&#39;&lt;module&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># name -&gt; CodeObject</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compile a list of AST statements to bytecode.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">program</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">HALT</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compile a single AST node.&quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;compile_</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CompileError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot compile </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">method</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_NumberLit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_StringLit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_BoolLit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">TRUE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">FALSE</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_Identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">add_local</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">LOAD</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_BinOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># Compile left operand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="c1"># Compile right operand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
        <span class="c1"># Emit operation</span>
        <span class="n">op_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;+&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">ADD</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">SUB</span><span class="p">,</span>
            <span class="s1">&#39;*&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">MUL</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">DIV</span><span class="p">,</span>
            <span class="s1">&#39;%&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">MOD</span><span class="p">,</span>
            <span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">NE</span><span class="p">,</span>
            <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">LT</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">GT</span><span class="p">,</span>
            <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">GE</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">op_map</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CompileError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown operator: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">op_map</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_UnaryOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">NEG</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;not&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">NOT</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">add_local</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">STORE</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_If</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># Compile condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>

        <span class="c1"># Jump to else/end if false</span>
        <span class="n">jump_to_else</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_FALSE</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Placeholder</span>

        <span class="c1"># Compile then body</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">then_body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">:</span>
            <span class="c1"># Jump over else body</span>
            <span class="n">jump_to_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Placeholder</span>

            <span class="c1"># Patch jump to else</span>
            <span class="n">else_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">[</span><span class="n">jump_to_else</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_FALSE</span><span class="p">,</span> <span class="n">else_start</span><span class="p">)</span>

            <span class="c1"># Compile else body</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">else_body</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

            <span class="c1"># Patch jump to end</span>
            <span class="n">end_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">[</span><span class="n">jump_to_end</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP</span><span class="p">,</span> <span class="n">end_pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Patch jump to end (no else)</span>
            <span class="n">end_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">[</span><span class="n">jump_to_else</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_FALSE</span><span class="p">,</span> <span class="n">end_pos</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_While</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># Loop start</span>
        <span class="n">loop_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">)</span>

        <span class="c1"># Compile condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>

        <span class="c1"># Jump to end if false</span>
        <span class="n">jump_to_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_FALSE</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Placeholder</span>

        <span class="c1"># Compile body</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

        <span class="c1"># Jump back to start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP</span><span class="p">,</span> <span class="n">loop_start</span><span class="p">)</span>

        <span class="c1"># Patch jump to end</span>
        <span class="n">end_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">[</span><span class="n">jump_to_end</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_FALSE</span><span class="p">,</span> <span class="n">end_pos</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">PRINT</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_FuncDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># Compile function to a separate CodeObject</span>
        <span class="n">func_code</span> <span class="o">=</span> <span class="n">CodeObject</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Add parameters as locals</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="n">func_code</span><span class="o">.</span><span class="n">add_local</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="c1"># Save current code object, switch to function&#39;s</span>
        <span class="n">parent_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">func_code</span>

        <span class="c1"># Compile function body</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

        <span class="c1"># Ensure function returns None if no explicit return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>

        <span class="c1"># Restore parent code object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">parent_code</span>

        <span class="c1"># Store function in constants</span>
        <span class="n">func_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">func_code</span><span class="p">)</span>
        <span class="n">func_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">add_local</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">,</span> <span class="n">func_idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">STORE</span><span class="p">,</span> <span class="n">func_slot</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_FuncCall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># Push function object</span>
        <span class="n">slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">add_local</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">LOAD</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>

        <span class="c1"># Push arguments</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="c1"># Call with number of arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">CALL</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_Return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">OpCode</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CompileError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>

<h3 id="73">7.3 ê°€ìƒ ë¨¸ì‹ <a class="header-link" href="#73" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Frame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call frame: represents a function invocation.</span>
<span class="sd">    Contains local variables and a return address.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">return_addr</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locals</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">num_locals</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_addr</span> <span class="o">=</span> <span class="n">return_addr</span>


<span class="k">class</span><span class="w"> </span><span class="nc">VirtualMachine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stack-based virtual machine for our bytecode.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># Captured output</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a CodeObject.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span>
            <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">pc</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">opcode</span><span class="p">,</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">bytecode</span><span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">pc</span><span class="p">]</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">pc</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Dispatch</span>
            <span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">CONST</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">constants</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">POP</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">MUL</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">DIV</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Division by zero&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">MOD</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">NEG</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">NE</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">LT</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">GT</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">NOT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">LOAD</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">locals</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">STORE</span><span class="p">:</span>
                <span class="n">frame</span><span class="o">.</span><span class="n">locals</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP</span><span class="p">:</span>
                <span class="n">frame</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="n">arg</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_FALSE</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">():</span>
                    <span class="n">frame</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="n">arg</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">JUMP_IF_TRUE</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">():</span>
                    <span class="n">frame</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="n">arg</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">CALL</span><span class="p">:</span>
                <span class="n">num_args</span> <span class="o">=</span> <span class="n">arg</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_args</span><span class="p">):</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

                <span class="n">func_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># Pop function object</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func_code</span><span class="p">,</span> <span class="n">CodeObject</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not callable: </span><span class="si">{</span><span class="n">func_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Create new frame</span>
                <span class="n">new_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">func_code</span><span class="p">,</span> <span class="n">return_addr</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Bind arguments to parameters</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
                    <span class="n">new_frame</span><span class="o">.</span><span class="n">locals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

                <span class="c1"># Push current frame&#39;s return info</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_frame</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span> <span class="o">=</span> <span class="n">new_frame</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">RETURN</span><span class="p">:</span>
                <span class="n">return_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                <span class="c1"># Pop frame</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">return_value</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">return_value</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">PRINT</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  &gt;&gt; </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">TRUE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">FALSE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="n">OpCode</span><span class="o">.</span><span class="n">HALT</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown opcode: </span><span class="si">{</span><span class="n">opcode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div>

<h3 id="74">7.4 ëª¨ë‘ í•©ì¹˜ê¸°<a class="header-link" href="#74" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_mini_program</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compile and run a complete Mini program.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Complete Bytecode Compiler + VM Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Program: compute factorial using a loop</span>
    <span class="n">program</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># n = 10</span>
        <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>

        <span class="c1"># result = 1</span>
        <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>

        <span class="c1"># i = 1</span>
        <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>

        <span class="c1"># while i &lt;= n:</span>
        <span class="n">While</span><span class="p">(</span>
            <span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">),</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)),</span>
            <span class="p">[</span>
                <span class="c1"># result = result * i</span>
                <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">),</span>
                                       <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">))),</span>
                <span class="c1"># i = i + 1</span>
                <span class="n">Assign</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">),</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">))),</span>
            <span class="p">]</span>
        <span class="p">),</span>

        <span class="c1"># print(result)</span>
        <span class="n">Print</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">)),</span>
    <span class="p">]</span>

    <span class="c1"># Compile</span>
    <span class="n">compiler</span> <span class="o">=</span> <span class="n">Compiler</span><span class="p">()</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>

    <span class="c1"># Disassemble</span>
    <span class="n">code</span><span class="o">.</span><span class="n">disassemble</span><span class="p">()</span>

    <span class="c1"># Execute</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Execution ---&quot;</span><span class="p">)</span>
    <span class="n">vm</span> <span class="o">=</span> <span class="n">VirtualMachine</span><span class="p">()</span>
    <span class="n">vm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="c1"># Program 2: Recursive function</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program 2: Recursive Fibonacci</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">program2</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FuncDef</span><span class="p">(</span><span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">If</span><span class="p">(</span>
                <span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">NumberLit</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))],</span>
                <span class="p">[</span><span class="n">Return</span><span class="p">(</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                              <span class="n">FuncCall</span><span class="p">(</span><span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span>
                                                     <span class="n">NumberLit</span><span class="p">(</span><span class="mi">1</span><span class="p">))]),</span>
                              <span class="n">FuncCall</span><span class="p">(</span><span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">BinOp</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">),</span>
                                                     <span class="n">NumberLit</span><span class="p">(</span><span class="mi">2</span><span class="p">))])))]</span>
            <span class="p">)</span>
        <span class="p">]),</span>
        <span class="n">Print</span><span class="p">(</span><span class="n">FuncCall</span><span class="p">(</span><span class="s1">&#39;fib&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">NumberLit</span><span class="p">(</span><span class="mi">10</span><span class="p">)])),</span>
    <span class="p">]</span>

    <span class="n">compiler2</span> <span class="o">=</span> <span class="n">Compiler</span><span class="p">()</span>
    <span class="n">code2</span> <span class="o">=</span> <span class="n">compiler2</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">program2</span><span class="p">)</span>
    <span class="n">code2</span><span class="o">.</span><span class="n">disassemble</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Execution ---&quot;</span><span class="p">)</span>
    <span class="n">vm2</span> <span class="o">=</span> <span class="n">VirtualMachine</span><span class="p">()</span>
    <span class="n">vm2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">code2</span><span class="p">)</span>

<span class="n">run_mini_program</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="8-jit">8. JIT ì»´íŒŒì¼<a class="header-link" href="#8-jit" title="Permanent link">&para;</a></h2>
<h3 id="81-jit">8.1 ì™œ JITì¸ê°€?<a class="header-link" href="#81-jit" title="Permanent link">&para;</a></h3>
<p>ë°”ì´íŠ¸ì½”ë“œ í•´ì„ì€ ë””ìŠ¤íŒ¨ì¹˜ ì˜¤ë²„í—¤ë“œ, ë ˆì§€ìŠ¤í„° ì‚¬ìš© ë¶€ì¡±, ì „í†µì ì¸ ì»´íŒŒì¼ëŸ¬ ìµœì í™” ë¶ˆê°€ ë“±ìœ¼ë¡œ ì¸í•´ ì—¬ì „íˆ ë„¤ì´í‹°ë¸Œ ì½”ë“œë³´ë‹¤ 5-20ë°° ëŠë¦½ë‹ˆë‹¤. <strong>JIT(Just-In-Time) ì»´íŒŒì¼</strong>ì€ ëŸ°íƒ€ì„ì— ë°”ì´íŠ¸ì½”ë“œë¥¼ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ì»´íŒŒì¼í•˜ì—¬ ì´ ê²©ì°¨ë¥¼ ì¤„ì…ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code>              Startup Speed  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  Steady-state Speed
Interpretation  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                         â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
Bytecode        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Method JIT      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Tracing JIT     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
AOT Compile     â–‘â–‘â–‘â–‘                             â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
</code></pre></div>

<h3 id="82-jitmethod-jit">8.2 ë©”ì„œë“œ JIT(Method JIT)<a class="header-link" href="#82-jitmethod-jit" title="Permanent link">&para;</a></h3>
<p><strong>ë©”ì„œë“œ JIT</strong> ì»´íŒŒì¼ëŸ¬ëŠ” í•« ë©”ì„œë“œ(ìì£¼ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜)ë¥¼ ì‹ë³„í•˜ì—¬ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ì»´íŒŒì¼í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MethodJITSimulator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulates method JIT compilation behavior.</span>

<span class="sd">    Hot methods are &quot;compiled&quot; (represented by optimized Python functions)</span>
<span class="sd">    when their call count exceeds a threshold.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hot_threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hot_threshold</span> <span class="o">=</span> <span class="n">hot_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_counts</span> <span class="o">=</span> <span class="p">{}</span>       <span class="c1"># method name -&gt; count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="o">=</span> <span class="p">{}</span>          <span class="c1"># method name -&gt; compiled version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compilation_log</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">call_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">interpreted_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call a method, potentially triggering JIT compilation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Track call count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_counts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Check if we should compile</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">call_counts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hot_threshold</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_method</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">interpreted_func</span><span class="p">)</span>

        <span class="c1"># Execute compiled version if available</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span><span class="p">[</span><span class="n">name</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">interpreted_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate JIT compilation of a method.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compilation_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># In reality, this would generate native code</span>
        <span class="c1"># We simulate &quot;optimization&quot; by creating an optimized version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>  <span class="c1"># In practice, a native code version</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [JIT] Compiled method: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;(after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">call_counts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2"> calls)&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_method_jit</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show method JIT behavior.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Method JIT Simulation ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">jit</span> <span class="o">=</span> <span class="n">MethodJITSimulator</span><span class="p">(</span><span class="n">hot_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># First few calls: interpreted</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">jit</span><span class="o">.</span><span class="n">call_method</span><span class="p">(</span><span class="s1">&#39;fibonacci&#39;</span><span class="p">,</span> <span class="n">fibonacci</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Call counts: </span><span class="si">{</span><span class="n">jit</span><span class="o">.</span><span class="n">call_counts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compiled methods: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">jit</span><span class="o">.</span><span class="n">compiled</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_method_jit</span><span class="p">()</span>
</code></pre></div>

<h3 id="83-jittracing-jit">8.3 ì¶”ì  JIT(Tracing JIT)<a class="header-link" href="#83-jittracing-jit" title="Permanent link">&para;</a></h3>
<p><strong>ì¶”ì  JIT</strong>ëŠ” í•« ë£¨í”„ë¥¼ í†µí•œ ì‹¤ì œ ì‹¤í–‰ ê²½ë¡œ("íŠ¸ë ˆì´ìŠ¤")ë¥¼ ê¸°ë¡í•œ í›„, ê·¸ íŠ¹ì • ê²½ë¡œë¥¼ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ì»´íŒŒì¼í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TracingJITSimulator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulates tracing JIT compilation.</span>

<span class="sd">    Records execution traces of hot loops and &quot;compiles&quot; them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hot_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hot_threshold</span> <span class="o">=</span> <span class="n">hot_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traces</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recording</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_trace</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enter_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called at the top of each loop iteration.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop_counts</span><span class="p">[</span><span class="n">loop_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">loop_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">loop_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">traces</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;compiled&#39;</span>  <span class="c1"># Use compiled trace</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_counts</span><span class="p">[</span><span class="n">loop_id</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hot_threshold</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">recording</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recording</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_trace</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_loop</span> <span class="o">=</span> <span class="n">loop_id</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [Trace] Starting trace recording for loop </span><span class="si">{</span><span class="n">loop_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;recording&#39;</span>

        <span class="k">return</span> <span class="s1">&#39;interpreting&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record an operation during tracing.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recording</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_trace</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">op</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_guard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a guard (type check, bounds check, etc.).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recording</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_trace</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;GUARD&#39;</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">condition</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">end_loop_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called at the end of each loop iteration.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recording</span> <span class="ow">and</span> <span class="n">loop_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_loop</span><span class="p">:</span>
            <span class="c1"># Compile the trace</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">traces</span><span class="p">[</span><span class="n">loop_id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trace</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recording</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [Trace] Compiled trace for loop </span><span class="si">{</span><span class="n">loop_id</span><span class="si">}</span><span class="s2"> &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_trace</span><span class="p">)</span><span class="si">}</span><span class="s2"> operations)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_trace</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a compiled trace.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">loop_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">traces</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No trace for loop </span><span class="si">{</span><span class="n">loop_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Trace for loop </span><span class="si">{</span><span class="n">loop_id</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traces</span><span class="p">[</span><span class="n">loop_id</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GUARD&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: GUARD </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_tracing_jit</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show tracing JIT behavior.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Tracing JIT Simulation ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">jit</span> <span class="o">=</span> <span class="n">TracingJITSimulator</span><span class="p">(</span><span class="n">hot_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Simulate a loop: sum = 0; for i in range(10): sum += i * 2</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>  <span class="c1"># Run the same loop 5 times</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">jit</span><span class="o">.</span><span class="n">enter_loop</span><span class="p">(</span><span class="s1">&#39;sum_loop&#39;</span><span class="p">)</span>

            <span class="c1"># Record operations</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">jit</span><span class="o">.</span><span class="n">record_guard</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;type(val) is int&quot;</span><span class="p">)</span>
            <span class="n">jit</span><span class="o">.</span><span class="n">record_operation</span><span class="p">(</span><span class="s1">&#39;LOAD_ARRAY&#39;</span><span class="p">,</span> <span class="s1">&#39;arr&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

            <span class="n">doubled</span> <span class="o">=</span> <span class="n">val</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">jit</span><span class="o">.</span><span class="n">record_operation</span><span class="p">(</span><span class="s1">&#39;MUL&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">total</span> <span class="o">+=</span> <span class="n">doubled</span>
            <span class="n">jit</span><span class="o">.</span><span class="n">record_operation</span><span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">doubled</span><span class="p">)</span>

            <span class="n">jit</span><span class="o">.</span><span class="n">end_loop_iteration</span><span class="p">(</span><span class="s1">&#39;sum_loop&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">: sum = </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2">, &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;loop mode = </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">jit</span><span class="o">.</span><span class="n">show_trace</span><span class="p">(</span><span class="s1">&#39;sum_loop&#39;</span><span class="p">)</span>

<span class="n">demonstrate_tracing_jit</span><span class="p">()</span>
</code></pre></div>

<h3 id="84">8.4 íŠ¸ë ˆì´ìŠ¤ ì»´íŒŒì¼ ì„¸ë¶€ ì‚¬í•­<a class="header-link" href="#84" title="Permanent link">&para;</a></h3>
<p>íŠ¸ë ˆì´ìŠ¤ëŠ” ê°€ë“œ(guard)ê°€ ìˆëŠ” ì„ í˜• ì—°ì‚° ì‹œí€€ìŠ¤ì…ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="n">Trace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ss">&quot;for i in range(n): sum += arr[i] * 2&quot;</span><span class="err">:</span>

<span class="w">  </span><span class="nl">GUARD</span><span class="p">:</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="n">Loop</span><span class="w"> </span><span class="k">condition</span>
<span class="w">  </span><span class="n">LOAD_ARRAY</span><span class="w"> </span><span class="n">arr</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w">               </span><span class="err">#</span><span class="w"> </span><span class="k">Load</span><span class="w"> </span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
<span class="w">  </span><span class="nl">GUARD</span><span class="p">:</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">int</span><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="k">check</span>
<span class="w">  </span><span class="n">MUL</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w">             </span><span class="err">#</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="w">  </span><span class="k">ADD</span><span class="w"> </span><span class="nf">sum</span><span class="p">,</span><span class="w"> </span><span class="nf">sum</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="nf">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">temp</span>
<span class="w">  </span><span class="k">ADD</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w">                     </span><span class="err">#</span><span class="w"> </span><span class="n">i</span><span class="o">++</span>
<span class="w">  </span><span class="n">JUMP</span><span class="w"> </span><span class="n">loop_start</span><span class="w">                 </span><span class="err">#</span><span class="w"> </span><span class="n">Back</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">start</span>
</code></pre></div>

<p>ê°€ë“œê°€ ì‹¤íŒ¨í•˜ë©´ íŠ¸ë ˆì´ìŠ¤ê°€ ì¤‘ë‹¨("ì‚¬ì´ë“œ ì´ê·¸ì§“")ë˜ê³  ì¸í„°í”„ë¦¬í„°ë¡œ í´ë°±ë©ë‹ˆë‹¤. ê³µí†µ ê°€ë“œ ì‹¤íŒ¨ëŠ” ëŒ€ì²´ ê²½ë¡œì— ëŒ€í•œ ìƒˆ íŠ¸ë ˆì´ìŠ¤ë¥¼ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</p>
<h3 id="85-on-stack-replacement-osr">8.5 ì˜¨-ìŠ¤íƒ ëŒ€ì²´(On-Stack Replacement, OSR)<a class="header-link" href="#85-on-stack-replacement-osr" title="Permanent link">&para;</a></h3>
<p><strong>ì˜¨-ìŠ¤íƒ ëŒ€ì²´(OSR)</strong>ëŠ” í•¨ìˆ˜ ì¤‘ê°„(ë£¨í”„ ë‚´ë¶€ë„ í¬í•¨)ì—ì„œ í•´ì„ ì½”ë“œì™€ ì»´íŒŒì¼ ì½”ë“œ ì‚¬ì´ì˜ ì „í™˜ì„ í—ˆìš©í•©ë‹ˆë‹¤. OSR ì—†ì´ëŠ” ì»´íŒŒì¼ëœ ë²„ì „ì„ ì‚¬ìš©í•˜ê¸° ì „ì— ì¸í„°í”„ë¦¬í„°ì—ì„œ ì „ì²´ í•¨ìˆ˜ í˜¸ì¶œì„ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="nv">Without</span><span class="w"> </span><span class="nv">OSR</span>:
<span class="w">  </span><span class="nv">Interpreter</span>:<span class="w"> </span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ<span class="w">  </span><span class="ss">(</span><span class="nv">entire</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="nv">interpreted</span><span class="ss">)</span>
<span class="w">  </span><span class="k">Next</span><span class="w"> </span><span class="nv">call</span>:<span class="w">   </span>â–‘â–‘â–‘â–‘<span class="w"> </span><span class="ss">(</span><span class="nv">compiled</span><span class="ss">)</span>

<span class="nv">With</span><span class="w"> </span><span class="nv">OSR</span>:
<span class="w">  </span><span class="nv">Interpreter</span>:<span class="w"> </span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘<span class="w">  </span><span class="ss">(</span><span class="nv">OSR</span><span class="w"> </span><span class="nv">into</span><span class="w"> </span><span class="nv">compiled</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">mid</span><span class="o">-</span><span class="k">loop</span><span class="ss">)</span>
<span class="w">               </span>â†‘<span class="w"> </span><span class="nv">OSR</span><span class="w"> </span><span class="nv">point</span>
</code></pre></div>

<hr />
<h2 id="9">9. ëŸ°íƒ€ì„ ìµœì í™” ê¸°ë²•<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="91-inline-caching">9.1 ì¸ë¼ì¸ ìºì‹±(Inline Caching)<a class="header-link" href="#91-inline-caching" title="Permanent link">&para;</a></h3>
<p><strong>ì¸ë¼ì¸ ìºì‹±(inline caching)</strong>ì€ ë™ì  ì–¸ì–´ì—ì„œ ë©”ì„œë“œ ë””ìŠ¤íŒ¨ì¹˜ë¥¼ ê°€ì†í•©ë‹ˆë‹¤. ê°ì²´ì—ì„œ ë©”ì„œë“œê°€ ì²˜ìŒ í˜¸ì¶œë  ë•Œ ëŸ°íƒ€ì„ì´ ë©”ì„œë“œë¥¼ ì°¾ê³  í˜¸ì¶œ ì‚¬ì´íŠ¸ì— ê²°ê³¼ë¥¼ ìºì‹œí•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">InlineCache</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulates inline caching for method dispatch.</span>

<span class="sd">    Three states:</span>
<span class="sd">    1. Uninitialized: No cache (first call triggers lookup)</span>
<span class="sd">    2. Monomorphic: One cached type (fastest, most common)</span>
<span class="sd">    3. Polymorphic: Multiple cached types (still fast)</span>
<span class="sd">    4. Megamorphic: Too many types (falls back to generic lookup)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">max_entries</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type -&gt; method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_entries</span> <span class="o">=</span> <span class="n">max_entries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misses</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look up a method using the inline cache.&quot;&quot;&quot;</span>
        <span class="n">obj_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">obj_type</span><span class="p">]</span>

        <span class="c1"># Cache miss -- do full lookup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misses</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_entries</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">obj_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>  <span class="c1"># Cache it</span>

        <span class="k">return</span> <span class="n">method</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;uninitialized&quot;</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;monomorphic&quot;</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_entries</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;polymorphic&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;megamorphic&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IC(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="si">}</span><span class="s2">, state=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;hits=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hits</span><span class="si">}</span><span class="s2">, misses=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">misses</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_inline_caching</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show inline caching behavior.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Inline Caching Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Dog</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;Woof!&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Cat</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;Meow!&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Duck</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;Quack!&quot;</span>

    <span class="n">cache</span> <span class="o">=</span> <span class="n">InlineCache</span><span class="p">(</span><span class="s1">&#39;speak&#39;</span><span class="p">)</span>

    <span class="n">animals</span> <span class="o">=</span> <span class="p">[</span><span class="n">Dog</span><span class="p">(),</span> <span class="n">Dog</span><span class="p">(),</span> <span class="n">Dog</span><span class="p">(),</span> <span class="n">Cat</span><span class="p">(),</span> <span class="n">Dog</span><span class="p">(),</span> <span class="n">Duck</span><span class="p">(),</span> <span class="n">Dog</span><span class="p">()]</span>

    <span class="k">for</span> <span class="n">animal</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">animal</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">animal</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.speak() = </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> | Cache: </span><span class="si">{</span><span class="n">cache</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_inline_caching</span><span class="p">()</span>
</code></pre></div>

<h3 id="92-type-specialization">9.2 íƒ€ì… íŠ¹ìˆ˜í™”(Type Specialization)<a class="header-link" href="#92-type-specialization" title="Permanent link">&para;</a></h3>
<p>JIT ì»´íŒŒì¼ëŸ¬ëŠ” íŠ¹ì • íƒ€ì…ì— ëŒ€í•œ íŠ¹ìˆ˜í™”ëœ ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_type_specialization</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show type specialization in a JIT compiler.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Type Specialization ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generic add (what the interpreter does)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generic_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Must check types at runtime.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot add </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Specialized add (what the JIT generates after seeing types)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">int_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;No type checks needed -- we know both are ints.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>  <span class="c1"># Direct integer addition</span>

    <span class="c1"># In practice, the JIT generates:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generic version (interpreter):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  1. Check type of a&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  2. Check type of b&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  3. Look up appropriate + operator&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  4. Perform addition&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  5. Box result&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Specialized version (JIT, after seeing int+int):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  1. GUARD: type(a) == int  (deoptimize if not)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  2. GUARD: type(b) == int  (deoptimize if not)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  3. Native integer addition (single CPU instruction)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  4. Result already unboxed&quot;</span><span class="p">)</span>

    <span class="c1"># Benchmark</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">1_000_000</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">generic_add</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">time_generic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">int_add</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">time_specialized</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generic add (</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> iterations): </span><span class="si">{</span><span class="n">time_generic</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Specialized add (</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> iterations): </span><span class="si">{</span><span class="n">time_specialized</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speedup: </span><span class="si">{</span><span class="n">time_generic</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time_specialized</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>

<span class="c1"># demonstrate_type_specialization()  # Uncomment to run</span>
</code></pre></div>

<h3 id="93-deoptimization">9.3 ì—­ìµœì í™”(Deoptimization)<a class="header-link" href="#93-deoptimization" title="Permanent link">&para;</a></h3>
<p>JITê°€ ì„¸ìš´ ê°€ì •ì´ ìœ„ë°˜ë  ë•Œ(ê°€ë“œ ì‹¤íŒ¨), ëŸ°íƒ€ì„ì€ <strong>ì—­ìµœì í™”(deoptimize)</strong>í•´ì•¼ í•©ë‹ˆë‹¤ -- ì»´íŒŒì¼ëœ ì½”ë“œì—ì„œ ì¸í„°í”„ë¦¬í„°ë¡œ í´ë°±í•©ë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="nx">Compiled</span><span class="w"> </span><span class="nx">code</span><span class="p">:</span>
<span class="w">  </span><span class="nx">GUARD</span><span class="w"> </span><span class="k">type</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">int</span><span class="w">     </span><span class="err">â”€â”€â”€â”€</span><span class="w"> </span><span class="nx">guard</span><span class="w"> </span><span class="nx">fails</span><span class="w"> </span><span class="err">â”€â”€â”€â”€â–¶</span><span class="w">  </span><span class="nx">Deoptimize</span>
<span class="w">  </span><span class="nx">native_int_add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w">                              </span><span class="err">â”‚</span>
<span class="w">  </span><span class="o">...</span><span class="w">                                                </span><span class="err">â–¼</span>
<span class="w">                                                 </span><span class="nx">Interpreter</span>
<span class="w">                                                 </span><span class="p">(</span><span class="k">continue</span><span class="w"> </span><span class="nx">execution</span>
<span class="w">                                                  </span><span class="nx">with</span><span class="w"> </span><span class="nx">correct</span><span class="w"> </span><span class="nx">semantics</span><span class="p">)</span>
</code></pre></div>

<p>ì—­ìµœì í™”ì—ëŠ” ë‹¤ìŒì´ í•„ìš”í•©ë‹ˆë‹¤:
1. ì»´íŒŒì¼ëœ ìƒíƒœì—ì„œ ì¸í„°í”„ë¦¬í„° ìƒíƒœ(ìŠ¤íƒ, ë¡œì»¬) ì¬êµ¬ì„±
2. ì»´íŒŒì¼ëœ ì½”ë“œ ë¬´íš¨í™” (ê°€ì •ì´ ì˜êµ¬ì ìœ¼ë¡œ ì˜ëª»ëœ ê²½ìš°)
3. ëœ ê³µê²©ì ì¸ ê°€ì •ìœ¼ë¡œ ì¬ì»´íŒŒì¼</p>
<h3 id="94-hidden-classes-shapes">9.4 ìˆ¨ê²¨ì§„ í´ë˜ìŠ¤(Hidden Classes) / í˜•íƒœ(Shapes)<a class="header-link" href="#94-hidden-classes-shapes" title="Permanent link">&para;</a></h3>
<p>V8ê³¼ ë‹¤ë¥¸ VMì€ ë™ì  ê°ì²´ì— ëŒ€í•œ í”„ë¡œí¼í‹° ì ‘ê·¼ì„ ìµœì í™”í•˜ê¸° ìœ„í•´ <strong>ìˆ¨ê²¨ì§„ í´ë˜ìŠ¤(hidden classes)</strong>(í˜•íƒœ(shapes) ë˜ëŠ” ë§µ(maps)ì´ë¼ê³ ë„ í•¨)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_hidden_classes</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate the concept of hidden classes / shapes.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Hidden Classes / Shapes ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># In JavaScript, objects are dictionaries:</span>
    <span class="c1"># let p = {};  p.x = 1;  p.y = 2;</span>

    <span class="c1"># V8 creates hidden classes for each &quot;shape&quot;:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Shape0&#39;</span><span class="p">:</span> <span class="p">{},</span>                          <span class="c1"># Empty object</span>
        <span class="s1">&#39;Shape1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;offset 0&#39;</span><span class="p">},</span>           <span class="c1"># After p.x = 1</span>
        <span class="s1">&#39;Shape2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;offset 0&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;offset 1&#39;</span><span class="p">},</span>  <span class="c1"># After p.y = 2</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object shape transitions:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  let p = </span><span class="si">{}</span><span class="s2">          -&gt; Shape0 (empty)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  p.x = 1             -&gt; Shape1 ({x: offset 0})&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  p.y = 2             -&gt; Shape2 ({x: offset 0, y: offset 1})&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Objects with the same shape share the same hidden class.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Property access becomes a fixed-offset load (like a struct).&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  let q = </span><span class="si">{}</span><span class="s2">; q.x = 5; q.y = 10;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  q has the SAME Shape2 as p!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Accessing q.y is: load [q + offset_of_y]  (no dictionary lookup)&quot;</span><span class="p">)</span>

<span class="n">demonstrate_hidden_classes</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="10">10. ì‹¤ì œ ê°€ìƒ ë¨¸ì‹ <a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="101-jvm-java-virtual-machine">10.1 JVM (Java Virtual Machine)<a class="header-link" href="#101-jvm-java-virtual-machine" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>JVM Architecture:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JVM                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Class    â”‚   â”‚      Runtime Data Areas   â”‚     â”‚
â”‚  â”‚ Loader   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚          â”‚   â”‚  â”‚Methodâ”‚  â”‚  Heap     â”‚  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚Area  â”‚  â”‚(GC-managedâ”‚  â”‚     â”‚
â”‚                 â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚Execution â”‚   â”‚  â”‚Stack â”‚  â”‚ PC Regs   â”‚  â”‚     â”‚
â”‚  â”‚ Engine   â”‚   â”‚  â”‚(per  â”‚  â”‚(per threadâ”‚  â”‚     â”‚
â”‚  â”‚ - Interp â”‚   â”‚  â”‚threadâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â”‚ - JIT(C1)â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”˜                â”‚     â”‚
â”‚  â”‚ - JIT(C2)â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p>ì£¼ìš” íŠ¹ì„±:
- <strong>ìŠ¤íƒ ê¸°ë°˜ ë°”ì´íŠ¸ì½”ë“œ</strong>: ì•½ 200ê°œ ì˜µì½”ë“œ
- <strong>íƒ€ì…í™”ëœ ëª…ë ¹ì–´</strong>: <code>iadd</code> (int), <code>fadd</code> (float), <code>dadd</code> (double)
- <strong>ê³„ì¸µì  ì»´íŒŒì¼</strong>: ì¸í„°í”„ë¦¬í„° -&gt; C1 (ë¹ ë¥¸ ì»´íŒŒì¼) -&gt; C2 (ìµœì í™” ì»´íŒŒì¼)
- <strong>GC</strong>: ì—¬ëŸ¬ ì»¬ë ‰í„° (G1 ê¸°ë³¸, ZGCëŠ” ì €ì§€ì—°)
- <strong>ë°”ì´íŠ¸ì½”ë“œ ê²€ì¦</strong>: ì‹¤í–‰ ì „ íƒ€ì… ì•ˆì „ ë°”ì´íŠ¸ì½”ë“œ ê²€ì¦</p>
<h3 id="102-cpython-vm">10.2 CPython VM<a class="header-link" href="#102-cpython-vm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>CPython Architecture:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CPython                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Parser   â”‚â”€â”€â–¶â”‚ Compiler   â”‚              â”‚
â”‚  â”‚ (PEG)    â”‚   â”‚ (ASTâ†’BC)   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜              â”‚
â”‚                            â”‚                â”‚
â”‚                            â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚        Bytecode Interpreter      â”‚       â”‚
â”‚  â”‚  (ceval.c: giant switch stmt)    â”‚       â”‚
â”‚  â”‚                                  â”‚       â”‚
â”‚  â”‚  - Stack-based                   â”‚       â”‚
â”‚  â”‚  - ~120 opcodes                  â”‚       â”‚
â”‚  â”‚  - Reference counting + cycle GC â”‚       â”‚
â”‚  â”‚  - GIL (Global Interpreter Lock) â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><code>dis</code> ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ CPython ë°”ì´íŠ¸ì½”ë“œë¥¼ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">dis</span>

<span class="k">def</span><span class="w"> </span><span class="nf">example_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== CPython Bytecode ===&quot;</span><span class="p">)</span>
<span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">example_function</span><span class="p">)</span>
</code></pre></div>

<p>ì¶œë ¥ (ê·¼ì‚¬ì¹˜):</p>
<div class="highlight"><pre><span></span><code>  2           0 LOAD_FAST                0 (x)
              2 LOAD_FAST                0 (x)
              4 BINARY_MULTIPLY
              6 LOAD_FAST                1 (y)
              8 LOAD_FAST                1 (y)
             10 BINARY_MULTIPLY
             12 BINARY_ADD
             14 RETURN_VALUE
</code></pre></div>

<h3 id="103-v8-javascript">10.3 V8 (JavaScript)<a class="header-link" href="#103-v8-javascript" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>V8 Architecture:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    V8                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ Parser   â”‚â”€â”€â–¶ AST                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                          â”‚
â”‚                   â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  Ignition            â”‚  (Bytecode         â”‚
â”‚  â”‚  (Bytecode Compiler) â”‚   Interpreter)     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚             â”‚ Profile data                   â”‚
â”‚             â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  TurboFan            â”‚  (Optimizing       â”‚
â”‚  â”‚  (JIT Compiler)      â”‚   JIT Compiler)    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                              â”‚
â”‚  Key techniques:                             â”‚
â”‚  - Hidden classes (shapes/maps)              â”‚
â”‚  - Inline caching                            â”‚
â”‚  - On-stack replacement                      â”‚
â”‚  - Deoptimization                            â”‚
â”‚  - Generational GC (Orinoco)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="104-beam-erlang-vm">10.4 BEAM (Erlang VM)<a class="header-link" href="#104-beam-erlang-vm" title="Permanent link">&para;</a></h3>
<p>BEAMì€ ë™ì‹œì„±ê³¼ ë‚´ê²°í•¨ì„±ì— ì´ˆì ì„ ë§ì¶˜ ë…íŠ¹í•œ VMì…ë‹ˆë‹¤:</p>
<ul>
<li><strong>ë ˆì§€ìŠ¤í„° ê¸°ë°˜</strong>: í”„ë¡œì„¸ìŠ¤ë‹¹ 1024ê°œì˜ ê°€ìƒ ë ˆì§€ìŠ¤í„°</li>
<li><strong>ê²½ëŸ‰ í”„ë¡œì„¸ìŠ¤</strong>: ìˆ˜ë°±ë§Œ ê°œì˜ í”„ë¡œì„¸ìŠ¤, ê°ê° ~2KB ìŠ¤íƒ</li>
<li><strong>ì„ ì í˜• ìŠ¤ì¼€ì¤„ë§</strong>: ë¦¬ë•ì…˜ ê¸°ë°˜ (ì‹œê°„ ê¸°ë°˜ì´ ì•„ë‹˜)</li>
<li><strong>í•« ì½”ë“œ ë¡œë”©</strong>: ì‹¤í–‰ì„ ë©ˆì¶”ì§€ ì•Šê³  ì‹¤í–‰ ì¤‘ì¸ ì½”ë“œ êµì²´</li>
<li><strong>íŒ¨í„´ ë§¤ì¹­</strong>: íŒ¨í„´ ë§¤ì¹­ì„ ìœ„í•œ ì¼ê¸‰ ë°”ì´íŠ¸ì½”ë“œ ì§€ì›</li>
<li><strong>ê³µìœ  ìƒíƒœ ì—†ìŒ</strong>: í”„ë¡œì„¸ìŠ¤ëŠ” ë©”ì‹œì§€ ì „ë‹¬ë¡œë§Œ í†µì‹ </li>
</ul>
<div class="highlight"><pre><span></span><code>BEAM Process Model:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BEAM VM                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚Proc â”‚  â”‚Proc â”‚  â”‚Proc â”‚  â”‚Proc â”‚  ...  â”‚
â”‚  â”‚  1  â”‚  â”‚  2  â”‚  â”‚  3  â”‚  â”‚  4  â”‚       â”‚
â”‚  â”‚ 2KB â”‚  â”‚ 2KB â”‚  â”‚ 2KB â”‚  â”‚ 2KB â”‚       â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜       â”‚
â”‚     â”‚ msg    â”‚ msg    â”‚ msg    â”‚ msg       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Scheduler (per CPU core)    â”‚          â”‚
â”‚  â”‚  Reduction counting          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="105-vm">10.5 VM ë¹„êµ<a class="header-link" href="#105-vm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">vm_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare real-world VM implementations.&quot;&quot;&quot;</span>
    <span class="n">vms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;JVM&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Stack&#39;</span><span class="p">,</span>
            <span class="s1">&#39;jit&#39;</span><span class="p">:</span> <span class="s1">&#39;Method JIT (C1/C2)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gc&#39;</span><span class="p">:</span> <span class="s1">&#39;Generational (G1/ZGC)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrency&#39;</span><span class="p">:</span> <span class="s1">&#39;OS threads&#39;</span><span class="p">,</span>
            <span class="s1">&#39;typing&#39;</span><span class="p">:</span> <span class="s1">&#39;Static&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;CPython&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Stack&#39;</span><span class="p">,</span>
            <span class="s1">&#39;jit&#39;</span><span class="p">:</span> <span class="s1">&#39;None (3.13+ experimental)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gc&#39;</span><span class="p">:</span> <span class="s1">&#39;RefCount + Gen cycle&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrency&#39;</span><span class="p">:</span> <span class="s1">&#39;GIL (threads limited)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;typing&#39;</span><span class="p">:</span> <span class="s1">&#39;Dynamic&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;V8&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Register&#39;</span><span class="p">,</span>
            <span class="s1">&#39;jit&#39;</span><span class="p">:</span> <span class="s1">&#39;TurboFan (optimizing)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gc&#39;</span><span class="p">:</span> <span class="s1">&#39;Generational (Orinoco)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrency&#39;</span><span class="p">:</span> <span class="s1">&#39;Event loop + workers&#39;</span><span class="p">,</span>
            <span class="s1">&#39;typing&#39;</span><span class="p">:</span> <span class="s1">&#39;Dynamic&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;BEAM&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Register&#39;</span><span class="p">,</span>
            <span class="s1">&#39;jit&#39;</span><span class="p">:</span> <span class="s1">&#39;JIT (OTP 24+)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gc&#39;</span><span class="p">:</span> <span class="s1">&#39;Per-process copying&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrency&#39;</span><span class="p">:</span> <span class="s1">&#39;Actor model (millions)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;typing&#39;</span><span class="p">:</span> <span class="s1">&#39;Dynamic&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;CLR/.NET&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Stack&#39;</span><span class="p">,</span>
            <span class="s1">&#39;jit&#39;</span><span class="p">:</span> <span class="s1">&#39;RyuJIT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gc&#39;</span><span class="p">:</span> <span class="s1">&#39;Generational compacting&#39;</span><span class="p">,</span>
            <span class="s1">&#39;concurrency&#39;</span><span class="p">:</span> <span class="s1">&#39;OS threads + async&#39;</span><span class="p">,</span>
            <span class="s1">&#39;typing&#39;</span><span class="p">:</span> <span class="s1">&#39;Static&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== VM Comparison ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;VM&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Type&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;JIT&#39;</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;GC&#39;</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">vms</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vm</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">vm</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">vm</span><span class="p">[</span><span class="s1">&#39;jit&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">vm</span><span class="p">[</span><span class="s1">&#39;gc&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">vm_comparison</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="11_1">11. ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°<a class="header-link" href="#11_1" title="Permanent link">&para;</a></h2>
<h3 id="111">11.1 ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°ë€?<a class="header-link" href="#111" title="Permanent link">&para;</a></h3>
<p><strong>ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°(metacircular interpreter)</strong>ëŠ” ê°™ì€ ì–¸ì–´ë¡œ ì‘ì„±ëœ ì–¸ì–´ë¥¼ ìœ„í•œ ì¸í„°í”„ë¦¬í„°ì…ë‹ˆë‹¤. Lisp ì „í†µì—ì„œ ë‚˜ì˜¨ ê°•ë ¥í•œ ê°œë…ì…ë‹ˆë‹¤:</p>
<ul>
<li><strong>Lisp in Lisp</strong>: ì›ë˜ì˜ ë©”íƒ€ìˆœí™˜ í‰ê°€ê¸° (McCarthy, 1960)</li>
<li><strong>PyPy</strong>: (Pythonì˜ ë¶€ë¶„ ì§‘í•©ìœ¼ë¡œ) Pythonìœ¼ë¡œ ì‘ì„±ëœ Python ì¸í„°í”„ë¦¬í„°</li>
<li><strong>Truffle/Graal</strong>: Javaë¡œ ì‘ì„±ëœ ìê¸° ìµœì í™” ì¸í„°í”„ë¦¬í„°</li>
</ul>
<h3 id="112">11.2 ê°„ë‹¨í•œ ë©”íƒ€ìˆœí™˜ í‰ê°€ê¸°<a class="header-link" href="#112" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metacircular_eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple metacircular evaluator for a Lisp-like language.</span>

<span class="sd">    The language supports:</span>
<span class="sd">    - Numbers and strings (self-evaluating)</span>
<span class="sd">    - Variables (looked up in environment)</span>
<span class="sd">    - (quote x) -&gt; x</span>
<span class="sd">    - (if test then else)</span>
<span class="sd">    - (define name value)</span>
<span class="sd">    - (lambda (params) body)</span>
<span class="sd">    - (function arg1 arg2 ...)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Self-evaluating</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">expr</span>

    <span class="c1"># Variable reference</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="c1"># Must be a list (compound expression)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot evaluate: </span><span class="si">{</span><span class="n">expr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">head</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Special forms</span>
    <span class="k">if</span> <span class="n">head</span> <span class="o">==</span> <span class="s1">&#39;quote&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">head</span> <span class="o">==</span> <span class="s1">&#39;if&#39;</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">then_clause</span><span class="p">,</span> <span class="o">*</span><span class="n">else_clause</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="k">if</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">then_clause</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">else_clause</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">else_clause</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">head</span> <span class="o">==</span> <span class="s1">&#39;define&#39;</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="n">env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">head</span> <span class="o">==</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;closure&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">head</span> <span class="o">==</span> <span class="s1">&#39;begin&#39;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">subexpr</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">subexpr</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">elif</span> <span class="n">head</span> <span class="o">==</span> <span class="s1">&#39;let&#39;</span><span class="p">:</span>
        <span class="c1"># (let ((x 1) (y 2)) body)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">bindings</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="n">new_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value_expr</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">:</span>
            <span class="n">new_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">value_expr</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">new_env</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Function application</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">metacircular_eval</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;closure&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">closure_env</span> <span class="o">=</span> <span class="n">func</span>
            <span class="n">new_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">closure_env</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
                <span class="n">new_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">new_env</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not a function: </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_metacircular</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate the metacircular evaluator.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Metacircular Evaluator ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Create global environment with built-in functions</span>
    <span class="n">global_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
    <span class="n">global_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">global_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">global_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">global_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">global_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">global_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">global_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">global_env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Output: </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># Evaluate expressions</span>
    <span class="n">programs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Simple arithmetic</span>
        <span class="p">([</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="s2">&quot;3 + 4*5&quot;</span><span class="p">),</span>

        <span class="c1"># Define and use a variable</span>
        <span class="p">([</span><span class="s1">&#39;begin&#39;</span><span class="p">,</span>
          <span class="p">[</span><span class="s1">&#39;define&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">],</span>
          <span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">]],</span> <span class="s2">&quot;define x = 42&quot;</span><span class="p">),</span>

        <span class="c1"># Lambda function</span>
        <span class="p">([</span><span class="s1">&#39;begin&#39;</span><span class="p">,</span>
          <span class="p">[</span><span class="s1">&#39;define&#39;</span><span class="p">,</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">]]],</span>
          <span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]],</span> <span class="s2">&quot;define square, compute square(7)&quot;</span><span class="p">),</span>

        <span class="c1"># Recursive factorial (using begin for multiple defines)</span>
        <span class="p">([</span><span class="s1">&#39;begin&#39;</span><span class="p">,</span>
          <span class="p">[</span><span class="s1">&#39;define&#39;</span><span class="p">,</span> <span class="s1">&#39;fact&#39;</span><span class="p">,</span>
           <span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;if&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
             <span class="mi">1</span><span class="p">,</span>
             <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;fact&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]]]]],</span>
          <span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;fact&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">]]],</span> <span class="s2">&quot;factorial(10)&quot;</span><span class="p">),</span>

        <span class="c1"># Higher-order function</span>
        <span class="p">([</span><span class="s1">&#39;begin&#39;</span><span class="p">,</span>
          <span class="p">[</span><span class="s1">&#39;define&#39;</span><span class="p">,</span> <span class="s1">&#39;apply-twice&#39;</span><span class="p">,</span>
           <span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">]]]],</span>
          <span class="p">[</span><span class="s1">&#39;define&#39;</span><span class="p">,</span> <span class="s1">&#39;add3&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]],</span>
          <span class="p">[</span><span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;apply-twice&#39;</span><span class="p">,</span> <span class="s1">&#39;add3&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">]]],</span> <span class="s2">&quot;apply-twice(add3, 10)&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">expr</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">programs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Program: </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">metacircular_eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">global_env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

<span class="n">demonstrate_metacircular</span><span class="p">()</span>
</code></pre></div>

<h3 id="113">11.3 ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°ê°€ ì¤‘ìš”í•œ ì´ìœ <a class="header-link" href="#113" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>ìê¸° í˜¸ìŠ¤íŒ…(Self-hosting)</strong>: ìì‹ ì„ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ì–¸ì–´ëŠ” ì™„ì „ì„±ê³¼ ê°•ë ¥í•¨ì„ ì…ì¦í•©ë‹ˆë‹¤.</li>
<li><strong>ë°˜ì˜(Reflection)</strong>: ì¸í„°í”„ë¦¬í„°ê°€ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤ (ë§¤í¬ë¡œ, eval, ì¸íŠ¸ë¡œìŠ¤í™ì…˜).</li>
<li><strong>ë¶€íŠ¸ìŠ¤íŠ¸ë˜í•‘</strong>: ê°„ë‹¨í•œ ì¸í„°í”„ë¦¬í„°ë¡œ ì‹œì‘í•œ ë‹¤ìŒ ê·¸ ì–¸ì–´ë¡œ ë” ë‚˜ì€ ì¸í„°í”„ë¦¬í„°ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.</li>
<li><strong>êµìœ¡</strong>: ì–¸ì–´ ì˜ë¯¸ë¡ ì„ ê°€ì¥ ëª…í™•í•œ ë°©ì‹ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.</li>
<li><strong>ìµœì í™”</strong>: PyPyì˜ ë©”íƒ€-ì¶”ì  ë°©ì‹ì€ Pythonìœ¼ë¡œ ì¸í„°í”„ë¦¬í„°ë¥¼ ì‘ì„±í•œ ë‹¤ìŒ ìë™ìœ¼ë¡œ JIT ì»´íŒŒì¼ëŸ¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
</ol>
<hr />
<h2 id="12_1">12. ìš”ì•½<a class="header-link" href="#12_1" title="Permanent link">&para;</a></h2>
<p>ì´ ë ˆìŠ¨ì€ í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì „ëµì˜ ì „ì²´ ìŠ¤í™íŠ¸ëŸ¼ì„ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ì ‘ê·¼ ë°©ì‹</th>
<th>ì†ë„</th>
<th>ë³µì¡ì„±</th>
<th>ì£¼ìš” ì˜ˆì‹œ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>íŠ¸ë¦¬ ìˆœíšŒ</strong></td>
<td>ê°€ì¥ ëŠë¦¼ (50-200ë°°)</td>
<td>ë‹¨ìˆœ</td>
<td>ì´ˆê¸° Ruby, Bash</td>
</tr>
<tr>
<td><strong>ë°”ì´íŠ¸ì½”ë“œ í•´ì„</strong></td>
<td>ëŠë¦¼ (5-20ë°°)</td>
<td>ë³´í†µ</td>
<td>CPython, Lua</td>
</tr>
<tr>
<td><strong>ë°”ì´íŠ¸ì½”ë“œ + JIT</strong></td>
<td>ë„¤ì´í‹°ë¸Œì— ê·¼ì ‘</td>
<td>ë³µì¡</td>
<td>JVM, V8, PyPy</td>
</tr>
<tr>
<td><strong>AOT ì»´íŒŒì¼</strong></td>
<td>ë„¤ì´í‹°ë¸Œ</td>
<td>ë³µì¡</td>
<td>GCC, Rust, Go</td>
</tr>
</tbody>
</table>
<p>í•µì‹¬ ê°œë…:</p>
<ul>
<li><strong>ë°”ì´íŠ¸ì½”ë“œ</strong>ëŠ” VM ì‹¤í–‰ì„ ìœ„í•´ ì„¤ê³„ëœ ì»´íŒ©íŠ¸í•˜ê³  ì´ì‹ ê°€ëŠ¥í•œ ì¤‘ê°„ í˜•íƒœì…ë‹ˆë‹¤</li>
<li><strong>ìŠ¤íƒ ê¸°ë°˜ VM</strong>ì€ êµ¬í˜„ì´ ë‹¨ìˆœí•˜ì§€ë§Œ ë” ë§ì€ ëª…ë ¹ì–´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤; <strong>ë ˆì§€ìŠ¤í„° ê¸°ë°˜ VM</strong>ì€ ë” íš¨ìœ¨ì ì´ì§€ë§Œ ë” ë³µì¡í•©ë‹ˆë‹¤</li>
<li><strong>ëª…ë ¹ì–´ ë””ìŠ¤íŒ¨ì¹˜</strong> ê¸°ë²•(ìŠ¤ìœ„ì¹˜ vs ìŠ¤ë ˆë“œ ì½”ë“œ vs computed goto)ì€ ì¸í„°í”„ë¦¬í„° ì„±ëŠ¥ì— í¬ê²Œ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤</li>
<li><strong>JIT ì»´íŒŒì¼</strong>ì€ í•´ì„ê³¼ ë„¤ì´í‹°ë¸Œ ì»´íŒŒì¼ì˜ ê²©ì°¨ë¥¼ ì¤„ì…ë‹ˆë‹¤:</li>
<li>ë©”ì„œë“œ JITëŠ” í•« í•¨ìˆ˜ë¥¼ ì»´íŒŒì¼í•©ë‹ˆë‹¤</li>
<li>ì¶”ì  JITëŠ” í•« ì‹¤í–‰ ê²½ë¡œë¥¼ ì»´íŒŒì¼í•©ë‹ˆë‹¤</li>
<li>ë‘˜ ë‹¤ í”„ë¡œíŒŒì¼ë§, ì¶”ì¸¡, ì—­ìµœì í™”ì— ì˜ì¡´í•©ë‹ˆë‹¤</li>
<li>ì¸ë¼ì¸ ìºì‹±, íƒ€ì… íŠ¹ìˆ˜í™”, ìˆ¨ê²¨ì§„ í´ë˜ìŠ¤ ê°™ì€ <strong>ëŸ°íƒ€ì„ ìµœì í™”</strong>ëŠ” ë™ì  ì–¸ì–´ë¥¼ ì •ì  ì–¸ì–´ì™€ ê²½ìŸë ¥ ìˆê²Œ ë§Œë“­ë‹ˆë‹¤</li>
<li><strong>ë©”íƒ€ìˆœí™˜ ì¸í„°í”„ë¦¬í„°</strong>ëŠ” ì–¸ì–´ì˜ ê°•ë ¥í•¨ì„ ë³´ì—¬ì£¼ê³  ë©”íƒ€-ì¶”ì  ê°™ì€ ê³ ê¸‰ ê¸°ë²•ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤</li>
</ul>
<hr />
<h2 id="13_1">13. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#13_1" title="Permanent link">&para;</a></h2>
<h3 id="1">ì—°ìŠµ 1: íŠ¸ë¦¬ ìˆœíšŒ í™•ì¥<a class="header-link" href="#1" title="Permanent link">&para;</a></h3>
<p>2ì ˆì˜ íŠ¸ë¦¬ ìˆœíšŒ ì¸í„°í”„ë¦¬í„°ë¥¼ ë‹¤ìŒì„ ì§€ì›í•˜ë„ë¡ í™•ì¥í•˜ì„¸ìš”:
(a) <code>push</code>, <code>pop</code>, ì¸ë±ì‹±ì´ ìˆëŠ” ë°°ì—´.
(b) For ë£¨í”„: <code>for i in range(n): body</code>.
(c) ë‘˜ëŸ¬ì‹¼ ìŠ¤ì½”í”„ì˜ ë³€ìˆ˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ìº¡ì²˜í•˜ëŠ” í´ë¡œì €.</p>
<p>ë‹¤ìŒ í´ë¡œì € ëª©ë¡ì„ ìƒì„±í•˜ëŠ” í”„ë¡œê·¸ë¨ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”:</p>
<div class="highlight"><pre><span></span><code>funcs = []
for i in range(5):
    define make_adder(x): return lambda(y): x + y
    push(funcs, make_adder(i))
print(funcs[3](10))  # Should print 13
</code></pre></div>

<h3 id="2_1">ì—°ìŠµ 2: ë°”ì´íŠ¸ì½”ë“œ ìµœì í™”<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ ì²˜ë¦¬í•˜ëŠ” ë°”ì´íŠ¸ì½”ë“œ í•í™€ ì˜µí‹°ë§ˆì´ì €ë¥¼ êµ¬í˜„í•˜ì„¸ìš”:
(a) ìƒìˆ˜ í´ë”©: <code>CONST 3; CONST 4; ADD</code> -&gt; <code>CONST 7</code>
(b) ì£½ì€ ì €ì¥ ì œê±°: <code>STORE x; STORE x</code> -&gt; ë‘ ë²ˆì§¸ë§Œ ìœ ì§€
(c) ì¤‘ë³µ ë¡œë“œ ì œê±°: <code>STORE x; LOAD x</code> -&gt; <code>STORE x; DUP</code></p>
<p>7ì ˆì˜ ì»´íŒŒì¼ëŸ¬ ì¶œë ¥ì— ì ìš©í•˜ê³  ëª…ë ¹ì–´ ìˆ˜ ê°ì†Œë¥¼ ì¸¡ì •í•˜ì„¸ìš”.</p>
<h3 id="3-vm">ì—°ìŠµ 3: ë ˆì§€ìŠ¤í„° VMì„ ìœ„í•œ ë ˆì§€ìŠ¤í„° í• ë‹¹<a class="header-link" href="#3-vm" title="Permanent link">&para;</a></h3>
<p>ìŠ¤íƒ ê¸°ë°˜ ë°”ì´íŠ¸ì½”ë“œë¥¼ ë ˆì§€ìŠ¤í„° ê¸°ë°˜ ë°”ì´íŠ¸ì½”ë“œë¡œ ë³€í™˜í•˜ëŠ” ê°„ë‹¨í•œ ë ˆì§€ìŠ¤í„° í• ë‹¹ê¸°ë¥¼ êµ¬í˜„í•˜ì„¸ìš”:
(a) ê°„ë‹¨í•œ ìŠ¤íƒ ì‹œë®¬ë ˆì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ ê°’ì´ ì–´ë–¤ ë ˆì§€ìŠ¤í„°ì— ìˆëŠ”ì§€ ì¶”ì í•©ë‹ˆë‹¤.
(b) ë ˆì§€ìŠ¤í„°ê°€ ë¶€ì¡±í•  ë•Œ ë ˆì§€ìŠ¤í„° ìŠ¤í•„ë§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
(c) ì—¬ëŸ¬ í”„ë¡œê·¸ë¨ì— ëŒ€í•´ ìŠ¤íƒê³¼ ë ˆì§€ìŠ¤í„° ë²„ì „ì˜ ëª…ë ¹ì–´ ìˆ˜ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.</p>
<h3 id="4-jit">ì—°ìŠµ 4: ê°„ë‹¨í•œ JIT ì»´íŒŒì¼ëŸ¬<a class="header-link" href="#4-jit" title="Permanent link">&para;</a></h3>
<p>ë‹¤ìŒì„ êµ¬í˜„í•˜ëŠ” ê°„ë‹¨í•œ JIT ìœ ì‚¬ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ì„¸ìš”:
(a) ê°€ì¥ ìì£¼ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë¥¼ í”„ë¡œíŒŒì¼ë§í•©ë‹ˆë‹¤.
(b) "í•«" í•¨ìˆ˜ì— ëŒ€í•´ ë””ìŠ¤íŒ¨ì¹˜ ì˜¤ë²„í—¤ë“œë¥¼ ì œê±°í•˜ëŠ” íŠ¹ìˆ˜í™”ëœ Python í•¨ìˆ˜ë¥¼ (<code>exec</code> ì‚¬ìš©) ìƒì„±í•©ë‹ˆë‹¤.
(c) í•´ì„ vs "JIT ì»´íŒŒì¼" ë²„ì „ì„ ë²¤ì¹˜ë§ˆí¬í•©ë‹ˆë‹¤.</p>
<h3 id="5-vm">ì—°ìŠµ 5: VM ë””ë²„ê±°<a class="header-link" href="#5-vm" title="Permanent link">&para;</a></h3>
<p>7ì ˆì˜ VMì— ë””ë²„ê¹… ì§€ì›ì„ ì¶”ê°€í•˜ì„¸ìš”:
(a) ë‹¨ì¼ ë‹¨ê³„ ì‹¤í–‰ (ëª…ë ¹ì–´ í•˜ë‚˜ ì‹¤í–‰ í›„ ì¼ì‹œ ì •ì§€).
(b) ë¸Œë ˆì´í¬í¬ì¸íŠ¸ (íŠ¹ì • ëª…ë ¹ì–´ ì¸ë±ìŠ¤ì— ë„ë‹¬ ì‹œ ì¼ì‹œ ì •ì§€).
(c) ì–´ëŠ ì§€ì ì—ì„œë“  ìŠ¤íƒê³¼ ì§€ì—­ ë³€ìˆ˜ ê²€ì‚¬.
(d) ì½œ ìŠ¤íƒ í‘œì‹œ (í•¨ìˆ˜ í˜¸ì¶œ ì²´ì¸ í‘œì‹œ).</p>
<h3 id="6-vm">ì—°ìŠµ 6: VM ì„±ëŠ¥ ë¶„ì„<a class="header-link" href="#6-vm" title="Permanent link">&para;</a></h3>
<p>ì‹¤í–‰ í†µê³„ë¥¼ ìˆ˜ì§‘í•˜ëŠ” VM ê³„ì¸¡:
(a) ê° ì˜µì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” íšŸìˆ˜ë¥¼ ì„¸ì–´ë´…ë‹ˆë‹¤.
(b) ê°€ì¥ ì¼ë°˜ì ì¸ ì˜µì½”ë“œ ìŒ(ìŠˆí¼ëª…ë ¹ì–´)ì„ ì‹ë³„í•©ë‹ˆë‹¤.
(c) ê³µí†µ ìŒì„ ê²°í•©í•˜ëŠ” ìŠˆí¼ëª…ë ¹ì–´ 3ê°œë¥¼ ì œì•ˆí•˜ê³  êµ¬í˜„í•©ë‹ˆë‹¤.
(d) ë””ìŠ¤íŒ¨ì¹˜ ìˆ˜ì™€ ì‹¤í–‰ ì‹œê°„ì˜ ê°ì†Œë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="14">14. ì°¸ê³  ìë£Œ<a class="header-link" href="#14" title="Permanent link">&para;</a></h2>
<ol>
<li>Aho, A. V., Lam, M. S., Sethi, R., &amp; Ullman, J. D. (2006). <em>Compilers: Principles, Techniques, and Tools</em> (2nd ed.), Chapter 8.</li>
<li>Nystrom, R. (2021). <em>Crafting Interpreters</em>. Available at <a href="https://craftinginterpreters.com/">craftinginterpreters.com</a>.</li>
<li>Smith, J. E., &amp; Nair, R. (2005). <em>Virtual Machines: Versatile Platforms for Systems and Processes</em>. Morgan Kaufmann.</li>
<li>Ertl, M. A., &amp; Gregg, D. (2003). "The Structure and Performance of Efficient Interpreters." <em>Journal of Instruction-Level Parallelism</em>, 5.</li>
<li>Shi, Y., Gregg, D., Beatty, A., &amp; Ertl, M. A. (2008). "Virtual Machine Showdown: Stack versus Registers." <em>ACM TOPLAS</em>, 30(4).</li>
<li>Bolz, C. F., Cuni, A., Fijalkowski, M., &amp; Rigo, A. (2009). "Tracing the Meta-level: PyPy's Tracing JIT Compiler." <em>ICOOOLPS</em>.</li>
<li>Holzle, U., Chambers, C., &amp; Ungar, D. (1991). "Optimizing Dynamically-Typed Object-Oriented Languages With Polymorphic Inline Caches." <em>ECOOP</em>.</li>
<li>Deutsch, L. P., &amp; Schiffman, A. M. (1984). "Efficient Implementation of the Smalltalk-80 System." <em>POPL</em>.</li>
</ol>
<hr />
<p><a href="./14_Garbage_Collection.md">ì´ì „: 14. ê°€ë¹„ì§€ ì»¬ë ‰ì…˜</a> | <a href="./16_Modern_Compiler_Infrastructure.md">ë‹¤ìŒ: 16. í˜„ëŒ€ ì»´íŒŒì¼ëŸ¬ ì¸í”„ë¼</a> | <a href="./00_Overview.md">ê°œìš”</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/14_Garbage_Collection.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ê°€ë¹„ì§€ ì»¬ë ‰ì…˜(Garbage Collection)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Compiler_Design/16_Modern_Compiler_Infrastructure.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">í˜„ëŒ€ ì»´íŒŒì¼ëŸ¬ ì¸í”„ë¼(Modern Compiler Infrastructure)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}