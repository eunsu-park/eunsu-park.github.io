{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>현대 컴파일러 인프라(Modern Compiler Infrastructure) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">💻</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        한국어
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">☀️</span>
                    <span class="theme-icon dark">🌙</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Compiler_Design/">Compiler Design</a>
    <span class="separator">/</span>
    <span class="current">현대 컴파일러 인프라(Modern Compiler Infrastructure)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>현대 컴파일러 인프라(Modern Compiler Infrastructure)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/15_Interpreters_and_Virtual_Machines.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">인터프리터와 가상 머신(Interpreters and Virtual Machines)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">목차</a></li>
<li><a href="#1-llvm">1. LLVM 개요</a><ul>
<li><a href="#11-llvm">1.1 LLVM이란?</a></li>
<li><a href="#12-llvm">1.2 LLVM 아키텍처</a></li>
<li><a href="#13-3">1.3 3단계 설계</a></li>
<li><a href="#14-llvm-clang">1.4 LLVM으로 컴파일하기 (Clang 사용)</a></li>
</ul>
</li>
<li><a href="#2-llvm-ir">2. LLVM IR 상세</a><ul>
<li><a href="#21-ir">2.1 IR 구조</a></li>
<li><a href="#22">2.2 타입 시스템</a></li>
<li><a href="#23-ssa">2.3 SSA와 명령어</a></li>
<li><a href="#24">2.4 메모리 명령어</a></li>
<li><a href="#25">2.5 제어 흐름</a></li>
<li><a href="#26">2.6 함수 호출</a></li>
<li><a href="#27-llvm-ir">2.7 완전한 LLVM IR 예제</a></li>
<li><a href="#28-python-llvm-ir">2.8 Python으로 LLVM IR 생성하기</a></li>
</ul>
</li>
<li><a href="#3-llvm">3. LLVM 패스 작성</a><ul>
<li><a href="#31">3.1 패스 종류</a></li>
<li><a href="#32">3.2 패스 파이프라인</a></li>
<li><a href="#33-python-llvm">3.3 Python으로 LLVM 패스 시뮬레이션</a></li>
<li><a href="#34-llvm-c">3.4 실제 LLVM 패스 예제 (C++ 스케치)</a></li>
</ul>
</li>
<li><a href="#4-mlir-ir">4. MLIR: 다중 레벨 IR</a><ul>
<li><a href="#41-mlir">4.1 MLIR이 해결하는 문제</a></li>
<li><a href="#42-mlir">4.2 MLIR 개념</a></li>
<li><a href="#43-mlir">4.3 주요 MLIR 다이얼렉트</a></li>
<li><a href="#44-progressive-lowering">4.4 점진적 하강(Progressive Lowering)</a></li>
</ul>
</li>
<li><a href="#5-gcc">5. GCC 내부</a><ul>
<li><a href="#51-gcc">5.1 GCC 아키텍처</a></li>
<li><a href="#52-gimple">5.2 GIMPLE</a></li>
<li><a href="#53-rtl">5.3 RTL (레지스터 전송 언어)</a></li>
<li><a href="#54-llvm-gcc">5.4 LLVM 대 GCC 비교</a></li>
</ul>
</li>
<li><a href="#6">6. 도메인 특화 언어</a><ul>
<li><a href="#61-dsl">6.1 DSL이란?</a></li>
<li><a href="#62-dsl">6.2 DSL 설계 원칙</a></li>
<li><a href="#63-dsl">6.3 외부 DSL 구축</a></li>
<li><a href="#64-dsl">6.4 임베디드 DSL</a></li>
</ul>
</li>
<li><a href="#7">7. 컴파일러 구성 도구</a><ul>
<li><a href="#71-antlr">7.1 ANTLR</a></li>
<li><a href="#72-tree-sitter">7.2 Tree-sitter</a></li>
<li><a href="#73">7.3 도구 비교</a></li>
</ul>
</li>
<li><a href="#8">8. 언어 서버 프로토콜</a><ul>
<li><a href="#81-lsp">8.1 LSP란?</a></li>
<li><a href="#82-lsp">8.2 LSP 아키텍처</a></li>
<li><a href="#83-lsp">8.3 LSP 기능</a></li>
<li><a href="#84">8.4 간단한 언어 서버 구축</a></li>
</ul>
</li>
<li><a href="#9">9. 증분 컴파일</a><ul>
<li><a href="#91">9.1 문제</a></li>
<li><a href="#92">9.2 의존성 추적</a></li>
<li><a href="#93">9.3 실무에서의 증분 컴파일</a></li>
</ul>
</li>
<li><a href="#10">10. 프로파일 기반 최적화</a><ul>
<li><a href="#101-pgo">10.1 PGO란?</a></li>
<li><a href="#102-pgo">10.2 PGO 최적화 결정</a></li>
<li><a href="#103-clanggcc-pgo">10.3 Clang/GCC에서 PGO 사용하기</a></li>
<li><a href="#104-pgo">10.4 PGO 시뮬레이션</a></li>
</ul>
</li>
<li><a href="#11">11. 링크 타임 최적화</a><ul>
<li><a href="#111-lto">11.1 LTO란?</a></li>
<li><a href="#112-lto-thinlto">11.2 전체 LTO 대 ThinLTO</a></li>
<li><a href="#113-lto">11.3 LTO가 가능하게 하는 것들</a></li>
</ul>
</li>
<li><a href="#12">12. 컴파일러 검증</a><ul>
<li><a href="#121">12.1 컴파일러를 검증해야 하는 이유</a></li>
<li><a href="#122">12.2 컴파일러 정확성 접근 방식</a></li>
<li><a href="#123-compcert">12.3 CompCert: 검증된 컴파일러</a></li>
<li><a href="#124-alive2-llvm-ir">12.4 Alive2: LLVM IR 검증</a></li>
</ul>
</li>
<li><a href="#13">13. 요약</a></li>
<li><a href="#14">14. 연습 문제</a><ul>
<li><a href="#1-llvm-ir">연습 1: 직접 LLVM IR 작성</a></li>
<li><a href="#2">연습 2: 최적화 패스</a></li>
<li><a href="#3-dsl">연습 3: DSL 설계 및 구현</a></li>
<li><a href="#4">연습 4: 증분 컴파일</a></li>
<li><a href="#5-pgo">연습 5: PGO 시뮬레이터</a></li>
<li><a href="#6_1">연습 6: 번역 검증기</a></li>
</ul>
</li>
<li><a href="#15">15. 참고 자료</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="modern-compiler-infrastructure">현대 컴파일러 인프라(Modern Compiler Infrastructure)<a class="header-link" href="#modern-compiler-infrastructure" title="Permanent link">&para;</a></h1>
<p><strong>이전</strong>: <a href="./15_Interpreters_and_Virtual_Machines.md">15. 인터프리터와 가상 머신</a></p>
<hr />
<p>현대 컴파일러는 처음부터 만드는 단일 프로그램이 아닙니다. 재사용 가능한 인프라 -- 중간 표현(Intermediate Representation), 최적화 패스(Optimization Pass), 코드 생성기, 도구 프레임워크 -- 를 조립하여 만들어지며, 이를 여러 언어에서 공유할 수 있습니다. LLVM 프로젝트가 이 철학을 잘 보여줍니다: 수십 개의 언어(C, C++, Rust, Swift, Julia, Zig 등)가 동일한 최적화기와 코드 생성기를 공유합니다.</p>
<p>이 레슨에서는 현대 컴파일러를 구동하는 인프라를 탐구합니다: LLVM의 아키텍처와 IR, MLIR의 다중 레벨 접근 방식, GCC 내부, 도메인 특화 언어(DSL) 설계, 컴파일러 구성 도구, 그리고 PGO와 LTO 같은 고급 컴파일 기법들입니다.</p>
<p><strong>난이도</strong>: ⭐⭐⭐⭐</p>
<p><strong>선수 지식</strong>: <a href="./09_Intermediate_Representations.md">09. 중간 표현</a>, <a href="./11_Code_Generation.md">11. 코드 생성</a>, <a href="./12_Optimization_Local_and_Global.md">12. 최적화 -- 지역 및 전역</a></p>
<p><strong>학습 목표</strong>:
- LLVM의 모듈식 아키텍처와 패스 파이프라인 설명
- 타입, 명령어, SSA 형식을 포함한 LLVM IR 읽기 및 쓰기
- LLVM 최적화 패스 작성 방법 이해
- MLIR의 다중 레벨 IR 철학과 다이얼렉트(Dialect) 설명
- LLVM과 GCC 내부 표현(GIMPLE, RTL) 비교
- 도메인 특화 언어(DSL) 설계 및 구현
- 컴파일러 구성 도구(ANTLR, Tree-sitter) 활용
- 언어 서버 프로토콜(Language Server Protocol, LSP) 이해
- 증분 컴파일(Incremental Compilation) 전략 설명
- 프로파일 기반 최적화(Profile-Guided Optimization, PGO)와 링크 타임 최적화(Link-Time Optimization, LTO) 적용
- 컴파일러 검증 접근 방식 이해</p>
<hr />
<h2 id="_1">목차<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-llvm-개요">LLVM 개요</a></li>
<li><a href="#2-llvm-ir-상세">LLVM IR 상세</a></li>
<li><a href="#3-llvm-패스-작성">LLVM 패스 작성</a></li>
<li><a href="#4-mlir-다중-레벨-ir">MLIR: 다중 레벨 IR</a></li>
<li><a href="#5-gcc-내부">GCC 내부</a></li>
<li><a href="#6-도메인-특화-언어">도메인 특화 언어</a></li>
<li><a href="#7-컴파일러-구성-도구">컴파일러 구성 도구</a></li>
<li><a href="#8-언어-서버-프로토콜">언어 서버 프로토콜</a></li>
<li><a href="#9-증분-컴파일">증분 컴파일</a></li>
<li><a href="#10-프로파일-기반-최적화">프로파일 기반 최적화</a></li>
<li><a href="#11-링크-타임-최적화">링크 타임 최적화</a></li>
<li><a href="#12-컴파일러-검증">컴파일러 검증</a></li>
<li><a href="#13-요약">요약</a></li>
<li><a href="#14-연습-문제">연습 문제</a></li>
<li><a href="#15-참고-자료">참고 자료</a></li>
</ol>
<hr />
<h2 id="1-llvm">1. LLVM 개요<a class="header-link" href="#1-llvm" title="Permanent link">&para;</a></h2>
<h3 id="11-llvm">1.1 LLVM이란?<a class="header-link" href="#11-llvm" title="Permanent link">&para;</a></h3>
<p><strong>LLVM</strong>(원래는 "Low Level Virtual Machine"이었으나 이제는 단순히 이름)은 모듈식 컴파일러 및 툴체인 기술의 모음입니다. 핵심 아이디어는 언어별 프론트엔드와 타겟별 백엔드를 분리하는 잘 정의된 중간 표현(LLVM IR)입니다.</p>
<div class="highlight"><pre><span></span><code>언어 프론트엔드:              LLVM 핵심:              타겟 백엔드:
┌───────┐                                                ┌──────────┐
│ Clang │───┐                                        ┌──▶│  x86-64  │
│ (C/C++)│   │    ┌──────────┐   ┌──────────┐        │   └──────────┘
└───────┘   │    │          │   │          │        │   ┌──────────┐
┌───────┐   ├───▶│ LLVM IR  │──▶│최적화기  │──▶─────┼──▶│  ARM64   │
│ Rust  │───┤    │          │   │ (패스들) │        │   └──────────┘
│(rustc)│   │    └──────────┘   └──────────┘        │   ┌──────────┐
└───────┘   │                                        ├──▶│  RISC-V  │
┌───────┐   │                                        │   └──────────┘
│ Swift │───┤                                        │   ┌──────────┐
│       │   │                                        └──▶│  WASM    │
└───────┘   │                                            └──────────┘
┌───────┐   │
│ Julia │───┘
│       │
└───────┘
</code></pre></div>

<h3 id="12-llvm">1.2 LLVM 아키텍처<a class="header-link" href="#12-llvm" title="Permanent link">&para;</a></h3>
<p>LLVM은 여러 핵심 구성 요소로 이루어집니다:</p>
<table>
<thead>
<tr>
<th>구성 요소</th>
<th>목적</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>LLVM Core</strong></td>
<td>IR 정의, 최적화 패스, 코드 생성</td>
</tr>
<tr>
<td><strong>Clang</strong></td>
<td>C/C++/Objective-C 프론트엔드</td>
</tr>
<tr>
<td><strong>LLDB</strong></td>
<td>디버거</td>
</tr>
<tr>
<td><strong>libc++</strong></td>
<td>C++ 표준 라이브러리</td>
</tr>
<tr>
<td><strong>compiler-rt</strong></td>
<td>런타임 지원 (새니타이저, 프로파일링)</td>
</tr>
<tr>
<td><strong>LLD</strong></td>
<td>링커</td>
</tr>
<tr>
<td><strong>MLIR</strong></td>
<td>다중 레벨 IR 프레임워크</td>
</tr>
<tr>
<td><strong>Polly</strong></td>
<td>폴리헤드럴 최적화 패스</td>
</tr>
</tbody>
</table>
<h3 id="13-3">1.3 3단계 설계<a class="header-link" href="#13-3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="mi">1</span><span class="err">단계</span><span class="o">:</span><span class="w"> </span><span class="err">프론트엔드</span><span class="w">        </span><span class="mi">2</span><span class="err">단계</span><span class="o">:</span><span class="w"> </span><span class="err">최적화기</span><span class="w">        </span><span class="mi">3</span><span class="err">단계</span><span class="o">:</span><span class="w"> </span><span class="err">백엔드</span>
<span class="err">┌─────────────────┐</span><span class="w">       </span><span class="err">┌──────────────────┐</span><span class="w">     </span><span class="err">┌─────────────────┐</span>
<span class="err">│</span><span class="w">                 </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">                  </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">                 </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="err">소스</span><span class="w"> </span><span class="err">코드</span><span class="w">       </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">LLVM</span><span class="w"> </span><span class="n">IR</span><span class="w">          </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="err">기계어</span><span class="w"> </span><span class="err">코드</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">           </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">            </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">           </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="err">▼</span><span class="w">           </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">     </span><span class="err">▼</span><span class="w">            </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">     </span><span class="err">▼</span><span class="w">           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">렉싱</span><span class="w">           </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="err">분석</span><span class="w"> </span><span class="err">패스</span><span class="w">        </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="err">명령어</span><span class="w">          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">파싱</span><span class="w">           </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="err">변환</span><span class="w"> </span><span class="err">패스</span><span class="w">        </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="err">선택</span><span class="w">            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">의미</span><span class="w">           </span><span class="err">│──────▶│</span><span class="w">                  </span><span class="err">│────▶│</span><span class="w"> </span><span class="err">레지스터</span><span class="w"> </span><span class="err">할당</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">분석</span><span class="w">           </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="err">최적화</span><span class="w">           </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="err">명령어</span><span class="w">          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="n">IR</span><span class="w"> </span><span class="err">생성</span><span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="err">수준</span><span class="o">:</span><span class="w">            </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="err">스케줄링</span><span class="w">        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                 </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="n">O0</span><span class="o">,</span><span class="w"> </span><span class="o">-</span><span class="n">O1</span><span class="o">,</span><span class="w"> </span><span class="o">-</span><span class="n">O2</span><span class="o">,</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="err">코드</span><span class="w"> </span><span class="err">방출</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">                 </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">  </span><span class="o">-</span><span class="n">O3</span><span class="o">,</span><span class="w"> </span><span class="o">-</span><span class="n">Os</span><span class="o">,</span><span class="w"> </span><span class="o">-</span><span class="n">Oz</span><span class="w">   </span><span class="err">│</span><span class="w">     </span><span class="err">│</span><span class="w">                 </span><span class="err">│</span>
<span class="err">└─────────────────┘</span><span class="w">       </span><span class="err">└──────────────────┘</span><span class="w">     </span><span class="err">└─────────────────┘</span>
</code></pre></div>

<p>이 설계의 장점: 새로운 언어를 추가하려면 LLVM IR을 생성하는 프론트엔드만 작성하면 됩니다. 새로운 타겟 아키텍처를 추가하려면 백엔드만 작성하면 됩니다. 양쪽 모두 기존의 모든 최적화 혜택을 누립니다.</p>
<h3 id="14-llvm-clang">1.4 LLVM으로 컴파일하기 (Clang 사용)<a class="header-link" href="#14-llvm-clang" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># C 코드에서 LLVM IR 생성</span>
clang<span class="w"> </span>-S<span class="w"> </span>-emit-llvm<span class="w"> </span>hello.c<span class="w"> </span>-o<span class="w"> </span>hello.ll

<span class="c1"># LLVM IR 최적화</span>
opt<span class="w"> </span>-O2<span class="w"> </span>hello.ll<span class="w"> </span>-o<span class="w"> </span>hello_opt.ll

<span class="c1"># LLVM IR을 어셈블리로 컴파일</span>
llc<span class="w"> </span>hello_opt.ll<span class="w"> </span>-o<span class="w"> </span>hello.s

<span class="c1"># 또는 직접 오브젝트 파일로 컴파일</span>
clang<span class="w"> </span>-c<span class="w"> </span>hello.c<span class="w"> </span>-O2<span class="w"> </span>-o<span class="w"> </span>hello.o

<span class="c1"># 최적화 파이프라인 확인</span>
clang<span class="w"> </span>-O2<span class="w"> </span>-mllvm<span class="w"> </span>-print-after-all<span class="w"> </span>hello.c<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-100
</code></pre></div>

<hr />
<h2 id="2-llvm-ir">2. LLVM IR 상세<a class="header-link" href="#2-llvm-ir" title="Permanent link">&para;</a></h2>
<h3 id="21-ir">2.1 IR 구조<a class="header-link" href="#21-ir" title="Permanent link">&para;</a></h3>
<p>LLVM IR은 타입이 있는 SSA 기반의 중간 표현입니다. 세 가지 동형(Isomorphic) 형태로 존재합니다:
- <strong>사람이 읽을 수 있는 텍스트</strong> (<code>.ll</code> 파일)
- <strong>밀집 이진 인코딩</strong> (비트코드, <code>.bc</code> 파일)
- <strong>메모리 내 데이터 구조</strong> (C++ 객체)</p>
<p>모듈(번역 단위)의 구성:</p>
<div class="highlight"><pre><span></span><code><span class="c">; 모듈 수준 구조</span>
<span class="k">source_filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;example.c&quot;</span>
<span class="k">target</span><span class="w"> </span><span class="k">datalayout</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;e-m:o-i64:64-i128:128-n32:64-S128&quot;</span>
<span class="k">target</span><span class="w"> </span><span class="k">triple</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;arm64-apple-macosx14.0.0&quot;</span>

<span class="c">; 전역 변수</span>
<span class="vg">@global_var</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="k">align</span><span class="w"> </span><span class="m">4</span>
<span class="vg">@hello_str</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">constant</span><span class="w"> </span><span class="p">[</span><span class="m">12</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i8</span><span class="p">]</span><span class="w"> </span><span class="k">c</span><span class="s">&quot;Hello World\00&quot;</span>

<span class="c">; 함수 선언 (외부)</span>
<span class="k">declare</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@printf</span><span class="p">(</span><span class="kt">i8</span><span class="p">*</span><span class="w"> </span><span class="k">nocapture</span><span class="w"> </span><span class="k">readonly</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>

<span class="c">; 함수 정의</span>
<span class="k">define</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="nl">entry:</span>
<span class="w">  </span><span class="nv">%x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">alloca</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="k">align</span><span class="w"> </span><span class="m">4</span>
<span class="w">  </span><span class="k">store</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">*</span><span class="w"> </span><span class="nv">%x</span><span class="p">,</span><span class="w"> </span><span class="k">align</span><span class="w"> </span><span class="m">4</span>
<span class="w">  </span><span class="nv">%val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">*</span><span class="w"> </span><span class="nv">%x</span><span class="p">,</span><span class="w"> </span><span class="k">align</span><span class="w"> </span><span class="m">4</span>
<span class="w">  </span><span class="nv">%result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">nsw</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%val</span><span class="p">,</span><span class="w"> </span><span class="m">32</span>
<span class="w">  </span><span class="k">ret</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%result</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="22">2.2 타입 시스템<a class="header-link" href="#22" title="Permanent link">&para;</a></h3>
<p>LLVM IR은 풍부한 타입 시스템을 갖추고 있습니다:</p>
<div class="highlight"><pre><span></span><code><span class="c">; 정수 타입</span>
<span class="kt">i1</span><span class="w">        </span><span class="c">; 1비트 (불리언)</span>
<span class="kt">i8</span><span class="w">        </span><span class="c">; 8비트 (바이트/char)</span>
<span class="kt">i16</span><span class="w">       </span><span class="c">; 16비트 (short)</span>
<span class="kt">i32</span><span class="w">       </span><span class="c">; 32비트 (int)</span>
<span class="kt">i64</span><span class="w">       </span><span class="c">; 64비트 (long)</span>
<span class="kt">i128</span><span class="w">      </span><span class="c">; 128비트</span>

<span class="c">; 부동소수점 타입</span>
<span class="kt">half</span><span class="w">      </span><span class="c">; 16비트 float</span>
<span class="kt">float</span><span class="w">     </span><span class="c">; 32비트 float</span>
<span class="kt">double</span><span class="w">    </span><span class="c">; 64비트 float</span>

<span class="c">; 포인터 타입</span>
<span class="kt">ptr</span><span class="w">       </span><span class="c">; 불투명 포인터 (LLVM 15+)</span>
<span class="kt">i32</span><span class="p">*</span><span class="w">      </span><span class="c">; 타입이 있는 포인터 (레거시)</span>

<span class="c">; 배열 타입</span>
<span class="p">[</span><span class="m">10</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i32</span><span class="p">]</span><span class="w">         </span><span class="c">; 10개의 i32 배열</span>
<span class="p">[</span><span class="m">3</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="p">[</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">float</span><span class="p">]]</span><span class="w">  </span><span class="c">; 3x4 float 행렬</span>

<span class="c">; 구조체 타입</span>
<span class="p">{</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">*</span><span class="w"> </span><span class="p">}</span><span class="w">           </span><span class="c">; 리터럴 구조체</span>
<span class="nv">%struct.Point</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="c">; 이름 있는 구조체</span>

<span class="c">; 벡터 타입 (SIMD)</span>
<span class="p">&lt;</span><span class="m">4</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">float</span><span class="p">&gt;</span><span class="w">    </span><span class="c">; 4원소 float 벡터</span>
<span class="p">&lt;</span><span class="m">8</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i32</span><span class="p">&gt;</span><span class="w">      </span><span class="c">; 8원소 int 벡터</span>

<span class="c">; 함수 타입</span>
<span class="kt">i32</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w">      </span><span class="c">; i32 두 개를 받아 i32를 반환하는 함수</span>
<span class="k">void</span><span class="w"> </span><span class="p">(</span><span class="kt">i8</span><span class="p">*,</span><span class="w"> </span><span class="p">...)</span><span class="w">     </span><span class="c">; 가변 인자 함수</span>
</code></pre></div>

<h3 id="23-ssa">2.3 SSA와 명령어<a class="header-link" href="#23-ssa" title="Permanent link">&para;</a></h3>
<p>LLVM IR의 모든 값은 <strong>정적 단일 대입(Static Single Assignment, SSA)</strong> 형식입니다: 각 변수는 정확히 한 번만 정의됩니다. 파이 노드($\phi$-함수)는 제어 흐름 합류 지점에서 값을 병합합니다.</p>
<div class="highlight"><pre><span></span><code><span class="c">; 산술 명령어</span>
<span class="nv">%sum</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span><span class="w">          </span><span class="c">; 정수 덧셈</span>
<span class="nv">%diff</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">sub</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span><span class="w">         </span><span class="c">; 정수 뺄셈</span>
<span class="nv">%prod</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">mul</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span><span class="w">         </span><span class="c">; 정수 곱셈</span>
<span class="nv">%quot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">sdiv</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span><span class="w">        </span><span class="c">; 부호 있는 정수 나눗셈</span>
<span class="nv">%rem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">srem</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span><span class="w">         </span><span class="c">; 부호 있는 나머지</span>

<span class="nv">%fsum</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">fadd</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nv">%x</span><span class="p">,</span><span class="w"> </span><span class="nv">%y</span><span class="w">     </span><span class="c">; 부동소수점 덧셈</span>
<span class="nv">%fprod</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">fmul</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="nv">%x</span><span class="p">,</span><span class="w"> </span><span class="nv">%y</span><span class="w">     </span><span class="c">; 부동소수점 곱셈</span>

<span class="c">; nsw/nuw 플래그: 부호 있는/없는 오버플로우 없음 (최적화 활성화)</span>
<span class="nv">%safe_add</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">nsw</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span>

<span class="c">; 비교</span>
<span class="nv">%cmp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">eq</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span><span class="w">      </span><span class="c">; 정수 비교 (eq, ne, slt, sgt, sle, sge)</span>
<span class="nv">%fcmp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">fcmp</span><span class="w"> </span><span class="k">olt</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nv">%x</span><span class="p">,</span><span class="w"> </span><span class="nv">%y</span><span class="w"> </span><span class="c">; 부동소수점 비교 (olt, ogt, oeq, ...)</span>

<span class="c">; 비트 연산</span>
<span class="nv">%and</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span>
<span class="nv">%or</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span>
<span class="nv">%xor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">xor</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="nv">%b</span>
<span class="nv">%shl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">shl</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="w">           </span><span class="c">; 2비트 왼쪽 시프트</span>

<span class="c">; 변환</span>
<span class="nv">%ext</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">sext</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="kt">i64</span><span class="w">      </span><span class="c">; i32를 i64로 부호 확장</span>
<span class="nv">%trunc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">trunc</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="nv">%b</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="kt">i32</span><span class="w">   </span><span class="c">; i64를 i32로 절단</span>
<span class="nv">%fp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">sitofp</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="kt">double</span><span class="w">  </span><span class="c">; 부호 있는 정수를 부동소수점으로</span>
<span class="nv">%int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">fptosi</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nv">%x</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="c">; 부동소수점을 부호 있는 정수로</span>
<span class="nv">%cast</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">bitcast</span><span class="w"> </span><span class="kt">i32</span><span class="p">*</span><span class="w"> </span><span class="nv">%p</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="kt">i8</span><span class="p">*</span><span class="w"> </span><span class="c">; 비트 재해석 (같은 크기)</span>
</code></pre></div>

<h3 id="24">2.4 메모리 명령어<a class="header-link" href="#24" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c">; 스택 할당</span>
<span class="nv">%ptr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">alloca</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="k">align</span><span class="w"> </span><span class="m">4</span><span class="w">         </span><span class="c">; 스택에 4바이트 할당</span>
<span class="nv">%arr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">alloca</span><span class="w"> </span><span class="p">[</span><span class="m">100</span><span class="w"> </span><span class="k">x</span><span class="w"> </span><span class="kt">i32</span><span class="p">],</span><span class="w"> </span><span class="k">align</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="c">; 스택에 배열 할당</span>

<span class="c">; 로드와 스토어</span>
<span class="k">store</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">*</span><span class="w"> </span><span class="nv">%ptr</span><span class="p">,</span><span class="w"> </span><span class="k">align</span><span class="w"> </span><span class="m">4</span><span class="w">    </span><span class="c">; *ptr = 42</span>
<span class="nv">%val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">*</span><span class="w"> </span><span class="nv">%ptr</span><span class="p">,</span><span class="w"> </span><span class="k">align</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="c">; val = *ptr</span>

<span class="c">; GEP (GetElementPtr) -- 메모리 접근 없이 주소 계산</span>
<span class="c">; LLVM에서 가장 중요하고 (혼란스러운) 명령어 중 하나</span>
<span class="nv">%struct.Point</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">}</span>

<span class="nv">%p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">alloca</span><span class="w"> </span><span class="nv">%struct.Point</span>
<span class="c">; 두 번째 필드(y)에 대한 포인터 얻기:</span>
<span class="nv">%y_ptr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">getelementptr</span><span class="w"> </span><span class="nv">%struct.Point</span><span class="p">,</span><span class="w"> </span><span class="nv">%struct.Point</span><span class="p">*</span><span class="w"> </span><span class="nv">%p</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">1</span>
<span class="c">; 첫 번째 인덱스 (i32 0): 배열에서 몇 번째 구조체인지 (0번째)</span>
<span class="c">; 두 번째 인덱스 (i32 1): 몇 번째 필드인지 (1 = 두 번째 필드)</span>
</code></pre></div>

<h3 id="25">2.5 제어 흐름<a class="header-link" href="#25" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c">; 무조건 분기</span>
<span class="k">br</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%target</span>

<span class="c">; 조건부 분기</span>
<span class="nv">%cond</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">slt</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%i</span><span class="p">,</span><span class="w"> </span><span class="nv">%n</span>
<span class="k">br</span><span class="w"> </span><span class="kt">i1</span><span class="w"> </span><span class="nv">%cond</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%loop_body</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%loop_exit</span>

<span class="c">; 파이 노드 (SSA 합류 지점에서의 병합)</span>
<span class="k">define</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@abs</span><span class="p">(</span><span class="kt">i32</span><span class="w"> </span><span class="nv">%x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="nl">entry:</span>
<span class="w">  </span><span class="nv">%is_neg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">slt</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%x</span><span class="p">,</span><span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="k">br</span><span class="w"> </span><span class="kt">i1</span><span class="w"> </span><span class="nv">%is_neg</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%negative</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%done</span>

<span class="nl">negative:</span>
<span class="w">  </span><span class="nv">%neg_x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">sub</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nv">%x</span>
<span class="w">  </span><span class="k">br</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%done</span>

<span class="nl">done:</span>
<span class="w">  </span><span class="c">; 파이 노드: 값은 어느 선행 블록에서 왔는지에 따라 달라짐</span>
<span class="w">  </span><span class="nv">%result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">phi</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">%x</span><span class="p">,</span><span class="w"> </span><span class="nv">%entry</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">%neg_x</span><span class="p">,</span><span class="w"> </span><span class="nv">%negative</span><span class="w"> </span><span class="p">]</span>
<span class="w">  </span><span class="k">ret</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%result</span>
<span class="p">}</span>

<span class="c">; 스위치</span>
<span class="k">switch</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%val</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%default</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="kt">i32</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%case0</span>
<span class="w">  </span><span class="kt">i32</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%case1</span>
<span class="w">  </span><span class="kt">i32</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%case2</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="26">2.6 함수 호출<a class="header-link" href="#26" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c">; 직접 호출</span>
<span class="nv">%result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@add</span><span class="p">(</span><span class="kt">i32</span><span class="w"> </span><span class="nv">%a</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%b</span><span class="p">)</span>

<span class="c">; 속성 있는 호출</span>
<span class="nv">%result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@pure_func</span><span class="p">(</span><span class="kt">i32</span><span class="w"> </span><span class="nv">%x</span><span class="p">)</span><span class="w"> </span><span class="k">nounwind</span><span class="w"> </span><span class="k">readnone</span>

<span class="c">; 꼬리 호출 (꼬리 호출 최적화 활성화)</span>
<span class="nv">%result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">tail</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@recursive_func</span><span class="p">(</span><span class="kt">i32</span><span class="w"> </span><span class="nv">%n</span><span class="p">)</span>

<span class="c">; 인보크 (예외를 던질 수 있는 호출)</span>
<span class="nv">%result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">invoke</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@may_throw</span><span class="p">(</span><span class="kt">i32</span><span class="w"> </span><span class="nv">%x</span><span class="p">)</span>
<span class="w">          </span><span class="k">to</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%normal</span><span class="w"> </span><span class="k">unwind</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%exception</span>
</code></pre></div>

<h3 id="27-llvm-ir">2.7 완전한 LLVM IR 예제<a class="header-link" href="#27-llvm-ir" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c">; LLVM IR로 작성한 팩토리얼 함수</span>
<span class="k">define</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@factorial</span><span class="p">(</span><span class="kt">i32</span><span class="w"> </span><span class="nv">%n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="nl">entry:</span>
<span class="w">  </span><span class="nv">%cmp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">sle</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%n</span><span class="p">,</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="k">br</span><span class="w"> </span><span class="kt">i1</span><span class="w"> </span><span class="nv">%cmp</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%base_case</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%recursive_case</span>

<span class="nl">base_case:</span>
<span class="w">  </span><span class="k">ret</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="m">1</span>

<span class="nl">recursive_case:</span>
<span class="w">  </span><span class="nv">%n_minus_1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">sub</span><span class="w"> </span><span class="k">nsw</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%n</span><span class="p">,</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="nv">%sub_result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@factorial</span><span class="p">(</span><span class="kt">i32</span><span class="w"> </span><span class="nv">%n_minus_1</span><span class="p">)</span>
<span class="w">  </span><span class="nv">%result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">mul</span><span class="w"> </span><span class="k">nsw</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%n</span><span class="p">,</span><span class="w"> </span><span class="nv">%sub_result</span>
<span class="w">  </span><span class="k">ret</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%result</span>
<span class="p">}</span>

<span class="c">; 반복 버전 (최적화하기 더 쉬움)</span>
<span class="k">define</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="vg">@factorial_iter</span><span class="p">(</span><span class="kt">i32</span><span class="w"> </span><span class="nv">%n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="nl">entry:</span>
<span class="w">  </span><span class="k">br</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%loop</span>

<span class="nl">loop:</span>
<span class="w">  </span><span class="nv">%i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">phi</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nv">%entry</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">%next_i</span><span class="p">,</span><span class="w"> </span><span class="nv">%loop</span><span class="w"> </span><span class="p">]</span>
<span class="w">  </span><span class="nv">%acc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">phi</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nv">%entry</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nv">%next_acc</span><span class="p">,</span><span class="w"> </span><span class="nv">%loop</span><span class="w"> </span><span class="p">]</span>
<span class="w">  </span><span class="nv">%cmp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">icmp</span><span class="w"> </span><span class="k">sle</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%i</span><span class="p">,</span><span class="w"> </span><span class="nv">%n</span>
<span class="w">  </span><span class="k">br</span><span class="w"> </span><span class="kt">i1</span><span class="w"> </span><span class="nv">%cmp</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%body</span><span class="p">,</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%done</span>

<span class="nl">body:</span>
<span class="w">  </span><span class="nv">%next_acc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">mul</span><span class="w"> </span><span class="k">nsw</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%acc</span><span class="p">,</span><span class="w"> </span><span class="nv">%i</span>
<span class="w">  </span><span class="nv">%next_i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">nsw</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%i</span><span class="p">,</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="k">br</span><span class="w"> </span><span class="kt">label</span><span class="w"> </span><span class="nv">%loop</span>

<span class="nl">done:</span>
<span class="w">  </span><span class="k">ret</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="nv">%acc</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="28-python-llvm-ir">2.8 Python으로 LLVM IR 생성하기<a class="header-link" href="#28-python-llvm-ir" title="Permanent link">&para;</a></h3>
<p><code>llvmlite</code> 라이브러리를 사용하여 프로그래밍 방식으로 LLVM IR을 생성할 수 있습니다:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># pip install llvmlite</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_llvm_ir_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate LLVM IR for a simple function using llvmlite.</span>

<span class="sd">    Function: int add(int a, int b) { return a + b; }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">llvmlite</span><span class="w"> </span><span class="kn">import</span> <span class="n">ir</span><span class="p">,</span> <span class="n">binding</span>

        <span class="c1"># Create module</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">Module</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;example&#39;</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">triple</span> <span class="o">=</span> <span class="n">binding</span><span class="o">.</span><span class="n">get_default_triple</span><span class="p">()</span>

        <span class="c1"># Define function type: i32 (i32, i32)</span>
        <span class="n">func_type</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
                                     <span class="p">[</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">)])</span>

        <span class="c1"># Create function</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">func_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
        <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>

        <span class="c1"># Create basic block</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">append_basic_block</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;entry&#39;</span><span class="p">)</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">IRBuilder</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

        <span class="c1"># Generate instructions</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ret</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generated LLVM IR:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="p">))</span>

        <span class="c1"># --- More complex example: factorial ---</span>
        <span class="n">fact_type</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="p">[</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">)])</span>
        <span class="n">fact_func</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">fact_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;factorial&#39;</span><span class="p">)</span>
        <span class="n">fact_func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>

        <span class="n">entry</span> <span class="o">=</span> <span class="n">fact_func</span><span class="o">.</span><span class="n">append_basic_block</span><span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">)</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">fact_func</span><span class="o">.</span><span class="n">append_basic_block</span><span class="p">(</span><span class="s1">&#39;loop&#39;</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">fact_func</span><span class="o">.</span><span class="n">append_basic_block</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="n">fact_func</span><span class="o">.</span><span class="n">append_basic_block</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>

        <span class="c1"># Entry block</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">IRBuilder</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">branch</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>

        <span class="c1"># Loop header</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">IRBuilder</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;acc&#39;</span><span class="p">)</span>
        <span class="n">i</span><span class="o">.</span><span class="n">add_incoming</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">entry</span><span class="p">)</span>
        <span class="n">acc</span><span class="o">.</span><span class="n">add_incoming</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">entry</span><span class="p">)</span>

        <span class="n">cmp</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">icmp_signed</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">fact_func</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cmp&#39;</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">cbranch</span><span class="p">(</span><span class="n">cmp</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>

        <span class="c1"># Body</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">IRBuilder</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">next_acc</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;next_acc&#39;</span><span class="p">)</span>
        <span class="n">next_i</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ir</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">ir</span><span class="o">.</span><span class="n">IntType</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;next_i&#39;</span><span class="p">)</span>
        <span class="n">i</span><span class="o">.</span><span class="n">add_incoming</span><span class="p">(</span><span class="n">next_i</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        <span class="n">acc</span><span class="o">.</span><span class="n">add_incoming</span><span class="p">(</span><span class="n">next_acc</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">branch</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>

        <span class="c1"># Done</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">IRBuilder</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">ret</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">With factorial:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;llvmlite not installed. Install with: pip install llvmlite&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Here is what the generated IR would look like:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;; ModuleID = &#39;example&#39;</span>
<span class="s2">target triple = &quot;arm64-apple-macosx14.0.0&quot;</span>

<span class="s2">define i32 @add(i32 </span><span class="si">%a</span><span class="s2">, i32 %b) {</span>
<span class="s2">entry:</span>
<span class="s2">  </span><span class="si">%r</span><span class="s2">esult = add i32 </span><span class="si">%a</span><span class="s2">, %b</span>
<span class="s2">  ret i32 </span><span class="si">%r</span><span class="s2">esult</span>
<span class="s2">}</span>

<span class="s2">define i32 @factorial(i32 %n) {</span>
<span class="s2">entry:</span>
<span class="s2">  br label </span><span class="si">%lo</span><span class="s2">op</span>

<span class="s2">loop:</span>
<span class="s2">  </span><span class="si">%i</span><span class="s2"> = phi i32 [ 1, </span><span class="si">%e</span><span class="s2">ntry ], [ %next_i, %body ]</span>
<span class="s2">  </span><span class="si">%a</span><span class="s2">cc = phi i32 [ 1, </span><span class="si">%e</span><span class="s2">ntry ], [ %next_acc, %body ]</span>
<span class="s2">  </span><span class="si">%c</span><span class="s2">mp = icmp sle i32 </span><span class="si">%i</span><span class="s2">, %n</span>
<span class="s2">  br i1 </span><span class="si">%c</span><span class="s2">mp, label %body, label </span><span class="si">%d</span><span class="s2">one</span>

<span class="s2">body:</span>
<span class="s2">  %next_acc = mul i32 </span><span class="si">%a</span><span class="s2">cc, </span><span class="si">%i</span>
<span class="s2">  %next_i = add i32 </span><span class="si">%i</span><span class="s2">, 1</span>
<span class="s2">  br label </span><span class="si">%lo</span><span class="s2">op</span>

<span class="s2">done:</span>
<span class="s2">  ret i32 </span><span class="si">%a</span><span class="s2">cc</span>
<span class="s2">}&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">generate_llvm_ir_example</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="3-llvm">3. LLVM 패스 작성<a class="header-link" href="#3-llvm" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 패스 종류<a class="header-link" href="#31" title="Permanent link">&para;</a></h3>
<p>LLVM은 최적화를 IR을 변환하거나 분석하는 <strong>패스(Pass)</strong>로 구성합니다:</p>
<table>
<thead>
<tr>
<th>패스 종류</th>
<th>범위</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>모듈 패스</strong></td>
<td>전체 모듈</td>
<td>프로시저 간 분석</td>
</tr>
<tr>
<td><strong>함수 패스</strong></td>
<td>단일 함수</td>
<td>데드 코드 제거</td>
</tr>
<tr>
<td><strong>루프 패스</strong></td>
<td>단일 루프</td>
<td>루프 언롤링</td>
</tr>
<tr>
<td><strong>기본 블록 패스</strong></td>
<td>단일 기본 블록</td>
<td>핍홀 최적화</td>
</tr>
<tr>
<td><strong>분석 패스</strong></td>
<td>읽기 전용</td>
<td>도미네이터 트리 계산</td>
</tr>
</tbody>
</table>
<h3 id="32">3.2 패스 파이프라인<a class="header-link" href="#32" title="Permanent link">&para;</a></h3>
<p>LLVM의 최적화기는 신중하게 순서가 정해진 파이프라인으로 패스를 실행합니다:</p>
<div class="highlight"><pre><span></span><code><span class="o">-</span><span class="n">O2</span><span class="w"> </span><span class="err">파이프라인</span><span class="w"> </span><span class="p">(</span><span class="err">간략</span><span class="p">):</span>
<span class="w">  </span><span class="mf">1.</span><span class="w"> </span><span class="n">CFG</span><span class="w"> </span><span class="err">단순화</span>
<span class="w">  </span><span class="mf">2.</span><span class="w"> </span><span class="n">SROA</span><span class="w"> </span><span class="p">(</span><span class="err">집합체의</span><span class="w"> </span><span class="err">스칼라</span><span class="w"> </span><span class="err">대체</span><span class="p">,</span><span class="w"> </span><span class="n">Scalar</span><span class="w"> </span><span class="n">Replacement</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Aggregates</span><span class="p">)</span>
<span class="w">  </span><span class="mf">3.</span><span class="w"> </span><span class="err">조기</span><span class="w"> </span><span class="n">CSE</span><span class="w"> </span><span class="p">(</span><span class="err">공통</span><span class="w"> </span><span class="err">부분식</span><span class="w"> </span><span class="err">제거</span><span class="p">,</span><span class="w"> </span><span class="n">Common</span><span class="w"> </span><span class="n">Subexpression</span><span class="w"> </span><span class="n">Elimination</span><span class="p">)</span>
<span class="w">  </span><span class="mf">4.</span><span class="w"> </span><span class="err">인라이닝</span>
<span class="w">  </span><span class="mf">5.</span><span class="w"> </span><span class="n">CFG</span><span class="w"> </span><span class="err">단순화</span>
<span class="w">  </span><span class="mf">6.</span><span class="w"> </span><span class="err">명령어</span><span class="w"> </span><span class="err">결합</span>
<span class="w">  </span><span class="mf">7.</span><span class="w"> </span><span class="err">재결합</span><span class="p">(</span><span class="n">Reassociate</span><span class="p">)</span>
<span class="w">  </span><span class="mf">8.</span><span class="w"> </span><span class="err">루프</span><span class="w"> </span><span class="err">패스</span><span class="p">:</span>
<span class="w">     </span><span class="n">a</span><span class="o">.</span><span class="w"> </span><span class="err">루프</span><span class="w"> </span><span class="err">회전</span>
<span class="w">     </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="n">LICM</span><span class="w"> </span><span class="p">(</span><span class="err">루프</span><span class="w"> </span><span class="err">불변</span><span class="w"> </span><span class="err">코드</span><span class="w"> </span><span class="err">이동</span><span class="p">,</span><span class="w"> </span><span class="n">Loop</span><span class="o">-</span><span class="n">Invariant</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="n">Motion</span><span class="p">)</span>
<span class="w">     </span><span class="n">c</span><span class="o">.</span><span class="w"> </span><span class="err">귀납</span><span class="w"> </span><span class="err">변수</span><span class="w"> </span><span class="err">단순화</span>
<span class="w">     </span><span class="n">d</span><span class="o">.</span><span class="w"> </span><span class="err">루프</span><span class="w"> </span><span class="err">언롤링</span>
<span class="w">  </span><span class="mf">9.</span><span class="w"> </span><span class="n">GVN</span><span class="w"> </span><span class="p">(</span><span class="err">전역</span><span class="w"> </span><span class="err">값</span><span class="w"> </span><span class="err">번호</span><span class="w"> </span><span class="err">매기기</span><span class="p">,</span><span class="w"> </span><span class="n">Global</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="n">Numbering</span><span class="p">)</span>
<span class="w">  </span><span class="mf">10.</span><span class="w"> </span><span class="err">데드</span><span class="w"> </span><span class="err">코드</span><span class="w"> </span><span class="err">제거</span>
<span class="w">  </span><span class="mf">11.</span><span class="w"> </span><span class="n">CFG</span><span class="w"> </span><span class="err">단순화</span>
<span class="w">  </span><span class="mf">12.</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">(</span><span class="err">추가</span><span class="w"> </span><span class="err">패스</span><span class="p">)</span>
</code></pre></div>

<h3 id="33-python-llvm">3.3 Python으로 LLVM 패스 시뮬레이션<a class="header-link" href="#33-python-llvm" title="Permanent link">&para;</a></h3>
<p>실제 LLVM 패스 작성은 C++이 필요하므로, Python으로 개념을 시뮬레이션할 수 있습니다:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LLVMIRSimulator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate LLVM IR and optimization passes in Python.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">blocks</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a function with basic blocks.</span>
<span class="sd">        blocks: dict of block_name -&gt; list of instructions</span>
<span class="sd">        Each instruction: (result, opcode, operands...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">blocks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print IR in LLVM-like format.&quot;&quot;&quot;</span>
        <span class="n">funcs</span> <span class="o">=</span> <span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">func_name</span><span class="p">]}</span> <span class="k">if</span> <span class="n">func_name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">blocks</span> <span class="ow">in</span> <span class="n">funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;define @</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">() </span><span class="se">{{</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">block_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ret&#39;</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ret </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;br&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  br label %</span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  br i1 </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">, label %</span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">, label %</span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;phi&#39;</span><span class="p">:</span>
                        <span class="n">pairs</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">, %</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> ]&quot;</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = phi </span><span class="si">{</span><span class="n">pairs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ops</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">ops</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">OptimizationPass</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for optimization passes.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changes</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_on_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">blocks</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override this to implement the pass. Returns modified blocks.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">blocks</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Pass(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, changes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">changes</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ConstantFoldingPass</span><span class="p">(</span><span class="n">OptimizationPass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constant folding: evaluate operations on constants at compile time.</span>

<span class="sd">    Example: %x = add 3, 4  --&gt;  %x = 7</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Constant Folding&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_on_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">blocks</span><span class="p">):</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;add&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;sub&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span>
            <span class="s1">&#39;mul&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">new_blocks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_instructions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ops</span> <span class="ow">and</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">instr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">ops</span><span class="p">[</span><span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]](</span><span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">instr</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="c1"># Replace with constant</span>
                    <span class="n">new_instructions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">instr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">changes</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [ConstFold] </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">, &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>
            <span class="n">new_blocks</span><span class="p">[</span><span class="n">block_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_instructions</span>

        <span class="k">return</span> <span class="n">new_blocks</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DeadCodeEliminationPass</span><span class="p">(</span><span class="n">OptimizationPass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dead code elimination: remove instructions whose results are never used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Dead Code Elimination&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_on_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">blocks</span><span class="p">):</span>
        <span class="c1"># Collect all used values</span>
        <span class="n">used_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
                <span class="c1"># All operands (positions 2+) that are string references</span>
                <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">operand</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">):</span>
                        <span class="n">used_values</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">operand</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">):</span>
                                        <span class="n">used_values</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

        <span class="c1"># Remove instructions whose results are not used</span>
        <span class="n">new_blocks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_instructions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Keep terminators and side-effecting instructions</span>
                <span class="k">if</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ret&#39;</span><span class="p">,</span> <span class="s1">&#39;br&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">):</span>
                    <span class="n">new_instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">used_values</span> <span class="ow">or</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">new_instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">changes</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [DCE] Removed: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> ...&quot;</span><span class="p">)</span>
            <span class="n">new_blocks</span><span class="p">[</span><span class="n">block_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_instructions</span>

        <span class="k">return</span> <span class="n">new_blocks</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ConstantPropagationPass</span><span class="p">(</span><span class="n">OptimizationPass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constant propagation: replace uses of variables known to be constant.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Constant Propagation&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_on_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">blocks</span><span class="p">):</span>
        <span class="c1"># Find all constant definitions</span>
        <span class="n">constants</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;const&#39;</span><span class="p">:</span>
                    <span class="n">constants</span><span class="p">[</span><span class="n">instr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">instr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">constants</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">blocks</span>

        <span class="c1"># Replace uses of constants</span>
        <span class="n">new_blocks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">block_name</span><span class="p">,</span> <span class="n">instructions</span> <span class="ow">in</span> <span class="n">blocks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_instructions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">instr</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
                <span class="n">new_instr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">instr</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_instr</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_instr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_instr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">constants</span><span class="p">:</span>
                        <span class="n">old_val</span> <span class="o">=</span> <span class="n">new_instr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">new_instr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="p">[</span><span class="n">old_val</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">changes</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [ConstProp] </span><span class="si">{</span><span class="n">old_val</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">constants</span><span class="p">[</span><span class="n">old_val</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">new_instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">new_instr</span><span class="p">))</span>
            <span class="n">new_blocks</span><span class="p">[</span><span class="n">block_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_instructions</span>

        <span class="k">return</span> <span class="n">new_blocks</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_pass_pipeline</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate an optimization pass pipeline.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== LLVM-style Pass Pipeline ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">ir</span> <span class="o">=</span> <span class="n">LLVMIRSimulator</span><span class="p">()</span>

    <span class="c1"># Function with optimization opportunities</span>
    <span class="n">ir</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="s1">&#39;compute&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;entry&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">,</span> <span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;</span><span class="si">%c</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;%b&#39;</span><span class="p">),</span>       <span class="c1"># Can be constant folded (after prop)</span>
            <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;mul&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>              <span class="c1"># Can be constant folded</span>
            <span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%c</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>        <span class="c1"># Can be constant folded</span>
            <span class="p">(</span><span class="s1">&#39;</span><span class="si">%u</span><span class="s1">nused&#39;</span><span class="p">,</span> <span class="s1">&#39;mul&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;%b&#39;</span><span class="p">),</span>   <span class="c1"># Dead code</span>
            <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ret&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%e</span><span class="s1">&#39;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before optimization:&quot;</span><span class="p">)</span>
    <span class="n">ir</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;compute&#39;</span><span class="p">)</span>

    <span class="c1"># Run passes</span>
    <span class="n">passes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ConstantFoldingPass</span><span class="p">(),</span>
        <span class="n">ConstantPropagationPass</span><span class="p">(),</span>
        <span class="n">ConstantFoldingPass</span><span class="p">(),</span>      <span class="c1"># Run again after propagation</span>
        <span class="n">DeadCodeEliminationPass</span><span class="p">(),</span>
    <span class="p">]</span>

    <span class="n">blocks</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s1">&#39;compute&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">passes</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Running </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">run_on_function</span><span class="p">(</span><span class="s1">&#39;compute&#39;</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span>

    <span class="n">ir</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s1">&#39;compute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blocks</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">After optimization:&quot;</span><span class="p">)</span>
    <span class="n">ir</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;compute&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pass summary:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">passes</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_pass_pipeline</span><span class="p">()</span>
</code></pre></div>

<h3 id="34-llvm-c">3.4 실제 LLVM 패스 예제 (C++ 스케치)<a class="header-link" href="#34-llvm-c" title="Permanent link">&para;</a></h3>
<p>참고용으로, 실제 LLVM 패스가 C++에서 어떻게 생겼는지 보여줍니다 (새 패스 매니저, LLVM 14+):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// MyPass.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;llvm/IR/PassManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;llvm/IR/Function.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;llvm/Support/raw_ostream.h&quot;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">MyCountPass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">PassInfoMixin</span><span class="o">&lt;</span><span class="n">MyCountPass</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">llvm</span><span class="o">::</span><span class="n">PreservedAnalyses</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">llvm</span><span class="o">::</span><span class="n">Function</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">llvm</span><span class="o">::</span><span class="n">FunctionAnalysisManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">AM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">BB</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">BB</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">llvm</span><span class="o">::</span><span class="n">errs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Function &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span>
<span class="w">                      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; has &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; instructions</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">llvm</span><span class="o">::</span><span class="n">PreservedAnalyses</span><span class="o">::</span><span class="n">all</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Register the pass</span>
<span class="c1">// In a plugin:</span>
<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">LLVM_ATTRIBUTE_WEAK</span><span class="w"> </span><span class="o">::</span><span class="n">llvm</span><span class="o">::</span><span class="n">PassPluginLibraryInfo</span>
<span class="n">llvmGetPassPluginInfo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">LLVM_PLUGIN_API_VERSION</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MyPass&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LLVM_VERSION_STRING</span><span class="p">,</span>
<span class="w">            </span><span class="p">[](</span><span class="n">PassBuilder</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">PB</span><span class="p">.</span><span class="n">registerPipelineParsingCallback</span><span class="p">(</span>
<span class="w">                    </span><span class="p">[](</span><span class="n">StringRef</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">FunctionPassManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FPM</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;my-count-pass&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">FPM</span><span class="p">.</span><span class="n">addPass</span><span class="p">(</span><span class="n">MyCountPass</span><span class="p">());</span>
<span class="w">                            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                    </span><span class="p">});</span>
<span class="w">            </span><span class="p">}};</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="4-mlir-ir">4. MLIR: 다중 레벨 IR<a class="header-link" href="#4-mlir-ir" title="Permanent link">&para;</a></h2>
<h3 id="41-mlir">4.1 MLIR이 해결하는 문제<a class="header-link" href="#41-mlir" title="Permanent link">&para;</a></h3>
<p>서로 다른 도메인은 서로 다른 수준의 추상화가 필요합니다:</p>
<div class="highlight"><pre><span></span><code><span class="err">고수준</span><span class="o">:</span><span class="w">    </span><span class="n">TensorFlow</span><span class="w"> </span><span class="err">그래프</span><span class="w"> </span><span class="err">연산</span><span class="w"> </span><span class="o">(</span><span class="n">matmul</span><span class="o">,</span><span class="w"> </span><span class="n">conv2d</span><span class="o">,</span><span class="w"> </span><span class="o">...)</span>
<span class="w">               </span><span class="err">↓</span>
<span class="err">중간</span><span class="w"> </span><span class="err">수준</span><span class="o">:</span><span class="w"> </span><span class="err">어파인</span><span class="w"> </span><span class="err">루프</span><span class="o">(</span><span class="n">Affine</span><span class="w"> </span><span class="n">loop</span><span class="o">),</span><span class="w"> </span><span class="err">텐서</span><span class="w"> </span><span class="err">연산</span>
<span class="w">               </span><span class="err">↓</span>
<span class="err">저수준</span><span class="o">:</span><span class="w">    </span><span class="n">LLVM</span><span class="w"> </span><span class="n">IR</span><span class="w"> </span><span class="o">(</span><span class="err">스칼라</span><span class="w"> </span><span class="err">연산</span><span class="o">,</span><span class="w"> </span><span class="err">메모리</span><span class="w"> </span><span class="err">로드</span><span class="o">/</span><span class="err">스토어</span><span class="o">)</span>
<span class="w">               </span><span class="err">↓</span>
<span class="err">기계</span><span class="w"> </span><span class="err">수준</span><span class="o">:</span><span class="w"> </span><span class="err">타겟별</span><span class="w"> </span><span class="err">기계어</span><span class="w"> </span><span class="err">명령어</span>
</code></pre></div>

<p>전통적으로 각 수준은 자체 최적화 프레임워크를 가진 자체 IR을 사용합니다. MLIR은 여러 수준을 위한 <strong>단일하고 확장 가능한 프레임워크</strong>를 제공합니다.</p>
<h3 id="42-mlir">4.2 MLIR 개념<a class="header-link" href="#42-mlir" title="Permanent link">&para;</a></h3>
<p><strong>다이얼렉트(Dialect)</strong>: MLIR은 연산을 다이얼렉트로 구성합니다 -- 네임스페이스로 묶인 연산, 타입, 속성의 모음입니다.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Affine dialect (structured loops and memory access)</span>
<span class="n">func</span><span class="p">.</span><span class="n">func</span><span class="w"> </span><span class="err">@</span><span class="n">matmul</span><span class="p">(</span><span class="o">%</span><span class="n">A</span><span class="o">:</span><span class="w"> </span><span class="n">memref</span><span class="o">&lt;</span><span class="mi">256</span><span class="n">x256xf32</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">B</span><span class="o">:</span><span class="w"> </span><span class="n">memref</span><span class="o">&lt;</span><span class="mi">256</span><span class="n">x256xf32</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                    </span><span class="o">%</span><span class="n">C</span><span class="o">:</span><span class="w"> </span><span class="n">memref</span><span class="o">&lt;</span><span class="mi">256</span><span class="n">x256xf32</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">affine</span><span class="p">.</span><span class="k">for</span><span class="w"> </span><span class="nf">%i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">affine</span><span class="p">.</span><span class="k">for</span><span class="w"> </span><span class="nf">%j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">affine</span><span class="p">.</span><span class="k">for</span><span class="w"> </span><span class="nf">%k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">%a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">affine</span><span class="p">.</span><span class="n">load</span><span class="w"> </span><span class="o">%</span><span class="n">A</span><span class="p">[</span><span class="nf">%i</span><span class="p">,</span><span class="w"> </span><span class="nf">%k</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">memref</span><span class="o">&lt;</span><span class="mi">256</span><span class="n">x256xf32</span><span class="o">&gt;</span>
<span class="w">        </span><span class="nf">%b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">affine</span><span class="p">.</span><span class="n">load</span><span class="w"> </span><span class="o">%</span><span class="n">B</span><span class="p">[</span><span class="nf">%k</span><span class="p">,</span><span class="w"> </span><span class="nf">%j</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">memref</span><span class="o">&lt;</span><span class="mi">256</span><span class="n">x256xf32</span><span class="o">&gt;</span>
<span class="w">        </span><span class="nf">%c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">affine</span><span class="p">.</span><span class="n">load</span><span class="w"> </span><span class="o">%</span><span class="n">C</span><span class="p">[</span><span class="nf">%i</span><span class="p">,</span><span class="w"> </span><span class="nf">%j</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">memref</span><span class="o">&lt;</span><span class="mi">256</span><span class="n">x256xf32</span><span class="o">&gt;</span>
<span class="w">        </span><span class="nf">%prod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arith</span><span class="p">.</span><span class="n">mulf</span><span class="w"> </span><span class="nf">%a</span><span class="p">,</span><span class="w"> </span><span class="nf">%b</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">f32</span>
<span class="w">        </span><span class="nf">%sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arith</span><span class="p">.</span><span class="n">addf</span><span class="w"> </span><span class="nf">%c</span><span class="p">,</span><span class="w"> </span><span class="nf">%prod</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">f32</span>
<span class="w">        </span><span class="n">affine</span><span class="p">.</span><span class="n">store</span><span class="w"> </span><span class="nf">%sum</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">C</span><span class="p">[</span><span class="nf">%i</span><span class="p">,</span><span class="w"> </span><span class="nf">%j</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">memref</span><span class="o">&lt;</span><span class="mi">256</span><span class="n">x256xf32</span><span class="o">&gt;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="43-mlir">4.3 주요 MLIR 다이얼렉트<a class="header-link" href="#43-mlir" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>다이얼렉트</th>
<th>목적</th>
<th>수준</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>func</code></td>
<td>함수, 호출</td>
<td>고수준</td>
</tr>
<tr>
<td><code>arith</code></td>
<td>산술 연산</td>
<td>중간</td>
</tr>
<tr>
<td><code>affine</code></td>
<td>어파인 루프와 메모리</td>
<td>중간</td>
</tr>
<tr>
<td><code>linalg</code></td>
<td>선형 대수 연산</td>
<td>중간-고수준</td>
</tr>
<tr>
<td><code>tensor</code></td>
<td>텐서 타입과 연산</td>
<td>중간-고수준</td>
</tr>
<tr>
<td><code>memref</code></td>
<td>메모리 참조</td>
<td>중간-저수준</td>
</tr>
<tr>
<td><code>scf</code></td>
<td>구조적 제어 흐름 (for, if, while)</td>
<td>중간</td>
</tr>
<tr>
<td><code>cf</code></td>
<td>비구조적 제어 흐름 (branch, switch)</td>
<td>저수준</td>
</tr>
<tr>
<td><code>llvm</code></td>
<td>LLVM IR 연산</td>
<td>저수준</td>
</tr>
<tr>
<td><code>gpu</code></td>
<td>GPU 연산</td>
<td>타겟 특화</td>
</tr>
</tbody>
</table>
<h3 id="44-progressive-lowering">4.4 점진적 하강(Progressive Lowering)<a class="header-link" href="#44-progressive-lowering" title="Permanent link">&para;</a></h3>
<p>MLIR의 핵심 혁신: <strong>점진적 하강</strong>은 일련의 다이얼렉트 변환을 통해 고수준 연산을 저수준 연산으로 변환합니다.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_progressive_lowering</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate MLIR-style progressive lowering.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Progressive Lowering ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;TensorFlow Dialect&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  </span><span class="si">%r</span><span class="s1">esult = tf.MatMul(%A, %B) : tensor&lt;256x256xf32&gt;</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;High-level: single operation for matrix multiply&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Linalg Dialect&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  linalg.matmul</span>
<span class="s1">    ins(%A, %B : tensor&lt;256x256xf32&gt;, tensor&lt;256x256xf32&gt;)</span>
<span class="s1">    outs(%C : tensor&lt;256x256xf32&gt;) -&gt; tensor&lt;256x256xf32&gt;</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Mid-high: generic linear algebra operation&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Affine Dialect&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  affine.for </span><span class="si">%i</span><span class="s1"> = 0 to 256 {</span>
<span class="s1">    affine.for %j = 0 to 256 {</span>
<span class="s1">      affine.for %k = 0 to 256 {</span>
<span class="s1">        </span><span class="si">%a</span><span class="s1"> = affine.load %A[</span><span class="si">%i</span><span class="s1">, %k]</span>
<span class="s1">        %b = affine.load %B[%k, %j]</span>
<span class="s1">        %prod = arith.mulf </span><span class="si">%a</span><span class="s1">, %b</span>
<span class="s1">        </span><span class="si">%c</span><span class="s1"> = affine.load %C[</span><span class="si">%i</span><span class="s1">, %j]</span>
<span class="s1">        </span><span class="si">%s</span><span class="s1">um = arith.addf </span><span class="si">%c</span><span class="s1">, %prod</span>
<span class="s1">        affine.store </span><span class="si">%s</span><span class="s1">um, %C[</span><span class="si">%i</span><span class="s1">, %j]</span>
<span class="s1">      }</span>
<span class="s1">    }</span>
<span class="s1">  }</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Mid: explicit loops with affine analysis&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;SCF + MemRef Dialect&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  scf.for </span><span class="si">%i</span><span class="s1"> = 0 to 256 step 1 {</span>
<span class="s1">    scf.for %j = 0 to 256 step 1 {</span>
<span class="s1">      scf.for %k = 0 to 256 step 1 {</span>
<span class="s1">        </span><span class="si">%a</span><span class="s1">ddr_a = memref.load %A[</span><span class="si">%i</span><span class="s1">, %k]</span>
<span class="s1">        </span><span class="si">%a</span><span class="s1">ddr_b = memref.load %B[%k, %j]</span>
<span class="s1">        %prod = arith.mulf </span><span class="si">%a</span><span class="s1">ddr_a, </span><span class="si">%a</span><span class="s1">ddr_b</span>
<span class="s1">        ...</span>
<span class="s1">      }</span>
<span class="s1">    }</span>
<span class="s1">  }</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Mid-low: structured loops with explicit memory&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;LLVM Dialect&#39;</span><span class="p">,</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  llvm.br ^loop_header</span>
<span class="s1">  ^loop_header:</span>
<span class="s1">    </span><span class="si">%i</span><span class="s1"> = llvm.phi [%zero, ^entry], [%next_i, ^loop_latch]</span>
<span class="s1">    </span><span class="si">%c</span><span class="s1">mp = llvm.icmp &quot;slt&quot; </span><span class="si">%i</span><span class="s1">, %n</span>
<span class="s1">    llvm.cond_br </span><span class="si">%c</span><span class="s1">mp, ^loop_body, ^loop_exit</span>
<span class="s1">  ^loop_body:</span>
<span class="s1">    </span><span class="si">%a</span><span class="s1">ddr = llvm.getelementptr %base[</span><span class="si">%i</span><span class="s1">]</span>
<span class="s1">    %val = llvm.load </span><span class="si">%a</span><span class="s1">ddr</span>
<span class="s1">    ...</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Low: maps directly to LLVM IR&#39;</span>
        <span class="p">},</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Level </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">level</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (</span><span class="si">{</span><span class="n">level</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">40</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ↓  Lowering pass&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="s1">&#39;─&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">40</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_progressive_lowering</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="5-gcc">5. GCC 내부<a class="header-link" href="#5-gcc" title="Permanent link">&para;</a></h2>
<h3 id="51-gcc">5.1 GCC 아키텍처<a class="header-link" href="#51-gcc" title="Permanent link">&para;</a></h3>
<p>GCC(GNU 컴파일러 모음)는 LLVM과 다른 내부 아키텍처를 사용합니다:</p>
<div class="highlight"><pre><span></span><code>GCC 컴파일 파이프라인:
┌─────────────────────────────────────────────────────────────┐
│                         GCC                                  │
│                                                              │
│  소스 ──▶ 프론트엔드 ──▶ GENERIC ──▶ GIMPLE ──▶ SSA GIMPLE   │
│           (파서)       (언어별     (단순화된   (파이 노드가  │
│                         특화 AST)  3주소코드)  있는 SSA)     │
│                                                              │
│  SSA GIMPLE ──▶ Tree SSA 최적화 ──▶ 최적화된 GIMPLE          │
│                 (SRA, DCE, PRE, SCCP,                        │
│                  루프 최적화, 벡터화)                         │
│                                                              │
│  최적화된 GIMPLE ──▶ RTL ──▶ RTL 최적화 ──▶ 어셈블리         │
│                       (레지스터 전송       (레지스터 할당,   │
│                        언어)               명령어            │
│                                            스케줄링)         │
└─────────────────────────────────────────────────────────────┘
</code></pre></div>

<h3 id="52-gimple">5.2 GIMPLE<a class="header-link" href="#52-gimple" title="Permanent link">&para;</a></h3>
<p>GIMPLE은 GCC의 고수준 중간 표현입니다. AST의 단순화된 3주소 형식입니다.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Source C code:</span>
<span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// GIMPLE representation:</span>
<span class="n">sum_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">i_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">goto</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bb</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="p">;</span>

<span class="o">&lt;</span><span class="n">bb</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;:</span>
<span class="n">_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="n">i_2</span><span class="p">];</span>
<span class="n">_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="n">sum_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_4</span><span class="p">;</span>
<span class="n">i_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="o">&lt;</span><span class="n">bb</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;:</span>
<span class="cp"># sum_1 = PHI &lt;sum_5(bb2), 0(bb1)&gt;</span>
<span class="cp"># i_2 = PHI &lt;i_6(bb2), 0(bb1)&gt;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_7</span><span class="p">)</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bb</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">else</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bb</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="p">;</span>

<span class="o">&lt;</span><span class="n">bb</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;:</span>
<span class="k">return</span><span class="w"> </span><span class="n">sum_1</span><span class="p">;</span>
</code></pre></div>

<h3 id="53-rtl">5.3 RTL (레지스터 전송 언어)<a class="header-link" href="#53-rtl" title="Permanent link">&para;</a></h3>
<p>RTL은 기계어 명령어에 가까운 GCC의 저수준 IR입니다:</p>
<div class="highlight"><pre><span></span><code><span class="p">;;</span><span class="w"> </span><span class="n">RTL</span><span class="w"> </span><span class="k">for</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="p">(</span><span class="n">set</span><span class="w"> </span><span class="p">(</span><span class="n">reg</span><span class="p">:</span><span class="n">SI</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">     </span><span class="p">(</span><span class="n">plus</span><span class="p">:</span><span class="n">SI</span><span class="w"> </span><span class="p">(</span><span class="n">reg</span><span class="p">:</span><span class="n">SI</span><span class="w"> </span><span class="mi">101</span><span class="p">)</span>
<span class="w">              </span><span class="p">(</span><span class="n">reg</span><span class="p">:</span><span class="n">SI</span><span class="w"> </span><span class="mi">102</span><span class="p">)))</span>

<span class="p">;;</span><span class="w"> </span><span class="n">RTL</span><span class="w"> </span><span class="k">for</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">goto</span><span class="w"> </span><span class="n">L1</span>
<span class="p">(</span><span class="n">set</span><span class="w"> </span><span class="p">(</span><span class="n">reg</span><span class="p">:</span><span class="n">CC</span><span class="w"> </span><span class="mi">17</span><span class="p">)</span>
<span class="w">     </span><span class="p">(</span><span class="n">compare</span><span class="p">:</span><span class="n">CC</span><span class="w"> </span><span class="p">(</span><span class="n">reg</span><span class="p">:</span><span class="n">SI</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">                 </span><span class="p">(</span><span class="n">const_int</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>
<span class="p">(</span><span class="n">set</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
<span class="w">     </span><span class="p">(</span><span class="n">if_then_else</span><span class="w"> </span><span class="p">(</span><span class="n">lt</span><span class="w"> </span><span class="p">(</span><span class="n">reg</span><span class="p">:</span><span class="n">CC</span><span class="w"> </span><span class="mi">17</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">const_int</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">                   </span><span class="p">(</span><span class="n">label_ref</span><span class="w"> </span><span class="n">L1</span><span class="p">)</span>
<span class="w">                   </span><span class="p">(</span><span class="n">pc</span><span class="p">)))</span>
</code></pre></div>

<h3 id="54-llvm-gcc">5.4 LLVM 대 GCC 비교<a class="header-link" href="#54-llvm-gcc" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">llvm_vs_gcc_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare LLVM and GCC architectures.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== LLVM vs GCC ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">comparison</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;Architecture&#39;</span><span class="p">,</span> <span class="s1">&#39;Modular library&#39;</span><span class="p">,</span> <span class="s1">&#39;Monolithic compiler&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;License&#39;</span><span class="p">,</span> <span class="s1">&#39;Apache 2.0&#39;</span><span class="p">,</span> <span class="s1">&#39;GPL v3&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;High-level IR&#39;</span><span class="p">,</span> <span class="s1">&#39;LLVM IR (one level)&#39;</span><span class="p">,</span> <span class="s1">&#39;GENERIC -&gt; GIMPLE (two levels)&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Low-level IR&#39;</span><span class="p">,</span> <span class="s1">&#39;SelectionDAG -&gt; MachineIR&#39;</span><span class="p">,</span> <span class="s1">&#39;RTL&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;SSA form&#39;</span><span class="p">,</span> <span class="s1">&#39;Core IR is SSA&#39;</span><span class="p">,</span> <span class="s1">&#39;GIMPLE SSA (separate phase)&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Reusability&#39;</span><span class="p">,</span> <span class="s1">&#39;Library-based (easy to embed)&#39;</span><span class="p">,</span> <span class="s1">&#39;Hard to use as library&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Frontend API&#39;</span><span class="p">,</span> <span class="s1">&#39;Clean C++ API&#39;</span><span class="p">,</span> <span class="s1">&#39;Plugin API (limited)&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Targets&#39;</span><span class="p">,</span> <span class="s1">&#39;~20 targets&#39;</span><span class="p">,</span> <span class="s1">&#39;~50+ targets&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Diagnostics&#39;</span><span class="p">,</span> <span class="s1">&#39;Excellent (Clang)&#39;</span><span class="p">,</span> <span class="s1">&#39;Good (improved recently)&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;LTO&#39;</span><span class="p">,</span> <span class="s1">&#39;ThinLTO + Full LTO&#39;</span><span class="p">,</span> <span class="s1">&#39;Full LTO&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Build speed&#39;</span><span class="p">,</span> <span class="s1">&#39;Fast (Clang)&#39;</span><span class="p">,</span> <span class="s1">&#39;Moderate&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Optimization&#39;</span><span class="p">,</span> <span class="s1">&#39;Strong, especially SIMD&#39;</span><span class="p">,</span> <span class="s1">&#39;Strong, wider target support&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Aspect&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;LLVM&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;GCC&#39;</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">llvm</span><span class="p">,</span> <span class="n">gcc</span> <span class="ow">in</span> <span class="n">comparison</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">llvm</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">gcc</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">llvm_vs_gcc_comparison</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="6">6. 도메인 특화 언어<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="61-dsl">6.1 DSL이란?<a class="header-link" href="#61-dsl" title="Permanent link">&para;</a></h3>
<p><strong>도메인 특화 언어(Domain-Specific Language, DSL)</strong>는 특정 문제 영역에 맞춤화된 프로그래밍 언어입니다. 범용 언어(GPL)와 달리, DSL은 일반성을 포기하는 대신 해당 도메인에서의 표현력과 사용 편의성을 얻습니다.</p>
<table>
<thead>
<tr>
<th>종류</th>
<th>설명</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>외부 DSL</strong></td>
<td>자체 파서를 가진 별도 언어</td>
<td>SQL, HTML, CSS, 정규식, Makefile</td>
</tr>
<tr>
<td><strong>내부/임베디드 DSL</strong></td>
<td>GPL 내에서 호스팅됨</td>
<td>SQLAlchemy (Python), Kotlin DSL, Scala implicits</td>
</tr>
</tbody>
</table>
<h3 id="62-dsl">6.2 DSL 설계 원칙<a class="header-link" href="#62-dsl" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>도메인 집중</strong>: 프로그래밍 개념이 아닌 도메인 개념을 직접 표현</li>
<li><strong>추상화</strong>: 무관한 세부 사항 숨기기</li>
<li><strong>표기법</strong>: 도메인 전문가의 표기법에 맞추기</li>
<li><strong>안전성</strong>: 도메인에서 의미 없는 오류 방지</li>
<li><strong>구성</strong>: DSL 요소들을 자연스럽게 결합 가능하도록</li>
</ol>
<h3 id="63-dsl">6.3 외부 DSL 구축<a class="header-link" href="#63-dsl" title="Permanent link">&para;</a></h3>
<p>데이터 처리 파이프라인을 정의하는 간단한 DSL을 만들어 봅니다:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Any</span>


<span class="c1"># --- AST Nodes ---</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PipelineAST</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">stages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s1">&#39;StageAST&#39;</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StageAST</span><span class="p">:</span>
    <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FilterAST</span><span class="p">(</span><span class="n">StageAST</span><span class="p">):</span>
    <span class="n">condition</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TransformAST</span><span class="p">(</span><span class="n">StageAST</span><span class="p">):</span>
    <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AggregateAST</span><span class="p">(</span><span class="n">StageAST</span><span class="p">):</span>
    <span class="n">function</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">column</span><span class="p">:</span> <span class="nb">str</span>


<span class="c1"># --- Parser ---</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PipelineDSLParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parser for a simple data pipeline DSL.</span>

<span class="sd">    Syntax:</span>
<span class="sd">        pipeline &quot;name&quot; {</span>
<span class="sd">            read csv &quot;data.csv&quot;</span>
<span class="sd">            filter where age &gt; 18</span>
<span class="sd">            transform salary * 1.1 as adjusted_salary</span>
<span class="sd">            group by department</span>
<span class="sd">            aggregate sum(salary) as total_salary</span>
<span class="sd">            write csv &quot;output.csv&quot;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                      <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PipelineAST</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the entire DSL source.&quot;&quot;&quot;</span>
        <span class="c1"># Parse pipeline header</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;pipeline\s+&quot;([^&quot;]+)&quot;\s*\{&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected &#39;pipeline </span><span class="se">\&quot;</span><span class="s2">name</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">{{</span><span class="s2">&#39;, got: </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Parse stages</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;}&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_stage</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">PipelineAST</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">stages</span><span class="o">=</span><span class="n">stages</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StageAST</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single pipeline stage.&quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;read&#39;</span><span class="p">:</span>
            <span class="n">fmt_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\w+)\s+&quot;([^&quot;]+)&quot;&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fmt_match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">StageAST</span><span class="p">(</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span>
                    <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">fmt_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                               <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">fmt_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FilterAST</span><span class="p">(</span>
                <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span>
                <span class="n">arguments</span><span class="o">=</span><span class="p">{},</span>
                <span class="n">condition</span><span class="o">=</span><span class="n">rest</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;where &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;transform&#39;</span><span class="p">:</span>
            <span class="c1"># Parse &quot;expression as new_name&quot;</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(.+)\s+as\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">TransformAST</span><span class="p">(</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span>
                    <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;new_column&#39;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
                    <span class="n">expression</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">StageAST</span><span class="p">(</span>
                <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span>
                <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;by&#39;</span><span class="p">:</span> <span class="n">rest</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;by &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)}</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;aggregate&#39;</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\w+)\((\w+)\)\s+as\s+(\w+)&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">AggregateAST</span><span class="p">(</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;aggregate&#39;</span><span class="p">,</span>
                    <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;as&#39;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
                    <span class="n">function</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">column</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;write&#39;</span><span class="p">:</span>
            <span class="n">fmt_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\w+)\s+&quot;([^&quot;]+)&quot;&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fmt_match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">StageAST</span><span class="p">(</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;write&#39;</span><span class="p">,</span>
                    <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">fmt_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                               <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">fmt_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">StageAST</span><span class="p">(</span><span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="n">rest</span><span class="p">})</span>


<span class="c1"># --- Code Generator ---</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PythonCodeGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate Python code from the pipeline AST.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">:</span> <span class="n">PipelineAST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;# Generated pipeline: </span><span class="si">{</span><span class="n">pipeline</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;import pandas as pd&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">stages</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">stage</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;read&#39;</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;df = pd.read_csv(&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">stage</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;df = df[df.eval(&#39;</span><span class="si">{</span><span class="n">stage</span><span class="o">.</span><span class="n">condition</span><span class="si">}</span><span class="s2">&#39;)]&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">stage</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;transform&#39;</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;new_column&#39;</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;df[&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;] = df.eval(&#39;</span><span class="si">{</span><span class="n">stage</span><span class="o">.</span><span class="n">expression</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">stage</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;by&#39;</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;df = df.groupby(&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">stage</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;aggregate&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">function</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">column</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;as&#39;</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;df = df.agg(</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;: &#39;</span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">}}</span><span class="s2">)&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;.rename(columns=</span><span class="se">{{</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39;: &#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">}}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">stage</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;write&#39;</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;df.to_csv(&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;, index=False)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_dsl</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate the pipeline DSL.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Data Pipeline DSL ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">dsl_source</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">pipeline &quot;employee_analysis&quot; {</span>
<span class="s1">    read csv &quot;employees.csv&quot;</span>
<span class="s1">    filter where age &gt; 25</span>
<span class="s1">    transform salary * 1.1 as adjusted_salary</span>
<span class="s1">    group by department</span>
<span class="s1">    aggregate sum(adjusted_salary) as total_adjusted</span>
<span class="s1">    write csv &quot;department_totals.csv&quot;</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DSL Source:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dsl_source</span><span class="p">)</span>

    <span class="c1"># Parse</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">PipelineDSLParser</span><span class="p">(</span><span class="n">dsl_source</span><span class="p">)</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parsed AST:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Pipeline: </span><span class="si">{</span><span class="n">ast</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">stages</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Stage: </span><span class="si">{</span><span class="n">stage</span><span class="o">.</span><span class="n">operation</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">stage</span><span class="o">.</span><span class="n">arguments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate Python code</span>
    <span class="n">generator</span> <span class="o">=</span> <span class="n">PythonCodeGenerator</span><span class="p">()</span>
    <span class="n">python_code</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generated Python Code:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">python_code</span><span class="p">)</span>

<span class="n">demonstrate_dsl</span><span class="p">()</span>
</code></pre></div>

<h3 id="64-dsl">6.4 임베디드 DSL<a class="header-link" href="#64-dsl" title="Permanent link">&para;</a></h3>
<p><strong>임베디드 DSL(EDSL)</strong>은 호스트 언어의 문법을 사용하여 도메인 특화적인 느낌을 만들어냅니다:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QueryBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Embedded DSL for building SQL queries in Python.</span>
<span class="sd">    Uses method chaining (fluent interface) for a DSL-like feel.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_from_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_where_clauses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order_by</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joins</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">columns</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>  <span class="c1"># Enable chaining</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">from_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_from_table</span> <span class="o">=</span> <span class="n">table</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_where_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">and_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JOIN </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> ON </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">left_join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LEFT JOIN </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> ON </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">order_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order_by</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the SQL string.&quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_from_table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_joins</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_where_clauses</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="s1">&#39; AND &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_where_clauses</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_by</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ORDER BY </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_order_by</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LIMIT </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_embedded_dsl</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate the embedded SQL DSL.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Embedded SQL DSL ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">QueryBuilder</span><span class="p">()</span>
             <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;e.name&#39;</span><span class="p">,</span> <span class="s1">&#39;e.salary&#39;</span><span class="p">,</span> <span class="s1">&#39;d.name AS department&#39;</span><span class="p">)</span>
             <span class="o">.</span><span class="n">from_table</span><span class="p">(</span><span class="s1">&#39;employees e&#39;</span><span class="p">)</span>
             <span class="o">.</span><span class="n">left_join</span><span class="p">(</span><span class="s1">&#39;departments d&#39;</span><span class="p">,</span> <span class="s1">&#39;e.dept_id = d.id&#39;</span><span class="p">)</span>
             <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;e.salary &gt; 50000&#39;</span><span class="p">)</span>
             <span class="o">.</span><span class="n">and_where</span><span class="p">(</span><span class="s1">&#39;e.active = true&#39;</span><span class="p">)</span>
             <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;e.salary&#39;</span><span class="p">,</span> <span class="s1">&#39;DESC&#39;</span><span class="p">)</span>
             <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generated SQL:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="n">demonstrate_embedded_dsl</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="7">7. 컴파일러 구성 도구<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="71-antlr">7.1 ANTLR<a class="header-link" href="#71-antlr" title="Permanent link">&para;</a></h3>
<p><strong>ANTLR</strong>(ANother Tool for Language Recognition)은 문법 명세로부터 파서를 생성하는 강력한 파서 생성기입니다.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ANTLR grammar for a simple expression language</span>
<span class="nx">grammar</span><span class="w"> </span><span class="nx">Expr</span><span class="p">;</span>

<span class="c1">// Parser rules</span>
<span class="nx">program</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">statement</span><span class="o">+</span><span class="w"> </span><span class="p">;</span>

<span class="nx">statement</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">assignment</span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nx">printStmt</span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nx">ifStmt</span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nx">whileStmt</span>
<span class="w">          </span><span class="p">;</span>

<span class="nx">assignment</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="sc">&#39;=&#39;</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"> </span><span class="p">;</span>
<span class="nx">printStmt</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">print</span><span class="sc">&#39; &#39;</span><span class="p">(</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="sc">&#39;)&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"> </span><span class="p">;</span>
<span class="nx">ifStmt</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="k">if</span><span class="sc">&#39; &#39;</span><span class="p">(</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="sc">&#39;)&#39;</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;</span><span class="k">else</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">block</span><span class="p">)?</span><span class="w"> </span><span class="p">;</span>
<span class="nx">whileStmt</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="k">while</span><span class="sc">&#39; &#39;</span><span class="p">(</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="sc">&#39;)&#39;</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="p">;</span>
<span class="nx">block</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="w"> </span><span class="nx">statement</span><span class="o">*</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="w"> </span><span class="p">;</span>

<span class="nx">expr</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;*&#39;</span><span class="o">|</span><span class="sc">&#39;/&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">expr</span><span class="w">     </span><span class="err">#</span><span class="w"> </span><span class="nx">MulDiv</span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;+&#39;</span><span class="o">|</span><span class="sc">&#39;-&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">expr</span><span class="w">     </span><span class="err">#</span><span class="w"> </span><span class="nx">AddSub</span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;&lt;&#39;</span><span class="o">|</span><span class="sc">&#39;&gt;&#39;</span><span class="o">|</span><span class="err">&#39;</span><span class="o">==</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">Compare</span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="sc">&#39;(&#39;</span><span class="w"> </span><span class="nx">expr</span><span class="w"> </span><span class="sc">&#39;)&#39;</span><span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nx">Parens</span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">ID</span><span class="w">                      </span><span class="err">#</span><span class="w"> </span><span class="nx">Identifier</span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">INT</span><span class="w">                     </span><span class="err">#</span><span class="w"> </span><span class="nx">Integer</span>
<span class="w">     </span><span class="p">;</span>

<span class="c1">// Lexer rules</span>
<span class="nx">ID</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_</span><span class="p">][</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="w"> </span><span class="p">;</span>
<span class="nx">INT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="w"> </span><span class="p">;</span>
<span class="nx">WS</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">\</span><span class="nx">t</span><span class="err">\</span><span class="nx">r</span><span class="err">\</span><span class="nx">n</span><span class="p">]</span><span class="o">+</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">skip</span><span class="w"> </span><span class="p">;</span>
<span class="nx">COMMENT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="c1">//&#39; ~[\r\n]* -&gt; skip ;</span>
</code></pre></div>

<p>ANTLR은 이 문법으로부터 렉서, 파서, 파스 트리를 생성합니다. 다양한 타겟 언어(Java, Python, C++, JavaScript, Go 등)를 지원합니다.</p>
<h3 id="72-tree-sitter">7.2 Tree-sitter<a class="header-link" href="#72-tree-sitter" title="Permanent link">&para;</a></h3>
<p><strong>Tree-sitter</strong>는 증분 파싱(Incremental Parsing)을 위해 설계된 파서 생성기입니다 -- 코드 에디터와 언어 도구에 이상적입니다.</p>
<p>주요 특징:
- <strong>증분적</strong>: 파일 편집 후, 변경된 부분만 재파싱
- <strong>오류 허용</strong>: 문법적으로 올바르지 않은 코드에서도 유효한 파스 트리 생성
- <strong>빠름</strong>: 대부분의 파일을 1밀리초 이내에 파싱
- <strong>구체적 문법 트리</strong>: 정확한 왕복 변환을 위해 모든 토큰(공백, 주석) 보존</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_tree_sitter_concept</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstrate Tree-sitter&#39;s incremental parsing concept.</span>
<span class="sd">    (Actual Tree-sitter requires C bindings; this simulates the behavior.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Tree-sitter Incremental Parsing ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">IncrementalParser</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulated incremental parser.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Full parse.&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_tree</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">new_text</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Incremental edit: only re-parse the changed region.</span>

<span class="sd">            In real Tree-sitter:</span>
<span class="sd">            1. Apply the edit to the old tree</span>
<span class="sd">            2. Re-lex only the changed region</span>
<span class="sd">            3. Re-parse only affected subtrees</span>
<span class="sd">            4. Reuse unchanged subtrees from the old tree</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">old_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">old_source</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_text</span> <span class="o">+</span> <span class="n">old_source</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>

            <span class="c1"># In reality, Tree-sitter would:</span>
            <span class="c1"># - Identify which tree nodes are invalidated</span>
            <span class="c1"># - Re-parse only those regions</span>
            <span class="c1"># - Reuse all other nodes from the old tree</span>

            <span class="n">changed_region</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_text</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Edit at [</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">] -&gt; &#39;</span><span class="si">{</span><span class="n">new_text</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Only re-parsing characters </span><span class="si">{</span><span class="n">changed_region</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Reusing tree nodes outside this range&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_build_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Simplified tree building.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;program&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">IncrementalParser</span><span class="p">()</span>

    <span class="c1"># Initial parse</span>
    <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;let x = 10;</span><span class="se">\n</span><span class="s2">let y = 20;</span><span class="se">\n</span><span class="s2">let z = x + y;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial source:</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="c1"># Edit: change &quot;10&quot; to &quot;42&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Edit: change &#39;10&#39; to &#39;42&#39;&quot;</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">edit</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;42&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  New source: </span><span class="si">{</span><span class="n">parser</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Key insight: Tree-sitter re-parses only the changed region,&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;not the entire file. For large files, this is orders of magnitude faster.&quot;</span><span class="p">)</span>

<span class="n">demonstrate_tree_sitter_concept</span><span class="p">()</span>
</code></pre></div>

<h3 id="73">7.3 도구 비교<a class="header-link" href="#73" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tool_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare parser generator tools.&quot;&quot;&quot;</span>
    <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ANTLR&#39;</span><span class="p">,</span> <span class="s1">&#39;LL(*)&#39;</span><span class="p">,</span> <span class="s1">&#39;Java,Py,C++,JS,Go&#39;</span><span class="p">,</span> <span class="s1">&#39;Full parse tree&#39;</span><span class="p">,</span> <span class="s1">&#39;Language implementation&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Tree-sitter&#39;</span><span class="p">,</span> <span class="s1">&#39;GLR&#39;</span><span class="p">,</span> <span class="s1">&#39;C (bindings)&#39;</span><span class="p">,</span> <span class="s1">&#39;Incremental CST&#39;</span><span class="p">,</span> <span class="s1">&#39;Editors, tooling&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Yacc/Bison&#39;</span><span class="p">,</span> <span class="s1">&#39;LALR(1)&#39;</span><span class="p">,</span> <span class="s1">&#39;C, C++&#39;</span><span class="p">,</span> <span class="s1">&#39;Action-based&#39;</span><span class="p">,</span> <span class="s1">&#39;Traditional compilers&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;PEG.js/Pest&#39;</span><span class="p">,</span> <span class="s1">&#39;PEG&#39;</span><span class="p">,</span> <span class="s1">&#39;JS/Rust&#39;</span><span class="p">,</span> <span class="s1">&#39;Full parse tree&#39;</span><span class="p">,</span> <span class="s1">&#39;Simple languages&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Lark&#39;</span><span class="p">,</span> <span class="s1">&#39;Earley/LALR&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="s1">&#39;Parse tree&#39;</span><span class="p">,</span> <span class="s1">&#39;Python projects&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Nom&#39;</span><span class="p">,</span> <span class="s1">&#39;Combinator&#39;</span><span class="p">,</span> <span class="s1">&#39;Rust&#39;</span><span class="p">,</span> <span class="s1">&#39;Custom&#39;</span><span class="p">,</span> <span class="s1">&#39;Binary formats, protocols&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Parser Generator Comparison ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Tool&#39;</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Algorithm&#39;</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Languages&#39;</span><span class="si">:</span><span class="s2">&lt;18</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Best For&#39;</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">algo</span><span class="p">,</span> <span class="n">langs</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">best_for</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">algo</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">langs</span><span class="si">:</span><span class="s2">&lt;18</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">best_for</span><span class="si">:</span><span class="s2">&lt;25</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">tool_comparison</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="8">8. 언어 서버 프로토콜<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="81-lsp">8.1 LSP란?<a class="header-link" href="#81-lsp" title="Permanent link">&para;</a></h3>
<p>Microsoft가 개발한 <strong>언어 서버 프로토콜(Language Server Protocol, LSP)</strong>은 코드 에디터와 언어별 도구 간의 인터페이스를 표준화합니다. LSP 이전에는 모든 에디터가 모든 언어에 대한 커스텀 플러그인이 필요했습니다(M개의 에디터 × N개의 언어 = M×N개의 구현). LSP는 이를 M + N으로 줄입니다.</p>
<div class="highlight"><pre><span></span><code>LSP 없이:                        LSP 있을 때:

  VS Code ──── C 플러그인          VS Code ──┐
  VS Code ──── Python 플러그인               │
  VS Code ──── Rust 플러그인       Vim ──────┤   LSP    ┌── C 서버
  Vim ──────── C 플러그인          Emacs ────┤ 프로토콜 ├── Python 서버
  Vim ──────── Python 플러그인     Sublime ──┘          ├── Rust 서버
  Vim ──────── Rust 플러그인                            └── ...
  Emacs ────── C 플러그인
  Emacs ────── Python 플러그인     M + N 구현
  Emacs ────── Rust 플러그인       (M <span class="gs">* N 대신)</span>
<span class="gs">  ...</span>

<span class="gs">  M *</span> N 구현
</code></pre></div>

<h3 id="82-lsp">8.2 LSP 아키텍처<a class="header-link" href="#82-lsp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>┌──────────────┐         JSON-RPC          ┌──────────────────┐
│              │ ◀─── 알림 ──────────────  │                  │
│    에디터    │ ───── 요청 ─────────────▶ │  언어 서버        │
│   (클라이언트)│ ◀─── 응답 ─────────────  │                  │
│              │                            │  - 파서          │
│  VS Code     │  textDocument/didOpen      │  - 타입 검사기   │
│  Vim         │  textDocument/completion   │  - 진단          │
│  Emacs       │  textDocument/definition   │  - 포매터        │
│  Sublime     │  textDocument/references   │  - 리팩토링      │
│              │  textDocument/hover        │                  │
└──────────────┘                            └──────────────────┘
</code></pre></div>

<h3 id="83-lsp">8.3 LSP 기능<a class="header-link" href="#83-lsp" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">lsp_capabilities</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show key LSP capabilities.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== LSP Capabilities ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/completion&#39;</span><span class="p">,</span> <span class="s1">&#39;Auto-completion suggestions&#39;</span><span class="p">,</span>
         <span class="s1">&#39;User types &quot;obj.&quot; -&gt; server suggests methods&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/hover&#39;</span><span class="p">,</span> <span class="s1">&#39;Type info and docs on hover&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Hover over function -&gt; show signature and docstring&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/definition&#39;</span><span class="p">,</span> <span class="s1">&#39;Go to definition&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Click on function call -&gt; jump to its definition&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/references&#39;</span><span class="p">,</span> <span class="s1">&#39;Find all references&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Find all places where a symbol is used&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/rename&#39;</span><span class="p">,</span> <span class="s1">&#39;Rename symbol&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Rename a variable across all files&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/diagnostics&#39;</span><span class="p">,</span> <span class="s1">&#39;Error and warning diagnostics&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Red underlines for errors, yellow for warnings&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/formatting&#39;</span><span class="p">,</span> <span class="s1">&#39;Code formatting&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Auto-format according to style rules&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/codeAction&#39;</span><span class="p">,</span> <span class="s1">&#39;Quick fixes and refactorings&#39;</span><span class="p">,</span>
         <span class="s1">&#39;&quot;Extract method&quot;, &quot;Import missing module&quot;&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/signatureHelp&#39;</span><span class="p">,</span> <span class="s1">&#39;Function signature help&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Show parameter types while typing arguments&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;textDocument/foldingRange&#39;</span><span class="p">,</span> <span class="s1">&#39;Code folding&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Collapse/expand functions, classes, regions&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">capabilities</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Example: </span><span class="si">{</span><span class="n">example</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">lsp_capabilities</span><span class="p">()</span>
</code></pre></div>

<h3 id="84">8.4 간단한 언어 서버 구축<a class="header-link" href="#84" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SimpleLSPServer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplified Language Server Protocol server.</span>
<span class="sd">    Demonstrates the core request/response pattern.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documents</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># uri -&gt; content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostics</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle an LSP request.&quot;&quot;&quot;</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;handle_</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handler</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Unknown method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_textDocument_didOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle document open notification.&quot;&quot;&quot;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;textDocument&#39;</span><span class="p">][</span><span class="s1">&#39;uri&#39;</span><span class="p">]</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;textDocument&#39;</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documents</span><span class="p">[</span><span class="n">uri</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>

        <span class="c1"># Analyze for diagnostics</span>
        <span class="n">diagnostics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;textDocument/publishDiagnostics&#39;</span><span class="p">,</span>
                <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;uri&#39;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span> <span class="s1">&#39;diagnostics&#39;</span><span class="p">:</span> <span class="n">diagnostics</span><span class="p">}}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_textDocument_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle completion request.&quot;&quot;&quot;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;textDocument&#39;</span><span class="p">][</span><span class="s1">&#39;uri&#39;</span><span class="p">]</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>

        <span class="c1"># Simple keyword completion</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;if&#39;</span><span class="p">,</span> <span class="s1">&#39;else&#39;</span><span class="p">,</span> <span class="s1">&#39;while&#39;</span><span class="p">,</span> <span class="s1">&#39;for&#39;</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">,</span> <span class="s1">&#39;return&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="s1">&#39;print&#39;</span><span class="p">]</span>

        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]]</span> <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># Get the partial word being typed</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="s1">&#39;character&#39;</span><span class="p">]</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
                <span class="n">partial</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">partial</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Filter keywords</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">kw</span><span class="p">,</span> <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>  <span class="c1"># Keyword</span>
             <span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Keyword: </span><span class="si">{</span><span class="n">kw</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">partial</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="n">items</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_textDocument_hover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle hover request.&quot;&quot;&quot;</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;textDocument&#39;</span><span class="p">][</span><span class="s1">&#39;uri&#39;</span><span class="p">]</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span>

        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]]</span>
            <span class="c1"># Simple: return the line content</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;contents&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="s1">&#39;markdown&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;```</span><span class="se">\n</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">```&#39;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simple static analysis for diagnostics.&quot;&quot;&quot;</span>
        <span class="n">diagnostics</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="c1"># Check for common issues</span>
            <span class="k">if</span> <span class="s1">&#39;eval(&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">diagnostics</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;character&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;eval(&#39;</span><span class="p">)},</span>
                        <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;character&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;eval(&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">},</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Warning</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Use of eval() is a security risk&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;simple-lsp&#39;</span><span class="p">,</span>
                <span class="p">})</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">:</span>
                <span class="n">diagnostics</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;character&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">},</span>
                        <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;character&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)},</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Information</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Line exceeds 120 characters (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;simple-lsp&#39;</span><span class="p">,</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">diagnostics</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_lsp</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate LSP server behavior.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Simple LSP Server Demo ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">server</span> <span class="o">=</span> <span class="n">SimpleLSPServer</span><span class="p">()</span>

    <span class="c1"># Simulate document open</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="s1">&#39;textDocument/didOpen&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;textDocument&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;uri&#39;</span><span class="p">:</span> <span class="s1">&#39;file:///example.py&#39;</span><span class="p">,</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;x = eval(input())</span><span class="se">\n</span><span class="s1">print(x)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;y = &#39;</span> <span class="o">+</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">130</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">})</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Diagnostics on open:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">diag</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;diagnostics&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Line </span><span class="si">{</span><span class="n">diag</span><span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">][</span><span class="s1">&#39;start&#39;</span><span class="p">][</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">diag</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Simulate completion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="s1">&#39;textDocument/completion&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;textDocument&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;uri&#39;</span><span class="p">:</span> <span class="s1">&#39;file:///example.py&#39;</span><span class="p">},</span>
        <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;character&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
    <span class="p">})</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Completions for partial word:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[])[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">demonstrate_lsp</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="9">9. 증분 컴파일<a class="header-link" href="#9" title="Permanent link">&para;</a></h2>
<h3 id="91">9.1 문제<a class="header-link" href="#91" title="Permanent link">&para;</a></h3>
<p>대규모 프로젝트는 컴파일하는 데 오랜 시간이 걸립니다. 파일 하나를 변경한 후 모든 것을 다시 컴파일하는 것은 낭비입니다. <strong>증분 컴파일(Incremental Compilation)</strong>은 변경된 것만 재컴파일합니다.</p>
<h3 id="92">9.2 의존성 추적<a class="header-link" href="#92" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">IncrementalCompiler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulates incremental compilation with dependency tracking.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_timestamps</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># file -&gt; last modified time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiled_cache</span> <span class="o">=</span> <span class="p">{}</span>    <span class="c1"># file -&gt; compiled result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>  <span class="c1"># file -&gt; set of files it depends on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse_deps</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>  <span class="c1"># file -&gt; set of files that depend on it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_dependency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">depends_on</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record that source depends on depends_on.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">depends_on</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse_deps</span><span class="p">[</span><span class="n">depends_on</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compile_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compile a single file (simulated).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Compiling: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Simulate compilation</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;compiled(</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiled_cache</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_timestamps</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">needs_recompilation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">current_mtime</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a file needs recompilation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Never compiled</span>

        <span class="k">if</span> <span class="n">current_mtime</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_timestamps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Source file changed</span>

        <span class="c1"># Check if any dependency changed</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
            <span class="n">dep_mtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_timestamps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dep_mtime</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_timestamps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Dependency changed</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_with_mtimes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Incremental build: only compile files that need it.</span>

<span class="sd">        files_with_mtimes: dict of filename -&gt; (content, mtime)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Determine what needs recompilation</span>
        <span class="n">to_compile</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">mtime</span><span class="p">)</span> <span class="ow">in</span> <span class="n">files_with_mtimes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">needs_recompilation</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mtime</span><span class="p">):</span>
                <span class="n">to_compile</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Also recompile reverse dependencies of changed files</span>
        <span class="n">worklist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_compile</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">worklist</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">worklist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">rdep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_deps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">rdep</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_compile</span> <span class="ow">and</span> <span class="n">rdep</span> <span class="ow">in</span> <span class="n">files_with_mtimes</span><span class="p">:</span>
                    <span class="n">to_compile</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rdep</span><span class="p">)</span>
                    <span class="n">worklist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rdep</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">to_compile</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Nothing to compile (all up to date)&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Topological sort for correct compilation order</span>
        <span class="n">compiled</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">compile_with_deps</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">compiled</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">to_compile</span><span class="p">:</span>
                    <span class="n">compile_with_deps</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
            <span class="n">content</span><span class="p">,</span> <span class="n">mtime</span> <span class="o">=</span> <span class="n">files_with_mtimes</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
            <span class="n">compiled</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">to_compile</span><span class="p">:</span>
            <span class="n">compile_with_deps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Compiled </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">compile_count</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_with_mtimes</span><span class="p">)</span><span class="si">}</span><span class="s2"> files&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_incremental_compilation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show incremental compilation behavior.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Incremental Compilation ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">compiler</span> <span class="o">=</span> <span class="n">IncrementalCompiler</span><span class="p">()</span>

    <span class="c1"># Define dependencies: main.c depends on util.h and math.h</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="s1">&#39;main.c&#39;</span><span class="p">,</span> <span class="s1">&#39;util.h&#39;</span><span class="p">)</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="s1">&#39;main.c&#39;</span><span class="p">,</span> <span class="s1">&#39;math.h&#39;</span><span class="p">)</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="s1">&#39;util.c&#39;</span><span class="p">,</span> <span class="s1">&#39;util.h&#39;</span><span class="p">)</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="s1">&#39;math.c&#39;</span><span class="p">,</span> <span class="s1">&#39;math.h&#39;</span><span class="p">)</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Build 1: Full build</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Build 1: Initial (full) build&quot;</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;util.h&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="n">now</span><span class="p">),</span>
        <span class="s1">&#39;math.h&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="n">now</span><span class="p">),</span>
        <span class="s1">&#39;main.c&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;main code&#39;</span><span class="p">,</span> <span class="n">now</span><span class="p">),</span>
        <span class="s1">&#39;util.c&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;util code&#39;</span><span class="p">,</span> <span class="n">now</span><span class="p">),</span>
        <span class="s1">&#39;math.c&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;math code&#39;</span><span class="p">,</span> <span class="n">now</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

    <span class="c1"># Build 2: Nothing changed</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Build 2: No changes&quot;</span><span class="p">)</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

    <span class="c1"># Build 3: Changed util.h (should recompile main.c and util.c)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Build 3: Modified util.h&quot;</span><span class="p">)</span>
    <span class="n">files</span><span class="p">[</span><span class="s1">&#39;util.h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;modified header&#39;</span><span class="p">,</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

    <span class="c1"># Build 4: Changed only math.c</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Build 4: Modified only math.c&quot;</span><span class="p">)</span>
    <span class="n">files</span><span class="p">[</span><span class="s1">&#39;math.c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;modified math code&#39;</span><span class="p">,</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

<span class="n">demonstrate_incremental_compilation</span><span class="p">()</span>
</code></pre></div>

<h3 id="93">9.3 실무에서의 증분 컴파일<a class="header-link" href="#93" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>시스템</th>
<th>전략</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Rust (cargo)</strong></td>
<td>크레이트 단위 컴파일, 크레이트 내 쿼리 기반 증분</td>
</tr>
<tr>
<td><strong>Go</strong></td>
<td>패키지 단위 컴파일, 빠른 전체 빌드</td>
</tr>
<tr>
<td><strong>Java (javac)</strong></td>
<td>파일 단위 컴파일, 의존성 추적</td>
</tr>
<tr>
<td><strong>C/C++ (make)</strong></td>
<td>파일 단위 컴파일, 타임스탬프 기반 재빌드</td>
</tr>
<tr>
<td><strong>TypeScript</strong></td>
<td>프로젝트 단위, 메모리 내 증분</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="10">10. 프로파일 기반 최적화<a class="header-link" href="#10" title="Permanent link">&para;</a></h2>
<h3 id="101-pgo">10.1 PGO란?<a class="header-link" href="#101-pgo" title="Permanent link">&para;</a></h3>
<p><strong>프로파일 기반 최적화(Profile-Guided Optimization, PGO)</strong>는 런타임 프로파일링 데이터를 사용하여 더 나은 최적화 결정을 내립니다. 컴파일러는 먼저 계측(Instrumented) 코드를 생성하고, 대표적인 입력으로 실행하여 프로파일 데이터를 수집한 다음, 프로파일을 사용하여 재컴파일합니다.</p>
<div class="highlight"><pre><span></span><code><span class="mi">1</span><span class="err">단계</span><span class="o">:</span><span class="w"> </span><span class="err">계측</span><span class="w"> </span><span class="err">빌드</span>
<span class="w">  </span><span class="err">소스</span><span class="w"> </span><span class="err">──▶</span><span class="w"> </span><span class="err">컴파일러</span><span class="w"> </span><span class="o">(-</span><span class="n">fprofile</span><span class="o">-</span><span class="n">generate</span><span class="o">)</span><span class="w"> </span><span class="err">──▶</span><span class="w"> </span><span class="err">계측된</span><span class="w"> </span><span class="err">바이너리</span>

<span class="mi">2</span><span class="err">단계</span><span class="o">:</span><span class="w"> </span><span class="err">프로파일</span><span class="w"> </span><span class="err">수집</span>
<span class="w">  </span><span class="err">계측된</span><span class="w"> </span><span class="err">바이너리</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">훈련</span><span class="w"> </span><span class="err">입력</span><span class="w"> </span><span class="err">──▶</span><span class="w"> </span><span class="err">프로파일</span><span class="w"> </span><span class="err">데이터</span><span class="w"> </span><span class="o">(.</span><span class="n">profdata</span><span class="o">)</span>

<span class="mi">3</span><span class="err">단계</span><span class="o">:</span><span class="w"> </span><span class="err">최적화</span><span class="w"> </span><span class="err">빌드</span>
<span class="w">  </span><span class="err">소스</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">프로파일</span><span class="w"> </span><span class="err">데이터</span><span class="w"> </span><span class="err">──▶</span><span class="w"> </span><span class="err">컴파일러</span><span class="w"> </span><span class="o">(-</span><span class="n">fprofile</span><span class="o">-</span><span class="n">use</span><span class="o">)</span><span class="w"> </span><span class="err">──▶</span><span class="w"> </span><span class="err">최적화된</span><span class="w"> </span><span class="err">바이너리</span>
</code></pre></div>

<h3 id="102-pgo">10.2 PGO 최적화 결정<a class="header-link" href="#102-pgo" title="Permanent link">&para;</a></h3>
<p>프로파일 데이터는 여러 최적화를 가능하게 합니다:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pgo_optimizations</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show what PGO enables.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== PGO Optimization Decisions ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">optimizations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Branch Prediction Hints&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Mark likely/unlikely branches based on observed frequencies&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  // Profile says: condition is true 95</span><span class="si">% o</span><span class="s1">f the time</span>
<span class="s1">  if (likely(x &gt; 0)) {  // Hot path: optimized layout</span>
<span class="s1">      process(x);</span>
<span class="s1">  } else {              // Cold path: moved out of line</span>
<span class="s1">      handle_error(x);</span>
<span class="s1">  }</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;impact&#39;</span><span class="p">:</span> <span class="s1">&#39;Better instruction cache utilization, fewer branch mispredictions&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Function Inlining&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Inline hot call sites, don</span><span class="se">\&#39;</span><span class="s1">t inline cold ones&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  // Profile says: parse_header called 1M times, parse_trailer called 100 times</span>
<span class="s1">  // Inline parse_header (hot), don&#39;t inline parse_trailer (cold)</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;impact&#39;</span><span class="p">:</span> <span class="s1">&#39;Better code size/speed trade-off&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Basic Block Layout&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Place hot blocks together, cold blocks separately&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  // Hot path blocks placed sequentially for better i-cache usage</span>
<span class="s1">  // Cold blocks (error handling) moved to end of function</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;impact&#39;</span><span class="p">:</span> <span class="s1">&#39;Better instruction cache hit rate&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Register Allocation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Prioritize register allocation for hot paths&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  // Variables used in hot loops get registers</span>
<span class="s1">  // Variables used only in cold paths get stack slots</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;impact&#39;</span><span class="p">:</span> <span class="s1">&#39;Fewer memory accesses in hot code&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Virtual Call Devirtualization&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Convert virtual calls to direct calls based on observed types&#39;</span><span class="p">,</span>
            <span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">  // Profile: 99</span><span class="si">% o</span><span class="s1">f calls to shape.area() are on Circle objects</span>
<span class="s1">  if (shape is Circle) {     // Speculative devirtualization</span>
<span class="s1">      circle_area(shape);    // Direct call (inlinable)</span>
<span class="s1">  } else {</span>
<span class="s1">      shape.area();          // Virtual call fallback</span>
<span class="s1">  }</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;impact&#39;</span><span class="p">:</span> <span class="s1">&#39;Enables inlining of virtual methods&#39;</span>
        <span class="p">},</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">optimizations</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Impact: </span><span class="si">{</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;impact&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

<span class="n">pgo_optimizations</span><span class="p">()</span>
</code></pre></div>

<h3 id="103-clanggcc-pgo">10.3 Clang/GCC에서 PGO 사용하기<a class="header-link" href="#103-clanggcc-pgo" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Clang PGO workflow:</span>

<span class="c1"># Step 1: Build with instrumentation</span>
clang<span class="w"> </span>-fprofile-instr-generate<span class="w"> </span>-O2<span class="w"> </span>program.c<span class="w"> </span>-o<span class="w"> </span>program_instrumented

<span class="c1"># Step 2: Run with representative input</span>
./program_instrumented<span class="w"> </span>&lt;<span class="w"> </span>training_input.txt
<span class="c1"># This generates default.profraw</span>

<span class="c1"># Step 3: Merge profile data</span>
llvm-profdata<span class="w"> </span>merge<span class="w"> </span>default.profraw<span class="w"> </span>-output<span class="o">=</span>program.profdata

<span class="c1"># Step 4: Build with profile data</span>
clang<span class="w"> </span>-fprofile-instr-use<span class="o">=</span>program.profdata<span class="w"> </span>-O2<span class="w"> </span>program.c<span class="w"> </span>-o<span class="w"> </span>program_optimized

<span class="c1"># Typical speedup: 10-20% for large applications</span>
</code></pre></div>

<h3 id="104-pgo">10.4 PGO 시뮬레이션<a class="header-link" href="#104-pgo" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simulate_pgo</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulate PGO&#39;s effect on branch layout.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== PGO Simulation ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Simulated function with branches</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Generate &quot;execution profile&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;branch_A_true&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;branch_A_false&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;branch_B_true&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;branch_B_false&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>  <span class="c1"># Branch A: taken 99% of the time</span>
            <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;branch_A_true&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;branch_A_false&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">:</span>  <span class="c1"># Branch B: taken ~1% of the time</span>
            <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;branch_B_true&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;branch_B_false&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile data collected:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">branch</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">pct</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">branch</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PGO decisions:&quot;</span><span class="p">)</span>
    <span class="n">a_ratio</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;branch_A_true&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">b_ratio</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;branch_B_true&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">n</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Branch A (</span><span class="si">{</span><span class="n">a_ratio</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% true):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    -&gt; Predict TRUE, place true-path first (fall-through)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    -&gt; Move false-path out-of-line&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Branch B (</span><span class="si">{</span><span class="n">b_ratio</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% true):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    -&gt; Predict FALSE, place false-path first (fall-through)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    -&gt; Move true-path out-of-line&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Code layout:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  Without PGO:              With PGO:</span>
<span class="s2">  func:                     func:</span>
<span class="s2">    cmp x, 50                 cmp x, 50</span>
<span class="s2">    jle .else_A               jle .cold_A       (rarely taken)</span>
<span class="s2">    ; true path A             ; true path A     (fall-through: hot)</span>
<span class="s2">    ...                       ...</span>
<span class="s2">    jmp .end_A                cmp x, 150</span>
<span class="s2">  .else_A:                    jg .cold_B        (rarely taken)</span>
<span class="s2">    ; false path A            ; false path B    (fall-through: hot)</span>
<span class="s2">    ...                       ...</span>
<span class="s2">  .end_A:                     ret</span>
<span class="s2">    cmp x, 150</span>
<span class="s2">    jle .else_B             ; Cold section (separate cache lines):</span>
<span class="s2">    ; true path B           .cold_A:</span>
<span class="s2">    ...                       ; false path A</span>
<span class="s2">    jmp .end_B                jmp .back_A</span>
<span class="s2">  .else_B:                  .cold_B:</span>
<span class="s2">    ; false path B            ; true path B</span>
<span class="s2">    ...                       jmp .back_B</span>
<span class="s2">  .end_B:</span>
<span class="s2">    ret</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">simulate_pgo</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="11">11. 링크 타임 최적화<a class="header-link" href="#11" title="Permanent link">&para;</a></h2>
<h3 id="111-lto">11.1 LTO란?<a class="header-link" href="#111-lto" title="Permanent link">&para;</a></h3>
<p><strong>링크 타임 최적화(Link-Time Optimization, LTO)</strong>는 일부 최적화를 링크 시간으로 미루는데, 이 때 컴파일러는 모든 번역 단위(소스 파일)에 걸쳐 가시성을 갖습니다. 이를 통해 가능해지는 것들:</p>
<ul>
<li>모듈 간 인라이닝</li>
<li>프로시저 간 상수 전파</li>
<li>모듈 간 데드 함수 제거</li>
<li>전체 프로그램 가상 함수 직접 호출 변환(Devirtualization)</li>
</ul>
<div class="highlight"><pre><span></span><code>LTO 없이:
  a.c ──▶ a.o ──┐
  b.c ──▶ b.o ──┤──▶ 링커 ──▶ 바이너리
  c.c ──▶ c.o ──┘
  (각 .o는 독립적으로 최적화됨)

LTO 있을 때:
  a.c ──▶ a.bc ──┐
  b.c ──▶ b.bc ──┤──▶ LTO 최적화기 ──▶ 링커 ──▶ 바이너리
  c.c ──▶ c.bc ──┘
  (.bc = LLVM 비트코드, 함께 최적화됨)
</code></pre></div>

<h3 id="112-lto-thinlto">11.2 전체 LTO 대 ThinLTO<a class="header-link" href="#112-lto-thinlto" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>측면</th>
<th>전체 LTO</th>
<th>ThinLTO</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>범위</strong></td>
<td>모든 모듈을 하나로 병합</td>
<td>모듈을 별도로 유지</td>
</tr>
<tr>
<td><strong>링크 시간</strong></td>
<td>느림 (단일 스레드)</td>
<td>빠름 (병렬화 가능)</td>
</tr>
<tr>
<td><strong>메모리</strong></td>
<td>높음 (전체 프로그램이 메모리에)</td>
<td>낮음 (요약 기반)</td>
</tr>
<tr>
<td><strong>최적화 품질</strong></td>
<td>최고 (전체 가시성)</td>
<td>거의 동등 (95%+)</td>
</tr>
<tr>
<td><strong>증분</strong></td>
<td>없음 (모든 것 재최적화)</td>
<td>있음 (모듈별)</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="c1"># Full LTO with Clang</span>
clang<span class="w"> </span>-flto<span class="w"> </span>-O2<span class="w"> </span>a.c<span class="w"> </span>b.c<span class="w"> </span>c.c<span class="w"> </span>-o<span class="w"> </span>program

<span class="c1"># ThinLTO (recommended for large projects)</span>
clang<span class="w"> </span>-flto<span class="o">=</span>thin<span class="w"> </span>-O2<span class="w"> </span>a.c<span class="w"> </span>b.c<span class="w"> </span>c.c<span class="w"> </span>-o<span class="w"> </span>program
</code></pre></div>

<h3 id="113-lto">11.3 LTO가 가능하게 하는 것들<a class="header-link" href="#113-lto" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">lto_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show what LTO enables that per-file compilation cannot.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== LTO Optimizations ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Example: Cross-module inlining</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  // util.c&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  int square(int x) { return x * x; }&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  // main.c&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  extern int square(int);&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  int main() { return square(5); }&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Without LTO: square() is a function call&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  With LTO:    square(5) is inlined -&gt; return 25&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;               Constant folded -&gt; return 25&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;               (zero runtime cost!)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Example: Dead code elimination</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  // util.c&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  void used_function() { ... }&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  void unused_function() { ... }  // 10,000 lines&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Without LTO: both functions in binary (linker can&#39;t tell)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  With LTO:    unused_function() eliminated (smaller binary)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Example: Interprocedural constant propagation</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  // config.c&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  int get_mode() { return 3; }  // Always returns 3&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  // engine.c&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  int mode = get_mode();&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  if (mode == 1) { ... }  // Dead code (mode is always 3)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  if (mode == 2) { ... }  // Dead code&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  if (mode == 3) { ... }  // Only this branch survives&quot;</span><span class="p">)</span>

<span class="n">lto_example</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="12">12. 컴파일러 검증<a class="header-link" href="#12" title="Permanent link">&para;</a></h2>
<h3 id="121">12.1 컴파일러를 검증해야 하는 이유<a class="header-link" href="#121" title="Permanent link">&para;</a></h3>
<p>컴파일러는 중요한 인프라입니다: 컴파일러의 버그는 컴파일되는 모든 프로그램에 버그를 도입할 수 있습니다. 컴파일러 검증은 컴파일된 코드가 소스와 의미론적으로 동등함을 보장합니다.</p>
<h3 id="122">12.2 컴파일러 정확성 접근 방식<a class="header-link" href="#122" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>접근 방식</th>
<th>설명</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>테스팅</strong></td>
<td>테스트 스위트 실행, 퍼즈 테스팅</td>
<td>GCC/LLVM 테스트 스위트, Csmith</td>
</tr>
<tr>
<td><strong>번역 검증</strong></td>
<td>각 컴파일 인스턴스 검증</td>
<td>Alive2 (LLVM용)</td>
</tr>
<tr>
<td><strong>검증된 컴파일러</strong></td>
<td>수학적으로 정확성 증명</td>
<td>CompCert</td>
</tr>
<tr>
<td><strong>무작위 테스팅</strong></td>
<td>무작위 프로그램 생성, 출력 비교</td>
<td>Csmith, YARPGen</td>
</tr>
</tbody>
</table>
<h3 id="123-compcert">12.3 CompCert: 검증된 컴파일러<a class="header-link" href="#123-compcert" title="Permanent link">&para;</a></h3>
<p><strong>CompCert</strong>는 Coq 증명 보조 도구를 사용하여 수학적으로 올바름이 증명된 C 컴파일러입니다. 정확성 정리는 다음과 같습니다:</p>
<blockquote>
<p>정의된 동작을 가진 모든 소스 프로그램 $S$와 컴파일된 프로그램 $C$에 대해, $C$의 관찰 가능한 동작은 $S$의 동작과 동일합니다.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compiler_verification_overview</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Overview of compiler verification approaches.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Compiler Verification ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CompCert correctness theorem (informal):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  For all source programs S with defined behavior:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  semantics(compile(S)) = semantics(S)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Translation validation (Alive2 for LLVM):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  For each optimization pass applied:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Verify: semantics(optimized_IR) ⊆ semantics(original_IR)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  (optimized code may have fewer behaviors, e.g., removing UB)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fuzzing (Csmith):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  1. Generate random C programs (avoiding UB)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  2. Compile with multiple compilers/optimization levels&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  3. Run all binaries -- outputs must match&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  4. Any mismatch indicates a compiler bug&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Csmith has found 400+ bugs in GCC and LLVM!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="c1"># Simple equivalence checker</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simple translation validation example:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Original:   x = a + 0&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Optimized:  x = a&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Valid? YES (adding zero is identity)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Original:   x = a * 2&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Optimized:  x = a &lt;&lt; 1&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Valid? YES (for unsigned; need to check overflow for signed)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Original:   x = a / b&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Optimized:  x = a &gt;&gt; log2(b)  (when b is power of 2)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Valid? Only if a &gt;= 0 and b &gt; 0 (signed division rounds toward zero)&quot;</span><span class="p">)</span>

<span class="n">compiler_verification_overview</span><span class="p">()</span>
</code></pre></div>

<h3 id="124-alive2-llvm-ir">12.4 Alive2: LLVM IR 검증<a class="header-link" href="#124-alive2-llvm-ir" title="Permanent link">&para;</a></h3>
<p><strong>Alive2</strong>는 최적화된 IR이 모든 가능한 입력에 대해 원래 IR을 정제(Refine)하는지 확인하여 LLVM 최적화 패스를 자동으로 검증합니다.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">alive2_example</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulate Alive2-style verification.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Alive2-style Verification ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">optimizations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Strength reduction: x * 2 -&gt; x + x&#39;</span><span class="p">,</span>
            <span class="s1">&#39;original&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;optimized&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span>
            <span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;x / 2 -&gt; x &gt;&gt; 1 (signed)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;original&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">//</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="p">((</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s1">&#39;optimized&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Differs for negative odd numbers!</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;x + 0 -&gt; x&#39;</span><span class="p">,</span>
            <span class="s1">&#39;original&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;optimized&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
            <span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">optimizations</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimization: </span><span class="si">{</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Test with various inputs</span>
        <span class="n">test_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="mi">127</span><span class="p">,</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">all_match</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">counterexample</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">test_values</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">orig_result</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;original&#39;</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>
                <span class="n">opt_result</span> <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;optimized&#39;</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">orig_result</span> <span class="o">!=</span> <span class="n">opt_result</span><span class="p">:</span>
                    <span class="n">all_match</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">counterexample</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">orig_result</span><span class="p">,</span> <span class="n">opt_result</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">all_match</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Result: VALID (all </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_values</span><span class="p">)</span><span class="si">}</span><span class="s2"> test values match)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">optim</span> <span class="o">=</span> <span class="n">counterexample</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Result: INVALID!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Counterexample: x = </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Original:  </span><span class="si">{</span><span class="n">orig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Optimized: </span><span class="si">{</span><span class="n">optim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

<span class="n">alive2_example</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="13">13. 요약<a class="header-link" href="#13" title="Permanent link">&para;</a></h2>
<p>현대 컴파일러 인프라는 단일 언어 특화 컴파일러에서 모듈식 재사용 가능한 프레임워크로 진화했습니다:</p>
<table>
<thead>
<tr>
<th>구성 요소</th>
<th>목적</th>
<th>주요 예시</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>LLVM IR</strong></td>
<td>범용 최적화 타겟</td>
<td>Clang, Rust, Swift, Julia에서 사용</td>
</tr>
<tr>
<td><strong>MLIR</strong></td>
<td>다중 레벨 IR 프레임워크</td>
<td>TensorFlow, 하드웨어 컴파일러</td>
</tr>
<tr>
<td><strong>패스</strong></td>
<td>모듈식 최적화</td>
<td>상수 접기, DCE, 인라이닝</td>
</tr>
<tr>
<td><strong>DSL</strong></td>
<td>도메인 특화 표현력</td>
<td>SQL, HTML, 셰이더 언어</td>
</tr>
<tr>
<td><strong>ANTLR</strong></td>
<td>파서 생성</td>
<td>언어 도구</td>
</tr>
<tr>
<td><strong>Tree-sitter</strong></td>
<td>증분 파싱</td>
<td>에디터 통합</td>
</tr>
<tr>
<td><strong>LSP</strong></td>
<td>에디터-언어 브리지</td>
<td>VS Code, vim, emacs</td>
</tr>
<tr>
<td><strong>PGO</strong></td>
<td>런타임 정보 기반 최적화</td>
<td>10-20% 속도 향상</td>
</tr>
<tr>
<td><strong>LTO</strong></td>
<td>모듈 간 최적화</td>
<td>전체 프로그램 분석</td>
</tr>
<tr>
<td><strong>검증</strong></td>
<td>컴파일러 정확성</td>
<td>CompCert, Alive2, Csmith</td>
</tr>
</tbody>
</table>
<p>핵심 원칙:</p>
<ol>
<li><strong>모듈성</strong>: 프론트엔드, 최적화기, 백엔드를 분리하면 재사용과 빠른 언어 개발이 가능합니다.</li>
<li><strong>IR 설계의 중요성</strong>: 잘 설계된 IR(LLVM IR 같은)은 전체 생태계의 기반이 됩니다.</li>
<li><strong>다중 추상화 수준</strong>: MLIR은 서로 다른 도메인이 다른 IR 수준을 필요로 한다는 것을 인식합니다.</li>
<li><strong>도구링은 필수</strong>: 현대 언어 개발은 컴파일러 자체만큼이나 도구링(LSP, Tree-sitter, 포매터)에 관한 것입니다.</li>
<li><strong>최적화는 끝이 없음</strong>: PGO, LTO, 런타임 최적화는 정적 컴파일만으로는 찾을 수 없는 개선을 계속 발견합니다.</li>
<li><strong>정확성이 최우선</strong>: 컴파일러가 더 복잡해질수록, 형식적 검증과 자동화된 테스팅이 점점 더 중요해집니다.</li>
</ol>
<hr />
<h2 id="14">14. 연습 문제<a class="header-link" href="#14" title="Permanent link">&para;</a></h2>
<h3 id="1-llvm-ir">연습 1: 직접 LLVM IR 작성<a class="header-link" href="#1-llvm-ir" title="Permanent link">&para;</a></h3>
<p>다음 함수들에 대한 LLVM IR(텍스트 형식)을 작성하세요:</p>
<p>(a) <code>int max(int a, int b)</code> -- 조건부 분기와 파이 노드를 사용하여 두 정수 중 더 큰 값을 반환합니다.</p>
<p>(b) <code>int sum_array(int* arr, int n)</code> -- 파이 노드가 있는 루프를 사용하여 배열의 모든 원소를 합산합니다.</p>
<p>(c) <code>int fibonacci(int n)</code> -- 루프를 사용하는 반복적 피보나치입니다.</p>
<p>각 <code>%name</code>이 정확히 한 번만 정의되는 SSA 형식을 따르는지 확인하여 IR이 문법적으로 올바른지 검증하세요.</p>
<h3 id="2">연습 2: 최적화 패스<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<p>다음을 수행하는 <strong>강도 감소(Strength Reduction)</strong> 패스를 (Python으로, LLVM IR을 시뮬레이션하여) 구현하세요:
(a) <code>x * 2</code>를 <code>x + x</code>로 대체합니다.
(b) <code>x * 2의_거듭제곱</code>을 <code>x &lt;&lt; log2(2의_거듭제곱)</code>로 대체합니다.
(c) <code>x / 2의_거듭제곱</code>을 <code>x &gt;&gt; log2(2의_거듭제곱)</code>로 대체합니다 (부호 없는 경우만).</p>
<p>이러한 패턴을 사용하는 함수에서 테스트하고 출력이 올바른지 검증하세요.</p>
<h3 id="3-dsl">연습 3: DSL 설계 및 구현<a class="header-link" href="#3-dsl" title="Permanent link">&para;</a></h3>
<p>다음 도메인 중 하나에 대한 DSL을 설계하고 구현하세요:</p>
<p>(a) <strong>상태 기계</strong>: 상태, 전이, 액션이 있는 유한 상태 기계를 정의하는 DSL.
(b) <strong>빌드 시스템</strong>: 빌드 규칙과 의존성을 정의하는 단순화된 Makefile 같은 DSL.
(c) <strong>데이터 검증</strong>: 구조화된 데이터(JSON Schema 같지만 더 단순한)에 대한 검증 규칙을 정의하는 DSL.</p>
<p>구현에는 다음을 포함해야 합니다: 파서(Python의 <code>re</code>나 단순 재귀 하강 파서 사용 가능), AST, 실행 가능한 Python 코드를 생성하는 코드 생성기.</p>
<h3 id="4">연습 4: 증분 컴파일<a class="header-link" href="#4" title="Permanent link">&para;</a></h3>
<p>9절의 증분 컴파일러를 다음과 같이 확장하세요:
(a) 파일 수준이 아닌 심볼 수준에서 의존성을 추적합니다 -- <code>a.c</code>의 함수 <code>foo</code>가 변경되어도 <code>a.c</code>의 함수 <code>bar</code>는 변경되지 않으면, <code>foo</code>에 의존하는 파일만 재컴파일합니다.
(b) 순환 의존성을 처리합니다 (감지하고 보고).
(c) 의존성 그래프를 디스크에 저장하여 여러 실행에 걸쳐 지속됩니다.</p>
<h3 id="5-pgo">연습 5: PGO 시뮬레이터<a class="header-link" href="#5-pgo" title="Permanent link">&para;</a></h3>
<p>다음을 수행하는 PGO 시뮬레이터를 만드세요:
(a) 간단한 프로그램(기본 블록과 분기 확률이 있는 CFG로 표현됨)을 입력으로 받습니다.
(b) 주어진 입력으로 실행을 시뮬레이션하여 분기 빈도를 수집합니다.
(c) 프로파일을 사용하여 기본 블록을 재정렬합니다 (핫 경로 먼저, 콜드 경로는 끝으로).
(d) 명령어 캐시 적중률의 예상 개선을 계산합니다.</p>
<h3 id="6_1">연습 6: 번역 검증기<a class="header-link" href="#6_1" title="Permanent link">&para;</a></h3>
<p>두 간단한 식이 동등한지 확인하는 간단한 번역 검증기를 구현하세요:
(a) 정수 산술을 지원합니다: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>.
(b) 상수 접기 검증을 지원합니다 (예: <code>3 + 4</code>는 <code>7</code>과 같음).
(c) 대수적 항등식을 지원합니다 (예: <code>x + 0 = x</code>, <code>x * 1 = x</code>).
(d) 구체적인 테스트 값으로 기호 실행을 사용하여 반례를 찾습니다.
(e) 변환이 유효한지 보고하거나 반례를 제공합니다.</p>
<hr />
<h2 id="15">15. 참고 자료<a class="header-link" href="#15" title="Permanent link">&para;</a></h2>
<ol>
<li>Lattner, C. (2002). "LLVM: An Infrastructure for Multi-Level Intermediate Representation." Master's thesis, University of Illinois.</li>
<li>Lattner, C., Amini, M., Bondhugula, U., et al. (2021). "MLIR: Scaling Compiler Infrastructure for Domain Specific Computation." <em>CGO</em>.</li>
<li>LLVM Language Reference Manual. <a href="https://llvm.org/docs/LangRef.html">llvm.org/docs/LangRef.html</a>.</li>
<li>Leroy, X. (2009). "Formal Verification of a Realistic Compiler." <em>Communications of the ACM</em>, 52(7).</li>
<li>Lopes, N. V., Lee, J., Hur, C.-K., Liu, Z., &amp; Regehr, J. (2021). "Alive2: Bounded Translation Validation for LLVM." <em>PLDI</em>.</li>
<li>Yang, X., Chen, Y., Eide, E., &amp; Regehr, J. (2011). "Finding and Understanding Bugs in C Compilers." <em>PLDI</em>.</li>
<li>Parr, T. (2013). <em>The Definitive ANTLR 4 Reference</em>. Pragmatic Bookshelf.</li>
<li>Brunsfeld, M. (2018). "Tree-sitter -- A new parsing system for programming tools." GitHub.</li>
<li>Microsoft. "Language Server Protocol Specification." <a href="https://microsoft.github.io/language-server-protocol/">microsoft.github.io/language-server-protocol</a>.</li>
<li>Stallman, R. M. (2023). <em>GCC Internals Manual</em>. Free Software Foundation.</li>
</ol>
<hr />
<p><a href="./15_Interpreters_and_Virtual_Machines.md">이전: 15. 인터프리터와 가상 머신</a> | <a href="./00_Overview.md">개요</a></p>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Compiler_Design/15_Interpreters_and_Virtual_Machines.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">인터프리터와 가상 머신(Interpreters and Virtual Machines)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">🔗</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Compiler_Design/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">📋</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">↑</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}