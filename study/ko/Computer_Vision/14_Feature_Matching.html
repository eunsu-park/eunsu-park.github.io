{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŠ¹ì§•ì  ë§¤ì¹­ (Feature Matching) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Computer_Vision/">Computer Vision</a>
    <span class="separator">/</span>
    <span class="current">íŠ¹ì§•ì  ë§¤ì¹­ (Feature Matching)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>íŠ¹ì§•ì  ë§¤ì¹­ (Feature Matching)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/13_Feature_Detection.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">íŠ¹ì§•ì  ê²€ì¶œ (Feature Detection)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/15_Object_Detection_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ê°ì²´ ê²€ì¶œ ê¸°ì´ˆ (Object Detection Basics)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ê°œìš”</a></li>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1">1. íŠ¹ì§•ì  ë§¤ì¹­ ê¸°ì´ˆ</a><ul>
<li><a href="#_3">ë§¤ì¹­ ê³¼ì •</a></li>
<li><a href="#dmatch">DMatch êµ¬ì¡°</a></li>
</ul>
</li>
<li><a href="#2-bfmatcher">2. BFMatcher</a><ul>
<li><a href="#_4">ê°œë…</a></li>
<li><a href="#cv2bfmatcher">cv2.BFMatcher</a></li>
<li><a href="#crosscheck">crossCheck ì˜µì…˜</a></li>
<li><a href="#knnmatch">knnMatch</a></li>
</ul>
</li>
<li><a href="#3-flann">3. FLANN ê¸°ë°˜ ë§¤ì²˜</a><ul>
<li><a href="#_5">ê°œë…</a></li>
<li><a href="#flann">FLANN ì‚¬ìš©ë²•</a></li>
<li><a href="#flann-for-orb">FLANN for ORB (ë°”ì´ë„ˆë¦¬)</a></li>
</ul>
</li>
<li><a href="#4">4. ê±°ë¦¬ ë©”íŠ¸ë¦­</a><ul>
<li><a href="#_6">ê±°ë¦¬ ìœ í˜•</a></li>
<li><a href="#_7">ë””ìŠ¤í¬ë¦½í„°ë³„ ì¶”ì²œ ë©”íŠ¸ë¦­</a></li>
</ul>
</li>
<li><a href="#5">5. ë§¤ì¹­ í•„í„°ë§</a><ul>
<li><a href="#lowes-ratio-test">Lowe's Ratio Test</a></li>
<li><a href="#_8">ê±°ë¦¬ ê¸°ë°˜ í•„í„°ë§</a></li>
<li><a href="#symmetric-matching">ëŒ€ì¹­ ë§¤ì¹­ (Symmetric Matching)</a></li>
</ul>
</li>
<li><a href="#6-homography-ransac">6. Homographyì™€ RANSAC</a><ul>
<li><a href="#homography">Homography ê°œë…</a></li>
<li><a href="#cv2findhomography">cv2.findHomography()</a></li>
<li><a href="#ransac">RANSAC ì´í•´</a></li>
</ul>
</li>
<li><a href="#7">7. ì´ë¯¸ì§€ ìŠ¤í‹°ì¹­ ê¸°ì´ˆ</a><ul>
<li><a href="#_9">ê°„ë‹¨í•œ íŒŒë…¸ë¼ë§ˆ</a></li>
<li><a href="#opencv-stitcher">OpenCV Stitcher ì‚¬ìš©</a></li>
</ul>
</li>
<li><a href="#8">8. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1_1">ë¬¸ì œ 1: ìµœì  ë§¤ì¹­ íŒŒë¼ë¯¸í„° ì°¾ê¸°</a></li>
<li><a href="#2">ë¬¸ì œ 2: ë‹¤ì¤‘ ê°ì²´ ê²€ì¶œ</a></li>
<li><a href="#3">ë¬¸ì œ 3: ì‹¤ì‹œê°„ ê°ì²´ ì¶”ì </a></li>
<li><a href="#_10">ì¶”ì²œ ë¬¸ì œ</a></li>
</ul>
</li>
<li><a href="#_11">ë‹¤ìŒ ë‹¨ê³„</a></li>
<li><a href="#_12">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="feature-matching">íŠ¹ì§•ì  ë§¤ì¹­ (Feature Matching)<a class="header-link" href="#feature-matching" title="Permanent link">&para;</a></h1>
<h2 id="_1">ê°œìš”<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>íŠ¹ì§•ì  ë§¤ì¹­ì€ ë‘ ì´ë¯¸ì§€ì—ì„œ ë™ì¼í•œ íŠ¹ì§•ì ì„ ì°¾ì•„ ì—°ê²°í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ê°ì²´ ì¸ì‹, ì´ë¯¸ì§€ ìŠ¤í‹°ì¹­, 3D ì¬êµ¬ì„±, ê°ì²´ ì¶”ì  ë“±ì— í™œìš©ë©ë‹ˆë‹¤. ì´ ë ˆìŠ¨ì—ì„œëŠ” BFMatcher, FLANN, ê±°ë¦¬ ë©”íŠ¸ë¦­, Lowe's ratio test, Homography, RANSAC ë“±ì„ í•™ìŠµí•©ë‹ˆë‹¤.</p>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-íŠ¹ì§•ì -ë§¤ì¹­-ê¸°ì´ˆ">íŠ¹ì§•ì  ë§¤ì¹­ ê¸°ì´ˆ</a></li>
<li><a href="#2-bfmatcher">BFMatcher</a></li>
<li><a href="#3-flann-ê¸°ë°˜-ë§¤ì²˜">FLANN ê¸°ë°˜ ë§¤ì²˜</a></li>
<li><a href="#4-ê±°ë¦¬-ë©”íŠ¸ë¦­">ê±°ë¦¬ ë©”íŠ¸ë¦­</a></li>
<li><a href="#5-ë§¤ì¹­-í•„í„°ë§">ë§¤ì¹­ í•„í„°ë§</a></li>
<li><a href="#6-homographyì™€-ransac">Homographyì™€ RANSAC</a></li>
<li><a href="#7-ì´ë¯¸ì§€-ìŠ¤í‹°ì¹­-ê¸°ì´ˆ">ì´ë¯¸ì§€ ìŠ¤í‹°ì¹­ ê¸°ì´ˆ</a></li>
<li><a href="#8-ì—°ìŠµ-ë¬¸ì œ">ì—°ìŠµ ë¬¸ì œ</a></li>
</ol>
<hr />
<h2 id="1">1. íŠ¹ì§•ì  ë§¤ì¹­ ê¸°ì´ˆ<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="_3">ë§¤ì¹­ ê³¼ì •<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     íŠ¹ì§•ì  ë§¤ì¹­ íŒŒì´í”„ë¼ì¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ì´ë¯¸ì§€ 1                        ì´ë¯¸ì§€ 2                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”‚ â—  â—    â”‚                     â”‚   â—  â—  â”‚                       â”‚
â”‚   â”‚    â—  â— â”‚                     â”‚ â—    â—  â”‚                       â”‚
â”‚   â”‚  â—      â”‚                     â”‚   â—     â”‚                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚       â”‚                               â”‚                             â”‚
â”‚       â–¼                               â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ íŠ¹ì§•ì    â”‚                   â”‚ íŠ¹ì§•ì    â”‚                        â”‚
â”‚  â”‚ ê²€ì¶œ     â”‚                   â”‚ ê²€ì¶œ     â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚       â”‚                               â”‚                             â”‚
â”‚       â–¼                               â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ë””ìŠ¤í¬ë¦½í„°â”‚                   â”‚ë””ìŠ¤í¬ë¦½í„°â”‚                        â”‚
â”‚  â”‚ ê³„ì‚°     â”‚                   â”‚ ê³„ì‚°     â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚       â”‚                               â”‚                             â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                  â–¼                                                  â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚           â”‚   ë§¤ì¹­       â”‚                                          â”‚
â”‚           â”‚ (BFMatcher   â”‚                                          â”‚
â”‚           â”‚  or FLANN)   â”‚                                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                  â–¼                                                  â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚           â”‚ í•„í„°ë§       â”‚                                          â”‚
â”‚           â”‚ (Ratio Test, â”‚                                          â”‚
â”‚           â”‚  RANSAC)     â”‚                                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="dmatch">DMatch êµ¬ì¡°<a class="header-link" href="#dmatch" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># DMatch ì†ì„±</span>
<span class="c1"># match.queryIdx  : ì¿¼ë¦¬(ì²« ë²ˆì§¸) ì´ë¯¸ì§€ì˜ ë””ìŠ¤í¬ë¦½í„° ì¸ë±ìŠ¤</span>
<span class="c1"># match.trainIdx  : í›ˆë ¨(ë‘ ë²ˆì§¸) ì´ë¯¸ì§€ì˜ ë””ìŠ¤í¬ë¦½í„° ì¸ë±ìŠ¤</span>
<span class="c1"># match.imgIdx    : í›ˆë ¨ ì´ë¯¸ì§€ì˜ ì¸ë±ìŠ¤ (ì—¬ëŸ¬ ì´ë¯¸ì§€ ë§¤ì¹­ ì‹œ)</span>
<span class="c1"># match.distance  : ë””ìŠ¤í¬ë¦½í„° ê°„ì˜ ê±°ë¦¬ (ìœ ì‚¬ë„)</span>
</code></pre></div>

<hr />
<h2 id="2-bfmatcher">2. BFMatcher<a class="header-link" href="#2-bfmatcher" title="Permanent link">&para;</a></h2>
<h3 id="_4">ê°œë…<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>BFMatcher (Brute-Force Matcher):
ëª¨ë“  ë””ìŠ¤í¬ë¦½í„° ìŒì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ì—¬ ìµœì†Œ ê±°ë¦¬ ì°¾ê¸°

ì¥ì :
- êµ¬í˜„ ê°„ë‹¨
- í•­ìƒ ìµœì  ë§¤ì¹­ ë³´ì¥

ë‹¨ì :
- O(N Ã— M) ë³µì¡ë„ (N, M: ë””ìŠ¤í¬ë¦½í„° ê°œìˆ˜)
- ëŒ€ëŸ‰ íŠ¹ì§•ì ì—ì„œ ëŠë¦¼

                Query Descriptors
                d1   d2   d3   d4
            â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
Train   d1&#39; â”‚ 10 â”‚ 25 â”‚ 15 â”‚ 30 â”‚
Desc    d2&#39; â”‚ 20 â”‚  5 â”‚ 35 â”‚ 12 â”‚  â† ê° ì…€: ê±°ë¦¬
        d3&#39; â”‚ 30 â”‚ 18 â”‚  8 â”‚ 22 â”‚
            â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

ë§¤ì¹­: d1â†”d1&#39;(10), d2â†”d2&#39;(5), d3â†”d3&#39;(8), d4â†”d2&#39;(12)
</code></pre></div>

<h3 id="cv2bfmatcher">cv2.BFMatcher<a class="header-link" href="#cv2bfmatcher" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bf_matching_demo</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;BFMatcher ê¸°ë³¸ ì‚¬ìš©ë²•&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

    <span class="c1"># ORB ê²€ì¶œê¸° (ë°”ì´ë„ˆë¦¬ ë””ìŠ¤í¬ë¦½í„°)</span>
    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># BFMatcher ìƒì„± (Hamming ê±°ë¦¬ - ë°”ì´ë„ˆë¦¬ìš©)</span>
    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span> <span class="n">crossCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ë§¤ì¹­</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">)</span>

    <span class="c1"># ê±°ë¦¬ìˆœ ì •ë ¬</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>

    <span class="c1"># ìƒìœ„ 30ê°œ ë§¤ì¹­ ê·¸ë¦¬ê¸°</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawMatches</span><span class="p">(</span>
        <span class="n">img1</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="n">kp2</span><span class="p">,</span>
        <span class="n">matches</span><span class="p">[:</span><span class="mi">30</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_NOT_DRAW_SINGLE_POINTS</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ ë§¤ì¹­ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ìµœì†Œ ê±°ë¦¬: </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ìµœëŒ€ ê±°ë¦¬: </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;BF Matches&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matches</span>

<span class="n">matches</span> <span class="o">=</span> <span class="n">bf_matching_demo</span><span class="p">(</span><span class="s1">&#39;query.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;train.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="crosscheck">crossCheck ì˜µì…˜<a class="header-link" href="#crosscheck" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bf_crosscheck_comparison</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;crossCheck ì˜µì…˜ ë¹„êµ&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># crossCheck=False</span>
    <span class="n">bf_no_cross</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span> <span class="n">crossCheck</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">matches_no_cross</span> <span class="o">=</span> <span class="n">bf_no_cross</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">)</span>

    <span class="c1"># crossCheck=True</span>
    <span class="c1"># Aâ†’Bì™€ Bâ†’A ëª¨ë‘ ì¼ì¹˜í•´ì•¼ ë§¤ì¹­</span>
    <span class="n">bf_cross</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span> <span class="n">crossCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">matches_cross</span> <span class="o">=</span> <span class="n">bf_cross</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;crossCheck=False: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches_no_cross</span><span class="p">)</span><span class="si">}</span><span class="s2"> matches&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;crossCheck=True:  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches_cross</span><span class="p">)</span><span class="si">}</span><span class="s2"> matches&quot;</span><span class="p">)</span>

    <span class="c1"># crossCheck=Trueê°€ ë” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë§¤ì¹­</span>

<span class="n">bf_crosscheck_comparison</span><span class="p">(</span><span class="s1">&#39;query.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;train.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="knnmatch">knnMatch<a class="header-link" href="#knnmatch" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bf_knn_matching</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;k-ìµœê·¼ì ‘ ì´ì›ƒ ë§¤ì¹­&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

    <span class="c1"># SIFT ê²€ì¶œê¸° (float ë””ìŠ¤í¬ë¦½í„°)</span>
    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># BFMatcher (L2 ê±°ë¦¬ - floatìš©)</span>
    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">NORM_L2</span><span class="p">)</span>

    <span class="c1"># kê°œì˜ ìµœê·¼ì ‘ ì´ì›ƒ ë°˜í™˜</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

    <span class="c1"># ê° ì¿¼ë¦¬ ë””ìŠ¤í¬ë¦½í„°ì— ëŒ€í•´ kê°œì˜ ë§¤ì¹­</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¿¼ë¦¬ ë””ìŠ¤í¬ë¦½í„° ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">des1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê° ì¿¼ë¦¬ë‹¹ </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">ê°œ ë§¤ì¹­&quot;</span><span class="p">)</span>

    <span class="c1"># ì²« ë²ˆì§¸ ì¿¼ë¦¬ì˜ ë§¤ì¹­ í™•ì¸</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ì²« ë²ˆì§¸ ì¿¼ë¦¬ì˜ ë§¤ì¹­:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ë§¤ì¹­ </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: trainIdx=</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="si">}</span><span class="s2">, distance=</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matches</span>

<span class="n">matches</span> <span class="o">=</span> <span class="n">bf_knn_matching</span><span class="p">(</span><span class="s1">&#39;query.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;train.jpg&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="3-flann">3. FLANN ê¸°ë°˜ ë§¤ì²˜<a class="header-link" href="#3-flann" title="Permanent link">&para;</a></h2>
<h3 id="_5">ê°œë…<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>FLANN (Fast Library for Approximate Nearest Neighbors):
ê·¼ì‚¬ ìµœê·¼ì ‘ ì´ì›ƒ ê²€ìƒ‰ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

íŠ¹ì§•:
<span class="k">-</span> BFMatcherë³´ë‹¤ ë¹ ë¦„ (ëŒ€ê·œëª¨ ë°ì´í„°)
<span class="k">-</span> ê·¼ì‚¬ ì•Œê³ ë¦¬ì¦˜ (100% ì •í™•í•˜ì§€ ì•ŠìŒ)
<span class="k">-</span> KD-Tree, K-Means Tree ë“± ì‚¬ìš©

ì¸ë±ìŠ¤ ìœ í˜•:
1. FLANN_INDEX_KDTREE (0): float ë””ìŠ¤í¬ë¦½í„°ìš©
2. FLANN_INDEX_LSH (6): ë°”ì´ë„ˆë¦¬ ë””ìŠ¤í¬ë¦½í„°ìš©
</code></pre></div>

<h3 id="flann">FLANN ì‚¬ìš©ë²•<a class="header-link" href="#flann" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">flann_matching_sift</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FLANN ë§¤ì¹­ (SIFT - float ë””ìŠ¤í¬ë¦½í„°)&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># FLANN íŒŒë¼ë¯¸í„° ì„¤ì • (KD-Tree)</span>
    <span class="n">FLANN_INDEX_KDTREE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">index_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">algorithm</span><span class="o">=</span><span class="n">FLANN_INDEX_KDTREE</span><span class="p">,</span>
        <span class="n">trees</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">)</span>
    <span class="n">search_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">checks</span><span class="o">=</span><span class="mi">50</span>  <span class="c1"># ê²€ìƒ‰ íšŸìˆ˜ (ë†’ì„ìˆ˜ë¡ ì •í™•, ëŠë¦¼)</span>
    <span class="p">)</span>

    <span class="c1"># FLANN ë§¤ì²˜ ìƒì„±</span>
    <span class="n">flann</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FlannBasedMatcher</span><span class="p">(</span><span class="n">index_params</span><span class="p">,</span> <span class="n">search_params</span><span class="p">)</span>

    <span class="c1"># k-ìµœê·¼ì ‘ ì´ì›ƒ ë§¤ì¹­</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">flann</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Lowe&#39;s ratio test</span>
    <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
            <span class="n">good_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ ë§¤ì¹­: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¢‹ì€ ë§¤ì¹­: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ê²°ê³¼ ê·¸ë¦¬ê¸°</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawMatches</span><span class="p">(</span>
        <span class="n">img1</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="n">kp2</span><span class="p">,</span>
        <span class="n">good_matches</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_NOT_DRAW_SINGLE_POINTS</span>
    <span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;FLANN Matches&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">good_matches</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">kp2</span>

<span class="n">matches</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">kp2</span> <span class="o">=</span> <span class="n">flann_matching_sift</span><span class="p">(</span><span class="s1">&#39;query.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;train.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="flann-for-orb">FLANN for ORB (ë°”ì´ë„ˆë¦¬)<a class="header-link" href="#flann-for-orb" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">flann_matching_orb</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FLANN ë§¤ì¹­ (ORB - ë°”ì´ë„ˆë¦¬ ë””ìŠ¤í¬ë¦½í„°)&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># FLANN íŒŒë¼ë¯¸í„° (LSH - ë°”ì´ë„ˆë¦¬ìš©)</span>
    <span class="n">FLANN_INDEX_LSH</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">index_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">algorithm</span><span class="o">=</span><span class="n">FLANN_INDEX_LSH</span><span class="p">,</span>
        <span class="n">table_number</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>        <span class="c1"># í•´ì‹œ í…Œì´ë¸” ìˆ˜</span>
        <span class="n">key_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>           <span class="c1"># í‚¤ í¬ê¸°</span>
        <span class="n">multi_probe_level</span><span class="o">=</span><span class="mi">1</span>    <span class="c1"># ë‹¤ì¤‘ í”„ë¡œë¸Œ ë ˆë²¨</span>
    <span class="p">)</span>
    <span class="n">search_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">checks</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">flann</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FlannBasedMatcher</span><span class="p">(</span><span class="n">index_params</span><span class="p">,</span> <span class="n">search_params</span><span class="p">)</span>

    <span class="c1"># ë””ìŠ¤í¬ë¦½í„°ë¥¼ float32ë¡œ ë³€í™˜ (FLANN ìš”êµ¬ì‚¬í•­)</span>
    <span class="n">des1</span> <span class="o">=</span> <span class="n">des1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">des2</span> <span class="o">=</span> <span class="n">des2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">matches</span> <span class="o">=</span> <span class="n">flann</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Ratio test</span>
    <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">pair</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
                <span class="n">good_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawMatches</span><span class="p">(</span>
        <span class="n">img1</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="n">kp2</span><span class="p">,</span>
        <span class="n">good_matches</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DRAW_MATCHES_FLAGS_NOT_DRAW_SINGLE_POINTS</span>
    <span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;FLANN ORB Matches&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">good_matches</span>

<span class="n">flann_matching_orb</span><span class="p">(</span><span class="s1">&#39;query.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;train.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="4">4. ê±°ë¦¬ ë©”íŠ¸ë¦­<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="_6">ê±°ë¦¬ ìœ í˜•<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ê±°ë¦¬ ë©”íŠ¸ë¦­ ë¹„êµ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  cv2.NORM_L1 (Manhattan Distance)                                 â”‚
â”‚  d = Î£|a_i - b_i|                                                  â”‚
â”‚  â†’ ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ                                                 â”‚
â”‚                                                                    â”‚
â”‚  cv2.NORM_L2 (Euclidean Distance)                                 â”‚
â”‚  d = âˆš(Î£(a_i - b_i)Â²)                                             â”‚
â”‚  â†’ SIFT, SURF ë“± float ë””ìŠ¤í¬ë¦½í„°ìš©                                â”‚
â”‚                                                                    â”‚
â”‚  cv2.NORM_HAMMING                                                  â”‚
â”‚  d = Î£(a_i XOR b_i)                                               â”‚
â”‚  â†’ ORB, BRIEF ë“± ë°”ì´ë„ˆë¦¬ ë””ìŠ¤í¬ë¦½í„°ìš© (256ë¹„íŠ¸)                   â”‚
â”‚                                                                    â”‚
â”‚  cv2.NORM_HAMMING2                                                 â”‚
â”‚  â†’ ORB (WTA_K=3,4) ìš©                                              â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="_7">ë””ìŠ¤í¬ë¦½í„°ë³„ ì¶”ì²œ ë©”íŠ¸ë¦­<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># ë””ìŠ¤í¬ë¦½í„°ë³„ ê¶Œì¥ ê±°ë¦¬ ë©”íŠ¸ë¦­</span>
<span class="n">descriptor_distance</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;SIFT&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_L2</span><span class="p">,</span>
    <span class="s1">&#39;SURF&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_L2</span><span class="p">,</span>
    <span class="s1">&#39;KAZE&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_L2</span><span class="p">,</span>
    <span class="s1">&#39;ORB&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span>
    <span class="s1">&#39;BRISK&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span>
    <span class="s1">&#39;AKAZE&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span>  <span class="c1"># ë°”ì´ë„ˆë¦¬ ëª¨ë“œ</span>
    <span class="s1">&#39;BRIEF&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span>
    <span class="s1">&#39;FREAK&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_matcher</span><span class="p">(</span><span class="n">descriptor_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë””ìŠ¤í¬ë¦½í„° ìœ í˜•ì— ë§ëŠ” ë§¤ì²˜ ë°˜í™˜&quot;&quot;&quot;</span>
    <span class="n">norm_type</span> <span class="o">=</span> <span class="n">descriptor_distance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">descriptor_type</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_L2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">norm_type</span><span class="p">,</span> <span class="n">crossCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="5">5. ë§¤ì¹­ í•„í„°ë§<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="lowes-ratio-test">Lowe's Ratio Test<a class="header-link" href="#lowes-ratio-test" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Lowe&#39;s Ratio Test:
ìµœê·¼ì ‘ ì´ì›ƒê³¼ ë‘ ë²ˆì§¸ ìµœê·¼ì ‘ ì´ì›ƒì˜ ê±°ë¦¬ ë¹„ìœ¨ë¡œ í•„í„°ë§

ì›ë¦¬:
ì¢‹ì€ ë§¤ì¹­ â†’ ìµœê·¼ì ‘ì´ í™•ì‹¤íˆ ê°€ê¹Œì›€ (ë¹„ìœ¨ ì‘ìŒ)
ë‚˜ìœ ë§¤ì¹­ â†’ ì—¬ëŸ¬ í›„ë³´ê°€ ë¹„ìŠ·í•œ ê±°ë¦¬ (ë¹„ìœ¨ í¼)

distance(best) / distance(second_best) &lt; threshold

ê¶Œì¥ threshold: 0.7 ~ 0.8
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lowe_ratio_test</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">,</span> <span class="n">ratio_thresh</span><span class="o">=</span><span class="mf">0.75</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lowe&#39;s ratio test ì ìš©&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Ratio test</span>
    <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">/</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span>
        <span class="k">if</span> <span class="n">ratio</span> <span class="o">&lt;</span> <span class="n">ratio_thresh</span><span class="p">:</span>
            <span class="n">good_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì „ì²´ ë§¤ì¹­: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ratio test í†µê³¼: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;í•„í„°ë§ ë¹„ìœ¨: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="c1"># ë§¤ì¹­ í’ˆì§ˆ ë¶„ì„</span>
    <span class="k">if</span> <span class="n">good_matches</span><span class="p">:</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good_matches</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;í‰ê·  ê±°ë¦¬: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê±°ë¦¬ í‘œì¤€í¸ì°¨: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">good_matches</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">kp2</span>

<span class="n">matches</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">kp2</span> <span class="o">=</span> <span class="n">lowe_ratio_test</span><span class="p">(</span><span class="s1">&#39;query.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;train.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="_8">ê±°ë¦¬ ê¸°ë°˜ í•„í„°ë§<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">distance_based_filtering</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">threshold_factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ê±°ë¦¬ ê¸°ë°˜ ë§¤ì¹­ í•„í„°ë§&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
    <span class="n">mean_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
    <span class="n">std_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

    <span class="c1"># í‰ê·  + k*í‘œì¤€í¸ì°¨ ì´í•˜ë§Œ ìœ ì§€</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">mean_dist</span> <span class="o">+</span> <span class="n">threshold_factor</span> <span class="o">*</span> <span class="n">std_dist</span>

    <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê±°ë¦¬ í‰ê· : </span><span class="si">{</span><span class="n">mean_dist</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê±°ë¦¬ í‘œì¤€í¸ì°¨: </span><span class="si">{</span><span class="n">std_dist</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì„ê³„ê°’: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;í•„í„°ë§ ê²°ê³¼: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">good_matches</span>
</code></pre></div>

<h3 id="symmetric-matching">ëŒ€ì¹­ ë§¤ì¹­ (Symmetric Matching)<a class="header-link" href="#symmetric-matching" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">symmetric_matching</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">norm_type</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">NORM_L2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ëŒ€ì¹­ ë§¤ì¹­ (Aâ†’Bì™€ Bâ†’A ëª¨ë‘ í™•ì¸)&quot;&quot;&quot;</span>
    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">norm_type</span><span class="p">)</span>

    <span class="c1"># A â†’ B ë§¤ì¹­</span>
    <span class="n">matches_ab</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># B â†’ A ë§¤ì¹­</span>
    <span class="n">matches_ba</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des2</span><span class="p">,</span> <span class="n">des1</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># ì–‘ë°©í–¥ ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ ì„ íƒ</span>
    <span class="n">symmetric</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m_ab</span> <span class="ow">in</span> <span class="n">matches_ab</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_ab</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">query_idx</span> <span class="o">=</span> <span class="n">m_ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">queryIdx</span>
        <span class="n">train_idx</span> <span class="o">=</span> <span class="n">m_ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trainIdx</span>

        <span class="c1"># Bâ†’A ë§¤ì¹­ì—ì„œ ì—­ë°©í–¥ í™•ì¸</span>
        <span class="k">for</span> <span class="n">m_ba</span> <span class="ow">in</span> <span class="n">matches_ba</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_ba</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">m_ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">queryIdx</span> <span class="o">==</span> <span class="n">train_idx</span> <span class="ow">and</span> <span class="n">m_ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trainIdx</span> <span class="o">==</span> <span class="n">query_idx</span><span class="p">:</span>
                <span class="n">symmetric</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_ab</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="n">symmetric</span>
</code></pre></div>

<hr />
<h2 id="6-homography-ransac">6. Homographyì™€ RANSAC<a class="header-link" href="#6-homography-ransac" title="Permanent link">&para;</a></h2>
<h3 id="homography">Homography ê°œë…<a class="header-link" href="#homography" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Homography (í˜¸ëª¨ê·¸ë˜í”¼):
í‰ë©´ ê°„ì˜ íˆ¬ì‹œ ë³€í™˜ì„ ë‚˜íƒ€ë‚´ëŠ” 3x3 í–‰ë ¬

â”Œ     â”   â”Œ           â” â”Œ   â”
â”‚ x&#39;  â”‚   â”‚ h11 h12 h13 â”‚ â”‚ x â”‚
â”‚ y&#39;  â”‚ = â”‚ h21 h22 h23 â”‚ â”‚ y â”‚
â”‚  1  â”‚   â”‚ h31 h32 h33 â”‚ â”‚ 1 â”‚
â””     â”˜   â””           â”˜ â””   â”˜

x&#39; = (h11*x + h12*y + h13) / (h31*x + h32*y + h33)
y&#39; = (h21*x + h22*y + h23) / (h31*x + h32*y + h33)

í™œìš©:
<span class="k">-</span> ê°ì²´ ìœ„ì¹˜ ì¶”ì •
<span class="k">-</span> ì´ë¯¸ì§€ ì •í•©
<span class="k">-</span> íŒŒë…¸ë¼ë§ˆ ìŠ¤í‹°ì¹­
<span class="k">-</span> AR ë§ˆì»¤ ê²€ì¶œ
</code></pre></div>

<h3 id="cv2findhomography">cv2.findHomography()<a class="header-link" href="#cv2findhomography" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">find_object_homography</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">,</span> <span class="n">min_matches</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í˜¸ëª¨ê·¸ë˜í”¼ë¡œ ê°ì²´ ì°¾ê¸°&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">)</span>  <span class="c1"># ì¿¼ë¦¬ (ì°¾ì„ ê°ì²´)</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">)</span>  <span class="c1"># íƒ€ê²Ÿ (ì¥ë©´)</span>

    <span class="n">gray1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">gray2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># SIFT íŠ¹ì§•ì  ë° ë§¤ì¹­</span>
    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Ratio test</span>
    <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
            <span class="n">good_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¢‹ì€ ë§¤ì¹­ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_matches</span><span class="p">:</span>
        <span class="c1"># ë§¤ì¹­ëœ ì  ì¢Œí‘œ ì¶”ì¶œ</span>
        <span class="n">src_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp1</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">queryIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good_matches</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp2</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good_matches</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># í˜¸ëª¨ê·¸ë˜í”¼ ê³„ì‚° (RANSAC)</span>
        <span class="n">H</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ì¿¼ë¦¬ ì´ë¯¸ì§€ì˜ ì½”ë„ˆë¥¼ ë³€í™˜</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">gray1</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">]</span>
            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">transformed_corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

            <span class="c1"># íƒ€ê²Ÿ ì´ë¯¸ì§€ì— ê°ì²´ ìœ„ì¹˜ í‘œì‹œ</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">img2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">polylines</span><span class="p">(</span>
                <span class="n">result</span><span class="p">,</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">transformed_corners</span><span class="p">)],</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="mi">3</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">LINE_AA</span>
            <span class="p">)</span>

            <span class="c1"># ë§¤ì¹­ ì‹œê°í™”</span>
            <span class="n">matches_mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">draw_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">matchColor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">singlePointColor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">matchesMask</span><span class="o">=</span><span class="n">matches_mask</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="mi">2</span>
            <span class="p">)</span>

            <span class="n">match_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawMatches</span><span class="p">(</span>
                <span class="n">img1</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="n">kp2</span><span class="p">,</span>
                <span class="n">good_matches</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">draw_params</span>
            <span class="p">)</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Object Detection&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Matches&#39;</span><span class="p">,</span> <span class="n">match_img</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># ì¸ë¼ì´ì–´ ë¹„ìœ¨</span>
            <span class="n">inliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¸ë¼ì´ì–´: </span><span class="si">{</span><span class="n">inliers</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¸ë¼ì´ì–´ ë¹„ìœ¨: </span><span class="si">{</span><span class="n">inliers</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">H</span><span class="p">,</span> <span class="n">transformed_corners</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë§¤ì¹­ ë¶€ì¡±: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">min_matches</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="n">H</span><span class="p">,</span> <span class="n">corners</span> <span class="o">=</span> <span class="n">find_object_homography</span><span class="p">(</span><span class="s1">&#39;book_cover.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;scene.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="ransac">RANSAC ì´í•´<a class="header-link" href="#ransac" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">RANSAC</span><span class="w"> </span><span class="ss">(</span><span class="k">RANdom</span><span class="w"> </span><span class="nv">SAmple</span><span class="w"> </span><span class="nv">Consensus</span><span class="ss">)</span>:
ì•„ì›ƒë¼ì´ì–´ê°€<span class="w"> </span>ìˆëŠ”<span class="w"> </span>ë°ì´í„°ì—ì„œ<span class="w"> </span>ëª¨ë¸<span class="w"> </span>ì¶”ì •

ì•Œê³ ë¦¬ì¦˜:
<span class="mi">1</span>.<span class="w"> </span>ìµœì†Œ<span class="w"> </span>ìƒ˜í”Œ<span class="w"> </span>ë¬´ì‘ìœ„<span class="w"> </span>ì„ íƒ<span class="w"> </span><span class="ss">(</span>í˜¸ëª¨ê·¸ë˜í”¼:<span class="w"> </span><span class="mi">4</span>ì <span class="ss">)</span>
<span class="mi">2</span>.<span class="w"> </span>ëª¨ë¸<span class="w"> </span>ê³„ì‚°
<span class="mi">3</span>.<span class="w"> </span>ëª¨ë“ <span class="w"> </span>ì ì—<span class="w"> </span>ëŒ€í•´<span class="w"> </span>ì—ëŸ¬<span class="w"> </span>ê³„ì‚°
<span class="mi">4</span>.<span class="w"> </span>ì„ê³„ê°’<span class="w"> </span>ì´ë‚´ì˜<span class="w"> </span>ì <span class="ss">(</span>ì¸ë¼ì´ì–´<span class="ss">)</span><span class="w"> </span>ìˆ˜<span class="w"> </span>ê³„ì‚°
<span class="mi">5</span>.<span class="w"> </span>ë°˜ë³µí•˜ì—¬<span class="w"> </span>ì¸ë¼ì´ì–´ê°€<span class="w"> </span>ê°€ì¥<span class="w"> </span>ë§ì€<span class="w"> </span>ëª¨ë¸<span class="w"> </span>ì„ íƒ
<span class="mi">6</span>.<span class="w"> </span>ì¸ë¼ì´ì–´ë¡œ<span class="w"> </span>ëª¨ë¸<span class="w"> </span>ì¬ê³„ì‚°<span class="w"> </span><span class="ss">(</span>ì˜µì…˜<span class="ss">)</span>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="w">  </span>â—<span class="w">  </span>â—<span class="w">  </span>â—<span class="w">  </span>â—<span class="w">  </span>â—<span class="w">                         </span>â”‚
â”‚<span class="w">     </span>â—<span class="w">  </span>â—<span class="w">  </span>â—<span class="w">        </span>â†<span class="w"> </span>ì¸ë¼ì´ì–´<span class="w"> </span><span class="ss">(</span>ì§ì„ <span class="w"> </span>ê·¼ì²˜<span class="ss">)</span><span class="w"> </span>â”‚
â”‚<span class="w">        </span>â—<span class="w">  </span>â—<span class="w">  </span>â—<span class="w">                         </span>â”‚
â”‚<span class="w">  </span>Ã—<span class="w">                                     </span>â”‚
â”‚<span class="w">           </span>Ã—<span class="w">        </span>â†<span class="w"> </span>ì•„ì›ƒë¼ì´ì–´<span class="w">          </span>â”‚
â”‚<span class="w">     </span>Ã—<span class="w">          </span>Ã—<span class="w">                       </span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="nv">findHomography</span><span class="w"> </span>íŒŒë¼ë¯¸í„°:
<span class="o">-</span><span class="w"> </span><span class="nv">cv2</span>.<span class="nv">RANSAC</span>:<span class="w"> </span><span class="nv">RANSAC</span><span class="w"> </span>ì‚¬ìš©
<span class="o">-</span><span class="w"> </span><span class="nv">ransacReprojThreshold</span>:<span class="w"> </span>ì¸ë¼ì´ì–´<span class="w"> </span>íŒì •<span class="w"> </span>ì„ê³„ê°’<span class="w"> </span><span class="ss">(</span>í”½ì…€<span class="ss">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">homography_methods_comparison</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¤ì–‘í•œ í˜¸ëª¨ê·¸ë˜í”¼ ê³„ì‚° ë°©ë²• ë¹„êµ&quot;&quot;&quot;</span>

    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Regular (LS)&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">,</span> <span class="s1">&#39;RANSAC&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">LMEDS</span><span class="p">,</span> <span class="s1">&#39;Least-Median&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">RHO</span><span class="p">,</span> <span class="s1">&#39;PROSAC&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">H</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span>
                <span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">,</span>
                <span class="n">method</span><span class="p">,</span>
                <span class="n">ransacReprojThreshold</span><span class="o">=</span><span class="mf">5.0</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">inliers</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">src_pts</span><span class="p">)</span><span class="si">}</span><span class="s2"> inliers&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: Failed&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: Error - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="7">7. ì´ë¯¸ì§€ ìŠ¤í‹°ì¹­ ê¸°ì´ˆ<a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="_9">ê°„ë‹¨í•œ íŒŒë…¸ë¼ë§ˆ<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">simple_panorama</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ê°„ë‹¨í•œ íŒŒë…¸ë¼ë§ˆ ìŠ¤í‹°ì¹­&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">)</span>  <span class="c1"># ì™¼ìª½ ì´ë¯¸ì§€</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">)</span>  <span class="c1"># ì˜¤ë¥¸ìª½ ì´ë¯¸ì§€</span>

    <span class="n">gray1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">gray2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># íŠ¹ì§•ì  ê²€ì¶œ ë° ë§¤ì¹­</span>
    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Ratio test</span>
    <span class="n">good</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
            <span class="n">good</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë§¤ì¹­ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">good</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë§¤ì¹­ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># í˜¸ëª¨ê·¸ë˜í”¼ ê³„ì‚°</span>
    <span class="n">src_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp1</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">queryIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp2</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">H</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;í˜¸ëª¨ê·¸ë˜í”¼ ê³„ì‚° ì‹¤íŒ¨&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># ì´ë¯¸ì§€ ì›Œí•‘</span>
    <span class="n">h1</span><span class="p">,</span> <span class="n">w1</span> <span class="o">=</span> <span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">h2</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># ê²°ê³¼ ì´ë¯¸ì§€ í¬ê¸° ê³„ì‚°</span>
    <span class="n">corners1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w1</span><span class="p">,</span> <span class="n">h1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h1</span><span class="p">]])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">corners1_transformed</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">corners1</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

    <span class="n">corners2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w2</span><span class="p">,</span> <span class="n">h2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h2</span><span class="p">]])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">all_corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">corners1_transformed</span><span class="p">,</span> <span class="n">corners2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">all_corners</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">all_corners</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

    <span class="c1"># ì´ë™ ë³€í™˜</span>
    <span class="n">translation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">x_min</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">y_min</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># ì´ë¯¸ì§€ 1 ì›Œí•‘</span>
    <span class="n">result_width</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
    <span class="n">result_height</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>

    <span class="n">warped1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span>
        <span class="n">img1</span><span class="p">,</span>
        <span class="n">translation</span> <span class="o">@</span> <span class="n">H</span><span class="p">,</span>
        <span class="p">(</span><span class="n">result_width</span><span class="p">,</span> <span class="n">result_height</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># ì´ë¯¸ì§€ 2 ë³µì‚¬</span>
    <span class="n">warped1</span><span class="p">[</span><span class="o">-</span><span class="n">y_min</span><span class="p">:</span><span class="o">-</span><span class="n">y_min</span><span class="o">+</span><span class="n">h2</span><span class="p">,</span> <span class="o">-</span><span class="n">x_min</span><span class="p">:</span><span class="o">-</span><span class="n">x_min</span><span class="o">+</span><span class="n">w2</span><span class="p">]</span> <span class="o">=</span> <span class="n">img2</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Panorama&#39;</span><span class="p">,</span> <span class="n">warped1</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">warped1</span>

<span class="n">panorama</span> <span class="o">=</span> <span class="n">simple_panorama</span><span class="p">(</span><span class="s1">&#39;left.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;right.jpg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="opencv-stitcher">OpenCV Stitcher ì‚¬ìš©<a class="header-link" href="#opencv-stitcher" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">opencv_stitcher</span><span class="p">(</span><span class="n">image_paths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OpenCV Stitcher í´ë˜ìŠ¤ ì‚¬ìš©&quot;&quot;&quot;</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">image_paths</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ìµœì†Œ 2ê°œì˜ ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Stitcher ìƒì„±</span>
    <span class="n">stitcher</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Stitcher_create</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">Stitcher_PANORAMA</span><span class="p">)</span>
    <span class="c1"># ë˜ëŠ”: cv2.Stitcher_SCANS (ë¬¸ì„œ ìŠ¤ìº”ìš©)</span>

    <span class="c1"># ìŠ¤í‹°ì¹­ ìˆ˜í–‰</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">stitcher</span><span class="o">.</span><span class="n">stitch</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Stitcher_OK</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ìŠ¤í‹°ì¹­ ì„±ê³µ!&quot;</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Stitched&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Stitcher_ERR_NEED_MORE_IMGS</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë” ë§ì€ ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Stitcher_ERR_HOMOGRAPHY_EST_FAIL</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;í˜¸ëª¨ê·¸ë˜í”¼ ì¶”ì • ì‹¤íŒ¨&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Stitcher_ERR_CAMERA_PARAMS_ADJUST_FAIL</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„° ì¡°ì • ì‹¤íŒ¨&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">image_files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pano1.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;pano2.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;pano3.jpg&#39;</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">opencv_stitcher</span><span class="p">(</span><span class="n">image_files</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="8">8. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="1_1">ë¬¸ì œ 1: ìµœì  ë§¤ì¹­ íŒŒë¼ë¯¸í„° ì°¾ê¸°<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>ë‹¤ì–‘í•œ ratio threshold ê°’ì„ í…ŒìŠ¤íŠ¸í•˜ì—¬ ìµœì ì˜ ê°’ì„ ì°¾ìœ¼ì„¸ìš”.</p>
<details>
<summary>ì •ë‹µ ì½”ë“œ</summary>


<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">find_optimal_ratio</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">img2_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ìµœì ì˜ ratio threshold ì°¾ê¸°&quot;&quot;&quot;</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
    <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">ratios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="n">ratios</span><span class="p">:</span>
        <span class="n">good</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">ratio</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">good</span><span class="p">))</span>

    <span class="c1"># ê·¸ë˜í”„</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ratios</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="s1">&#39;b-o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ratio Threshold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Matches&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ratio Threshold vs Match Count&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># ê¸°ìš¸ê¸° ë³€í™” ë¶„ì„</span>
    <span class="n">gradients</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">optimal_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gradients</span><span class="p">))</span>
    <span class="n">optimal_ratio</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">optimal_idx</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê¶Œì¥ ratio threshold: </span><span class="si">{</span><span class="n">optimal_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">optimal_ratio</span>

<span class="n">optimal</span> <span class="o">=</span> <span class="n">find_optimal_ratio</span><span class="p">(</span><span class="s1">&#39;query.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;train.jpg&#39;</span><span class="p">)</span>
</code></pre></div>



</details>

<h3 id="2">ë¬¸ì œ 2: ë‹¤ì¤‘ ê°ì²´ ê²€ì¶œ<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<p>í•œ ì¥ë©´ì—ì„œ ê°™ì€ ê°ì²´ê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ë•Œ ëª¨ë‘ ê²€ì¶œí•˜ì„¸ìš”.</p>
<details>
<summary>ì •ë‹µ ì½”ë“œ</summary>


<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">detect_multiple_objects</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="n">scene_path</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì—¬ëŸ¬ ê°œì˜ ë™ì¼ ê°ì²´ ê²€ì¶œ&quot;&quot;&quot;</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">template_path</span><span class="p">)</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">scene_path</span><span class="p">)</span>

    <span class="n">gray_t</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">gray_s</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
    <span class="n">kp_t</span><span class="p">,</span> <span class="n">des_t</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray_t</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kp_s</span><span class="p">,</span> <span class="n">des_s</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray_s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
    <span class="n">all_matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des_t</span><span class="p">,</span> <span class="n">des_s</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Ratio test</span>
    <span class="n">good_matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">all_matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
            <span class="n">good_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë§¤ì¹­ ë¶€ì¡±&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># í´ëŸ¬ìŠ¤í„°ë§ìœ¼ë¡œ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ì°¾ê¸°</span>
    <span class="n">scene_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kp_s</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good_matches</span><span class="p">])</span>

    <span class="c1"># K-means í´ëŸ¬ìŠ¤í„°ë§</span>
    <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_EPS</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_MAX_ITER</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">good_matches</span><span class="p">)</span> <span class="o">//</span> <span class="n">threshold</span><span class="p">)</span>  <span class="c1"># ìµœëŒ€ 5ê°œ ê°ì²´</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">centers</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">kmeans</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">scene_pts</span><span class="p">),</span>
        <span class="n">k</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">,</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">KMEANS_RANDOM_CENTERS</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">detected</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">cluster_mask</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">==</span> <span class="n">cluster_id</span>
        <span class="n">cluster_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">is_in</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">good_matches</span><span class="p">,</span> <span class="n">cluster_mask</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_in</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_matches</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># ê° í´ëŸ¬ìŠ¤í„°ì—ì„œ í˜¸ëª¨ê·¸ë˜í”¼ ê³„ì‚°</span>
            <span class="n">src_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp_t</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">queryIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">cluster_matches</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp_s</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">cluster_matches</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">H</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">gray_t</span><span class="o">.</span><span class="n">shape</span>
                <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">]])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">transformed</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

                <span class="n">cv2</span><span class="o">.</span><span class="n">polylines</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">transformed</span><span class="p">)],</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">detected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transformed</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê²€ì¶œëœ ê°ì²´ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detected</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Multiple Objects&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">detected</span>

<span class="n">detect_multiple_objects</span><span class="p">(</span><span class="s1">&#39;coin.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;coins.jpg&#39;</span><span class="p">)</span>
</code></pre></div>



</details>

<h3 id="3">ë¬¸ì œ 3: ì‹¤ì‹œê°„ ê°ì²´ ì¶”ì <a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p>ì›¹ìº ì—ì„œ í…œí”Œë¦¿ ê°ì²´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•˜ì„¸ìš”.</p>
<details>
<summary>ì •ë‹µ ì½”ë“œ</summary>


<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">realtime_object_tracking</span><span class="p">(</span><span class="n">template_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹¤ì‹œê°„ ê°ì²´ ì¶”ì &quot;&quot;&quot;</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># ORB ì‚¬ìš© (ë¹ ë¦„)</span>
    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">(</span><span class="n">nfeatures</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">kp_t</span><span class="p">,</span> <span class="n">des_t</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">bf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">NORM_HAMMING</span><span class="p">,</span> <span class="n">crossCheck</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">kp_f</span><span class="p">,</span> <span class="n">des_f</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">des_f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">des_f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des_t</span><span class="p">,</span> <span class="n">des_f</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Ratio test</span>
            <span class="n">good</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">pair</span>
                    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
                        <span class="n">good</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">good</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">src_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp_t</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">queryIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">dst_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp_f</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">good</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

                <span class="n">H</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span><span class="n">src_pts</span><span class="p">,</span> <span class="n">dst_pts</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">]])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">transformed</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
                    <span class="n">cv2</span><span class="o">.</span><span class="n">polylines</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">transformed</span><span class="p">)],</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

                    <span class="c1"># ë§¤ì¹­ ìˆ˜ í‘œì‹œ</span>
                    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Matches: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">good</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                                <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Tracking&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># realtime_object_tracking(&#39;logo.jpg&#39;)</span>
</code></pre></div>



</details>

<h3 id="_10">ì¶”ì²œ ë¬¸ì œ<a class="header-link" href="#_10" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ë‚œì´ë„</th>
<th>ì£¼ì œ</th>
<th>ì„¤ëª…</th>
</tr>
</thead>
<tbody>
<tr>
<td>â­</td>
<td>ê¸°ë³¸ ë§¤ì¹­</td>
<td>ë‘ ì´ë¯¸ì§€ ê°„ íŠ¹ì§•ì  ë§¤ì¹­</td>
</tr>
<tr>
<td>â­â­</td>
<td>í•„í„°ë§</td>
<td>Ratio test, ê±°ë¦¬ í•„í„°ë§</td>
</tr>
<tr>
<td>â­â­</td>
<td>ê°ì²´ ê²€ì¶œ</td>
<td>í˜¸ëª¨ê·¸ë˜í”¼ë¡œ ê°ì²´ ì°¾ê¸°</td>
</tr>
<tr>
<td>â­â­â­</td>
<td>íŒŒë…¸ë¼ë§ˆ</td>
<td>2ì¥ ì´ìƒ ì´ë¯¸ì§€ ìŠ¤í‹°ì¹­</td>
</tr>
<tr>
<td>â­â­â­</td>
<td>ì‹¤ì‹œê°„ ì¶”ì </td>
<td>ì›¹ìº ìœ¼ë¡œ ê°ì²´ ì¶”ì </td>
</tr>
</tbody>
</table>
<hr />
<h2 id="_11">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_11" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./15_Object_Detection_Basics.md">15_Object_Detection_Basics.md</a> - Template Matching, Haar Cascade, HOG+SVM</li>
</ul>
<hr />
<h2 id="_12">ì°¸ê³  ìë£Œ<a class="header-link" href="#_12" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.opencv.org/4.x/dc/dc3/tutorial_py_matcher.html">OpenCV Feature Matching</a></li>
<li><a href="https://docs.opencv.org/4.x/d1/de0/tutorial_py_feature_homography.html">Homography Tutorial</a></li>
<li><a href="https://docs.opencv.org/4.x/d8/d19/tutorial_stitcher.html">Image Stitching</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/13_Feature_Detection.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">íŠ¹ì§•ì  ê²€ì¶œ (Feature Detection)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/15_Object_Detection_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ê°ì²´ ê²€ì¶œ ê¸°ì´ˆ (Object Detection Basics)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}