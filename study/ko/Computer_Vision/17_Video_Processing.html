{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ë””ì˜¤ ì²˜ë¦¬ (Video Processing) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Computer_Vision/">Computer Vision</a>
    <span class="separator">/</span>
    <span class="current">ë¹„ë””ì˜¤ ì²˜ë¦¬ (Video Processing)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ë¹„ë””ì˜¤ ì²˜ë¦¬ (Video Processing)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/16_Face_Detection.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ì–¼êµ´ ê²€ì¶œ ë° ì¸ì‹ (Face Detection and Recognition)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/18_Camera_Calibration.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ (Camera Calibration)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ê°œìš”</a></li>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1-videocapture">1. VideoCapture: íŒŒì¼ê³¼ ì¹´ë©”ë¼</a><ul>
<li><a href="#_3">ë¹„ë””ì˜¤ êµ¬ì¡° ì´í•´</a></li>
<li><a href="#_4">ë¹„ë””ì˜¤ íŒŒì¼ ì½ê¸°</a></li>
<li><a href="#_5">ì¹´ë©”ë¼ ì…ë ¥</a></li>
<li><a href="#videocapture">ì£¼ìš” VideoCapture ì†ì„±</a></li>
</ul>
</li>
<li><a href="#2-videowriter">2. VideoWriter: ë¹„ë””ì˜¤ ì €ì¥</a><ul>
<li><a href="#_6">ê¸°ë³¸ ë¹„ë””ì˜¤ ì €ì¥</a></li>
<li><a href="#_7">ì£¼ìš” ì½”ë±</a></li>
<li><a href="#_8">ì²˜ë¦¬ëœ ë¹„ë””ì˜¤ ì €ì¥</a></li>
</ul>
</li>
<li><a href="#3">3. í”„ë ˆì„ ë‹¨ìœ„ ì²˜ë¦¬</a><ul>
<li><a href="#_9">í”„ë ˆì„ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸</a></li>
<li><a href="#_10">ë‹¤ì¤‘ ì²˜ë¦¬ ì˜ˆì œ</a></li>
<li><a href="#_11">í”„ë ˆì„ ê±´ë„ˆë›°ê¸°ì™€ ë²„í¼ë§</a></li>
</ul>
</li>
<li><a href="#4-fps">4. FPS ê³„ì‚°</a><ul>
<li><a href="#fps">FPS ì¸¡ì • ë°©ë²•</a></li>
<li><a href="#_12">ì²˜ë¦¬ ì‹œê°„ ë¶„ì„</a></li>
</ul>
</li>
<li><a href="#5-mog2-knn">5. ë°°ê²½ ì°¨ë¶„ (MOG2, KNN)</a><ul>
<li><a href="#_13">ë°°ê²½ ì°¨ë¶„ ì›ë¦¬</a></li>
<li><a href="#mog2-mixture-of-gaussians">MOG2 (Mixture of Gaussians)</a></li>
<li><a href="#knn">KNN ë°°ê²½ ì°¨ë¶„</a></li>
<li><a href="#mog2-vs-knn">MOG2 vs KNN ë¹„êµ</a></li>
</ul>
</li>
<li><a href="#6">6. ì˜µí‹°ì»¬ í”Œë¡œìš°</a><ul>
<li><a href="#_14">ì˜µí‹°ì»¬ í”Œë¡œìš° ê°œë…</a></li>
<li><a href="#lucas-kanade">Lucas-Kanade ì˜µí‹°ì»¬ í”Œë¡œìš°</a></li>
<li><a href="#farneback">Farneback ë°€ì§‘ ì˜µí‹°ì»¬ í”Œë¡œìš°</a></li>
</ul>
</li>
<li><a href="#7">7. ê°ì²´ ì¶”ì </a><ul>
<li><a href="#opencv">OpenCV ë‚´ì¥ íŠ¸ë˜ì»¤</a></li>
<li><a href="#_15">ë‹¤ì¤‘ ê°ì²´ ì¶”ì </a></li>
<li><a href="#_16">ë°°ê²½ ì°¨ë¶„ + ì¶”ì  ê²°í•©</a></li>
</ul>
</li>
<li><a href="#8">8. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1">ë¬¸ì œ 1: ë¹„ë””ì˜¤ í”Œë ˆì´ì–´</a></li>
<li><a href="#2">ë¬¸ì œ 2: ì›€ì§ì„ íˆíŠ¸ë§µ</a></li>
<li><a href="#3_1">ë¬¸ì œ 3: ì†ë„ ì¸¡ì •</a></li>
<li><a href="#4">ë¬¸ì œ 4: ì°¨ëŸ‰ ê³„ìˆ˜ê¸°</a></li>
<li><a href="#5">ë¬¸ì œ 5: ë™ì‘ ì¸ì‹</a></li>
</ul>
</li>
<li><a href="#_17">ë‹¤ìŒ ë‹¨ê³„</a></li>
<li><a href="#_18">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="video-processing">ë¹„ë””ì˜¤ ì²˜ë¦¬ (Video Processing)<a class="header-link" href="#video-processing" title="Permanent link">&para;</a></h1>
<h2 id="_1">ê°œìš”<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>ë¹„ë””ì˜¤ëŠ” ì—°ì†ëœ ì´ë¯¸ì§€ í”„ë ˆì„ì˜ ì‹œí€€ìŠ¤ì…ë‹ˆë‹¤. OpenCVë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë””ì˜¤ íŒŒì¼ê³¼ ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ì„ ì²˜ë¦¬í•˜ê³ , ë°°ê²½ ì°¨ë¶„ê³¼ ì˜µí‹°ì»¬ í”Œë¡œìš°ë¥¼ ì´ìš©í•œ ë™ì‘ ë¶„ì„ ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.</p>
<p><strong>ë‚œì´ë„</strong>: â­â­â­</p>
<p><strong>ì„ ìˆ˜ ì§€ì‹</strong>: ì´ë¯¸ì§€ ê¸°ì´ˆ ì—°ì‚°, í•„í„°ë§, ê°ì²´ ê²€ì¶œ</p>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-videocapture-íŒŒì¼ê³¼-ì¹´ë©”ë¼">VideoCapture: íŒŒì¼ê³¼ ì¹´ë©”ë¼</a></li>
<li><a href="#2-videowriter-ë¹„ë””ì˜¤-ì €ì¥">VideoWriter: ë¹„ë””ì˜¤ ì €ì¥</a></li>
<li><a href="#3-í”„ë ˆì„-ë‹¨ìœ„-ì²˜ë¦¬">í”„ë ˆì„ ë‹¨ìœ„ ì²˜ë¦¬</a></li>
<li><a href="#4-fps-ê³„ì‚°">FPS ê³„ì‚°</a></li>
<li><a href="#5-ë°°ê²½-ì°¨ë¶„-mog2-knn">ë°°ê²½ ì°¨ë¶„ (MOG2, KNN)</a></li>
<li><a href="#6-ì˜µí‹°ì»¬-í”Œë¡œìš°">ì˜µí‹°ì»¬ í”Œë¡œìš°</a></li>
<li><a href="#7-ê°ì²´-ì¶”ì ">ê°ì²´ ì¶”ì </a></li>
<li><a href="#8-ì—°ìŠµ-ë¬¸ì œ">ì—°ìŠµ ë¬¸ì œ</a></li>
</ol>
<hr />
<h2 id="1-videocapture">1. VideoCapture: íŒŒì¼ê³¼ ì¹´ë©”ë¼<a class="header-link" href="#1-videocapture" title="Permanent link">&para;</a></h2>
<h3 id="_3">ë¹„ë””ì˜¤ êµ¬ì¡° ì´í•´<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ë¹„ë””ì˜¤ = ì—°ì†ëœ ì´ë¯¸ì§€ í”„ë ˆì„

ì‹œê°„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
    â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”
    â”‚Frameâ”‚â”‚Frameâ”‚â”‚Frameâ”‚â”‚Frameâ”‚â”‚Frameâ”‚ ...
    â”‚  1  â”‚â”‚  2  â”‚â”‚  3  â”‚â”‚  4  â”‚â”‚  5  â”‚
    â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜

FPS (Frames Per Second): ì´ˆë‹¹ í”„ë ˆì„ ìˆ˜
- 24 FPS: ì˜í™” í‘œì¤€
- 30 FPS: ì¼ë°˜ ë¹„ë””ì˜¤
- 60 FPS: ê²Œì„, ìŠ¤í¬ì¸ 
- 120+ FPS: ìŠ¬ë¡œëª¨ì…˜

í•´ìƒë„: ê° í”„ë ˆì„ì˜ í¬ê¸°
- 640x480: VGA
- 1280x720: HD (720p)
- 1920x1080: Full HD (1080p)
- 3840x2160: 4K
</code></pre></div>

<h3 id="_4">ë¹„ë””ì˜¤ íŒŒì¼ ì½ê¸°<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># ë¹„ë””ì˜¤ íŒŒì¼ ì—´ê¸°</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="s1">&#39;video.mp4&#39;</span><span class="p">)</span>

<span class="c1"># ì—´ê¸° ì„±ê³µ í™•ì¸</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë¹„ë””ì˜¤ë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">()</span>

<span class="c1"># ë¹„ë””ì˜¤ ì†ì„± ê°€ì ¸ì˜¤ê¸°</span>
<span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span>
<span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span>
<span class="n">fps</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">)</span>
<span class="n">frame_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">))</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">frame_count</span> <span class="o">/</span> <span class="n">fps</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;í•´ìƒë„: </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FPS: </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ í”„ë ˆì„: </span><span class="si">{</span><span class="n">frame_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¬ìƒ ì‹œê°„: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">ì´ˆ&quot;</span><span class="p">)</span>

<span class="c1"># í”„ë ˆì„ ì½ê¸° ë£¨í”„</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë¹„ë””ì˜¤ ë ë˜ëŠ” ì—ëŸ¬&quot;</span><span class="p">)</span>
        <span class="k">break</span>

    <span class="c1"># í”„ë ˆì„ ì²˜ë¦¬</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Video&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

    <span class="c1"># &#39;q&#39; í‚¤ë¡œ ì¢…ë£Œ, 1ms ëŒ€ê¸°</span>
    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="c1"># ìì› í•´ì œ</span>
<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="_5">ì¹´ë©”ë¼ ì…ë ¥<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># ì¹´ë©”ë¼ ì—´ê¸° (ì¥ì¹˜ ID: 0=ê¸°ë³¸ ì¹´ë©”ë¼)</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># ì¹´ë©”ë¼ ì—´ê¸° ì‹¤íŒ¨ ì‹œ</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì¹´ë©”ë¼ë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">()</span>

<span class="c1"># ì¹´ë©”ë¼ ì†ì„± ì„¤ì •</span>
<span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">,</span> <span class="mi">640</span><span class="p">)</span>
<span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">,</span> <span class="mi">480</span><span class="p">)</span>
<span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># ë²„í¼ í¬ê¸° ì„¤ì • (ì§€ì—° ê°ì†Œ)</span>
<span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_BUFFERSIZE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì¹´ë©”ë¼ í•´ìƒë„: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span><span class="si">}</span><span class="s2">x&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="c1"># ì¢Œìš° ë°˜ì „ (ê±°ìš¸ íš¨ê³¼)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Camera&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="videocapture">ì£¼ìš” VideoCapture ì†ì„±<a class="header-link" href="#videocapture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="s1">&#39;video.mp4&#39;</span><span class="p">)</span>

<span class="c1"># ì½ê¸° ì†ì„±</span>
<span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;CAP_PROP_FRAME_WIDTH&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">,</span>    <span class="c1"># í”„ë ˆì„ ë„ˆë¹„</span>
    <span class="s1">&#39;CAP_PROP_FRAME_HEIGHT&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">,</span>  <span class="c1"># í”„ë ˆì„ ë†’ì´</span>
    <span class="s1">&#39;CAP_PROP_FPS&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">,</span>                    <span class="c1"># FPS</span>
    <span class="s1">&#39;CAP_PROP_FRAME_COUNT&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">,</span>    <span class="c1"># ì´ í”„ë ˆì„ ìˆ˜</span>
    <span class="s1">&#39;CAP_PROP_POS_FRAMES&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_POS_FRAMES</span><span class="p">,</span>      <span class="c1"># í˜„ì¬ í”„ë ˆì„ ìœ„ì¹˜</span>
    <span class="s1">&#39;CAP_PROP_POS_MSEC&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_POS_MSEC</span><span class="p">,</span>          <span class="c1"># í˜„ì¬ ìœ„ì¹˜ (ë°€ë¦¬ì´ˆ)</span>
    <span class="s1">&#39;CAP_PROP_FOURCC&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FOURCC</span><span class="p">,</span>              <span class="c1"># ì½”ë± 4ë¬¸ì ì½”ë“œ</span>
    <span class="s1">&#39;CAP_PROP_BRIGHTNESS&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_BRIGHTNESS</span><span class="p">,</span>      <span class="c1"># ë°ê¸° (ì¹´ë©”ë¼)</span>
    <span class="s1">&#39;CAP_PROP_CONTRAST&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_CONTRAST</span><span class="p">,</span>          <span class="c1"># ëŒ€ë¹„ (ì¹´ë©”ë¼)</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># íŠ¹ì • í”„ë ˆì„ìœ¼ë¡œ ì´ë™</span>
<span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_POS_FRAMES</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># 100ë²ˆì§¸ í”„ë ˆì„ìœ¼ë¡œ</span>

<span class="c1"># íŠ¹ì • ì‹œê°„ìœ¼ë¡œ ì´ë™ (ë°€ë¦¬ì´ˆ)</span>
<span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_POS_MSEC</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>  <span class="c1"># 5ì´ˆ ìœ„ì¹˜ë¡œ</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="2-videowriter">2. VideoWriter: ë¹„ë””ì˜¤ ì €ì¥<a class="header-link" href="#2-videowriter" title="Permanent link">&para;</a></h2>
<h3 id="_6">ê¸°ë³¸ ë¹„ë””ì˜¤ ì €ì¥<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># ë¹„ë””ì˜¤ ìº¡ì²˜ ì„¤ì •</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># ë¹„ë””ì˜¤ ì†ì„±</span>
<span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span>
<span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span>
<span class="n">fps</span> <span class="o">=</span> <span class="mf">30.0</span>

<span class="c1"># ì½”ë± ì„¤ì • (4ë¬¸ì ì½”ë“œ)</span>
<span class="c1"># &#39;XVID&#39;: AVI ì»¨í…Œì´ë„ˆìš©</span>
<span class="c1"># &#39;mp4v&#39;: MP4 ì»¨í…Œì´ë„ˆìš©</span>
<span class="c1"># &#39;MJPG&#39;: Motion JPEG</span>
<span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;mp4v&#39;</span><span class="p">)</span>

<span class="c1"># VideoWriter ìƒì„±</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="s1">&#39;output.mp4&#39;</span><span class="p">,</span> <span class="n">fourcc</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë…¹í™” ì‹œì‘... &#39;q&#39;ë¥¼ ëˆŒëŸ¬ ì¢…ë£Œ&quot;</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="c1"># í”„ë ˆì„ ì €ì¥</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="c1"># ë…¹í™” í‘œì‹œ</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># ë¹¨ê°„ ì›</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="s1">&#39;REC&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Recording&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="c1"># ìì› í•´ì œ</span>
<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">out</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë…¹í™” ì™„ë£Œ: output.mp4&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="_7">ì£¼ìš” ì½”ë±<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì½”ë±      â”‚  ì»¨í…Œì´ë„ˆ   â”‚         íŠ¹ì§•           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ &#39;XVID&#39;      â”‚ .avi        â”‚ ë„ë¦¬ ì§€ì›, ì ë‹¹í•œ ì••ì¶• â”‚
â”‚ &#39;MJPG&#39;      â”‚ .avi        â”‚ Motion JPEG, ë¹ ë¦„      â”‚
â”‚ &#39;mp4v&#39;      â”‚ .mp4        â”‚ MPEG-4, í˜¸í™˜ì„± ì¢‹ìŒ    â”‚
â”‚ &#39;avc1&#39;      â”‚ .mp4        â”‚ H.264, ê³ ì••ì¶•ë¥         â”‚
â”‚ &#39;X264&#39;      â”‚ .mp4        â”‚ H.264 (ìš”êµ¬ì‚¬í•­ ìˆìŒ)  â”‚
â”‚ &#39;VP80&#39;      â”‚ .webm       â”‚ VP8, ì›¹ìš©              â”‚
â”‚ &#39;VP90&#39;      â”‚ .webm       â”‚ VP9, ê³ íš¨ìœ¨            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="gh">#</span> ì½”ë± í…ŒìŠ¤íŠ¸
def test_codec(codec_str, extension):
    fourcc = cv2.VideoWriter_fourcc(*codec_str)
    out = cv2.VideoWriter(f&#39;test.{extension}&#39;, fourcc, 30, (640, 480))
    if out.isOpened():
        print(f&quot;{codec_str}: ì§€ì›ë¨&quot;)
        out.release()
        return True
    else:
        print(f&quot;{codec_str}: ì§€ì› ì•ˆ ë¨&quot;)
        return False
</code></pre></div>

<h3 id="_8">ì²˜ë¦¬ëœ ë¹„ë””ì˜¤ ì €ì¥<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">process_and_save_video</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">process_func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ ì²˜ë¦¬ í›„ ì €ì¥&quot;&quot;&quot;</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span>

    <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">)</span>
    <span class="n">total_frames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">))</span>

    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;mp4v&#39;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">fourcc</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

    <span class="n">frame_num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># í”„ë ˆì„ ì²˜ë¦¬</span>
        <span class="n">processed</span> <span class="o">=</span> <span class="n">process_func</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># ì €ì¥</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>

        <span class="c1"># ì§„í–‰ë¥  í‘œì‹œ</span>
        <span class="n">frame_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_num</span> <span class="o">/</span> <span class="n">total_frames</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">ì²˜ë¦¬ ì¤‘: </span><span class="si">{</span><span class="n">progress</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ì™„ë£Œ!&quot;</span><span class="p">)</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">out</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ: ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜ ë° ì—£ì§€ ê²€ì¶œ</span>
<span class="k">def</span><span class="w"> </span><span class="nf">edge_detection</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
    <span class="c1"># 3ì±„ë„ë¡œ ë³€í™˜ (VideoWriterëŠ” ì»¬ëŸ¬ ë¹„ë””ì˜¤ë¡œ ì„¤ì •ë¨)</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_GRAY2BGR</span><span class="p">)</span>

<span class="n">process_and_save_video</span><span class="p">(</span><span class="s1">&#39;input.mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;edges.mp4&#39;</span><span class="p">,</span> <span class="n">edge_detection</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="3">3. í”„ë ˆì„ ë‹¨ìœ„ ì²˜ë¦¬<a class="header-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="_9">í”„ë ˆì„ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>í”„ë ˆì„ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸:

ì…ë ¥ â”€â”€â–¶ ì „ì²˜ë¦¬ â”€â”€â–¶ ë¶„ì„ â”€â”€â–¶ í›„ì²˜ë¦¬ â”€â”€â–¶ ì¶œë ¥
         â”‚          â”‚         â”‚
         â–¼          â–¼         â–¼
      - ë¦¬ì‚¬ì´ì¦ˆ  - ê²€ì¶œ    - ì‹œê°í™”
      - ìƒ‰ ë³€í™˜  - ì¶”ì     - í•„í„°ë§
      - ë…¸ì´ì¦ˆ   - ì¸ì‹    - í•©ì„±
        ì œê±°
</code></pre></div>

<h3 id="_10">ë‹¤ì¤‘ ì²˜ë¦¬ ì˜ˆì œ<a class="header-link" href="#_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">VideoProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ í”„ë ˆì„ ì²˜ë¦¬ê¸°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì²˜ë¦¬ í•¨ìˆ˜ ì¶”ê°€&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ëª¨ë“  ì²˜ë¦¬ í•¨ìˆ˜ ì ìš©&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processors</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_video</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_source</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ ì²˜ë¦¬&quot;&quot;&quot;</span>
        <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">input_source</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span>
            <span class="n">fps</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">)</span>
            <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;mp4v&#39;</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">fourcc</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="c1"># ì²˜ë¦¬</span>
            <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

            <span class="c1"># ì €ì¥</span>
            <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>

            <span class="c1"># í‘œì‹œ</span>
            <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Processed&#39;</span><span class="p">,</span> <span class="n">processed</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
                    <span class="k">break</span>

        <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">VideoProcessor</span><span class="p">()</span>

<span class="c1"># ì²˜ë¦¬ í•¨ìˆ˜ë“¤ ì¶”ê°€</span>
<span class="n">processor</span><span class="o">.</span><span class="n">add_processor</span><span class="p">(</span><span class="s1">&#39;blur&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">processor</span><span class="o">.</span><span class="n">add_processor</span><span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">add_timestamp</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span>

<span class="n">processor</span><span class="o">.</span><span class="n">add_processor</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">add_timestamp</span><span class="p">)</span>

<span class="c1"># ì›¹ìº  ì²˜ë¦¬</span>
<span class="n">processor</span><span class="o">.</span><span class="n">process_video</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;recorded.mp4&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="_11">í”„ë ˆì„ ê±´ë„ˆë›°ê¸°ì™€ ë²„í¼ë§<a class="header-link" href="#_11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">skip_frames_processing</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í”„ë ˆì„ ê±´ë„ˆë›°ê¸° (ì†ë„ í–¥ìƒ)&quot;&quot;&quot;</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>

    <span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># skip í”„ë ˆì„ë§ˆë‹¤ ì²˜ë¦¬</span>
        <span class="k">if</span> <span class="n">frame_count</span> <span class="o">%</span> <span class="n">skip</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># ë¬´ê±°ìš´ ì²˜ë¦¬ ìˆ˜í–‰</span>
        <span class="n">processed</span> <span class="o">=</span> <span class="n">heavy_processing</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Skipped Processing&#39;</span><span class="p">,</span> <span class="n">processed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">buffered_reading</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í”„ë ˆì„ ë²„í¼ë§ (ìŠ¤ë¬´ìŠ¤í•œ ì¬ìƒ)&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Thread</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">buffer_size</span><span class="p">)</span>
    <span class="n">stop_flag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">read_frames</span><span class="p">():</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_flag</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">buffer_size</span><span class="p">:</span>
                <span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="c1"># ì½ê¸° ìŠ¤ë ˆë“œ ì‹œì‘</span>
    <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">read_frames</span><span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># ì´ˆê¸° ë²„í¼ ì±„ìš°ê¸° ëŒ€ê¸°</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Buffered&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">stop_flag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="4-fps">4. FPS ê³„ì‚°<a class="header-link" href="#4-fps" title="Permanent link">&para;</a></h2>
<h3 id="fps">FPS ì¸¡ì • ë°©ë²•<a class="header-link" href="#fps" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FPSCounter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FPS ì¸¡ì • í´ë˜ìŠ¤&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avg_frames</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avg_frames</span> <span class="o">=</span> <span class="n">avg_frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í”„ë ˆì„ ì²˜ë¦¬ í›„ í˜¸ì¶œ&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">current_time</span>

        <span class="c1"># ìµœê·¼ Nê°œ í”„ë ˆì„ë§Œ ìœ ì§€</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_frames</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_times</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_fps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í˜„ì¬ FPS ë°˜í™˜&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_times</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">avg_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_times</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">avg_time</span> <span class="k">if</span> <span class="n">avg_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fps_counter</span> <span class="o">=</span> <span class="n">FPSCounter</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="c1"># í”„ë ˆì„ ì²˜ë¦¬</span>
    <span class="c1"># ...</span>

    <span class="n">fps_counter</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="n">fps_counter</span><span class="o">.</span><span class="n">get_fps</span><span class="p">()</span>

    <span class="c1"># FPS í‘œì‹œ</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;FPS: </span><span class="si">{</span><span class="n">fps</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;FPS&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div>

<h3 id="_12">ì²˜ë¦¬ ì‹œê°„ ë¶„ì„<a class="header-link" href="#_12" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PerformanceMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timings</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;íƒ€ì´ë° ì‹œì‘&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timings</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;íƒ€ì´ë° ì¢…ë£Œ&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timings</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timings</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;start&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timings</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;elapsed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elapsed</span>
            <span class="k">return</span> <span class="n">elapsed</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì„±ëŠ¥ ë¦¬í¬íŠ¸&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;elapsed&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">report</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elapsed&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">monitor</span> <span class="o">=</span> <span class="n">PerformanceMonitor</span><span class="p">()</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># ì „ì²´ í”„ë ˆì„ ì‹œê°„ ì¸¡ì •</span>
    <span class="n">monitor</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)</span>

    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="c1"># ì „ì²˜ë¦¬ ì‹œê°„ ì¸¡ì •</span>
    <span class="n">monitor</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">&#39;preprocess&#39;</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">blur</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">monitor</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s1">&#39;preprocess&#39;</span><span class="p">)</span>

    <span class="c1"># ê²€ì¶œ ì‹œê°„ ì¸¡ì •</span>
    <span class="n">monitor</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">&#39;detection&#39;</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">blur</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
    <span class="n">monitor</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s1">&#39;detection&#39;</span><span class="p">)</span>

    <span class="n">monitor</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)</span>

    <span class="c1"># ì„±ëŠ¥ í‘œì‹œ</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_report</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                    <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="mi">20</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Performance&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="5-mog2-knn">5. ë°°ê²½ ì°¨ë¶„ (MOG2, KNN)<a class="header-link" href="#5-mog2-knn" title="Permanent link">&para;</a></h2>
<h3 id="_13">ë°°ê²½ ì°¨ë¶„ ì›ë¦¬<a class="header-link" href="#_13" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ë°°ê²½ ì°¨ë¶„ (Background Subtraction):
ì›€ì§ì´ëŠ” ì „ê²½ ê°ì²´ë¥¼ ì •ì§€ëœ ë°°ê²½ìœ¼ë¡œë¶€í„° ë¶„ë¦¬

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í˜„ì¬ í”„ë ˆì„     â”‚  -  â”‚   ë°°ê²½ ëª¨ë¸     â”‚  =  â”‚   ì „ê²½ ë§ˆìŠ¤í¬   â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚
â”‚    â”Œâ”€â”€â”€â”        â”‚     â”‚                 â”‚     â”‚    â”Œâ”€â”€â”€â”        â”‚
â”‚    â”‚ â— â”‚ (ì‚¬ëŒ) â”‚     â”‚   (ë¹ˆ ë°©)       â”‚     â”‚    â”‚â–ˆâ–ˆâ–ˆâ”‚        â”‚
â”‚    â””â”€â”€â”€â”˜        â”‚     â”‚                 â”‚     â”‚    â””â”€â”€â”€â”˜        â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë°°ê²½ ëª¨ë¸ í•™ìŠµ:
- ì—¬ëŸ¬ í”„ë ˆì„ì„ ë¶„ì„í•˜ì—¬ ë°°ê²½ í†µê³„ í•™ìŠµ
- ì¡°ëª… ë³€í™”, ê·¸ë¦¼ì ë“± ì²˜ë¦¬
- ë™ì  ë°°ê²½ (ë‚˜ë­‡ì í”ë“¤ë¦¼ ë“±) ëŒ€ì‘
</code></pre></div>

<h3 id="mog2-mixture-of-gaussians">MOG2 (Mixture of Gaussians)<a class="header-link" href="#mog2-mixture-of-gaussians" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># MOG2 ë°°ê²½ ì°¨ë¶„ê¸° ìƒì„±</span>
<span class="n">backSub</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createBackgroundSubtractorMOG2</span><span class="p">(</span>
    <span class="n">history</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>          <span class="c1"># ë°°ê²½ í•™ìŠµì— ì‚¬ìš©í•  í”„ë ˆì„ ìˆ˜</span>
    <span class="n">varThreshold</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>      <span class="c1"># í”½ì…€ì´ ë°°ê²½ìœ¼ë¡œ íŒë‹¨ë˜ëŠ” ë¶„ì‚° ì„ê³„ê°’</span>
    <span class="n">detectShadows</span><span class="o">=</span><span class="kc">True</span>    <span class="c1"># ê·¸ë¦¼ì ê²€ì¶œ ì—¬ë¶€</span>
<span class="p">)</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="c1"># ë°°ê²½ ì°¨ë¶„ ì ìš©</span>
    <span class="c1"># fgMask: ì „ê²½=255, ë°°ê²½=0, ê·¸ë¦¼ì=127</span>
    <span class="n">fgMask</span> <span class="o">=</span> <span class="n">backSub</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="c1"># ê·¸ë¦¼ì ì œê±° (127 -&gt; 0)</span>
    <span class="n">fgMask_no_shadow</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">fgMask</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># ë…¸ì´ì¦ˆ ì œê±°</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_ELLIPSE</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">fgMask_clean</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">fgMask_no_shadow</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
    <span class="n">fgMask_clean</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">fgMask_clean</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>

    <span class="c1"># ì „ê²½ ì¶”ì¶œ</span>
    <span class="n">foreground</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">fgMask_clean</span><span class="p">)</span>

    <span class="c1"># ê²°ê³¼ í‘œì‹œ</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;FG Mask&#39;</span><span class="p">,</span> <span class="n">fgMask</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Cleaned Mask&#39;</span><span class="p">,</span> <span class="n">fgMask_clean</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Foreground&#39;</span><span class="p">,</span> <span class="n">foreground</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="knn">KNN ë°°ê²½ ì°¨ë¶„<a class="header-link" href="#knn" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># KNN ë°°ê²½ ì°¨ë¶„ê¸° ìƒì„±</span>
<span class="n">backSub</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createBackgroundSubtractorKNN</span><span class="p">(</span>
    <span class="n">history</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>          <span class="c1"># ë°°ê²½ í•™ìŠµ í”„ë ˆì„ ìˆ˜</span>
    <span class="n">dist2Threshold</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span> <span class="c1"># ê±°ë¦¬ ì„ê³„ê°’</span>
    <span class="n">detectShadows</span><span class="o">=</span><span class="kc">True</span>    <span class="c1"># ê·¸ë¦¼ì ê²€ì¶œ</span>
<span class="p">)</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="s1">&#39;traffic.mp4&#39;</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="c1"># ë°°ê²½ ì°¨ë¶„</span>
    <span class="n">fgMask</span> <span class="o">=</span> <span class="n">backSub</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="c1"># ë…¸ì´ì¦ˆ ì œê±°</span>
    <span class="n">fgMask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">medianBlur</span><span class="p">(</span><span class="n">fgMask</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

    <span class="c1"># ìœ¤ê³½ì„  ê²€ì¶œ</span>
    <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">fgMask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span>
                                    <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

    <span class="c1"># ì›€ì§ì´ëŠ” ê°ì²´ í‘œì‹œ</span>
    <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>  <span class="c1"># ìµœì†Œ ë©´ì  í•„í„°</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Motion Detection&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Mask&#39;</span><span class="p">,</span> <span class="n">fgMask</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div>

<h3 id="mog2-vs-knn">MOG2 vs KNN ë¹„êµ<a class="header-link" href="#mog2-vs-knn" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     í•­ëª©       â”‚        MOG2          â”‚        KNN           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì•Œê³ ë¦¬ì¦˜       â”‚ ê°€ìš°ì‹œì•ˆ í˜¼í•© ëª¨ë¸   â”‚ K-ìµœê·¼ì ‘ ì´ì›ƒ        â”‚
â”‚ ì†ë„           â”‚ ë¹ ë¦„                 â”‚ ì¤‘ê°„                 â”‚
â”‚ ë©”ëª¨ë¦¬         â”‚ ì ìŒ                 â”‚ ë§ìŒ                 â”‚
â”‚ ë™ì  ë°°ê²½      â”‚ ë³´í†µ                 â”‚ ì¢‹ìŒ                 â”‚
â”‚ ì¡°ëª… ë³€í™”      â”‚ ë³´í†µ                 â”‚ ì¢‹ìŒ                 â”‚
â”‚ ë…¸ì´ì¦ˆ         â”‚ ë¯¼ê°                 â”‚ ê°•ê±´                 â”‚
â”‚ ì¶”ì²œ ìƒí™©      â”‚ ì •ì  ì¥ë©´, ì‹¤ì‹œê°„    â”‚ ë³µì¡í•œ ì¥ë©´          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="6">6. ì˜µí‹°ì»¬ í”Œë¡œìš°<a class="header-link" href="#6" title="Permanent link">&para;</a></h2>
<h3 id="_14">ì˜µí‹°ì»¬ í”Œë¡œìš° ê°œë…<a class="header-link" href="#_14" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ì˜µí‹°ì»¬ í”Œë¡œìš° (Optical Flow):
ì—°ì†ëœ í”„ë ˆì„ ì‚¬ì´ì˜ í”½ì…€ ì›€ì§ì„ì„ ì¶”ì •

í”„ë ˆì„ t                    í”„ë ˆì„ t+1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚        â”‚                 â”‚
â”‚    â—            â”‚   â†’    â”‚        â—        â”‚
â”‚                 â”‚        â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì†ë„ ë²¡í„° (u, v):
- í”½ì…€ (x, y)ê°€ ë‹¤ìŒ í”„ë ˆì„ì—ì„œ (x+u, y+v)ë¡œ ì´ë™
- I(x, y, t) = I(x+u, y+v, t+1) (ë°ê¸° í•­ìƒì„± ê°€ì •)

ì¢…ë¥˜:
1. Sparse (í¬ì†Œ): íŠ¹ì • ì ë“¤ì˜ ì›€ì§ì„ë§Œ ê³„ì‚° (Lucas-Kanade)
2. Dense (ë°€ì§‘): ëª¨ë“  í”½ì…€ì˜ ì›€ì§ì„ ê³„ì‚° (Farneback)
</code></pre></div>

<h3 id="lucas-kanade">Lucas-Kanade ì˜µí‹°ì»¬ í”Œë¡œìš°<a class="header-link" href="#lucas-kanade" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Lucas-Kanade íŒŒë¼ë¯¸í„°</span>
<span class="n">lk_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">winSize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>      <span class="c1"># ê²€ìƒ‰ ìœˆë„ìš° í¬ê¸°</span>
    <span class="n">maxLevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>            <span class="c1"># í”¼ë¼ë¯¸ë“œ ë ˆë²¨</span>
    <span class="n">criteria</span><span class="o">=</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_EPS</span> <span class="o">|</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_COUNT</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># íŠ¹ì§•ì  ê²€ì¶œ íŒŒë¼ë¯¸í„°</span>
<span class="n">feature_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">maxCorners</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>        <span class="c1"># ìµœëŒ€ íŠ¹ì§•ì  ìˆ˜</span>
    <span class="n">qualityLevel</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>      <span class="c1"># í’ˆì§ˆ ìˆ˜ì¤€</span>
    <span class="n">minDistance</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>         <span class="c1"># ìµœì†Œ ê±°ë¦¬</span>
    <span class="n">blockSize</span><span class="o">=</span><span class="mi">7</span>
<span class="p">)</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># ì²« í”„ë ˆì„ ì½ê¸°</span>
<span class="n">ret</span><span class="p">,</span> <span class="n">old_frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">old_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">old_frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

<span class="c1"># íŠ¹ì§•ì  ê²€ì¶œ</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">goodFeaturesToTrack</span><span class="p">(</span><span class="n">old_gray</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_params</span><span class="p">)</span>

<span class="c1"># ì¶”ì  ê¶¤ì  ì‹œê°í™”ìš©</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">old_frame</span><span class="p">)</span>

<span class="c1"># ìƒ‰ìƒ</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="n">frame_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">p0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># ì˜µí‹°ì»¬ í”Œë¡œìš° ê³„ì‚°</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcOpticalFlowPyrLK</span><span class="p">(</span>
            <span class="n">old_gray</span><span class="p">,</span> <span class="n">frame_gray</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">lk_params</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">p1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ì¢‹ì€ ì ë§Œ ì„ íƒ</span>
            <span class="n">good_new</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="n">st</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">good_old</span> <span class="o">=</span> <span class="n">p0</span><span class="p">[</span><span class="n">st</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># ì›€ì§ì„ ì‹œê°í™”</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">good_new</span><span class="p">,</span> <span class="n">good_old</span><span class="p">)):</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

                <span class="c1"># ê¶¤ì  ì„ </span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span>
                               <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="c1"># í˜„ì¬ ìœ„ì¹˜ ì </span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span>
                                   <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># ë‹¤ìŒ í”„ë ˆì„ì„ ìœ„í•œ ì—…ë°ì´íŠ¸</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">good_new</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># ê¶¤ì  í•©ì„±</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Lucas-Kanade&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>
    <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
        <span class="c1"># &#39;r&#39; í‚¤ë¡œ íŠ¹ì§•ì  ì¬ê²€ì¶œ</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">goodFeaturesToTrack</span><span class="p">(</span><span class="n">frame_gray</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">feature_params</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="n">old_gray</span> <span class="o">=</span> <span class="n">frame_gray</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="farneback">Farneback ë°€ì§‘ ì˜µí‹°ì»¬ í”Œë¡œìš°<a class="header-link" href="#farneback" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">draw_flow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í”Œë¡œìš° ë²¡í„° ì‹œê°í™”&quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">step</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="n">h</span><span class="p">:</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="n">w</span><span class="p">:</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">fx</span><span class="p">,</span> <span class="n">fy</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># ì„  ê·¸ë¦¬ê¸°</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">fx</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">fy</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="n">vis</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">polylines</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vis</span>

<span class="k">def</span><span class="w"> </span><span class="nf">flow_to_hsv</span><span class="p">(</span><span class="n">flow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;í”Œë¡œìš°ë¥¼ HSV ìƒ‰ìƒìœ¼ë¡œ ë³€í™˜&quot;&quot;&quot;</span>
    <span class="n">mag</span><span class="p">,</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cartToPolar</span><span class="p">(</span><span class="n">flow</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">flow</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">hsv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">flow</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">hsv</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ang</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># ë°©í–¥ -&gt; Hue</span>
    <span class="n">hsv</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>  <span class="c1"># Saturation</span>
    <span class="n">hsv</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_MINMAX</span><span class="p">)</span>  <span class="c1"># í¬ê¸° -&gt; Value</span>

    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2BGR</span><span class="p">)</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ret</span><span class="p">,</span> <span class="n">frame1</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">prvs</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame1</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame2</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="n">next_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="c1"># Farneback ì˜µí‹°ì»¬ í”Œë¡œìš°</span>
    <span class="n">flow</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcOpticalFlowFarneback</span><span class="p">(</span>
        <span class="n">prvs</span><span class="p">,</span> <span class="n">next_gray</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>           <span class="c1"># ì´ˆê¸° í”Œë¡œìš°</span>
        <span class="n">pyr_scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># í”¼ë¼ë¯¸ë“œ ìŠ¤ì¼€ì¼</span>
        <span class="n">levels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>       <span class="c1"># í”¼ë¼ë¯¸ë“œ ë ˆë²¨</span>
        <span class="n">winsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>     <span class="c1"># ìœˆë„ìš° í¬ê¸°</span>
        <span class="n">iterations</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>   <span class="c1"># ë°˜ë³µ íšŸìˆ˜</span>
        <span class="n">poly_n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>       <span class="c1"># ë‹¤í•­ì‹ í¬ê¸°</span>
        <span class="n">poly_sigma</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="c1"># ê°€ìš°ì‹œì•ˆ ì‹œê·¸ë§ˆ</span>
        <span class="n">flags</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="c1"># ì‹œê°í™”</span>
    <span class="n">flow_vis</span> <span class="o">=</span> <span class="n">draw_flow</span><span class="p">(</span><span class="n">frame2</span><span class="p">,</span> <span class="n">flow</span><span class="p">)</span>
    <span class="n">hsv_vis</span> <span class="o">=</span> <span class="n">flow_to_hsv</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Flow Vectors&#39;</span><span class="p">,</span> <span class="n">flow_vis</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Flow HSV&#39;</span><span class="p">,</span> <span class="n">hsv_vis</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

    <span class="n">prvs</span> <span class="o">=</span> <span class="n">next_gray</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="7">7. ê°ì²´ ì¶”ì <a class="header-link" href="#7" title="Permanent link">&para;</a></h2>
<h3 id="opencv">OpenCV ë‚´ì¥ íŠ¸ë˜ì»¤<a class="header-link" href="#opencv" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># íŠ¸ë˜ì»¤ ì¢…ë¥˜</span>
<span class="n">TRACKERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;BOOSTING&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">legacy</span><span class="o">.</span><span class="n">TrackerBoosting_create</span><span class="p">,</span>
    <span class="s1">&#39;MIL&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TrackerMIL_create</span><span class="p">,</span>
    <span class="s1">&#39;KCF&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TrackerKCF_create</span><span class="p">,</span>
    <span class="s1">&#39;CSRT&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TrackerCSRT_create</span><span class="p">,</span>
    <span class="s1">&#39;MOSSE&#39;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">legacy</span><span class="o">.</span><span class="n">TrackerMOSSE_create</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">track_object</span><span class="p">(</span><span class="n">video_path</span><span class="p">,</span> <span class="n">tracker_type</span><span class="o">=</span><span class="s1">&#39;CSRT&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¨ì¼ ê°ì²´ ì¶”ì &quot;&quot;&quot;</span>

    <span class="c1"># íŠ¸ë˜ì»¤ ìƒì„±</span>
    <span class="n">tracker</span> <span class="o">=</span> <span class="n">TRACKERS</span><span class="p">[</span><span class="n">tracker_type</span><span class="p">]()</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c1"># ì¶”ì í•  ê°ì²´ ì„ íƒ (ë§ˆìš°ìŠ¤ ë“œë˜ê·¸)</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">selectROI</span><span class="p">(</span><span class="s1">&#39;Select Object&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyWindow</span><span class="p">(</span><span class="s1">&#39;Select Object&#39;</span><span class="p">)</span>

    <span class="c1"># íŠ¸ë˜ì»¤ ì´ˆê¸°í™”</span>
    <span class="n">tracker</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># ì¶”ì  ì—…ë°ì´íŠ¸</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">bbox</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bbox</span><span class="p">]</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">tracker_type</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="s1">&#39;Tracking Failed&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Tracking&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">track_object</span><span class="p">(</span><span class="s1">&#39;video.mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;CSRT&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="_15">ë‹¤ì¤‘ ê°ì²´ ì¶”ì <a class="header-link" href="#_15" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MultiObjectTracker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¤ì¤‘ ê°ì²´ ì¶”ì ê¸°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tracker_type</span><span class="o">=</span><span class="s1">&#39;CSRT&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker_type</span> <span class="o">=</span> <span class="n">tracker_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_tracker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">bbox</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìƒˆ íŠ¸ë˜ì»¤ ì¶”ê°€&quot;&quot;&quot;</span>
        <span class="n">tracker</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TrackerCSRT_create</span><span class="p">()</span>
        <span class="n">tracker</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tracker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
        <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ëª¨ë“  íŠ¸ë˜ì»¤ ì—…ë°ì´íŠ¸&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tracker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">):</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">bbox</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                    <span class="s1">&#39;bbox&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê²°ê³¼ ì‹œê°í™”&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">]]</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ID: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">frame</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_tracker</span> <span class="o">=</span> <span class="n">MultiObjectTracker</span><span class="p">()</span>

<span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># ì—¬ëŸ¬ ê°ì²´ ì„ íƒ (ESCë¡œ ì¢…ë£Œ)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">selectROI</span><span class="p">(</span><span class="s1">&#39;Select Objects (Press ESC when done)&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bbox</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>  <span class="c1"># ESC ëˆ„ë¦„</span>
        <span class="k">break</span>
    <span class="n">multi_tracker</span><span class="o">.</span><span class="n">add_tracker</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">destroyWindow</span><span class="p">(</span><span class="s1">&#39;Select Objects (Press ESC when done)&#39;</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">multi_tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">multi_tracker</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Multi Tracking&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div>

<h3 id="_16">ë°°ê²½ ì°¨ë¶„ + ì¶”ì  ê²°í•©<a class="header-link" href="#_16" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MotionTracker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë°°ê²½ ì°¨ë¶„ ê¸°ë°˜ ì›€ì§ì„ ì¶”ì &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bg_subtractor</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createBackgroundSubtractorMOG2</span><span class="p">(</span>
            <span class="n">history</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">varThreshold</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">detectShadows</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_ELLIPSE</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {id: {&#39;centroid&#39;: (x,y), &#39;frames&#39;: count}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_distance</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># ë™ì¼ ê°ì²´ íŒë‹¨ ê±°ë¦¬</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í”„ë ˆì„ ì²˜ë¦¬&quot;&quot;&quot;</span>
        <span class="c1"># ë°°ê²½ ì°¨ë¶„</span>
        <span class="n">fg_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bg_subtractor</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">fg_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">fg_mask</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># ë…¸ì´ì¦ˆ ì œê±°</span>
        <span class="n">fg_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">fg_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">)</span>
        <span class="n">fg_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">fg_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">)</span>

        <span class="c1"># ìœ¤ê³½ì„  ê²€ì¶œ</span>
        <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">fg_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span>
                                        <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

        <span class="c1"># í˜„ì¬ í”„ë ˆì„ì˜ ê°ì²´ë“¤</span>
        <span class="n">current_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
                <span class="n">centroid</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">current_objects</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;centroid&#39;</span><span class="p">:</span> <span class="n">centroid</span><span class="p">,</span>
                    <span class="s1">&#39;bbox&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="c1"># ê¸°ì¡´ íŠ¸ë™ê³¼ ë§¤ì¹­</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_match_tracks</span><span class="p">(</span><span class="n">current_objects</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fg_mask</span><span class="p">,</span> <span class="n">current_objects</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_match_tracks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í˜„ì¬ ê°ì²´ì™€ ê¸°ì¡´ íŠ¸ë™ ë§¤ì¹­&quot;&quot;&quot;</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">current_objects</span><span class="p">:</span>
            <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span>
            <span class="n">best_match</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">best_dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>

            <span class="c1"># ê°€ì¥ ê°€ê¹Œìš´ ê¸°ì¡´ íŠ¸ë™ ì°¾ê¸°</span>
            <span class="k">for</span> <span class="n">track_id</span><span class="p">,</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cx</span><span class="o">-</span><span class="n">tx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">cy</span><span class="o">-</span><span class="n">ty</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_distance</span> <span class="ow">and</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">best_dist</span><span class="p">:</span>
                    <span class="n">best_dist</span> <span class="o">=</span> <span class="n">dist</span>
                    <span class="n">best_match</span> <span class="o">=</span> <span class="n">track_id</span>

            <span class="k">if</span> <span class="n">best_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># ê¸°ì¡´ íŠ¸ë™ ì—…ë°ì´íŠ¸</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">best_match</span><span class="p">][</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">best_match</span><span class="p">][</span><span class="s1">&#39;bbox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">best_match</span><span class="p">][</span><span class="s1">&#39;frames&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_match</span>
                <span class="n">matched</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">best_match</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ìƒˆ íŠ¸ë™ ìƒì„±</span>
                <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;centroid&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;bbox&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;frames&#39;</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># ì˜¤ë˜ëœ íŠ¸ë™ ì œê±°</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">tid</span> <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span> <span class="k">if</span> <span class="n">tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">tid</span><span class="p">][</span><span class="s1">&#39;frames&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># ì§§ì€ íŠ¸ë™ì€ ë°”ë¡œ ì œê±°</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì‹œê°í™”&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">]</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ID: </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">10</span><span class="p">),</span>
                           <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">frame</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">tracker</span> <span class="o">=</span> <span class="n">MotionTracker</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="n">mask</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">objects</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Motion Tracking&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Mask&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div>

<hr />
<h2 id="8">8. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="1">ë¬¸ì œ 1: ë¹„ë””ì˜¤ í”Œë ˆì´ì–´<a class="header-link" href="#1" title="Permanent link">&para;</a></h3>
<p>ê¸°ë³¸ì ì¸ ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ë¥¼ êµ¬í˜„í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- ì¬ìƒ/ì¼ì‹œì •ì§€ í† ê¸€ (ìŠ¤í˜ì´ìŠ¤ë°”)
- ì•ìœ¼ë¡œ/ë’¤ë¡œ ê±´ë„ˆë›°ê¸° (ë°©í–¥í‚¤)
- í”„ë ˆì„ ë‹¨ìœ„ ì´ë™ (./,)
- í˜„ì¬ ì‹œê°„/ì´ ì‹œê°„ í‘œì‹œ
- í”„ë¡œê·¸ë ˆìŠ¤ ë°”</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># í”„ë ˆì„ ì´ë™</span>
<span class="n">cap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_POS_FRAMES</span><span class="p">,</span> <span class="n">target_frame</span><span class="p">)</span>

<span class="c1"># í‚¤ ì²˜ë¦¬</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>  <span class="c1"># ìŠ¤í˜ì´ìŠ¤ë°”</span>
    <span class="n">paused</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">paused</span>
<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">83</span><span class="p">:</span>  <span class="c1"># ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ</span>
    <span class="n">skip_forward</span><span class="p">()</span>
</code></pre></div>



</details>

<h3 id="2">ë¬¸ì œ 2: ì›€ì§ì„ íˆíŠ¸ë§µ<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<p>ë¹„ë””ì˜¤ì—ì„œ ì›€ì§ì„ì´ ë§ì€ ì˜ì—­ì„ íˆíŠ¸ë§µìœ¼ë¡œ ì‹œê°í™”í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- ë°°ê²½ ì°¨ë¶„ìœ¼ë¡œ ì›€ì§ì„ ê²€ì¶œ
- ëˆ„ì  ì›€ì§ì„ ë§µ ìƒì„±
- ì»¬ëŸ¬ë§µ ì ìš© (COLORMAP_JET)
- ì›ë³¸ê³¼ íˆíŠ¸ë§µ ë¸”ë Œë”©</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># ëˆ„ì  ë§µ ì´ˆê¸°í™”</span>
<span class="n">accumulator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># í”„ë ˆì„ë§ˆë‹¤ ëˆ„ì </span>
<span class="n">accumulator</span> <span class="o">+=</span> <span class="n">fg_mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>

<span class="c1"># ì •ê·œí™” ë° ì»¬ëŸ¬ë§µ ì ìš©</span>
<span class="n">normalized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">accumulator</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_MINMAX</span><span class="p">)</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">applyColorMap</span><span class="p">(</span><span class="n">normalized</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLORMAP_JET</span><span class="p">)</span>
</code></pre></div>



</details>

<h3 id="3_1">ë¬¸ì œ 3: ì†ë„ ì¸¡ì •<a class="header-link" href="#3_1" title="Permanent link">&para;</a></h3>
<p>ì˜µí‹°ì»¬ í”Œë¡œìš°ë¥¼ ì´ìš©í•´ ê°ì²´ì˜ ì´ë™ ì†ë„ë¥¼ ì¸¡ì •í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- íŠ¹ì • ROI ë‚´ í‰ê·  í”Œë¡œìš° ê³„ì‚°
- í”½ì…€ ì†ë„ë¥¼ ì‹¤ì œ ì†ë„ë¡œ ë³€í™˜ (ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í•„ìš”)
- ì†ë„ ê·¸ë˜í”„ ì‹¤ì‹œê°„ í‘œì‹œ</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># ROI ë‚´ í‰ê·  í”Œë¡œìš°</span>
<span class="n">roi_flow</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">]</span>
<span class="n">avg_flow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">roi_flow</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># ì†ë„ ê³„ì‚° (í”½ì…€/í”„ë ˆì„)</span>
<span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">avg_flow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">avg_flow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ì‹¤ì œ ì†ë„ ë³€í™˜ (ì˜ˆ: 1í”½ì…€ = 1cm, 30fps)</span>
<span class="n">real_speed</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">pixels_to_cm</span> <span class="o">*</span> <span class="n">fps</span>  <span class="c1"># cm/s</span>
</code></pre></div>



</details>

<h3 id="4">ë¬¸ì œ 4: ì°¨ëŸ‰ ê³„ìˆ˜ê¸°<a class="header-link" href="#4" title="Permanent link">&para;</a></h3>
<p>ë„ë¡œ ë¹„ë””ì˜¤ì—ì„œ í†µê³¼í•˜ëŠ” ì°¨ëŸ‰ì„ ê³„ìˆ˜í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- ë°°ê²½ ì°¨ë¶„ìœ¼ë¡œ ì°¨ëŸ‰ ê²€ì¶œ
- ê°€ìƒ ì„  ì„¤ì • (ê³„ìˆ˜ ë¼ì¸)
- ì„ ì„ í†µê³¼í•˜ëŠ” ê°ì²´ ê³„ìˆ˜
- ì§„ì…/í‡´ì¥ ë°©í–¥ êµ¬ë¶„</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># ê°€ìƒ ì„  ì •ì˜</span>
<span class="n">line_y</span> <span class="o">=</span> <span class="n">height</span> <span class="o">//</span> <span class="mi">2</span>

<span class="c1"># ê°ì²´ê°€ ì„ ì„ í†µê³¼í–ˆëŠ”ì§€ í™•ì¸</span>
<span class="k">def</span><span class="w"> </span><span class="nf">crossed_line</span><span class="p">(</span><span class="n">prev_y</span><span class="p">,</span> <span class="n">curr_y</span><span class="p">,</span> <span class="n">line_y</span><span class="p">):</span>
    <span class="c1"># ìœ„ì—ì„œ ì•„ë˜ë¡œ</span>
    <span class="k">if</span> <span class="n">prev_y</span> <span class="o">&lt;</span> <span class="n">line_y</span> <span class="ow">and</span> <span class="n">curr_y</span> <span class="o">&gt;=</span> <span class="n">line_y</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;down&#39;</span>
    <span class="c1"># ì•„ë˜ì—ì„œ ìœ„ë¡œ</span>
    <span class="k">if</span> <span class="n">prev_y</span> <span class="o">&gt;</span> <span class="n">line_y</span> <span class="ow">and</span> <span class="n">curr_y</span> <span class="o">&lt;=</span> <span class="n">line_y</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;up&#39;</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>



</details>

<h3 id="5">ë¬¸ì œ 5: ë™ì‘ ì¸ì‹<a class="header-link" href="#5" title="Permanent link">&para;</a></h3>
<p>ì˜µí‹°ì»¬ í”Œë¡œìš° íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ê°„ë‹¨í•œ ë™ì‘(ì† í”ë“¤ê¸°, ì› ê·¸ë¦¬ê¸°)ì„ ì¸ì‹í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- ì† ì˜ì—­ ê²€ì¶œ (í”¼ë¶€ìƒ‰ ê¸°ë°˜)
- ì›€ì§ì„ íŒ¨í„´ ì¶”ì 
- íŒ¨í„´ ë¶„ë¥˜ (ê·œì¹™ ê¸°ë°˜ ë˜ëŠ” í…œí”Œë¦¿ ë§¤ì¹­)
- ì¸ì‹ëœ ë™ì‘ í‘œì‹œ</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="c1"># í”¼ë¶€ìƒ‰ ê²€ì¶œ (HSV)</span>
<span class="n">hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
<span class="n">lower_skin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>
<span class="n">upper_skin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">lower_skin</span><span class="p">,</span> <span class="n">upper_skin</span><span class="p">)</span>

<span class="c1"># ì›€ì§ì„ ê¶¤ì  ì €ì¥</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">centroid</span><span class="p">)</span>

<span class="c1"># ê¶¤ì  ë¶„ì„</span>
<span class="c1"># ì† í”ë“¤ê¸°: x ë°©í–¥ ì§„ë™</span>
<span class="c1"># ì› ê·¸ë¦¬ê¸°: ì‹œì‘ì ê³¼ ëì ì´ ê°€ê¹Œì›€ + ì¼ì • ë©´ì </span>
</code></pre></div>



</details>

<hr />
<h2 id="_17">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_17" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./18_Camera_Calibration.md">18_Camera_Calibration.md</a> - ì¹´ë©”ë¼ í–‰ë ¬, ì™œê³¡ ë³´ì •</li>
</ul>
<hr />
<h2 id="_18">ì°¸ê³  ìë£Œ<a class="header-link" href="#_18" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.opencv.org/4.x/dd/d43/tutorial_py_video_display.html">OpenCV Video I/O</a></li>
<li><a href="https://docs.opencv.org/4.x/d1/dc5/tutorial_background_subtraction.html">Background Subtraction</a></li>
<li><a href="https://docs.opencv.org/4.x/d4/dee/tutorial_optical_flow.html">Optical Flow</a></li>
<li><a href="https://docs.opencv.org/4.x/d9/df8/group__tracking.html">Object Tracking</a></li>
<li>Horn, B. K., &amp; Schunck, B. G. (1981). "Determining Optical Flow"</li>
<li>Lucas, B. D., &amp; Kanade, T. (1981). "An Iterative Image Registration Technique"</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/16_Face_Detection.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ì–¼êµ´ ê²€ì¶œ ë° ì¸ì‹ (Face Detection and Recognition)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/18_Camera_Calibration.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ (Camera Calibration)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}