{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë”¥ëŸ¬ë‹ DNN ëª¨ë“ˆ (Deep Neural Network Module) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Computer_Vision/">Computer Vision</a>
    <span class="separator">/</span>
    <span class="current">ë”¥ëŸ¬ë‹ DNN ëª¨ë“ˆ (Deep Neural Network Module)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ë”¥ëŸ¬ë‹ DNN ëª¨ë“ˆ (Deep Neural Network Module)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/18_Camera_Calibration.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ (Camera Calibration)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/20_Practical_Projects.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì‹¤ì „ í”„ë¡œì íŠ¸ (Practical Projects)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ê°œìš”</a></li>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1-cv2dnn">1. cv2.dnn ëª¨ë“ˆ ê°œìš”</a><ul>
<li><a href="#dnn">DNN ëª¨ë“ˆì˜ íŠ¹ì§•</a></li>
<li><a href="#_3">ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°</a></li>
</ul>
</li>
<li><a href="#2-readnet">2. readNet(): ëª¨ë¸ ë¡œë”©</a><ul>
<li><a href="#_4">ë‹¤ì–‘í•œ ëª¨ë¸ í˜•ì‹ ë¡œë”©</a></li>
<li><a href="#_5">ë°±ì—”ë“œ ë° íƒ€ê²Ÿ ì„¤ì •</a></li>
<li><a href="#_6">ë ˆì´ì–´ ì •ë³´ í™•ì¸</a></li>
</ul>
</li>
<li><a href="#3-blobfromimage">3. blobFromImage(): ì „ì²˜ë¦¬</a><ul>
<li><a href="#blob">Blob ê°œë…</a></li>
<li><a href="#blobfromimage">blobFromImage ì‚¬ìš©ë²•</a></li>
<li><a href="#_7">ì—¬ëŸ¬ ì´ë¯¸ì§€ ì²˜ë¦¬</a></li>
<li><a href="#_8">ì „ì²˜ë¦¬ ì‹œê°í™”</a></li>
</ul>
</li>
<li><a href="#4-yolo">4. YOLO ê°ì²´ ê²€ì¶œ</a><ul>
<li><a href="#yolo">YOLO ê°œìš”</a></li>
<li><a href="#yolov3">YOLOv3 êµ¬í˜„</a></li>
<li><a href="#yolov3-tiny">YOLOv3-tiny (ê²½ëŸ‰ ë²„ì „)</a></li>
</ul>
</li>
<li><a href="#5-ssd-single-shot-detector">5. SSD (Single Shot Detector)</a><ul>
<li><a href="#ssd">SSD ê°œìš”</a></li>
<li><a href="#mobilenet-ssd">MobileNet SSD êµ¬í˜„</a></li>
<li><a href="#caffe-ssd">Caffe SSD (ê²½ëŸ‰)</a></li>
</ul>
</li>
<li><a href="#6-dnn">6. DNN ì–¼êµ´ ê²€ì¶œ</a><ul>
<li><a href="#opencv-dnn">OpenCV DNN ì–¼êµ´ ê²€ì¶œê¸°</a></li>
<li><a href="#dnn_1">ì‹¤ì‹œê°„ DNN ì–¼êµ´ ê²€ì¶œ</a></li>
<li><a href="#haar-vs-dnn">Haar vs DNN ì–¼êµ´ ê²€ì¶œ ë¹„êµ</a></li>
</ul>
</li>
<li><a href="#7-onnx">7. ONNXë¥¼ ì´ìš©í•œ ìµœì‹  ê°ì²´ ê²€ì¶œ</a><ul>
<li><a href="#71-yolov8-opencv-dnn">7.1 YOLOv8ì„ OpenCV DNNìœ¼ë¡œ ì‹¤í–‰í•˜ê¸°</a></li>
<li><a href="#72-onnx-sam-segment-anything-model">7.2 ONNXë¥¼ ì´ìš©í•œ SAM (Segment Anything Model)</a></li>
<li><a href="#73-zoo-2025">7.3 ëª¨ë¸ Zooì™€ í˜„ì¬ ìƒí™© (2025)</a><ul>
<li><a href="#731-onnx-yolov11">7.3.1 ë¹ ë¥¸ ì‹œì‘: ONNXë¥¼ ì´ìš©í•œ YOLOv11</a></li>
<li><a href="#732-rt-detr">7.3.2 RT-DETR: íŠ¸ëœìŠ¤í¬ë¨¸ ê¸°ë°˜ ê²€ì¶œ</a></li>
<li><a href="#733">7.3.3 ëª¨ë¸ ì„ íƒ ê°€ì´ë“œ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#8">8. ì—°ìŠµ ë¬¸ì œ</a><ul>
<li><a href="#1">ë¬¸ì œ 1: ê°ì²´ ê²€ì¶œ ì„±ëŠ¥ ë¹„êµ</a></li>
<li><a href="#2">ë¬¸ì œ 2: ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ í•„í„°ë§</a></li>
<li><a href="#3">ë¬¸ì œ 3: ë¹„ë””ì˜¤ ê°ì²´ ì¶”ì  + ê²€ì¶œ</a></li>
<li><a href="#4">ë¬¸ì œ 4: ëª¨ë¸ ì•™ìƒë¸”</a></li>
<li><a href="#5">ë¬¸ì œ 5: ì‹¤ì‹œê°„ ê°ì²´ ê³„ìˆ˜ ì‹œìŠ¤í…œ</a></li>
</ul>
</li>
<li><a href="#_9">ë‹¤ìŒ ë‹¨ê³„</a></li>
<li><a href="#_10">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="dnn-deep-neural-network-module">ë”¥ëŸ¬ë‹ DNN ëª¨ë“ˆ (Deep Neural Network Module)<a class="header-link" href="#dnn-deep-neural-network-module" title="Permanent link">&para;</a></h1>
<h2 id="_1">ê°œìš”<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>OpenCVì˜ DNN ëª¨ë“ˆì€ ì‚¬ì „ í•™ìŠµëœ ë”¥ëŸ¬ë‹ ëª¨ë¸ì„ ë¡œë“œí•˜ê³  ì¶”ë¡ í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. TensorFlow, Caffe, Darknet, ONNX ë“± ë‹¤ì–‘í•œ í”„ë ˆì„ì›Œí¬ì˜ ëª¨ë¸ì„ ì§€ì›í•˜ë©°, CPUì™€ GPUì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><strong>ë‚œì´ë„</strong>: â­â­â­â­</p>
<p><strong>ì„ ìˆ˜ ì§€ì‹</strong>: ë”¥ëŸ¬ë‹ ê¸°ì´ˆ ê°œë…, ê°ì²´ ê²€ì¶œ, ì´ë¯¸ì§€ ë¶„ë¥˜</p>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-cv2dnn-ëª¨ë“ˆ-ê°œìš”">cv2.dnn ëª¨ë“ˆ ê°œìš”</a></li>
<li><a href="#2-readnet-ëª¨ë¸-ë¡œë”©">readNet(): ëª¨ë¸ ë¡œë”©</a></li>
<li><a href="#3-blobfromimage-ì „ì²˜ë¦¬">blobFromImage(): ì „ì²˜ë¦¬</a></li>
<li><a href="#4-yolo-ê°ì²´-ê²€ì¶œ">YOLO ê°ì²´ ê²€ì¶œ</a></li>
<li><a href="#5-ssd-single-shot-detector">SSD (Single Shot Detector)</a></li>
<li><a href="#6-dnn-ì–¼êµ´-ê²€ì¶œ">DNN ì–¼êµ´ ê²€ì¶œ</a></li>
<li><a href="#7-onnxë¥¼-ì´ìš©í•œ-ìµœì‹ -ê°ì²´-ê²€ì¶œ">ONNXë¥¼ ì´ìš©í•œ ìµœì‹  ê°ì²´ ê²€ì¶œ</a></li>
<li><a href="#8-ì—°ìŠµ-ë¬¸ì œ">ì—°ìŠµ ë¬¸ì œ</a></li>
</ol>
<hr />
<h2 id="1-cv2dnn">1. cv2.dnn ëª¨ë“ˆ ê°œìš”<a class="header-link" href="#1-cv2dnn" title="Permanent link">&para;</a></h2>
<h3 id="dnn">DNN ëª¨ë“ˆì˜ íŠ¹ì§•<a class="header-link" href="#dnn" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>OpenCV DNN ëª¨ë“ˆ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        cv2.dnn                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ì§€ì› í”„ë ˆì„ì›Œí¬:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Caffe     â”‚ TensorFlow  â”‚   Darknet   â”‚    ONNX     â”‚     â”‚
â”‚  â”‚  (.caffemodel,â”‚ (.pb)     â”‚  (.weights, â”‚  (.onnx)    â”‚     â”‚
â”‚  â”‚   .prototxt)â”‚             â”‚   .cfg)     â”‚             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚  ì‹¤í–‰ ë°±ì—”ë“œ:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    CPU      â”‚   OpenCL    â”‚    CUDA     â”‚   Vulkan    â”‚     â”‚
â”‚  â”‚  (ê¸°ë³¸)     â”‚   (GPU)     â”‚   (NVIDIA)  â”‚   (ë‹¤ì¤‘GPU) â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚  íŠ¹ì§•:                                                          â”‚
â”‚  - ì¶”ë¡  ì „ìš© (í•™ìŠµ ë¶ˆê°€)                                        â”‚
â”‚  - ìµœì í™”ëœ ì—°ì‚°                                                â”‚
â”‚  - ë‹¤ì–‘í•œ í•˜ë“œì›¨ì–´ ì§€ì›                                         â”‚
â”‚  - ê°„ë‹¨í•œ API                                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="_3">ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>DNN ì¶”ë¡  ì›Œí¬í”Œë¡œìš°:

1. ëª¨ë¸ ë¡œë”©
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  readNet()       â”‚ â†’ ëª¨ë¸ íŒŒì¼ ë¡œë“œ
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
2. ë°±ì—”ë“œ/íƒ€ê²Ÿ ì„¤ì •
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ setPreferableBackend()â”‚ â†’ CPU/CUDA/OpenCL
   â”‚ setPreferableTarget() â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
3. ì…ë ¥ ì „ì²˜ë¦¬
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ blobFromImage()  â”‚ â†’ ì´ë¯¸ì§€ â†’ Blob
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
4. ì¶”ë¡  ì‹¤í–‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ net.setInput()   â”‚
   â”‚ net.forward()    â”‚ â†’ ì¶”ë¡  ê²°ê³¼
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
5. ê²°ê³¼ í›„ì²˜ë¦¬
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ NMS, ì‹œê°í™” ë“±   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<hr />
<h2 id="2-readnet">2. readNet(): ëª¨ë¸ ë¡œë”©<a class="header-link" href="#2-readnet" title="Permanent link">&para;</a></h2>
<h3 id="_4">ë‹¤ì–‘í•œ ëª¨ë¸ í˜•ì‹ ë¡œë”©<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="c1"># Caffe ëª¨ë¸ ë¡œë”©</span>
<span class="n">net_caffe</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span>
    <span class="s1">&#39;deploy.prototxt&#39;</span><span class="p">,</span>      <span class="c1"># ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°</span>
    <span class="s1">&#39;model.caffemodel&#39;</span>      <span class="c1"># ê°€ì¤‘ì¹˜</span>
<span class="p">)</span>

<span class="c1"># TensorFlow ëª¨ë¸ ë¡œë”©</span>
<span class="n">net_tf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromTensorflow</span><span class="p">(</span>
    <span class="s1">&#39;frozen_inference_graph.pb&#39;</span><span class="p">,</span>  <span class="c1"># ë™ê²°ëœ ê·¸ë˜í”„</span>
    <span class="s1">&#39;graph.pbtxt&#39;</span>                 <span class="c1"># í…ìŠ¤íŠ¸ ê·¸ë˜í”„ (ì„ íƒ)</span>
<span class="p">)</span>

<span class="c1"># Darknet (YOLO) ëª¨ë¸ ë¡œë”©</span>
<span class="n">net_darknet</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromDarknet</span><span class="p">(</span>
    <span class="s1">&#39;yolov3.cfg&#39;</span><span class="p">,</span>           <span class="c1"># ì„¤ì • íŒŒì¼</span>
    <span class="s1">&#39;yolov3.weights&#39;</span>        <span class="c1"># ê°€ì¤‘ì¹˜</span>
<span class="p">)</span>

<span class="c1"># ONNX ëª¨ë¸ ë¡œë”©</span>
<span class="n">net_onnx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="s1">&#39;model.onnx&#39;</span><span class="p">)</span>

<span class="c1"># ë²”ìš© í•¨ìˆ˜ (ìë™ ê°ì§€)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNet</span><span class="p">(</span><span class="s1">&#39;model.weights&#39;</span><span class="p">,</span> <span class="s1">&#39;model.cfg&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="_5">ë°±ì—”ë“œ ë° íƒ€ê²Ÿ ì„¤ì •<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNet</span><span class="p">(</span><span class="s1">&#39;model.weights&#39;</span><span class="p">,</span> <span class="s1">&#39;model.cfg&#39;</span><span class="p">)</span>

<span class="c1"># ë°±ì—”ë“œ ì„¤ì •</span>
<span class="c1"># - cv2.dnn.DNN_BACKEND_OPENCV: OpenCV ë‚´ì¥ (ê¸°ë³¸)</span>
<span class="c1"># - cv2.dnn.DNN_BACKEND_CUDA: NVIDIA CUDA</span>
<span class="c1"># - cv2.dnn.DNN_BACKEND_INFERENCE_ENGINE: Intel OpenVINO</span>

<span class="c1"># íƒ€ê²Ÿ ì„¤ì •</span>
<span class="c1"># - cv2.dnn.DNN_TARGET_CPU: CPU (ê¸°ë³¸)</span>
<span class="c1"># - cv2.dnn.DNN_TARGET_OPENCL: OpenCL GPU</span>
<span class="c1"># - cv2.dnn.DNN_TARGET_CUDA: NVIDIA GPU</span>
<span class="c1"># - cv2.dnn.DNN_TARGET_CUDA_FP16: NVIDIA GPU (ë°˜ì •ë°€ë„)</span>

<span class="c1"># CPU ì‹¤í–‰ (ê¸°ë³¸)</span>
<span class="n">net</span><span class="o">.</span><span class="n">setPreferableBackend</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_BACKEND_OPENCV</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">setPreferableTarget</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_TARGET_CPU</span><span class="p">)</span>

<span class="c1"># CUDA GPU ì‹¤í–‰ (OpenCVê°€ CUDA ì§€ì›ìœ¼ë¡œ ë¹Œë“œëœ ê²½ìš°)</span>
<span class="c1"># net.setPreferableBackend(cv2.dnn.DNN_BACKEND_CUDA)</span>
<span class="c1"># net.setPreferableTarget(cv2.dnn.DNN_TARGET_CUDA)</span>

<span class="c1"># ì‚¬ìš© ê°€ëŠ¥í•œ ë°±ì—”ë“œ í™•ì¸</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available backends:&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">getAvailableBackends</span><span class="p">())</span>
</code></pre></div>

<h3 id="_6">ë ˆì´ì–´ ì •ë³´ í™•ì¸<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNet</span><span class="p">(</span><span class="s1">&#39;yolov3.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;yolov3.weights&#39;</span><span class="p">)</span>

<span class="c1"># ë ˆì´ì–´ ì´ë¦„ ëª©ë¡</span>
<span class="n">layer_names</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">getLayerNames</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ì´ ë ˆì´ì–´ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">layer_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë ˆì´ì–´ ëª©ë¡ (ì¼ë¶€):&quot;</span><span class="p">,</span> <span class="n">layer_names</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>

<span class="c1"># ì¶œë ¥ ë ˆì´ì–´ (ì—°ê²°ë˜ì§€ ì•Šì€ ë ˆì´ì–´)</span>
<span class="n">output_layers</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">getUnconnectedOutLayers</span><span class="p">()</span>
<span class="n">output_layer_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer_names</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output_layers</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ì¶œë ¥ ë ˆì´ì–´:&quot;</span><span class="p">,</span> <span class="n">output_layer_names</span><span class="p">)</span>

<span class="c1"># íŠ¹ì • ë ˆì´ì–´ ì •ë³´</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">getLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ë ˆì´ì–´ íƒ€ì…: </span><span class="si">{</span><span class="n">layer</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="3-blobfromimage">3. blobFromImage(): ì „ì²˜ë¦¬<a class="header-link" href="#3-blobfromimage" title="Permanent link">&para;</a></h2>
<h3 id="blob">Blob ê°œë…<a class="header-link" href="#blob" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Blob (Binary Large Object):
DNN ëª¨ë¸ ì…ë ¥ì„ ìœ„í•œ 4ì°¨ì› í…ì„œ

ì°¨ì› êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Blob Shape: (N, C, H, W)                                   â”‚
â”‚                                                             â”‚
â”‚  N: ë°°ì¹˜ í¬ê¸° (Batch Size)                                  â”‚
â”‚     - í•œ ë²ˆì— ì²˜ë¦¬í•  ì´ë¯¸ì§€ ìˆ˜                              â”‚
â”‚                                                             â”‚
â”‚  C: ì±„ë„ ìˆ˜ (Channels)                                      â”‚
â”‚     - RGB: 3, ê·¸ë ˆì´ìŠ¤ì¼€ì¼: 1                               â”‚
â”‚                                                             â”‚
â”‚  H: ë†’ì´ (Height)                                           â”‚
â”‚     - ëª¨ë¸ì´ ìš”êµ¬í•˜ëŠ” ì…ë ¥ ë†’ì´                             â”‚
â”‚                                                             â”‚
â”‚  W: ë„ˆë¹„ (Width)                                            â”‚
â”‚     - ëª¨ë¸ì´ ìš”êµ¬í•˜ëŠ” ì…ë ¥ ë„ˆë¹„                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì˜ˆì‹œ: YOLO (416x416)
blob.shape = (1, 3, 416, 416)
             â”‚  â”‚   â”‚    â”‚
             â”‚  â”‚   â”‚    â””â”€â”€ ë„ˆë¹„ 416
             â”‚  â”‚   â””â”€â”€ ë†’ì´ 416
             â”‚  â””â”€â”€ RGB 3ì±„ë„
             â””â”€â”€ ì´ë¯¸ì§€ 1ì¥
</code></pre></div>

<h3 id="blobfromimage">blobFromImage ì‚¬ìš©ë²•<a class="header-link" href="#blobfromimage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>

<span class="c1"># ê¸°ë³¸ Blob ìƒì„±</span>
<span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>                    <span class="c1"># ì…ë ¥ ì´ë¯¸ì§€</span>
    <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span>    <span class="c1"># ìŠ¤ì¼€ì¼ íŒ©í„° (ì •ê·œí™”)</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span>        <span class="c1"># ëª©í‘œ í¬ê¸°</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>         <span class="c1"># í‰ê· ê°’ ë¹¼ê¸°</span>
    <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>            <span class="c1"># BGR â†’ RGB</span>
    <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>              <span class="c1"># í¬ë¡­ ì—¬ë¶€</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Blob shape: </span><span class="si">{</span><span class="n">blob</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (1, 3, 416, 416)</span>

<span class="c1"># ë‹¤ì–‘í•œ ì „ì²˜ë¦¬ ì˜µì…˜</span>

<span class="c1"># 1. ImageNet ìŠ¤íƒ€ì¼ (mean subtraction)</span>
<span class="n">blob_imagenet</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">scalefactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">),</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">117.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span>  <span class="c1"># ImageNet í‰ê· </span>
    <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># 2. YOLO ìŠ¤íƒ€ì¼ (0-1 ì •ê·œí™”)</span>
<span class="n">blob_yolo</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># 3. SSD ìŠ¤íƒ€ì¼</span>
<span class="n">blob_ssd</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
    <span class="n">img</span><span class="p">,</span>
    <span class="n">scalefactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
    <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">177.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span>
    <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="_7">ì—¬ëŸ¬ ì´ë¯¸ì§€ ì²˜ë¦¬<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">prepare_batch</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë°°ì¹˜ë¡œ ì²˜ë¦¬&quot;&quot;&quot;</span>

    <span class="c1"># ë°©ë²• 1: blobFromImages ì‚¬ìš©</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImages</span><span class="p">(</span>
        <span class="n">images</span><span class="p">,</span>
        <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">blob</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.jpg&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">batch_blob</span> <span class="o">=</span> <span class="n">prepare_batch</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch blob shape: </span><span class="si">{</span><span class="n">batch_blob</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (4, 3, 416, 416)</span>

<span class="c1"># ë„¤íŠ¸ì›Œí¬ì— ì…ë ¥</span>
<span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">batch_blob</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
</code></pre></div>

<h3 id="_8">ì „ì²˜ë¦¬ ì‹œê°í™”<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">visualize_blob</span><span class="p">(</span><span class="n">blob</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Blob ë‚´ìš© ì‹œê°í™”&quot;&quot;&quot;</span>

    <span class="c1"># blob shape: (N, C, H, W)</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># ê° ì±„ë„ í‘œì‹œ</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">blob</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Channel </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="c1"># í•©ì„± ì´ë¯¸ì§€ (RGBë¡œ ì¬ì¡°í•©)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">blob</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># CHW â†’ HWC</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="p">(</span><span class="n">combined</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Combined (RGB)&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
<span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span> <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">visualize_blob</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="4-yolo">4. YOLO ê°ì²´ ê²€ì¶œ<a class="header-link" href="#4-yolo" title="Permanent link">&para;</a></h2>
<h3 id="yolo">YOLO ê°œìš”<a class="header-link" href="#yolo" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>YOLO (You Only Look Once):
ì‹¤ì‹œê°„ ê°ì²´ ê²€ì¶œ ì•Œê³ ë¦¬ì¦˜

íŠ¹ì§•:
<span class="k">-</span> ë‹¨ì¼ íŒ¨ìŠ¤ë¡œ ê²€ì¶œ (End-to-End)
<span class="k">-</span> ë¹ ë¥¸ ì†ë„ (ì‹¤ì‹œê°„ ê°€ëŠ¥)
<span class="k">-</span> ì „ì²´ ì´ë¯¸ì§€ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©

ì¶œë ¥ êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  ê° ê²€ì¶œì— ëŒ€í•´:                                            â”‚
â”‚  [center_x, center_y, width, height, confidence, class_scores...]â”‚
â”‚                                                             â”‚
â”‚  - center_x, center_y: ë°”ìš´ë”© ë°•ìŠ¤ ì¤‘ì‹¬ (0-1 ì •ê·œí™”)        â”‚
â”‚  - width, height: ë°•ìŠ¤ í¬ê¸° (0-1 ì •ê·œí™”)                    â”‚
â”‚  - confidence: ê°ì²´ ì¡´ì¬ í™•ë¥                                â”‚
â”‚  - class_scores: ê° í´ë˜ìŠ¤ë³„ í™•ë¥  (80ê°œ)                    â”‚
â”‚                                                             â”‚
â”‚  ì˜ˆ: COCO ë°ì´í„°ì…‹ (80 í´ë˜ìŠ¤)                              â”‚
â”‚  ì¶œë ¥ ë²¡í„° ê¸¸ì´ = 4 + 1 + 80 = 85                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

YOLO ë²„ì „ë³„ íŠ¹ì§•:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë²„ì „    â”‚ ì…ë ¥í¬ê¸° â”‚  mAP     â”‚ ì†ë„ (FPS)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ YOLOv3  â”‚ 416x416  â”‚ 33.0     â”‚ ~35 (GPU)         â”‚
â”‚ YOLOv3-tinyâ”‚ 416x416â”‚ 15.0    â”‚ ~220 (GPU)        â”‚
â”‚ YOLOv4  â”‚ 416x416  â”‚ 43.5     â”‚ ~38 (GPU)         â”‚
â”‚ YOLOv4-tinyâ”‚ 416x416â”‚ 21.7    â”‚ ~371 (GPU)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="yolov3">YOLOv3 êµ¬í˜„<a class="header-link" href="#yolov3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">YOLODetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;YOLOv3 ê°ì²´ ê²€ì¶œê¸°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">,</span> <span class="n">names_path</span><span class="p">,</span>
                 <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nms_threshold</span><span class="o">=</span><span class="mf">0.4</span><span class="p">):</span>
        <span class="c1"># ëª¨ë¸ ë¡œë”©</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromDarknet</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setPreferableBackend</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_BACKEND_OPENCV</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setPreferableTarget</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">DNN_TARGET_CPU</span><span class="p">)</span>

        <span class="c1"># í´ë˜ìŠ¤ ì´ë¦„ ë¡œë”©</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">names_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>

        <span class="c1"># ì¶œë ¥ ë ˆì´ì–´ ì´ë¦„</span>
        <span class="n">layer_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">getLayerNames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer_names</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">getUnconnectedOutLayers</span><span class="p">()]</span>

        <span class="c1"># ì„ê³„ê°’</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nms_threshold</span> <span class="o">=</span> <span class="n">nms_threshold</span>

        <span class="c1"># ìƒ‰ìƒ (í´ë˜ìŠ¤ë³„)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê°ì²´ ê²€ì¶œ&quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Blob ìƒì„±</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span>
                                      <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># ì¶”ë¡ </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_layers</span><span class="p">)</span>

        <span class="c1"># ê²°ê³¼ íŒŒì‹±</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">confidences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">class_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">scores</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
                <span class="n">class_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
                <span class="n">confidence</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                    <span class="c1"># ë°”ìš´ë”© ë°•ìŠ¤ ì¢Œí‘œ (ì •ê·œí™”ë¨)</span>
                    <span class="n">center_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                    <span class="n">center_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                    <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

                    <span class="c1"># ì¢Œìƒë‹¨ ì¢Œí‘œ</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_y</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                    <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
                    <span class="n">confidences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">))</span>
                    <span class="n">class_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_id</span><span class="p">)</span>

        <span class="c1"># Non-Maximum Suppression</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">NMSBoxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nms_threshold</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">box</span><span class="p">,</span>
                <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">confidences</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê²°ê³¼ ì‹œê°í™”&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_id&#39;</span><span class="p">]]]</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="c1"># ëª¨ë¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ í•„ìš”:</span>
<span class="c1"># - yolov3.cfg: https://github.com/pjreddie/darknet/blob/master/cfg/yolov3.cfg</span>
<span class="c1"># - yolov3.weights: https://pjreddie.com/media/files/yolov3.weights</span>
<span class="c1"># - coco.names: https://github.com/pjreddie/darknet/blob/master/data/coco.names</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">YOLODetector</span><span class="p">(</span>
    <span class="s1">&#39;yolov3.cfg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;yolov3.weights&#39;</span><span class="p">,</span>
    <span class="s1">&#39;coco.names&#39;</span>
<span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;street.jpg&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê²€ì¶œëœ ê°ì²´ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;YOLO Detection&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="yolov3-tiny">YOLOv3-tiny (ê²½ëŸ‰ ë²„ì „)<a class="header-link" href="#yolov3-tiny" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">yolo_tiny_detect</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;YOLOv3-tinyë¥¼ ì´ìš©í•œ ë¹ ë¥¸ ê²€ì¶œ&quot;&quot;&quot;</span>

    <span class="c1"># YOLOv3-tiny ë¡œë”©</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromDarknet</span><span class="p">(</span><span class="s1">&#39;yolov3-tiny.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;yolov3-tiny.weights&#39;</span><span class="p">)</span>

    <span class="c1"># í´ë˜ìŠ¤ ì´ë¦„</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;coco.names&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>

    <span class="c1"># ì¶œë ¥ ë ˆì´ì–´</span>
    <span class="n">layer_names</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">getLayerNames</span><span class="p">()</span>
    <span class="n">output_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer_names</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">getUnconnectedOutLayers</span><span class="p">()]</span>

    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Blob ë° ì¶”ë¡ </span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span> <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">output_layers</span><span class="p">)</span>

    <span class="c1"># ê²°ê³¼ íŒŒì‹±</span>
    <span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span> <span class="n">class_ids</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="n">conf_threshold</span><span class="p">:</span>
                <span class="n">center_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">center_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

                <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_y</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
                <span class="n">confidences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">))</span>
                <span class="n">class_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_id</span><span class="p">)</span>

    <span class="c1"># NMS</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">NMSBoxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>

    <span class="c1"># ê²°ê³¼ ê·¸ë¦¬ê¸°</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classes</span><span class="p">[</span><span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">confidences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                   <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>
</code></pre></div>

<hr />
<h2 id="5-ssd-single-shot-detector">5. SSD (Single Shot Detector)<a class="header-link" href="#5-ssd-single-shot-detector" title="Permanent link">&para;</a></h2>
<h3 id="ssd">SSD ê°œìš”<a class="header-link" href="#ssd" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>SSD (Single Shot MultiBox Detector):
ë‹¤ì¤‘ ìŠ¤ì¼€ì¼ íŠ¹ì§•ë§µì„ ì´ìš©í•œ ê°ì²´ ê²€ì¶œ

íŠ¹ì§•:
- ë‹¤ì–‘í•œ í¬ê¸°ì˜ ê°ì²´ ê²€ì¶œì— ê°•í•¨
- YOLOë³´ë‹¤ ì‘ì€ ê°ì²´ ê²€ì¶œ ìš°ìˆ˜
- ë‹¤ì–‘í•œ ë°±ë³¸ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© ê°€ëŠ¥ (VGG, MobileNet ë“±)

ì•„í‚¤í…ì²˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚  ì…ë ¥ ì´ë¯¸ì§€ (300x300)                                     â”‚
â”‚       â”‚                                                    â”‚
â”‚       â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚ ë°±ë³¸     â”‚ VGG16, MobileNet ë“±                         â”‚
â”‚  â”‚ ë„¤íŠ¸ì›Œí¬ â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚       â”‚                                                    â”‚
â”‚       â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 38x38    â”‚  â”‚ 19x19    â”‚  â”‚ 10x10    â”‚  â”‚ 5x5 ...  â”‚   â”‚
â”‚  â”‚ íŠ¹ì§•ë§µ   â”‚  â”‚ íŠ¹ì§•ë§µ   â”‚  â”‚ íŠ¹ì§•ë§µ   â”‚  â”‚ íŠ¹ì§•ë§µ   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚             â”‚             â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                         â”‚                                  â”‚
â”‚                         â–¼                                  â”‚
â”‚                    NMS â†’ ìµœì¢… ê²€ì¶œ                         â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="mobilenet-ssd">MobileNet SSD êµ¬í˜„<a class="header-link" href="#mobilenet-ssd" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SSDDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MobileNet SSD ê°ì²´ ê²€ì¶œê¸°&quot;&quot;&quot;</span>

    <span class="c1"># COCO í´ë˜ìŠ¤ (MobileNet SSD v2)</span>
    <span class="n">CLASSES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="s2">&quot;motorcycle&quot;</span><span class="p">,</span>
               <span class="s2">&quot;airplane&quot;</span><span class="p">,</span> <span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;truck&quot;</span><span class="p">,</span> <span class="s2">&quot;boat&quot;</span><span class="p">,</span> <span class="s2">&quot;traffic light&quot;</span><span class="p">,</span>
               <span class="s2">&quot;fire hydrant&quot;</span><span class="p">,</span> <span class="s2">&quot;stop sign&quot;</span><span class="p">,</span> <span class="s2">&quot;parking meter&quot;</span><span class="p">,</span> <span class="s2">&quot;bench&quot;</span><span class="p">,</span> <span class="s2">&quot;bird&quot;</span><span class="p">,</span>
               <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;horse&quot;</span><span class="p">,</span> <span class="s2">&quot;sheep&quot;</span><span class="p">,</span> <span class="s2">&quot;cow&quot;</span><span class="p">,</span> <span class="s2">&quot;elephant&quot;</span><span class="p">,</span> <span class="s2">&quot;bear&quot;</span><span class="p">,</span>
               <span class="s2">&quot;zebra&quot;</span><span class="p">,</span> <span class="s2">&quot;giraffe&quot;</span><span class="p">,</span> <span class="s2">&quot;backpack&quot;</span><span class="p">,</span> <span class="s2">&quot;umbrella&quot;</span><span class="p">,</span> <span class="s2">&quot;handbag&quot;</span><span class="p">,</span> <span class="s2">&quot;tie&quot;</span><span class="p">,</span>
               <span class="s2">&quot;suitcase&quot;</span><span class="p">,</span> <span class="s2">&quot;frisbee&quot;</span><span class="p">,</span> <span class="s2">&quot;skis&quot;</span><span class="p">,</span> <span class="s2">&quot;snowboard&quot;</span><span class="p">,</span> <span class="s2">&quot;sports ball&quot;</span><span class="p">,</span>
               <span class="s2">&quot;kite&quot;</span><span class="p">,</span> <span class="s2">&quot;baseball bat&quot;</span><span class="p">,</span> <span class="s2">&quot;baseball glove&quot;</span><span class="p">,</span> <span class="s2">&quot;skateboard&quot;</span><span class="p">,</span>
               <span class="s2">&quot;surfboard&quot;</span><span class="p">,</span> <span class="s2">&quot;tennis racket&quot;</span><span class="p">,</span> <span class="s2">&quot;bottle&quot;</span><span class="p">,</span> <span class="s2">&quot;wine glass&quot;</span><span class="p">,</span> <span class="s2">&quot;cup&quot;</span><span class="p">,</span>
               <span class="s2">&quot;fork&quot;</span><span class="p">,</span> <span class="s2">&quot;knife&quot;</span><span class="p">,</span> <span class="s2">&quot;spoon&quot;</span><span class="p">,</span> <span class="s2">&quot;bowl&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span>
               <span class="s2">&quot;sandwich&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;broccoli&quot;</span><span class="p">,</span> <span class="s2">&quot;carrot&quot;</span><span class="p">,</span> <span class="s2">&quot;hot dog&quot;</span><span class="p">,</span> <span class="s2">&quot;pizza&quot;</span><span class="p">,</span>
               <span class="s2">&quot;donut&quot;</span><span class="p">,</span> <span class="s2">&quot;cake&quot;</span><span class="p">,</span> <span class="s2">&quot;chair&quot;</span><span class="p">,</span> <span class="s2">&quot;couch&quot;</span><span class="p">,</span> <span class="s2">&quot;potted plant&quot;</span><span class="p">,</span> <span class="s2">&quot;bed&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dining table&quot;</span><span class="p">,</span> <span class="s2">&quot;toilet&quot;</span><span class="p">,</span> <span class="s2">&quot;tv&quot;</span><span class="p">,</span> <span class="s2">&quot;laptop&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;remote&quot;</span><span class="p">,</span>
               <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;cell phone&quot;</span><span class="p">,</span> <span class="s2">&quot;microwave&quot;</span><span class="p">,</span> <span class="s2">&quot;oven&quot;</span><span class="p">,</span> <span class="s2">&quot;toaster&quot;</span><span class="p">,</span>
               <span class="s2">&quot;sink&quot;</span><span class="p">,</span> <span class="s2">&quot;refrigerator&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;clock&quot;</span><span class="p">,</span> <span class="s2">&quot;vase&quot;</span><span class="p">,</span> <span class="s2">&quot;scissors&quot;</span><span class="p">,</span>
               <span class="s2">&quot;teddy bear&quot;</span><span class="p">,</span> <span class="s2">&quot;hair drier&quot;</span><span class="p">,</span> <span class="s2">&quot;toothbrush&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromTensorflow</span><span class="p">(</span><span class="n">weights_path</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>

        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê°ì²´ ê²€ì¶œ&quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Blob ìƒì„± (SSDëŠ” 300x300 ë˜ëŠ” 512x512 ì…ë ¥)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
                                      <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mf">127.5</span><span class="p">,</span> <span class="mf">127.5</span><span class="p">,</span> <span class="mf">127.5</span><span class="p">),</span>
                                      <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">127.5</span><span class="p">,</span>
                                      <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ì¶œë ¥ shape: (1, 1, N, 7)</span>
        <span class="c1"># ê° ê²€ì¶œ: [batch_id, class_id, confidence, x1, y1, x2, y2]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                <span class="n">class_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

                <span class="c1"># ì¢Œí‘œ (ì •ê·œí™”ë¨ â†’ í”½ì…€)</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">],</span>
                    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">confidence</span><span class="p">,</span>
                    <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_id</span><span class="p">,</span>
                    <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê²°ê³¼ ì‹œê°í™”&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_id&#39;</span><span class="p">]]]</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="c1"># ëª¨ë¸ ë‹¤ìš´ë¡œë“œ:</span>
<span class="c1"># ssd_mobilenet_v2_coco_2018_03_29.pbtxt</span>
<span class="c1"># frozen_inference_graph.pb</span>

<span class="c1"># detector = SSDDetector(</span>
<span class="c1">#     &#39;ssd_mobilenet_v2_coco.pbtxt&#39;,</span>
<span class="c1">#     &#39;frozen_inference_graph.pb&#39;</span>
<span class="c1"># )</span>
</code></pre></div>

<h3 id="caffe-ssd">Caffe SSD (ê²½ëŸ‰)<a class="header-link" href="#caffe-ssd" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ssd_caffe_detect</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">prototxt</span><span class="p">,</span> <span class="n">caffemodel</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Caffe SSD ê²€ì¶œ (MobileNet ë°±ë³¸)&quot;&quot;&quot;</span>

    <span class="n">CLASSES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;aeroplane&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span> <span class="s2">&quot;bird&quot;</span><span class="p">,</span> <span class="s2">&quot;boat&quot;</span><span class="p">,</span>
               <span class="s2">&quot;bottle&quot;</span><span class="p">,</span> <span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;chair&quot;</span><span class="p">,</span> <span class="s2">&quot;cow&quot;</span><span class="p">,</span> <span class="s2">&quot;diningtable&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;horse&quot;</span><span class="p">,</span> <span class="s2">&quot;motorbike&quot;</span><span class="p">,</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;pottedplant&quot;</span><span class="p">,</span>
               <span class="s2">&quot;sheep&quot;</span><span class="p">,</span> <span class="s2">&quot;sofa&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;tvmonitor&quot;</span><span class="p">]</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span><span class="n">prototxt</span><span class="p">,</span> <span class="n">caffemodel</span><span class="p">)</span>

    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Blob ìƒì„±</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">)),</span>
        <span class="mf">0.007843</span><span class="p">,</span>  <span class="c1"># 1/127.5</span>
        <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
        <span class="mf">127.5</span>
    <span class="p">)</span>

    <span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
    <span class="n">detections</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="n">conf_threshold</span><span class="p">:</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">box</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                                                       <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">],</span>
                <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">),</span>
                <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_id</span><span class="p">,</span>
                <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="n">CLASSES</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>

<hr />
<h2 id="6-dnn">6. DNN ì–¼êµ´ ê²€ì¶œ<a class="header-link" href="#6-dnn" title="Permanent link">&para;</a></h2>
<h3 id="opencv-dnn">OpenCV DNN ì–¼êµ´ ê²€ì¶œê¸°<a class="header-link" href="#opencv-dnn" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DNNFaceDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DNN ê¸°ë°˜ ì–¼êµ´ ê²€ì¶œê¸° (res10_300x300)&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_path</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ëª¨ë¸ ë‹¤ìš´ë¡œë“œ:</span>
<span class="sd">        - deploy.prototxt: https://github.com/opencv/opencv/blob/master/samples/dnn/face_detector/deploy.prototxt</span>
<span class="sd">        - res10_300x300_ssd_iter_140000.caffemodel</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">config_path</span><span class="p">:</span>
            <span class="c1"># Caffe ëª¨ë¸</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># TensorFlow ëª¨ë¸</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromTensorflow</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì–¼êµ´ ê²€ì¶œ&quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Blob ìƒì„±</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">177.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span>  <span class="c1"># í‰ê· ê°’</span>
            <span class="n">swapRB</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="n">faces</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

                <span class="c1"># ê²½ê³„ ì²´í¬</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

                <span class="n">faces</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">),</span>
                    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">faces</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">faces</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê²°ê³¼ ì‹œê°í™”&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">face</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="n">face</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Face: </span><span class="si">{</span><span class="n">conf</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">DNNFaceDetector</span><span class="p">(</span>
    <span class="s1">&#39;res10_300x300_ssd_iter_140000.caffemodel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;deploy.prototxt&#39;</span>
<span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;group_photo.jpg&#39;</span><span class="p">)</span>
<span class="n">faces</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê²€ì¶œëœ ì–¼êµ´ ìˆ˜: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;DNN Face Detection&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="dnn_1">ì‹¤ì‹œê°„ DNN ì–¼êµ´ ê²€ì¶œ<a class="header-link" href="#dnn_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">def</span><span class="w"> </span><span class="nf">realtime_dnn_face_detection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹¤ì‹œê°„ DNN ì–¼êµ´ ê²€ì¶œ&quot;&quot;&quot;</span>

    <span class="c1"># ëª¨ë¸ ë¡œë”©</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span>
        <span class="s1">&#39;deploy.prototxt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;res10_300x300_ssd_iter_140000.caffemodel&#39;</span>
    <span class="p">)</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">fps_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Blob ìƒì„±</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">177.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">detections</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="c1"># ê²€ì¶œ ê²°ê³¼ ì²˜ë¦¬</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

                <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">confidence</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
                           <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># FPS ê³„ì‚°</span>
        <span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">fps_time</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">fps</span> <span class="o">=</span> <span class="n">frame_count</span>
            <span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fps_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;FPS: </span><span class="si">{</span><span class="n">fps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                   <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;DNN Face Detection&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># ì‹¤í–‰</span>
<span class="n">realtime_dnn_face_detection</span><span class="p">()</span>
</code></pre></div>

<h3 id="haar-vs-dnn">Haar vs DNN ì–¼êµ´ ê²€ì¶œ ë¹„êµ<a class="header-link" href="#haar-vs-dnn" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compare_face_detectors</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Haarì™€ DNN ì–¼êµ´ ê²€ì¶œ ë¹„êµ&quot;&quot;&quot;</span>

    <span class="c1"># Haar Cascade</span>
    <span class="n">haar</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CascadeClassifier</span><span class="p">(</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">haarcascades</span> <span class="o">+</span> <span class="s1">&#39;haarcascade_frontalface_default.xml&#39;</span>
    <span class="p">)</span>

    <span class="c1"># DNN</span>
    <span class="n">dnn_net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromCaffe</span><span class="p">(</span>
        <span class="s1">&#39;deploy.prototxt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;res10_300x300_ssd_iter_140000.caffemodel&#39;</span>
    <span class="p">)</span>

    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Haar ê²€ì¶œ</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">haar_faces</span> <span class="o">=</span> <span class="n">haar</span><span class="o">.</span><span class="n">detectMultiScale</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">minSize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
    <span class="n">haar_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># DNN ê²€ì¶œ</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
                                  <span class="p">(</span><span class="mf">104.0</span><span class="p">,</span> <span class="mf">177.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">dnn_net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
    <span class="n">dnn_detections</span> <span class="o">=</span> <span class="n">dnn_net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
    <span class="n">dnn_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># ê²°ê³¼ ì‹œê°í™”</span>
    <span class="n">img_haar</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">img_dnn</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="n">haar_faces</span><span class="p">:</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img_haar</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dnn_detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">dnn_detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">dnn_detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img_dnn</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img_haar</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Haar: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">haar_faces</span><span class="p">)</span><span class="si">}</span><span class="s2"> faces, </span><span class="si">{</span><span class="n">haar_time</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">,</span>
               <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">dnn_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dnn_detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">dnn_detections</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img_dnn</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;DNN: </span><span class="si">{</span><span class="n">dnn_count</span><span class="si">}</span><span class="s2"> faces, </span><span class="si">{</span><span class="n">dnn_time</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">,</span>
               <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># ê²°ê³¼ í‘œì‹œ</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">img_haar</span><span class="p">,</span> <span class="n">img_dnn</span><span class="p">])</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Haar vs DNN&#39;</span><span class="p">,</span> <span class="n">combined</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;haar&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">haar_faces</span><span class="p">),</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">haar_time</span><span class="p">},</span>
        <span class="s1">&#39;dnn&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">dnn_count</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">dnn_time</span><span class="p">}</span>
    <span class="p">}</span>

<span class="c1"># ë¹„êµ ì‹¤í–‰</span>
<span class="c1"># result = compare_face_detectors(cv2.imread(&#39;group.jpg&#39;))</span>
</code></pre></div>

<hr />
<h2 id="7-onnx">7. ONNXë¥¼ ì´ìš©í•œ ìµœì‹  ê°ì²´ ê²€ì¶œ<a class="header-link" href="#7-onnx" title="Permanent link">&para;</a></h2>
<h3 id="71-yolov8-opencv-dnn">7.1 YOLOv8ì„ OpenCV DNNìœ¼ë¡œ ì‹¤í–‰í•˜ê¸°<a class="header-link" href="#71-yolov8-opencv-dnn" title="Permanent link">&para;</a></h3>
<p>Ultralyticsì—ì„œ 2023ë…„ì— ì¶œì‹œí•œ YOLOv8ì€ YOLO ê³„ì—´ì˜ í° ì§„ì „ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ONNX í˜•ì‹ìœ¼ë¡œ ë‚´ë³´ë‚´ì„œ OpenCVì˜ DNN ëª¨ë“ˆë¡œ íš¨ìœ¨ì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">YOLOv8Detector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;YOLOv8 ONNX ê°ì²´ ê²€ì¶œê¸°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onnx_model_path</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">iou_threshold</span><span class="o">=</span><span class="mf">0.4</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        YOLOv8 ê²€ì¶œê¸° ì´ˆê¸°í™”</span>

<span class="sd">        YOLOv8ì„ ONNXë¡œ ë‚´ë³´ë‚´ê¸°:</span>
<span class="sd">        pip install ultralytics</span>
<span class="sd">        yolo export model=yolov8n.pt format=onnx</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="n">onnx_model_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iou_threshold</span> <span class="o">=</span> <span class="n">iou_threshold</span>

        <span class="c1"># COCO í´ë˜ìŠ¤ ì´ë¦„ (80ê°œ í´ë˜ìŠ¤)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="s2">&quot;motorcycle&quot;</span><span class="p">,</span> <span class="s2">&quot;airplane&quot;</span><span class="p">,</span> <span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
            <span class="s2">&quot;truck&quot;</span><span class="p">,</span> <span class="s2">&quot;boat&quot;</span><span class="p">,</span> <span class="s2">&quot;traffic light&quot;</span><span class="p">,</span> <span class="s2">&quot;fire hydrant&quot;</span><span class="p">,</span> <span class="s2">&quot;stop sign&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parking meter&quot;</span><span class="p">,</span> <span class="s2">&quot;bench&quot;</span><span class="p">,</span> <span class="s2">&quot;bird&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;horse&quot;</span><span class="p">,</span> <span class="s2">&quot;sheep&quot;</span><span class="p">,</span> <span class="s2">&quot;cow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;elephant&quot;</span><span class="p">,</span> <span class="s2">&quot;bear&quot;</span><span class="p">,</span> <span class="s2">&quot;zebra&quot;</span><span class="p">,</span> <span class="s2">&quot;giraffe&quot;</span><span class="p">,</span> <span class="s2">&quot;backpack&quot;</span><span class="p">,</span> <span class="s2">&quot;umbrella&quot;</span><span class="p">,</span> <span class="s2">&quot;handbag&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tie&quot;</span><span class="p">,</span> <span class="s2">&quot;suitcase&quot;</span><span class="p">,</span> <span class="s2">&quot;frisbee&quot;</span><span class="p">,</span> <span class="s2">&quot;skis&quot;</span><span class="p">,</span> <span class="s2">&quot;snowboard&quot;</span><span class="p">,</span> <span class="s2">&quot;sports ball&quot;</span><span class="p">,</span> <span class="s2">&quot;kite&quot;</span><span class="p">,</span>
            <span class="s2">&quot;baseball bat&quot;</span><span class="p">,</span> <span class="s2">&quot;baseball glove&quot;</span><span class="p">,</span> <span class="s2">&quot;skateboard&quot;</span><span class="p">,</span> <span class="s2">&quot;surfboard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tennis racket&quot;</span><span class="p">,</span> <span class="s2">&quot;bottle&quot;</span><span class="p">,</span> <span class="s2">&quot;wine glass&quot;</span><span class="p">,</span> <span class="s2">&quot;cup&quot;</span><span class="p">,</span> <span class="s2">&quot;fork&quot;</span><span class="p">,</span> <span class="s2">&quot;knife&quot;</span><span class="p">,</span> <span class="s2">&quot;spoon&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bowl&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;sandwich&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;broccoli&quot;</span><span class="p">,</span> <span class="s2">&quot;carrot&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hot dog&quot;</span><span class="p">,</span> <span class="s2">&quot;pizza&quot;</span><span class="p">,</span> <span class="s2">&quot;donut&quot;</span><span class="p">,</span> <span class="s2">&quot;cake&quot;</span><span class="p">,</span> <span class="s2">&quot;chair&quot;</span><span class="p">,</span> <span class="s2">&quot;couch&quot;</span><span class="p">,</span> <span class="s2">&quot;potted plant&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bed&quot;</span><span class="p">,</span> <span class="s2">&quot;dining table&quot;</span><span class="p">,</span> <span class="s2">&quot;toilet&quot;</span><span class="p">,</span> <span class="s2">&quot;tv&quot;</span><span class="p">,</span> <span class="s2">&quot;laptop&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;remote&quot;</span><span class="p">,</span>
            <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;cell phone&quot;</span><span class="p">,</span> <span class="s2">&quot;microwave&quot;</span><span class="p">,</span> <span class="s2">&quot;oven&quot;</span><span class="p">,</span> <span class="s2">&quot;toaster&quot;</span><span class="p">,</span> <span class="s2">&quot;sink&quot;</span><span class="p">,</span>
            <span class="s2">&quot;refrigerator&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;clock&quot;</span><span class="p">,</span> <span class="s2">&quot;vase&quot;</span><span class="p">,</span> <span class="s2">&quot;scissors&quot;</span><span class="p">,</span> <span class="s2">&quot;teddy bear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hair drier&quot;</span><span class="p">,</span> <span class="s2">&quot;toothbrush&quot;</span>
        <span class="p">]</span>

        <span class="c1"># ê° í´ë˜ìŠ¤ë³„ ëœë¤ ìƒ‰ìƒ ìƒì„±</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        YOLOv8 ê°ì²´ ê²€ì¶œ</span>

<span class="sd">        YOLOv8 ì¶œë ¥ í˜•ì‹ (YOLOv5ì™€ ë‹¤ë¦„):</span>
<span class="sd">        - Shape: (1, 84, 8400) for 640x640 ì…ë ¥</span>
<span class="sd">        - ì²« 4ê°œ í–‰: [x_center, y_center, width, height]</span>
<span class="sd">        - 4-83í–‰: í´ë˜ìŠ¤ í™•ë¥  (80ê°œ í´ë˜ìŠ¤)</span>
<span class="sd">        - objectness score ì—†ìŒ (YOLOv5ì™€ ì°¨ì´ì )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ì „ì²˜ë¦¬: letterbox resize</span>
        <span class="n">input_size</span> <span class="o">=</span> <span class="mi">640</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="n">scalefactor</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">input_size</span><span class="p">),</span>
            <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># ì¶”ë¡ </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="c1"># YOLOv8 ì¶œë ¥ shape: (1, 84, 8400)</span>
        <span class="c1"># ì²˜ë¦¬ë¥¼ ì‰½ê²Œ í•˜ê¸° ìœ„í•´ (8400, 84)ë¡œ ì „ì¹˜</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># (8400, 84)</span>

        <span class="n">boxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">confidences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">class_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ì¢Œí‘œ ë³€í™˜ì„ ìœ„í•œ ìŠ¤ì¼€ì¼ íŒ©í„°</span>
        <span class="n">x_scale</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">input_size</span>
        <span class="n">y_scale</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">input_size</span>

        <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="c1"># í´ë˜ìŠ¤ ì ìˆ˜ ì¶”ì¶œ (4-83í–‰)</span>
            <span class="n">class_scores</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">class_scores</span><span class="p">)</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">class_scores</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                <span class="c1"># ë°”ìš´ë”© ë°•ìŠ¤ ì¶”ì¶œ (0-3í–‰: cx, cy, w, h)</span>
                <span class="n">cx</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_scale</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_scale</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_scale</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_scale</span>

                <span class="c1"># ì¢Œìƒë‹¨ ì¢Œí‘œë¡œ ë³€í™˜</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)])</span>
                <span class="n">confidences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">))</span>
                <span class="n">class_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_id</span><span class="p">)</span>

        <span class="c1"># Non-Maximum Suppression</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">NMSBoxes</span><span class="p">(</span>
            <span class="n">boxes</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iou_threshold</span>
        <span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">confidences</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="n">class_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê²€ì¶œ ê²°ê³¼ ì‹œê°í™”&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_id&#39;</span><span class="p">]</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">det</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span>

            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">class_id</span><span class="p">]]</span>

            <span class="c1"># ë°”ìš´ë”© ë°•ìŠ¤ ê·¸ë¦¬ê¸°</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># ë ˆì´ë¸” ê·¸ë¦¬ê¸°</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">confidence</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">(</span><span class="n">label_w</span><span class="p">,</span> <span class="n">label_h</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTextSize</span><span class="p">(</span>
                <span class="n">label</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">label_h</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">label_w</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span>
                <span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">5</span><span class="p">),</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">1</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="c1"># ë¨¼ì € YOLOv8 ëª¨ë¸ì„ ë‚´ë³´ë‚´ê¸°:</span>
<span class="c1"># pip install ultralytics</span>
<span class="c1"># yolo export model=yolov8n.pt format=onnx</span>
<span class="c1"># ì´ë ‡ê²Œ í•˜ë©´ yolov8n.onnxê°€ ìƒì„±ë¨</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">YOLOv8Detector</span><span class="p">(</span><span class="s1">&#39;yolov8n.onnx&#39;</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;street.jpg&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2">ê°œì˜ ê°ì²´ ê²€ì¶œ:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;YOLOv8 Detection&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>

<h3 id="72-onnx-sam-segment-anything-model">7.2 ONNXë¥¼ ì´ìš©í•œ SAM (Segment Anything Model)<a class="header-link" href="#72-onnx-sam-segment-anything-model" title="Permanent link">&para;</a></h3>
<p>Metaì˜ Segment Anything Model (SAM)ì€ ê°•ë ¥í•œ ì´ë¯¸ì§€ ë¶„í• ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. SAMì€ ì¼ë°˜ì ìœ¼ë¡œ PyTorchì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì§€ë§Œ, ì¸ì½”ë”ì™€ ë””ì½”ë”ë¥¼ ONNXë¡œ ë‚´ë³´ë‚´ê³  OpenCV DNNìœ¼ë¡œ ì¶”ë¡ ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SAMONNXDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OpenCVë¥¼ ì´ìš©í•œ ê°„ì†Œí™”ëœ SAM ONNX ì¶”ë¡ </span>

<span class="sd">    SAMì€ ë‘ ê°€ì§€ êµ¬ì„± ìš”ì†Œë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤:</span>
<span class="sd">    1. Image Encoder: ì…ë ¥ ì´ë¯¸ì§€ë¥¼ ì„ë² ë”©ìœ¼ë¡œ ì¸ì½”ë”©</span>
<span class="sd">    2. Mask Decoder: ì„ë² ë”©ê³¼ í”„ë¡¬í”„íŠ¸ë¡œë¶€í„° ë§ˆìŠ¤í¬ ìƒì„±</span>

<span class="sd">    SAMì„ ONNXë¡œ ë‚´ë³´ë‚´ê¸°:</span>
<span class="sd">    https://github.com/facebookresearch/segment-anything</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoder_path</span><span class="p">,</span> <span class="n">decoder_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ONNX ëª¨ë¸ë¡œ SAM ì´ˆê¸°í™”</span>

<span class="sd">        Args:</span>
<span class="sd">            encoder_path: ì¸ì½”ë” ONNX ëª¨ë¸ ê²½ë¡œ</span>
<span class="sd">            decoder_path: ë””ì½”ë” ONNX ëª¨ë¸ ê²½ë¡œ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="n">encoder_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="n">decoder_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># SAM ê¸°ë³¸ í¬ê¸°</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;SAM ì¸ì½”ë”ìš© ì´ë¯¸ì§€ ì „ì²˜ë¦¬&quot;&quot;&quot;</span>
        <span class="c1"># 1024x1024ë¡œ ë¦¬ì‚¬ì´ì¦ˆ</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>

        <span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">))</span>

        <span class="c1"># ì •ì‚¬ê°í˜•ìœ¼ë¡œ íŒ¨ë”©</span>
        <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">padded</span><span class="p">[:</span><span class="n">new_h</span><span class="p">,</span> <span class="p">:</span><span class="n">new_w</span><span class="p">]</span> <span class="o">=</span> <span class="n">resized</span>

        <span class="c1"># ì •ê·œí™” (ImageNet ìŠ¤íƒ€ì¼)</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">padded</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">])</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">normalized</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>

        <span class="c1"># blobìœ¼ë¡œ ë³€í™˜ (1, 3, 1024, 1024)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">blob</span><span class="p">,</span> <span class="n">scale</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encode_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì¸ì½”ë”ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ì„ë² ë”© ìƒì„±&quot;&quot;&quot;</span>
        <span class="n">blob</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">scale</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">segment_with_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">point_coords</span><span class="p">,</span> <span class="n">point_labels</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        í¬ì¸íŠ¸ í”„ë¡¬í”„íŠ¸ë¡œ ì´ë¯¸ì§€ ë¶„í• </span>

<span class="sd">        Args:</span>
<span class="sd">            img: ì…ë ¥ ì´ë¯¸ì§€</span>
<span class="sd">            point_coords: (x, y) ì¢Œí‘œ ë¦¬ìŠ¤íŠ¸</span>
<span class="sd">            point_labels: ë ˆì´ë¸” ë¦¬ìŠ¤íŠ¸ (1=ì „ê²½, 0=ë°°ê²½)</span>

<span class="sd">        Returns:</span>
<span class="sd">            ë¶„í•  ë§ˆìŠ¤í¬</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ì´ë¯¸ì§€ ì„ë² ë”© ê°€ì ¸ì˜¤ê¸°</span>
        <span class="n">embeddings</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># í¬ì¸íŠ¸ ì¢Œí‘œ ìŠ¤ì¼€ì¼ë§</span>
        <span class="n">scaled_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point_coords</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>

        <span class="c1"># ë””ì½”ë” ì…ë ¥ ì¤€ë¹„</span>
        <span class="n">point_coords_input</span> <span class="o">=</span> <span class="n">scaled_coords</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">point_labels_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point_labels</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># ë””ì½”ë” ì‹¤í–‰</span>
        <span class="c1"># ì°¸ê³ : ì‹¤ì œ SAM ONNX ë””ì½”ë”ëŠ” íŠ¹ì • ì…ë ¥ í˜•ì‹ì„ ê°€ì§</span>
        <span class="c1"># ì´ê²ƒì€ ê°„ì†Œí™”ëœ ë²„ì „ - ê³µì‹ SAM ONNX ë‚´ë³´ë‚´ê¸° ì°¸ì¡°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="s1">&#39;image_embeddings&#39;</span><span class="p">)</span>
        <span class="c1"># ë””ì½”ë”ë¥¼ ìœ„í•œ ì¶”ê°€ ì…ë ¥ì´ ì—¬ê¸°ì— ì„¤ì •ë¨</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">mask</span>

<span class="c1"># ê°œë…ì  ì‚¬ìš©ë²• (ì‹¤ì œ SAM ONNX ëª¨ë¸ í•„ìš”)</span>
<span class="c1"># sam = SAMONNXDetector(&#39;sam_vit_h_encoder.onnx&#39;, &#39;sam_vit_h_decoder.onnx&#39;)</span>
<span class="c1"># img = cv2.imread(&#39;image.jpg&#39;)</span>
<span class="c1">#</span>
<span class="c1"># # í¬ì¸íŠ¸ í”„ë¡¬í”„íŠ¸ë¡œ ë¶„í• </span>
<span class="c1"># point_coords = [(100, 150)]  # í´ë¦­ ìœ„ì¹˜</span>
<span class="c1"># point_labels = [1]  # ì „ê²½ í¬ì¸íŠ¸</span>
<span class="c1"># mask = sam.segment_with_point(img, point_coords, point_labels)</span>
</code></pre></div>

<p><strong>ì°¸ê³ </strong>: OpenCV DNNìœ¼ë¡œ SAMì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì€ ì•„í‚¤í…ì²˜ê°€ ë³µì¡í•˜ê¸° ë•Œë¬¸ì— ê¹Œë‹¤ë¡­ìŠµë‹ˆë‹¤. í”„ë¡œë•ì…˜ ìš©ë„ë¡œëŠ” ê³µì‹ SAM êµ¬í˜„ì´ë‚˜ ë¯¸ë¦¬ ë¹Œë“œëœ ì¶”ë¡  ì„œë²„ ì‚¬ìš©ì„ ê³ ë ¤í•˜ì„¸ìš”.</p>
<h3 id="73-zoo-2025">7.3 ëª¨ë¸ Zooì™€ í˜„ì¬ ìƒí™© (2025)<a class="header-link" href="#73-zoo-2025" title="Permanent link">&para;</a></h3>
<p>ê°ì²´ ê²€ì¶œê³¼ ë¶„í•  ë¶„ì•¼ëŠ” í¬ê²Œ ë°œì „í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ì¸ê¸° ìˆëŠ” ëª¨ë¸ë“¤ê³¼ ONNX ê°€ìš©ì„±ì— ëŒ€í•œ ê°œìš”ì…ë‹ˆë‹¤:</p>
<table>
<thead>
<tr>
<th>ëª¨ë¸ ê³„ì—´</th>
<th>ìµœì‹  ë²„ì „</th>
<th>ONNX ì§€ì›</th>
<th>ì‚¬ìš© ì‚¬ë¡€</th>
<th>ì„±ëŠ¥</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>YOLOv8</strong></td>
<td>v8.1 (2024)</td>
<td>âœ… ë„¤ì´í‹°ë¸Œ</td>
<td>ì‹¤ì‹œê°„ ê²€ì¶œ</td>
<td>mAP 53.9 (YOLOv8x)</td>
</tr>
<tr>
<td><strong>YOLOv9</strong></td>
<td>v9.0 (2024)</td>
<td>âœ… ë‚´ë³´ë‚´ê¸°</td>
<td>í–¥ìƒëœ ì •í™•ë„</td>
<td>mAP 55.6</td>
</tr>
<tr>
<td><strong>YOLOv10</strong></td>
<td>v10.0 (2024)</td>
<td>âœ… ë‚´ë³´ë‚´ê¸°</td>
<td>NMS ë¶ˆí•„ìš” YOLO</td>
<td>ë” ë¹ ë¥¸ ì¶”ë¡ </td>
</tr>
<tr>
<td><strong>YOLOv11</strong></td>
<td>v11.0 (2024)</td>
<td>âœ… ë‚´ë³´ë‚´ê¸°</td>
<td>ìµœì‹  Ultralytics</td>
<td>ìµœì²¨ë‹¨</td>
</tr>
<tr>
<td><strong>RT-DETR</strong></td>
<td>v2 (2024)</td>
<td>âœ… ë‚´ë³´ë‚´ê¸°</td>
<td>íŠ¸ëœìŠ¤í¬ë¨¸ ê²€ì¶œê¸°</td>
<td>mAP 53.1, NMS ì—†ìŒ</td>
</tr>
<tr>
<td><strong>SAM</strong></td>
<td>v1.0 (2023)</td>
<td>âœ… ë³µì¡í•¨</td>
<td>ë²”ìš© ë¶„í• </td>
<td>ì œë¡œìƒ· ê°€ëŠ¥</td>
</tr>
<tr>
<td><strong>SAM 2</strong></td>
<td>v2.0 (2024)</td>
<td>âœ… ë³µì¡í•¨</td>
<td>ë¹„ë””ì˜¤ ë¶„í• </td>
<td>ì‹œê°„ì  ì¶”ì </td>
</tr>
<tr>
<td><strong>Depth Anything</strong></td>
<td>v2 (2024)</td>
<td>âœ… ë‚´ë³´ë‚´ê¸°</td>
<td>ë‹¨ì•ˆ ê¹Šì´</td>
<td>ë¹ ë¥´ê³  ì •í™•í•¨</td>
</tr>
<tr>
<td><strong>GroundingDINO</strong></td>
<td>v1.5 (2024)</td>
<td>âš ï¸ ì œí•œì </td>
<td>í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ ê²€ì¶œ</td>
<td>ê°œë°©í˜• ì–´íœ˜</td>
</tr>
<tr>
<td><strong>DINO v2</strong></td>
<td>v2.0 (2024)</td>
<td>âœ… ë‚´ë³´ë‚´ê¸°</td>
<td>ìê°€ì§€ë„ íŠ¹ì§•</td>
<td>ê°•ë ¥í•œ ë°±ë³¸</td>
</tr>
</tbody>
</table>
<h4 id="731-onnx-yolov11">7.3.1 ë¹ ë¥¸ ì‹œì‘: ONNXë¥¼ ì´ìš©í•œ YOLOv11<a class="header-link" href="#731-onnx-yolov11" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Ultralytics ì„¤ì¹˜</span>
<span class="c1"># pip install ultralytics</span>

<span class="c1"># YOLOv11ì„ ONNXë¡œ ë‚´ë³´ë‚´ê¸° (Python)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">YOLO</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="s1">&#39;yolov11n.pt&#39;</span><span class="p">)</span>  <span class="c1"># n, s, m, l, x ë³€í˜•</span>
<span class="n">model</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;onnx&#39;</span><span class="p">,</span> <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># yolov11n.onnx ìƒì„±</span>

<span class="c1"># ê·¸ëŸ° ë‹¤ìŒ OpenCVë¡œ ì‚¬ìš© (ìœ„ì˜ YOLOv8 ì˜ˆì œì™€ ë™ì¼)</span>
<span class="c1"># detector = YOLOv8Detector(&#39;yolov11n.onnx&#39;)  # API í˜¸í™˜</span>
</code></pre></div>

<h4 id="732-rt-detr">7.3.2 RT-DETR: íŠ¸ëœìŠ¤í¬ë¨¸ ê¸°ë°˜ ê²€ì¶œ<a class="header-link" href="#732-rt-detr" title="Permanent link">&para;</a></h4>
<p>RT-DETR (Real-Time DEtection TRansformer)ì€ íŠ¸ëœìŠ¤í¬ë¨¸ ì•„í‚¤í…ì²˜ë¥¼ ì‚¬ìš©í•˜ì—¬ NMSì˜ í•„ìš”ì„±ì„ ì œê±°í•©ë‹ˆë‹¤:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RTDETRDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RT-DETR ONNX ê²€ì¶œê¸° (NMS ë¶ˆí•„ìš”)&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onnx_path</span><span class="p">,</span> <span class="n">conf_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">readNetFromONNX</span><span class="p">(</span><span class="n">onnx_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span> <span class="o">=</span> <span class="n">conf_threshold</span>

        <span class="c1"># COCO í´ë˜ìŠ¤ (YOLOì™€ ë™ì¼)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># 80ê°œ í´ë˜ìŠ¤</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RT-DETR ê²€ì¶œ (NMS ë¶ˆí•„ìš”)</span>

<span class="sd">        ì¶œë ¥ í˜•ì‹: ì§ì ‘ ë°”ìš´ë”© ë°•ìŠ¤ì™€ ì ìˆ˜</span>
<span class="sd">        Shape: (1, 300, 6) - ìƒìœ„ 300ê°œ ê²€ì¶œ</span>
<span class="sd">        ê° ê²€ì¶œ: [x1, y1, x2, y2, confidence, class_id]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ì „ì²˜ë¦¬ (RT-DETRì€ 640x640 ì‚¬ìš©)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dnn</span><span class="o">.</span><span class="n">blobFromImage</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">640</span><span class="p">),</span>
            <span class="n">mean</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">swapRB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

        <span class="c1"># ì¶œë ¥ íŒŒì‹± (ì´ë¯¸ ëª¨ë¸ì´ NMS í•„í„°ë§í•¨)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># (300, 6)</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">detection</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">confidence</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_threshold</span><span class="p">:</span>
                <span class="n">class_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

                <span class="c1"># ì¢Œí‘œ ìŠ¤ì¼€ì¼ë§</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">detection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>

                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">],</span>
                    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">),</span>
                    <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="n">class_id</span><span class="p">,</span>
                    <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="n">class_id</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

<span class="c1"># RT-DETRì„ ONNXë¡œ ë‚´ë³´ë‚´ê¸°:</span>
<span class="c1"># pip install ultralytics</span>
<span class="c1"># yolo export model=rtdetr-l.pt format=onnx</span>
</code></pre></div>

<h4 id="733">7.3.3 ëª¨ë¸ ì„ íƒ ê°€ì´ë“œ<a class="header-link" href="#733" title="Permanent link">&para;</a></h4>
<p><strong>ì‹¤ì‹œê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© (ì—£ì§€ ë””ë°”ì´ìŠ¤, ëª¨ë°”ì¼)</strong>:
- YOLOv8n/s: ê°€ì¥ ë¹ ë¦„, ì„ë² ë””ë“œ ì‹œìŠ¤í…œì— ì í•©
- YOLOv10n: NMS ì˜¤ë²„í—¤ë“œ ì—†ìŒ, ë”ìš± ë¹ ë¦„
- RT-DETR-s: ìµœê³ ì˜ ì •í™•ë„/ì†ë„ ê· í˜•</p>
<p><strong>ê³ ì •í™•ë„ìš© (ì„œë²„, í´ë¼ìš°ë“œ)</strong>:
- YOLOv11x: ìµœì²¨ë‹¨ ê²€ì¶œ
- RT-DETR-x: íŠ¸ëœìŠ¤í¬ë¨¸ì˜ ì¥ì 
- ì—¬ëŸ¬ ëª¨ë¸ ì•™ìƒë¸”</p>
<p><strong>ë¶„í• ìš©</strong>:
- YOLOv8-seg: ì¸ìŠ¤í„´ìŠ¤ ë¶„í•  (ONNX ë„¤ì´í‹°ë¸Œ)
- SAM/SAM2: ë²”ìš© ë¶„í•  (í”„ë¡¬í”„íŠ¸ ê¸°ë°˜)
- Depth Anything: ê¹Šì´ ì¶”ì •</p>
<p><strong>OpenCV DNN í˜¸í™˜ì„±</strong>:
- âœ… ì™„ì „ ì§€ì›: YOLOv8-11, RT-DETR, MobileNet-SSD
- âš ï¸ ë¶€ë¶„ì : SAM (ë³µì¡í•œ ë‹¤ë‹¨ê³„ íŒŒì´í”„ë¼ì¸)
- âŒ ì œí•œì : ì»¤ìŠ¤í…€ ì—°ì‚°ì´ í•„ìš”í•œ ëª¨ë¸ (GroundingDINO)</p>
<p><strong>ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ (RTX 4090, 2024)</strong>:</p>
<table>
<thead>
<tr>
<th>ëª¨ë¸</th>
<th>ì…ë ¥ í¬ê¸°</th>
<th>FPS (CUDA)</th>
<th>mAP</th>
<th>OpenCV DNN</th>
</tr>
</thead>
<tbody>
<tr>
<td>YOLOv8n</td>
<td>640</td>
<td>450</td>
<td>37.3</td>
<td>âœ… ìš°ìˆ˜</td>
</tr>
<tr>
<td>YOLOv11m</td>
<td>640</td>
<td>200</td>
<td>51.5</td>
<td>âœ… ìš°ìˆ˜</td>
</tr>
<tr>
<td>RT-DETR-l</td>
<td>640</td>
<td>110</td>
<td>53.1</td>
<td>âœ… íƒì›”</td>
</tr>
<tr>
<td>YOLOv8x</td>
<td>640</td>
<td>80</td>
<td>53.9</td>
<td>âœ… ìš°ìˆ˜</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="8">8. ì—°ìŠµ ë¬¸ì œ<a class="header-link" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="1">ë¬¸ì œ 1: ê°ì²´ ê²€ì¶œ ì„±ëŠ¥ ë¹„êµ<a class="header-link" href="#1" title="Permanent link">&para;</a></h3>
<p>YOLOì™€ SSDì˜ ì„±ëŠ¥ì„ ë¹„êµí•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- ë™ì¼í•œ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì„¸íŠ¸ ì‚¬ìš©
- ê²€ì¶œ ì†ë„ ì¸¡ì •
- ê²€ì¶œ ì •í™•ë„ ë¹„êµ (IoU ê¸°ë°˜)
- ê²°ê³¼ ì‹œê°í™”</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_detectors</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">yolo_detector</span><span class="p">,</span> <span class="n">ssd_detector</span><span class="p">):</span>
    <span class="c1"># YOLO ê²€ì¶œ</span>
    <span class="n">yolo_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">yolo_results</span> <span class="o">=</span> <span class="n">yolo_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">yolo_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">yolo_start</span>

    <span class="c1"># SSD ê²€ì¶œ</span>
    <span class="n">ssd_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">ssd_results</span> <span class="o">=</span> <span class="n">ssd_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ssd_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ssd_start</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;yolo&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="n">yolo_results</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">yolo_time</span><span class="p">},</span>
        <span class="s1">&#39;ssd&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="n">ssd_results</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ssd_time</span><span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>



</details>

<h3 id="2">ë¬¸ì œ 2: ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ í•„í„°ë§<a class="header-link" href="#2" title="Permanent link">&para;</a></h3>
<p>íŠ¹ì • í´ë˜ìŠ¤ë§Œ ê²€ì¶œí•˜ëŠ” í•„í„°ë§ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- ê²€ì¶œí•  í´ë˜ìŠ¤ ëª©ë¡ ì§€ì •
- ë‹¤ë¥¸ í´ë˜ìŠ¤ ë¬´ì‹œ
- í´ë˜ìŠ¤ë³„ ìƒ‰ìƒ ì§€ì •
- í´ë˜ìŠ¤ë³„ ì‹ ë¢°ë„ ì„ê³„ê°’ ì„¤ì •</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FilteredDetector</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_detector</span><span class="p">,</span> <span class="n">target_classes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">base_detector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_classes</span> <span class="o">=</span> <span class="n">target_classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_thresholds</span> <span class="o">=</span> <span class="p">{</span><span class="bp">cls</span><span class="p">:</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">target_classes</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">all_results</span>
                    <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_classes</span> <span class="ow">and</span>
                    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_thresholds</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">]]]</span>
        <span class="k">return</span> <span class="n">filtered</span>
</code></pre></div>



</details>

<h3 id="3">ë¬¸ì œ 3: ë¹„ë””ì˜¤ ê°ì²´ ì¶”ì  + ê²€ì¶œ<a class="header-link" href="#3" title="Permanent link">&para;</a></h3>
<p>ê²€ì¶œê³¼ ì¶”ì ì„ ê²°í•©í•˜ì—¬ ì•ˆì •ì ì¸ ë¹„ë””ì˜¤ ê°ì²´ ì¸ì‹ì„ êµ¬í˜„í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- N í”„ë ˆì„ë§ˆë‹¤ ê²€ì¶œ ìˆ˜í–‰
- ì¤‘ê°„ í”„ë ˆì„ì€ ì¶”ì ìœ¼ë¡œ ëŒ€ì²´
- ID í• ë‹¹ ë° ìœ ì§€
- ì¶”ì  ì‹¤íŒ¨ ì‹œ ì¬ê²€ì¶œ</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DetectionTracker</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detector</span><span class="p">,</span> <span class="n">detect_every_n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">detector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_every_n</span> <span class="o">=</span> <span class="n">detect_every_n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_every_n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># ìƒˆë¡œìš´ ê²€ì¶œ</span>
            <span class="n">detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_trackers</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">detections</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ê¸°ì¡´ íŠ¸ë˜ì»¤ ì—…ë°ì´íŠ¸</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_existing_trackers</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_positions</span><span class="p">()</span>
</code></pre></div>



</details>

<h3 id="4">ë¬¸ì œ 4: ëª¨ë¸ ì•™ìƒë¸”<a class="header-link" href="#4" title="Permanent link">&para;</a></h3>
<p>ì—¬ëŸ¬ ëª¨ë¸ì˜ ê²°ê³¼ë¥¼ ê²°í•©í•˜ì—¬ ì •í™•ë„ë¥¼ ë†’ì´ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- 2ê°œ ì´ìƒì˜ ëª¨ë¸ ì‚¬ìš©
- ê²€ì¶œ ê²°ê³¼ ë³‘í•© (Weighted NMS)
- ì‹ ë¢°ë„ ë³´ì •
- ìµœì¢… ê²°ê³¼ ì¶œë ¥</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ensemble_detection</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">detectors</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">all_boxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_classes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">detector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">detectors</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">weights</span> <span class="k">else</span> <span class="mf">1.0</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">all_boxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
            <span class="n">all_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span>
            <span class="n">all_classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;class_id&#39;</span><span class="p">])</span>

    <span class="c1"># Soft-NMS ë˜ëŠ” Weighted Box Fusion</span>
    <span class="n">final_results</span> <span class="o">=</span> <span class="n">weighted_nms</span><span class="p">(</span><span class="n">all_boxes</span><span class="p">,</span> <span class="n">all_scores</span><span class="p">,</span> <span class="n">all_classes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final_results</span>
</code></pre></div>



</details>

<h3 id="5">ë¬¸ì œ 5: ì‹¤ì‹œê°„ ê°ì²´ ê³„ìˆ˜ ì‹œìŠ¤í…œ<a class="header-link" href="#5" title="Permanent link">&para;</a></h3>
<p>ë¹„ë””ì˜¤ì—ì„œ íŠ¹ì • ê°ì²´(ì˜ˆ: ì‚¬ëŒ, ì°¨ëŸ‰)ë¥¼ ê³„ìˆ˜í•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ì„¸ìš”.</p>
<p><strong>ìš”êµ¬ì‚¬í•­</strong>:
- ì‹¤ì‹œê°„ ê²€ì¶œ
- ê³„ìˆ˜ ë¼ì¸/ì˜ì—­ ì„¤ì •
- ì§„ì…/í‡´ì¥ êµ¬ë¶„
- í†µê³„ í‘œì‹œ (ì‹œê°„ë³„, ëˆ„ì )</p>
<details>
<summary>íŒíŠ¸</summary>


<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ObjectCounter</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detector</span><span class="p">,</span> <span class="n">count_line_y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">detector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_line_y</span> <span class="o">=</span> <span class="n">count_line_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {id: previous_y}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_in</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_out</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="c1"># ê°ì²´ ì¤‘ì‹¬ y ì¢Œí‘œ</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
            <span class="n">center_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>

            <span class="c1"># ì´ì „ ìœ„ì¹˜ì™€ ë¹„êµí•˜ì—¬ ë¼ì¸ í†µê³¼ í™•ì¸</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
                <span class="n">prev_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">prev_y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_line_y</span> <span class="o">&lt;=</span> <span class="n">center_y</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">count_out</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">prev_y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_line_y</span> <span class="o">&gt;=</span> <span class="n">center_y</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">count_in</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">center_y</span>
</code></pre></div>



</details>

<hr />
<h2 id="_9">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_9" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="./20_Practical_Projects.md">20_Practical_Projects.md</a> - ë¬¸ì„œ ìŠ¤ìºë„ˆ, ì°¨ì„  ê²€ì¶œ, AR ë§ˆì»¤, ì–¼êµ´ í•„í„°</li>
</ul>
<hr />
<h2 id="_10">ì°¸ê³  ìë£Œ<a class="header-link" href="#_10" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.opencv.org/4.x/d2/d58/tutorial_table_of_content_dnn.html">OpenCV DNN Module</a></li>
<li><a href="https://arxiv.org/abs/1506.02640">YOLO Paper</a></li>
<li><a href="https://arxiv.org/abs/1512.02325">SSD Paper</a></li>
<li><a href="https://github.com/opencv/opencv/tree/master/samples/dnn">OpenCV Model Zoo</a></li>
<li><a href="https://github.com/onnx/models">ONNX Model Zoo</a></li>
<li><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md">TensorFlow Detection Model Zoo</a></li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/18_Camera_Calibration.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ (Camera Calibration)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/20_Practical_Projects.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">ì‹¤ì „ í”„ë¡œì íŠ¸ (Practical Projects)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}