{% raw %}
<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì „ í”„ë¡œì íŠ¸ (Practical Projects) - Study Materials</title>
    <link rel="stylesheet" href="/study/static/css/style.css">
    <link rel="stylesheet" href="/study/static/css/highlight.css">
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });"></script>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/study/ko/" class="logo">Study Materials</a>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <span></span>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="/study/ko/" class="nav-item ">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Home</span>
                </a>
                <a href="/study/examples/" class="nav-item ">
                    <span class="nav-icon">ğŸ’»</span>
                    <span class="nav-text">Examples</span>
                </a>
            </nav>

            <div class="sidebar-search">
                <form action="/study/ko/search.html" method="get" id="search-form">
                    <input type="search" name="q" placeholder="Search..." id="search-sidebar-input">
                </form>
            </div>

            <!-- Language Selector -->
            <div class="sidebar-lang">
                <select id="lang-select" class="lang-selector" onchange="switchLanguage(this.value)">
                    
                    <option value="en" >
                        English
                    </option>
                    
                    <option value="ko" selected>
                        í•œêµ­ì–´
                    </option>
                    
                </select>
            </div>

            <div class="sidebar-footer">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <span class="theme-icon light">â˜€ï¸</span>
                    <span class="theme-icon dark">ğŸŒ™</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
                    <span></span>
                </button>
                
<nav class="breadcrumb">
    <a href="/study/ko/">Topics</a>
    <span class="separator">/</span>
    <a href="/study/ko/Computer_Vision/">Computer Vision</a>
    <span class="separator">/</span>
    <span class="current">ì‹¤ì „ í”„ë¡œì íŠ¸ (Practical Projects)</span>
</nav>

            </header>

            <div class="content">
                
<article class="lesson-article">
    <header class="lesson-header">
        <h1>ì‹¤ì „ í”„ë¡œì íŠ¸ (Practical Projects)</h1>
    </header>

    
<div class="lesson-toolbar lesson-toolbar--top">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/19_DNN_Module.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë”¥ëŸ¬ë‹ DNN ëª¨ë“ˆ (Deep Neural Network Module)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/21_3D_Vision_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">3D ë¹„ì „ ê¸°ì´ˆ (3D Vision Basics)</span>
        </a>
        
    </div>
</div>


    
    <nav class="toc" id="toc">
        <h2>Table of Contents</h2>
        <div class="toc">
<ul>
<li><a href="#_1">ê°œìš”</a></li>
<li><a href="#_2">ëª©ì°¨</a></li>
<li><a href="#1">í”„ë¡œì íŠ¸ 1: ë¬¸ì„œ ìŠ¤ìºë„ˆ</a><ul>
<li><a href="#_3">í”„ë¡œì íŠ¸ ê°œìš”</a></li>
<li><a href="#_4">ë‹¨ê³„ë³„ êµ¬í˜„</a></li>
<li><a href="#_5">ì‹¤ì‹œê°„ ë¬¸ì„œ ìŠ¤ìºë„ˆ</a></li>
</ul>
</li>
<li><a href="#2">í”„ë¡œì íŠ¸ 2: ì°¨ì„  ê²€ì¶œ</a><ul>
<li><a href="#_6">í”„ë¡œì íŠ¸ ê°œìš”</a></li>
<li><a href="#_7">ë‹¨ê³„ë³„ êµ¬í˜„</a></li>
<li><a href="#_8">ë¹„ë””ì˜¤ ì°¨ì„  ê²€ì¶œ</a></li>
</ul>
</li>
<li><a href="#3-ar">í”„ë¡œì íŠ¸ 3: AR ë§ˆì»¤ ê²€ì¶œ</a><ul>
<li><a href="#_9">í”„ë¡œì íŠ¸ ê°œìš”</a></li>
<li><a href="#_10">ë‹¨ê³„ë³„ êµ¬í˜„</a></li>
<li><a href="#aruco-opencv">ArUco ë§ˆì»¤ ì‚¬ìš© (OpenCV ë‚´ì¥)</a></li>
</ul>
</li>
<li><a href="#4">í”„ë¡œì íŠ¸ 4: ì‹¤ì‹œê°„ ì–¼êµ´ í•„í„°</a><ul>
<li><a href="#_11">í”„ë¡œì íŠ¸ ê°œìš”</a></li>
<li><a href="#_12">ë‹¨ê³„ë³„ êµ¬í˜„</a></li>
</ul>
</li>
<li><a href="#5">í”„ë¡œì íŠ¸ 5: ê°ì²´ ì¶”ì  ì‹œìŠ¤í…œ</a><ul>
<li><a href="#_13">í”„ë¡œì íŠ¸ ê°œìš”</a></li>
<li><a href="#_14">ë‹¨ê³„ë³„ êµ¬í˜„</a></li>
</ul>
</li>
<li><a href="#_15">ì—°ìŠµ ë¬¸ì œ ë° í™•ì¥ ì•„ì´ë””ì–´</a><ul>
<li><a href="#1_1">í”„ë¡œì íŠ¸ 1: ë¬¸ì„œ ìŠ¤ìºë„ˆ í™•ì¥</a></li>
<li><a href="#2_1">í”„ë¡œì íŠ¸ 2: ì°¨ì„  ê²€ì¶œ í™•ì¥</a></li>
<li><a href="#3-ar_1">í”„ë¡œì íŠ¸ 3: AR ë§ˆì»¤ í™•ì¥</a></li>
<li><a href="#4_1">í”„ë¡œì íŠ¸ 4: ì–¼êµ´ í•„í„° í™•ì¥</a></li>
<li><a href="#5_1">í”„ë¡œì íŠ¸ 5: ê°ì²´ ì¶”ì  í™•ì¥</a></li>
</ul>
</li>
<li><a href="#_16">ë‹¤ìŒ ë‹¨ê³„</a><ul>
<li><a href="#_17">ë”¥ëŸ¬ë‹ í”„ë ˆì„ì›Œí¬</a></li>
<li><a href="#_18">ê³ ê¸‰ ì»´í“¨í„° ë¹„ì „</a></li>
<li><a href="#_19">ì‘ìš© ë¶„ì•¼</a></li>
</ul>
</li>
<li><a href="#_20">ì°¸ê³  ìë£Œ</a></li>
</ul>
</div>

    </nav>
    

    <div class="lesson-content markdown-body">
        <h1 id="practical-projects">ì‹¤ì „ í”„ë¡œì íŠ¸ (Practical Projects)<a class="header-link" href="#practical-projects" title="Permanent link">&para;</a></h1>
<h2 id="_1">ê°œìš”<a class="header-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>ì§€ê¸ˆê¹Œì§€ í•™ìŠµí•œ OpenCV ê¸°ìˆ ë“¤ì„ ì¢…í•©í•˜ì—¬ ì‹¤ì œ ì‘ìš© í”„ë¡œì íŠ¸ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. ê° í”„ë¡œì íŠ¸ëŠ” ì—¬ëŸ¬ ê¸°ìˆ ì„ ì¡°í•©í•˜ì—¬ ì™„ì„±ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“œëŠ” ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤.</p>
<p><strong>ë‚œì´ë„</strong>: â­â­â­â­</p>
<p><strong>ì„ ìˆ˜ ì§€ì‹</strong>: ì´ì „ ëª¨ë“  ì±•í„°ì˜ ë‚´ìš©</p>
<hr />
<h2 id="_2">ëª©ì°¨<a class="header-link" href="#_2" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#í”„ë¡œì íŠ¸-1-ë¬¸ì„œ-ìŠ¤ìºë„ˆ">í”„ë¡œì íŠ¸ 1: ë¬¸ì„œ ìŠ¤ìºë„ˆ</a></li>
<li><a href="#í”„ë¡œì íŠ¸-2-ì°¨ì„ -ê²€ì¶œ">í”„ë¡œì íŠ¸ 2: ì°¨ì„  ê²€ì¶œ</a></li>
<li><a href="#í”„ë¡œì íŠ¸-3-ar-ë§ˆì»¤-ê²€ì¶œ">í”„ë¡œì íŠ¸ 3: AR ë§ˆì»¤ ê²€ì¶œ</a></li>
<li><a href="#í”„ë¡œì íŠ¸-4-ì‹¤ì‹œê°„-ì–¼êµ´-í•„í„°">í”„ë¡œì íŠ¸ 4: ì‹¤ì‹œê°„ ì–¼êµ´ í•„í„°</a></li>
<li><a href="#í”„ë¡œì íŠ¸-5-ê°ì²´-ì¶”ì -ì‹œìŠ¤í…œ">í”„ë¡œì íŠ¸ 5: ê°ì²´ ì¶”ì  ì‹œìŠ¤í…œ</a></li>
<li><a href="#ì—°ìŠµ-ë¬¸ì œ-ë°-í™•ì¥-ì•„ì´ë””ì–´">ì—°ìŠµ ë¬¸ì œ ë° í™•ì¥ ì•„ì´ë””ì–´</a></li>
</ol>
<hr />
<h2 id="1">í”„ë¡œì íŠ¸ 1: ë¬¸ì„œ ìŠ¤ìºë„ˆ<a class="header-link" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="_3">í”„ë¡œì íŠ¸ ê°œìš”<a class="header-link" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ë¬¸ì„œ ìŠ¤ìºë„ˆ (Document Scanner):
ì‚¬ì§„ìœ¼ë¡œ ì°ì€ ë¬¸ì„œë¥¼ ì •ë ¬ëœ ìŠ¤ìº” ì´ë¯¸ì§€ë¡œ ë³€í™˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì´¬ì˜ëœ ë¬¸ì„œ     â”‚        â”‚   ìŠ¤ìº”ëœ ê²°ê³¼    â”‚
â”‚  /â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾\   â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ /             \  â”‚  â”€â”€â–¶   â”‚ â”‚              â”‚ â”‚
â”‚ \             /  â”‚        â”‚ â”‚   ë¬¸ì„œ ë‚´ìš©   â”‚ â”‚
â”‚  \___________/   â”‚        â”‚ â”‚              â”‚ â”‚
â”‚                  â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     ê¸°ìš¸ì–´ì§„ ì›ë³¸                ì •ë ¬ëœ ê²°ê³¼

ì‚¬ìš© ê¸°ìˆ :
<span class="k">-</span> ì—£ì§€ ê²€ì¶œ (Canny)
<span class="k">-</span> ìœ¤ê³½ì„  ê²€ì¶œ (findContours)
<span class="k">-</span> ë‹¤ê°í˜• ê·¼ì‚¬ (approxPolyDP)
<span class="k">-</span> ì›ê·¼ ë³€í™˜ (warpPerspective)
<span class="k">-</span> ì´ì§„í™” (adaptiveThreshold)
</code></pre></div>

<h3 id="_4">ë‹¨ê³„ë³„ êµ¬í˜„<a class="header-link" href="#_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DocumentScanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë¬¸ì„œ ìŠ¤ìºë„ˆ&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">order_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;4ê°œì˜ ì ì„ ìˆœì„œëŒ€ë¡œ ì •ë ¬ (ì¢Œìƒ, ìš°ìƒ, ìš°í•˜, ì¢Œí•˜)&quot;&quot;&quot;</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># ì¢Œìƒ: x+y í•©ì´ ê°€ì¥ ì‘ìŒ</span>
        <span class="c1"># ìš°í•˜: x+y í•©ì´ ê°€ì¥ í¼</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
        <span class="n">rect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>

        <span class="c1"># ìš°ìƒ: y-x ì°¨ì´ê°€ ê°€ì¥ ì‘ìŒ</span>
        <span class="c1"># ì¢Œí•˜: y-x ì°¨ì´ê°€ ê°€ì¥ í¼</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">diff</span><span class="p">)]</span>
        <span class="n">rect</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">diff</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">rect</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">four_point_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">pts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì›ê·¼ ë³€í™˜ìœ¼ë¡œ ë¬¸ì„œ ì •ë ¬&quot;&quot;&quot;</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_points</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
        <span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">bl</span><span class="p">)</span> <span class="o">=</span> <span class="n">rect</span>

        <span class="c1"># ìƒˆ ì´ë¯¸ì§€ í¬ê¸° ê³„ì‚°</span>
        <span class="n">width_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">br</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">br</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">width_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">tl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width_a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">width_b</span><span class="p">))</span>

        <span class="n">height_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">height_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">max_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">height_a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">height_b</span><span class="p">))</span>

        <span class="c1"># ëª©í‘œ ì¢Œí‘œ</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">max_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">max_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># ì›ê·¼ ë³€í™˜ í–‰ë ¬</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">warped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_document_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¬¸ì„œ ìœ¤ê³½ì„  ì°¾ê¸°&quot;&quot;&quot;</span>
        <span class="c1"># ì „ì²˜ë¦¬</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">blur</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># ì—£ì§€ ê²€ì¶œ</span>
        <span class="n">edged</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">blur</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

        <span class="c1"># ëª¨í´ë¡œì§€ ì—°ì‚°ìœ¼ë¡œ ì—£ì§€ ì—°ê²°</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">edged</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">edged</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">edged</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">edged</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># ìœ¤ê³½ì„  ê²€ì¶œ</span>
        <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">edged</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span>
                                        <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

        <span class="c1"># ê°€ì¥ í° 4ê°í˜• ìœ¤ê³½ì„  ì°¾ê¸°</span>
        <span class="n">contours</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">document_contour</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># ìƒìœ„ 5ê°œë§Œ í™•ì¸</span>
            <span class="n">peri</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">arcLength</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">approx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">approxPolyDP</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">peri</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">approx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">document_contour</span> <span class="o">=</span> <span class="n">approx</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">document_contour</span><span class="p">,</span> <span class="n">edged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enhance_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¬¸ì„œ ì´ë¯¸ì§€ í–¥ìƒ&quot;&quot;&quot;</span>
        <span class="c1"># ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

        <span class="c1"># ì ì‘í˜• ì´ì§„í™”</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
            <span class="n">gray</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_GAUSSIAN_C</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">,</span>
            <span class="mi">11</span><span class="p">,</span> <span class="mi">2</span>
        <span class="p">)</span>

        <span class="c1"># ë˜ëŠ” OTSU ì´ì§„í™”</span>
        <span class="c1"># _, binary = cv2.threshold(gray, 0, 255,</span>
        <span class="c1">#                           cv2.THRESH_BINARY + cv2.THRESH_OTSU)</span>

        <span class="k">return</span> <span class="n">binary</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">enhance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë¬¸ì„œ ìŠ¤ìº” ì „ì²´ ê³¼ì •&quot;&quot;&quot;</span>
        <span class="n">original</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ì²˜ë¦¬ë¥¼ ìœ„í•´ ë¦¬ì‚¬ì´ì¦ˆ (ë¹„ìœ¨ ìœ ì§€)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mf">500.0</span> <span class="o">/</span> <span class="n">height</span>
        <span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="n">ratio</span><span class="p">)</span>

        <span class="c1"># ë¬¸ì„œ ìœ¤ê³½ì„  ì°¾ê¸°</span>
        <span class="n">contour</span><span class="p">,</span> <span class="n">edged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_document_contour</span><span class="p">(</span><span class="n">resized</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">contour</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ë¬¸ì„œ ìœ¤ê³½ì„ ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># ì›ë³¸ í¬ê¸°ë¡œ ì¢Œí‘œ ë³€í™˜</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="n">contour</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">ratio</span>

        <span class="c1"># ì›ê·¼ ë³€í™˜</span>
        <span class="n">scanned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">four_point_transform</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">contour</span><span class="p">)</span>

        <span class="c1"># ë¬¸ì„œ í–¥ìƒ (ì„ íƒì‚¬í•­)</span>
        <span class="k">if</span> <span class="n">enhance</span><span class="p">:</span>
            <span class="n">scanned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enhance_document</span><span class="p">(</span><span class="n">scanned</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scanned</span><span class="p">,</span> <span class="n">contour</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê²°ê³¼ ì‹œê°í™”&quot;&quot;&quot;</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">contour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="p">[</span><span class="n">contour</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># ì½”ë„ˆ ì  í‘œì‹œ</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">contour</span><span class="p">:</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)),</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vis</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">scanner</span> <span class="o">=</span> <span class="n">DocumentScanner</span><span class="p">()</span>

<span class="c1"># ì´ë¯¸ì§€ ë¡œë“œ</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;document_photo.jpg&#39;</span><span class="p">)</span>

<span class="c1"># ìŠ¤ìº”</span>
<span class="n">scanned</span><span class="p">,</span> <span class="n">contour</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">enhance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">if</span> <span class="n">scanned</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># ê²°ê³¼ ì‹œê°í™”</span>
    <span class="n">vis</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">contour</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Original with Contour&#39;</span><span class="p">,</span> <span class="n">vis</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Scanned&#39;</span><span class="p">,</span> <span class="n">scanned</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># ì €ì¥</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">&#39;scanned_document.jpg&#39;</span><span class="p">,</span> <span class="n">scanned</span><span class="p">)</span>
</code></pre></div>

<h3 id="_5">ì‹¤ì‹œê°„ ë¬¸ì„œ ìŠ¤ìºë„ˆ<a class="header-link" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">realtime_document_scanner</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹¤ì‹œê°„ ë¬¸ì„œ ìŠ¤ìºë„ˆ&quot;&quot;&quot;</span>

    <span class="n">scanner</span> <span class="o">=</span> <span class="n">DocumentScanner</span><span class="p">()</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># ë¬¸ì„œ ìœ¤ê³½ì„  ê²€ì¶œ</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="mf">500.0</span> <span class="o">/</span> <span class="n">height</span>
        <span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="n">ratio</span><span class="p">)</span>

        <span class="n">contour</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">find_document_contour</span><span class="p">(</span><span class="n">resized</span><span class="p">)</span>

        <span class="n">display</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">contour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ì›ë³¸ í¬ê¸°ë¡œ ë³€í™˜</span>
            <span class="n">contour</span> <span class="o">=</span> <span class="p">(</span><span class="n">contour</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1"># ìœ¤ê³½ì„  ê·¸ë¦¬ê¸°</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="p">[</span><span class="n">contour</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># ì•ˆë‚´ í…ìŠ¤íŠ¸</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="s2">&quot;Press &#39;s&#39; to scan&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="s2">&quot;Document not detected&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Document Scanner&#39;</span><span class="p">,</span> <span class="n">display</span><span class="p">)</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">contour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ìŠ¤ìº” ìˆ˜í–‰</span>
            <span class="n">scanned</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scanned</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Scanned&#39;</span><span class="p">,</span> <span class="n">scanned</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">&#39;scanned.jpg&#39;</span><span class="p">,</span> <span class="n">scanned</span><span class="p">)</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># ì‹¤í–‰</span>
<span class="c1"># realtime_document_scanner()</span>
</code></pre></div>

<hr />
<h2 id="2">í”„ë¡œì íŠ¸ 2: ì°¨ì„  ê²€ì¶œ<a class="header-link" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="_6">í”„ë¡œì íŠ¸ ê°œìš”<a class="header-link" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ì°¨ì„  ê²€ì¶œ (Lane Detection):
ë„ë¡œ ì˜ìƒì—ì„œ ì°¨ì„ ì„ ê²€ì¶œí•˜ê³  ì‹œê°í™”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ë„ë¡œ ì˜ìƒ               â”‚
â”‚                                    â”‚
â”‚     â•²                    â•±         â”‚
â”‚      â•²      ì°¨ì„        â•±          â”‚
â”‚       â•²              â•±            â”‚
â”‚        â•²    ê²€ì¶œ   â•±              â”‚
â”‚         â•²        â•±                â”‚
â”‚          â•²      â•±                 â”‚
â”‚           â•²    â•±                  â”‚
â”‚            â•²  â•±                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸:
1. ê´€ì‹¬ ì˜ì—­ (ROI) ì„¤ì •
2. ìƒ‰ìƒ ê³µê°„ ë³€í™˜ (HSV)
3. í°ìƒ‰/ë…¸ë€ìƒ‰ ë§ˆìŠ¤í¬ ìƒì„±
4. ìºë‹ˆ ì—£ì§€ ê²€ì¶œ
5. í—ˆí”„ ë³€í™˜ìœ¼ë¡œ ì§ì„  ê²€ì¶œ
6. ì°¨ì„  í•©ì„±
</code></pre></div>

<h3 id="_7">ë‹¨ê³„ë³„ êµ¬í˜„<a class="header-link" href="#_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">LaneDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì°¨ì„  ê²€ì¶œê¸°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">region_of_interest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê´€ì‹¬ ì˜ì—­ ë§ˆìŠ¤í‚¹ (ë„ë¡œ ë¶€ë¶„ë§Œ)&quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ì‚¬ë‹¤ë¦¬ê¼´ ROI</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">height</span><span class="p">),</span>           <span class="c1"># ì¢Œí•˜</span>
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)),</span> <span class="c1"># ì¢Œìƒ</span>
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)),</span> <span class="c1"># ìš°ìƒ</span>
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">height</span><span class="p">)</span>            <span class="c1"># ìš°í•˜</span>
        <span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>

        <span class="n">masked</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">masked</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">color_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ìƒ‰ìƒ í•„í„° (í°ìƒ‰/ë…¸ë€ìƒ‰ ì°¨ì„ )&quot;&quot;&quot;</span>
        <span class="c1"># HSV ë³€í™˜</span>
        <span class="n">hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>

        <span class="c1"># í°ìƒ‰ ë§ˆìŠ¤í¬</span>
        <span class="n">lower_white</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>
        <span class="n">upper_white</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">255</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>
        <span class="n">white_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">lower_white</span><span class="p">,</span> <span class="n">upper_white</span><span class="p">)</span>

        <span class="c1"># ë…¸ë€ìƒ‰ ë§ˆìŠ¤í¬</span>
        <span class="n">lower_yellow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
        <span class="n">upper_yellow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">35</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>
        <span class="n">yellow_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">lower_yellow</span><span class="p">,</span> <span class="n">upper_yellow</span><span class="p">)</span>

        <span class="c1"># ë§ˆìŠ¤í¬ ê²°í•©</span>
        <span class="n">combined_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_or</span><span class="p">(</span><span class="n">white_mask</span><span class="p">,</span> <span class="n">yellow_mask</span><span class="p">)</span>

        <span class="c1"># ë§ˆìŠ¤í¬ ì ìš©</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">combined_mask</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered</span><span class="p">,</span> <span class="n">combined_mask</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì—£ì§€ ê²€ì¶œ&quot;&quot;&quot;</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">blur</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">blur</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">edges</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í—ˆí”„ ë³€í™˜ìœ¼ë¡œ ì§ì„  ê²€ì¶œ&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">HoughLinesP</span><span class="p">(</span>
            <span class="n">edges</span><span class="p">,</span>
            <span class="n">rho</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>              <span class="c1"># ê±°ë¦¬ í•´ìƒë„ (í”½ì…€)</span>
            <span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>    <span class="c1"># ê°ë„ í•´ìƒë„ (ë¼ë””ì•ˆ)</span>
            <span class="n">threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>       <span class="c1"># ìµœì†Œ íˆ¬í‘œ ìˆ˜</span>
            <span class="n">minLineLength</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>   <span class="c1"># ìµœì†Œ ì„  ê¸¸ì´</span>
            <span class="n">maxLineGap</span><span class="o">=</span><span class="mi">150</span>      <span class="c1"># ìµœëŒ€ ê°„ê²©</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">separate_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">img_width</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì¢Œ/ìš° ì°¨ì„  ë¶„ë¦¬&quot;&quot;&quot;</span>
        <span class="n">left_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">right_lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">left_lines</span><span class="p">,</span> <span class="n">right_lines</span>

        <span class="n">center</span> <span class="o">=</span> <span class="n">img_width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># ê¸°ìš¸ê¸° ê³„ì‚°</span>
            <span class="k">if</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>

            <span class="c1"># ê¸°ìš¸ê¸°ê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ ë¬´ì‹œ (ìˆ˜í‰ì„ )</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># ì¢Œ/ìš° ë¶„ë¥˜</span>
            <span class="k">if</span> <span class="n">slope</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="n">center</span> <span class="ow">and</span> <span class="n">x2</span> <span class="o">&lt;</span> <span class="n">center</span><span class="p">:</span>
                <span class="n">left_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">slope</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">center</span> <span class="ow">and</span> <span class="n">x2</span> <span class="o">&gt;</span> <span class="n">center</span><span class="p">:</span>
                <span class="n">right_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">left_lines</span><span class="p">,</span> <span class="n">right_lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">average_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">img_height</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì—¬ëŸ¬ ì„ ë¶„ì„ í‰ê· ë‚´ì–´ í•˜ë‚˜ì˜ ì„ ìœ¼ë¡œ&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">x_coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_coords</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span>
            <span class="n">x_coords</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">])</span>
            <span class="n">y_coords</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>

        <span class="c1"># ì„ í˜• íšŒê·€ (1ì°¨ ë‹¤í•­ì‹ í”¼íŒ…)</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">y_coords</span><span class="p">,</span> <span class="n">x_coords</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># y ë²”ìœ„ ì„¤ì •</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">img_height</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">img_height</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span>

        <span class="c1"># x ì¢Œí‘œ ê³„ì‚°</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">y1</span><span class="p">))</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw_lanes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">left_line</span><span class="p">,</span> <span class="n">right_line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì°¨ì„  ê·¸ë¦¬ê¸°&quot;&quot;&quot;</span>
        <span class="n">overlay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># ì°¨ì„  ê·¸ë¦¬ê¸°</span>
        <span class="k">if</span> <span class="n">left_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="p">(</span><span class="n">left_line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">left_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">left_line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">left_line</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">right_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="p">(</span><span class="n">right_line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">right_line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">right_line</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c1"># ì°¨ì„  ì˜ì—­ ì±„ìš°ê¸°</span>
        <span class="k">if</span> <span class="n">left_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">right_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">left_line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">left_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">left_line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">left_line</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">right_line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">right_line</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">right_line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="p">[</span><span class="n">pts</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># ì›ë³¸ê³¼ í•©ì„±</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì „ì²´ ì°¨ì„  ê²€ì¶œ íŒŒì´í”„ë¼ì¸&quot;&quot;&quot;</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># 1. ìƒ‰ìƒ í•„í„°ë§</span>
        <span class="n">filtered</span><span class="p">,</span> <span class="n">color_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_filter</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># 2. ì—£ì§€ ê²€ì¶œ</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_edges</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>

        <span class="c1"># 3. ROI ì ìš©</span>
        <span class="n">roi_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_of_interest</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

        <span class="c1"># 4. ì§ì„  ê²€ì¶œ</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_lines</span><span class="p">(</span><span class="n">roi_edges</span><span class="p">)</span>

        <span class="c1"># 5. ì¢Œ/ìš° ì°¨ì„  ë¶„ë¦¬</span>
        <span class="n">left_lines</span><span class="p">,</span> <span class="n">right_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="c1"># 6. í‰ê·  ì°¨ì„  ê³„ì‚°</span>
        <span class="n">left_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_line</span><span class="p">(</span><span class="n">left_lines</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">right_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_line</span><span class="p">(</span><span class="n">right_lines</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="c1"># 7. ê²°ê³¼ ì‹œê°í™”</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_lanes</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">left_lane</span><span class="p">,</span> <span class="n">right_lane</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="n">roi_edges</span><span class="p">,</span>
            <span class="s1">&#39;color_mask&#39;</span><span class="p">:</span> <span class="n">color_mask</span><span class="p">,</span>
            <span class="s1">&#39;left_lane&#39;</span><span class="p">:</span> <span class="n">left_lane</span><span class="p">,</span>
            <span class="s1">&#39;right_lane&#39;</span><span class="p">:</span> <span class="n">right_lane</span>
        <span class="p">}</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">LaneDetector</span><span class="p">()</span>

<span class="c1"># ì´ë¯¸ì§€ì—ì„œ ì°¨ì„  ê²€ì¶œ</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;road.jpg&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Lane Detection&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Edges&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="_8">ë¹„ë””ì˜¤ ì°¨ì„  ê²€ì¶œ<a class="header-link" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">video_lane_detection</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë¹„ë””ì˜¤ì—ì„œ ì°¨ì„  ê²€ì¶œ&quot;&quot;&quot;</span>

    <span class="n">detector</span> <span class="o">=</span> <span class="n">LaneDetector</span><span class="p">()</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>

    <span class="c1"># ì¶œë ¥ ë¹„ë””ì˜¤ ì„¤ì •</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">))</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">))</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FPS</span><span class="p">)</span>

    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;mp4v&#39;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="s1">&#39;lane_output.mp4&#39;</span><span class="p">,</span> <span class="n">fourcc</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

    <span class="c1"># ì´ì „ í”„ë ˆì„ì˜ ì°¨ì„  (ìŠ¤ë¬´ë”©ìš©)</span>
    <span class="n">prev_left</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">prev_right</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># ìŠ¤ë¬´ë”© ê³„ìˆ˜</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># ì°¨ì„  ìŠ¤ë¬´ë”© (ê¸‰ê²©í•œ ë³€í™” ë°©ì§€)</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">debug</span><span class="p">[</span><span class="s1">&#39;left_lane&#39;</span><span class="p">]</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">debug</span><span class="p">[</span><span class="s1">&#39;right_lane&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">prev_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">prev_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">prev_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">right</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">prev_right</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

        <span class="n">prev_left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="n">prev_right</span> <span class="o">=</span> <span class="n">right</span>

        <span class="c1"># ìŠ¤ë¬´ë”©ëœ ì°¨ì„ ìœ¼ë¡œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">draw_lanes</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Lane Detection&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">out</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># ì‹¤í–‰</span>
<span class="c1"># video_lane_detection(&#39;driving.mp4&#39;)</span>
</code></pre></div>

<hr />
<h2 id="3-ar">í”„ë¡œì íŠ¸ 3: AR ë§ˆì»¤ ê²€ì¶œ<a class="header-link" href="#3-ar" title="Permanent link">&para;</a></h2>
<h3 id="_9">í”„ë¡œì íŠ¸ ê°œìš”<a class="header-link" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>AR ë§ˆì»¤ ê²€ì¶œ (AR Marker Detection):
ì´ë¯¸ì§€ì—ì„œ ì •ì‚¬ê°í˜• ë§ˆì»¤ë¥¼ ê²€ì¶œí•˜ê³  3D ê°ì²´ë¥¼ í•©ì„±

ë§ˆì»¤ êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
â”‚ â–ˆ                â–ˆ â”‚
â”‚ â–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆ â”‚
â”‚ â–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆ â”‚
â”‚ â–ˆ                â–ˆ â”‚
â”‚ â–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆ â”‚
â”‚ â–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆ â”‚
â”‚ â–ˆ                â–ˆ â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì²˜ë¦¬ ê³¼ì •:
1. ì‚¬ê°í˜• ìœ¤ê³½ì„  ê²€ì¶œ
2. ì›ê·¼ ë³€í™˜ìœ¼ë¡œ ë§ˆì»¤ ì •ê·œí™”
3. ë§ˆì»¤ ID ì¸ì‹
4. í˜¸ëª¨ê·¸ë˜í”¼ë¡œ 3D ê°ì²´ íˆ¬ì˜
</code></pre></div>

<h3 id="_10">ë‹¨ê³„ë³„ êµ¬í˜„<a class="header-link" href="#_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ARMarkerDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AR ë§ˆì»¤ ê²€ì¶œê¸°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marker_size</span> <span class="o">=</span> <span class="n">marker_size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">order_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;4ê°œ ì ì„ ìˆœì„œëŒ€ë¡œ ì •ë ¬&quot;&quot;&quot;</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>  <span class="c1"># ì¢Œìƒ</span>
        <span class="n">rect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>  <span class="c1"># ìš°í•˜</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">diff</span><span class="p">)]</span>  <span class="c1"># ìš°ìƒ</span>
        <span class="n">rect</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">diff</span><span class="p">)]</span>  <span class="c1"># ì¢Œí•˜</span>

        <span class="k">return</span> <span class="n">rect</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë§ˆì»¤ í›„ë³´ ì°¾ê¸°&quot;&quot;&quot;</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="n">blur</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># ì ì‘í˜• ì´ì§„í™”</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
            <span class="n">blur</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_GAUSSIAN_C</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY_INV</span><span class="p">,</span>
            <span class="mi">11</span><span class="p">,</span> <span class="mi">2</span>
        <span class="p">)</span>

        <span class="c1"># ìœ¤ê³½ì„  ê²€ì¶œ</span>
        <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_LIST</span><span class="p">,</span>
                                        <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

        <span class="n">markers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
            <span class="c1"># ë©´ì  í•„í„°</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">area</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="ow">or</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># ë‹¤ê°í˜• ê·¼ì‚¬</span>
            <span class="n">peri</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">arcLength</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">approx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">approxPolyDP</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="mf">0.04</span> <span class="o">*</span> <span class="n">peri</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="c1"># 4ê°í˜•ì¸ ê²½ìš°ë§Œ</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">approx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c1"># ë³¼ë¡ ë‹¤ê°í˜• í™•ì¸</span>
                <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">isContourConvex</span><span class="p">(</span><span class="n">approx</span><span class="p">):</span>
                    <span class="n">markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">approx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">markers</span><span class="p">,</span> <span class="n">binary</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_marker_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë§ˆì»¤ ì •ê·œí™”ë¥¼ ìœ„í•œ ë³€í™˜ í–‰ë ¬&quot;&quot;&quot;</span>
        <span class="n">ordered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_points</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

        <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">marker_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">marker_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">ordered</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">M</span><span class="p">,</span> <span class="n">ordered</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decode_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warped</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë§ˆì»¤ ID ë””ì½”ë”© (ê°„ë‹¨í•œ ì˜ˆ)&quot;&quot;&quot;</span>
        <span class="c1"># ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warped</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

        <span class="c1"># ì´ì§„í™”</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>

        <span class="c1"># 5x5 ê·¸ë¦¬ë“œë¡œ ë¶„í•  (ê°€ì¥ìë¦¬ëŠ” ê²€ì€ í…Œë‘ë¦¬)</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_size</span> <span class="o">//</span> <span class="mi">5</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                <span class="n">cell</span> <span class="o">=</span> <span class="n">binary</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">grid_size</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">grid_size</span><span class="p">,</span>
                             <span class="n">j</span><span class="o">*</span><span class="n">grid_size</span><span class="p">:(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">grid_size</span><span class="p">]</span>
                <span class="c1"># ì…€ì˜ í‰ê·  ë°ê¸°ë¡œ 0/1 ê²°ì •</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># ê°„ë‹¨í•œ ID ê³„ì‚° (ë‚´ë¶€ 3x3 ì˜ì—­)</span>
        <span class="n">inner</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">marker_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">marker_id</span> <span class="o">=</span> <span class="n">marker_id</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">inner</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">marker_id</span><span class="p">,</span> <span class="n">grid</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë§ˆì»¤ ìœ„ì— 3D íë¸Œ ê·¸ë¦¬ê¸°&quot;&quot;&quot;</span>
        <span class="c1"># ë§ˆì»¤ í‰ë©´ì˜ 4ê°œ ì </span>
        <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_points</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

        <span class="c1"># ë°”ë‹¥ë©´ ì¢Œí‘œ</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="n">corners</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># ìœ—ë©´ ì¢Œí‘œ ê³„ì‚° (í˜¸ëª¨ê·¸ë˜í”¼ ì´ìš©í•œ ê°„ë‹¨í•œ ê·¼ì‚¬)</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># ìœ—ë©´ì€ ë§ˆì»¤ ì¤‘ì‹¬ ë°©í–¥ìœ¼ë¡œ ì¶•ì†Œ + ìœ„ë¡œ ì´ë™</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.7</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">size</span><span class="p">])</span>  <span class="c1"># ìœ„ë¡œ ì´ë™</span>

        <span class="n">top</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">:</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">-</span> <span class="n">center</span>
            <span class="n">new_pt</span> <span class="o">=</span> <span class="n">center</span> <span class="o">+</span> <span class="n">vec</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">+</span> <span class="n">offset</span>
            <span class="n">top</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_pt</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

        <span class="c1"># ë©´ ê·¸ë¦¬ê¸° (ë°˜íˆ¬ëª…)</span>
        <span class="n">overlay</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># ìœ—ë©´ (ë¹¨ê°„ìƒ‰)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="p">[</span><span class="n">top</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>

        <span class="c1"># ì˜†ë©´ (ë…¹ìƒ‰)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bottom</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bottom</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span><span class="p">],</span>
                           <span class="n">top</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span><span class="p">],</span> <span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="p">[</span><span class="n">pts</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># í•©ì„±</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># ì—£ì§€ ê·¸ë¦¬ê¸°</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bottom</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">top</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë§ˆì»¤ ê²€ì¶œ ë° AR ë Œë”ë§&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">markers</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_markers</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="n">detected_markers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">corners</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">:</span>
            <span class="c1"># ë§ˆì»¤ ì •ê·œí™”</span>
            <span class="n">M</span><span class="p">,</span> <span class="n">ordered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker_transform</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
            <span class="n">warped</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span>
                                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marker_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_size</span><span class="p">))</span>

            <span class="c1"># ë§ˆì»¤ ID ë””ì½”ë”©</span>
            <span class="n">marker_id</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_marker</span><span class="p">(</span><span class="n">warped</span><span class="p">)</span>

            <span class="c1"># í…Œë‘ë¦¬ í™•ì¸ (ê°€ì¥ìë¦¬ê°€ ê²€ì€ìƒ‰ì´ì–´ì•¼ í•¨)</span>
            <span class="n">border_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">grid</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span>
                           <span class="n">grid</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">grid</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">border_check</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># ëŒ€ë¶€ë¶„ ê²€ì€ìƒ‰</span>
                <span class="n">detected_markers</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">marker_id</span><span class="p">,</span>
                    <span class="s1">&#39;corners&#39;</span><span class="p">:</span> <span class="n">ordered</span>
                <span class="p">})</span>

                <span class="c1"># 3D íë¸Œ ê·¸ë¦¬ê¸°</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_cube</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">ordered</span><span class="p">)</span>

                <span class="c1"># ID í‘œì‹œ</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ordered</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ID: </span><span class="si">{</span><span class="n">marker_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">center</span><span class="p">),</span>
                           <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">detected_markers</span><span class="p">,</span> <span class="n">binary</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">ARMarkerDetector</span><span class="p">()</span>

<span class="c1"># ì´ë¯¸ì§€ì—ì„œ ë§ˆì»¤ ê²€ì¶œ</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;ar_marker.jpg&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">binary</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ê²€ì¶œëœ ë§ˆì»¤: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ID: </span><span class="si">{</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;AR Detection&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Binary&#39;</span><span class="p">,</span> <span class="n">binary</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="aruco-opencv">ArUco ë§ˆì»¤ ì‚¬ìš© (OpenCV ë‚´ì¥)<a class="header-link" href="#aruco-opencv" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">aruco_marker_detection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OpenCV ArUco ë§ˆì»¤ ê²€ì¶œ&quot;&quot;&quot;</span>

    <span class="c1"># ArUco ë”•ì…”ë„ˆë¦¬ ì„ íƒ</span>
    <span class="n">aruco_dict</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">getPredefinedDictionary</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">DICT_4X4_50</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">DetectorParameters</span><span class="p">()</span>

    <span class="n">detector</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">ArucoDetector</span><span class="p">(</span><span class="n">aruco_dict</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># ë§ˆì»¤ ê²€ì¶œ</span>
        <span class="n">corners</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">rejected</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detectMarkers</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># ê²°ê³¼ ì‹œê°í™”</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">drawDetectedMarkers</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">corner</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corners</span><span class="p">):</span>
                <span class="c1"># ê° ë§ˆì»¤ì— íë¸Œ ë˜ëŠ” ì¶• ê·¸ë¦¬ê¸°</span>
                <span class="c1"># (ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ì´ ìˆëŠ” ê²½ìš°)</span>
                <span class="k">pass</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;ArUco Detection&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_aruco_marker</span><span class="p">(</span><span class="n">marker_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ArUco ë§ˆì»¤ ìƒì„±&quot;&quot;&quot;</span>
    <span class="n">aruco_dict</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">getPredefinedDictionary</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">DICT_4X4_50</span><span class="p">)</span>
    <span class="n">marker_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">aruco</span><span class="o">.</span><span class="n">generateImageMarker</span><span class="p">(</span><span class="n">aruco_dict</span><span class="p">,</span> <span class="n">marker_id</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;aruco_marker_</span><span class="si">{</span><span class="n">marker_id</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="n">marker_img</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">marker_img</span>

<span class="c1"># ë§ˆì»¤ ìƒì„±</span>
<span class="c1"># marker = generate_aruco_marker(0)</span>
<span class="c1"># cv2.imshow(&#39;Marker&#39;, marker)</span>
</code></pre></div>

<hr />
<h2 id="4">í”„ë¡œì íŠ¸ 4: ì‹¤ì‹œê°„ ì–¼êµ´ í•„í„°<a class="header-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="_11">í”„ë¡œì íŠ¸ ê°œìš”<a class="header-link" href="#_11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ì‹¤ì‹œê°„ ì–¼êµ´ í•„í„° (Face Filter):
ì–¼êµ´ ëœë“œë§ˆí¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•„í„° íš¨ê³¼ ì ìš©

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚        ğŸ˜ ì„ ê¸€ë¼ìŠ¤ í•„í„°            â”‚
â”‚       /â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾â€¾\           â”‚
â”‚      â”‚  â—â”€â”€â”€â”€â”€â”€â”€â”€â—   â”‚           â”‚
â”‚      â”‚   \      /    â”‚           â”‚
â”‚       \    â–½       /            â”‚
â”‚        \   âˆª     /              â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì‚¬ìš© ê¸°ìˆ :
- dlib ì–¼êµ´ ëœë“œë§ˆí¬ (68ì )
- íˆ¬ëª… ì´ë¯¸ì§€ í•©ì„±
- ì–´íŒŒì¸/ì›ê·¼ ë³€í™˜
- ì‹¤ì‹œê°„ ì²˜ë¦¬ ìµœì í™”
</code></pre></div>

<h3 id="_12">ë‹¨ê³„ë³„ êµ¬í˜„<a class="header-link" href="#_12" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dlib</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FaceFilter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹¤ì‹œê°„ ì–¼êµ´ í•„í„°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictor_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">dlib</span><span class="o">.</span><span class="n">get_frontal_face_detector</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="n">dlib</span><span class="o">.</span><span class="n">shape_predictor</span><span class="p">(</span><span class="n">predictor_path</span><span class="p">)</span>

        <span class="c1"># í•„í„° ì´ë¯¸ì§€ ë¡œë“œ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">image_path</span><span class="p">,</span> <span class="n">alpha_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í•„í„° ì´ë¯¸ì§€ ë¡œë“œ (PNG with alpha ê¶Œì¥)&quot;&quot;&quot;</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1"># ì´ë¯¸ ì•ŒíŒŒ ì±„ë„ ìˆìŒ</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">img</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ì•ŒíŒŒ ì±„ë„ ì¶”ê°€ (í°ìƒ‰ ë°°ê²½ì„ íˆ¬ëª…ìœ¼ë¡œ)</span>
            <span class="k">if</span> <span class="n">alpha_path</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">alpha_path</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
                                         <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY_INV</span><span class="p">)</span>

            <span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">alpha</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_landmarks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">face</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì–¼êµ´ ëœë“œë§ˆí¬ ì¶”ì¶œ&quot;&quot;&quot;</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
        <span class="n">landmarks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">shape</span><span class="o">.</span><span class="n">part</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="o">.</span><span class="n">part</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">68</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">landmarks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">overlay_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;íˆ¬ëª… ì´ë¯¸ì§€ í•©ì„±&quot;&quot;&quot;</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ê²½ê³„ ì²´í¬</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span><span class="p">[:,</span> <span class="o">-</span><span class="n">x</span><span class="p">:]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span><span class="p">[</span><span class="o">-</span><span class="n">y</span><span class="p">:,</span> <span class="p">:]</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">bh</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="n">bw</span><span class="p">:</span>
            <span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span><span class="p">[:,</span> <span class="p">:</span><span class="n">bw</span> <span class="o">-</span> <span class="n">x</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="n">bh</span><span class="p">:</span>
            <span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span><span class="p">[:</span><span class="n">bh</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">background</span>

        <span class="c1"># ì•ŒíŒŒ ë¸”ë Œë”©</span>
        <span class="n">overlay_rgb</span> <span class="o">=</span> <span class="n">overlay</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">overlay</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mf">255.0</span>

        <span class="n">roi</span> <span class="o">=</span> <span class="n">background</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">roi</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">overlay_rgb</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">+</span>
                           <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">roi</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">])</span>

        <span class="n">background</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">roi</span>

        <span class="k">return</span> <span class="n">background</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_sunglasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">,</span> <span class="n">filter_img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì„ ê¸€ë¼ìŠ¤ í•„í„° ì ìš©&quot;&quot;&quot;</span>
        <span class="c1"># ëˆˆ ì¢Œí‘œ</span>
        <span class="n">left_eye</span> <span class="o">=</span> <span class="n">landmarks</span><span class="p">[</span><span class="mi">36</span><span class="p">:</span><span class="mi">42</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">right_eye</span> <span class="o">=</span> <span class="n">landmarks</span><span class="p">[</span><span class="mi">42</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># ëˆˆ ì‚¬ì´ ê±°ë¦¬ì™€ ê°ë„</span>
        <span class="n">eye_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">right_eye</span> <span class="o">-</span> <span class="n">left_eye</span><span class="p">)</span>
        <span class="n">eye_center</span> <span class="o">=</span> <span class="p">((</span><span class="n">left_eye</span> <span class="o">+</span> <span class="n">right_eye</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">right_eye</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">left_eye</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                      <span class="n">right_eye</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">left_eye</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># ì„ ê¸€ë¼ìŠ¤ í¬ê¸° ì¡°ì •</span>
        <span class="n">filter_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">eye_width</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">filter_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">filter_width</span> <span class="o">*</span> <span class="n">filter_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span>
                           <span class="n">filter_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">resized_filter</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">filter_img</span><span class="p">,</span> <span class="p">(</span><span class="n">filter_width</span><span class="p">,</span> <span class="n">filter_height</span><span class="p">))</span>

        <span class="c1"># íšŒì „</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">((</span><span class="n">filter_width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">filter_height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                                    <span class="o">-</span><span class="n">angle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">rotated_filter</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">resized_filter</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span>
                                        <span class="p">(</span><span class="n">filter_width</span><span class="p">,</span> <span class="n">filter_height</span><span class="p">),</span>
                                        <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
                                        <span class="n">borderMode</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span>
                                        <span class="n">borderValue</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># ìœ„ì¹˜ ê³„ì‚°</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">eye_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">filter_width</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">eye_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">filter_height</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># í•©ì„±</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">rotated_filter</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_hat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">,</span> <span class="n">filter_img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ëª¨ì í•„í„° ì ìš©&quot;&quot;&quot;</span>
        <span class="c1"># ì´ë§ˆ ìœ„ì¹˜ (ëˆˆì¹ ìœ„)</span>
        <span class="n">left_brow</span> <span class="o">=</span> <span class="n">landmarks</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">right_brow</span> <span class="o">=</span> <span class="n">landmarks</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">brow_center</span> <span class="o">=</span> <span class="p">((</span><span class="n">left_brow</span> <span class="o">+</span> <span class="n">right_brow</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">brow_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">right_brow</span> <span class="o">-</span> <span class="n">left_brow</span><span class="p">)</span>

        <span class="c1"># ëª¨ì í¬ê¸°</span>
        <span class="n">hat_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">brow_width</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">hat_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hat_width</span> <span class="o">*</span> <span class="n">filter_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span>
                        <span class="n">filter_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">resized_hat</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">filter_img</span><span class="p">,</span> <span class="p">(</span><span class="n">hat_width</span><span class="p">,</span> <span class="n">hat_height</span><span class="p">))</span>

        <span class="c1"># ìœ„ì¹˜ (ëˆˆì¹ ìœ„ì— ë°°ì¹˜)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">brow_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hat_width</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">brow_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hat_height</span>

        <span class="c1"># í•©ì„±</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">resized_hat</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_mustache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">,</span> <span class="n">filter_img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì½§ìˆ˜ì—¼ í•„í„° ì ìš©&quot;&quot;&quot;</span>
        <span class="c1"># ì½” ì•„ë˜, ì… ìœ„</span>
        <span class="n">nose_tip</span> <span class="o">=</span> <span class="n">landmarks</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>
        <span class="n">upper_lip</span> <span class="o">=</span> <span class="n">landmarks</span><span class="p">[</span><span class="mi">51</span><span class="p">]</span>

        <span class="n">center</span> <span class="o">=</span> <span class="p">((</span><span class="n">nose_tip</span> <span class="o">+</span> <span class="n">upper_lip</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># ì½§ìˆ˜ì—¼ í¬ê¸° (ì… ë„ˆë¹„ ê¸°ì¤€)</span>
        <span class="n">mouth_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">landmarks</span><span class="p">[</span><span class="mi">48</span><span class="p">]</span> <span class="o">-</span> <span class="n">landmarks</span><span class="p">[</span><span class="mi">54</span><span class="p">])</span>
        <span class="n">mustache_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mouth_width</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">mustache_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mustache_width</span> <span class="o">*</span> <span class="n">filter_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span>
                             <span class="n">filter_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">filter_img</span><span class="p">,</span> <span class="p">(</span><span class="n">mustache_width</span><span class="p">,</span> <span class="n">mustache_height</span><span class="p">))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">mustache_width</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mustache_height</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">resized</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">filter_name</span><span class="o">=</span><span class="s1">&#39;sunglasses&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í•„í„° ì ìš©&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filter_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img</span>

        <span class="n">rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
            <span class="n">landmarks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_landmarks</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">filter_name</span> <span class="o">==</span> <span class="s1">&#39;sunglasses&#39;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_sunglasses</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">filter_name</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">filter_name</span> <span class="o">==</span> <span class="s1">&#39;hat&#39;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_hat</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">filter_name</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">filter_name</span> <span class="o">==</span> <span class="s1">&#39;mustache&#39;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mustache</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">filter_name</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="k">def</span><span class="w"> </span><span class="nf">realtime_face_filter</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì‹¤ì‹œê°„ ì–¼êµ´ í•„í„°&quot;&quot;&quot;</span>

    <span class="n">filter_app</span> <span class="o">=</span> <span class="n">FaceFilter</span><span class="p">(</span><span class="s1">&#39;shape_predictor_68_face_landmarks.dat&#39;</span><span class="p">)</span>

    <span class="c1"># í•„í„° ë¡œë“œ (íˆ¬ëª… PNG ê¶Œì¥)</span>
    <span class="n">filter_app</span><span class="o">.</span><span class="n">load_filter</span><span class="p">(</span><span class="s1">&#39;sunglasses&#39;</span><span class="p">,</span> <span class="s1">&#39;sunglasses.png&#39;</span><span class="p">)</span>
    <span class="c1"># filter_app.load_filter(&#39;hat&#39;, &#39;hat.png&#39;)</span>
    <span class="c1"># filter_app.load_filter(&#39;mustache&#39;, &#39;mustache.png&#39;)</span>

    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">current_filter</span> <span class="o">=</span> <span class="s1">&#39;sunglasses&#39;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filter_app</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">filter_idx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Press &#39;n&#39; to change filter, &#39;q&#39; to quit&quot;</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># í•„í„° ì ìš©</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">filter_app</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">current_filter</span><span class="p">)</span>

        <span class="c1"># í˜„ì¬ í•„í„° í‘œì‹œ</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Filter: </span><span class="si">{</span><span class="n">current_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                   <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Face Filter&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">):</span>
            <span class="n">filter_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">current_filter</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="n">filter_idx</span><span class="p">]</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># ì‹¤í–‰</span>
<span class="c1"># realtime_face_filter()</span>
</code></pre></div>

<hr />
<h2 id="5">í”„ë¡œì íŠ¸ 5: ê°ì²´ ì¶”ì  ì‹œìŠ¤í…œ<a class="header-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="_13">í”„ë¡œì íŠ¸ ê°œìš”<a class="header-link" href="#_13" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>ê°ì²´ ì¶”ì  ì‹œìŠ¤í…œ (Object Tracking System):
ë°°ê²½ ì°¨ë¶„ê³¼ ì¹¼ë§Œ í•„í„°ë¥¼ ì¡°í•©í•œ ë‹¤ì¤‘ ê°ì²´ ì¶”ì 

ì²˜ë¦¬ íë¦„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í”„ë ˆì„  â”‚ â†’ â”‚ ë°°ê²½    â”‚ â†’ â”‚ ìœ¤ê³½ì„   â”‚ â†’ â”‚ ì¹¼ë§Œ    â”‚
â”‚ ì…ë ¥    â”‚    â”‚ ì°¨ë¶„    â”‚    â”‚ ê²€ì¶œ    â”‚    â”‚ í•„í„°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê²°ê³¼    â”‚ â† â”‚ ID      â”‚ â† â”‚ í—ê°€ë¦¬ì•ˆâ”‚ â† â”‚ ì˜ˆì¸¡    â”‚
â”‚ ì¶œë ¥    â”‚    â”‚ í• ë‹¹    â”‚    â”‚ ë§¤ì¹­    â”‚    â”‚ ìœ„ì¹˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h3 id="_14">ë‹¨ê³„ë³„ êµ¬í˜„<a class="header-link" href="#_14" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">linear_sum_assignment</span>

<span class="k">class</span><span class="w"> </span><span class="nc">KalmanTracker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ì¹¼ë§Œ í•„í„° ê¸°ë°˜ ë‹¨ì¼ ê°ì²´ ì¶”ì ê¸°&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_pos</span><span class="p">):</span>
        <span class="c1"># ì¹¼ë§Œ í•„í„° ì´ˆê¸°í™”</span>
        <span class="c1"># ìƒíƒœ ë²¡í„°: [x, y, vx, vy]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">KalmanFilter</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># ì „ì´ í–‰ë ¬ (ë“±ì† ìš´ë™ ëª¨ë¸)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">transitionMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># ì¸¡ì • í–‰ë ¬</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">measurementMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># í”„ë¡œì„¸ìŠ¤ ë…¸ì´ì¦ˆ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">processNoiseCov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.03</span>

        <span class="c1"># ì¸¡ì • ë…¸ì´ì¦ˆ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">measurementNoiseCov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>

        <span class="c1"># ì´ˆê¸° ìƒíƒœ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">statePre</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">initial_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">initial_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">statePost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">statePre</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># ì¶”ì  í”„ë ˆì„ ìˆ˜</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hits</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># ì„±ê³µì ì¸ ë§¤ì¹­ ìˆ˜</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_since_update</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># ì—…ë°ì´íŠ¸ ì´í›„ í”„ë ˆì„ ìˆ˜</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë‹¤ìŒ ìœ„ì¹˜ ì˜ˆì¸¡&quot;&quot;&quot;</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_since_update</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">prediction</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì¸¡ì •ê°’ìœ¼ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">measurement</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_since_update</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;í˜„ì¬ ìƒíƒœ ë°˜í™˜&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kalman</span><span class="o">.</span><span class="n">statePost</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MultiObjectTracker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¤ì¤‘ ê°ì²´ ì¶”ì  ì‹œìŠ¤í…œ&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_age</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">min_hits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">iou_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span> <span class="o">=</span> <span class="n">max_age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_hits</span> <span class="o">=</span> <span class="n">min_hits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iou_threshold</span> <span class="o">=</span> <span class="n">iou_threshold</span>

        <span class="c1"># ë°°ê²½ ì°¨ë¶„ê¸°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bg_subtractor</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createBackgroundSubtractorMOG2</span><span class="p">(</span>
            <span class="n">history</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">varThreshold</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">detectShadows</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ë°°ê²½ ì°¨ë¶„ìœ¼ë¡œ ê°ì²´ ê²€ì¶œ&quot;&quot;&quot;</span>
        <span class="c1"># ë°°ê²½ ì°¨ë¶„</span>
        <span class="n">fg_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bg_subtractor</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># ê·¸ë¦¼ì ì œê±°</span>
        <span class="n">fg_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">fg_mask</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># ë…¸ì´ì¦ˆ ì œê±°</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_ELLIPSE</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">fg_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">fg_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
        <span class="n">fg_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">fg_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>

        <span class="c1"># ìœ¤ê³½ì„  ê²€ì¶œ</span>
        <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">fg_mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span>
                                        <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

        <span class="n">detections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>  <span class="c1"># ìµœì†Œ ë©´ì </span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
                <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">detections</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;bbox&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                    <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="n">center</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">detections</span><span class="p">,</span> <span class="n">fg_mask</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iou</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;IoU (Intersection over Union) ê³„ì‚°&quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">bbox1</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">bbox2</span>

        <span class="n">xi1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
        <span class="n">yi1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
        <span class="n">xi2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">w1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">w2</span><span class="p">)</span>
        <span class="n">yi2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">h1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">h2</span><span class="p">)</span>

        <span class="n">inter_area</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xi2</span> <span class="o">-</span> <span class="n">xi1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">yi2</span> <span class="o">-</span> <span class="n">yi1</span><span class="p">)</span>

        <span class="n">box1_area</span> <span class="o">=</span> <span class="n">w1</span> <span class="o">*</span> <span class="n">h1</span>
        <span class="n">box2_area</span> <span class="o">=</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">h2</span>

        <span class="n">union_area</span> <span class="o">=</span> <span class="n">box1_area</span> <span class="o">+</span> <span class="n">box2_area</span> <span class="o">-</span> <span class="n">inter_area</span>

        <span class="k">return</span> <span class="n">inter_area</span> <span class="o">/</span> <span class="n">union_area</span> <span class="k">if</span> <span class="n">union_area</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">associate_detections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detections</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê²€ì¶œê³¼ íŠ¸ë˜ì»¤ ë§¤ì¹­ (í—ê°€ë¦¬ì•ˆ ì•Œê³ ë¦¬ì¦˜)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">detections</span><span class="p">))),</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">detections</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="p">[],</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">)))</span>

        <span class="c1"># ë¹„ìš© í–‰ë ¬ ê³„ì‚° (ê±°ë¦¬ ê¸°ë°˜)</span>
        <span class="n">cost_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">detections</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">det</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">detections</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">tracker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">):</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">tracker</span><span class="p">[</span><span class="s1">&#39;kalman&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">det</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">pred</span><span class="p">)</span>
                <span class="n">cost_matrix</span><span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span>

        <span class="c1"># í—ê°€ë¦¬ì•ˆ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìµœì  ë§¤ì¹­</span>
        <span class="n">row_indices</span><span class="p">,</span> <span class="n">col_indices</span> <span class="o">=</span> <span class="n">linear_sum_assignment</span><span class="p">(</span><span class="n">cost_matrix</span><span class="p">)</span>

        <span class="n">matched</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">unmatched_detections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">detections</span><span class="p">)))</span>
        <span class="n">unmatched_trackers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row_indices</span><span class="p">,</span> <span class="n">col_indices</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cost_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># ê±°ë¦¬ ì„ê³„ê°’</span>
                <span class="n">matched</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
                <span class="n">unmatched_detections</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">unmatched_trackers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">matched</span><span class="p">,</span> <span class="n">unmatched_detections</span><span class="p">,</span> <span class="n">unmatched_trackers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ì¶”ì  ì—…ë°ì´íŠ¸&quot;&quot;&quot;</span>
        <span class="c1"># ê°ì²´ ê²€ì¶œ</span>
        <span class="n">detections</span><span class="p">,</span> <span class="n">fg_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_objects</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># ì˜ˆì¸¡</span>
        <span class="k">for</span> <span class="n">tracker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">:</span>
            <span class="n">tracker</span><span class="p">[</span><span class="s1">&#39;kalman&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

        <span class="c1"># ë§¤ì¹­</span>
        <span class="n">matched</span><span class="p">,</span> <span class="n">unmatched_dets</span><span class="p">,</span> <span class="n">unmatched_trks</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">associate_detections</span><span class="p">(</span><span class="n">detections</span><span class="p">)</span>

        <span class="c1"># ë§¤ì¹­ëœ íŠ¸ë˜ì»¤ ì—…ë°ì´íŠ¸</span>
        <span class="k">for</span> <span class="n">det_idx</span><span class="p">,</span> <span class="n">trk_idx</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="n">trk_idx</span><span class="p">][</span><span class="s1">&#39;kalman&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="n">det_idx</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="n">trk_idx</span><span class="p">][</span><span class="s1">&#39;bbox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detections</span><span class="p">[</span><span class="n">det_idx</span><span class="p">][</span><span class="s1">&#39;bbox&#39;</span><span class="p">]</span>

        <span class="c1"># ìƒˆ íŠ¸ë˜ì»¤ ìƒì„±</span>
        <span class="k">for</span> <span class="n">det_idx</span> <span class="ow">in</span> <span class="n">unmatched_dets</span><span class="p">:</span>
            <span class="n">tracker</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span><span class="p">,</span>
                <span class="s1">&#39;kalman&#39;</span><span class="p">:</span> <span class="n">KalmanTracker</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="n">det_idx</span><span class="p">][</span><span class="s1">&#39;center&#39;</span><span class="p">]),</span>
                <span class="s1">&#39;bbox&#39;</span><span class="p">:</span> <span class="n">detections</span><span class="p">[</span><span class="n">det_idx</span><span class="p">][</span><span class="s1">&#39;bbox&#39;</span><span class="p">],</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tracker</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># ì˜¤ë˜ëœ íŠ¸ë˜ì»¤ ì œê±°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span>
                        <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;kalman&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">time_since_update</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span><span class="p">]</span>

        <span class="c1"># ê²°ê³¼ ë°˜í™˜</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tracker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tracker</span><span class="p">[</span><span class="s1">&#39;kalman&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hits</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_hits</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">tracker</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;bbox&#39;</span><span class="p">:</span> <span class="n">tracker</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">tracker</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="n">tracker</span><span class="p">[</span><span class="s1">&#39;kalman&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">fg_mask</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ê²°ê³¼ ì‹œê°í™”&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ID: </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">10</span><span class="p">),</span>
                       <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># ê¶¤ì  í‘œì‹œ (ì¤‘ì‹¬ì )</span>
            <span class="n">center</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">frame</span>

<span class="c1"># ì‚¬ìš© ì˜ˆ</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multi_object_tracking</span><span class="p">(</span><span class="n">video_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ë‹¤ì¤‘ ê°ì²´ ì¶”ì  ì‹¤í–‰&quot;&quot;&quot;</span>

    <span class="n">tracker</span> <span class="o">=</span> <span class="n">MultiObjectTracker</span><span class="p">()</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># ì¶”ì  ì—…ë°ì´íŠ¸</span>
        <span class="n">results</span><span class="p">,</span> <span class="n">fg_mask</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># ì‹œê°í™”</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>

        <span class="c1"># ì •ë³´ í‘œì‹œ</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Objects: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                   <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Multi-Object Tracking&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Foreground Mask&#39;</span><span class="p">,</span> <span class="n">fg_mask</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1"># ì‹¤í–‰</span>
<span class="c1"># multi_object_tracking(&#39;traffic.mp4&#39;)</span>
</code></pre></div>

<hr />
<h2 id="_15">ì—°ìŠµ ë¬¸ì œ ë° í™•ì¥ ì•„ì´ë””ì–´<a class="header-link" href="#_15" title="Permanent link">&para;</a></h2>
<h3 id="1_1">í”„ë¡œì íŠ¸ 1: ë¬¸ì„œ ìŠ¤ìºë„ˆ í™•ì¥<a class="header-link" href="#1_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>OCR í†µí•©</strong>: Tesseract OCRì„ ì—°ë™í•˜ì—¬ í…ìŠ¤íŠ¸ ì¶”ì¶œ</li>
<li><strong>ìë™ ìƒ‰ìƒ ë³´ì •</strong>: íˆìŠ¤í† ê·¸ë¨ í‰í™œí™”ë¡œ ë¬¸ì„œ ê°€ë…ì„± í–¥ìƒ</li>
<li><strong>ë‹¤ì¤‘ í˜ì´ì§€ ì§€ì›</strong>: ì—°ì† ì´¬ì˜ìœ¼ë¡œ PDF ìƒì„±</li>
<li><strong>ì†ê¸€ì”¨ ì¸ì‹</strong>: ì†ìœ¼ë¡œ ì“´ ë¬¸ì„œì˜ ë””ì§€í„¸í™”</li>
<li><strong>ì˜ìˆ˜ì¦ íŒŒì‹±</strong>: ê¸ˆì•¡, ë‚ ì§œ ë“± ìë™ ì¶”ì¶œ</li>
</ol>
<h3 id="2_1">í”„ë¡œì íŠ¸ 2: ì°¨ì„  ê²€ì¶œ í™•ì¥<a class="header-link" href="#2_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>ê³¡ì„  ì°¨ì„  ê²€ì¶œ</strong>: 2ì°¨/3ì°¨ ë‹¤í•­ì‹ í”¼íŒ…</li>
<li><strong>ì°¨ì„  ì´íƒˆ ê²½ê³ </strong>: ì°¨ëŸ‰ ì¤‘ì‹¬ê³¼ ì°¨ì„  ì¤‘ì‹¬ ë¹„êµ</li>
<li><strong>ì•¼ê°„ ëª¨ë“œ</strong>: ì¡°ëª… ì¡°ê±´ì— ë”°ë¥¸ íŒŒë¼ë¯¸í„° ì¡°ì •</li>
<li><strong>ë‹¤ì¤‘ ì°¨ì„  ê²€ì¶œ</strong>: ì¸ì ‘ ì°¨ì„ ê¹Œì§€ ê²€ì¶œ</li>
<li><strong>ì°¨ëŸ‰ ê²€ì¶œ í†µí•©</strong>: YOLOì™€ ê²°í•©í•˜ì—¬ ì•ì°¨ ê°ì§€</li>
</ol>
<h3 id="3-ar_1">í”„ë¡œì íŠ¸ 3: AR ë§ˆì»¤ í™•ì¥<a class="header-link" href="#3-ar_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>3D ëª¨ë¸ ë Œë”ë§</strong>: OpenGLê³¼ ì—°ë™í•˜ì—¬ 3D ê°ì²´ í‘œì‹œ</li>
<li><strong>ë‹¤ì¤‘ ë§ˆì»¤ ì¸í„°ë™ì…˜</strong>: ë§ˆì»¤ ê°„ ê´€ê³„ ì¸ì‹</li>
<li><strong>ë§ˆì»¤ ì—†ëŠ” AR</strong>: í‰ë©´ ê²€ì¶œ ê¸°ë°˜ AR</li>
<li><strong>ê²Œì„ ê°œë°œ</strong>: ë§ˆì»¤ ê¸°ë°˜ ê°„ë‹¨í•œ AR ê²Œì„</li>
<li><strong>ê°€êµ¬ ë°°ì¹˜ ì‹œë®¬ë ˆì´ì…˜</strong>: ì‹¤ì œ ê³µê°„ì— ê°€ìƒ ê°€êµ¬ ë°°ì¹˜</li>
</ol>
<h3 id="4_1">í”„ë¡œì íŠ¸ 4: ì–¼êµ´ í•„í„° í™•ì¥<a class="header-link" href="#4_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>í‘œì • ì¸ì‹</strong>: ì›ƒìŒ, ëˆˆ ê¹œë¹¡ì„ ê°ì§€í•˜ì—¬ í•„í„° ë³€ê²½</li>
<li><strong>3D í•„í„°</strong>: ì–¼êµ´ í¬ì¦ˆì— ë§ì¶° 3D ë³€í˜•</li>
<li><strong>ë°°ê²½ êµì²´</strong>: ì„¸ê·¸ë©˜í…Œì´ì…˜ìœ¼ë¡œ ë°°ê²½ë§Œ êµì²´</li>
<li><strong>ì–¼êµ´ ìŠ¤ì™‘</strong>: ë‘ ì‚¬ëŒì˜ ì–¼êµ´ êµí™˜</li>
<li><strong>ì—ì´ì§• í•„í„°</strong>: ì–¼êµ´ ë…¸í™”/ì Šì–´ì§€ê¸° íš¨ê³¼</li>
</ol>
<h3 id="5_1">í”„ë¡œì íŠ¸ 5: ê°ì²´ ì¶”ì  í™•ì¥<a class="header-link" href="#5_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Re-ID ê¸°ëŠ¥</strong>: í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°”ë‹¤ ë“¤ì–´ì˜¨ ê°ì²´ ì¬ì‹ë³„</li>
<li><strong>ì†ë„ ì¸¡ì •</strong>: ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í›„ ì‹¤ì œ ì†ë„ ê³„ì‚°</li>
<li><strong>ì˜ì—­ ì¹¨ì… ê°ì§€</strong>: íŠ¹ì • ì˜ì—­ ì§„ì… ì‹œ ì•Œë¦¼</li>
<li><strong>ê¶¤ì  ë¶„ì„</strong>: ì´ë™ íŒ¨í„´ ë¶„ì„ ë° ì´ìƒ ê°ì§€</li>
<li><strong>ë”¥ëŸ¬ë‹ í†µí•©</strong>: YOLO + DeepSORTë¡œ ì •í™•ë„ í–¥ìƒ</li>
</ol>
<hr />
<h2 id="_16">ë‹¤ìŒ ë‹¨ê³„<a class="header-link" href="#_16" title="Permanent link">&para;</a></h2>
<p>OpenCVì™€ ì»´í“¨í„° ë¹„ì „ì˜ ê¸°ì´ˆë¥¼ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤. ë” ê¹Šì€ í•™ìŠµì„ ìœ„í•´ ë‹¤ìŒ ì£¼ì œë“¤ì„ ì¶”ì²œí•©ë‹ˆë‹¤:</p>
<h3 id="_17">ë”¥ëŸ¬ë‹ í”„ë ˆì„ì›Œí¬<a class="header-link" href="#_17" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>PyTorch</strong>: ì—°êµ¬ ë° í”„ë¡œí† íƒ€ì´í•‘ì— ê°•ë ¥</li>
<li><strong>TensorFlow/Keras</strong>: í”„ë¡œë•ì…˜ ë°°í¬ì— ì í•©</li>
<li><strong>ONNX</strong>: ëª¨ë¸ í˜¸í™˜ì„±ì„ ìœ„í•œ í‘œì¤€</li>
</ul>
<h3 id="_18">ê³ ê¸‰ ì»´í“¨í„° ë¹„ì „<a class="header-link" href="#_18" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ì´ë¯¸ì§€ ì„¸ê·¸ë©˜í…Œì´ì…˜</strong>: U-Net, Mask R-CNN</li>
<li><strong>í¬ì¦ˆ ì¶”ì •</strong>: OpenPose, MediaPipe</li>
<li><strong>GAN ê¸°ë°˜ ì´ë¯¸ì§€ ìƒì„±</strong>: StyleGAN, Pix2Pix</li>
<li><strong>3D ë¹„ì „</strong>: ìŠ¤í…Œë ˆì˜¤ ë¹„ì „, ê¹Šì´ ì¶”ì •</li>
</ul>
<h3 id="_19">ì‘ìš© ë¶„ì•¼<a class="header-link" href="#_19" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ììœ¨ì£¼í–‰</strong>: SLAM, ì„¼ì„œ í“¨ì „</li>
<li><strong>ì˜ë£Œ ì˜ìƒ</strong>: CT/MRI ë¶„ì„, ì§ˆë³‘ ê²€ì¶œ</li>
<li><strong>ì‚°ì—… ê²€ì‚¬</strong>: ê²°í•¨ ê²€ì¶œ, í’ˆì§ˆ ê´€ë¦¬</li>
<li><strong>ë³´ì•ˆ/ê°ì‹œ</strong>: ì´ìƒ í–‰ë™ ê°ì§€, ì–¼êµ´ ì¸ì‹</li>
</ul>
<hr />
<h2 id="_20">ì°¸ê³  ìë£Œ<a class="header-link" href="#_20" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.opencv.org/4.x/d9/df8/tutorial_root.html">OpenCV Tutorials</a></li>
<li><a href="https://pyimagesearch.com/">PyImageSearch</a> - ì‹¤ì „ í”„ë¡œì íŠ¸ íŠœí† ë¦¬ì–¼</li>
<li><a href="https://learnopencv.com/">Learn OpenCV</a> - ê³ ê¸‰ ì˜ˆì œ</li>
<li><a href="https://google.github.io/mediapipe/">Mediapipe</a> - Googleì˜ ML ì†”ë£¨ì…˜</li>
<li><a href="https://paperswithcode.com/">Papers With Code</a> - ìµœì‹  ì—°êµ¬ ë° ì½”ë“œ</li>
<li>Bradski, G., &amp; Kaehler, A. (2008). "Learning OpenCV"</li>
<li>Szeliski, R. (2010). "Computer Vision: Algorithms and Applications"</li>
</ul>
    </div>

    
<div class="lesson-toolbar lesson-toolbar--bottom">
    <div class="toolbar-nav toolbar-nav--prev">
        
        <a href="/study/ko/Computer_Vision/19_DNN_Module.html" class="nav-prev">
            <span class="nav-label">Previous</span>
            <span class="nav-title">ë”¥ëŸ¬ë‹ DNN ëª¨ë“ˆ (Deep Neural Network Module)</span>
        </a>
        
    </div>
    <div class="toolbar-actions">
        <button class="btn btn-copy-link" data-action="copy-link" title="Copy link">
            <span class="icon">ğŸ”—</span>
            <span class="text">Copy link</span>
        </button>
        <a href="/study/ko/Computer_Vision/" class="btn btn-topic-link" title="Back to topic list">
            <span class="icon">ğŸ“‹</span>
            <span class="text">Topic list</span>
        </a>
    </div>
    <div class="toolbar-nav toolbar-nav--next">
        
        <a href="/study/ko/Computer_Vision/21_3D_Vision_Basics.html" class="nav-next">
            <span class="nav-label">Next</span>
            <span class="nav-title">3D ë¹„ì „ ê¸°ì´ˆ (3D Vision Basics)</span>
        </a>
        
    </div>
</div>


    <div class="toolbar-keyboard-hint">
        <kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate between lessons
    </div>
</article>

<!-- Scroll to top floating button -->
<button class="scroll-to-top" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top">â†‘</button>

            </div>
        </main>
    </div>

    <script src="/study/static/js/app.js"></script>
    <script>
        function switchLanguage(newLang) {
            const path = window.location.pathname;
            const base = '/study';
            const currentLang = 'ko';
            const newPath = path.replace(base + '/' + currentLang + '/', base + '/' + newLang + '/');
            window.location.href = newPath + window.location.search;
        }
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link - independent feedback per button
        document.querySelectorAll('[data-action="copy-link"]').forEach(function(btn) {
            btn.addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href);
                var textEl = this.querySelector('.text');
                var originalText = textEl.textContent;
                textEl.textContent = 'Copied!';
                setTimeout(function() { textEl.textContent = originalText; }, 2000);
            });
        });

        // Add copy buttons to code blocks
        document.querySelectorAll('.lesson-content pre').forEach(function(pre) {
            var copyBtn = document.createElement('button');
            copyBtn.className = 'code-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() {
                var code = pre.querySelector('code');
                var text = code ? code.textContent : pre.textContent;
                navigator.clipboard.writeText(text);
                copyBtn.textContent = 'Copied!';
                setTimeout(function() { copyBtn.textContent = 'Copy'; }, 2000);
            });
            pre.style.position = 'relative';
            pre.appendChild(copyBtn);
        });

        // Scroll to top button
        var scrollBtn = document.getElementById('scroll-to-top');
        window.addEventListener('scroll', function() {
            scrollBtn.classList.toggle('visible', window.scrollY > 300);
        });
        scrollBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Keyboard shortcuts: left/right arrows for lesson navigation
        document.addEventListener('keydown', function(e) {
            var tag = document.activeElement.tagName;
            if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

            if (e.key === 'ArrowLeft') {
                var prevLink = document.querySelector('.nav-prev');
                if (prevLink) prevLink.click();
            } else if (e.key === 'ArrowRight') {
                var nextLink = document.querySelector('.nav-next');
                if (nextLink) nextLink.click();
            }
        });
    });
</script>

</body>
</html>
{% endraw %}